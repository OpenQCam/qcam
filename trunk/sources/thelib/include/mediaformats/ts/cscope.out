cscope 15 $HOME/tstools               0001099632
	@ac3.c

30 
	~<¡dio.h
>

31 
	~<¡dlib.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

35 
	~"com·t.h
"

36 
	~"´štšg_âs.h
"

37 
	~"misc_âs.h
"

38 
	~"ac3_âs.h
"

41 
	gl_ämsizecod
[19][3] = {

76 
	#SYNCINFO_SIZE
 5

	)

78 
	$»ad_Ãxt_ac3_äame
(
fe
,

79 
audio_äame_p
 *
äame
)

81 
i
, 
”r
;

82 
by‹
 
sync_šfo
[
SYNCINFO_SIZE
];

83 
by‹
 *
d©a
 = 
NULL
;

84 
fscod
;

85 
ämsizecod
;

86 
äame_Ëngth
;

88 
off£t_t
 
po¢
 = 
	`‹Î_fe
(
fe
);

90 
”r
 = 
	`»ad_by‹s
(
fe
, 
SYNCINFO_SIZE
, 
sync_šfo
);

91 ià(
”r
 =ğ
EOF
)

92  
EOF
;

93 ià(
”r
)

95 
	`åršt_”r
("### Error„eading syncinfo from AC3 file\n"

96 " (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n", 
po¢
);

100 ià(
sync_šfo
[0] != 0x0b || sync_info[1] != 0x77)

102 
	`åršt_”r
("### AC3 frame does‚ot start with 0x0b77"

105 ()
sync_šfo
[0], ()sync_info[1]);

106 
	`åršt_”r
(" (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n", 
po¢
);

110 
fscod
 = 
sync_šfo
[4] >> 6;

111 ià(
fscod
 == 3)

114 
	`åršt_”r
("### Bad sample„ate code in AC3 syncinfo\n"

115 " (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n", 
po¢
);

119 
ämsizecod
 = 
sync_šfo
[4] & 0x3f;

120 ià(
ämsizecod
 > 37)

122 
	`åršt_”r
("### Bad frame size code %d in AC3 syncinfo\n",

123 
ämsizecod
);

124 
	`åršt_”r
(" (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n", 
po¢
);

128 
äame_Ëngth
 = 
l_ämsizecod
[
ämsizecod
 >> 1][
fscod
];

129 ià(
fscod
 == 1)

130 
äame_Ëngth
 +ğ
ämsizecod
 & 1;

131 
äame_Ëngth
 <<= 1;

133 
d©a
 = 
	`m®loc
(
äame_Ëngth
);

134 ià(
d©a
 =ğ
NULL
)

136 
	`´št_”r
("### Unableoƒxtend data buffer for AC3 frame\n");

139 
i
 = 0; i < 
SYNCINFO_SIZE
; i++)

140 
d©a
[
i
] = 
sync_šfo
[i];

142 
”r
 = 
	`»ad_by‹s
(
fe
, 
äame_Ëngth
 - 
SYNCINFO_SIZE
,

143 &
d©a
[
SYNCINFO_SIZE
]);

144 ià(
”r
)

146 ià(
”r
 =ğ
EOF
)

147 
	`´št_”r
("### Unexpected EOF„eading„est of AC3 frame\n");

149 
	`´št_”r
("### Error„eading„est of AC3 frame\n");

150 
	`ä“
(
d©a
);

154 
”r
 = 
	`bud_audio_äame
(
äame
);

155 ià(
”r
)

157 
	`ä“
(
d©a
);

160 (*
äame
)->
d©a
 = data;

161 (*
äame
)->
d©a_Ën
 = 
äame_Ëngth
;

164 
	}
}

	@ac3_fns.h

30 #iâdeà
_ac3_âs


31 
	#_ac3_âs


	)

33 
	~"audio_âs.h
"

48 
»ad_Ãxt_ac3_äame
(
fe
,

49 
audio_äame_p
 *
äame
);

	@accessunit.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

32 
	~"com·t.h
"

33 
	~"´štšg_âs.h
"

34 
	~"es_âs.h
"

35 
	~"ts_âs.h
"

36 
	~"Çlun™_âs.h
"

37 
	~"acûssun™_âs.h
"

38 
	~"»v”£_âs.h
"

40 
	#DEBUG
 0

	)

48 
šlše
 
	$bud_acûss_un™
(
acûss_un™_p
 *
acc_un™
,

49 
ušt32_t
 
šdex
)

51 
”r
;

53 
acûss_un™_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_ACCESS_UNIT
);

54 ià(
Ãw
 =ğ
NULL
)

56 
	`´št_”r
("### Unableo‡llocate‡ccess unit datastructure\n");

60 
”r
 = 
	`bud_Çl_un™_li¡
(&(
Ãw
->
Çl_un™s
));

61 ià(
”r
)

63 
	`ä“
(
Ãw
);

64 *
acc_un™
 = 
NULL
;

65  
”r
;

67 
Ãw
->
šdex
 = index;

68 
Ãw
->
¡¬‹d_´im¬y_piùu»
 = 
FALSE
;

69 
Ãw
->
´im¬y_¡¬t
 = 
NULL
;

70 
Ãw
->
ignÜed_brok’_NAL_un™s
 = 0;

72 
Ãw
->
äame_num
 =‚ew->
f›ld_pic_æag
 =‚ew->
bÙtom_f›ld_æag
 = 0;

74 *
acc_un™
 = 
Ãw
;

76 
	}
}

84 
šlše
 
	$ş—r_acûss_un™
(
acûss_un™_p
 
acc_un™
,

85 
d“p
)

87 
	`ä“_Çl_un™_li¡
(&(
acc_un™
->
Çl_un™s
),
d“p
);

88 
acc_un™
->
´im¬y_¡¬t
 = 
NULL
;

89 
	}
}

98 
	$ä“_acûss_un™
(
acûss_un™_p
 *
acc_un™
)

100 ià(*
acc_un™
 =ğ
NULL
)

102 
	`ş—r_acûss_un™
(*
acc_un™
,
TRUE
);

103 
	`ä“
(*
acc_un™
);

104 *
acc_un™
 = 
NULL
;

105 
	}
}

110 
	$»pÜt_acûss_un™
(
acûss_un™_p
 
acûss_un™
)

112 
ii
;

113 
	`åršt_msg
("Acûs un™ %u",
acûss_un™
->
šdex
);

114 ià(
acûss_un™
->
¡¬‹d_´im¬y_piùu»
)

115 
	`åršt_msg
(" (%s)",
acûss_un™
->
´im¬y_¡¬t
->
¡¬t_»asÚ
);

116 
	`´št_msg
(":\n");

117 ià(
acûss_un™
->
f›ld_pic_æag
)

118 
	`åršt_msg
(" %s field of frame %u\n",

119 (
acûss_un™
->
bÙtom_f›ld_æag
==1?"Bottom":"Top"),

120 
acûss_un™
->
äame_num
);

122 
	`åršt_msg
(" F¿m%u\n",
acûss_un™
->
äame_num
);

124 ià(
acûss_un™
->
ignÜed_brok’_NAL_un™s
)

125 
	`åršt_msg
(" Ignored %d broken NAL unit%s\n",

126 
acûss_un™
->
ignÜed_brok’_NAL_un™s
,

127 (
acûss_un™
->
ignÜed_brok’_NAL_un™s
==1?"":"s"));

129 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

131 
Çl_un™_p
 
Çl
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

132 ià(
Çl
 =ğ
NULL
)

133 
	`´št_msg
(" <null>\n");

136 
	`åršt_msg
(" %c",((
acûss_un™
->
´im¬y_¡¬t
 =ğ
Çl
)?'*':' '));

137 
	`»pÜt_Çl
(
TRUE
,
Çl
);

140 
	}
}

145 
šlše
 
	$num_¦iûs
(
acûss_un™_p
 
acûss_un™
)

147 
couÁ
 = 0;

148 
ii
;

149 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

151 ià(
	`Çl_is_¦iû
(
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
]))

152 
couÁ
 ++;

154  
couÁ
;

155 
	}
}

168 
	$g‘_acûss_un™_bounds
(
acûss_un™_p
 
acûss_un™
,

169 
ES_off£t
 *
¡¬t
,

170 
ušt32_t
 *
Ëngth
)

172 
ii
;

173 ià(
acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

175 
	`´št_”r
("### Cannot determine bounds of‡n‡ccess unit with‚o content\n");

179 *
¡¬t
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[0]->
un™
.
¡¬t_po¢
;

180 *
Ëngth
 = 0;

183 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

184 (*
Ëngth
è+ğ
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
]->
un™
.
d©a_Ën
;

187 
	}
}

192 
	$®l_¦iûs_I
(
acûss_un™_p
 
acûss_un™
)

194 
ii
;

195 ià(
acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

196  
FALSE
;

197 ià(!
	`Çl_is_¦iû
(
acûss_un™
->
´im¬y_¡¬t
))

198  
FALSE
;

200 ià(
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
ALL_SLICES_I
)

201  
TRUE
;

203 ià(
	`num_¦iûs
(
acûss_un™
) == 1 &&

204 
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
SLICE_I
)

205  
TRUE
;

207 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

209 
Çl_un™_p
 
Çl_un™
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

210 ià(
	`Çl_is_¦iû
(
Çl_un™
è&&‚®_un™->
u
.
¦iû
.
¦iû_ty³
 !ğ
SLICE_I
)

211  
FALSE
;

213  
TRUE
;

214 
	}
}

219 
	$®l_¦iûs_P
(
acûss_un™_p
 
acûss_un™
)

221 
ii
;

222 ià(
acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

223  
FALSE
;

224 ià(!
	`Çl_is_¦iû
(
acûss_un™
->
´im¬y_¡¬t
))

225  
FALSE
;

227 ià(
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
ALL_SLICES_P
)

228  
TRUE
;

230 ià(
	`num_¦iûs
(
acûss_un™
) == 1 &&

231 
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
SLICE_P
)

232  
TRUE
;

234 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

236 
Çl_un™_p
 
Çl_un™
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

237 ià(
	`Çl_is_¦iû
(
Çl_un™
è&&‚®_un™->
u
.
¦iû
.
¦iû_ty³
 !ğ
SLICE_P
)

238  
FALSE
;

240  
TRUE
;

241 
	}
}

246 
	$®l_¦iûs_I_Ü_P
(
acûss_un™_p
 
acûss_un™
)

248 
ii
;

249 ià(
acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

250  
FALSE
;

251 ià(!
	`Çl_is_¦iû
(
acûss_un™
->
´im¬y_¡¬t
))

252  
FALSE
;

254 ià(
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
SLICE_I
 ||

255 
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
SLICE_P
)

256  
TRUE
;

258 ià(
	`num_¦iûs
(
acûss_un™
) == 1 &&

259 (
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
ALL_SLICES_I
 ||

260 
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
ALL_SLICES_P
))

261  
TRUE
;

263 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

265 
Çl_un™_p
 
Çl_un™
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

266 ià(
	`Çl_is_¦iû
(
Çl_un™
) &&

267 (
Çl_un™
->
u
.
¦iû
.
¦iû_ty³
 !ğ
SLICE_I
 &&

268 
Çl_un™
->
u
.
¦iû
.
¦iû_ty³
 !ğ
SLICE_P
))

269  
FALSE
;

271  
TRUE
;

272 
	}
}

277 
	$®l_¦iûs_B
(
acûss_un™_p
 
acûss_un™
)

279 
ii
;

280 ià(
acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

281  
FALSE
;

282 ià(!
	`Çl_is_¦iû
(
acûss_un™
->
´im¬y_¡¬t
))

283  
FALSE
;

285 ià(
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
ALL_SLICES_B
)

286  
TRUE
;

288 ià(
	`num_¦iûs
(
acûss_un™
) == 1 &&

289 
acûss_un™
->
´im¬y_¡¬t
->
u
.
¦iû
.
¦iû_ty³
 =ğ
SLICE_B
)

290  
TRUE
;

292 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

294 
Çl_un™_p
 
Çl_un™
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

295 ià(
	`Çl_is_¦iû
(
Çl_un™
è&&‚®_un™->
u
.
¦iû
.
¦iû_ty³
 !ğ
SLICE_B
)

296  
FALSE
;

298  
TRUE
;

299 
	}
}

308 
	$acûss_un™_­³nd
(
acûss_un™_p
 
acûss_un™
,

309 
Çl_un™_p
 
Çl
,

310 
¡¬ts_´im¬y
,

311 
Çl_un™_li¡_p
 
³ndšg
)

313 
”r
;

314 ià(
¡¬ts_´im¬y
 && 
acûss_un™
->
¡¬‹d_´im¬y_piùu»
)

317 
	`åršt_”r
("### Already had‡ start of…rimary…icture in‡ccess"

318 " un™ %d\n",
acûss_un™
->
šdex
);

322 ià(
¡¬ts_´im¬y
)

324 
acûss_un™
->
´im¬y_¡¬t
 = 
Çl
;

325 
acûss_un™
->
¡¬‹d_´im¬y_piùu»
 = 
TRUE
;

326 
acûss_un™
->
äame_num
 = 
Çl
->
u
.
¦iû
.frame_num;

327 
acûss_un™
->
f›ld_pic_æag
 = 
Çl
->
u
.
¦iû
.field_pic_flag;

328 
acûss_un™
->
bÙtom_f›ld_æag
 = 
Çl
->
u
.
¦iû
.bottom_field_flag;

330 ià(
³ndšg
 !ğ
NULL
 &&…’dšg->
Ëngth
 > 0)

332 
ii
;

333 
ii
=0; ii<
³ndšg
->
Ëngth
; ii++)

335 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
acûss_un™
->
Çl_un™s
,

336 
³ndšg
->
¬¿y
[
ii
]);

337 ià(
”r
)

339 
	`åršt_”r
("### Errorƒxtending‡ccess unit %d\n",

340 
acûss_un™
->
šdex
);

341  
”r
;

346 ià(
Çl
 !ğ
NULL
)

348 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
acûss_un™
->
Çl_un™s
,
Çl
);

349 ià(
”r
)

351 
	`åršt_”r
("### Errorƒxtending‡ccess unit %d\n",

352 
acûss_un™
->
šdex
);

353  
”r
;

357 
	}
}

365 
	$m”ge_acûss_un™_Çls
(
acûss_un™_p
 
acûss_un™1
,

366 
acûss_un™_p
 *
acûss_un™2
)

368 
”r
, 
ii
;

370 
ii
 = 0; i˜< (*
acûss_un™2
)->
Çl_un™s
->
Ëngth
; ii++)

372 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
acûss_un™1
->
Çl_un™s
,

373 (*
acûss_un™2
)->
Çl_un™s
->
¬¿y
[
ii
]);

374 ià(
”r
)

376 
	`´št_”r
("### Error mergingwo‡ccess units\n");

377  
”r
;

382 
acûss_un™1
->
ignÜed_brok’_NAL_un™s
 +=

383 (*
acûss_un™2
)->
ignÜed_brok’_NAL_un™s
;

387 
	`ş—r_acûss_un™
(*
acûss_un™2
,
FALSE
);

388 
	`ä“
(*
acûss_un™2
);

389 *
acûss_un™2
 = 
NULL
;

393 
acûss_un™1
->
f›ld_pic_æag
 = 0;

395 
	}
}

411 
	$wr™e_acûss_un™_as_ES
(
acûss_un™_p
 
acûss_un™
,

412 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

413 
FILE
 *
ouut
)

415 
ii
, 
”r
;

416 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

418 
”r
 = 
	`wr™e_ES_un™
(
ouut
,&(
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
]->
un™
));

419 ià(
”r
)

421 
	`´št_”r
("### Error writing NAL unit ");

422 
	`»pÜt_Çl
(
FALSE
,
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
]);

423  
”r
;

427 ià(
cÚ‹xt
 !ğ
NULL
 && cÚ‹xt->
’d_of_£qu’û
)

429 
”r
 = 
	`wr™e_ES_un™
(
ouut
,&(
cÚ‹xt
->
’d_of_£qu’û
->
un™
));

430 ià(
”r
)

432 
	`´št_”r
("### Error writingƒnd of sequence NAL unit ");

433 
	`»pÜt_Çl
(
FALSE
,
cÚ‹xt
->
’d_of_£qu’û
);

434  
”r
;

436 
	`ä“_Çl_un™
(&
cÚ‹xt
->
’d_of_£qu’û
);

439 ià(
cÚ‹xt
 !ğ
NULL
 && cÚ‹xt->
’d_of_¡»am
)

441 
”r
 = 
	`wr™e_ES_un™
(
ouut
,&(
cÚ‹xt
->
’d_of_¡»am
->
un™
));

442 ià(
”r
)

444 
	`´št_”r
("### Error writingƒnd of stream NAL unit ");

445 
	`»pÜt_Çl
(
FALSE
,
cÚ‹xt
->
’d_of_£qu’û
);

446  
”r
;

448 
	`ä“_Çl_un™
(&
cÚ‹xt
->
’d_of_¡»am
);

451 
	}
}

467 
	$wr™e_acûss_un™_Œa”_as_TS
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

468 
TS_wr™”_p
 
tswr™”
,

469 
ušt32_t
 
video_pid
)

471 
”r
;

473 ià(
cÚ‹xt
 !ğ
NULL
 && cÚ‹xt->
’d_of_£qu’û
)

475 
Çl_un™_p
 
Çl
 = 
cÚ‹xt
->
’d_of_£qu’û
;

476 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,
Çl
->
un™
.
d©a
,Çl->un™.
d©a_Ën
,

477 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

478 ià(
”r
)

480 
	`´št_”r
("### Error writingƒnd of sequence NAL unit ");

481 
	`»pÜt_Çl
(
FALSE
,
Çl
);

482  
”r
;

484 
	`ä“_Çl_un™
(&
cÚ‹xt
->
’d_of_£qu’û
);

487 ià(
cÚ‹xt
 !ğ
NULL
 && cÚ‹xt->
’d_of_¡»am
)

489 
Çl_un™_p
 
Çl
 = 
cÚ‹xt
->
’d_of_¡»am
;

490 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,
Çl
->
un™
.
d©a
,Çl->un™.
d©a_Ën
,

491 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

492 ià(
”r
)

494 
	`´št_”r
("### Error writingƒnd of stream NAL unit ");

495 
	`»pÜt_Çl
(
FALSE
,
Çl
);

496  
”r
;

498 
	`ä“_Çl_un™
(&
cÚ‹xt
->
’d_of_¡»am
);

501 
	}
}

518 
	$wr™e_acûss_un™_as_TS
(
acûss_un™_p
 
acûss_un™
,

519 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

520 
TS_wr™”_p
 
tswr™”
,

521 
ušt32_t
 
video_pid
)

523 
ii
, 
”r
;

525 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

527 
Çl_un™_p
 
Çl
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

529 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,

530 
Çl
->
un™
.
d©a
,Çl->un™.
d©a_Ën
,

531 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

532 ià(
”r
)

534 
	`´št_”r
("### Error writing NAL unit ");

535 
	`»pÜt_Çl
(
FALSE
,
Çl
);

536  
”r
;

539  
	`wr™e_acûss_un™_Œa”_as_TS
(
cÚ‹xt
,
tswr™”
,
video_pid
);

540 
	}
}

565 
	$wr™e_acûss_un™_as_TS_w™h_±s_dts
(
acûss_un™_p
 
acûss_un™
,

566 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

567 
TS_wr™”_p
 
tswr™”
,

568 
ušt32_t
 
video_pid
,

569 
gÙ_±s
,

570 
ušt64_t
 
±s
,

571 
gÙ_dts
,

572 
ušt64_t
 
dts
)

574 
ii
, 
”r
;

576 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

578 
Çl_un™_p
 
Çl
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

581 ià(
ii
 == 0)

582 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘_w™h_±s_dts
(
tswr™”
,

583 
Çl
->
un™
.
d©a
,

584 
Çl
->
un™
.
d©a_Ën
,

585 
video_pid
,

586 
DEFAULT_VIDEO_STREAM_ID
,

587 
gÙ_±s
,
±s
,

588 
gÙ_dts
,
dts
);

590 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,

591 
Çl
->
un™
.
d©a
,Çl->un™.
d©a_Ën
,

592 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

593 ià(
”r
)

595 
	`´št_”r
("### Error writing NAL unit ");

596 
	`»pÜt_Çl
(
FALSE
,
Çl
);

597  
”r
;

600  
	`wr™e_acûss_un™_Œa”_as_TS
(
cÚ‹xt
,
tswr™”
,
video_pid
);

601 
	}
}

620 
	$wr™e_acûss_un™_as_TS_w™h_PCR
(
acûss_un™_p
 
acûss_un™
,

621 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

622 
TS_wr™”_p
 
tswr™”
,

623 
ušt32_t
 
video_pid
,

624 
ušt64_t
 
pü_ba£
,

625 
ušt32_t
 
pü_exŠ
)

627 
ii
, 
”r
;

629 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

631 
Çl_un™_p
 
Çl
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

634 ià(
ii
 == 0)

635 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘_w™h_pü
(
tswr™”
,

636 
Çl
->
un™
.
d©a
,

637 
Çl
->
un™
.
d©a_Ën
,

638 
video_pid
,

639 
DEFAULT_VIDEO_STREAM_ID
,

640 
pü_ba£
,
pü_exŠ
);

642 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,

643 
Çl
->
un™
.
d©a
,Çl->un™.
d©a_Ën
,

644 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

645 ià(
”r
)

647 
	`´št_”r
("### Error writing NAL unit ");

648 
	`»pÜt_Çl
(
FALSE
,
Çl
);

649  
”r
;

652  
	`wr™e_acûss_un™_Œa”_as_TS
(
cÚ‹xt
,
tswr™”
,
video_pid
);

653 
	}
}

668 
šlše
 
	$’d_acûss_un™
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

669 
acûss_un™_p
 
acûss_un™
,

670 
show_d‘as
)

672 ià(
show_d‘as
)

674 
	`»pÜt_acûss_un™
(
acûss_un™
);

675 ià(
cÚ‹xt
->
³ndšg_Çl
)

677 
	`´št_msg
("...…ending: ");

678 
	`»pÜt_Çl
(
TRUE
,
cÚ‹xt
->
³ndšg_Çl
);

680 ià(
cÚ‹xt
->
’d_of_£qu’û
)

682 
	`´št_msg
("--> EndOfSequence ");

683 
	`»pÜt_Çl
(
TRUE
,
cÚ‹xt
->
’d_of_£qu’û
);

685 ià(
cÚ‹xt
->
’d_of_¡»am
)

687 
	`´št_msg
("--> EndOfStream ");

688 
	`»pÜt_Çl
(
TRUE
,
cÚ‹xt
->
’d_of_¡»am
);

692 
	}
}

699 
	$bud_acûss_un™_cÚ‹xt
(
ES_p
 
es
,

700 
acûss_un™_cÚ‹xt_p
 *
cÚ‹xt
)

702 
”r
;

703 
acûss_un™_cÚ‹xt_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_ACCESS_UNIT_CONTEXT
);

704 ià(
Ãw
 =ğ
NULL
)

706 
	`´št_”r
("### Unableo‡llocate‡ccess unit context datastructure\n");

710 
Ãw
->
³ndšg_Çl
 = 
NULL
;

711 
Ãw
->
’d_of_¡»am
 = 
NULL
;

712 
Ãw
->
’d_of_£qu’û
 = 
NULL
;

713 
Ãw
->
acûss_un™_šdex
 = 0;

714 
Ãw
->
»v”£_d©a
 = 
NULL
;

715 
Ãw
->
no_mÜe_d©a
 = 
FALSE
;

716 
Ãw
->
—¾›r_´im¬y_¡¬t
 = 
NULL
;

718 
”r
 = 
	`bud_Çl_un™_cÚ‹xt
(
es
,&
Ãw
->
Çc
);

719 ià(
”r
)

721 
	`´št_”r
("### Error building‡ccess unit context datastructure\n");

722 
	`ä“
(
Ãw
);

723  
”r
;

725 
”r
 = 
	`bud_Çl_un™_li¡
(&
Ãw
->
³ndšg_li¡
);

726 ià(
”r
)

728 
	`´št_”r
("### Error building‡ccess unit context datastructure\n");

729 
	`ä“_Çl_un™_cÚ‹xt
(&
Ãw
->
Çc
);

730 
	`ä“
(
Ãw
);

731  
”r
;

734 *
cÚ‹xt
 = 
Ãw
;

736 
	}
}

747 
	$ä“_acûss_un™_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 *
cÚ‹xt
)

749 
acûss_un™_cÚ‹xt_p
 
cc
 = *
cÚ‹xt
;

751 ià(
cc
 =ğ
NULL
)

756 
	`ä“_Çl_un™_li¡
(&
cc
->
³ndšg_li¡
,
TRUE
);

759 
	`ä“_Çl_un™
(&
cc
->
—¾›r_´im¬y_¡¬t
);

760 
	`ä“_Çl_un™
(&
cc
->
’d_of_£qu’û
);

761 
	`ä“_Çl_un™
(&
cc
->
’d_of_¡»am
);

762 
	`ä“_Çl_un™
(&
cc
->
³ndšg_Çl
);

764 
	`ä“_Çl_un™_cÚ‹xt
(&
cc
->
Çc
);

766 
cc
->
»v”£_d©a
 = 
NULL
;

768 
	`ä“
(*
cÚ‹xt
);

769 *
cÚ‹xt
 = 
NULL
;

771 
	}
}

777 
	$»£t_acûss_un™_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
)

779 
	`ä“_Çl_un™
(&
cÚ‹xt
->
—¾›r_´im¬y_¡¬t
);

780 
	`ä“_Çl_un™
(&
cÚ‹xt
->
’d_of_£qu’û
);

781 
	`ä“_Çl_un™
(&
cÚ‹xt
->
’d_of_¡»am
);

782 
	`ä“_Çl_un™
(&
cÚ‹xt
->
³ndšg_Çl
);

783 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
FALSE
);

784 
cÚ‹xt
->
no_mÜe_d©a
 = 
FALSE
;

789 
	}
}

802 
	$»wšd_acûss_un™_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
)

805 
	`»£t_acûss_un™_cÚ‹xt
(
cÚ‹xt
);

807 
cÚ‹xt
->
acûss_un™_šdex
 = 0;

810 ià(
cÚ‹xt
->
»v”£_d©a
)

812 
cÚ‹xt
->
»v”£_d©a
->
Ï¡_po¢_added
 = -1;

816  
	`»wšd_Çl_un™_cÚ‹xt
(
cÚ‹xt
->
Çc
);

817 
	}
}

841 
	$»memb”_—¾›r_´im¬y_¡¬t
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

842 
Çl_un™_p
 
Çl
)

844 
Çl_un™_p
 
tgt
 = 
cÚ‹xt
->
—¾›r_´im¬y_¡¬t
;

846 ià(
tgt
 =ğ
NULL
)

848 
”r
 = 
	`bud_Çl_un™
(&
tgt
);

849 ià(
”r
)

851 
	`´št_”r
("### Error building NAL unit for 'earlier…rimary start'\n");

852 
	`ä“
(
tgt
);

853  
”r
;

855 
cÚ‹xt
->
—¾›r_´im¬y_¡¬t
 = 
tgt
;

858 
tgt
->
¡¬ts_piùu»_decided
 = 
Çl
->starts_picture_decided;

859 
tgt
->
¡¬ts_piùu»
 = 
Çl
->starts_picture;

860 
tgt
->
¡¬t_»asÚ
 = 
Çl
->start_reason;

861 
tgt
->
decoded
 = 
Çl
->decoded;

863 
tgt
->
Çl_»f_idc
 = 
Çl
->nal_ref_idc;

864 
tgt
->
Çl_un™_ty³
 = 
Çl
->nal_unit_type;

865 
tgt
->
u
 = 
Çl
->u;

869 
tgt
->
un™
.
¡¬t_po¢
 = 
Çl
->unit.start_posn;

870 
tgt
->
un™
.
d©a_Ën
 = 
Çl
->unit.data_len;

873 
	}
}

879 
	$maybe_»memb”_acûss_un™
(
»v”£_d©a_p
 
»v”£_d©a
,

880 
acûss_un™_p
 
acûss_un™
,

881 
v”bo£
)

884 ià(
acûss_un™
->
´im¬y_¡¬t
 !ğ
NULL
 &&

885 
acûss_un™
->
´im¬y_¡¬t
->
Çl_»f_idc
 != 0 &&

886 (
acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
 ||

887 
	`®l_¦iûs_I
(
acûss_un™
)))

889 
ES_off£t
 
¡¬t_po¢
 = {0,0};

890 
ušt32_t
 
num_by‹s
 = 0;

891 
”r
 = 
	`g‘_acûss_un™_bounds
(
acûss_un™
,&
¡¬t_po¢
,&
num_by‹s
);

892 ià(
”r
)

894 
	`åršt_”r
("### Error working out…osition/size of‡ccess unit %d"

895 " fÜ„ev”sšg\n",
acûss_un™
->
šdex
);

898 
”r
 = 
	`»memb”_»v”£_h264_d©a
(
»v”£_d©a
,
acûss_un™
->
šdex
,

899 
¡¬t_po¢
,
num_by‹s
);

900 ià(
”r
)

902 
	`åršt_”r
("### Error„emembering‡ccess unit %d for„eversing\n",

903 
acûss_un™
->
šdex
);

906 ià(
v”bo£
è
	`åršt_msg
("REMEMBER IDR %5d‡ˆ" 
OFFSET_T_FORMAT_08


907 "/%04d fÜ %5d\n",
acûss_un™
->
šdex
,

908 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

911 
	}
}

945 
	$g‘_Ãxt_acûss_un™
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

946 
qu›t
,

947 
show_d‘as
,

948 
acûss_un™_p
 *
»t_acûss_un™
)

950 
”r
;

951 
Çl_un™_p
 
Çl
 = 
NULL
;

952 
acûss_un™_p
 
acûss_un™
;

955 ià(
cÚ‹xt
->
no_mÜe_d©a
)

957 *
»t_acûss_un™
 = 
NULL
;

958  
EOF
;

963 
”r
 = 
	`bud_acûss_un™
(&
acûss_un™
,
cÚ‹xt
->
acûss_un™_šdex
+1);

964 ià(
”r
) ƒrr;

967 ià(
cÚ‹xt
->
³ndšg_Çl
 !ğ
NULL
)

969 
”r
 = 
	`acûss_un™_­³nd
(
acûss_un™
,

970 
cÚ‹xt
->
³ndšg_Çl
,
TRUE
,cÚ‹xt->
³ndšg_li¡
);

971 ià(
”r
è
give_up
;

972 
cÚ‹xt
->
³ndšg_Çl
 = 
NULL
;

973 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
FALSE
);

978 
”r
 = 
	`fšd_Ãxt_NAL_un™
(
cÚ‹xt
->
Çc
,
FALSE
,&
Çl
);

979 ià(
”r
 =ğ
EOF
)

981 
cÚ‹xt
->
no_mÜe_d©a
 = 
TRUE
;

984 ià(
”r
 == 2)

993 
	`´št_”r
("!!! Ignoring broken NAL unit\n");

994 
acûss_un™
->
ignÜed_brok’_NAL_un™s
 ++;

997 ià(
”r
)

999 
	`´št_”r
("### Error„etrieving‚ext NAL\n");

1000 
give_up
;

1003 ià(
	`Çl_is_¦iû
(
Çl
))

1005 ià(!
acûss_un™
->
¡¬‹d_´im¬y_piùu»
)

1013 
Çl
->
¡¬t_»asÚ
 = "First slice of‚ew‡ccess unit";

1014 
”r
 = 
	`acûss_un™_­³nd
(
acûss_un™
,
Çl
,
TRUE
,
cÚ‹xt
->
³ndšg_li¡
);

1015 ià(
”r
è
give_up_ä“_Çl
;

1016 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
FALSE
);

1017 
”r
 = 
	`»memb”_—¾›r_´im¬y_¡¬t
(
cÚ‹xt
,
Çl
);

1018 ià(
”r
è
give_up_ä“_Çl
;

1020 ià(
	`Çl_is_fœ¡_VCL_NAL
(
Çl
,
cÚ‹xt
->
—¾›r_´im¬y_¡¬t
))

1024 
”r
 = 
	`»memb”_—¾›r_´im¬y_¡¬t
(
cÚ‹xt
,
Çl
);

1025 ià(
”r
è
give_up_ä“_Çl
;

1026 ià(
acûss_un™
->
¡¬‹d_´im¬y_piùu»
)

1031 
cÚ‹xt
->
³ndšg_Çl
 = 
Çl
;

1037 
”r
 = 
	`acûss_un™_­³nd
(
acûss_un™
,
Çl
,
TRUE
,
cÚ‹xt
->
³ndšg_li¡
);

1038 ià(
”r
è
give_up_ä“_Çl
;

1039 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
FALSE
);

1042 ià(!
acûss_un™
->
¡¬‹d_´im¬y_piùu»
)

1046 ià(!
qu›t
)

1048 
	`´št_”r
("!!! Ignoring VCL NALhat cannot start‡…icture:\n");

1049 
	`´št_”r
(" ");

1050 
	`»pÜt_Çl
(
FALSE
,
Çl
);

1051 
	`´št_”r
("\n");

1053 
	`ä“_Çl_un™
(&
Çl
);

1055 ià(
	`Çl_is_»dundªt
(
Çl
))

1059 
	`ä“_Çl_un™
(&
Çl
);

1064 
”r
 = 
	`acûss_un™_­³nd
(
acûss_un™
,
Çl
,
FALSE
,
cÚ‹xt
->
³ndšg_li¡
);

1065 ià(
”r
è
give_up_ä“_Çl
;

1066 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
FALSE
);

1069 ià(
Çl
->
Çl_un™_ty³
 =ğ
NAL_ACCESS_UNIT_DELIM
)

1072 ià(
acûss_un™
->
¡¬‹d_´im¬y_piùu»
)

1074 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
Çl
);

1075 ià(
”r
è
give_up_ä“_Çl
;

1081 ià(
cÚ‹xt
->
³ndšg_li¡
->
Ëngth
 > 0 ||

1082 
acûss_un™
->
Çl_un™s
->
Ëngth
 > 0)

1084 
	`´št_”r
("!!! Ignoring incomplete‡ccess unit:\n");

1085 ià(
acûss_un™
->
Çl_un™s
->
Ëngth
 > 0)

1087 
	`»pÜt_Çl_un™_li¡
(
FALSE
," ",
acûss_un™
->
Çl_un™s
);

1088 
	`»£t_Çl_un™_li¡
(
acûss_un™
->
Çl_un™s
,
TRUE
);

1090 ià(
cÚ‹xt
->
³ndšg_li¡
->
Ëngth
 > 0)

1092 
	`»pÜt_Çl_un™_li¡
(
FALSE
," ",
cÚ‹xt
->
³ndšg_li¡
);

1093 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
TRUE
);

1096 
”r
 = 
	`acûss_un™_­³nd
(
acûss_un™
,
Çl
,
FALSE
,
NULL
);

1097 ià(
”r
è
give_up_ä“_Çl
;

1100 ià(
Çl
->
Çl_un™_ty³
 =ğ
NAL_SEI
)

1105 ià(
acûss_un™
->
¡¬‹d_´im¬y_piùu»
)

1107 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
Çl
);

1108 ià(
”r
è
give_up_ä“_Çl
;

1113 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
Çl
);

1114 ià(
”r
è
give_up_ä“_Çl
;

1117 ià(
Çl
->
Çl_un™_ty³
 =ğ
NAL_SEQ_PARAM_SET
 ||

1118 
Çl
->
Çl_un™_ty³
 =ğ
NAL_PIC_PARAM_SET
 ||

1119 
Çl
->
Çl_un™_ty³
 == 13 ||

1120 
Çl
->
Çl_un™_ty³
 == 14 ||

1121 
Çl
->
Çl_un™_ty³
 == 15 ||

1122 
Çl
->
Çl_un™_ty³
 == 16 ||

1123 
Çl
->
Çl_un™_ty³
 == 17 ||

1124 
Çl
->
Çl_un™_ty³
 == 18)

1134 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
Çl
);

1135 ià(
”r
è
give_up_ä“_Çl
;

1137 ià(
Çl
->
Çl_un™_ty³
 =ğ
NAL_END_OF_SEQ
)

1139 ià(
cÚ‹xt
->
³ndšg_li¡
->
Ëngth
 > 0)

1141 
	`´št_”r
("!!! Ignoring items‡fter†ast VCL NAL‡nd"

1143 
	`»pÜt_Çl_un™_li¡
(
FALSE
," ",
cÚ‹xt
->
³ndšg_li¡
);

1144 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
TRUE
);

1147 
cÚ‹xt
->
’d_of_£qu’û
 = 
Çl
;

1150 ià(
Çl
->
Çl_un™_ty³
 =ğ
NAL_END_OF_STREAM
)

1152 ià(
cÚ‹xt
->
³ndšg_li¡
->
Ëngth
 > 0)

1154 
	`´št_”r
("!!! Ignoring items‡fter†ast VCL NAL‡nd"

1156 
	`»pÜt_Çl_un™_li¡
(
FALSE
," ",
cÚ‹xt
->
³ndšg_li¡
);

1157 
	`»£t_Çl_un™_li¡
(
cÚ‹xt
->
³ndšg_li¡
,
TRUE
);

1160 
cÚ‹xt
->
’d_of_¡»am
 = 
Çl
;

1164 
cÚ‹xt
->
no_mÜe_d©a
 = 
TRUE
;

1173 
	`ä“_Çl_un™
(&
Çl
);

1180 ià(
cÚ‹xt
->
no_mÜe_d©a
 && 
acûss_un™
->
Çl_un™s
->
Ëngth
 == 0)

1182 
	`ä“_acûss_un™
(&
acûss_un™
);

1183 *
»t_acûss_un™
 = 
NULL
;

1184  
EOF
;

1188 
”r
 = 
	`’d_acûss_un™
(
cÚ‹xt
,
acûss_un™
,
show_d‘as
);

1189 ià(
”r
è
give_up
;

1192 
cÚ‹xt
->
acûss_un™_šdex
 ++;

1194 *
»t_acûss_un™
 = 
acûss_un™
;

1197 
give_up_ä“_Çl
:

1198 
	`ä“_Çl_un™
(&
Çl
);

1199 
give_up
:

1200 
	`ä“_acûss_un™
(&
acûss_un™
);

1202 
	}
}

1228 
	$g‘_Ãxt_nÚ_em±y_acûss_un™
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

1229 
qu›t
,

1230 
show_d‘as
,

1231 
acûss_un™_p
 *
acûss_un™
)

1235 
”r
 = 
	`g‘_Ãxt_acûss_un™
(
cÚ‹xt
,
qu›t
,
show_d‘as
,
acûss_un™
);

1236 ià(
”r
) ƒrr;

1238 ià((*
acûss_un™
)->
´im¬y_¡¬t
)

1241 
	}
}

1262 
	$g‘_Ãxt_f›ld_of_·œ
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

1263 
qu›t
,

1264 
show_d‘as
,

1265 
fœ¡_time
,

1266 
acûss_un™_p
 *
acûss_un™
)

1268 
”r
;

1269 
acûss_un™_p
 
£cÚd
;

1271 ià(
show_d‘as
 || 
cÚ‹xt
->
Çc
->
show_Çl_d‘as
)

1272 
	`åršt_msg
("@@ Looking for second field (%sime)\n",

1273 (
fœ¡_time
?"first":"second"));

1276 
”r
 = 
	`g‘_Ãxt_nÚ_em±y_acûss_un™
(
cÚ‹xt
,
qu›t
,
show_d‘as
,&
£cÚd
);

1277 ià(
”r
)

1279 ià(
”r
 !ğ
EOF
)

1280 
	`´št_”r
("### Tryingo„ead second field\n");

1281  
”r
;

1284 ià(
£cÚd
->
f›ld_pic_æag
 == 0)

1286 ià(!
qu›t
)

1287 
	`´št_”r
("!!! Field followed by‡ frame - ignoringhe field\n");

1288 
	`ä“_acûss_un™
(
acûss_un™
);

1289 *
acûss_un™
 = 
£cÚd
;

1292 ià((*
acûss_un™
)->
äame_num
 =ğ
£cÚd
->frame_num)

1295 ià(
show_d‘as
 || 
cÚ‹xt
->
Çc
->
show_Çl_d‘as
)

1296 
	`´št_msg
("@@ Mergingwo field‡ccess units\n");

1297 
”r
 = 
	`m”ge_acûss_un™_Çls
(*
acûss_un™
,&
£cÚd
);

1298 ià(
”r
)

1300 
	`ä“_acûss_un™
(&
£cÚd
);

1303 ià(
show_d‘as
)

1304 
	`»pÜt_acûss_un™
(*
acûss_un™
);

1306 ià(
fœ¡_time
)

1308 ià(!
qu›t
)

1309 
	`åršt_”r
("!!! Field with frame‚umber %d (%x) followed by"

1311 (*
acûss_un™
)->
äame_num
,(*access_unit)->frame_num,

1312 
£cÚd
->
äame_num
,second->frame_num);

1315 
	`ä“_acûss_un™
(
acûss_un™
);

1316 *
acûss_un™
 = 
£cÚd
;

1317 
”r
 = 
	`g‘_Ãxt_f›ld_of_·œ
(
cÚ‹xt
,
qu›t
,
show_d‘as
,
FALSE
,
acûss_un™
);

1318 ià(
”r
)  1;

1322 
	`´št_”r
("### Adjacent fields do‚ot share frame‚umbers"

1327 
	}
}

1373 
	$g‘_Ãxt_h264_äame
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

1374 
qu›t
,

1375 
show_d‘as
,

1376 
acûss_un™_p
 *
äame
)

1378 
”r
;

1379 
acûss_un™_p
 
acûss_un™
;

1381 *
äame
 = 
NULL
;

1383 
”r
 = 
	`g‘_Ãxt_nÚ_em±y_acûss_un™
(
cÚ‹xt
,
qu›t
,
show_d‘as
,

1384 &
acûss_un™
);

1385 ià(
”r
) ƒrr;

1387 ià(
acûss_un™
->
f›ld_pic_æag
 == 1)

1391 
”r
 = 
	`g‘_Ãxt_f›ld_of_·œ
(
cÚ‹xt
,
qu›t
,
show_d‘as
,
TRUE
,&
acûss_un™
);

1392 ià(
”r
)

1394 
	`ä“_acûss_un™
(&
acûss_un™
);

1399 ià(
cÚ‹xt
->
»v”£_d©a
)

1401 
”r
 = 
	`maybe_»memb”_acûss_un™
(
cÚ‹xt
->
»v”£_d©a
,
acûss_un™
,

1402 
show_d‘as
);

1403 ià(
”r
)

1405 
	`ä“_acûss_un™
(&
acûss_un™
);

1409 *
äame
 = 
acûss_un™
;

1411 
	}
}

1419 
	$acûss_un™_has_PTS
(
acûss_un™_p
 
acûss_un™
)

1422 
ii
;

1423 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

1425 ià(
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
]->
un™
.
PES_had_PTS
)

1426  
TRUE
;

1428  
FALSE
;

1429 
	}
}

	@accessunit_defns.h

29 #iâdeà
_acûssun™_deâs


30 
	#_acûssun™_deâs


	)

32 
	~"Çlun™_deâs.h
"

33 
	~"es_deâs.h
"

38 
acûss_un™_cÚ‹xt
 *
	tacûss_un™_cÚ‹xt_p
;

39 
	g»v”£_d©a
;

43 
	sacûss_un™


45 
ušt32_t
 
	mšdex
;

47 
	m¡¬‹d_´im¬y_piùu»
;

48 
Çl_un™_p
 
	m´im¬y_¡¬t
;

56 
Çl_un™_li¡_p
 
	mÇl_un™s
;

60 
	mignÜed_brok’_NAL_un™s
;

67 
ušt32_t
 
	mäame_num
;

68 
by‹
 
	mf›ld_pic_æag
;

69 
by‹
 
	mbÙtom_f›ld_æag
;

74 
acûss_un™
 *
	tacûss_un™_p
;

75 
	#SIZEOF_ACCESS_UNIT
 (
acûss_un™
)

	)

79 
	sacûss_un™_cÚ‹xt


84 
Çl_un™_cÚ‹xt_p
 
	mÇc
;

93 
Çl_un™_p
 
	m’d_of_£qu’û
;

94 
Çl_un™_p
 
	m’d_of_¡»am
;

102 
ušt32_t
 
	macûss_un™_šdex
;

106 
»v”£_d©a
 * 
	m»v”£_d©a
;

115 
Çl_un™_p
 
	m³ndšg_Çl
;

120 
Çl_un™_p
 
	m—¾›r_´im¬y_¡¬t
;

123 
Çl_un™_li¡_p
 
	m³ndšg_li¡
;

127 
by‹
 
	mno_mÜe_d©a
;

129 
	#SIZEOF_ACCESS_UNIT_CONTEXT
 (
acûss_un™_cÚ‹xt
)

	)

	@accessunit_fns.h

29 #iâdeà
_acûssun™_âs


30 
	#_acûssun™_âs


	)

32 
	~"acûssun™_deâs.h
"

39 
bud_acûss_un™_cÚ‹xt
(
ES_p
 
es
,

40 
acûss_un™_cÚ‹xt_p
 *
cÚ‹xt
);

51 
ä“_acûss_un™_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 *
cÚ‹xt
);

57 
»£t_acûss_un™_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
);

70 
»wšd_acûss_un™_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
);

79 
ä“_acûss_un™
(
acûss_un™_p
 *
acc_un™
);

84 
»pÜt_acûss_un™
(
acûss_un™_p
 
acûss_un™
);

97 
g‘_acûss_un™_bounds
(
acûss_un™_p
 
acûss_un™
,

98 
ES_off£t
 *
¡¬t
,

99 
ušt32_t
 *
Ëngth
);

104 
®l_¦iûs_I
(
acûss_un™_p
 
acûss_un™
);

109 
®l_¦iûs_P
(
acûss_un™_p
 
acûss_un™
);

114 
®l_¦iûs_I_Ü_P
(
acûss_un™_p
 
acûss_un™
);

119 
®l_¦iûs_B
(
acûss_un™_p
 
acûss_un™
);

135 
wr™e_acûss_un™_as_ES
(
acûss_un™_p
 
acûss_un™
,

136 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

137 
FILE
 *
ouut
);

153 
wr™e_acûss_un™_as_TS
(
acûss_un™_p
 
acûss_un™
,

154 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

155 
TS_wr™”_p
 
tswr™”
,

156 
ušt32_t
 
video_pid
);

174 
wr™e_acûss_un™_as_TS_w™h_±s_dts
(
acûss_un™_p
 
acûss_un™
,

175 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

176 
TS_wr™”_p
 
tswr™”
,

177 
ušt32_t
 
video_pid
,

178 
gÙ_±s
,

179 
ušt64_t
 
±s
,

180 
gÙ_dts
,

181 
ušt64_t
 
dts
);

199 
wr™e_acûss_un™_as_TS_w™h_PCR
(
acûss_un™_p
 
acûss_un™
,

200 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

201 
TS_wr™”_p
 
tswr™”
,

202 
ušt32_t
 
video_pid
,

203 
ušt64_t
 
pü_ba£
,

204 
ušt32_t
 
pü_exŠ
);

237 
g‘_Ãxt_acûss_un™
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

238 
qu›t
,

239 
show_d‘as
,

240 
acûss_un™_p
 *
»t_acûss_un™
);

285 
g‘_Ãxt_h264_äame
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

286 
qu›t
,

287 
show_d‘as
,

288 
acûss_un™_p
 *
äame
);

295 
acûss_un™_has_PTS
(
acûss_un™_p
 
acûss_un™
);

	@adts.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

34 
	~"com·t.h
"

35 
	~"´štšg_âs.h
"

36 
	~"misc_âs.h
"

37 
	~"adts_âs.h
"

39 
	#DEBUG
 0

	)

55 
	$»ad_Ãxt_adts_äame
(
fe
,

56 
audio_äame_p
 *
äame
,

57 
æags
)

59 
	#JUST_ENOUGH
 6

60 

	)

61 
”r
, 
ii
;

62 
id
, 
Ïy”
;

63 
by‹
 
h—d”
[
JUST_ENOUGH
];

64 
by‹
 *
d©a
 = 
NULL
;

65 
äame_Ëngth
;

66 
has_emphasis
 = 0;

68 
off£t_t
 
po¢
 = 
	`‹Î_fe
(
fe
);

69 #ià
DEBUG


70 
	`åršt_msg
("Off£t: " 
OFFSET_T_FORMAT
 "\n",
po¢
);

73 
”r
 = 
	`»ad_by‹s
(
fe
,
JUST_ENOUGH
,
h—d”
);

74 ià(
”r
 =ğ
EOF
)

75  
EOF
;

76 ià(
”r
)

78 
	`åršt_”r
("### Error„eading header bytes of ADTS frame\n"

79 " (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n",
po¢
);

80 
	`ä“
(
d©a
);

84 #ià
DEBUG


85 
	`´št_msg
("ADTS frame\n");

86 
	`´št_d©a
(
TRUE
,"S¹",
h—d”
,
JUST_ENOUGH
,JUST_ENOUGH);

89 ià(
h—d”
[0] != 0xFF || (header[1] & 0xF0) != 0xF0)

91 
	`åršt_”r
("### ADTS frame does‚ot start with '1111 1111 1111'"

94 ()(
h—d”
[0] & 0xF0) >> 4,

95 (
h—d”
[0] & 0x0F),

96 ()(
h—d”
[1] & 0xF0) >> 4);

97 
	`åršt_”r
(" (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n",
po¢
);

101 
id
 = (
h—d”
[1] & 0x08) >> 3;

102 #ià
DEBUG


103 
	`åršt_msg
(" ID %d (%s)\n",
id
,(id==1?"MPEG-2 AAC":"MPEG-4"));

105 
Ïy”
 = (
h—d”
[1] & 0x06) >> 1;

106 ià(
Ïy”
 != 0)

107 
	`åršt_msg
("†ay” i %d,‚Ù 0 (š f¿m© " 
OFFSET_T_FORMAT
 ")\n",

108 
Ïy”
,
po¢
);

115 
has_emphasis
 = (
æags
 & 
ADTS_FLAG_NO_EMPHASIS
) ? 0 :

116 ((
æags
 & 
ADTS_FLAG_FORCE_EMPHASIS
è|| !
id
);

118 ià(!
has_emphasis
)

120 
äame_Ëngth
 = ((
h—d”
[3] & 0x03) << 11) | (header[4] << 3) |

121 (()(
h—d”
[5] & 0xE0) >> 5);

125 
äame_Ëngth
 = (
h—d”
[4] << 5) | (()(header[5] & 0xF8) >> 3);

127 #ià
DEBUG


128 
	`åršt_msg
("†’gth %d\n",
äame_Ëngth
);

131 
d©a
 = 
	`m®loc
(
äame_Ëngth
);

132 ià(
d©a
 =ğ
NULL
)

134 
	`´št_”r
("### Unableoƒxtend data buffer for ADTS frame\n");

135 
	`ä“
(
d©a
);

139 
ii
=0; ii<
JUST_ENOUGH
; ii++)

140 
d©a
[
ii
] = 
h—d”
[ii];

142 
”r
 = 
	`»ad_by‹s
(
fe
,
äame_Ëngth
 - 
JUST_ENOUGH
,&(
d©a
[JUST_ENOUGH]));

143 ià(
”r
)

145 ià(
”r
 =ğ
EOF
)

146 
	`´št_”r
("### Unexpected EOF„eading„est of ADTS frame\n");

148 
	`´št_”r
("### Error„eading„est of ADTS frame\n");

149 
	`ä“
(
d©a
);

152 #ià
DEBUG


153 
	`´št_d©a
(
TRUE
,"Agaš",
d©a
,
äame_Ëngth
,20);

156 
”r
 = 
	`bud_audio_äame
(
äame
);

157 ià(
”r
)

159 
	`ä“
(
d©a
);

162 (*
äame
)->
d©a
 = data;

163 (*
äame
)->
d©a_Ën
 = 
äame_Ëngth
;

166 
	}
}

	@adts_defns.h

29 #iâdeà
_adts_deâs


30 
	#_adts_deâs


	)

32 
	~"audio_deâs.h
"

41 
	#ADTS_FLAG_NO_EMPHASIS
 (1<<0)

	)

44 
	#ADTS_FLAG_FORCE_EMPHASIS
 (1<<1)

	)

	@adts_fns.h

29 #iâdeà
_adts_âs


30 
	#_adts_âs


	)

32 
	~"adts_deâs.h
"

33 
	~"audio_âs.h
"

42 
	#ADTS_FLAG_NO_EMPHASIS
 (1<<0)

	)

48 
	#ADTS_FLAG_FORCE_EMPHASIS
 (1<<1)

	)

65 
»ad_Ãxt_adts_äame
(
fe
,

66 
audio_äame_p
 *
äame
,

67 
æags
);

	@audio.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

34 
	~"com·t.h
"

35 
	~"´štšg_âs.h
"

36 
	~"audio_âs.h
"

37 
	~"adts_âs.h
"

38 
	~"l2audio_âs.h
"

39 
	~"ac3_âs.h
"

46 
	$bud_audio_äame
(
audio_äame_p
 *
äame
)

48 
audio_äame_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_AUDIO_FRAME
);

49 ià(
Ãw
 =ğ
NULL
)

51 
	`åršt_”r
("### Unableo‡llocate‡udio frame datastructure\n");

55 
Ãw
->
d©a
 = 
NULL
;

56 
Ãw
->
d©a_Ën
 = 0;

58 *
äame
 = 
Ãw
;

60 
	}
}

69 
	$ä“_audio_äame
(
audio_äame_p
 *
äame
)

71 ià(*
äame
 =ğ
NULL
)

74 ià((*
äame
)->
d©a
 !ğ
NULL
)

76 
	`ä“
((*
äame
)->
d©a
);

77 (*
äame
)->
d©a
 = 
NULL
;

79 (*
äame
)->
d©a_Ën
 = 0;

81 
	`ä“
(*
äame
);

82 *
äame
 = 
NULL
;

83 
	}
}

97 
	$»ad_Ãxt_audio_äame
(
fe
,

98 
audio_ty³
,

99 
audio_äame_p
 *
äame
)

101 
audio_ty³
)

103 
AUDIO_ADTS_MPEG2
:

104  
	`»ad_Ãxt_adts_äame
(
fe
,
äame
,
ADTS_FLAG_NO_EMPHASIS
);

105 
AUDIO_ADTS_MPEG4
:

106  
	`»ad_Ãxt_adts_äame
(
fe
,
äame
,
ADTS_FLAG_FORCE_EMPHASIS
);

107 
AUDIO_ADTS
:

108  
	`»ad_Ãxt_adts_äame
(
fe
,
äame
,0);

109 
AUDIO_L2
:

110  
	`»ad_Ãxt_l2audio_äame
(
fe
,
äame
);

111 
AUDIO_AC3
:

112  
	`»ad_Ãxt_ac3_äame
(
fe
, 
äame
);

114 
	`åršt_”r
("### Unrecognised‡udioype %d - cannot get‚ext‡udio frame\n",

115 
audio_ty³
);

118 
	}
}

	@audio_defns.h

29 #iâdeà
_audio_deâs


30 
	#_audio_deâs


	)

32 
	~"h222_deâs.h
"

35 
	saudio_äame


37 
by‹
 *
	md©a
;

38 
ušt32_t
 
	md©a_Ën
;

40 
audio_äame
 *
	taudio_äame_p
;

41 
	#SIZEOF_AUDIO_FRAME
 (
audio_äame
)

	)

45 
	#AUDIO_UNKNOWN
 0

46 
	#AUDIO_ADTS
 
ADTS_AUDIO_STREAM_TYPE


	)

47 
	#AUDIO_L2
 
MPEG2_AUDIO_STREAM_TYPE


	)

48 
	#AUDIO_AC3
 
ATSC_DOLBY_AUDIO_STREAM_TYPE


	)

50 
	#AUDIO_ADTS_MPEG2
 0x100

	)

51 
	#AUDIO_ADTS_MPEG4
 0x101

	)

53 
	#AUDIO_STR
(
x
è((x)==
AUDIO_UNKNOWN
 ?"unknown": \

54 (
x
)==
AUDIO_ADTS
 ?"ADTS": \

55 (
x
)==
AUDIO_ADTS_MPEG2
?"ADTS-MPEG2": \

56 (
x
)==
AUDIO_ADTS_MPEG4
?"ADTS-MPEG4": \

57 (
x
)==
AUDIO_L2
 ?"MPEG2": \

58 (
x
)==
AUDIO_AC3
 ?"ATSC-AC3": \

59 "???")

	)

	@audio_fns.h

29 #iâdeà
_audio_âs


30 
	#_audio_âs


	)

32 
	~"audio_deâs.h
"

39 
bud_audio_äame
(
audio_äame_p
 *
äame
);

48 
ä“_audio_äame
(
audio_äame_p
 *
äame
);

62 
»ad_Ãxt_audio_äame
(
fe
,

63 
audio_ty³
,

64 
audio_äame_p
 *
äame
);

	@avs.c

35 
	~<¡dio.h
>

36 
	~<¡dlib.h
>

37 
	~<”ºo.h
>

38 
	~<¡ršg.h
>

40 
	~"com·t.h
"

41 
	~"´štšg_âs.h
"

42 
	~"avs_âs.h
"

43 
	~"es_âs.h
"

44 
	~"ts_âs.h
"

45 
	~"»v”£_âs.h
"

46 
	~"misc_âs.h
"

48 
	#DEBUG
 0

	)

49 
	#DEBUG_GET_NEXT_PICTURE
 0

	)

55 cÚ¡ *
	$avs_¡¬t_code_¡r
(
by‹
 
¡¬t_code
)

57 ià(
¡¬t_code
 < 0xB0)  "Slice";

58 
¡¬t_code
)

71 
	}
}

85 
	$bud_avs_cÚ‹xt
(
ES_p
 
es
,

86 
avs_cÚ‹xt_p
 *
cÚ‹xt
)

88 
avs_cÚ‹xt_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_AVS_CONTEXT
);

89 ià(
Ãw
 =ğ
NULL
)

91 
	`´št_”r
("### Unableo‡llocate AVS context datastructure\n");

95 
Ãw
->
es
 =ƒs;

96 
Ãw
->
äame_šdex
 = 0;

97 
Ãw
->
Ï¡_™em
 = 
NULL
;

98 
Ãw
->
»v”£_d©a
 = 
NULL
;

99 
Ãw
->
couÁ_sšû_£q_hdr
 = 0;

101 *
cÚ‹xt
 = 
Ãw
;

103 
	}
}

114 
	$ä“_avs_cÚ‹xt
(
avs_cÚ‹xt_p
 *
cÚ‹xt
)

116 
avs_cÚ‹xt_p
 
cc
 = *
cÚ‹xt
;

118 ià(
cc
 =ğ
NULL
)

121 ià(
cc
->
Ï¡_™em
 !ğ
NULL
)

122 
	`ä“_ES_un™
(&
cc
->
Ï¡_™em
);

124 
cc
->
»v”£_d©a
 = 
NULL
;

126 
	`ä“
(*
cÚ‹xt
);

127 *
cÚ‹xt
 = 
NULL
;

129 
	}
}

142 
	$»wšd_avs_cÚ‹xt
(
avs_cÚ‹xt_p
 
cÚ‹xt
)

144 
ES_off£t
 
¡¬t_of_fe
 = {0,0};

147 ià(
cÚ‹xt
->
Ï¡_™em
)

149 
	`ä“_ES_un™
(&
cÚ‹xt
->
Ï¡_™em
);

150 
cÚ‹xt
->
Ï¡_™em
 = 
NULL
;

153 
cÚ‹xt
->
äame_šdex
 = 0;

156 ià(
cÚ‹xt
->
»v”£_d©a
)

158 
cÚ‹xt
->
»v”£_d©a
->
Ï¡_po¢_added
 = -1;

159 
cÚ‹xt
->
couÁ_sšû_£q_hdr
 = 0;

163  
	`£ek_ES
(
cÚ‹xt
->
es
,
¡¬t_of_fe
);

164 
	}
}

177 
	$­³nd_to_avs_äame
(
avs_äame_p
 
äame
,

178 
ES_un™_p
 
un™
)

180  
	`­³nd_to_ES_un™_li¡
(
äame
->
li¡
,
un™
);

181 
	}
}

191 
	$avs_piùu»_codšg_ty³
(
ES_un™_p
 
un™
)

193 ià(
un™
->
¡¬t_code
 == 0xB3)

194  
AVS_I_PICTURE_CODING
;

195 ià(
un™
->
¡¬t_code
 == 0xB6)

197 
by‹
 
piùu»_codšg_ty³
 = (
un™
->
d©a
[6] & 0xC0) >> 6;

198 ià(
piùu»_codšg_ty³
 =ğ
AVS_P_PICTURE_CODING
 ||

199 
piùu»_codšg_ty³
 =ğ
AVS_B_PICTURE_CODING
)

200  
piùu»_codšg_ty³
;

203 
	`åršt_”r
("AVS Picture codingype %d (in %02x)\n",

204 
piùu»_codšg_ty³
,
un™
->
d©a
[3]);

210 
	`åršt_”r
("AVS 'frame' with start code %02x does‚ot have…icture codingype\n",

211 
un™
->
d©a
[0]);

214 
	}
}

222 
	$bud_avs_äame
(
avs_cÚ‹xt_p
 
cÚ‹xt
,

223 
avs_äame_p
 *
äame
,

224 
ES_un™_p
 
un™
)

226 
”r
;

227 
by‹
 *
d©a
 = 
un™
->data;

228 
avs_äame_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_AVS_FRAME
);

229 ià(
Ãw
 =ğ
NULL
)

231 
	`´št_”r
("### Unableo‡llocate AVS frame datastructure\n");

235 
”r
 = 
	`bud_ES_un™_li¡
(&(
Ãw
->
li¡
));

236 ià(
”r
)

238 
	`´št_”r
("### Unableo‡llocate internal†ist for AVS frame\n");

239 
	`ä“
(
Ãw
);

244 
Ãw
->
¡¬t_code
 = 
un™
->start_code;

245 ià(
	`is_avs_äame_™em
(
un™
))

247 
Ãw
->
piùu»_codšg_ty³
 = 
	`avs_piùu»_codšg_ty³
(
un™
);

248 
Ãw
->
is_äame
 = 
TRUE
;

249 
Ãw
->
is_£qu’û_h—d”
 = 
FALSE
;

250 ià(
Ãw
->
piùu»_codšg_ty³
 !ğ
AVS_I_PICTURE_CODING
)

251 
Ãw
->
piùu»_di¡ªû
 = (
d©a
[6] << 2) | ((data[7] & 0xC0) >> 6);

255 
Ãw
->
piùu»_di¡ªû
 = 0;

257 ià(
	`is_avs_£q_h—d”_™em
(
un™
))

259 
Ãw
->
is_äame
 = 
FALSE
;

260 
Ãw
->
is_£qu’û_h—d”
 = 
TRUE
;

261 
Ãw
->
piùu»_codšg_ty³
 = 0xFF;

262 
Ãw
->
a¥eù_¿tio
 = (
d©a
[10] & 0x3C) >> 2;

263 
Ãw
->
äame_¿‹_code
 = ((
d©a
[10] & 0x03) << 2) | ((data[11] & 0xC0) >> 4);

264 #ià
DEBUG


265 
	`åršt_msg
("a¥eù_¿tio=%d, f¿me_¿‹_code=%d (%.2f)\n",
Ãw
->
a¥eù_¿tio
,

266 
Ãw
->
äame_¿‹_code
,
	`avs_äame_¿‹
(new->frame_rate_code));

269 ià(
	`is_avs_£q_’d_™em
(
un™
))

271 
Ãw
->
is_äame
 = 
FALSE
;

272 
Ãw
->
is_£qu’û_h—d”
 = 
FALSE
;

273 
Ãw
->
piùu»_codšg_ty³
 = 0xFF;

277 
	`åršt_”r
("!!! Building AVS framehat starts with‡ %s (%02x)\n",

278 
	`avs_¡¬t_code_¡r
(
un™
->
¡¬t_code
),unit->start_code);

279 
Ãw
->
is_äame
 = 
FALSE
;

280 
Ãw
->
is_£qu’û_h—d”
 = 
FALSE
;

281 
Ãw
->
piùu»_codšg_ty³
 = 0xFF;

284 
”r
 = 
	`­³nd_to_avs_äame
(
Ãw
,
un™
);

285 ià(
”r
)

287 
	`åršt_”r
("### Error‡ppending first ES unito AVS %s\n",

288 
	`avs_¡¬t_code_¡r
(
un™
->
¡¬t_code
));

289 
	`ä“_avs_äame
(&
Ãw
);

293 *
äame
 = 
Ãw
;

295 
	}
}

304 
	$ä“_avs_äame
(
avs_äame_p
 *
äame
)

306 
avs_äame_p
 
pic
 = *
äame
;

308 ià(
pic
 =ğ
NULL
)

311 ià(
pic
->
li¡
 !ğ
NULL
)

312 
	`ä“_ES_un™_li¡
(&
pic
->
li¡
);

314 
	`ä“
(*
äame
);

315 *
äame
 = 
NULL
;

317 
	}
}

319 #ià
DEBUG_GET_NEXT_PICTURE


323 
	$_show_™em
(
ES_un™_p
 
un™
)

325 
	`´št_msg
("__ ");

326 ià(
un™
 =ğ
NULL
)

328 
	`´št_msg
("<no ES unit>\n");

331 ià(
	`is_avs_äame_™em
(
un™
))

332 
	`åršt_msg
("% äame",
	`AVS_PICTURE_CODING_STR
(
	`avs_piùu»_codšg_ty³
(
un™
)));

334 
	`åršt_msg
("%s",
	`avs_¡¬t_code_¡r
(
un™
->
¡¬t_code
));

335 
	`åršt_msg
("‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

336 
un™
->
¡¬t_po¢
.
šfe
,un™->¡¬t_po¢.
š·ck‘
,un™->
d©a_Ën
);

337 
	}
}

358 
	$g‘_Ãxt_avs_sšgË_äame
(
avs_cÚ‹xt_p
 
cÚ‹xt
,

359 
v”bo£
,

360 
avs_äame_p
 *
äame
)

362 
”r
 = 0;

364 
š_£qu’û_h—d”
 = 
FALSE
;

365 
š_£qu’û_’d
 = 
FALSE
;

366 
š_äame
 = 
FALSE
;

367 
Ï¡_was_¦iû
 = 
FALSE
;

369 
ES_un™_p
 
™em
 = 
cÚ‹xt
->
Ï¡_™em
;

371 #ià
DEBUG_GET_NEXT_PICTURE


372 
num_¦iûs
 = 0;

373 
had_¦iû
 = 
FALSE
;

374 
Ï¡_¦iû_¡¬t_code
 = 0;

375 ià(
v”bo£
 && 
cÚ‹xt
->
Ï¡_™em
è
	`´št_msg
("__„euse†ast item\n");

378 
cÚ‹xt
->
Ï¡_™em
 = 
NULL
;

383 ià(
™em
 =ğ
NULL
)

385 
”r
 = 
	`fšd_ªd_bud_Ãxt_ES_un™
(
cÚ‹xt
->
es
,&
™em
);

386 ià(
”r
) ƒrr;

388 ià(
	`is_avs_äame_™em
(
™em
))

390 
š_äame
 = 
TRUE
;

393 ià(
	`is_avs_£q_h—d”_™em
(
™em
))

395 
š_£qu’û_h—d”
 = 
TRUE
;

398 ià(
	`is_avs_£q_’d_™em
(
™em
))

400 
š_£qu’û_’d
 = 
TRUE
;

403 #ià
DEBUG_GET_NEXT_PICTURE


404 ià(
v”bo£
)

405 
	`_show_™em
(
™em
);

407 
	`ä“_ES_un™
(&
™em
);

410 #ià
DEBUG_GET_NEXT_PICTURE


411 ià(
v”bo£
)

413 
	`´št_msg
("__ --------------------------------- <start frame>\n");

414 
	`_show_™em
(
™em
);

418 
”r
 = 
	`bud_avs_äame
(
cÚ‹xt
,
äame
,
™em
);

419 ià(
”r
)  1;

421 
	`ä“_ES_un™
(&
™em
);

423 ià(
š_£qu’û_’d
)

426 #ià
DEBUG_GET_NEXT_PICTURE


427 ià(
v”bo£
)

428 
	`´št_msg
("__ --------------------------------- <end frame>\n");

436 
”r
 = 
	`fšd_ªd_bud_Ãxt_ES_un™
(
cÚ‹xt
->
es
,&
™em
);

437 ià(
”r
)

439 ià(
”r
 !ğ
EOF
)

440 
	`ä“_avs_äame
(
äame
);

441  
”r
;

444 ià(
š_äame
)

448 ià(
Ï¡_was_¦iû
 && !
	`is_avs_¦iû_™em
(
™em
))

450 
Ï¡_was_¦iû
 = 
	`is_avs_¦iû_™em
(
™em
);

452 ià(
š_£qu’û_h—d”
)

459 ià(!
	`is_avs_ex‹nsiÚ_¡¬t_™em
(
™em
) &&

460 !
	`is_avs_u£r_d©a_™em
(
™em
))

464 #ià
DEBUG_GET_NEXT_PICTURE


465 ià(
v”bo£
)

467 ià(!
had_¦iû
)

468 
	`_show_™em
(
™em
);

469 ià(
	`is_avs_¦iû_™em
(
™em
))

471 
num_¦iûs
 ++;

472 
Ï¡_¦iû_¡¬t_code
 = 
™em
->
¡¬t_code
;

473 ià(!
had_¦iû
)

474 
had_¦iû
 = 
TRUE
;

480 
”r
 = 
	`­³nd_to_avs_äame
(*
äame
,
™em
);

481 ià(
”r
)

483 
	`´št_”r
("### Error‡dding itemo AVS sequence header\n");

484 
	`ä“_avs_äame
(
äame
);

487 
	`ä“_ES_un™
(&
™em
);

490 ià(
š_äame
)

491 
cÚ‹xt
->
äame_šdex
 ++;

493 
cÚ‹xt
->
Ï¡_™em
 = 
™em
;

494 #ià
DEBUG_GET_NEXT_PICTURE


495 ià(
v”bo£
)

497 ià(
š_äame
)

499 ià(
num_¦iûs
 > 1)

501 
ES_un™_p
 
un™
 = &(*
äame
)->
li¡
->
¬¿y
[(*äame)->li¡->
Ëngth
-1];

502 
	`´št_msg
("__ ...\n");

503 
	`åršt_msg
("__ sliû %2x",
Ï¡_¦iû_¡¬t_code
);

504 
	`åršt_msg
("‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

505 
un™
->
¡¬t_po¢
.
šfe
,un™->¡¬t_po¢.
š·ck‘
,

506 
un™
->
d©a_Ën
);

508 
	`åršt_msg
("__ (%2d sliûs)\n",
num_¦iûs
);

510 
	`´št_msg
("__ --------------------------------- <end frame>\n");

511 ià(
š_äame
 || 
š_£qu’û_h—d”
)

512 
	`_show_™em
(
™em
);

516 
	}
}

544 
	$g‘_Ãxt_avs_äame
(
avs_cÚ‹xt_p
 
cÚ‹xt
,

545 
v”bo£
,

546 
qu›t
,

547 
avs_äame_p
 *
äame
)

549 
”r
;

551 
”r
 = 
	`g‘_Ãxt_avs_sšgË_äame
(
cÚ‹xt
,
v”bo£
,
äame
);

552 ià(
”r
) ƒrr;

555 ià(
cÚ‹xt
->
»v”£_d©a
)

557 
”r
 = 
	`maybe_»memb”_this_äame
(
cÚ‹xt
,
v”bo£
,*
äame
);

558 ià(
”r
)

560 
	`ä“_avs_äame
(
äame
);

567 
	}
}

578 
	$wr™e_avs_äame_as_TS
(
TS_wr™”_p
 
tswr™”
,

579 
avs_äame_p
 
äame
,

580 
ušt32_t
 
pid
)

582 
ii
;

583 
ES_un™_li¡_p
 
li¡
;

585 ià(
äame
 =ğ
NULL
 || f¿me->
li¡
 == NULL)

588 
li¡
 = 
äame
->list;

590 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

592 
”r
;

593 
ES_un™_p
 
un™
 = &(
li¡
->
¬¿y
[
ii
]);

595 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,
un™
->
d©a
,un™->
d©a_Ën
,
pid
,

596 
DEFAULT_VIDEO_STREAM_ID
);

597 ià(
”r
)

599 
	`´št_”r
("### Error writing out frame†isto TS\n");

600  
”r
;

604 
	}
}

623 
	$wr™e_avs_äame_as_TS_w™h_±s_dts
(
avs_äame_p
 
äame
,

624 
TS_wr™”_p
 
tswr™”
,

625 
ušt32_t
 
video_pid
,

626 
gÙ_±s
,

627 
ušt64_t
 
±s
,

628 
gÙ_dts
,

629 
ušt64_t
 
dts
)

631 
ii
;

632 
ES_un™_li¡_p
 
li¡
;

634 ià(
äame
 =ğ
NULL
 || f¿me->
li¡
 == NULL)

637 
li¡
 = 
äame
->list;

639 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

641 
”r
;

642 
ES_un™_p
 
un™
 = &(
li¡
->
¬¿y
[
ii
]);

645 ià(
ii
 == 0)

646 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘_w™h_±s_dts
(
tswr™”
,

647 
un™
->
d©a
,

648 
un™
->
d©a_Ën
,

649 
video_pid
,

650 
DEFAULT_VIDEO_STREAM_ID
,

651 
gÙ_±s
,
±s
,

652 
gÙ_dts
,
dts
);

654 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,

655 
un™
->
d©a
,un™->
d©a_Ën
,

656 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

657 ià(
”r
)

659 
	`´št_”r
("### Error writing out frame†isto TS\n");

660  
”r
;

664 
	}
}

677 
	$wr™e_avs_äame_as_TS_w™h_PCR
(
avs_äame_p
 
äame
,

678 
TS_wr™”_p
 
tswr™”
,

679 
ušt32_t
 
video_pid
,

680 
ušt64_t
 
pü_ba£
,

681 
ušt32_t
 
pü_exŠ
)

683 
ii
;

684 
ES_un™_li¡_p
 
li¡
;

686 ià(
äame
 =ğ
NULL
 || f¿me->
li¡
 == NULL)

689 
li¡
 = 
äame
->list;

691 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

693 
”r
;

694 
ES_un™_p
 
un™
 = &(
li¡
->
¬¿y
[
ii
]);

697 ià(
ii
 == 0)

698 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘_w™h_pü
(
tswr™”
,

699 
un™
->
d©a
,

700 
un™
->
d©a_Ën
,

701 
video_pid
,

702 
DEFAULT_VIDEO_STREAM_ID
,

703 
pü_ba£
,
pü_exŠ
);

705 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,

706 
un™
->
d©a
,un™->
d©a_Ën
,

707 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

708 ià(
”r
)

710 
	`´št_”r
("### Error writing out frame†isto TS\n");

711  
”r
;

715 
	}
}

725 
	$wr™e_avs_äame_as_ES
(
FILE
 *
ouut
,

726 
avs_äame_p
 
äame
)

728 
ii
;

729 
ES_un™_li¡_p
 
li¡
;

731 ià(
äame
 =ğ
NULL
 || f¿me->
li¡
 == NULL)

734 
li¡
 = 
äame
->list;

736 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

738 
”r
;

739 
ES_un™_p
 
un™
 = &(
li¡
->
¬¿y
[
ii
]);

740 
”r
 = 
	`wr™e_ES_un™
(
ouut
,
un™
);

741 ià(
”r
)

743 
	`´št_”r
("### Error writing out frame†isto ES\n");

744  
”r
;

748 
	}
}

757 
	$»pÜt_avs_äame
(
avs_äame_p
 
äame
,

758 
»pÜt_d©a
)

760 ià(
äame
->
is_äame
)

762 
	`åršt_msg
("%s #%02d",

763 
	`AVS_PICTURE_CODING_STR
(
äame
->
piùu»_codšg_ty³
),

764 
äame
->
piùu»_di¡ªû
);

765 
	`´št_msg
("\n");

767 ià(
äame
->
is_£qu’û_h—d”
)

769 
	`´št_msg
("Sequence header: ");

770 
	`åršt_msg
(" frame„ate %d (%.2f),‡spect„atio %d (%s)",

771 
äame
->
äame_¿‹_code
,

772 
	`avs_äame_¿‹
(
äame
->
äame_¿‹_code
),

773 
äame
->
a¥eù_¿tio
,

774 (
äame
->
a¥eù_¿tio
==1?"SAR: 1.0":

775 
äame
->
a¥eù_¿tio
==2?"4/3":

776 
äame
->
a¥eù_¿tio
==3?"16/9":

777 
äame
->
a¥eù_¿tio
==4?"2.21/1":"???"));

778 
	`´št_msg
("\n");

782 
	`´št_msg
("Sequenceƒnd\n");

784 ià(
»pÜt_d©a
)

785 
	`»pÜt_ES_un™_li¡
("ES un™s",
äame
->
li¡
);

786 
	}
}

	@avs_defns.h

29 #iâdeà
_avs_deâs


30 
	#_avs_deâs


	)

32 
	~<¡dio.h
>

33 
	~"com·t.h
"

34 
	~"es_deâs.h
"

35 
	~"ts_deâs.h
"

40 
avs_cÚ‹xt
 *
	tavs_cÚ‹xt_p
;

41 
	~"»v”£_deâs.h
"

46 
	s_avs_äame


49 
ES_un™_li¡_p
 
	mli¡
;

54 
	mis_äame
;

55 
	mis_£qu’û_h—d”
;

58 
	m¡¬t_code
;

61 
by‹
 
	mpiùu»_codšg_ty³
;

62 
by‹
 
	mpiùu»_di¡ªû
;

65 
by‹
 
	ma¥eù_¿tio
;

66 
by‹
 
	mäame_¿‹_code
;

68 
_avs_äame
 *
	tavs_äame_p
;

69 
	#SIZEOF_AVS_FRAME
 (
_avs_äame
)

	)

72 
	#is_avs_¦iû_™em
(
un™
è((un™)->
¡¬t_code
<0xB0)

	)

73 
	#is_avs_äame_™em
(
un™
è((un™)->
¡¬t_code
==0xB3 || \

74 (
un™
)->
¡¬t_code
==0xB6)

	)

75 
	#is_avs_u£r_d©a_™em
(
un™
è((un™)->
¡¬t_code
==0xB2)

	)

76 
	#is_avs_£q_h—d”_™em
(
un™
è((un™)->
¡¬t_code
==0xB0)

	)

77 
	#is_avs_£q_’d_™em
(
un™
è((un™)->
¡¬t_code
==0xB1)

	)

78 
	#is_avs_ex‹nsiÚ_¡¬t_™em
(
un™
è((un™)->
¡¬t_code
==0xB5)

	)

79 
	#is_avs_video_ed™_™em
(
un™
è((un™)->
¡¬t_code
==0xB7)

	)

81 
	#avs_äame_¿‹
(
code
) ((code)==1?24000.0/1001: \

82 (
code
)==2?24: \

83 (
code
)==3?25: \

84 (
code
)==4?30000.0/1001: \

85 (
code
)==5?30: \

86 (
code
)==6?50: \

87 (
code
)==7?60000.0/1001: \

88 (
code
)==8?60: \

89 25è

	)

91 
	#AVS_I_PICTURE_CODING
 0

92 
	#AVS_P_PICTURE_CODING
 1

	)

93 
	#AVS_B_PICTURE_CODING
 2

	)

96 
	#AVS_PICTURE_CODING_STR
(
s
) \

97 ((
s
)==
AVS_I_PICTURE_CODING
?"I": \

98 (
s
)==
AVS_P_PICTURE_CODING
?"P": \

99 (
s
)==
AVS_B_PICTURE_CODING
?"B": \

100 "Re£rved")

	)

105 
	savs_cÚ‹xt


107 
ES_p
 
	mes
;

116 
ušt32_t
 
	mäame_šdex
;

121 
ES_un™_p
 
	mÏ¡_™em
;

125 
»v”£_d©a_p
 
	m»v”£_d©a
;

128 
by‹
 
	mcouÁ_sšû_£q_hdr
;

130 
	#SIZEOF_AVS_CONTEXT
 (
avs_cÚ‹xt
)

	)

	@avs_fns.h

29 #iâdeà
_avs_âs


30 
	#_avs_âs


	)

32 
	~"avs_deâs.h
"

37 cÚ¡ *
avs_¡¬t_code_¡r
(
by‹
 
¡¬t_code
);

46 
avs_piùu»_codšg_ty³
(
ES_un™_p
 
un™
);

56 
bud_avs_cÚ‹xt
(
ES_p
 
es
,

57 
avs_cÚ‹xt_p
 *
cÚ‹xt
);

67 
ä“_avs_cÚ‹xt
(
avs_cÚ‹xt_p
 *
cÚ‹xt
);

79 
»wšd_avs_cÚ‹xt
(
avs_cÚ‹xt_p
 
cÚ‹xt
);

87 
ä“_avs_äame
(
avs_äame_p
 *
äame
);

114 
g‘_Ãxt_avs_äame
(
avs_cÚ‹xt_p
 
cÚ‹xt
,

115 
v”bo£
,

116 
qu›t
,

117 
avs_äame_p
 *
äame
);

127 
wr™e_avs_äame_as_TS
(
TS_wr™”_p
 
tswr™”
,

128 
avs_äame_p
 
äame
,

129 
ušt32_t
 
pid
);

147 
wr™e_avs_äame_as_TS_w™h_±s_dts
(
avs_äame_p
 
äame
,

148 
TS_wr™”_p
 
tswr™”
,

149 
ušt32_t
 
video_pid
,

150 
gÙ_±s
,

151 
ušt64_t
 
±s
,

152 
gÙ_dts
,

153 
ušt64_t
 
dts
);

165 
wr™e_avs_äame_as_TS_w™h_PCR
(
avs_äame_p
 
äame
,

166 
TS_wr™”_p
 
tswr™”
,

167 
ušt32_t
 
video_pid
,

168 
ušt64_t
 
pü_ba£
,

169 
ušt32_t
 
pü_exŠ
);

178 
wr™e_avs_äame_as_ES
(
FILE
 *
ouut
,

179 
avs_äame_p
 
äame
);

186 
»pÜt_avs_äame
(
avs_äame_p
 
äame
,

187 
»pÜt_d©a
);

	@bitdata.c

32 
	~<¡dio.h
>

33 
	~<¡dlib.h
>

34 
	~<m©h.h
>

35 
	~<as£¹.h
>

37 
	~"com·t.h
"

38 
	~"b™d©a_âs.h
"

39 
	~"´štšg_âs.h
"

41 
	gMASK
[] = { 0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01 };

51 
	$bud_b™d©a
(
b™d©a_p
 *
b™d©a
,

52 
by‹
 
d©a
[],

53 
d©a_Ën
)

55 
b™d©a_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_BITDATA
);

56 ià(
Ãw
 =ğ
NULL
)

58 
	`´št_”r
("### Unableo‡llocate bitdata datastructure\n");

62 
Ãw
->
d©a
 = data;

63 
Ãw
->
d©a_Ën
 = data_len;

64 
Ãw
->
cur_by‹
 = 0;

65 
Ãw
->
cur_b™
 = -1;

67 *
b™d©a
 = 
Ãw
;

70 
	}
}

80 
	$ä“_b™d©a
(
b™d©a_p
 *
b™d©a
)

82 ià(*
b™d©a
 =ğ
NULL
)

84 (*
b™d©a
)->
d©a
 = 
NULL
;

85 (*
b™d©a
)->
cur_by‹
 = 0;

86 (*
b™d©a
)->
cur_b™
 = -1;

87 
	`ä“
(*
b™d©a
);

88 *
b™d©a
 = 
NULL
;

89 
	}
}

97 
šlše
 
	$Ãxt_b™
(
b™d©a_p
 
b™d©a
)

99 
b™d©a
->
cur_b™
 += 1;

100 ià(
b™d©a
->
cur_b™
 == 8)

102 
b™d©a
->
cur_b™
 = 0;

103 
b™d©a
->
cur_by‹
 += 1;

104 ià(
b™d©a
->
cur_by‹
 > (b™d©a->
d©a_Ën
 - 1))

106 
	`´št_”r
("### No more bitso„ead from input stream\n");

110  (
b™d©a
->
d©a
[b™d©a->
cur_by‹
] & 
MASK
[b™d©a->
cur_b™
])

111 >> (7 - 
b™d©a
->
cur_b™
);

112 
	}
}

120 
	$»ad_b™
(
b™d©a_p
 
b™d©a
,

121 
by‹
 *
b™
)

123 
Ãxt
 = 
	`Ãxt_b™
(
b™d©a
);

124 ià(
Ãxt
 < 0)

128 *
b™
 = 
Ãxt
;

131 
	}
}

140 
	$»ad_b™s
(
b™d©a_p
 
b™d©a
,

141 
couÁ
,

142 
ušt32_t
 *
b™s
)

144 
šdex
 = 0;

145 
ušt32_t
 
»suÉ
 = 0;

147 
	`as£¹
((
couÁ
 >=0 && count <= 32));

149 
šdex
=0; index<
couÁ
; index++)

151 
b™
 = 
	`Ãxt_b™
(
b™d©a
);

152 ià(
b™
 < 0)

155 
»suÉ
 = (»suÉ << 1è| 
b™
;

157 *
b™s
 = 
»suÉ
;

159 
	}
}

168 
	$»ad_b™s_što_by‹
(
b™d©a_p
 
b™d©a
,

169 
couÁ
,

170 
by‹
 *
b™s
)

172 
šdex
 = 0;

173 
by‹
 
»suÉ
 = 0;

175 
	`as£¹
((
couÁ
 >=0 && count <= 8));

177 
šdex
=0; index<
couÁ
; index++)

179 
b™
 = 
	`Ãxt_b™
(
b™d©a
);

180 ià(
b™
 < 0)

183 
»suÉ
 = (»suÉ << 1è| 
b™
;

185 *
b™s
 = 
»suÉ
;

187 
	}
}

196 
	$couÁ_z”o_b™s
(
b™d©a_p
 
b™d©a
)

198 
couÁ
 = 0;

199 
	`Ãxt_b™
(
b™d©a
) == 0)

200 
couÁ
 ++;

201  
couÁ
;

202 
	}
}

211 
	$»ad_exp_gŞomb
(
b™d©a_p
 
b™d©a
,

212 
ušt32_t
 *
»suÉ
)

214 
ušt32_t
 
Ãxt
 = 0;

215 
Ëadšg_z”o_b™s
 = 
	`couÁ_z”o_b™s
(
b™d©a
);

216 
”r
 = 
	`»ad_b™s
(
b™d©a
,
Ëadšg_z”o_b™s
,&
Ãxt
);

217 ià(
”r
)

219 
	`åršt_”r
("### Unableo„ead ExpGolomb value -‚otƒnough bits (%d)\n",

220 
Ëadšg_z”o_b™s
);

221  
”r
;

223 *
»suÉ
 = (è(
	`pow
(2,
Ëadšg_z”o_b™s
è- 1 + 
Ãxt
);

225 
	}
}

234 
	$»ad_sigÃd_exp_gŞomb
(
b™d©a_p
 
b™d©a
,

235 
št32_t
 *
»suÉ
)

237 
ušt32_t
 
v®
 = 0;

238 
”r
 = 
	`»ad_exp_gŞomb
(
b™d©a
,&
v®
);

239 ià(
”r
)

241 
	`´št_”r
("### Unableo„ead signed ExpGolomb value\n");

242  
”r
;

244 *
»suÉ
 = (è(
	`pow
(-1,(
v®
+1)è* 
	`û
(val / 2.0));

246 
	}
}

	@bitdata_defns.h

32 #iâdeà
_b™d©a_deâs


33 
	#_b™d©a_deâs


	)

35 
	~"com·t.h
"

37 
	sb™d©a


39 
by‹
 *
	md©a
;

40 
	md©a_Ën
;

41 
	mcur_by‹
;

42 
	mcur_b™
;

44 
b™d©a
 *
	tb™d©a_p
;

45 
	#SIZEOF_BITDATA
 (
b™d©a
)

	)

	@bitdata_fns.h

32 #iâdeà
_b™d©a_âs


33 
	#_b™d©a_âs


	)

35 
	~"b™d©a_deâs.h
"

45 
bud_b™d©a
(
b™d©a_p
 *
b™d©a
,

46 
by‹
 
d©a
[],

47 
d©a_Ën
);

54 
ä“_b™d©a
(
b™d©a_p
 *
b™d©a
);

62 
»ad_b™
(
b™d©a_p
 
b™d©a
,

63 
by‹
 *
b™
);

72 
»ad_b™s
(
b™d©a_p
 
b™d©a
,

73 
couÁ
,

74 
ušt32_t
 *
b™s
);

83 
»ad_b™s_što_by‹
(
b™d©a_p
 
b™d©a
,

84 
couÁ
,

85 
by‹
 *
b™s
);

93 
couÁ_z”o_b™s
(
b™d©a_p
 
b™d©a
);

102 
»ad_exp_gŞomb
(
b™d©a_p
 
b™d©a
,

103 
ušt32_t
 *
»suÉ
);

112 
»ad_sigÃd_exp_gŞomb
(
b™d©a_p
 
b™d©a
,

113 
št32_t
 *
»suÉ
);

	@compat.h

34 #iâdeà
_com·t


35 
	#_com·t


	)

37 #ifdeà
_WIN32


40 #´agm¨
w¬nšg
( 4: 4996 )

42 
	~<io.h
>

46 
__št8
 
	tšt8_t
;

47 
__št16
 
	tšt16_t
;

48 
__št32
 
	tšt32_t
;

49 
__št64
 
	tšt64_t
;

51 
	t__št8
 
	tušt8_t
;

52 
	t__št16
 
	tušt16_t
;

53 
	t__št32
 
	tušt32_t
;

54 
	t__št64
 
	tušt64_t
;

56 
ušt8_t
 
	tby‹
;

58 
	#INT64_MIN
 (-9223372036854775807
i64
 - 1)

	)

63 
	#l£ek
 
_l£eki64


	)

68 
__št64
 
	toff£t_t
;

73 
	#OFFSET_T_FORMAT
 "%I64d"

	)

74 
	#OFFSET_T_FORMAT_8
 "%8I64d"

	)

75 
	#OFFSET_T_FORMAT_08
 "%08I64d"

	)

78 
	#LLD_FORMAT
 "%I64d"

	)

79 
	#LLU_FORMAT
 "%I64u"

	)

80 
	#LLD_FORMAT_STUMP
 "I64d"

	)

81 
	#LLU_FORMAT_STUMP
 "I64u"

	)

89 #iâdeà
STDIN_FILENO


90 
	#STDIN_FILENO
 0

	)

94 
	#šlše
 
__šlše


	)

97 
	#¢´štf
 
_¢´štf


	)

102 
	~<¡dšt.h
>

103 
	~<¡dšt.h
>

106 
ušt8_t
 
	tby‹
;

116 
	~<sys/ty³s.h
>

117 
	~<uni¡d.h
>

118 
	~<š‰y³s.h
>

119 
off_t
 
	toff£t_t
;

121 #ià
defšed
(
__lšux__
è&& !defšed(
__USE_FILE_OFFSET64
)

124 
	#OFFSET_T_FORMAT
 "%ld"

	)

125 
	#OFFSET_T_FORMAT_08
 "%08ld"

126 
	#OFFSET_T_FORMAT_8
 "%8ld"

	)

130 
	#OFFSET_T_FORMAT
 "%" 
PRIi64


	)

131 
	#OFFSET_T_FORMAT_08
 "%08" 
PRIi64


132 
	#OFFSET_T_FORMAT_8
 "%8" 
PRIi64


	)

136 
	#LLD_FORMAT
 "%" 
PRId64


	)

137 
	#LLU_FORMAT
 "%" 
PRIu64


	)

138 
	#LLD_FORMAT_STUMP
 "Îd"

	)

139 
	#LLU_FORMAT_STUMP
 "Îu"

	)

142 
	#max
(
i
,
j
è((i)>(j)?(i):(j))

	)

143 
	#mš
(
i
,
j
è((i)<(j)?(i):(j))

	)

148 * 
	tvoid_p
;

150 
	#TRUE
 1

	)

151 
	#FALSE
 0

	)

155 
	#DEFAULT_VIDEO_PID
 0x68

	)

156 
	#DEFAULT_AUDIO_PID
 0x67

	)

157 
	#DEFAULT_PMT_PID
 0x66

	)

	@es.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 #ifdeà
_WIN32


34 
	~<io.h
>

36 
	~<uni¡d.h
>

39 
	~"com·t.h
"

40 
	~"´štšg_âs.h
"

41 
	~"misc_âs.h
"

42 
	~"³s_âs.h
"

43 
	~"tswr™e_âs.h
"

44 
	~"es_âs.h
"

45 
	~"´štšg_âs.h
"

47 
	#DEBUG
 0

	)

50 
šlše
 
g‘_mÜe_d©a
(
ES_p
 
es
);

68 
	$İ’_–em’ry_¡»am
(*
f’ame
,

69 
ES_p
 *
es
)

71 
”r
;

72 
šput
;

74 ià(
f’ame
 =ğ
NULL
)

75 
šput
 = 
STDIN_FILENO
;

78 
šput
 = 
	`İ’_bš¬y_fe
(
f’ame
,
FALSE
);

79 ià(
šput
 == -1)  1;

82 
”r
 = 
	`bud_–em’ry_¡»am_fe
(
šput
,
es
);

83 ià(
”r
)

85 
	`åršt_”r
("### E¼Ü budšgƒËm’ry sŒ—m fÜ f%s\n", 
f’ame
);

89 
	}
}

91 
	$£tup_»adah—d
(
ES_p
 
es
)

93 
”r
;

95 
es
->
»ad_ah—d_Ën
 = 0;

96 
es
->
»ad_ah—d_po¢
 = 0;

98 
es
->
d©a
 = 
NULL
;

99 
es
->
d©a_’d
 = 
NULL
;

100 
es
->
d©a_±r
 = 
NULL
;

102 
es
->
Ï¡_·ck‘_po¢
 = 0;

103 
es
->
Ï¡_·ck‘_es_d©a_Ën
 = 0;

106 
”r
 = 
	`g‘_mÜe_d©a
(
es
);

107 ià(
”r
) ƒrr;

109 ià(
es
->
»adšg_ES
)

111 ià(
es
->
»ad_ah—d_Ën
 < 3)

113 
	`åršt_”r
("### File only contains %d byte%s\n",

114 
es
->
»ad_ah—d_Ën
,(es->read_ahead_len==1?"":"s"));

120 ià(
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
 < 3)

122 
	`åršt_”r
("### File PES…acket only contains %d byte%s\n",

123 
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
,

124 (
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
==1?"":"s"));

129 ià(
DEBUG
)

130 
	`åršt_msg
("F¡¬t %02x %02x %02x\n",
es
->
d©a
[0],es->data[1],es->data[2]);

134 
es
->
´ev2_by‹
 =ƒs->
´ev1_by‹
 =ƒs->
cur_by‹
 = 0xFF;

135 
es
->
po¢_of_Ãxt_by‹
.
šfe
 = 0;

136 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
 = 0;

139 
	}
}

152 
	$bud_–em’ry_¡»am_fe
(
šput
,

153 
ES_p
 *
es
)

155 
ES_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_ES
);

156 ià(
Ãw
 =ğ
NULL
)

158 
	`´št_”r
("### Unableo‡llocateƒlementary stream datastructure\n");

162 
Ãw
->
»adšg_ES
 = 
TRUE
;

163 
Ãw
->
šput
 = input;

164 
Ãw
->
»ad”
 = 
NULL
;

166 
	`£tup_»adah—d
(
Ãw
);

168 *
es
 = 
Ãw
;

170 
	}
}

185 
	$bud_–em’ry_¡»am_PES
(
PES_»ad”_p
 
»ad”
,

186 
ES_p
 *
es
)

188 
ES_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_ES
);

189 ià(
Ãw
 =ğ
NULL
)

191 
	`´št_”r
("### Unableo‡llocateƒlementary stream datastructure\n");

195 
Ãw
->
»adšg_ES
 = 
FALSE
;

196 
Ãw
->
šput
 = -1;

197 
Ãw
->
»ad”
 =„eader;

199 
	`£tup_»adah—d
(
Ãw
);

201 *
es
 = 
Ãw
;

203 
	}
}

217 
	$ä“_–em’ry_¡»am
(
ES_p
 *
es
)

219 (*
es
)->
šput
 = -1;

220 
	`ä“
(*
es
);

221 *
es
 = 
NULL
;

222 
	}
}

236 
	$şo£_–em’ry_¡»am
(
ES_p
 *
es
)

238 
šput
;

239 ià(*
es
 =ğ
NULL
)

241 
šput
 = (*
es
)->input;

242 ià(
šput
 !ğ-1 && iÅuˆ!ğ
STDIN_FILENO
)

243 (è
	`şo£_fe
(
šput
);

244 
	`ä“_–em’ry_¡»am
(
es
);

245 
	}
}

258 
	$es_commªd_chªged
(
ES_p
 
es
)

260 ià(
es
->
»adšg_ES
)

261  
FALSE
;

263 ià(
es
->
»ad”
->
tswr™”
 =ğ
NULL
)

264  
FALSE
;

266  
	`tswr™e_commªd_chªged
(
es
->
»ad”
->
tswr™”
);

267 
	}
}

279 
	$£tup_ES_un™
(
ES_un™_p
 
un™
)

281 
un™
->
d©a
 = 
	`m®loc
(
ES_UNIT_DATA_START_SIZE
);

282 ià(
un™
->
d©a
 =ğ
NULL
)

284 
	`´št_”r
("### Unableo‡llocate ES unit data buffer\n");

287 
un™
->
d©a_Ën
 = 0;

288 
un™
->
d©a_size
 = 
ES_UNIT_DATA_START_SIZE
;

289 
un™
->
¡¬t_po¢
.
šfe
 = 0;

290 
un™
->
¡¬t_po¢
.
š·ck‘
 = 0;

292 
un™
->
PES_had_PTS
 = 
FALSE
;

294 
	}
}

301 
	$ş—r_ES_un™
(
ES_un™_p
 
un™
)

303 ià(
un™
->
d©a
 !ğ
NULL
)

305 
	`ä“
(
un™
->
d©a
);

306 
un™
->
d©a
 = 
NULL
;

307 
un™
->
d©a_size
 = 0;

308 
un™
->
d©a_Ën
 = 0;

310 
	}
}

317 
	$bud_ES_un™
(
ES_un™_p
 *
un™
)

319 
”r
;

320 
ES_un™_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_ES_UNIT
);

321 ià(
Ãw
 =ğ
NULL
)

323 
	`´št_”r
("### Unableo‡llocate ES unit datastructure\n");

326 
”r
 = 
	`£tup_ES_un™
(
Ãw
);

327 ià(
”r
)

329 
	`ä“
(
Ãw
);

332 *
un™
 = 
Ãw
;

334 
	}
}

344 
	$bud_ES_un™_äom_d©a
(
ES_un™_p
 *
un™
,

345 
by‹
 *
d©a
,

346 
ušt32_t
 
d©a_Ën
)

348 
ES_un™_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_ES_UNIT
);

349 ià(
Ãw
 =ğ
NULL
)

351 
	`´št_”r
("### Unableo‡llocate ES unit datastructure\n");

354 
Ãw
->
d©a
 = 
	`m®loc
(
d©a_Ën
);

355 ià(
Ãw
->
d©a
 =ğ
NULL
)

357 
	`´št_”r
("### Unableo‡llocate ES unit data buffer\n");

360 (è
	`memıy
(
Ãw
->
d©a
, d©a, 
d©a_Ën
);

361 
Ãw
->
d©a_Ën
 = data_len;

362 
Ãw
->
d©a_size
 = 
d©a_Ën
;

363 
Ãw
->
¡¬t_code
 = 
d©a
[3];

364 
Ãw
->
¡¬t_po¢
.
šfe
 = 0;

365 
Ãw
->
¡¬t_po¢
.
š·ck‘
 = 0;

366 
Ãw
->
PES_had_PTS
 = 
FALSE
;

367 *
un™
 = 
Ãw
;

369 
	}
}

378 
	$ä“_ES_un™
(
ES_un™_p
 *
un™
)

380 ià(*
un™
 =ğ
NULL
)

382 
	`ş—r_ES_un™
(*
un™
);

383 
	`ä“
(*
un™
);

384 *
un™
 = 
NULL
;

385 
	}
}

390 
	$»pÜt_ES_un™
(
is_msg
,

391 
ES_un™_p
 
un™
)

393 
by‹
 
s
 = 
un™
->
¡¬t_code
;

394 
	`åršt_msg_Ü_”r
(
is_msg
,

395 
OFFSET_T_FORMAT_08
 "/%4d: ES unit (%02x '%d%d%d%d %d%d%d%d')",

396 
un™
->
¡¬t_po¢
.
šfe
,un™->¡¬t_po¢.
š·ck‘
,
s
,

397 (
s
&0x80)>>7,(s&0x40)>>6,(s&0x20)>>5,(s&0x10)>>4,

398 (
s
&0x08)>>3,(s&0x04)>>2,(s&0x02)>>1,(s&0x01));

402 ià(
un™
->
d©a_Ën
 > 0)

404 
ii
;

405 
d©a_Ën
 = 
un™
->data_len - 4;

406 
show_Ën
 = (
d©a_Ën
>10?10:data_len);

407 
	`åršt_msg_Ü_”r
(
is_msg
," %6d:",
d©a_Ën
);

408 
ii
 = 0; i˜< 
show_Ën
; ii++)

409 
	`åršt_msg_Ü_”r
(
is_msg
," %02x",
un™
->
d©a
[4+
ii
]);

410 ià(
show_Ën
 < 
d©a_Ën
)

411 
	`åršt_msg_Ü_”r
(
is_msg
,"...");

413 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

414 
	}
}

426 
šlše
 
	$g‘_Ãxt_³s_·ck‘
(
ES_p
 
es
)

428 
”r
;

429 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

432 ià(
»ad”
->
·ck‘
 =ğ
NULL
)

435 
es
->
Ï¡_·ck‘_po¢
 = 0;

436 
es
->
Ï¡_·ck‘_es_d©a_Ën
 = 0;

440 
es
->
Ï¡_·ck‘_po¢
 = 
»ad”
->
·ck‘
->
po¢
;

441 
es
->
Ï¡_·ck‘_es_d©a_Ën
 = 
»ad”
->
·ck‘
->
es_d©a_Ën
;

444 
”r
 = 
	`»ad_Ãxt_PES_ES_·ck‘
(
es
->
»ad”
);

445 ià(
”r
) ƒrr;

448 
es
->
d©a
 = 
»ad”
->
·ck‘
->
es_d©a
;

449 
es
->
d©a_’d
 =ƒs->
d©a
 + 
»ad”
->
·ck‘
->
es_d©a_Ën
;

450 
es
->
d©a_±r
 =ƒs->
d©a
;

452 
es
->
po¢_of_Ãxt_by‹
.
šfe
 = 
»ad”
->
·ck‘
->
po¢
;

453 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
 = 0;

455 
	}
}

465 
šlše
 
	$g‘_mÜe_d©a
(
ES_p
 
es
)

467 ià(
es
->
»adšg_ES
)

471 #ifdeà
_WIN32


472 
Ën
 = 
	`_»ad
(
es
->
šput
,&es->
»ad_ah—d
,
ES_READ_AHEAD_SIZE
);

474 
ssize_t
 
Ën
 = 
	`»ad
(
es
->
šput
,&es->
»ad_ah—d
,
ES_READ_AHEAD_SIZE
);

476 ià(
Ën
 == 0)

477  
EOF
;

478 ià(
Ën
 == -1)

480 
	`åršt_”r
("### E¼Ü„—dšg‚exˆby‹s: %s\n",
	`¡»¼Ü
(
”ºo
));

483 
es
->
»ad_ah—d_po¢
 +ğes->
»ad_ah—d_Ën
;

484 
es
->
»ad_ah—d_Ën
 = 
Ën
;

485 
es
->
d©a
 =ƒs->
»ad_ah—d
;

486 
es
->
d©a_’d
 =ƒs->
d©a
 + 
Ën
;

487 
es
->
d©a_±r
 =ƒs->
d©a
;

492  
	`g‘_Ãxt_³s_·ck‘
(
es
);

494 
	}
}

508 
	$fšd_ES_un™_¡¬t
(
ES_p
 
es
,

509 
ES_un™_p
 
un™
)

511 
”r
;

512 
by‹
 
´ev1
 = 
es
->
´ev1_by‹
;

513 
by‹
 
´ev2
 = 
es
->
´ev2_by‹
;

520 
by‹
 *
±r
;

521 
±r
 = 
es
->
d©a_±r
;…Œ <ƒs->
d©a_’d
;…tr++)

523 ià(
´ev2
 =ğ0x00 && 
´ev1
 =ğ0x00 && *
±r
 == 0x01)

525 
es
->
´ev1_by‹
 =ƒs->
´ev2_by‹
 = 0x00;

526 
es
->
cur_by‹
 = 0x01;

527 ià(
es
->
»adšg_ES
)

529 
un™
->
¡¬t_po¢
.
šfe
 = 
es
->
»ad_ah—d_po¢
 + (
±r
 -ƒs->
d©a
) - 2;

533 
un™
->
¡¬t_po¢
.
šfe
 = 
es
->
»ad”
->
·ck‘
->
po¢
;

534 
un™
->
¡¬t_po¢
.
š·ck‘
 = (
±r
 - 
es
->
d©a
) - 2;

535 ià(
un™
->
¡¬t_po¢
.
š·ck‘
 < 0)

537 
un™
->
¡¬t_po¢
.
šfe
 = 
es
->
Ï¡_·ck‘_po¢
;

538 
un™
->
¡¬t_po¢
.
š·ck‘
 +ğ
es
->
Ï¡_·ck‘_es_d©a_Ën
;

541 
un™
->
PES_had_PTS
 = 
es
->
»ad”
->
·ck‘
->
has_PTS
;

543 
es
->
d©a_±r
 = 
±r
 + 1;

544 
un™
->
d©a
[0] = 0x00;

545 
un™
->
d©a
[1] = 0x00;

546 
un™
->
d©a
[2] = 0x01;

547 
un™
->
d©a_Ën
 = 3;

550 
´ev2
 = 
´ev1
;

551 
´ev1
 = *
±r
;

555 
”r
 = 
	`g‘_mÜe_d©a
(
es
);

556 ià(
”r
) ƒrr;

558 
	}
}

587 
	$fšd_ES_un™_’d
(
ES_p
 
es
,

588 
ES_un™_p
 
un™
)

590 
”r
;

591 
by‹
 
´ev1
 = 
es
->
cur_by‹
;

592 
by‹
 
´ev2
 = 
es
->
´ev1_by‹
;

595 
by‹
 *
±r
;

596 
±r
 = 
es
->
d©a_±r
;…Œ <ƒs->
d©a_’d
;…tr++)

602 ià(
´ev2
 =ğ0x00 && 
´ev1
 =ğ0x00 && *
±r
 == 0x01)

604 
es
->
d©a_±r
 = 
±r
;

605 
es
->
´ev2_by‹
 = 0x00;

606 
es
->
cur_by‹
 = 0x01;

608 
un™
->
d©a_Ën
 -= 2;

610 ià(
es
->
»adšg_ES
)

612 
es
->
po¢_of_Ãxt_by‹
.
šfe
 =ƒs->
»ad_ah—d_po¢
 +

613 (
±r
 - 
es
->
d©a
) - 2;

617 
es
->
po¢_of_Ãxt_by‹
.
šfe
 =ƒs->
»ad”
->
·ck‘
->
po¢
;

618 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
 = (
±r
 -ƒs->
d©a
) - 2;

624 ià(
un™
->
d©a_Ën
 =ğun™->
d©a_size
)

626 
Ãwsize
 = 
un™
->
d©a_size
 + 
ES_UNIT_DATA_INCREMENT
;

627 
un™
->
d©a
 = 
	`»®loc
(un™->d©a,
Ãwsize
);

628 ià(
un™
->
d©a
 =ğ
NULL
)

630 
	`´št_”r
("### Unableoƒxtend ES unit data‡rray\n");

633 
un™
->
d©a_size
 = 
Ãwsize
;

635 
un™
->
d©a
[un™->
d©a_Ën
++] = *
±r
;

637 
´ev2
 = 
´ev1
;

638 
´ev1
 = *
±r
;

642 
”r
 = 
	`g‘_mÜe_d©a
(
es
);

643 ià(
”r
 =ğ
EOF
)

646 
es
->
d©a_±r
 = 
±r
;

647 
es
->
´ev2_by‹
 = 
´ev2
;

648 
es
->
´ev1_by‹
 = 
´ev1
;

649 
es
->
cur_by‹
 = 0xFF;

653 ià(
es
->
»adšg_ES
)

655 
es
->
po¢_of_Ãxt_by‹
.
šfe
 =ƒs->
»ad_ah—d_po¢
 + (
±r
 -ƒs->
d©a
);

659 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
 = (
±r
 -ƒs->
d©a
);

663 ià(
”r
)

664  
”r
;

666 ià(!
es
->
»adšg_ES
)

670 
es
->
po¢_of_Ãxt_by‹
.
šfe
 =ƒs->
»ad”
->
·ck‘
->
po¢
;

676 ià(
es
->
»ad”
->
·ck‘
->
has_PTS
)

677 
un™
->
PES_had_PTS
 = 
TRUE
;

680 
	}
}

695 
	$fšd_Ãxt_ES_un™
(
ES_p
 
es
,

696 
ES_un™_p
 
un™
)

698 
”r
;

700 
”r
 = 
	`fšd_ES_un™_¡¬t
(
es
,
un™
);

701 ià(
”r
) ƒrr;

703 
”r
 = 
	`fšd_ES_un™_’d
(
es
,
un™
);

704 ià(
”r
) ƒrr;

708 
un™
->
¡¬t_code
 = un™->
d©a
[3];

711 
	}
}

723 
	$fšd_ªd_bud_Ãxt_ES_un™
(
ES_p
 
es
,

724 
ES_un™_p
 *
un™
)

726 
”r
;

728 
”r
 = 
	`bud_ES_un™
(
un™
);

729 ià(
”r
)  1;

731 
”r
 = 
	`fšd_Ãxt_ES_un™
(
es
,*
un™
);

732 ià(
”r
)

734 
	`ä“_ES_un™
(
un™
);

735  
”r
;

738 
	}
}

751 
	$wr™e_ES_un™
(
FILE
 *
ouut
,

752 
ES_un™_p
 
un™
)

754 
size_t
 
wr™‹n
 = 
	`fwr™e
(
un™
->
d©a
,1,un™->
d©a_Ën
,
ouut
);

755 ià(
wr™‹n
 !ğ
un™
->
d©a_Ën
)

757 
	`åršt_”r
("### Error writing out ES unit data: %s\n"

759 
	`¡»¼Ü
(
”ºo
),()
wr™‹n
,
un™
->
d©a_Ën
);

764 
	}
}

778 
	$£ek_š_PES
(
ES_p
 
es
,

779 
ES_off£t
 
wh”e
)

781 
”r
;

783 ià(
es
->
»ad”
 =ğ
NULL
)

785 
	`´št_”r
("### Attempto seek in PES for‡n ES„eaderhat"

791 ià(
es
->
»ad”
->
·ck‘
 !ğ
NULL
)

792 
	`ä“_PES_·ck‘_d©a
(&
es
->
»ad”
->
·ck‘
);

795 
”r
 = 
	`£t_PES_»ad”_pos™iÚ
(
es
->
»ad”
,
wh”e
.
šfe
);

796 ià(
”r
)

798 
	`åršt_”r
("### E¼Ü s“kšg fÜ PES…ack‘‡ˆ" 
OFFSET_T_FORMAT


799 "\n",
wh”e
.
šfe
);

803 
”r
 = 
	`g‘_Ãxt_³s_·ck‘
(
es
);

804 ià(
”r
)

806 
	`åršt_”r
("### E¼Ü„—dšg PES…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "/%d\n",

807 
wh”e
.
šfe
,wh”e.
š·ck‘
);

812 ià(
wh”e
.
š·ck‘
 > 
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
)

814 
	`åršt_”r
("### E¼Ü s“kšg PES…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "/%d: "

815 "…ack‘ ES d©¨i Úly %d by‹ lÚg\n",
wh”e
.
šfe
,

816 
wh”e
.
š·ck‘
,
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
);

819 
es
->
po¢_of_Ãxt_by‹
 = 
wh”e
;

821 
	}
}

826 
šlše
 
	$deduû_cÜ»ù_pos™iÚ
(
ES_p
 
es
)

830 
es
->
cur_by‹
 = 0xff;

831 
es
->
´ev1_by‹
 = 0xff;

832 
es
->
´ev2_by‹
 = 0xff;

834 ià(
es
->
»adšg_ES
)

837 
es
->
d©a_±r
 =ƒs->
d©a_’d
 = 
NULL
;

838 
es
->
»ad_ah—d_Ën
 = 0;

839 
es
->
»ad_ah—d_po¢
 =ƒs->
po¢_of_Ãxt_by‹
.
šfe
;

844 
PES_·ck‘_d©a_p
 
·ck‘
 = 
es
->
»ad”
->packet;

845 
es
->
d©a
 = 
·ck‘
->
es_d©a
;

846 
es
->
d©a_±r
 = 
·ck‘
->
es_d©a
 +ƒs->
po¢_of_Ãxt_by‹
.
š·ck‘
;

847 
es
->
d©a_’d
 = 
·ck‘
->
es_d©a
 +…ack‘->
es_d©a_Ën
;

849 
es
->
Ï¡_·ck‘_po¢
 =ƒs->
Ï¡_·ck‘_es_d©a_Ën
 = 0;

851 
	}
}

863 
	$£ek_ES
(
ES_p
 
es
,

864 
ES_off£t
 
wh”e
)

866 
”r
;

867 ià(
es
->
»adšg_ES
)

869 
”r
 = 
	`£ek_fe
(
es
->
šput
,
wh”e
.
šfe
);

870 ià(
”r
)

872 
	`´št_”r
("### Error seeking within ES file\n");

878 
”r
 = 
	`£ek_š_PES
(
es
,
wh”e
);

879 ià(
”r
)

881 
	`åršt_”r
("### E¼Ü s“kšg w™hš ES ov” PES (off£ˆ" 
OFFSET_T_FORMAT


882 "/%d)\n",
wh”e
.
šfe
,wh”e.
š·ck‘
);

888 
es
->
po¢_of_Ãxt_by‹
 = 
wh”e
;

889 
	`deduû_cÜ»ù_pos™iÚ
(
es
);

891 
	}
}

900 
	$»ad_by‹s_äom_PES
(
ES_p
 
es
,

901 
by‹
 *
d©a
,

902 
ušt32_t
 
num_by‹s
)

904 
”r
;

905 
off£t
 = 0;

906 
num_by‹s_wª‹d
 = 
num_by‹s
;

907 
št32_t
 
äom
 = 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
;

908 
št32_t
 
num_by‹s_Ëá
 = 
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
 - 
äom
;

912 ià(
num_by‹s_Ëá
 < 
num_by‹s_wª‹d
)

914 
	`memıy
(&(
d©a
[
off£t
]),&(
es
->
»ad”
->
·ck‘
->
es_d©a
[
äom
]),

915 
num_by‹s_Ëá
);

916 
off£t
 +ğ
num_by‹s_Ëá
;

917 
num_by‹s_wª‹d
 -ğ
num_by‹s_Ëá
;

918 
”r
 = 
	`g‘_Ãxt_³s_·ck‘
(
es
);

919 ià(
”r
) ƒrr;

920 
äom
 = 0;

921 
num_by‹s_Ëá
 = 
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
;

925 
	`memıy
(&(
d©a
[
off£t
]),&(
es
->
»ad”
->
·ck‘
->
es_d©a
[
äom
]),

926 
num_by‹s_wª‹d
);

927 
äom
 +ğ
num_by‹s_wª‹d
;

931 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
 = 
äom
;

934 
	}
}

967 
	$»ad_ES_d©a
(
ES_p
 
es
,

968 
ES_off£t
 
¡¬t_po¢
,

969 
ušt32_t
 
num_by‹s
,

970 
ušt32_t
 *
d©a_Ën
,

971 
by‹
 **
d©a
)

973 
”r
;

974 ià(*
d©a
 =ğ
NULL
 || 
d©a_Ën
 =ğNULL || 
num_by‹s
 > *data_len)

976 *
d©a
 = 
	`»®loc
(*d©a,
num_by‹s
);

977 ià(*
d©a
 =ğ
NULL
)

979 
	`´št_”r
("### Unableo„eallocate data space\n");

982 ià(
d©a_Ën
 !ğ
NULL
)

983 *
d©a_Ën
 = 
num_by‹s
;

985 
”r
 = 
	`£ek_ES
(
es
,
¡¬t_po¢
);

986 ià(
”r
) ƒrr;

987 ià(
es
->
»adšg_ES
)

989 
”r
 = 
	`»ad_by‹s
(
es
->
šput
,
num_by‹s
,*
d©a
);

990 ià(
”r
)

992 ià(
”r
 =ğ
EOF
)

994 
	`åršt_”r
("### E¼Ü (EOFè»adšg %d by‹s\n",
num_by‹s
);

998  
”r
;

1000 
es
->
po¢_of_Ãxt_by‹
.
šfe
 = 
¡¬t_po¢
.šf+ 
num_by‹s
;

1004 
”r
 = 
	`»ad_by‹s_äom_PES
(
es
,*
d©a
,
num_by‹s
);

1005 ià(
”r
)

1007 
	`åršt_”r
("### E¼Ü„—dšg %d by‹ äom PES\n",
num_by‹s
);

1021 
	`deduû_cÜ»ù_pos™iÚ
(
es
);

1023 
	}
}

1038 
	$g‘_’d_of_und”lyšg_PES_·ck‘
(
ES_p
 
es
,

1039 
by‹
 **
d©a
,

1040 *
d©a_Ën
)

1042 
št32_t
 
off£t
;

1044 ià(
es
->
»adšg_ES
)

1046 
	`åršt_”r
("### Cannot„etrieveƒnd of PES…acket -he ES data"

1050 ià(
es
->
»ad”
->
·ck‘
 =ğ
NULL
)

1053 *
d©a
 = 
NULL
;

1054 *
d©a_Ën
 = 0;

1062 
off£t
 = 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
;

1090 *
d©a_Ën
 = 
es
->
»ad”
->
·ck‘
->
es_d©a_Ën
 - 
off£t
 + 3;

1091 *
d©a
 = 
	`m®loc
(*
d©a_Ën
);

1092 ià(*
d©a
 =ğ
NULL
)

1094 
	`´št_”r
("### Cannot‡llocate space for„est of PES…acket\n");

1097 (*
d©a
)[0] = 
es
->
´ev2_by‹
;

1098 (*
d©a
)[1] = 
es
->
´ev1_by‹
;

1099 (*
d©a
)[2] = 
es
->
cur_by‹
;

1100 
	`memıy
Ğ&((*
d©a
)[3]),

1101 &(
es
->
»ad”
->
·ck‘
->
es_d©a
[
off£t
]),

1102 (*
d©a_Ën
) - 3);

1105 
	}
}

1115 
	$bud_ES_un™_li¡
(
ES_un™_li¡_p
 *
li¡
)

1117 
ES_un™_li¡_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_ES_UNIT_LIST
);

1118 ià(
Ãw
 =ğ
NULL
)

1120 
	`´št_”r
("### Unableo‡llocate ES unit†ist datastructure\n");

1124 
Ãw
->
Ëngth
 = 0;

1125 
Ãw
->
size
 = 
ES_UNIT_LIST_START_SIZE
;

1126 
Ãw
->
¬¿y
 = 
	`m®loc
(
SIZEOF_ES_UNIT
*
ES_UNIT_LIST_START_SIZE
);

1127 ià(
Ãw
->
¬¿y
 =ğ
NULL
)

1129 
	`ä“
(
Ãw
);

1130 
	`´št_”r
("### Unableo‡llocate‡rray in ES unit†ist datastructure\n");

1133 *
li¡
 = 
Ãw
;

1135 
	}
}

1145 
	$­³nd_to_ES_un™_li¡
(
ES_un™_li¡_p
 
li¡
,

1146 
ES_un™_p
 
un™
)

1148 
ES_un™_p
 
±r
;

1149 ià(
li¡
->
Ëngth
 =ğli¡->
size
)

1151 
Ãwsize
 = 
li¡
->
size
 + 
ES_UNIT_LIST_INCREMENT
;

1152 
li¡
->
¬¿y
 = 
	`»®loc
Öi¡->¬¿y,
Ãwsize
*
SIZEOF_ES_UNIT
);

1153 ià(
li¡
->
¬¿y
 =ğ
NULL
)

1155 
	`´št_”r
("### Unableoƒxtend ES unit†ist‡rray\n");

1158 
li¡
->
size
 = 
Ãwsize
;

1160 
±r
 = &
li¡
->
¬¿y
[li¡->
Ëngth
++];

1162 *
±r
 = *
un™
;

1164 
±r
->
d©a
 = 
	`m®loc
(
un™
->
d©a_Ën
);

1165 ià(
±r
->
d©a
 =ğ
NULL
)

1167 
	`´št_”r
("### Unableo copy ES unit data‡rray\n");

1170 
	`memıy
(
±r
->
d©a
,
un™
->d©a,un™->
d©a_Ën
);

1171 
±r
->
d©a_size
 = 
un™
->
d©a_Ën
;

1173 
	}
}

1178 
šlše
 
	$ş—r_ES_un™_li¡
(
ES_un™_li¡_p
 
li¡
)

1180 ià(
li¡
->
¬¿y
 !ğ
NULL
)

1182 
ii
;

1183 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

1185 
	`ş—r_ES_un™
(&
li¡
->
¬¿y
[
ii
]);

1187 
	`ä“
(
li¡
->
¬¿y
);

1188 
li¡
->
¬¿y
 = 
NULL
;

1190 
li¡
->
Ëngth
 = 0;

1191 
li¡
->
size
 = 0;

1192 
	}
}

1197 
	$»£t_ES_un™_li¡
(
ES_un™_li¡_p
 
li¡
)

1199 ià(
li¡
->
¬¿y
 !ğ
NULL
)

1201 
ii
;

1202 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

1204 
	`ş—r_ES_un™
(&
li¡
->
¬¿y
[
ii
]);

1209 
li¡
->
Ëngth
 = 0;

1210 
	}
}

1219 
	$ä“_ES_un™_li¡
(
ES_un™_li¡_p
 *
li¡
)

1221 ià(*
li¡
 =ğ
NULL
)

1223 
	`ş—r_ES_un™_li¡
(*
li¡
);

1224 
	`ä“
(*
li¡
);

1225 *
li¡
 = 
NULL
;

1226 
	}
}

1234 
	$»pÜt_ES_un™_li¡
(*
Çme
,

1235 
ES_un™_li¡_p
 
li¡
)

1237 
	`åršt_msg
("ES un™†i¡ '%s': ",
Çme
);

1238 ià(
li¡
->
¬¿y
 =ğ
NULL
)

1239 
	`´št_msg
("<empty>\n");

1242 
ii
;

1243 
	`åršt_msg
("%d i‹m% (siz%d)\n",
li¡
->
Ëngth
,

1244 (
li¡
->
Ëngth
==1?"":"s"),li¡->
size
);

1245 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

1247 
	`´št_msg
(" ");

1248 
	`»pÜt_ES_un™
(
TRUE
,&(
li¡
->
¬¿y
[
ii
]));

1251 
	}
}

1263 
	$g‘_ES_un™_li¡_bounds
(
ES_un™_li¡_p
 
li¡
,

1264 
ES_off£t
 *
¡¬t
,

1265 
ušt32_t
 *
Ëngth
)

1267 
ii
;

1268 ià(
li¡
->
¬¿y
 =ğ
NULL
 ||†i¡->
Ëngth
 == 0)

1270 
	`´št_”r
("### Cannot determine bounds of‡n ES unit†ist with‚o content\n");

1274 *
¡¬t
 = 
li¡
->
¬¿y
[0].
¡¬t_po¢
;

1275 *
Ëngth
 = 0;

1278 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

1279 (*
Ëngth
è+ğ
li¡
->
¬¿y
[
ii
].
d©a_Ën
;

1282 
	}
}

1294 
	$§me_ES_un™_li¡
(
ES_un™_li¡_p
 
li¡1
,

1295 
ES_un™_li¡_p
 
li¡2
)

1297 
ii
;

1298 ià(
li¡1
 =ğ
li¡2
)

1299  
TRUE
;

1301 ià(
li¡1
->
¬¿y
 =ğ
NULL
)

1302  (
li¡2
->
¬¿y
 =ğ
NULL
);

1304 ià(
li¡1
->
Ëngth
 !ğ
li¡2
->length)

1305  
FALSE
;

1307 
ii
 = 0; i˜< 
li¡1
->
Ëngth
; ii++)

1309 
ES_un™_p
 
un™1
 = &
li¡1
->
¬¿y
[
ii
];

1310 
ES_un™_p
 
un™2
 = &
li¡2
->
¬¿y
[
ii
];

1312 ià(
un™1
->
d©a_Ën
 !ğ
un™2
->data_len)

1313  
FALSE
;

1315 ià(
	`memcmp
(
un™1
->
d©a
,
un™2
->d©a,un™1->
d©a_Ën
))

1316  
FALSE
;

1319  
TRUE
;

1320 
	}
}

1328 
	$com·»_ES_off£ts
(
ES_off£t
 
off£t1
,

1329 
ES_off£t
 
off£t2
)

1331 ià(
off£t1
.
šfe
 < 
off£t2
.infile)

1333 ià(
off£t1
.
šfe
 > 
off£t2
.infile)

1335 ià(
off£t1
.
š·ck‘
 < 
off£t2
.inpacket)

1337 ià(
off£t1
.
š·ck‘
 > 
off£t2
.inpacket)

1341 
	}
}

1351 
	$Œy_to_guess_video_ty³
(
ES_un™_p
 
un™
,

1352 
show_»asÚšg
,

1353 *
maybe_h264
,

1354 *
maybe_h262
,

1355 *
maybe_avs
)

1358 
by‹
 
Çl_»f_idc
 = 0;

1359 
by‹
 
Çl_un™_ty³
 = 0;

1361 ià(
show_»asÚšg
)

1362 
	`åršt_msg
("Lookšg‡ˆES un™ w™h s¹ cod%02X\n",
un™
->
¡¬t_code
);

1370 ià(
un™
->
¡¬t_code
 == 0xBA)

1372 
	`´št_”r
("### ES unit start code is 0xBA, which†ooks†ike‡ PS…ack"

1377 ià(
un™
->
¡¬t_code
 >= 0xB9)

1379 
	`åršt_”r
("### ES unit start code %02X is morehan 0xB9, which is…robably"

1382 
un™
->
¡¬t_code
);

1386 ià(
un™
->
¡¬t_code
 & 0x80)

1388 ià(*
maybe_h264
)

1390 ià(
show_»asÚšg
è
	`åršt_msg
(" %02X ha tİ b™ s‘, sØnÙ H.264,\n",
un™
->
¡¬t_code
);

1391 *
maybe_h264
 = 
FALSE
;

1394 ià(
un™
->
¡¬t_code
 == 0xB0 ||

1395 
un™
->
¡¬t_code
 == 0xB1 ||

1396 
un™
->
¡¬t_code
 == 0xB6)

1398 *
maybe_h262
 = 
FALSE
;

1399 ià(
show_»asÚšg
)

1400 
	`åršt_msg
(" Start code %02X is„eserved in H.262, so‚ot H.262\n",

1401 
un™
->
¡¬t_code
);

1403 ià(
un™
->
¡¬t_code
 == 0xB4 ||

1404 
un™
->
¡¬t_code
 == 0xB8)

1406 *
maybe_avs
 = 
FALSE
;

1407 ià(
show_»asÚšg
)

1408 
	`åršt_msg
(" Start code %02X is„eserved in AVS, so‚ot AVS\n",

1409 
un™
->
¡¬t_code
);

1412 ià(*
maybe_h264
)

1414 ià(
show_»asÚšg
)

1415 
	`´št_msg
(" Top bit‚ot set, so might be H.264\n");

1418 
Çl_»f_idc
 = (
un™
->
¡¬t_code
 & 0x60) >> 5;

1419 
Çl_un™_ty³
 = (
un™
->
¡¬t_code
 & 0x1F);

1421 ià(
show_»asÚšg
)

1422 
	`åršt_msg
(" Interpreting it‡s‚al_ref_idc %d,‚al_unit_type %d\n",

1423 
Çl_»f_idc
,
Çl_un™_ty³
);

1425 ià(
Çl_un™_ty³
 > 12 &&‚al_unit_type < 24)

1427 ià(
show_»asÚšg
)

1428 
	`åršt_msg
(" H.264„eserves‚al_unit_type %02X,"

1429 " sØnÙ H.264\n",
Çl_un™_ty³
);

1430 *
maybe_h264
 = 
FALSE
;

1432 ià(
Çl_un™_ty³
 > 23)

1434 ià(
show_»asÚšg
)

1435 
	`åršt_msg
(" H.264 does‚ot specify‚al_unit_type %02X,"

1436 " sØnÙ H.264\n",
Çl_un™_ty³
);

1437 *
maybe_h264
 = 
FALSE
;

1439 ià(
Çl_»f_idc
 == 0)

1441 ià(
Çl_un™_ty³
 == 5 ||

1442 
Çl_un™_ty³
 == 7 ||

1443 
Çl_un™_ty³
 == 8)

1445 ià(
show_»asÚšg
)

1446 
	`åršt_msg
(" H.264 does‚ot‡llow‚al_ref_idc 0‡nd‚al_unit_type %d,"

1447 " sØnÙ H.264\n",
Çl_un™_ty³
);

1448 *
maybe_h264
 = 
FALSE
;

1454 ià(
Çl_un™_ty³
 == 6 ||

1455 
Çl_un™_ty³
 == 9 ||

1456 
Çl_un™_ty³
 == 10 ||

1457 
Çl_un™_ty³
 == 11 ||

1458 
Çl_un™_ty³
 == 12)

1460 ià(
show_»asÚšg
)

1461 
	`åršt_msg
(" H.264 insists‚al_ref_idc shall be 0 for‚al_unit_type %d,"

1462 " sØnÙ H.264\n",
Çl_un™_ty³
);

1463 *
maybe_h264
 = 
FALSE
;

1468 
	}
}

1486 
	$decide_ES_video_ty³
(
ES_p
 
es
,

1487 
´št_dÙs
,

1488 
show_»asÚšg
,

1489 *
video_ty³
)

1491 
”r
;

1492 
ii
;

1493 
maybe_h262
 = 
TRUE
;

1494 
maybe_h264
 = 
TRUE
;

1495 
maybe_avs
 = 
TRUE
;

1496 
decided
 = 
FALSE
;

1498 
ES_un™
 
un™
;

1500 *
video_ty³
 = 
VIDEO_UNKNOWN
;

1502 
”r
 = 
	`£tup_ES_un™
(&
un™
);

1503 ià(
”r
)

1505 
	`´št_”r
("### Errorryingo setup ES unit before"

1520 ià(
show_»asÚšg
)

1521 
	`´št_msg
("Lookinghrough first 500 ES unitsoryo decide videoype\n");

1522 
ii
=0; ii<500; ii++)

1524 ià(
´št_dÙs
)

1526 
	`´št_msg
(".");

1527 
	`fæush
(
¡dout
);

1529 ià(
show_»asÚšg
)

1530 
	`åršt_msg
("%d: ",
ii
+1);

1532 
”r
 = 
	`fšd_Ãxt_ES_un™
(
es
,&
un™
);

1533 ià(
”r
 =ğ
EOF
)

1535 ià(
´št_dÙs
è
	`´št_msg
("\n");

1536 ià(
show_»asÚšg
è
	`åršt_msg
("End oàfe,ryšgØ»ad ES un™ %d\n",
ii
+2);

1539 ià(
”r
)

1541 ià(
´št_dÙs
è
	`´št_msg
("\n");

1542 
	`åršt_”r
("### Errorryingo find 'unit' %d in ES whilst"

1543 " wÜkšg ouˆvideØty³\n",
ii
+2);

1544 
	`ş—r_ES_un™
(&
un™
);

1547 
”r
 = 
	`Œy_to_guess_video_ty³
(&
un™
,
show_»asÚšg
,

1548 &
maybe_h264
,&
maybe_h262
,&
maybe_avs
);

1549 ià(
”r
)

1551 ià(
´št_dÙs
è
	`´št_msg
("\n");

1552 
	`´št_”r
("### Whilstryingo work out video_type\n");

1553 
	`ş—r_ES_un™
(&
un™
);

1557 ià(
maybe_h264
 && !
maybe_h262
 && !
maybe_avs
)

1559 ià(
show_»asÚšg
è
	`´št_msg
(" Which†eaves only H.264\n");

1560 *
video_ty³
 = 
VIDEO_H264
;

1561 
decided
 = 
TRUE
;

1563 ià(!
maybe_h264
 && 
maybe_h262
 && !
maybe_avs
)

1565 ià(
show_»asÚšg
è
	`´št_msg
(" Which†eaves only H.262\n");

1566 *
video_ty³
 = 
VIDEO_H262
;

1567 
decided
 = 
TRUE
;

1569 ià(!
maybe_h264
 && !
maybe_h262
 && 
maybe_avs
)

1571 ià(
show_»asÚšg
è
	`´št_msg
(" Which†eaves only AVS\n");

1572 *
video_ty³
 = 
VIDEO_AVS
;

1573 
decided
 = 
TRUE
;

1577 ià(
show_»asÚšg
)

1578 
	`´št_msg
(" It is‚ot…ossibleo decide fromhat start code\n");

1580 ià(
decided
)

1583 ià(
´št_dÙs
è
	`´št_msg
("\n");

1584 
	`ş—r_ES_un™
(&
un™
);

1586 
	}
}

1607 
	$decide_ES_fe_video_ty³
(
šput
,

1608 
´št_dÙs
,

1609 
show_»asÚšg
,

1610 *
video_ty³
)

1612 
off£t_t
 
¡¬t_po¢
;

1613 
”r
;

1614 
ES_p
 
es
 = 
NULL
;

1616 
¡¬t_po¢
 = 
	`‹Î_fe
(
šput
);

1617 ià(
¡¬t_po¢
 == -1)

1619 
	`´št_”r
("### Error„emembering start…osition in file before"

1624 
”r
 = 
	`£ek_fe
(
šput
,0);

1625 ià(
”r
)

1627 
	`´št_”r
("### Error„ewinding file before working out videoype\n");

1631 
”r
 = 
	`bud_–em’ry_¡»am_fe
(
šput
,&
es
);

1632 ià(
”r
)

1634 
	`´št_”r
("### Error startingƒlementary stream before"

1639 
”r
 = 
	`decide_ES_video_ty³
(
es
,
´št_dÙs
,
show_»asÚšg
,
video_ty³
);

1640 ià(
”r
)

1642 
	`´št_”r
("### Error deciding videoype of file\n");

1643 
	`ä“_–em’ry_¡»am
(&
es
);

1647 
	`ä“_–em’ry_¡»am
(&
es
);

1649 
”r
 = 
	`£ek_fe
(
šput
,
¡¬t_po¢
);

1650 ià(
”r
)

1652 
	`´št_”r
("### Error„eturningo start…osition in file‡fter"

1657 
	}
}

	@es2ts.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<fú.h
>

33 
	~<”ºo.h
>

34 #ifdeà
_WIN32


35 
	~<¡ddef.h
>

37 
	~<uni¡d.h
>

40 
	~"com·t.h
"

41 
	~"es_âs.h
"

42 
	~"ts_âs.h
"

43 
	~"tswr™e_âs.h
"

44 
	~"misc_âs.h
"

45 
	~"´štšg_âs.h
"

46 
	~"v”siÚ.h
"

55 
	$wr™e_ES_un™_as_TS
(
TS_wr™”_p
 
ouut
,

56 
ES_un™_p
 
un™
,

57 
ušt32_t
 
video_pid
)

59 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
,
un™
->
d©a
,un™->
d©a_Ën
,

60 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

61 ià(
”r
)

63 
	`´št_”r
("### Error writing ES data unit\n");

64  
”r
;

68 
	}
}

70 
	$Œªsãr_d©a
(
ES_p
 
es
,

71 
TS_wr™”_p
 
ouut
,

72 
ušt32_t
 
pmt_pid
,

73 
ušt32_t
 
video_pid
,

74 
by‹
 
¡»am_ty³
,

75 
max
,

76 
v”bo£
,

77 
qu›t
)

79 
”r
 = 0;

80 
couÁ
 = 0;

83 ià(!
qu›t
)

84 
	`åršt_msg
("Usingransport stream id 1, PMT PID %#x,…rogram 1 ="

85 " PID %#x, sŒ—my³ %#x\n",
pmt_pid
,
video_pid
,

86 
¡»am_ty³
);

87 
”r
 = 
	`wr™e_TS_´og¿m_d©a
(
ouut
,1,1,
pmt_pid
,
video_pid
,
¡»am_ty³
);

88 ià(
”r
)

90 
	`´št_”r
("### Error writing out TS…rogram data\n");

96 
ES_un™_p
 
un™
;

98 
”r
 = 
	`fšd_ªd_bud_Ãxt_ES_un™
(
es
,&
un™
);

99 ià(
”r
 =ğ
EOF
)

101 ià(
”r
)

103 
	`´št_”r
("### Error copying ES data units\n");

104  
”r
;

106 
couÁ
++;

108 ià(
v”bo£
)

109 
	`»pÜt_ES_un™
(
FALSE
,
un™
);

111 
”r
 = 
	`wr™e_ES_un™_as_TS
(
ouut
,
un™
,
video_pid
);

112 ià(
”r
)

114 
	`ä“_ES_un™
(&
un™
);

115 
	`´št_”r
("### Error copying ES data units\n");

116  
”r
;

119 
	`ä“_ES_un™
(&
un™
);

121 ià(
max
 > 0 && 
couÁ
 >= max)

124 ià(!
qu›t
)

125 
	`åršt_msg
("T¿nsã¼ed %d ES d©¨un™%s\n",
couÁ
,(count==1?"":"s"));

127 
	}
}

129 
	$´št_u§ge
()

131 
	`´št_msg
( "Usage:ƒs2ts [switches] [<infile>] [<outfile>]\n"

134 
	`REPORT_VERSION
("es2ts");

135 
	`´št_msg
(

192 
	}
}

194 
	$maš
(
¬gc
, **
¬gv
)

196 
u£_¡dš
 = 
FALSE
;

197 
u£_¡dout
 = 
FALSE
;

198 
u£_tı
 = 
FALSE
;

199 
pÜt
 = 88;

200 *
šput_Çme
 = 
NULL
;

201 *
ouut_Çme
 = 
NULL
;

202 
had_šput_Çme
 = 
FALSE
;

203 
had_ouut_Çme
 = 
FALSE
;

204 
TS_wr™”_p
 
ouut
 = 
NULL
;

205 
ES_p
 
es
;

206 
v”bo£
 = 
FALSE
;

207 
qu›t
 = 
FALSE
;

208 
max
 = 0;

209 
ušt32_t
 
video_pid
 = 0x68;

210 
ušt32_t
 
pmt_pid
 = 0x66;

211 
”r
 = 0;

212 
”r2
;

213 
ii
 = 1;

215 
video_ty³
 = 
VIDEO_H262
;

216 
fÜû_¡»am_ty³
 = 
FALSE
;

217 
by‹
 
¡»am_ty³
 = 0;

219 ià(
¬gc
 < 2)

221 
	`´št_u§ge
();

225 
ii
 < 
¬gc
)

227 ià(
¬gv
[
ii
][0] == '-')

229 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-help",argv[ii]) ||

230 !
	`¡rcmp
("-h",
¬gv
[
ii
]))

232 
	`´št_u§ge
();

235 ià(!
	`¡rcmp
("-avc",
¬gv
[
ii
]) || !strcmp("-h264",argv[ii]))

237 
fÜû_¡»am_ty³
 = 
TRUE
;

238 
video_ty³
 = 
VIDEO_H264
;

240 ià(!
	`¡rcmp
("-h262",
¬gv
[
ii
]))

242 
fÜû_¡»am_ty³
 = 
TRUE
;

243 
video_ty³
 = 
VIDEO_H262
;

245 ià(!
	`¡rcmp
("-avs",
¬gv
[
ii
]))

247 
fÜû_¡»am_ty³
 = 
TRUE
;

248 
video_ty³
 = 
VIDEO_AVS
;

250 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

252 
had_šput_Çme
 = 
TRUE
;

253 
u£_¡dš
 = 
TRUE
;

255 ià(!
	`¡rcmp
("-¡dout",
¬gv
[
ii
]))

257 
had_ouut_Çme
 = 
TRUE
;

258 
u£_¡dout
 = 
TRUE
;

259 
	`»dœeù_ouut_¡d”r
();

261 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

263 
	`CHECKARG
("es2ts",
ii
);

264 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

265 
	`»dœeù_ouut_¡d”r
();

266 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

267 
	`»dœeù_ouut_¡dout
();

270 
	`åršt_”r
("###ƒs2ts: "

272 " '¡d”r')\n",
¬gv
[
ii
+1]);

275 
ii
++;

277 ià(!
	`¡rcmp
("-ho¡",
¬gv
[
ii
]))

279 
	`CHECKARG
("es2ts",
ii
);

280 
”r
 = 
	`ho¡_v®ue
("es2ts",
¬gv
[
ii
],¬gv[ii+1],&
ouut_Çme
,&
pÜt
);

281 ià(
”r
)  1;

282 
had_ouut_Çme
 = 
TRUE
;

283 
u£_tı
 = 
TRUE
;

284 
ii
++;

286 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

288 
v”bo£
 = 
TRUE
;

289 
qu›t
 = 
FALSE
;

291 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

293 
v”bo£
 = 
FALSE
;

294 
qu›t
 = 
TRUE
;

296 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

298 
	`CHECKARG
("es2ts",
ii
);

299 
”r
 = 
	`št_v®ue
("es2ts",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

300 ià(
”r
)  1;

301 
ii
++;

303 ià(!
	`¡rcmp
("-pid",
¬gv
[
ii
]))

305 
	`CHECKARG
("es2ts",
ii
);

306 
”r
 = 
	`unsigÃd_v®ue
("es2ts",
¬gv
[
ii
],¬gv[ii+1],0,&
video_pid
);

307 ià(
”r
)  1;

308 
ii
++;

310 ià(!
	`¡rcmp
("-pmt",
¬gv
[
ii
]))

312 
	`CHECKARG
("es2ts",
ii
);

313 
”r
 = 
	`unsigÃd_v®ue
("es2ts",
¬gv
[
ii
],¬gv[ii+1],0,&
pmt_pid
);

314 ià(
”r
)  1;

315 
ii
++;

319 
	`åršt_”r
("###ƒs2ts: "

320 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

326 ià(
had_šput_Çme
 && 
had_ouut_Çme
)

328 
	`åršt_”r
("###ƒs2ts: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

331 ià(
had_šput_Çme
)

333 
ouut_Çme
 = 
¬gv
[
ii
];

334 
had_ouut_Çme
 = 
TRUE
;

338 
šput_Çme
 = 
¬gv
[
ii
];

339 
had_šput_Çme
 = 
TRUE
;

342 
ii
++;

345 ià(!
had_šput_Çme
)

347 
	`´št_”r
("###ƒs2ts: No input file specified\n");

350 ià(!
had_ouut_Çme
)

352 
	`´št_”r
("###ƒs2ts: No output file specified\n");

357 ià(
u£_¡dout
)

359 
v”bo£
 = 
FALSE
;

360 
qu›t
 = 
TRUE
;

363 ià(
u£_¡dš
)

364 
”r
 = 
	`İ’_–em’ry_¡»am
(
NULL
,&
es
);

366 
”r
 = 
	`İ’_–em’ry_¡»am
(
šput_Çme
,&
es
);

367 ià(
”r
)

369 
	`´št_”r
("###ƒs2ts: "

374 ià(!
qu›t
)

375 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

378 ià(
fÜû_¡»am_ty³
 || 
u£_¡dš
)

380 ià(!
qu›t
è
	`´št_msg
("Reading input‡s ");

384 
video_ty³
;

385 
”r
 = 
	`decide_ES_fe_video_ty³
(
es
->
šput
,
FALSE
,
v”bo£
,&
video_ty³
);

386 ià(
”r
)

388 
	`´št_”r
("###ƒs2ts: Error deciding on streamype\n");

389 
	`şo£_–em’ry_¡»am
(&
es
);

392 ià(!
qu›t
è
	`´št_msg
("Input‡ppearso be ");

395 
video_ty³
)

397 
VIDEO_H262
:

398 
¡»am_ty³
 = 
MPEG2_VIDEO_STREAM_TYPE
;

399 ià(!
qu›t
è
	`´št_msg
("MPEG-2 (H.262)\n");

401 
VIDEO_H264
:

402 
¡»am_ty³
 = 
AVC_VIDEO_STREAM_TYPE
;

403 ià(!
qu›t
è
	`´št_msg
("MPEG-4/AVC (H.264)\n");

405 
VIDEO_AVS
:

406 
¡»am_ty³
 = 
AVS_VIDEO_STREAM_TYPE
;

407 ià(!
qu›t
è
	`´št_msg
("AVS\n");

409 
VIDEO_UNKNOWN
:

410 ià(!
qu›t
è
	`´št_msg
("Unknown\n");

411 
	`´št_”r
("###ƒs2ts: Input videoype is‚ot„ecognised\n");

412 
	`şo£_–em’ry_¡»am
(&
es
);

417 ià(
u£_¡dout
)

418 
”r
 = 
	`tswr™e_İ’
(
TS_W_STDOUT
,
NULL
,NULL,0,
qu›t
,&
ouut
);

419 ià(
u£_tı
)

420 
”r
 = 
	`tswr™e_İ’
(
TS_W_TCP
,
ouut_Çme
,
NULL
,
pÜt
,
qu›t
,&
ouut
);

422 
”r
 = 
	`tswr™e_İ’
(
TS_W_FILE
,
ouut_Çme
,
NULL
,0,
qu›t
,&
ouut
);

423 ià(
”r
)

425 
	`şo£_–em’ry_¡»am
(&
es
);

426 
	`åršt_”r
("###ƒs2ts: UÇbËØİ’ %s\n",
ouut_Çme
);

430 ià(
max
 && !
qu›t
)

431 
	`åršt_msg
("Stİpšg‡á” %d ES d©¨un™s\n",
max
);

433 
”r
 = 
	`Œªsãr_d©a
(
es
,
ouut
,
pmt_pid
,
video_pid
,
¡»am_ty³
,

434 
max
,
v”bo£
,
qu›t
);

435 ià(
”r
)

436 
	`´št_”r
("###ƒs2ts: Errorransferring data\n");

438 
	`şo£_–em’ry_¡»am
(&
es
);

439 
”r2
 = 
	`tswr™e_şo£
(
ouut
,
qu›t
);

440 ià(
”r2
)

442 
	`åršt_”r
("###ƒs2ts: E¼Ü closšg ouuˆ%s: %s\n",
ouut_Çme
,

443 
	`¡»¼Ü
(
”ºo
));

446 ià(
”r
)

450 
	}
}

	@es_defns.h

29 #iâdeà
_es_deâs


30 
	#_es_deâs


	)

32 
	~<¡dio.h
>

33 
	~"com·t.h
"

34 
	~"³s_deâs.h
"

41 
	s_ES_off£t


43 
off£t_t
 
	mšfe
;

44 
št32_t
 
	mš·ck‘
;

46 
_ES_off£t
 
	tES_off£t
;

47 
_ES_off£t
 *
	tES_off£t_p
;

48 
	#SIZEOF_ES_OFFSET
 (
_ES_off£t
)

	)

52 
	#ES_READ_AHEAD_SIZE
 1000

	)

57 
	s–em’ry_¡»am


59 
	m»adšg_ES
;

63 
	mšput
;

65 
by‹
 
	m»ad_ah—d
[
ES_READ_AHEAD_SIZE
];

66 
off£t_t
 
	m»ad_ah—d_po¢
;

67 
št32_t
 
	m»ad_ah—d_Ën
;

76 
ES_off£t
 
	mpo¢_of_Ãxt_by‹
;

80 
PES_»ad”_p
 
	m»ad”
;

82 
by‹
 *
	md©a
;

83 
by‹
 *
	md©a_’d
;

84 
by‹
 *
	md©a_±r
;

86 
off£t_t
 
	mÏ¡_·ck‘_po¢
;

87 
št32_t
 
	mÏ¡_·ck‘_es_d©a_Ën
;

90 
by‹
 
	mcur_by‹
;

91 
by‹
 
	m´ev1_by‹
;

92 
by‹
 
	m´ev2_by‹
;

94 
–em’ry_¡»am
 *
	tES_p
;

95 
	#SIZEOF_ES
 (
–em’ry_¡»am
)

	)

110 
	sES_un™


112 
ES_off£t
 
	m¡¬t_po¢
;

113 
by‹
 *
	md©a
;

114 
ušt32_t
 
	md©a_Ën
;

115 
ušt32_t
 
	md©a_size
;

117 
by‹
 
	m¡¬t_code
;

121 
by‹
 
	mPES_had_PTS
;

123 
ES_un™
 *
	tES_un™_p
;

124 
	#SIZEOF_ES_UNIT
 (
ES_un™
)

	)

127 
	#ES_UNIT_DATA_START_SIZE
 1000

128 
	#ES_UNIT_DATA_INCREMENT
 500

129 

	)

132 
	sES_un™_li¡


134 
ES_un™
 *
	m¬¿y
;

135 
	mËngth
;

136 
	msize
;

138 
ES_un™_li¡
 *
	tES_un™_li¡_p
;

139 
	#SIZEOF_ES_UNIT_LIST
 (
ES_un™_li¡
)

	)

141 
	#ES_UNIT_LIST_START_SIZE
 20

	)

142 
	#ES_UNIT_LIST_INCREMENT
 20

	)

	@es_fns.h

29 #iâdeà
_es_âs


30 
	#_es_âs


	)

32 
	~"es_deâs.h
"

52 
İ’_–em’ry_¡»am
(*
f’ame
,

53 
ES_p
 *
es
);

69 
bud_–em’ry_¡»am_fe
(
šput
,

70 
ES_p
 *
es
);

86 
bud_–em’ry_¡»am_PES
(
PES_»ad”_p
 
»ad”
,

87 
ES_p
 *
es
);

101 
ä“_–em’ry_¡»am
(
ES_p
 *
es
);

115 
şo£_–em’ry_¡»am
(
ES_p
 *
es
);

128 
es_commªd_chªged
(
ES_p
 
es
);

141 
£tup_ES_un™
(
ES_un™_p
 
un™
);

148 
ş—r_ES_un™
(
ES_un™_p
 
un™
);

155 
bud_ES_un™
(
ES_un™_p
 *
un™
);

165 
bud_ES_un™_äom_d©a
(
ES_un™_p
 *
un™
,

166 
by‹
 *
d©a
,

167 
ušt32_t
 
d©a_Ën
);

176 
ä“_ES_un™
(
ES_un™_p
 *
un™
);

181 
»pÜt_ES_un™
(
is_msg
,

182 
ES_un™_p
 
un™
);

197 
g‘_’d_of_und”lyšg_PES_·ck‘
(
ES_p
 
es
,

198 
by‹
 **
d©a
,

199 *
d©a_Ën
);

214 
fšd_Ãxt_ES_un™
(
ES_p
 
es
,

215 
ES_un™_p
 
un™
);

229 
fšd_ªd_bud_Ãxt_ES_un™
(
ES_p
 
es
,

230 
ES_un™_p
 *
un™
);

243 
wr™e_ES_un™
(
FILE
 *
ouut
,

244 
ES_un™_p
 
un™
);

260 
£ek_ES
(
ES_p
 
es
,

261 
ES_off£t
 
wh”e
);

293 
»ad_ES_d©a
(
ES_p
 
es
,

294 
ES_off£t
 
¡¬t_po¢
,

295 
ušt32_t
 
num_by‹s
,

296 
ušt32_t
 *
d©a_Ën
,

297 
by‹
 **
d©a
);

308 
bud_ES_un™_li¡
(
ES_un™_li¡_p
 *
li¡
);

318 
­³nd_to_ES_un™_li¡
(
ES_un™_li¡_p
 
li¡
,

319 
ES_un™_p
 
un™
);

324 
»£t_ES_un™_li¡
(
ES_un™_li¡_p
 
li¡
);

333 
ä“_ES_un™_li¡
(
ES_un™_li¡_p
 *
li¡
);

341 
»pÜt_ES_un™_li¡
(*
Çme
,

342 
ES_un™_li¡_p
 
li¡
);

354 
g‘_ES_un™_li¡_bounds
(
ES_un™_li¡_p
 
li¡
,

355 
ES_off£t
 *
¡¬t
,

356 
ušt32_t
 *
Ëngth
);

367 
§me_ES_un™_li¡
(
ES_un™_li¡_p
 
li¡1
,

368 
ES_un™_li¡_p
 
li¡2
);

376 
com·»_ES_off£ts
(
ES_off£t
 
off£t1
,

377 
ES_off£t
 
off£t2
);

398 
decide_ES_video_ty³
(
ES_p
 
es
,

399 
´št_dÙs
,

400 
show_»asÚšg
,

401 *
video_ty³
);

421 
decide_ES_fe_video_ty³
(
šput
,

422 
´št_dÙs
,

423 
show_»asÚšg
,

424 *
video_ty³
);

	@esdots.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<”ºo.h
>

34 
	~<fú.h
>

35 
	~<¡ršg.h
>

37 #ifdeà
_WIN32


38 
	~<¡ddef.h
>

40 
	~<uni¡d.h
>

44 
	~"com·t.h
"

45 
	~"es_âs.h
"

46 
	~"³s_âs.h
"

47 
	~"acûssun™_âs.h
"

48 
	~"h262_âs.h
"

49 
	~"avs_âs.h
"

50 
	~"´štšg_âs.h
"

51 
	~"misc_âs.h
"

52 
	~"v”siÚ.h
"

54 
	gäame_¿‹
 = 25.0;

56 
šlše


57 
	$umod
(
a
, 
b
)

59 
r
 = 
a
 % 
b
;

60  
r
 < 0 ?„ + 
b
 :„;

61 
	}
}

67 
	$h262_™em_dÙ
(
h262_™em_p
 
™em
,

68 *
d–_gİ
,

69 
show_gİ_time
)

71 *
¡r
 = 
NULL
;

73 
äames
 = 0;

74 
‹mp_äames
 = 0;

75 
pic_codšg_ty³
 = 0;

78 ià(
™em
->
un™
.
¡¬t_code
 == 0xB3)

80 *
d–_gİ
 = (
äames
 - 
‹mp_äames
)/
äame_¿‹
;

81 
‹mp_äames
 = 
äames
;

82 ià(
show_gİ_time
 && 
‹mp_äames
)

83 
	`åršt_msg
(": %2.4fs\n", *
d–_gİ
);

86 ià(
™em
->
un™
.
¡¬t_code
 == 0x00)

88 ià(
äames
 % (()
äame_¿‹
*60) == 0)

89 
	`åršt_msg
("\À%d mšu‹%s\n",
äames
/()(
äame_¿‹
*60),

90 (
äames
/()(
äame_¿‹
*60)==1?"":"s"));

91 
äames
++;

94 
™em
->
un™
.
¡¬t_code
)

97 
¡r
 = (
™em
->
piùu»_codšg_ty³
==1?"i":

98 
™em
->
piùu»_codšg_ty³
==2?"p":

99 
™em
->
piùu»_codšg_ty³
==3?"b":

100 
™em
->
piùu»_codšg_ty³
==4?"d":"x");

101 
pic_codšg_ty³
 = 
™em
->
piùu»_codšg_ty³
;

103 0xB0: 
¡r
 = "R"; ;

104 0xB1: 
¡r
 = "R"; ;

105 0xB2: 
¡r
 = "U"; ;

106 0xB3: 
¡r
 = "["; ;

107 0xB4: 
¡r
 = "X"; ;

108 0xB5: 
¡r
 = "E"; ;

109 0xB6: 
¡r
 = "R"; ;

110 0xB7: 
¡r
 = "]"; ;

111 0xB8: 
¡r
 = ">"; ;

114 ià(
¡r
 =ğ
NULL
)

116 ià(
™em
->
un™
.
¡¬t_code
 >= 0x01 && item->unit.start_code <= 0xAF)

119 
¡r
 = "?";

123 
	`´št_msg
(
¡r
);

124 
	`fæush
(
¡dout
);

125  
pic_codšg_ty³
;

126 
	}
}

137 
	$»pÜt_h262_fe_as_dÙs
(
ES_p
 
es
,

138 
max
,

139 
v”bo£
,

140 
show_gİ_time
)

142 
”r
;

143 
couÁ
 = 0;

144 
time_gİ
 = 0.0;

145 
gİs
 = 0;

146 
time_gİ_max
 = 0.0;

147 
time_gİ_mš
 = 1000.0;

148 
time_gİ_tÙ
 = 0.0;

149 
pic_codšg_ty³
;

150 
num_i
 = 0;

151 
num_p
 = 0;

152 
num_b
 = 0;

154 ià(
v”bo£
)

155 
	`´št_msg
("\n"

179 
h262_™em_p
 
™em
;

180 
”r
 = 
	`fšd_Ãxt_h262_™em
(
es
,&
™em
);

181 ià(
”r
 =ğ
EOF
)

183 ià(
”r
)

185 
	`´št_”r
("### Error copying NAL units\n");

186  
”r
;

188 
couÁ
++;

189 
pic_codšg_ty³
 = 
	`h262_™em_dÙ
(
™em
, &
time_gİ
, 
show_gİ_time
);

190 
pic_codšg_ty³
) {

191 1: 
num_i
++; ;

192 2: 
num_p
++; ;

193 3: 
num_b
++; ;

198 if(
™em
->
un™
.
¡¬t_code
 == 0xB3)

200 
time_gİ_max
 = 
	`max
Ñime_gİ_max, 
time_gİ
);

201 ià(
gİs
)

202 
time_gİ_mš
 = 
	`mš
Ñime_gİ_mš, 
time_gİ
);

203 
gİs
++;

204 
time_gİ_tÙ
 +ğ
time_gİ
;

207 
	`ä“_h262_™em
(&
™em
);

209 ià(
max
 > 0 && 
couÁ
 >= max)

212 
	`åršt_msg
("\nFound %d MPEG2 i‹m%s\n",
couÁ
,(count==1?"":"s"));

213 
	`åršt_msg
("%lu I, %lu P, %lu B\n",
num_i
,
num_p
,
num_b
);

214 
	`åršt_msg
("GOPime (s): max=%2.4f, mš=%2.4f, m—n=%2.6à(äam¿‹ = %2.2f)\n",
time_gİ_max
,

215 
time_gİ_mš
,
time_gİ_tÙ
/(
gİs
-1), 
äame_¿‹
);

217 
	}
}

228 
	$»pÜt_avs_fe_as_dÙs
(
ES_p
 
es
,

229 
max
,

230 
v”bo£
)

232 
”r
 = 0;

233 
couÁ
 = 0;

234 
äames
 = 0;

236 
avs_cÚ‹xt_p
 
cÚ‹xt
;

238 ià(
v”bo£
)

239 
	`´št_msg
("\n"

259 
”r
 = 
	`bud_avs_cÚ‹xt
(
es
,&
cÚ‹xt
);

260 ià(
”r
) ƒrr;

264 
avs_äame_p
 
avs_äame
;

266 
”r
 = 
	`g‘_Ãxt_avs_äame
(
cÚ‹xt
,
TRUE
,
FALSE
,&
avs_äame
);

267 ià(
”r
 =ğ
EOF
)

269 ià(
”r
)

271 
	`ä“_avs_cÚ‹xt
(&
cÚ‹xt
);

275 ià(
avs_äame
->
is_äame
)

277 
äames
 ++;

278 ià(
avs_äame
->
piùu»_codšg_ty³
 =ğ
AVS_I_PICTURE_CODING
)

279 
	`´št_msg
("i");

280 ià(
avs_äame
->
piùu»_codšg_ty³
 =ğ
AVS_P_PICTURE_CODING
)

281 
	`´št_msg
("p");

282 ià(
avs_äame
->
piùu»_codšg_ty³
 =ğ
AVS_B_PICTURE_CODING
)

283 
	`´št_msg
("b");

285 
	`´št_msg
("!");

287 ià(
äames
 % ()(
äame_¿‹
*60) == 0)

288 
	`åršt_msg
("\n%d mšu‹%s\n",
äames
/(25*60),(frames/(25*60)==1?"":"s"));

290 ià(
avs_äame
->
¡¬t_code
 < 0xB0)

291 
	`´št_msg
("_");

294 
avs_äame
->
¡¬t_code
)

297 
äame_¿‹
 = 
	`avs_äame_¿‹
(
avs_äame
->
äame_¿‹_code
);

298 
	`´št_msg
("[");

300 0xB1: 
	`´št_msg
("]"); ;

301 0xB2: 
	`´št_msg
("U"); ;

302 0xB5: 
	`´št_msg
("E"); ;

303 0xB7: 
	`´št_msg
("V"); ;

304 : 
	`åršt_msg
("<%x>",
avs_äame
->
¡¬t_code
); ;

308 
	`fæush
(
¡dout
);

309 
couÁ
 ++;

310 
	`ä“_avs_äame
(&
avs_äame
);

312 ià(
max
 > 0 && 
äames
 >= max)

314 
	`åršt_msg
("\nStİpšg beÿu£ %d f¿me havb“À»ad\n",
äames
);

319 
	`åršt_msg
("\nFound %d frame%s in %d AVS item%s\n",

320 
äames
,(äames==1?"":"s"),
couÁ
,(count==1?"":"s"));

321 
	`ä“_avs_cÚ‹xt
(&
cÚ‹xt
);

323 
	}
}

329 
	$choo£_Çl_ty³
(
acûss_un™_p
 
acûss_un™
, *
gİ_¡¬t_found
)

331 
ch¬aù”_Çl_ty³
 = '?';

332 
ii
;

333 
gİ_¡¬t
 = 
FALSE
;

334 
Çl_un™_p
 
‹mp_Çl_un™
;

335 
»c_pošt_»quœed
 = 
FALSE
;

340 ià(
acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

341 
	`´št_msg
("_");

342 ià(
acûss_un™
->
´im¬y_¡¬t
->
Çl_»f_idc
 == 0)

344 ià(
	`®l_¦iûs_I
(
acûss_un™
))

345 
ch¬aù”_Çl_ty³
 = 'i';

346 ià(
	`®l_¦iûs_P
(
acûss_un™
))

347 
ch¬aù”_Çl_ty³
 = 'p';

348 ià(
	`®l_¦iûs_B
(
acûss_un™
))

349 
ch¬aù”_Çl_ty³
 = 'b';

351 
ch¬aù”_Çl_ty³
 = 'x';

353 ià(
acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
)

355 
gİ_¡¬t
 = 
TRUE
;

356 ià(
	`®l_¦iûs_I
(
acûss_un™
))

357 
ch¬aù”_Çl_ty³
 = 'D';

359 
ch¬aù”_Çl_ty³
 = 'd';

361 ià(
acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_NON_IDR
)

363 ià(
	`®l_¦iûs_I
(
acûss_un™
))

365 
ch¬aù”_Çl_ty³
 = 'I';

366 ià(!
»c_pošt_»quœed
)

367 
gİ_¡¬t
 = 
TRUE
;

369 
ii
=0; ii<
acûss_un™
->
Çl_un™s
->
Ëngth
; ii++)

371 
‹mp_Çl_un™
 = 
acûss_un™
->
Çl_un™s
->
¬¿y
[
ii
];

372 ià(
‹mp_Çl_un™
->
Çl_un™_ty³
 =ğ
NAL_SEI
)

374 ià(
‹mp_Çl_un™
->
u
.
£i_»cov”y
.
·ylßdTy³
 == 6)

376 
gİ_¡¬t
 = 
TRUE
;

380 ià(
‹mp_Çl_un™
->
u
.
£i_»cov”y
.
»cov”y_äame_út
 != 0)

381 
	`åršt_msg
("!!!„ecovery_frame_cnt = %d\n",

382 
‹mp_Çl_un™
->
u
.
£i_»cov”y
.
»cov”y_äame_út
);

387 ià(
	`®l_¦iûs_P
(
acûss_un™
))

388 
ch¬aù”_Çl_ty³
 = 'P';

389 ià(
	`®l_¦iûs_B
(
acûss_un™
))

390 
ch¬aù”_Çl_ty³
 = 'B';

392 
ch¬aù”_Çl_ty³
 = 'X';

395 *
gİ_¡¬t_found
 = 
gİ_¡¬t
;

396  
ch¬aù”_Çl_ty³
;

397 
	}
}

404 
	$dÙs_by_acûss_un™
(
ES_p
 
es
,

405 
max
,

406 
v”bo£
,

407 
hash_eos
,

408 
show_gİ_time
)

411 
”r
 = 0;

412 
acûss_un™_couÁ
 = 0;

413 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
;

415 
gİ_¡¬t_found
 = 
FALSE
;

416 
k_äame
 = 0;

417 
size_gİ
;

418 
size_gİ_max
 = 0;

419 
size_gİ_mš
 = 100000;

420 
gİs
 = 0;

421 
size_gİ_tÙ
 = 0;

422 
is_fœ¡_k_äame
 = 
TRUE
;

423 
ch¬_Çl_ty³
 = 'a';

424 
num_idr
 = 0;

425 
num_i
 = 0;

426 
num_p
 = 0;

427 
num_b
 = 0;

429 ià(
v”bo£
)

430 
	`´št_msg
("\n"

447 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&
cÚ‹xt
);

448 ià(
”r
) ƒrr;

452 
acûss_un™_p
 
acûss_un™
;

454 
”r
 = 
	`g‘_Ãxt_h264_äame
(
cÚ‹xt
,
TRUE
,
FALSE
,&
acûss_un™
);

456 ià(
”r
 =ğ
EOF
)

458 ià(
”r
)

460 
	`ä“_acûss_un™_cÚ‹xt
(&
cÚ‹xt
);

464 
ch¬_Çl_ty³
 = 
	`choo£_Çl_ty³
(
acûss_un™
, &
gİ_¡¬t_found
);

469 ià(
gİ_¡¬t_found
)

471 ià(!
is_fœ¡_k_äame
)

473 
size_gİ
 = 
acûss_un™_couÁ
 - 
k_äame
;

474 
size_gİ_max
 = 
	`max
(size_gİ_max, 
size_gİ
);

475 
size_gİ_mš
 = 
	`mš
(size_gİ_mš, 
size_gİ
);

476 
size_gİ_tÙ
 +ğ
size_gİ
;

477 
gİs
++;

478 ià(
show_gİ_time
)

479 
	`åršt_msg
(": %2.4f\n",

480 ()
size_gİ
/
äame_¿‹
 );

483 
is_fœ¡_k_äame
 = 
FALSE
;

484 
k_äame
 = 
acûss_un™_couÁ
;

487 
ch¬_Çl_ty³
) {

489 'i': 
num_i
++; ;

491 'd': 
num_idr
++; ;

493 'p': 
num_p
++; ;

495 'b': 
num_b
++; ;

499 
	`åršt_msg
("%c", 
ch¬_Çl_ty³
);

500 
acûss_un™_couÁ
++;

502 
	`fæush
(
¡dout
);

503 
	`ä“_acûss_un™
(&
acûss_un™
);

506 ià(
cÚ‹xt
->
’d_of_¡»am
)

508 ià(
hash_eos
)

510 
	`´št_msg
("#");

512 
cÚ‹xt
->
’d_of_¡»am
 = 
FALSE
;

513 
cÚ‹xt
->
no_mÜe_d©a
 = 
FALSE
;

517 
	`´št_msg
("\nStopping because foundƒnd-of-stream NAL unit\n");

522 ià(
max
 > 0 && 
cÚ‹xt
->
Çc
->
couÁ
 >= max)

524 
	`åršt_msg
("\nStopping because %d NAL units have been„ead\n",

525 
cÚ‹xt
->
Çc
->
couÁ
);

530 
	`åršt_msg
("\nFound %d NAL unit%s in %d‡ccess unit%s\n",

531 
cÚ‹xt
->
Çc
->
couÁ
,(context->nac->count==1?"":"s"),

532 
acûss_un™_couÁ
,(access_unit_count==1?"":"s"));

533 
	`åršt_msg
("%lu IDR, %lu I, %lu P, %lu B‡cûs un™s\n",
num_idr
, 
num_i
, 
num_p
, 
num_b
);

535 ià(
gİs
)

536 
	`åršt_msg
("GOP size (s): max=%2.4f, min=%2.4f, mean=%2.5f (frame„ate = %2.2f)\n",

537 ()
size_gİ_max
/
äame_¿‹
, ()
size_gİ_mš
/frame_rate,

538 ()
size_gİ_tÙ
/(
äame_¿‹
*
gİs
), frame_rate);

539 
	`ä“_acûss_un™_cÚ‹xt
(&
cÚ‹xt
);

541 
	}
}

554 
	$»pÜt_fe_as_ES_dÙs
(
ES_p
 
es
,

555 
wh©_d©a
,

556 
max
,

557 
v”bo£
)

559 
”r
 = 0;

560 
couÁ
 = 0;

561 
ES_un™
 
un™
;

563 (è
	`£tup_ES_un™
(&
un™
);

565 ià(
v”bo£
)

567 
	`´št_msg
("\n"

569 
wh©_d©a
)

571 
VIDEO_H262
:

572 
	`´št_msg
("Pictures‡re„epresented‡ccordingoheir…icture coding\n"

588 
VIDEO_H264
:

589 
	`´št_msg
("###ƒsdots: -es is‚ot yet supported for H.264\n");

592 
VIDEO_AVS
:

593 
	`´št_msg
("Frames‡re„epresented‡ccordingoheir…icture coding\n"

607 
	`´št_msg
("###ƒsdots: Unexpectedype of data\n");

610 
	`´št_msg
(" ? means somethingƒlse. This may indicatehathe stream\n"

618 
”r
 = 
	`fšd_Ãxt_ES_un™
(
es
,&
un™
);

619 ià(
”r
 =ğ
EOF
)

621 ià(
”r
)

624 
wh©_d©a
)

626 
VIDEO_H262
:

627 
un™
.
¡¬t_code
)

629 
piùu»_codšg_ty³
;

631 
piùu»_codšg_ty³
 = (
un™
.
d©a
[5] & 0x38) >> 3;

632 
piùu»_codšg_ty³
)

634 1: 
	`´št_msg
("i"); ;

635 2: 
	`´št_msg
("p"); ;

636 3: 
	`´št_msg
("b"); ;

637 4: 
	`´št_msg
("d"); ;

638 : 
	`´št_msg
("!"); ;

641 0xB0: 
	`´št_msg
("R"); ;

642 0xB1: 
	`´št_msg
("R"); ;

643 0xB2: 
	`´št_msg
("U"); ;

644 0xB3: 
	`´št_msg
("["); ;

645 0xB4: 
	`´št_msg
("X"); ;

646 0xB5: 
	`´št_msg
("E"); ;

647 0xB6: 
	`´št_msg
("R"); ;

648 0xB7: 
	`´št_msg
("]"); ;

649 0xB8: 
	`´št_msg
(">"); ;

651 ià(
un™
.
¡¬t_code
 >= 0x01 && unit.start_code <= 0xAF)

652 
	`´št_msg
("_");

654 
	`´št_msg
("?");

658 
VIDEO_H264
:

660 
VIDEO_AVS
:

661 
un™
.
¡¬t_code
)

664 
	`´št_msg
("i"); ;

666 
	`avs_piùu»_codšg_ty³
(&
un™
))

668 
AVS_P_PICTURE_CODING
: 
	`´št_msg
("p"); ;

669 
AVS_B_PICTURE_CODING
: 
	`´št_msg
("b"); ;

670 : 
	`´št_msg
("!"); ;

673 0xB0: 
	`´št_msg
("["); ;

674 0xB1: 
	`´št_msg
("]"); ;

675 0xB2: 
	`´št_msg
("U"); ;

676 0xB5: 
	`´št_msg
("E"); ;

677 0xB7: 
	`´št_msg
("V"); ;

679 ià(
un™
.
¡¬t_code
 < 0xB0)

680 
	`´št_msg
("_");

682 
	`´št_msg
("?");

688 
	`fæush
(
¡dout
);

689 
couÁ
 ++;

691 ià(
max
 > 0 && 
couÁ
 >= max)

693 
	`åršt_msg
("\nStİpšg beÿu£ %d ES un™ havb“À»ad\n",
couÁ
);

697 
	`ş—r_ES_un™
(&
un™
);

699 
	`åršt_msg
("\nFound %d ES un™s%s\n",
couÁ
,(count==1?"":"s"));

701 
	}
}

703 
	$´št_u§ge
()

705 
	`´št_msg
(

709 
	`REPORT_VERSION
("esdots");

710 
	`´št_msg
(

757 
	}
}

759 
	$maš
(
¬gc
, **
¬gv
)

761 *
šput_Çme
 = 
NULL
;

762 
had_šput_Çme
 = 
FALSE
;

763 
u£_¡dš
 = 
FALSE
;

764 
”r
 = 0;

765 
ES_p
 
es
 = 
NULL
;

766 
max
 = 0;

767 
v”bo£
 = 
FALSE
;

768 
ii
 = 1;

770 
u£_³s
 = 
FALSE
;

771 
hash_eos
 = 
FALSE
;

773 
wªt_d©a
 = 
VIDEO_H262
;

774 
is_d©a
 = 
wªt_d©a
;

775 
fÜû_¡»am_ty³
 = 
FALSE
;

777 
wªt_ES
 = 
FALSE
;

778 
show_gİ_time
 = 
FALSE
;

780 ià(
¬gc
 < 2)

782 
	`´št_u§ge
();

786 
ii
 < 
¬gc
)

788 ià(
¬gv
[
ii
][0] == '-')

790 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-help",argv[ii]) ||

791 !
	`¡rcmp
("-h",
¬gv
[
ii
]))

793 
	`´št_u§ge
();

796 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

798 
	`CHECKARG
("esdÙs",
ii
);

799 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

800 
	`»dœeù_ouut_¡d”r
();

801 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

802 
	`»dœeù_ouut_¡dout
();

805 
	`åršt_”r
("###ƒsdots: "

807 " '¡d”r')\n",
¬gv
[
ii
+1]);

810 
ii
++;

812 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

814 
had_šput_Çme
 = 
TRUE
;

815 
u£_¡dš
 = 
TRUE
;

817 ià(!
	`¡rcmp
("-avc",
¬gv
[
ii
]) || !strcmp("-h264",argv[ii]))

819 
fÜû_¡»am_ty³
 = 
TRUE
;

820 
wªt_d©a
 = 
VIDEO_H264
;

822 ià(!
	`¡rcmp
("-h262",
¬gv
[
ii
]))

824 
fÜû_¡»am_ty³
 = 
TRUE
;

825 
wªt_d©a
 = 
VIDEO_H262
;

827 ià(!
	`¡rcmp
("-avs",
¬gv
[
ii
]))

829 
fÜû_¡»am_ty³
 = 
TRUE
;

830 
wªt_d©a
 = 
VIDEO_AVS
;

832 ià(!
	`¡rcmp
("-es",
¬gv
[
ii
]))

833 
wªt_ES
 = 
TRUE
;

834 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

835 
v”bo£
 = 
TRUE
;

836 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

838 
	`CHECKARG
("esdÙs",
ii
);

839 
”r
 = 
	`št_v®ue
("esdÙs",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

840 ià(
”r
)  1;

841 
ii
++;

843 ià(!
	`¡rcmp
("-hasheos",
¬gv
[
ii
]))

844 
hash_eos
 = 
TRUE
;

845 ià(!
	`¡rcmp
("-³s",
¬gv
[
ii
]) || !strcmp("-ts",argv[ii]))

846 
u£_³s
 = 
TRUE
;

847 ià(!
	`¡rcmp
("-gİ",
¬gv
[
ii
]))

848 
show_gİ_time
 = 
TRUE
;

849 ià(!
	`¡rcmp
("-ä",
¬gv
[
ii
]))

851 
	`CHECKARG
("esdÙs",
ii
);

852 
”r
 = 
	`doubË_v®ue
("esdÙs",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,&
äame_¿‹
);

853 ià(
”r
)  1;

854 
ii
++;

858 
	`åršt_”r
("###ƒsdots: "

859 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

865 ià(
had_šput_Çme
)

867 
	`åršt_”r
("###ƒsdÙs: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

872 
šput_Çme
 = 
¬gv
[
ii
];

873 
had_šput_Çme
 = 
TRUE
;

876 
ii
++;

879 ià(!
had_šput_Çme
)

881 
	`´št_”r
("###ƒsdots: No input file specified\n");

885 
”r
 = 
	`İ’_šput_as_ES
((
u£_¡dš
?
NULL
:
šput_Çme
),
u£_³s
,
FALSE
,

886 
fÜû_¡»am_ty³
,
wªt_d©a
,&
is_d©a
,&
es
);

887 ià(
”r
)

889 
	`´št_”r
("###ƒsdots: Error opening input file\n");

893 ià(
wªt_ES
)

894 
”r
 = 
	`»pÜt_fe_as_ES_dÙs
(
es
,
is_d©a
,
max
,
v”bo£
);

895 ià(
is_d©a
 =ğ
VIDEO_H262
)

896 
”r
 = 
	`»pÜt_h262_fe_as_dÙs
(
es
,
max
,
v”bo£
,
show_gİ_time
);

897 ià(
is_d©a
 =ğ
VIDEO_H264
)

898 
”r
 = 
	`dÙs_by_acûss_un™
(
es
,
max
,
v”bo£
,
hash_eos
,
show_gİ_time
);

899 ià(
is_d©a
 =ğ
VIDEO_AVS
)

900 
”r
 = 
	`»pÜt_avs_fe_as_dÙs
(
es
,
max
,
v”bo£
);

903 
	`´št_”r
("###ƒsdots: Unexpectedype of video data\n");

906 ià(
”r
)

908 
	`´št_”r
("###ƒsdots: Error…roducing 'dots'\n");

909 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

913 
”r
 = 
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

914 ià(
”r
)

916 
	`´št_”r
("###ƒsdots: Error closing input file\n");

920 
	}
}

	@esfilter.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<”ºo.h
>

34 
	~<fú.h
>

35 
	~<¡ršg.h
>

36 #ifdeà
_WIN32


37 
	~<io.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"es_âs.h
"

44 
	~"³s_âs.h
"

45 
	~"Çlun™_âs.h
"

46 
	~"ts_âs.h
"

47 
	~"acûssun™_âs.h
"

48 
	~"h262_âs.h
"

49 
	~"misc_âs.h
"

50 
	~"´štšg_âs.h
"

51 
	~"tswr™e_âs.h
"

52 
	~"f‹r_âs.h
"

53 
	~"v”siÚ.h
"

55 
	#DEBUG
 0

	)

58 
	eaùiÚs


60 
	mACTION_UNDEFINED
,

61 
	mACTION_COPY
,

62 
	mACTION_STRIP
,

63 
	mACTION_FILTER
,

65 
aùiÚs
 
	tACTION
;

80 
	$cİy_h262
(
ES_p
 
es
,

81 
WRITER
 
ouut
,

82 
as_TS
,

83 
max
,

84 
qu›t
)

86 
”r
;

87 
couÁ
 = 0;

91 
h262_™em_p
 
™em
;

93 
”r
 = 
	`fšd_Ãxt_h262_™em
(
es
,&
™em
);

94 ià(
”r
 =ğ
EOF
)

96 ià(
”r
)

98 
	`´št_”r
("### Error copying NAL units\n");

99  
”r
;

101 
couÁ
++;

103 ià(
as_TS
)

104 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
.
ts_ouut
,
™em
->
un™
.
d©a
,

105 
™em
->
un™
.
d©a_Ën
,
DEFAULT_VIDEO_PID
,

106 
DEFAULT_VIDEO_STREAM_ID
);

108 
”r
 = 
	`wr™e_ES_un™
(
ouut
.
es_ouut
,&(
™em
->
un™
));

109 ià(
”r
)

111 
	`´št_”r
("### Error writing MPEG2 item\n");

112  
”r
;

115 
	`ä“_h262_™em
(&
™em
);

117 ià(
max
 > 0 && 
couÁ
 >= max)

120 ià(!
qu›t
)

121 
	`åršt_msg
("Cİ›d %d MPEG2 i‹m%s\n",
couÁ
,(count==1?"":"s"));

123 
	}
}

134 
	$wr™e_h262_piùu»
(
WRITER
 
ouut
,

135 
as_TS
,

136 
h262_piùu»_p
 
piùu»
)

138 
”r
;

139 ià(
as_TS
)

140 
”r
 = 
	`wr™e_h262_piùu»_as_TS
(
ouut
.
ts_ouut
,
piùu»
,
DEFAULT_VIDEO_PID
);

142 
”r
 = 
	`wr™e_h262_piùu»_as_ES
(
ouut
.
es_ouut
,
piùu»
);

143 ià(
”r
)

145 
	`´št_”r
("### Error writing out H.262…icture\n");

146  
”r
;

149 
	}
}

166 
	$¡r_h262
(
ES_p
 
es
,

167 
WRITER
 
ouut
,

168 
as_TS
,

169 
max
,

170 
k“p_p
,

171 
v”bo£
,

172 
qu›t
)

174 
”r
;

175 
couÁ
;

176 
h262_cÚ‹xt_p
 
h262
 = 
NULL
;

177 
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
 = 
NULL
;

182 
piùu»s_£’
 = 0;

184 
piùu»s_k•t
 = 0;

186 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&
h262
);

187 ià(
”r
)

189 
	`´št_”r
("### Unableo build H.262…icture„eading context\n");

193 
”r
 = 
	`bud_h262_f‹r_cÚ‹xt_¡r
(&
fcÚ‹xt
,
h262
,
k“p_p
);

194 ià(
”r
)

196 
	`´št_”r
("### Unableo build filter context\n");

197 
	`ä“_h262_cÚ‹xt
(&
h262
);

201 
couÁ
 = 1; ; count++)

203 
h262_piùu»_p
 
£q_hdr
 = 
NULL
;

204 
h262_piùu»_p
 
piùu»
 = 
NULL
;

205 
d–_piùu»s_£’
;

206 
”r
 = 
	`g‘_Ãxt_¡r³d_h262_äame
(
fcÚ‹xt
,
v”bo£
,
qu›t
,

207 &
£q_hdr
,&
piùu»
,&
d–_piùu»s_£’
);

208 ià(
”r
 =ğ
EOF
)

210 ià(!
qu›t
è
	`´št_msg
("EOF\n");

213 ià(
”r
)

215 
	`´št_”r
("### Error getting‚ext stripped…icture\n");

216 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

217 
	`ä“_h262_cÚ‹xt
(&
h262
);

221 
piùu»s_£’
 +ğ
d–_piùu»s_£’
;

222 
piùu»s_k•t
 ++;

224 ià(
£q_hdr
 !ğ
NULL
)

226 
”r
 = 
	`wr™e_h262_piùu»
(
ouut
,
as_TS
,
£q_hdr
);

227 ià(
”r
)

229 
	`´št_”r
("### Error writing…icture\n");

230 
	`ä“_h262_piùu»
(&
piùu»
);

231 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

232 
	`ä“_h262_cÚ‹xt
(&
h262
);

237 
”r
 = 
	`wr™e_h262_piùu»
(
ouut
,
as_TS
,
piùu»
);

238 ià(
”r
)

240 
	`´št_”r
("### Error writing…icture\n");

241 
	`ä“_h262_piùu»
(&
piùu»
);

242 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

243 
	`ä“_h262_cÚ‹xt
(&
h262
);

246 
	`ä“_h262_piùu»
(&
piùu»
);

248 ià(
max
 > 0 && 
couÁ
 >= max)

250 ià(!
qu›t
)

251 
	`åršt_msg
("Endšg‡á” %d…iùu»s\n",
couÁ
);

256 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

257 
	`ä“_h262_cÚ‹xt
(&
h262
);

259 ià(!
qu›t
)

261 
	`åršt_msg
("Found %d frames, kept %d (%.1f%%)\n",

262 
piùu»s_£’
,
piùu»s_k•t
,

263 100.0*
piùu»s_k•t
/
piùu»s_£’
);

266 
	}
}

285 
	$f‹r_h262
(
ES_p
 
es
,

286 
WRITER
 
ouut
,

287 
as_TS
,

288 
äequ’cy
,

289 
max
,

290 
v”bo£
,

291 
qu›t
)

293 
”r
;

294 
couÁ
 = 0;

295 
h262_cÚ‹xt_p
 
h262
 = 
NULL
;

296 
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
 = 
NULL
;

301 
piùu»s_£’
 = 0;

303 
piùu»s_k•t
 = 0;

305 
piùu»s_wr™‹n
 = 0;

307 
h262_piùu»_p
 
this_piùu»
 = 
NULL
;

308 
h262_piùu»_p
 
Ï¡_piùu»
 = 
NULL
;

309 
h262_piùu»_p
 
£q_hdr
 = 
NULL
;

311 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&
h262
);

312 ià(
”r
)

314 
	`´št_”r
("### Unableo build H.262…icture„eading context\n");

318 
”r
 = 
	`bud_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
,
h262
,
äequ’cy
);

319 ià(
”r
)

321 
	`´št_”r
("### Unableo build filter context\n");

322 
	`ä“_h262_cÚ‹xt
(&
h262
);

326 
couÁ
 = 1; ; count++)

328 
d–_piùu»s_£’
;

329 
”r
 = 
	`g‘_Ãxt_f‹»d_h262_äame
(
fcÚ‹xt
,
v”bo£
,
qu›t
,&
£q_hdr
,

330 &
this_piùu»
,&
d–_piùu»s_£’
);

331 ià(
”r
 =ğ
EOF
)

333 
	`ä“_h262_piùu»
(&
Ï¡_piùu»
);

336 ià(
”r
)

338 
	`´št_”r
("### Error getting‚ext filtered…icture\n");

339 
	`ä“_h262_piùu»
(&
Ï¡_piùu»
);

340 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

341 
	`ä“_h262_cÚ‹xt
(&
h262
);

345 
piùu»s_£’
 +ğ
d–_piùu»s_£’
;

347 ià(
this_piùu»
 =ğ
NULL
)

350 
this_piùu»
 = 
Ï¡_piùu»
;

351 
Ï¡_piùu»
 = 
NULL
;

354 
piùu»s_k•t
 ++;

356 ià(
£q_hdr
 !ğ
NULL
)

358 
”r
 = 
	`wr™e_h262_piùu»
(
ouut
,
as_TS
,
£q_hdr
);

359 ià(
”r
)

361 
	`´št_”r
("### Error writing sequence header\n");

362 
	`ä“_h262_piùu»
(&
this_piùu»
);

363 
	`ä“_h262_piùu»
(&
Ï¡_piùu»
);

364 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

365 
	`ä“_h262_cÚ‹xt
(&
h262
);

370 ià(
this_piùu»
 !ğ
NULL
)

372 
”r
 = 
	`wr™e_h262_piùu»
(
ouut
,
as_TS
,
this_piùu»
);

373 ià(
”r
)

375 
	`´št_”r
("### Error writing…icture\n");

376 
	`ä“_h262_piùu»
(&
this_piùu»
);

377 
	`ä“_h262_piùu»
(&
Ï¡_piùu»
);

378 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

379 
	`ä“_h262_cÚ‹xt
(&
h262
);

382 
piùu»s_wr™‹n
 ++;

385 
	`ä“_h262_piùu»
(&
Ï¡_piùu»
);

386 
Ï¡_piùu»
 = 
this_piùu»
;

388 ià(
max
 > 0 && 
couÁ
 >= max)

390 ià(!
qu›t
)

391 
	`åršt_msg
("Endšg‡á” %d f¿mes\n",
couÁ
);

392 
	`ä“_h262_piùu»
(&
this_piùu»
);

397 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

398 
	`ä“_h262_cÚ‹xt
(&
h262
);

400 ià(!
qu›t
)

402 
	`´št_msg
("\n");

403 
	`´št_msg
("Summary\n");

404 
	`´št_msg
("=======\n");

405 
	`´št_msg
(" Found Kept Written\n");

406 
	`åršt_msg
("Frames %10d %10d (%4.1f%%) %10d (%4.1f%%)\n",

407 
piùu»s_£’
,
piùu»s_k•t
,

408 100*((()
piùu»s_k•t
)/
piùu»s_£’
),

409 
piùu»s_wr™‹n
,

410 100*((()
piùu»s_wr™‹n
)/
piùu»s_£’
));

411 ià(
äequ’cy
 != 0)

412 
	`åršt_msg
("Target (frames) . %10d (%4.1f%%)‡t„equested"

413 " f»qu’cy %d\n",
piùu»s_£’
/
äequ’cy
,

414 100.0/
äequ’cy
,frequency);

417 
	}
}

424 
	$cİy_Çl_un™s
(
ES_p
 
es
,

425 
WRITER
 
ouut
,

426 
as_TS
,

427 
max
,

428 
v”bo£
,

429 
qu›t
)

431 
”r
 = 0;

432 
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
 = 
NULL
;

434 
”r
 = 
	`bud_Çl_un™_cÚ‹xt
(
es
,&
cÚ‹xt
);

435 ià(
”r
)

437 
	`´št_”r
("### Unableo build NAL unit contexto„ead ES\n");

443 
Çl_un™_p
 
Çl
;

445 ià(
max
 > 0 && 
cÚ‹xt
->
couÁ
 >= max)

448 
”r
 = 
	`fšd_Ãxt_NAL_un™
(
cÚ‹xt
,
v”bo£
,&
Çl
);

449 ià(
”r
 =ğ
EOF
)

451 ià(
”r
 == 2)

453 
	`´št_”r
("!!! Ignoring broken NAL unit\n");

456 ià(
”r
)

458 
	`´št_”r
("### Error getting‚ext NAL unit\n");

459 
	`ä“_Çl_un™_cÚ‹xt
(&
cÚ‹xt
);

460  
”r
;

463 ià(
as_TS
)

464 
”r
 = 
	`wr™e_NAL_un™_as_TS
(
ouut
.
ts_ouut
,
Çl
,
DEFAULT_VIDEO_PID
);

466 
”r
 = 
	`wr™e_NAL_un™_as_ES
(
ouut
.
es_ouut
,
Çl
);

467 ià(
”r
)

469 
	`ä“_Çl_un™
(&
Çl
);

470 
	`´št_”r
("### Error copying NAL units\n");

471 
	`ä“_Çl_un™_cÚ‹xt
(&
cÚ‹xt
);

472  
”r
;

475 
	`ä“_Çl_un™
(&
Çl
);

477 ià(!
qu›t
)

478 
	`åršt_msg
("Processed %d NAL unit%s\n",

479 
cÚ‹xt
->
couÁ
,(context->count==1?"":"s"));

480 
	`ä“_Çl_un™_cÚ‹xt
(&
cÚ‹xt
);

482 
	}
}

492 
	$¡r_acûss_un™s
(
ES_p
 
es
,

493 
WRITER
 
ouut
,

494 
as_TS
,

495 
max
,

496 
k“p_®l_»f
,

497 
v”bo£
,

498 
qu›t
)

500 
”r
 = 0;

501 
couÁ
;

502 
acûss_un™_cÚ‹xt_p
 
acÚ‹xt
 = 
NULL
;

503 
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
 = 
NULL
;

506 
acûss_un™s_£’
 = 0;

507 
acûss_un™s_k•t
 = 0;

509 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&
acÚ‹xt
);

510 ià(
”r
)

512 
	`´št_”r
("### Unableo build‡ccess unit context\n");

515 
”r
 = 
	`bud_h264_f‹r_cÚ‹xt_¡r
(&
fcÚ‹xt
,
acÚ‹xt
,
k“p_®l_»f
);

516 ià(
”r
)

518 
	`´št_”r
("### Unableo build filter context\n");

519 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

523 
couÁ
 = 1; ; count++)

525 
acûss_un™_p
 
acûss_un™
 = 
NULL
;

526 
d–_acûss_un™s_£’
;

527 
”r
 = 
	`g‘_Ãxt_¡r³d_h264_äame
(
fcÚ‹xt
,
v”bo£
,
qu›t
,

528 &
acûss_un™
,

529 &
d–_acûss_un™s_£’
);

530 ià(
”r
 =ğ
EOF
)

532 ià(
”r
)

534 
	`´št_”r
("### Error getting‚ext stripped…icture\n");

535 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

536 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

540 
acûss_un™s_£’
 +ğ
d–_acûss_un™s_£’
;

541 
acûss_un™s_k•t
 ++;

543 ià(
as_TS
)

544 
”r
 = 
	`wr™e_acûss_un™_as_TS
(
acûss_un™
,
fcÚ‹xt
->
acûss_un™_cÚ‹xt
,

545 
ouut
.
ts_ouut
,
DEFAULT_VIDEO_PID
);

547 
”r
 = 
	`wr™e_acûss_un™_as_ES
(
acûss_un™
,
fcÚ‹xt
->
acûss_un™_cÚ‹xt
,

548 
ouut
.
es_ouut
);

549 ià(
”r
)

551 
	`´št_”r
("### Error writing…icture\n");

552 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

553 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

556 
	`ä“_acûss_un™
(&
acûss_un™
);

558 ià(
max
 > 0 && 
couÁ
 >= max)

560 ià(!
qu›t
)

561 
	`åršt_msg
("Endšg‡á” %d f¿mes\n",
couÁ
);

566 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

567 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

569 ià(!
qu›t
)

571 
	`´št_msg
("\n");

572 
	`´št_msg
("Summary\n");

573 
	`´št_msg
("=======\n");

574 
	`´št_msg
(" Found Written\n");

575 
	`åršt_msg
("Access units %10d %10d (%4.1f%%)\n",

576 
acûss_un™s_£’
,

577 
acûss_un™s_k•t
,

578 100*((()
acûss_un™s_k•t
)/
acûss_un™s_£’
));

581 
	}
}

588 
	$f‹r_acûss_un™s
(
ES_p
 
es
,

589 
WRITER
 
ouut
,

590 
as_TS
,

591 
max
,

592 
äequ’cy
,

593 
v”bo£
,

594 
qu›t
)

596 
”r
 = 0;

597 
couÁ
;

598 
acûss_un™_cÚ‹xt_p
 
acÚ‹xt
 = 
NULL
;

599 
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
 = 
NULL
;

602 
acûss_un™s_£’
 = 0;

603 
acûss_un™s_k•t
 = 0;

604 
acûss_un™s_wr™‹n
 = 0;

606 
acûss_un™_p
 
this_acûss_un™
 = 
NULL
;

607 
acûss_un™_p
 
Ï¡_acûss_un™
 = 
NULL
;

609 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&
acÚ‹xt
);

610 ià(
”r
)

612 
	`´št_”r
("### Unableo build‡ccess unit context\n");

615 
”r
 = 
	`bud_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt
,
acÚ‹xt
,
äequ’cy
);

616 ià(
”r
)

618 
	`´št_”r
("### Unableo build filter context\n");

619 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

623 
couÁ
 = 1; ; count++)

625 
d–_acûss_un™s_£’
;

626 
”r
 = 
	`g‘_Ãxt_f‹»d_h264_äame
(
fcÚ‹xt
,
v”bo£
,
qu›t
,

627 &
this_acûss_un™
,

628 &
d–_acûss_un™s_£’
);

629 ià(
”r
 =ğ
EOF
)

631 ià(
”r
)

633 
	`´št_”r
("### Error getting‚ext filtered…icture\n");

634 
	`ä“_acûss_un™
(&
Ï¡_acûss_un™
);

635 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

636 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

640 
acûss_un™s_£’
 +ğ
d–_acûss_un™s_£’
;

642 ià(
this_acûss_un™
 =ğ
NULL
)

645 
this_acûss_un™
 = 
Ï¡_acûss_un™
;

646 
Ï¡_acûss_un™
 = 
NULL
;

649 
acûss_un™s_k•t
 ++;

651 ià(
this_acûss_un™
 !ğ
NULL
)

653 ià(
as_TS
)

654 
”r
 = 
	`wr™e_acûss_un™_as_TS
(
this_acûss_un™
,

655 
fcÚ‹xt
->
acûss_un™_cÚ‹xt
,

656 
ouut
.
ts_ouut
,
DEFAULT_VIDEO_PID
);

658 
”r
 = 
	`wr™e_acûss_un™_as_ES
(
this_acûss_un™
,

659 
fcÚ‹xt
->
acûss_un™_cÚ‹xt
,

660 
ouut
.
es_ouut
);

661 ià(
”r
)

663 
	`´št_”r
("### Error writing…icture\n");

664 
	`ä“_acûss_un™
(&
this_acûss_un™
);

665 
	`ä“_acûss_un™
(&
Ï¡_acûss_un™
);

666 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

667 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

670 
acûss_un™s_wr™‹n
 ++;

673 
	`ä“_acûss_un™
(&
Ï¡_acûss_un™
);

674 
Ï¡_acûss_un™
 = 
this_acûss_un™
;

676 ià(
max
 > 0 && 
couÁ
 >= max)

678 ià(!
qu›t
)

679 
	`åršt_msg
("Endšg‡á” %d f¿mes\n",
couÁ
);

680 
	`ä“_acûss_un™
(&
this_acûss_un™
);

685 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt
);

686 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

688 ià(!
qu›t
)

690 
	`´št_msg
("\n");

691 
	`´št_msg
("Summary\n");

692 
	`´št_msg
("=======\n");

693 
	`´št_msg
(" Found Kept Written\n");

694 
	`åršt_msg
("Frames %10d %10d (%4.1f%%) %10d (%4.1f%%)\n",

695 
acûss_un™s_£’
,

696 
acûss_un™s_k•t
,

697 100*((()
acûss_un™s_k•t
)/
acûss_un™s_£’
),

698 
acûss_un™s_wr™‹n
,

699 100*((()
acûss_un™s_wr™‹n
)/
acûss_un™s_£’
));

700 ià(
äequ’cy
 != 0)

701 
	`åršt_msg
("Target (frames) . %10d (%4.1f%%)‡t„equested"

702 " f»qu’cy %d\n",
acûss_un™s_£’
/
äequ’cy
,

703 100.0/
äequ’cy
,frequency);

706 
	}
}

714 
	$do_aùiÚ
(
ACTION
 
aùiÚ
,

715 
ES_p
 
es
,

716 
WRITER
 
ouut
,

717 
max
,

718 
äequ’cy
,

719 
is_h262
,

720 
as_TS
,

721 
k“p_®l_»f
,

722 
by‹
 
¡»am_ty³
,

723 
v”bo£
,

724 
qu›t
)

726 
”r
 = 0;

729 ià(
as_TS
)

731 ià(!
qu›t
)

732 
	`åršt_msg
("Usingransport stream id 1, PMT PID %#x,…rogram 1 ="

733 " PID %#x, sŒ—my³ %#x\n",
DEFAULT_PMT_PID
,
DEFAULT_VIDEO_PID
,

734 
¡»am_ty³
);

735 
”r
 = 
	`wr™e_TS_´og¿m_d©a
(
ouut
.
ts_ouut
,1,1,

736 
DEFAULT_PMT_PID
,
DEFAULT_VIDEO_PID
,
¡»am_ty³
);

737 ià(
”r
)  1;

740 
aùiÚ
)

742 
ACTION_FILTER
:

743 ià(
is_h262
)

744 
”r
 = 
	`f‹r_h262
(
es
,
ouut
,
as_TS
,
äequ’cy
,
max
,
v”bo£
,
qu›t
);

746 
”r
 = 
	`f‹r_acûss_un™s
(
es
,
ouut
,
as_TS
,
max
,
äequ’cy
,
v”bo£
,
qu›t
);

749 
ACTION_STRIP
:

750 ià(
is_h262
)

751 
”r
 = 
	`¡r_h262
(
es
,
ouut
,
as_TS
,
max
,
k“p_®l_»f
,
v”bo£
,
qu›t
);

753 
”r
 = 
	`¡r_acûss_un™s
(
es
,
ouut
,
as_TS
,
max
,
k“p_®l_»f
,
v”bo£
,
qu›t
);

756 
ACTION_COPY
:

757 ià(
is_h262
)

758 
”r
 = 
	`cİy_h262
(
es
,
ouut
,
as_TS
,
max
,
qu›t
);

760 
”r
 = 
	`cİy_Çl_un™s
(
es
,
ouut
,
as_TS
,
max
,
v”bo£
,
qu›t
);

764 
	`åršt_”r
("### UÃx³ùed‡ùiÚ %d\n",
aùiÚ
);

765 
”r
 = 1;

768  
”r
;

769 
	}
}

771 
	$´št_u§ge
()

773 
	`´št_msg
(

777 
	`REPORT_VERSION
("esfilter");

778 
	`´št_msg
(

839 
	}
}

841 
	$maš
(
¬gc
, **
¬gv
)

843 *
šput_Çme
 = 
NULL
;

844 *
ouut_Çme
 = 
NULL
;

845 
had_šput_Çme
 = 
FALSE
;

846 
had_ouut_Çme
 = 
FALSE
;

847 *
aùiÚ_sw™ch
 = "None";

848 
u£_¡dš
 = 
FALSE
;

849 
u£_¡dout
 = 
FALSE
;

850 
u£_tı
 = 
FALSE
;

851 
pÜt
 = 88;

852 
”r
 = 0;

853 
ES_p
 
es
 = 
NULL
;

854 
WRITER
 
ouut
;

855 
max
 = 0;

856 
ACTION
 
aùiÚ
 = 
ACTION_UNDEFINED
;

857 
as_TS
 = 
FALSE
;

858 
k“p_®l_»f
 = 
FALSE
;

859 
äequ’cy
 = 8;

860 
qu›t
 = 
FALSE
;

861 
v”bo£
 = 
FALSE
;

862 
ii
 = 1;

864 
u£_³s
 = 
FALSE
;

866 
wªt_d©a
 = 
VIDEO_H262
;

867 
is_d©a
;

868 
fÜû_¡»am_ty³
 = 
FALSE
;

869 
by‹
 
¡»am_ty³
;

871 ià(
¬gc
 < 2)

873 
	`´št_u§ge
();

877 
ouut
.
es_ouut
 = 
NULL
;

879 
ii
 < 
¬gc
)

881 ià(
¬gv
[
ii
][0] == '-')

883 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-help",argv[ii]) ||

884 !
	`¡rcmp
("-h",
¬gv
[
ii
]))

886 
	`´št_u§ge
();

889 ià(!
	`¡rcmp
("-avc",
¬gv
[
ii
]) || !strcmp("-h264",argv[ii]))

891 
fÜû_¡»am_ty³
 = 
TRUE
;

892 
wªt_d©a
 = 
VIDEO_H264
;

894 ià(!
	`¡rcmp
("-h262",
¬gv
[
ii
]))

896 
fÜû_¡»am_ty³
 = 
TRUE
;

897 
wªt_d©a
 = 
VIDEO_H262
;

899 ià(!
	`¡rcmp
("-³s",
¬gv
[
ii
]) || !strcmp("-ts",argv[ii]))

900 
u£_³s
 = 
TRUE
;

901 ià(!
	`¡rcmp
("-cİy",
¬gv
[
ii
]))

903 
aùiÚ
 = 
ACTION_COPY
;

904 
aùiÚ_sw™ch
 = 
¬gv
[
ii
];

906 ià(!
	`¡rcmp
("-f‹r",
¬gv
[
ii
]))

908 
aùiÚ
 = 
ACTION_FILTER
;

909 
aùiÚ_sw™ch
 = 
¬gv
[
ii
];

911 ià(!
	`¡rcmp
("-¡r",
¬gv
[
ii
]))

913 
aùiÚ
 = 
ACTION_STRIP
;

914 
aùiÚ_sw™ch
 = 
¬gv
[
ii
];

916 ià(!
	`¡rcmp
("-tsout",
¬gv
[
ii
]))

917 
as_TS
 = 
TRUE
;

918 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

920 
had_šput_Çme
 = 
TRUE
;

921 
u£_¡dš
 = 
TRUE
;

923 ià(!
	`¡rcmp
("-¡dout",
¬gv
[
ii
]))

925 
had_ouut_Çme
 = 
TRUE
;

926 
u£_¡dout
 = 
TRUE
;

927 
	`»dœeù_ouut_¡d”r
();

929 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

931 
	`CHECKARG
("esf‹r",
ii
);

932 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

933 
	`»dœeù_ouut_¡d”r
();

934 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

935 
	`»dœeù_ouut_¡dout
();

938 
	`åršt_”r
("###ƒsfilter: "

940 " '¡d”r')\n",
¬gv
[
ii
+1]);

943 
ii
++;

945 ià(!
	`¡rcmp
("-ho¡",
¬gv
[
ii
]))

947 
	`CHECKARG
("esf‹r",
ii
);

948 
”r
 = 
	`ho¡_v®ue
("esf‹r",
¬gv
[
ii
],¬gv[ii+1],&
ouut_Çme
,&
pÜt
);

949 ià(
”r
)  1;

950 
had_ouut_Çme
 = 
TRUE
;

951 
u£_tı
 = 
TRUE
;

952 
as_TS
 = 
TRUE
;

953 
ii
++;

955 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

957 
v”bo£
 = 
TRUE
;

958 
qu›t
 = 
FALSE
;

960 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

962 
v”bo£
 = 
FALSE
;

963 
qu›t
 = 
TRUE
;

965 ià(!
	`¡rcmp
("-®Ìef",
¬gv
[
ii
]))

967 
k“p_®l_»f
 = 
TRUE
;

969 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

971 
	`CHECKARG
("esf‹r",
ii
);

972 
”r
 = 
	`št_v®ue
("esf‹r",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

973 ià(
”r
)  1;

974 
ii
++;

976 ià(!
	`¡rcmp
("-äeq",
¬gv
[
ii
]))

978 
	`CHECKARG
("esf‹r",
ii
);

979 
”r
 = 
	`št_v®ue
("esf‹r",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
äequ’cy
);

980 ià(
”r
)  1;

981 
ii
++;

985 
	`åršt_”r
("###ƒsfilter: "

986 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

992 ià(
had_šput_Çme
 && 
had_ouut_Çme
)

994 
	`åršt_”r
("###ƒsf‹r: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

997 ià(
had_šput_Çme
)

999 
ouut_Çme
 = 
¬gv
[
ii
];

1000 
had_ouut_Çme
 = 
TRUE
;

1004 
šput_Çme
 = 
¬gv
[
ii
];

1005 
had_šput_Çme
 = 
TRUE
;

1008 
ii
++;

1011 ià(!
had_šput_Çme
)

1013 
	`´št_”r
("###ƒsfilter: No input file specified\n");

1016 ià(!
had_ouut_Çme
)

1018 
	`´št_”r
("###ƒsfilter: No output file specified\n");

1021 ià(
aùiÚ
 =ğ
ACTION_UNDEFINED
)

1023 
	`´št_”r
("###ƒsfilter: No‡ction specified (-copy, -strip,"

1029 ià(
u£_¡dout
)

1031 
v”bo£
 = 
FALSE
;

1032 
qu›t
 = 
TRUE
;

1035 
”r
 = 
	`İ’_šput_as_ES
((
u£_¡dš
?
NULL
:
šput_Çme
),
u£_³s
,
qu›t
,

1036 
fÜû_¡»am_ty³
,
wªt_d©a
,&
is_d©a
,&
es
);

1037 ià(
”r
)

1039 
	`´št_”r
("###ƒsfilter: Error opening input file\n");

1046 ià(
u£_³s
)

1047 
	`£t_PES_»ad”_video_Úly
(
es
->
»ad”
,
TRUE
);

1049 ià(
is_d©a
 =ğ
VIDEO_H262
)

1050 
¡»am_ty³
 = 
MPEG2_VIDEO_STREAM_TYPE
;

1051 ià(
is_d©a
 =ğ
VIDEO_H264
)

1052 
¡»am_ty³
 = 
AVC_VIDEO_STREAM_TYPE
;

1055 
	`´št_”r
("###ƒsfilter: Unexpectedype of video data\n");

1059 ià(
as_TS
)

1061 ià(
u£_¡dout
)

1062 
”r
 = 
	`tswr™e_İ’
(
TS_W_STDOUT
,
NULL
,NULL,0,
qu›t
,&(
ouut
.
ts_ouut
));

1063 ià(
u£_tı
)

1064 
”r
 = 
	`tswr™e_İ’
(
TS_W_TCP
,
ouut_Çme
,
NULL
,
pÜt
,
qu›t
,&(
ouut
.
ts_ouut
));

1066 
”r
 = 
	`tswr™e_İ’
(
TS_W_FILE
,
ouut_Çme
,
NULL
,0,
qu›t
,&(
ouut
.
ts_ouut
));

1067 ià(
”r
)

1069 
	`åršt_”r
("###ƒsf‹r: UÇbËØİ’ %s\n",
ouut_Çme
);

1070 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

1076 
ouut
.
es_ouut
 = 
	`fİ’
(
ouut_Çme
,"wb");

1077 ià(
ouut
.
es_ouut
 =ğ
NULL
)

1079 
	`åršt_”r
("###ƒsfilter: Unableo open output file %s: %s\n",

1080 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

1081 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

1084 ià(!
qu›t
)

1085 
	`åršt_msg
("Wr™šgØ %s\n",
ouut_Çme
);

1088 ià(!
qu›t
)

1090 ià(
as_TS
)

1091 
	`´št_msg
("Writing‡s Transport Stream\n");

1092 ià(
aùiÚ
 =ğ
ACTION_FILTER
)

1093 
	`åršt_msg
("F‹ršg f»q’cy %d\n",
äequ’cy
);

1094 ià(
aùiÚ
 =ğ
ACTION_STRIP
)

1096 ià(
wªt_d©a
 =ğ
VIDEO_H262
)

1098 ià(
k“p_®l_»f
)

1099 
	`´št_msg
("Just keeping I‡nd P…ictures\n");

1101 
	`´št_msg
("Just keep I…ictures\n");

1105 ià(
k“p_®l_»f
)

1106 
	`´št_msg
("Just keeping„eference…ictures\n");

1108 
	`´št_msg
("Just keep IDR‡nd I…ictures\n");

1111 ià(
max
)

1112 
	`åršt_msg
("Stİpšg‡ soÚ‡á” %d NAL un™ a possibË\n",
max
);

1115 
”r
 = 
	`do_aùiÚ
(
aùiÚ
,
es
,
ouut
,
max
,
äequ’cy
,
wªt_d©a
==
VIDEO_H262
,

1116 
as_TS
,
k“p_®l_»f
,
¡»am_ty³
,
v”bo£
,
qu›t
);

1117 ià(
”r
)

1119 
	`åršt_”r
("###ƒsf‹r: E¼Ü došg '%s'\n",
aùiÚ_sw™ch
);

1120 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

1121 ià(
as_TS
)

1122 (è
	`tswr™e_şo£
(
ouut
.
ts_ouut
,
TRUE
);

1123 ià(
had_ouut_Çme
 && !
u£_¡dout
)

1125 
”r
 = 
	`fşo£
(
ouut
.
es_ouut
);

1126 ià(
”r
)

1127 
	`åršt_”r
("###ƒsfilter: (Error closing output file %s: %s)\n",

1128 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

1134 ià(
as_TS
)

1136 
”r
 = 
	`tswr™e_şo£
(
ouut
.
ts_ouut
,
qu›t
);

1137 ià(
”r
)

1139 
	`åršt_”r
("###ƒsf‹r: E¼Ü closšg ouuˆf%s",
ouut_Çme
);

1140 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

1144 ià(!
u£_¡dout
)

1146 
”ºo
 = 0;

1147 
”r
 = 
	`fşo£
(
ouut
.
es_ouut
);

1148 ià(
”r
)

1150 
	`åršt_”r
("###ƒsfilter: Error closing output file %s: %s\n",

1151 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

1152 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

1157 
”r
 = 
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

1158 ià(
”r
)

1160 
	`´št_”r
("###ƒsfilter: Error closing input file\n");

1164 
	}
}

	@esmerge.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

34 
	~"com·t.h
"

35 
	~"es_âs.h
"

36 
	~"acûssun™_âs.h
"

37 
	~"avs_âs.h
"

38 
	~"audio_âs.h
"

39 
	~"ts_âs.h
"

40 
	~"tswr™e_âs.h
"

41 
	~"misc_âs.h
"

42 
	~"´štšg_âs.h
"

43 
	~"v”siÚ.h
"

46 
	#CD_RATE
 44100

	)

47 
	#DAT_RATE
 48000

	)

50 
	#DEFAULT_VIDEO_FRAME_RATE
 25

	)

56 
	#ADTS_SAMPLES_PER_FRAME
 1024

	)

58 
	#L2_SAMPLES_PER_FRAME
 1152

	)

60 
	#AC3_SAMPLES_PER_FRAME
 (256 * 6)

	)

63 
	#TEST_PTS_DTS
 0

	)

65 #ià
TEST_PTS_DTS


66 
	~"³s_âs.h
"

68 
	$check
(
ušt64_t
 
v®ue
)

70 
”r
;

71 
by‹
 
d©a
[5];

72 
ušt64_t
 
»suÉ
;

74 
	`’code_±s_dts
(
d©a
,2,
v®ue
);

75 
”r
 = 
	`decode_±s_dts
(
d©a
,2,&
»suÉ
);

76 ià(
”r
)  1;

78 ià(
v®ue
 =ğ
»suÉ
)

79 
	`åršt_msg
("V®u" 
LLU_FORMAT
 " OK\n",
v®ue
);

82 
	`åršt_msg
("IÅuˆ" 
LLU_FORMAT
 ", ouuˆ" LLU_FORMAT "\n",
v®ue
,
»suÉ
);

88 
	}
}

90 
	$‹¡_±s
()

92 ià(
	`check
(0))  1;

93 ià(
	`check
(1))  1;

94 ià(
	`check
(2))  1;

95 ià(
	`check
(3))  1;

96 ià(
	`check
(4))  1;

97 ià(
	`check
(5))  1;

98 ià(
	`check
(6))  1;

99 ià(
	`check
(7))  1;

100 ià(
	`check
(8))  1;

101 ià(
	`check
(100))  1;

102 ià(
	`check
(10000))  1;

103 ià(
	`check
(1000000))  1;

104 ià(
	`check
(100000000))  1;

105 ià(
	`check
(10000000000LL))  1;

106 ià(
	`check
(1000000000000LL))  1;

109 
	}
}

117 
	$is_I_Ü_IDR_äame
(
acûss_un™_p
 
äame
)

119  (
äame
->
´im¬y_¡¬t
 !ğ
NULL
 &&

120 
äame
->
´im¬y_¡¬t
->
Çl_»f_idc
 != 0 &&

121 (
äame
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
 ||

122 
	`®l_¦iûs_I
(
äame
)));

123 
	}
}

370 
	$m”ge_w™h_h264
(
acûss_un™_cÚ‹xt_p
 
video_cÚ‹xt
,

371 
audio_fe
,

372 
TS_wr™”_p
 
ouut1
,

374 
audio_ty³
,

375 
audio_§m¶es_³r_äame
,

376 
audio_§m¶e_¿‹
,

377 
video_äame_¿‹
,

378 
·t_pmt_äeq
,

379 
qu›t
,

380 
v”bo£
,

381 
debuggšg
,

382 
£rŸÊo
,

383 
ušt32_t
 *
»‹
)

385 
ii
;

386 
”r
;

387 
ušt32_t
 
´og_pids
[2];

388 
by‹
 
´og_ty³
[2];

390 
video_äame_couÁ
 = 0;

391 
audio_äame_couÁ
 = 0;

393 
ušt32_t
 
video_±s_šüem’t
 = 90000 / 
video_äame_¿‹
;

394 
ušt32_t
 
audio_±s_šüem’t
 = (90000 * 
audio_§m¶es_³r_äame
è/ 
audio_§m¶e_¿‹
;

395 
ušt64_t
 
video_±s
 = 0;

396 if(
£rŸÊo
!=0){

397 
FILE
 *
pFePTS
 = 
	`fİ’
 ("PTSCache.txt","r");

398 
ušt32_t
 
»t
=
	`fsÿnf
(
pFePTS
, "%Îd", &
video_±s
);

399 
	`´štf
("»ˆoàfsÿnfğ%d",
»t
);

400 
	`fşo£
(
pFePTS
);

402 
ušt64_t
 
video_dts
 = 0;

403 
ušt64_t
 
audio_±s
 = 0;

407 
audio_time
 = 0.0;

408 
video_time
 = 0.0;

410 
gÙ_video
 = 
TRUE
;

411 
gÙ_audio
 = 
FALSE
;

413 ià(
v”bo£
)

414 
	`åršt_msg
("Video PTS increment %u\n"

415 "AudiØPTS inüem’ˆ%u\n",
video_±s_šüem’t
,
audio_±s_šüem’t
);

420 
ii
=0; ii<8; ii++)

422 
”r
 = 
	`wr™e_TS_nuÎ_·ck‘
(
ouut1
);

424 ià(
”r
)  1;

429 
´og_pids
[0] = 
DEFAULT_VIDEO_PID
;

430 
´og_pids
[1] = 
DEFAULT_AUDIO_PID
;

431 
´og_ty³
[0] = 
AVC_VIDEO_STREAM_TYPE
;

452 
”r
 = 
	`wr™e_TS_´og¿m_d©a2
(
ouut1
,

455 
DEFAULT_PMT_PID
,

456 
DEFAULT_VIDEO_PID
,

457 2,
´og_pids
,
´og_ty³
);

464 ià(
”r
)

466 
	`´št_”r
("### Error writing out TS…rogram data\n");

471 
ušt32_t
 
»¡riùTime
=300;

472 (
gÙ_video
 || 
gÙ_audio
è&& 
video_äame_couÁ
 < 
»¡riùTime
)

474 
acûss_un™_p
 
acûss_un™
;

475 
audio_äame_p
 
aäame
;

478 ià(
gÙ_video
)

480 
”r
 = 
	`g‘_Ãxt_h264_äame
(
video_cÚ‹xt
,
qu›t
,
debuggšg
,&
acûss_un™
);

482 ià(
”r
 =ğ
EOF
)

484 ià(
v”bo£
)

485 
	`´št_msg
("EOF:‚o more video data\n");

486 
gÙ_video
 = 
FALSE
;

488 ià(
”r
)

492 ià(
gÙ_video
)

494 
video_time
 = 
video_äame_couÁ
 / (è
video_äame_¿‹
;

495 
video_±s
 +ğ
video_±s_šüem’t
;

496 
video_dts
 +ğ
video_±s_šüem’t
;

497 
video_äame_couÁ
 ++;

498 ià(
v”bo£
)

499 
	`åršt_msg
("\n% videØäam%5d (@ %.2fs, " 
LLU_FORMAT
 ")\n",

500 (
	`is_I_Ü_IDR_äame
(
acûss_un™
)?"**":"++"),

501 
video_äame_couÁ
,
video_time
,
video_±s
);

503 ià(
·t_pmt_äeq
 && !(
video_äame_couÁ
 %…at_pmt_freq ))

505 
	`´štf
("**********write PAT PMT**********\n");

506 ià(
v”bo£
)

508 
	`åršt_msg
("\nwriting PAT‡nd PMT (frame = %d, freq = %d).. ",

509 
video_äame_couÁ
, 
·t_pmt_äeq
);

512 
”r
 = 
	`wr™e_TS_´og¿m_d©a2
(
ouut1
,

515 
DEFAULT_PMT_PID
,

516 
DEFAULT_VIDEO_PID
,

517 2, 
´og_pids
, 
´og_ty³
);

538 ià(!
	`is_I_Ü_IDR_äame
(
acûss_un™
)){

540 
”r
 = 
	`wr™e_acûss_un™_as_TS_w™h_±s_dts
(
acûss_un™
,
video_cÚ‹xt
,

541 
ouut1
,
DEFAULT_VIDEO_PID
,

543 
TRUE
,
video_±s
,

544 
TRUE
,
video_±s
);

554 
”r
 = 
	`wr™e_acûss_un™_as_TS_w™h_PCR
(
acûss_un™
,
video_cÚ‹xt
,

555 
ouut1
,
DEFAULT_VIDEO_PID
,

556 
video_±s
,0);

564 ià(
”r
)

566 
	`ä“_acûss_un™
(&
acûss_un™
);

567 
	`´št_”r
("### Error writing‡ccess unit (frame)\n");

570 
	`ä“_acûss_un™
(&
acûss_un™
);

573 ià(
video_cÚ‹xt
->
’d_of_¡»am
)

575 ià(
v”bo£
)

576 
	`´št_msg
("Found End-of-stream NAL unit\n");

577 
gÙ_video
 = 
FALSE
;

581 ià(!
gÙ_audio
)

585 
audio_±s
 < 
video_±s
 || !
gÙ_video
)

588 ià(!
gÙ_video
)

589 
”r
 = 
EOF
;

590 ià(
”r
 =ğ
EOF
)

592 ià(
v”bo£
)

593 
	`´št_msg
("EOF:‚o more‡udio data\n");

594 
gÙ_audio
 = 
FALSE
;

597 ià(
”r
)

600 
audio_time
 = 
audio_äame_couÁ
 *

601 
audio_§m¶es_³r_äame
 / ()
audio_§m¶e_¿‹
;

602 
audio_±s
 +ğ
audio_±s_šüem’t
;

603 
audio_äame_couÁ
 ++;

604 ià(
v”bo£
)

605 
	`åršt_msg
("**‡udiØäam%5d (@ %.2fs, " 
LLU_FORMAT
 ")\n",

606 
audio_äame_couÁ
,
audio_time
,
audio_±s
);

614 ià(
”r
)

616 
	`ä“_audio_äame
(&
aäame
);

617 
	`´št_”r
("### Error writing‡udio frame\n");

620 
	`ä“_audio_äame
(&
aäame
);

624 
	`´štf
("video_± i %Îd",
video_±s
);

625 
FILE
 *
pFePTS
 = 
	`fİ’
 ("PTSCache.txt","w");

626 
	`årštf
(
pFePTS
, "%Îd", 
video_±s
);

627 
	`fşo£
(
pFePTS
);

632 *
»‹
 = 100*
video_äame_couÁ
/
video_äame_¿‹
;

634 ià(!
qu›t
)

636 
ušt32_t
 
video_–­£d
 = 100*
video_äame_couÁ
/
video_äame_¿‹
;

637 
ušt32_t
 
audio_–­£d
 = 100*
audio_äame_couÁ
*

638 
audio_§m¶es_³r_äame
/
audio_§m¶e_¿‹
;

639 
	`åršt_msg
("Read %d video frame%s, %.2fsƒlapsed (%dm %.2fs)\n",

640 
video_äame_couÁ
,(video_frame_count==1?"":"s"),

641 
video_–­£d
/100.0,video_elapsed/6000,(video_elapsed%6000)/100.0);

642 
	`åršt_msg
("Read %d‡udio frame%s, %.2fsƒlapsed (%dm %.2fs)\n",

643 
audio_äame_couÁ
,(audio_frame_count==1?"":"s"),

644 
audio_–­£d
/100.0,audio_elapsed/6000,(audio_elapsed%6000)/100.0);

649 
	}
}

651 
	$´št_u§ge
()

653 
	`´št_msg
(

658 
	`REPORT_VERSION
("esmerge");

659 
	`´št_msg
(

702 
	}
}

704 
	$maš
(
¬gc
, **
¬gv
)

706 
had_video_Çme
 = 
FALSE
;

707 
had_audio_Çme
 = 
FALSE
;

708 
had_ouut_Çme
 = 
FALSE
;

709 *
video_Çme
 = 
NULL
;

710 *
audio_Çme
 = 
NULL
;

711 *
ouut_Çme
 = 
NULL
;

712 
”r
 = 0;

713 
ES_p
 
video_es
 = 
NULL
;

714 
acûss_un™_cÚ‹xt_p
 
h264_video_cÚ‹xt
 = 
NULL
;

715 
avs_cÚ‹xt_p
 
avs_video_cÚ‹xt
 = 
NULL
;

716 
audio_fe
 = -1;

717 
TS_wr™”_p
 
ouut1
 = 
NULL
;

719 
qu›t
 = 
FALSE
;

720 
v”bo£
 = 
FALSE
;

721 
debuggšg
 = 
FALSE
;

722 
audio_§m¶es_³r_äame
 = 
ADTS_SAMPLES_PER_FRAME
;

723 
audio_§m¶e_¿‹
 = 
CD_RATE
;

724 
video_äame_¿‹
 = 
DEFAULT_VIDEO_FRAME_RATE
;

725 
audio_ty³
 = 
AUDIO_ADTS
;

726 
video_ty³
 = 
VIDEO_H264
;

727 
·t_pmt_äeq
 = 0;

728 
ii
 = 1;

730 #ià
TEST_PTS_DTS


731 
	`‹¡_±s
();

735 ià(
¬gc
 < 2)

737 
	`´št_u§ge
();

741 
ii
 < 
¬gc
)

743 ià(
¬gv
[
ii
][0] == '-')

745 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-help",argv[ii]) ||

746 !
	`¡rcmp
("-h",
¬gv
[
ii
]))

748 
	`´št_u§ge
();

751 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

753 
	`CHECKARG
("esm”ge",
ii
);

754 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

755 
	`»dœeù_ouut_¡d”r
();

756 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

757 
	`»dœeù_ouut_¡dout
();

760 
	`åršt_”r
("###ƒsmerge: "

762 " '¡d”r')\n",
¬gv
[
ii
+1]);

765 
ii
++;

767 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

769 
v”bo£
 = 
TRUE
;

771 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

773 
qu›t
 = 
TRUE
;

775 ià(!
	`¡rcmp
("-x",
¬gv
[
ii
]))

777 
debuggšg
 = 
TRUE
;

778 
qu›t
 = 
FALSE
;

780 ià(!
	`¡rcmp
("-¿‹",
¬gv
[
ii
]))

782 
	`CHECKARG
("esm”ge",
ii
);

783 
”r
 = 
	`št_v®ue
("esm”ge",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
audio_§m¶e_¿‹
);

784 ià(
”r
)  1;

785 
ii
++;

787 ià(!
	`¡rcmp
("-cd",
¬gv
[
ii
]))

789 
audio_§m¶e_¿‹
 = 
CD_RATE
;

791 ià(!
	`¡rcmp
("-d©",
¬gv
[
ii
]))

793 
audio_§m¶e_¿‹
 = 
DAT_RATE
;

795 ià(!
	`¡rcmp
("-vid¿‹",
¬gv
[
ii
]))

797 
	`CHECKARG
("esm”ge",
ii
);

798 
”r
 = 
	`št_v®ue
("esm”ge",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
video_äame_¿‹
);

799 ià(
”r
)  1;

800 
ii
++;

802 ià(!
	`¡rcmp
("-adts",
¬gv
[
ii
]))

804 
audio_ty³
 = 
AUDIO_ADTS
;

806 ià(!
	`¡rcmp
("-l2",
¬gv
[
ii
]))

808 
audio_ty³
 = 
AUDIO_L2
;

810 ià(!
	`¡rcmp
("-ac3", 
¬gv
[
ii
]))

812 
audio_ty³
 = 
AUDIO_AC3
;

814 ià(!
	`¡rcmp
("-h264",
¬gv
[
ii
]))

816 
video_ty³
 = 
VIDEO_H264
;

818 ià(!
	`¡rcmp
("-mp2adts", 
¬gv
[
ii
]))

820 
audio_ty³
 = 
AUDIO_ADTS_MPEG2
;

822 ià(!
	`¡rcmp
("-mp4adts", 
¬gv
[
ii
]))

824 
audio_ty³
 = 
AUDIO_ADTS_MPEG4
;

826 ià(!
	`¡rcmp
("-avs",
¬gv
[
ii
]))

828 
video_ty³
 = 
VIDEO_AVS
;

830 ià(!
	`¡rcmp
("-·mtäeq", 
¬gv
[
ii
]))

832 
	`CHECKARG
("esm”ge",
ii
);

833 
”r
 = 
	`št_v®ue
("esm”ge", 
¬gv
[
ii
],‡rgv[ii+1], 
TRUE
, 10, &
·t_pmt_äeq
);

834 ià(
”r
) {  1; }

835 ++
ii
;

839 
	`åršt_”r
("###ƒsmerge: "

840 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

846 ià(!
had_video_Çme
)

848 
video_Çme
 = 
¬gv
[
ii
];

849 
had_video_Çme
 = 
TRUE
;

851 ià(!
had_audio_Çme
)

853 
audio_Çme
 = 
¬gv
[
ii
];

854 
	`´štf
("gÙ‡udiØÇm123 %s\n",
audio_Çme
);

855 
had_audio_Çme
 = 
TRUE
;

857 ià(!
had_ouut_Çme
)

859 
ouut_Çme
 = 
¬gv
[
ii
];

860 
had_ouut_Çme
 = 
TRUE
;

864 
	`åršt_”r
("###ƒsm”ge: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

868 
ii
++;

871 ià(!
had_video_Çme
)

873 
	`´št_”r
("###ƒsmerge: No video input file specified\n");

882 ià(!
had_ouut_Çme
)

884 
	`´št_”r
("###ƒsmerge: No output file specified\n");

887 
ouut_Çme1
[255];

888 
ouut_Çme2
[255];

889 
	`¡rıy
(
ouut_Çme1
, 
ouut_Çme
);

890 
	`¡rıy
(
ouut_Çme2
, 
ouut_Çme
);

891 
num1
=
	`©oi
(
audio_Çme
);

892 
feS”Ÿl1
[20];

893 
feS”Ÿl2
[20];

894 
	`¥rštf
(
feS”Ÿl1
,"%d.ts", 
num1
);

895 
	`¥rštf
(
feS”Ÿl2
,"%d.‹", 
num1
);

896 
	`¡rÿt
(
ouut_Çme1
,
feS”Ÿl1
);

897 
	`¡rÿt
(
ouut_Çme2
,
feS”Ÿl2
);

898 
ušt32_t
 
timeEÏp£d
=0;

900 
”r
 = 
	`İ’_–em’ry_¡»am
(
video_Çme
,&
video_es
);

901 ià(
”r
)

903 
	`´št_”r
("###ƒsmerge: "

908 ià(
video_ty³
 =ğ
VIDEO_H264
)

910 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
video_es
,&
h264_video_cÚ‹xt
);

911 ià(
”r
)

913 
	`´št_”r
("###ƒsmerge: "

915 
	`şo£_–em’ry_¡»am
(&
video_es
);

919 ià(
video_ty³
 =ğ
VIDEO_AVS
)

921 
”r
 = 
	`bud_avs_cÚ‹xt
(
video_es
,&
avs_video_cÚ‹xt
);

922 ià(
”r
)

924 
	`´št_”r
("###ƒsmerge: "

926 
	`şo£_–em’ry_¡»am
(&
video_es
);

932 
	`´št_”r
("###ƒsmerge: Unknown videoype\n");

948 
”r
 = 
	`tswr™e_İ’
(
TS_W_FILE
,
ouut_Çme1
,
NULL
,0,
qu›t
,&
ouut1
);

950 ià(
”r
)

952 
	`åršt_”r
("###ƒsmerge: "

954 
ouut_Çme
);

955 
	`şo£_–em’ry_¡»am
(&
video_es
);

956 
	`şo£_fe
(
audio_fe
);

957 
	`ä“_acûss_un™_cÚ‹xt
(&
h264_video_cÚ‹xt
);

958 
	`ä“_avs_cÚ‹xt
(&
avs_video_cÚ‹xt
);

978 ià(!
qu›t
)

980 
	`åršt_msg
("R—dšg videØäom %s\n",
video_Çme
);

981 
	`åršt_msg
("R—dšg‡udiØäom % × %s)\n",
audio_Çme
,
	`AUDIO_STR
(
audio_ty³
));

982 
	`åršt_msg
("Wr™šg ouuˆtØ %s\n",
ouut_Çme
);

983 
	`åršt_msg
("AudiØ§m¶¿‹: %dHz (%.2fKHz)\n",
audio_§m¶e_¿‹
,

984 
audio_§m¶e_¿‹
/1000.0);

985 
	`åršt_msg
("AudiØ§m¶e ³¸äame: %d\n",
audio_§m¶es_³r_äame
);

986 
	`åršt_msg
("VideØäam¿‹: %dHz\n",
video_äame_¿‹
);

990 ià(
video_ty³
 =ğ
VIDEO_H264
)

991 
”r
 = 
	`m”ge_w™h_h264
(
h264_video_cÚ‹xt
,
audio_fe
,
ouut1
,

992 
audio_ty³
,

993 
audio_§m¶es_³r_äame
,
audio_§m¶e_¿‹
,

994 
video_äame_¿‹
,

995 
·t_pmt_äeq
,

996 
qu›t
,
v”bo£
,
debuggšg
,
num1
, &
timeEÏp£d
);

997 ià(
video_ty³
 =ğ
VIDEO_AVS
)

998 
	`´štf
("disable");

1007 
	`´št_”r
("###ƒsmerge: Unknown videoype\n");

1010 ià(
”r
)

1012 
	`´št_”r
("###ƒsmerge: Error merging video‡nd‡udio streams\n");

1013 
	`şo£_–em’ry_¡»am
(&
video_es
);

1014 
	`şo£_fe
(
audio_fe
);

1015 
	`ä“_acûss_un™_cÚ‹xt
(&
h264_video_cÚ‹xt
);

1016 
	`ä“_avs_cÚ‹xt
(&
avs_video_cÚ‹xt
);

1017 (è
	`tswr™e_şo£
(
ouut1
,
qu›t
);

1022 
FILE
 *
pFeL’
 = 
	`fİ’
 (
ouut_Çme2
,"w");

1023 
	`årštf
(
pFeL’
, "%.2f", 
timeEÏp£d
/100.0);

1024 
	`fşo£
(
pFeL’
);

1026 
	`şo£_–em’ry_¡»am
(&
video_es
);

1027 
	`şo£_fe
(
audio_fe
);

1028 
	`ä“_acûss_un™_cÚ‹xt
(&
h264_video_cÚ‹xt
);

1029 
	`ä“_avs_cÚ‹xt
(&
avs_video_cÚ‹xt
);

1030 
”r
 = 
	`tswr™e_şo£
(
ouut1
,
qu›t
);

1032 ià(
”r
)

1034 
	`åršt_”r
("###ƒsm”ge: E¼Ü closšg ouuˆ%s\n",
ouut_Çme
);

1038 
	}
}

	@esreport.c

30 
	~<¡dio.h
>

31 
	~<¡dlib.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

34 
	~<fú.h
>

35 #ifdeà
_WIN32


36 
	~<io.h
>

38 
	~<uni¡d.h
>

41 
	~"com·t.h
"

42 
	~"es_âs.h
"

43 
	~"Çlun™_âs.h
"

44 
	~"ts_âs.h
"

45 
	~"³s_âs.h
"

46 
	~"acûssun™_âs.h
"

47 
	~"h262_âs.h
"

48 
	~"avs_âs.h
"

49 
	~"misc_âs.h
"

50 
	~"´štšg_âs.h
"

51 
	~"v”siÚ.h
"

53 
	#FRAMES_PER_SECOND
 25

	)

54 
	#FRAMES_PER_MINUTE
 (
FRAMES_PER_SECOND
 * 60)

	)

66 
	$»pÜt_avs_äames
(
ES_p
 
es
,

67 
max
,

68 
v”bo£
,

69 
qu›t
,

70 
couÁ_sizes
)

72 
”r
;

73 
couÁ
 = 0;

74 
num_äames
 = 0;

75 
num_£qu’û_h—d”s
 = 0;

76 
num_£qu’û_’ds
 = 0;

78 
ušt32_t
 
mš_äame_size
 = 1000000;

79 
ušt32_t
 
max_äame_size
 = 0;

80 
ušt32_t
 
sum_äame_size
 = 0;

83 
ušt32_t
 
mš_x_äame_size
[3] = {1000000,1000000,1000000};

84 
ušt32_t
 
max_x_äame_size
[3] = {0,0,0};

85 
ušt32_t
 
sum_x_äame_size
[3] = {0,0,0};

86 
num_x_äames
[3] = {0,0,0};

88 
ušt32_t
 
mš_£q_hdr_size
 = 1000000;

89 
ušt32_t
 
max_£q_hdr_size
 = 0;

90 
ušt32_t
 
sum_£q_hdr_size
 = 0;

92 
ES_off£t
 
¡¬t
;

93 
ušt32_t
 
Ëngth
;

95 
avs_cÚ‹xt_p
 
avs
;

97 
”r
 = 
	`bud_avs_cÚ‹xt
(
es
,&
avs
);

98 ià(
”r
)

100 
	`´št_”r
("### Errorryingo build AVS„eader from ES„eader\n");

106 
avs_äame_p
 
äame
;

108 
”r
 = 
	`g‘_Ãxt_avs_äame
(
avs
,
v”bo£
,
qu›t
,&
äame
);

109 ià(
”r
 =ğ
EOF
)

111 ià(
”r
)

113 
	`´št_”r
("### Error getting‚ext AVS frame\n");

116 
couÁ
++;

118 ià(!
qu›t
)

119 
	`»pÜt_avs_äame
(
äame
,
FALSE
);

120 ià(
v”bo£
)

121 
	`»pÜt_avs_äame
(
äame
,
TRUE
);

123 ià(
äame
->
is_äame
)

125 ià(
couÁ_sizes
)

127 
”r
 = 
	`g‘_ES_un™_li¡_bounds
(
äame
->
li¡
,&
¡¬t
,&
Ëngth
);

128 ià(
”r
) ;

129 ià(
mš_äame_size
 > 
Ëngth
) min_frame_size =†ength;

130 ià(
max_äame_size
 < 
Ëngth
) max_frame_size =†ength;

131 
sum_äame_size
 +ğ
Ëngth
;

132 ià(
äame
->
piùu»_codšg_ty³
 < 3)

136 
ii
 = 
äame
->
piùu»_codšg_ty³
;

137 
num_x_äames
[
ii
] ++;

138 ià(
mš_x_äame_size
[
ii
] > 
Ëngth
) min_x_frame_size[ii] =†ength;

139 ià(
max_x_äame_size
[
ii
] < 
Ëngth
) max_x_frame_size[ii] =†ength;

140 
sum_x_äame_size
[
ii
] +ğ
Ëngth
;

143 
num_äames
 ++;

144 ià(
äame
->
piùu»_codšg_ty³
 < 3)

145 
num_x_äames
[
äame
->
piùu»_codšg_ty³
] ++;

147 ià(
äame
->
is_£qu’û_h—d”
)

149 ià(
couÁ_sizes
)

151 
”r
 = 
	`g‘_ES_un™_li¡_bounds
(
äame
->
li¡
,&
¡¬t
,&
Ëngth
);

152 ià(
”r
) ;

153 ià(
mš_£q_hdr_size
 > 
Ëngth
) min_seq_hdr_size =†ength;

154 ià(
max_£q_hdr_size
 < 
Ëngth
) max_seq_hdr_size =†ength;

155 
sum_£q_hdr_size
 +ğ
Ëngth
;

157 
num_£qu’û_h—d”s
 ++;

160 
num_£qu’û_’ds
 ++;

162 
	`ä“_avs_äame
(&
äame
);

164 ià(
max
 > 0 && 
couÁ
 >= max)

167 
	`ä“_avs_cÚ‹xt
(&
avs
);

169 
	`åršt_msg
("Found %d AVS 'frame'%s:\n"

173 
couÁ
,(count==1?"":"s"),

174 
num_äames
,(num_frames==1?"":"s"),

175 
num_x_äames
[
AVS_I_PICTURE_CODING
],

176 
num_x_äames
[
AVS_P_PICTURE_CODING
],

177 
num_x_äames
[
AVS_B_PICTURE_CODING
],

178 
num_£qu’û_h—d”s
,(num_sequence_headers==1?"":"s"),

179 
num_£qu’û_’ds
,(num_sequence_ends==1?"":"s"));

182 
tÙ®_£cÚds
 = 
num_äames
 / ()
FRAMES_PER_SECOND
;

183 
mšu‹s
 = ()(
tÙ®_£cÚds
 / 60);

184 
£cÚds
 = 
tÙ®_£cÚds
 - 60*
mšu‹s
;

185 
	`åršt_msg
("Aˆ25 f¿mes/£cÚd,h© i %dm %.1f (%.2fs)\n",
mšu‹s
,
£cÚds
,

186 
tÙ®_£cÚds
);

189 ià(
couÁ_sizes
)

191 
ii
;

192 ià(
num_äames
 > 0)

193 
	`åršt_msg
("Frame sizes„anged from %5uo %7u bytes, mean %9.2f\n",

194 
mš_äame_size
,
max_äame_size
,

195 
sum_äame_size
/()
num_äames
);

196 
ii
 = 0; ii < 3; ii++)

198 ià(
num_x_äames
[
ii
] > 0)

199 
	`åršt_msg
(" %s frames from %5uo %7u bytes, mean %9.2f\n",

200 (
ii
==0?"I":

201 
ii
==1?"P":

202 
ii
==2?"B":"?"),

203 
mš_x_äame_size
[
ii
],
max_x_äame_size
[ii],

204 
sum_x_äame_size
[
ii
]/()
num_x_äames
[ii]);

206 ià(
num_£qu’û_h—d”s
 > 0)

208 ià(
mš_£q_hdr_size
 =ğ
max_£q_hdr_size
)

209 
	`åršt_msg
("Sequ’û h—d” w”®È%u by‹s\n",
mš_£q_hdr_size
);

211 
	`åršt_msg
("Sequence headers from %5uo %7u bytes, mean %9.2f\n",

212 
mš_£q_hdr_size
,
max_£q_hdr_size
,

213 
sum_£q_hdr_size
/()
num_£qu’û_h—d”s
);

216 
	}
}

226 
	$»pÜt_ES_un™s
(
ES_p
 
es
,

227 
max
,

228 
v”bo£
,

229 
qu›t
)

231 
”r
;

232 
couÁ
 = 0;

233 
ES_un™
 
un™
;

235 (è
	`£tup_ES_un™
(&
un™
);

239 
”r
 = 
	`fšd_Ãxt_ES_un™
(
es
,&
un™
);

240 ià(
”r
 =ğ
EOF
)

242 ià(
”r
)

244 
	`´št_”r
("### Error finding‚ext ES unit\n");

247 
couÁ
++;

249 ià(!
qu›t
)

250 
	`»pÜt_ES_un™
(
TRUE
,&
un™
);

252 ià(
v”bo£
)

253 
	`´št_d©a
(
TRUE
," Data",

254 
un™
.
d©a
,un™.
d©a_Ën
,10);

256 ià(
max
 > 0 && 
couÁ
 >= max)

259 
	`ş—r_ES_un™
(&
un™
);

260 
	`åršt_msg
("Found %d ES un™%s\n",
couÁ
,(count==1?"":"s"));

261 
	}
}

271 
	$fšd_h262_f›lds
(
ES_p
 
es
,

272 
max
,

273 
v”bo£
)

275 
”r
;

276 
couÁ
 = 0;

277 
num_f›lds
 = 0;

278 
num_äames
 = 0;

279 
num_£qu’û_h—d”s
 = 0;

280 
num_£qu’û_’ds
 = 0;

281 
h262_cÚ‹xt_p
 
h262
;

283 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&
h262
);

284 ià(
”r
)

286 
	`´št_”r
("### Errorryingo build H.262„eader from ES„eader\n");

292 
h262_piùu»_p
 
piùu»
;

294 
”r
 = 
	`g‘_Ãxt_h262_sšgË_piùu»
(
h262
,
v”bo£
,&
piùu»
);

295 ià(
”r
 =ğ
EOF
)

297 ià(
”r
)

299 
	`´št_”r
("### Error getting‚ext H.262…icture\n");

302 
couÁ
++;

304 ià(
piùu»
->
is_piùu»
)

306 ià(
piùu»
->
piùu»_¡ruùu»
 < 3)

308 
	`»pÜt_h262_piùu»
(
piùu»
,
v”bo£
);

309 
num_f›lds
 ++;

312 
num_äames
 ++;

314 ià(
piùu»
->
is_£qu’û_h—d”
)

315 
num_£qu’û_h—d”s
 ++;

317 
num_£qu’û_’ds
 ++;

319 
	`ä“_h262_piùu»
(&
piùu»
);

321 ià(
max
 > 0 && 
couÁ
 >= max)

324 
	`ä“_h262_cÚ‹xt
(&
h262
);

326 
	`åršt_msg
("Found %d MPEG-2 'picture'%s:\n"

331 
couÁ
,(count==1?"":"s"),

332 
num_f›lds
,(num_fields==1?"":"s"),

333 
num_äames
,(num_frames==1?"":"s"),

334 
num_£qu’û_h—d”s
,(num_sequence_headers==1?"":"s"),

335 
num_£qu’û_’ds
,(num_sequence_ends==1?"":"s"));

336 
	}
}

347 
	$»pÜt_h262_äames
(
ES_p
 
es
,

348 
max
,

349 
v”bo£
,

350 
qu›t
,

351 
couÁ_sizes
)

353 
”r
;

354 
couÁ
 = 0;

355 
num_äames
 = 0;

356 
num_£qu’û_h—d”s
 = 0;

357 
num_£qu’û_’ds
 = 0;

359 
ušt32_t
 
mš_äame_size
 = 1000000;

360 
ušt32_t
 
max_äame_size
 = 0;

361 
ušt32_t
 
sum_äame_size
 = 0;

365 
ušt32_t
 
mš_x_äame_size
[4] = {1000000,1000000,1000000,1000000};

366 
ušt32_t
 
max_x_äame_size
[4] = {0,0,0,0};

367 
ušt32_t
 
sum_x_äame_size
[4] = {0,0,0,0};

368 
num_x_äames
[4] = {0,0,0,0};

370 
ušt32_t
 
mš_£q_hdr_size
 = 1000000;

371 
ušt32_t
 
max_£q_hdr_size
 = 0;

372 
ušt32_t
 
sum_£q_hdr_size
 = 0;

374 
ES_off£t
 
¡¬t
;

375 
ušt32_t
 
Ëngth
;

377 
h262_cÚ‹xt_p
 
h262
;

379 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&
h262
);

380 ià(
”r
)

382 
	`´št_”r
("### Errorryingo build H.262„eader from ES„eader\n");

388 
h262_piùu»_p
 
piùu»
;

390 
”r
 = 
	`g‘_Ãxt_h262_äame
(
h262
,
v”bo£
,
qu›t
,&
piùu»
);

391 ià(
”r
 =ğ
EOF
)

393 ià(
”r
)

395 
	`´št_”r
("### Error getting‚ext H.262…icture\n");

398 
couÁ
++;

400 ià(!
qu›t
)

401 
	`»pÜt_h262_piùu»
(
piùu»
,
FALSE
);

402 ià(
v”bo£
)

403 
	`»pÜt_h262_piùu»
(
piùu»
,
TRUE
);

405 ià(
piùu»
->
is_piùu»
)

407 ià(
couÁ_sizes
)

409 
”r
 = 
	`g‘_ES_un™_li¡_bounds
(
piùu»
->
li¡
,&
¡¬t
,&
Ëngth
);

410 ià(
”r
) ;

411 ià(
mš_äame_size
 > 
Ëngth
) min_frame_size =†ength;

412 ià(
max_äame_size
 < 
Ëngth
) max_frame_size =†ength;

413 
sum_äame_size
 +ğ
Ëngth
;

414 ià(
piùu»
->
piùu»_codšg_ty³
 < 5 &&

415 
piùu»
->
piùu»_codšg_ty³
 > 0)

418 
ii
 = 
piùu»
->
piùu»_codšg_ty³
 - 1;

419 ià(
mš_x_äame_size
[
ii
] > 
Ëngth
) min_x_frame_size[ii] =†ength;

420 ià(
max_x_äame_size
[
ii
] < 
Ëngth
) max_x_frame_size[ii] =†ength;

421 
sum_x_äame_size
[
ii
] +ğ
Ëngth
;

424 
num_äames
 ++;

425 ià(
piùu»
->
piùu»_codšg_ty³
 < 5 &&

426 
piùu»
->
piùu»_codšg_ty³
 > 0)

427 
num_x_äames
[
piùu»
->
piùu»_codšg_ty³
 - 1] ++;

429 ià(
piùu»
->
is_£qu’û_h—d”
)

431 ià(
couÁ_sizes
)

433 
”r
 = 
	`g‘_ES_un™_li¡_bounds
(
piùu»
->
li¡
,&
¡¬t
,&
Ëngth
);

434 ià(
”r
) ;

435 ià(
mš_£q_hdr_size
 > 
Ëngth
) min_seq_hdr_size =†ength;

436 ià(
max_£q_hdr_size
 < 
Ëngth
) max_seq_hdr_size =†ength;

437 
sum_£q_hdr_size
 +ğ
Ëngth
;

439 
num_£qu’û_h—d”s
 ++;

442 
num_£qu’û_’ds
 ++;

444 
	`ä“_h262_piùu»
(&
piùu»
);

446 ià(
max
 > 0 && 
couÁ
 >= max)

449 
	`ä“_h262_cÚ‹xt
(&
h262
);

451 
	`åršt_msg
("Found %d MPEG-2 'picture'%s:\n"

455 
couÁ
,(count==1?"":"s"),

456 
num_äames
,(num_frames==1?"":"s"),

457 
num_x_äames
[0],

458 
num_x_äames
[1],

459 
num_x_äames
[2],

460 
num_x_äames
[3],

461 
num_£qu’û_h—d”s
,(num_sequence_headers==1?"":"s"),

462 
num_£qu’û_’ds
,(num_sequence_ends==1?"":"s"));

465 
tÙ®_£cÚds
 = 
num_äames
 / ()
FRAMES_PER_SECOND
;

466 
mšu‹s
 = ()(
tÙ®_£cÚds
 / 60);

467 
£cÚds
 = 
tÙ®_£cÚds
 - 60*
mšu‹s
;

468 
	`åršt_msg
("Aˆ25 f¿mes/£cÚd,h© i %dm %.1f (%.2fs)\n",
mšu‹s
,
£cÚds
,

469 
tÙ®_£cÚds
);

472 ià(
couÁ_sizes
)

474 
ii
;

475 ià(
num_äames
 > 0)

476 
	`åršt_msg
("Frame sizes„anged from %5uo %7u bytes, mean %9.2f\n",

477 
mš_äame_size
,
max_äame_size
,

478 
sum_äame_size
/()
num_äames
);

479 
ii
 = 0; ii < 4; ii++)

481 ià(
num_x_äames
[
ii
] > 0)

482 
	`åršt_msg
(" %s frames from %5uo %7u bytes, mean %9.2f\n",

483 
	`H262_PICTURE_CODING_STR
(
ii
),

484 
mš_x_äame_size
[
ii
],
max_x_äame_size
[ii],

485 
sum_x_äame_size
[
ii
]/()
num_x_äames
[ii]);

487 ià(
num_£qu’û_h—d”s
 > 0)

489 ià(
mš_£q_hdr_size
 =ğ
max_£q_hdr_size
)

490 
	`åršt_msg
("Sequ’û h—d” w”®È%u by‹s\n",
mš_£q_hdr_size
);

492 
	`åršt_msg
("Sequence headers from %5uo %7u bytes, mean %9.2f\n",

493 
mš_£q_hdr_size
,
max_£q_hdr_size
,

494 
sum_£q_hdr_size
/()
num_£qu’û_h—d”s
);

497 
	}
}

507 
	$»pÜt_h262_afds
(
ES_p
 
es
,

508 
max
,

509 
v”bo£
,

510 
qu›t
)

512 
”r
;

513 
äames
 = 0;

514 
by‹
 
afd
 = 0;

515 
h262_cÚ‹xt_p
 
h262
;

516 
»pÜt_ev”y
 = 5 * 
FRAMES_PER_MINUTE
;

518 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&
h262
);

519 ià(
”r
)

521 
	`´št_”r
("### Errorryingo build H.262„eader from ES„eader\n");

527 
h262_piùu»_p
 
piùu»
;

529 
”r
 = 
	`g‘_Ãxt_h262_äame
(
h262
,
v”bo£
,
qu›t
,&
piùu»
);

530 ià(
”r
 =ğ
EOF
)

532 ià(
”r
)

534 
	`´št_”r
("### Error getting‚ext H.262…icture\n");

538 ià(
piùu»
->
is_piùu»
)

541 ià(
äames
 % 
»pÜt_ev”y
 == 0)

542 
	`åršt_msg
("%d mšu‹%s\n",
äames
/
FRAMES_PER_MINUTE
,

543 (
äames
/
FRAMES_PER_MINUTE
==1?"":"s"));

544 
äames
 ++;

547 ià(
piùu»
->
is_piùu»
 &&…iùu»->
afd
 !=‡fd)

549 
tÙ®_£cÚds
 = 
äames
 / ()
FRAMES_PER_SECOND
;

550 
mšu‹s
 = ()(
tÙ®_£cÚds
 / 60);

551 
£cÚds
 = 
tÙ®_£cÚds
 - 60*
mšu‹s
;

552 
	`åršt_msg
("%dm %4.1f (äam%d @ %.2fs): ",
mšu‹s
,
£cÚds
,

553 
äames
,
tÙ®_£cÚds
);

554 
	`»pÜt_h262_piùu»
(
piùu»
,
FALSE
);

555 
afd
 = 
piùu»
->afd;

558 
	`ä“_h262_piùu»
(&
piùu»
);

560 ià(
max
 > 0 && 
äames
 >= max)

563 
	`ä“_h262_cÚ‹xt
(&
h262
);

566 
tÙ®_£cÚds
 = 
äames
 / ()
FRAMES_PER_SECOND
;

567 
mšu‹s
 = ()(
tÙ®_£cÚds
 / 60);

568 
£cÚds
 = 
tÙ®_£cÚds
 - 60*
mšu‹s
;

569 
	`åršt_msg
("Found %d MPEG-2 f¿me%s",
äames
,(frames==1?"":"s"));

570 
	`åršt_msg
(" which i %dm %.1f (%.2fs)\n",
mšu‹s
,
£cÚds
,
tÙ®_£cÚds
);

572 
	}
}

582 
	$»pÜt_h262_™ems
(
ES_p
 
es
,

583 
max
,

584 
v”bo£
,

585 
qu›t
)

587 
”r
;

588 
couÁ
 = 0;

591 
h262_™em_p
 
™em
;

593 
”r
 = 
	`fšd_Ãxt_h262_™em
(
es
,&
™em
);

594 ià(
”r
 =ğ
EOF
)

596 ià(
”r
)

598 
	`´št_”r
("### Error finding‚ext H.262 item\n");

601 
couÁ
++;

603 ià(!
qu›t
)

604 
	`»pÜt_h262_™em
(
™em
);

606 ià(
v”bo£
)

607 
	`´št_d©a
(
TRUE
," Data",

608 
™em
->
un™
.
d©a
,™em->un™.
d©a_Ën
,10);

609 
	`ä“_h262_™em
(&
™em
);

611 ià(
max
 > 0 && 
couÁ
 >= max)

614 
	`åršt_msg
("Found %d MPEG-2 i‹m%s\n",
couÁ
,(count==1?"":"s"));

615 
	}
}

620 
	$»pÜt_by_Çl_un™
(
ES_p
 
es
,

621 
max
,

622 
qu›t
,

623 
show_Çl_d‘as
)

625 
”r
 = 0;

627 
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
 = 
NULL
;

629 
»f_idcs
[4] = {0};

630 
un™_ty³s
[15] = {0};

631 
¦iû_ty³s
[10] = {0};

633 
”r
 = 
	`bud_Çl_un™_cÚ‹xt
(
es
,&
cÚ‹xt
);

634 ià(
”r
)

636 
	`´št_”r
("### Unableo build NAL unit contexto„ead ES\n");

640 ià(
show_Çl_d‘as
)

641 
	`£t_show_Çl_»adšg_d‘as
(
cÚ‹xt
,
TRUE
);

645 
Çl_un™_p
 
Çl
;

647 ià(
max
 > 0 && 
cÚ‹xt
->
couÁ
 >= max)

649 
	`åršt_msg
("\nStopping because %d NAL units have been„ead\n",

650 
cÚ‹xt
->
couÁ
);

654 
”r
 = 
	`fšd_Ãxt_NAL_un™
(
cÚ‹xt
,!
qu›t
,&
Çl
);

655 ià(
”r
 == 2)

657 
	`´št_msg
("... ignoring broken NAL unit\n");

660 ià(
”r
)

663 
»f_idcs
[
Çl
->
Çl_»f_idc
] ++;

665 ià(
Çl
->
Çl_un™_ty³
 < 13)

666 
un™_ty³s
[
Çl
->
Çl_un™_ty³
] ++;

667 ià(
Çl
->
Çl_un™_ty³
 < 24)

668 
un™_ty³s
[13] ++;

670 
un™_ty³s
[14] ++;

672 ià(
	`Çl_is_¦iû
(
Çl
))

673 
¦iû_ty³s
[
Çl
->
u
.
¦iû
.
¦iû_ty³
] ++;

675 
	`ä“_Çl_un™
(&
Çl
);

677 ià(
”r
 =ğ
EOF
 && !
qu›t
)

678 
	`´št_msg
("EOF\n");

679 ià(
”r
 =ğ0 ||ƒ¼ =ğ
EOF
)

681 
ii
;

682 
	`åršt_msg
("Found %d NAL un™%s\n",
cÚ‹xt
->
couÁ
,(context->count==1?"":"s"));

683 
	`´št_msg
("nal_ref_idc:\n");

684 
ii
=0; ii<4; ii++)

685 ià(
»f_idcs
[
ii
] > 0)

686 
	`åršt_msg
(" %8d oà%2d%s\n",
»f_idcs
[
ii
],ii,ii?"":" (non-reference)");

688 
	`´št_msg
("nal_unit_type:\n");

689 
ii
=0; ii<13; ii++)

690 ià(
un™_ty³s
[
ii
] > 0)

691 
	`åršt_msg
(" %8d oàty³ %2d (%s)\n",
un™_ty³s
[
ii
],ii,
	`NAL_UNIT_TYPE_STR
(ii));

692 ià(
un™_ty³s
[13] > 0)

693 
	`åršt_msg
(" %8d oàty³ 13..23 (Re£rved)\n",
un™_ty³s
[13]);

694 ià(
un™_ty³s
[14] > 0)

695 
	`åršt_msg
(" %8d oàty°24..31 (Un¥ecif›d)\n",
un™_ty³s
[14]);

697 
	`´št_msg
("slice_type:\n");

698 
ii
=0; ii<10; ii++)

699 ià(
¦iû_ty³s
[
ii
] > 0)

700 
	`åršt_msg
(" %8d oàty³ %2d (%s)\n",
¦iû_ty³s
[
ii
],ii,

701 
	`NAL_SLICE_TYPE_STR
(
ii
));

704 
	`´št_”r
("### Abandoning„eporting dueoƒrror\n");

705 
	`ä“_Çl_un™_cÚ‹xt
(&
cÚ‹xt
);

706 
	}
}

715 
	$fšd_h264_f›lds
(
ES_p
 
es
,

716 
max
,

717 
qu›t
,

718 
v”bo£
,

719 
show_Çl_d‘as
)

721 
”r
;

722 
couÁ
 = 0;

723 
num_f›lds
 = 0;

724 
num_äames
 = 0;

725 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
;

726 
ušt32_t
 
num_w™h_PTS
 = 0;

728 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&
cÚ‹xt
);

729 ià(
”r
) ;

731 ià(
show_Çl_d‘as
)

732 
	`£t_show_Çl_»adšg_d‘as
(
cÚ‹xt
->
Çc
,
TRUE
);

736 
acûss_un™_p
 
acûss_un™
;

739 
”r
 = 
	`g‘_Ãxt_acûss_un™
(
cÚ‹xt
,
qu›t
,
v”bo£
,&
acûss_un™
);

740 ià(
”r
 =ğ
EOF
)

742 ià(
”r
)

744 
	`´št_”r
("### Error getting‚ext‡ccess unit\n");

747 
couÁ
++;

749 ià(
acûss_un™
->
f›ld_pic_æag
 == 1)

751 
	`»pÜt_acûss_un™
(
acûss_un™
);

752 
num_f›lds
 ++;

755 
num_äames
 ++;

757 ià(
	`acûss_un™_has_PTS
(
acûss_un™
))

758 
num_w™h_PTS
 ++;

760 
	`ä“_acûss_un™
(&
acûss_un™
);

762 ià(
max
 > 0 && 
couÁ
 >= max)

765 
	`åršt_msg
("Found %d MPEG-4…icture%s, %d field%s, %d frame%s\n",

766 
couÁ
,(count==1?"":"s"),

767 
num_f›lds
,(num_fields==1?"":"s"),

768 
num_äames
,(num_frames==1?"":"s"));

770 
	`åršt_msg
("F›ld w™h PTS‡ssocŸ‹d: %u\n",
num_w™h_PTS
);

771 
	`ä“_acûss_un™_cÚ‹xt
(&
cÚ‹xt
);

772 
	}
}

777 
	$»pÜt_h264_äames
(
ES_p
 
es
,

778 
max
,

779 
qu›t
,

780 
v”bo£
,

781 
show_Çl_d‘as
,

782 
couÁ_sizes
,

783 
couÁ_ty³s
)

785 
”r
 = 0;

786 
acûss_un™_couÁ
 = 0;

787 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
;

789 
ušt32_t
 
mš_äame_size
 = 1000000;

790 
ušt32_t
 
max_äame_size
 = 0;

791 
ušt32_t
 
sum_äame_size
 = 0;

793 
ušt32_t
 
num_w™h_PTS
 = 0;

795 
	#I_NON_REF
 0

	)

796 
	#I_REF_IDR
 1

	)

797 
	#I_REF_NON_IDR
 2

	)

798 
	#I_OTHER
 3

	)

799 
	#I_SLICE_I
 0

	)

800 
	#I_SLICE_P
 1

	)

801 
	#I_SLICE_B
 2

	)

802 
	#I_SLICE_MIX
 3

	)

803 
ušt32_t
 
¦iû_ty³s
[3][4] = {{0},{0}};

804 
ušt32_t
 
¦iû_ÿ‹gÜ›s
[4] = {0};

806 
ES_off£t
 
¡¬t
;

807 
ušt32_t
 
Ëngth
;

809 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&
cÚ‹xt
);

810 ià(
”r
) ;

812 ià(
show_Çl_d‘as
)

813 
	`£t_show_Çl_»adšg_d‘as
(
cÚ‹xt
->
Çc
,
TRUE
);

817 
acûss_un™_p
 
acûss_un™
;

819 
acûss_un™_couÁ
 ++;

821 
”r
 = 
	`g‘_Ãxt_h264_äame
(
cÚ‹xt
,
qu›t
,
v”bo£
,&
acûss_un™
);

822 ià(
”r
)

825 ià(!
qu›t
)

826 
	`»pÜt_acûss_un™
(
acûss_un™
);

828 ià(
couÁ_sizes
)

830 
”r
 = 
	`g‘_acûss_un™_bounds
(
acûss_un™
,&
¡¬t
,&
Ëngth
);

831 ià(
”r
) ;

832 ià(
mš_äame_size
 > 
Ëngth
) min_frame_size =†ength;

833 ià(
max_äame_size
 < 
Ëngth
) max_frame_size =†ength;

834 
sum_äame_size
 +ğ
Ëngth
;

837 ià(
couÁ_ty³s
 && 
acûss_un™
->
´im¬y_¡¬t
 !ğ
NULL
)

839 ià(
acûss_un™
->
´im¬y_¡¬t
->
Çl_»f_idc
 == 0)

841 
¦iû_ÿ‹gÜ›s
[
I_NON_REF
] ++;

842 ià(
	`®l_¦iûs_I
(
acûss_un™
))

843 
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_I
] ++;

844 ià(
	`®l_¦iûs_P
(
acûss_un™
))

845 
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_P
] ++;

846 ià(
	`®l_¦iûs_B
(
acûss_un™
))

847 
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_B
] ++;

849 
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_MIX
] ++;

851 ià(
acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
)

854 
¦iû_ÿ‹gÜ›s
[
I_REF_IDR
] ++;

855 ià(
	`®l_¦iûs_I
(
acûss_un™
))

856 
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_I
] ++;

857 ià(
	`®l_¦iûs_P
(
acûss_un™
))

858 
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_P
] ++;

859 ià(
	`®l_¦iûs_B
(
acûss_un™
))

860 
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_B
] ++;

862 
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_MIX
] ++;

864 ià(
acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_NON_IDR
)

866 
¦iû_ÿ‹gÜ›s
[
I_REF_NON_IDR
] ++;

867 ià(
	`®l_¦iûs_I
(
acûss_un™
))

868 
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_I
] ++;

869 ià(
	`®l_¦iûs_P
(
acûss_un™
))

870 
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_P
] ++;

871 ià(
	`®l_¦iûs_B
(
acûss_un™
))

872 
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_B
] ++;

874 
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_MIX
] ++;

877 
¦iû_ÿ‹gÜ›s
[
I_OTHER
] ++;

880 ià(
	`acûss_un™_has_PTS
(
acûss_un™
))

881 
num_w™h_PTS
 ++;

883 
	`ä“_acûss_un™
(&
acûss_un™
);

886 ià(
cÚ‹xt
->
’d_of_¡»am
)

888 ià(!
qu›t
è
	`´št_msg
("Found End-of-stream NAL unit\n");

892 ià(
max
 > 0 && 
acûss_un™_couÁ
 >= max)

894 
	`åršt_msg
("\nStopping because (at†east) %d frames have been„ead\n",

895 
acûss_un™_couÁ
);

900 
	`åršt_msg
("Found %d frame%s (%d NAL unit%s)\n",

901 
acûss_un™_couÁ
,(access_unit_count==1?"":"s"),

902 
cÚ‹xt
->
Çc
->
couÁ
,(context->nac->count==1?"":"s"));

904 ià(
couÁ_ty³s
)

906 ià(
¦iû_ÿ‹gÜ›s
[
I_NON_REF
] > 0)

908 
	`´št_msg
("Non-reference frames:\n");

909 ià(
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_I
] != 0)

910 
	`åršt_msg
(" I f¿me  %7d\n",
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_I
]);

911 ià(
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_P
] != 0)

912 
	`åršt_msg
(" P f¿me  %7d\n",
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_P
]);

913 ià(
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_B
] != 0)

914 
	`åršt_msg
(" B f¿me  %7d\n",
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_B
]);

915 ià(
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_MIX
] != 0)

916 
	`åršt_msg
(" Mixed/Ùh” %7d\n",
¦iû_ty³s
[
I_NON_REF
][
I_SLICE_MIX
]);

919 ià(
¦iû_ÿ‹gÜ›s
[
I_REF_IDR
] > 0)

921 
	`´št_msg
("IDR frames\n");

922 ià(
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_I
] != 0)

923 
	`åršt_msg
(" I f¿me  %7d\n",
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_I
]);

924 ià(
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_P
] != 0)

925 
	`åršt_msg
(" P f¿me  %7d\n",
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_P
]);

926 ià(
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_B
] != 0)

927 
	`åršt_msg
(" B f¿me  %7d\n",
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_B
]);

928 ià(
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_MIX
] != 0)

929 
	`åršt_msg
(" Mixed/Ùh” %7d\n",
¦iû_ty³s
[
I_REF_IDR
][
I_SLICE_MIX
]);

932 ià(
¦iû_ÿ‹gÜ›s
[
I_REF_NON_IDR
] > 0)

934 
	`´št_msg
("Non-IDR„eference frames:\n");

935 ià(
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_I
] != 0)

936 
	`åršt_msg
(" I f¿me  %7d\n",
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_I
]);

937 ià(
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_P
] != 0)

938 
	`åršt_msg
(" P f¿me  %7d\n",
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_P
]);

939 ià(
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_B
] != 0)

940 
	`åršt_msg
(" B f¿me  %7d\n",
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_B
]);

941 ià(
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_MIX
] != 0)

942 
	`åršt_msg
(" Mixed/Ùh” %7d\n",
¦iû_ty³s
[
I_REF_NON_IDR
][
I_SLICE_MIX
]);

945 ià(
¦iû_ÿ‹gÜ›s
[
I_OTHER
] > 0)

946 
	`åršt_msg
("Oth” f¿mty³s: %d\n",
¦iû_ÿ‹gÜ›s
[
I_OTHER
]);

950 
tÙ®_£cÚds
 = 
acûss_un™_couÁ
 / ()
FRAMES_PER_SECOND
;

951 
mšu‹s
 = ()(
tÙ®_£cÚds
 / 60);

952 
£cÚds
 = 
tÙ®_£cÚds
 - 60*
mšu‹s
;

953 
	`åršt_msg
("Aˆ25 f¿mes/£cÚd,h© i %dm %.1f (%.2fs)\n",
mšu‹s
,
£cÚds
,

954 
tÙ®_£cÚds
);

957 ià(
couÁ_sizes
 && 
acûss_un™_couÁ
 > 0)

958 
	`åršt_msg
("Frame sizes„anged from %uo %u bytes, mean %.2f\n",

959 
mš_äame_size
,
max_äame_size
,

960 
sum_äame_size
/()
acûss_un™_couÁ
);

962 
	`åršt_msg
("F¿me w™h PTS‡ssocŸ‹d: %u\n",
num_w™h_PTS
);

964 
	`ä“_acûss_un™_cÚ‹xt
(&
cÚ‹xt
);

965 
	}
}

967 
	$´št_u§ge
()

969 
	`´št_msg
(

973 
	`REPORT_VERSION
("esreport");

974 
	`´št_msg
(

1032 
	}
}

1034 
	$maš
(
¬gc
, **
¬gv
)

1036 *
šput_Çme
 = 
NULL
;

1037 
had_šput_Çme
 = 
FALSE
;

1038 
u£_¡dš
 = 
FALSE
;

1039 
”r
 = 0;

1040 
ES_p
 
es
 = 
NULL
;

1041 
max
 = 0;

1042 
by_äame
 = 
FALSE
;

1043 
fšd_f›lds
 = 
FALSE
;

1044 
qu›t
 = 
FALSE
;

1045 
v”bo£
 = 
FALSE
;

1046 
show_Çl_d‘as
 = 
FALSE
;

1047 
give_³s_šfo
 = 
FALSE
;

1048 
»pÜt_afds
 = 
FALSE
;

1049 
»pÜt_äamesize
 = 
FALSE
;

1050 
»pÜt_äam‘y³
 = 
FALSE
;

1051 
»pÜt_³s_h—d”s
 = 
FALSE
;

1052 
»pÜt_ES
 = 
FALSE
;

1053 
ii
 = 1;

1055 
u£_³s
 = 
FALSE
;

1057 
wªt_d©a
 = 
VIDEO_H262
;

1058 
is_d©a
;

1059 
fÜû_¡»am_ty³
 = 
FALSE
;

1061 ià(
¬gc
 < 2)

1063 
	`´št_u§ge
();

1067 
ii
 < 
¬gc
)

1069 ià(
¬gv
[
ii
][0] == '-')

1071 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-help",argv[ii]))

1073 
	`´št_u§ge
();

1076 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

1078 
	`CHECKARG
("e¤•Üt",
ii
);

1079 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

1080 
	`»dœeù_ouut_¡d”r
();

1081 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

1082 
	`»dœeù_ouut_¡dout
();

1085 
	`åršt_”r
("###ƒsreport: "

1087 " '¡d”r')\n",
¬gv
[
ii
+1]);

1090 
ii
++;

1092 ià(!
	`¡rcmp
("-avc",
¬gv
[
ii
]) || !strcmp("-h264",argv[ii]))

1094 
fÜû_¡»am_ty³
 = 
TRUE
;

1095 
wªt_d©a
 = 
VIDEO_H264
;

1097 ià(!
	`¡rcmp
("-h262",
¬gv
[
ii
]))

1099 
fÜû_¡»am_ty³
 = 
TRUE
;

1100 
wªt_d©a
 = 
VIDEO_H262
;

1102 ià(!
	`¡rcmp
("-avs",
¬gv
[
ii
]))

1104 
fÜû_¡»am_ty³
 = 
TRUE
;

1105 
wªt_d©a
 = 
VIDEO_AVS
;

1107 ià(!
	`¡rcmp
("-es",
¬gv
[
ii
]))

1109 
»pÜt_ES
 = 
TRUE
;

1111 ià(!
	`¡rcmp
("-äames",
¬gv
[
ii
]))

1112 
by_äame
 = 
TRUE
;

1113 ià(!
	`¡rcmp
("-äamesize",
¬gv
[
ii
]))

1115 
by_äame
 = 
TRUE
;

1116 
»pÜt_äamesize
 = 
TRUE
;

1118 ià(!
	`¡rcmp
("-äam‘y³",
¬gv
[
ii
]))

1120 
by_äame
 = 
TRUE
;

1121 
»pÜt_äam‘y³
 = 
TRUE
;

1123 ià(!
	`¡rcmp
("-afd",
¬gv
[
ii
]) || !strcmp("-afds",argv[ii]))

1124 
»pÜt_afds
 = 
TRUE
;

1125 ià(!
	`¡rcmp
("-fšdf›lds",
¬gv
[
ii
]))

1126 
fšd_f›lds
 = 
TRUE
;

1127 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

1129 
had_šput_Çme
 = 
TRUE
;

1130 
u£_¡dš
 = 
TRUE
;

1132 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

1134 
v”bo£
 = 
TRUE
;

1136 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

1138 
qu›t
 = 
TRUE
;

1140 ià(!
	`¡rcmp
("-x",
¬gv
[
ii
]))

1142 
show_Çl_d‘as
 = 
TRUE
;

1144 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

1146 
	`CHECKARG
("e¤•Üt",
ii
);

1147 
”r
 = 
	`št_v®ue
("e¤•Üt",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

1148 ià(
”r
)  1;

1149 
ii
++;

1151 ià(!
	`¡rcmp
("-³s",
¬gv
[
ii
]) || !strcmp("-ts",argv[ii]))

1152 
u£_³s
 = 
TRUE
;

1153 ià(!
	`¡rcmp
("-³¤•Üt",
¬gv
[
ii
]))

1155 
»pÜt_³s_h—d”s
 = 
TRUE
;

1156 
u£_³s
 = 
TRUE
;

1157 
qu›t
 = 
TRUE
;

1159 ià(!
	`¡rcmp
("-³sšfo",
¬gv
[
ii
]))

1161 
give_³s_šfo
 = 
TRUE
;

1162 
u£_³s
 = 
TRUE
;

1166 
	`åršt_”r
("###ƒsreport: "

1167 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

1173 ià(
had_šput_Çme
)

1175 
	`åršt_”r
("###ƒ¤•Üt: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

1180 
šput_Çme
 = 
¬gv
[
ii
];

1181 
had_šput_Çme
 = 
TRUE
;

1184 
ii
++;

1187 ià(!
had_šput_Çme
)

1189 
	`´št_”r
("###ƒsreport: No input file specified\n");

1193 
”r
 = 
	`İ’_šput_as_ES
((
u£_¡dš
?
NULL
:
šput_Çme
),
u£_³s
,
qu›t
,

1194 
fÜû_¡»am_ty³
,
wªt_d©a
,&
is_d©a
,&
es
);

1195 ià(
”r
)

1197 
	`´št_”r
("###ƒsreport: Error opening input file\n");

1201 ià(
»pÜt_³s_h—d”s
)

1203 
es
->
»ad”
->
debug_»ad_·ck‘s
 = 
TRUE
;

1206 ià(
give_³s_šfo
)

1208 
es
->
»ad”
->
give_šfo
 = 
TRUE
;

1211 ià(
»pÜt_ES
)

1213 
	`»pÜt_ES_un™s
(
es
,
max
,
v”bo£
,
qu›t
);

1215 ià(
is_d©a
 =ğ
VIDEO_H262
)

1217 ià(
fšd_f›lds
)

1218 
	`fšd_h262_f›lds
(
es
,
max
,
v”bo£
);

1219 ià(
by_äame
)

1220 
	`»pÜt_h262_äames
(
es
,
max
,
v”bo£
,
qu›t
,
»pÜt_äamesize
);

1221 ià(
»pÜt_afds
)

1222 
	`»pÜt_h262_afds
(
es
,
max
,
v”bo£
,
qu›t
);

1224 
	`»pÜt_h262_™ems
(
es
,
max
,
v”bo£
,
qu›t
);

1226 ià(
is_d©a
 =ğ
VIDEO_AVS
)

1228 
	`»pÜt_avs_äames
(
es
,
max
,
v”bo£
,
qu›t
,
»pÜt_äamesize
);

1230 ià(
is_d©a
 =ğ
VIDEO_H264
)

1232 ià(
fšd_f›lds
)

1233 
	`fšd_h264_f›lds
(
es
,
max
,
qu›t
,
v”bo£
,
show_Çl_d‘as
);

1234 ià(
by_äame
)

1235 
	`»pÜt_h264_äames
(
es
,
max
,
qu›t
,
v”bo£
,
show_Çl_d‘as
,

1236 
»pÜt_äamesize
,
»pÜt_äam‘y³
);

1238 
	`»pÜt_by_Çl_un™
(
es
,
max
,
qu›t
,
show_Çl_d‘as
);

1242 
	`´št_”r
("###ƒsreport: Unexpectedype of video data\n");

1246 
”r
 = 
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

1247 ià(
”r
)

1249 
	`´št_”r
("###ƒsreport: Error closing input file\n");

1253 
	}
}

	@esreverse.c

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<”ºo.h
>

36 
	~<fú.h
>

37 
	~<¡ršg.h
>

39 #ifdeà
_WIN32


40 
	~<¡ddef.h
>

42 
	~<uni¡d.h
>

45 
	~"com·t.h
"

46 
	~"es_âs.h
"

47 
	~"Çlun™_âs.h
"

48 
	~"acûssun™_âs.h
"

49 
	~"h262_âs.h
"

50 
	~"ts_âs.h
"

51 
	~"tswr™e_âs.h
"

52 
	~"³s_âs.h
"

53 
	~"»v”£_âs.h
"

54 
	~"misc_âs.h
"

55 
	~"´štšg_âs.h
"

56 
	~"v”siÚ.h
"

58 
	#DEBUG
 0

	)

59 
	#SHOW_REVERSE_DATA
 1

	)

60 #ià
SHOW_REVERSE_DATA


61 
	gshow_»v”£_d©a
 = 
FALSE
;

69 
wr™e_·ck‘_d©a
(
WRITER
 
ouut
,

70 
as_TS
,

71 
by‹
 
d©a
[],

72 
d©a_Ën
,

73 
ušt32_t
 
pid
,

74 
by‹
 
¡»am_id
);

91 
	$»v”£_h262
(
ES_p
 
es
,

92 
WRITER
 
ouut
,

93 
max
,

94 
äequ’cy
,

95 
as_TS
,

96 
v”bo£
,

97 
qu›t
)

99 
”r
 = 0;

100 
»v”£_d©a_p
 
»v”£_d©a
 = 
NULL
;

101 
h262_cÚ‹xt_p
 
hcÚ‹xt
 = 
NULL
;

103 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&
hcÚ‹xt
);

104 ià(
”r
)  1;

106 
”r
 = 
	`bud_»v”£_d©a
(&
»v”£_d©a
,
FALSE
);

107 ià(
”r
)

109 
	`ä“_h262_cÚ‹xt
(&
hcÚ‹xt
);

113 ià(!
qu›t
)

114 
	`´št_msg
("\nScanning forwards\n");

116 
	`add_h262_»v”£_cÚ‹xt
(
hcÚ‹xt
,
»v”£_d©a
);

117 
”r
 = 
	`cŞËù_»v”£_h262
(
hcÚ‹xt
,
max
,
v”bo£
,
qu›t
);

118 ià(
”r
 &&ƒ¼ !ğ
EOF
)

120 ià(
»v”£_d©a
->
Ëngth
 > 0)

122 
	`åršt_”r
("!!! Collected %d…ictures‡nd sequence headers,"

123 " cÚtšušgØ»v”£\n",
»v”£_d©a
->
Ëngth
);

127 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

128 
	`ä“_h262_cÚ‹xt
(&
hcÚ‹xt
);

133 #ià
SHOW_REVERSE_DATA


134 ià(
show_»v”£_d©a
)

136 
ii
;

137 
ii
=0; ii<
»v”£_d©a
->
Ëngth
; ii++)

138 ià(
»v”£_d©a
->
£q_off£t
[
ii
])

139 
	`åršt_msg
("%3d: %4d‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

140 
ii
,
»v”£_d©a
->
šdex
[ii],

141 
»v”£_d©a
->
¡¬t_fe
[
ii
],

142 
»v”£_d©a
->
¡¬t_pkt
[
ii
],

143 
»v”£_d©a
->
d©a_Ën
[
ii
]);

145 
	`åršt_msg
("%3d: seqh‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

146 
ii
,

147 
»v”£_d©a
->
¡¬t_fe
[
ii
],

148 
»v”£_d©a
->
¡¬t_pkt
[
ii
],

149 
»v”£_d©a
->
d©a_Ën
[
ii
]);

151 ià(!
es
->
»adšg_ES
)

152 
	`wr™e_´og¿m_d©a
(
es
->
»ad”
,
ouut
.
ts_ouut
);

155 ià(!
es
->
»adšg_ES
)

158 
	`¡İ_£rv”_ouut
(
es
->
»ad”
);

160 
	`£t_PES_»ad”_video_Úly
(
es
->
»ad”
,
TRUE
);

163 ià(!
qu›t
)

164 
	`´št_msg
("\nOutputting in„everse order\n");

166 ià(
as_TS
)

167 
”r
 = 
	`ouut_š_»v”£_as_TS
(
es
,
ouut
.
ts_ouut
,
äequ’cy
,
v”bo£
,
qu›t
,

168 -1,0,
»v”£_d©a
);

170 
”r
 = 
	`ouut_š_»v”£_as_ES
(
es
,
ouut
.
es_ouut
,
äequ’cy
,
v”bo£
,
qu›t
,

171 -1,0,
»v”£_d©a
);

173 ià(!
”r
 && !
qu›t
)

175 
ušt32_t
 
fš®_šdex
 = 
»v”£_d©a
->
šdex
[»v”£_d©a->
fœ¡_wr™‹n
];

176 
	`´št_msg
("\n");

177 
	`´št_msg
("Summary\n");

178 
	`´št_msg
("=======\n");

179 
	`´št_msg
(" Considered Used Written\n");

180 
	`åršt_msg
("Pictures %10d %10d (%4.1f%%) %10d (%4.1f%%)\n",

181 
fš®_šdex
,
»v”£_d©a
->
piùu»s_k•t
,

182 100*((()
»v”£_d©a
->
piùu»s_k•t
)/
fš®_šdex
),

183 
»v”£_d©a
->
piùu»s_wr™‹n
,

184 100*((()
»v”£_d©a
->
piùu»s_wr™‹n
)/
fš®_šdex
));

185 ià(
äequ’cy
 != 0)

186 
	`åršt_msg
("Target (pictures) . %10d (%4.1f%%)‡t„equested"

187 " f»qu’cy %d\n",
fš®_šdex
/
äequ’cy
,100.0/frequency,

188 
äequ’cy
);

191 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

192 
	`ä“_h262_cÚ‹xt
(&
hcÚ‹xt
);

193  
”r
;

194 
	}
}

201 
	$ouut_·¿m‘”_£ts
(
WRITER
 
ouut
,

202 
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

203 
as_TS
,

204 
qu›t
)

206 
Çl_un™_cÚ‹xt_p
 
Çc
 = 
cÚ‹xt
->nac;

207 
·¿m_diù_p
 
£q_·¿m_diù
 = 
Çc
->seq_param_dict;

208 
·¿m_diù_p
 
pic_·¿m_diù
 = 
Çc
->pic_param_dict;

210 
ii
;

211 
”r
;

213 
ii
 = 0; i˜< 
£q_·¿m_diù
->
Ëngth
; ii++)

215 
ES_off£t
 
po¢
 = 
£q_·¿m_diù
->
po¢s
[
ii
];

216 
ušt32_t
 
Ëngth
 = 
£q_·¿m_diù
->
d©a_Ëns
[
ii
];

217 
by‹
 *
d©a
 = 
NULL
;

218 ià(!
qu›t
)

219 
	`åršt_msg
("Writing out sequence…arameter set %d\n",

220 
£q_·¿m_diù
->
ids
[
ii
]);

222 
”r
 = 
	`»ad_ES_d©a
(
Çc
->
es
,
po¢
,
Ëngth
,
NULL
,&
d©a
);

223 ià(
”r
)

225 
	`åršt_”r
("### Error„eading (sequence…arameter set %d) data"

226 " from " 
OFFSET_T_FORMAT
 "/%d for %d\n",

227 
£q_·¿m_diù
->
ids
[
ii
],
po¢
.
šfe
,po¢.
š·ck‘
,
Ëngth
);

230 
”r
 = 
	`wr™e_·ck‘_d©a
(
ouut
,
as_TS
,
d©a
,
Ëngth
,
DEFAULT_VIDEO_PID
,

231 
DEFAULT_VIDEO_STREAM_ID
);

232 
	`ä“
(
d©a
);

233 ià(
”r
)

235 
	`åršt_”r
("### Error writing out (sequence…arameter set %d)"

236 "d©a\n",
£q_·¿m_diù
->
ids
[
ii
]);

241 
ii
 = 0; i˜< 
pic_·¿m_diù
->
Ëngth
; ii++)

243 
ES_off£t
 
po¢
 = 
pic_·¿m_diù
->
po¢s
[
ii
];

244 
ušt32_t
 
Ëngth
 = 
pic_·¿m_diù
->
d©a_Ëns
[
ii
];

245 
by‹
 *
d©a
 = 
NULL
;

246 ià(!
qu›t
)

247 
	`åršt_msg
("Writing out…icture…arameter set %d\n",

248 
pic_·¿m_diù
->
ids
[
ii
]);

250 
”r
 = 
	`»ad_ES_d©a
(
Çc
->
es
,
po¢
,
Ëngth
,
NULL
,&
d©a
);

251 ià(
”r
)

253 
	`åršt_”r
("### Error„eading (picture…arameter set %d) data"

254 " from " 
OFFSET_T_FORMAT
 "/%d for %d\n",

255 
pic_·¿m_diù
->
ids
[
ii
],
po¢
.
šfe
,po¢.
š·ck‘
,
Ëngth
);

258 
”r
 = 
	`wr™e_·ck‘_d©a
(
ouut
,
as_TS
,
d©a
,
Ëngth
,
DEFAULT_VIDEO_PID
,

259 
DEFAULT_VIDEO_STREAM_ID
);

260 
	`ä“
(
d©a
);

261 ià(
”r
)

263 
	`åršt_”r
("### Error writing out (picture…arameter set %d)"

264 "d©a\n",
pic_·¿m_diù
->
ids
[
ii
]);

269 
	}
}

276 
	$»v”£_acûss_un™s
(
ES_p
 
es
,

277 
WRITER
 
ouut
,

278 
max
,

279 
äequ’cy
,

280 
as_TS
,

281 
v”bo£
,

282 
qu›t
)

284 
”r
 = 0;

285 
»v”£_d©a_p
 
»v”£_d©a
 = 
NULL
;

286 
acûss_un™_cÚ‹xt_p
 
acÚ‹xt
 = 
NULL
;

288 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&
acÚ‹xt
);

289 ià(
”r
)  1;

291 
”r
 = 
	`bud_»v”£_d©a
(&
»v”£_d©a
,
TRUE
);

292 ià(
”r
)

294 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

298 ià(!
qu›t
)

299 
	`´št_msg
("\nScanning forwards\n");

301 
	`add_acûss_un™_»v”£_cÚ‹xt
(
acÚ‹xt
,
»v”£_d©a
);

302 
”r
 = 
	`cŞËù_»v”£_acûss_un™s
(
acÚ‹xt
,
max
,
v”bo£
,
qu›t
);

303 ià(
”r
 &&ƒ¼ !ğ
EOF
)

305 ià(
»v”£_d©a
->
Ëngth
 > 0)

307 
	`åršt_”r
("!!! Collected %d‡ccess units,"

308 " cÚtšušgØ»v”£\n",
»v”£_d©a
->
Ëngth
);

312 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

313 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

318 #ià
SHOW_REVERSE_DATA


319 ià(
show_»v”£_d©a
)

321 
ii
;

322 
ii
=0; ii<
»v”£_d©a
->
Ëngth
; ii++)

323 
	`åršt_msg
("%3d: %4d‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

324 
ii
,
»v”£_d©a
->
šdex
[ii],

325 
»v”£_d©a
->
¡¬t_fe
[
ii
],

326 
»v”£_d©a
->
¡¬t_pkt
[
ii
],

327 
»v”£_d©a
->
d©a_Ën
[
ii
]);

333 ià(!
es
->
»adšg_ES
)

336 
	`¡İ_£rv”_ouut
(
es
->
»ad”
);

338 
	`£t_PES_»ad”_video_Úly
(
es
->
»ad”
,
TRUE
);

343 ià(!
qu›t
)

344 
	`´št_msg
("\nPreparingo output„everse data\n");

345 
”r
 = 
	`ouut_·¿m‘”_£ts
(
ouut
,
acÚ‹xt
,
as_TS
,
qu›t
);

346 ià(
”r
)

348 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

349 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

353 ià(!
qu›t
)

354 
	`´št_msg
("\nOutputting in„everse order\n");

356 ià(
as_TS
)

357 
”r
 = 
	`ouut_š_»v”£_as_TS
(
es
,
ouut
.
ts_ouut
,
äequ’cy
,
v”bo£
,
qu›t
,

358 -1,0,
»v”£_d©a
);

360 
”r
 = 
	`ouut_š_»v”£_as_ES
(
es
,
ouut
.
es_ouut
,
äequ’cy
,
v”bo£
,
qu›t
,

361 -1,0,
»v”£_d©a
);

362 ià(!
”r
 && !
qu›t
)

364 
ušt32_t
 
fš®_šdex
 = 
»v”£_d©a
->
šdex
[»v”£_d©a->
fœ¡_wr™‹n
];

365 
	`´št_msg
("\n");

366 
	`´št_msg
("Summary\n");

367 
	`´št_msg
("=======\n");

368 
	`´št_msg
(" Considered Used Written\n");

369 
	`åršt_msg
("Access units %10d %10d (%4.1f%%) %10d (%4.1f%%)\n",

370 
fš®_šdex
,
»v”£_d©a
->
piùu»s_k•t
,

371 100*((()
»v”£_d©a
->
piùu»s_k•t
)/
fš®_šdex
),

372 
»v”£_d©a
->
piùu»s_wr™‹n
,

373 100*((()
»v”£_d©a
->
piùu»s_wr™‹n
)/
fš®_šdex
));

374 ià(
äequ’cy
 != 0)

375 
	`åršt_msg
("Target (access units) . %10d (%4.1f%%)‡t„equested"

376 " f»qu’cy %d\n",
fš®_šdex
/
äequ’cy
,100.0/frequency,

377 
äequ’cy
);

379 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

380 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

381  
”r
;

382 
	}
}

384 
	$´št_u§ge
()

386 
	`´št_msg
(

390 
	`REPORT_VERSION
("esreverse");

391 
	`´št_msg
(

425 #ià
SHOW_REVERSE_DATA


439 
	}
}

441 
	$maš
(
¬gc
, **
¬gv
)

443 *
šput_Çme
 = 
NULL
;

444 *
ouut_Çme
 = 
NULL
;

445 
had_šput_Çme
 = 
FALSE
;

446 
had_ouut_Çme
 = 
FALSE
;

447 
u£_¡dout
 = 
FALSE
;

448 
u£_tı
 = 
FALSE
;

449 
pÜt
 = 88;

450 
”r
 = 0;

451 
ES_p
 
es
 = 
NULL
;

452 
WRITER
 
ouut
;

453 
max
 = 0;

454 
as_TS
 = 
FALSE
;

455 
äequ’cy
 = 8;

456 
qu›t
 = 
FALSE
;

457 
v”bo£
 = 
FALSE
;

458 
ii
 = 1;

460 
u£_³s
 = 
FALSE
;

461 
u£_£rv”
 = 
FALSE
;

463 
wªt_d©a
 = 
VIDEO_H262
;

464 
is_d©a
;

465 
fÜû_¡»am_ty³
 = 
FALSE
;

466 
by‹
 
¡»am_ty³
;

468 ià(
¬gc
 < 2)

470 
	`´št_u§ge
();

474 
ouut
.
es_ouut
 = 
NULL
;

476 
ii
 < 
¬gc
)

478 ià(
¬gv
[
ii
][0] == '-')

480 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-help",argv[ii]) ||

481 !
	`¡rcmp
("-h",
¬gv
[
ii
]))

483 
	`´št_u§ge
();

486 #ià
SHOW_REVERSE_DATA


487 ià(!
	`¡rcmp
("-x",
¬gv
[
ii
]))

488 
show_»v”£_d©a
 = 
TRUE
;

490 ià(!
	`¡rcmp
("-avc",
¬gv
[
ii
]) || !strcmp("-h264",argv[ii]))

492 
fÜû_¡»am_ty³
 = 
TRUE
;

493 
wªt_d©a
 = 
VIDEO_H264
;

495 ià(!
	`¡rcmp
("-h262",
¬gv
[
ii
]))

497 
fÜû_¡»am_ty³
 = 
TRUE
;

498 
wªt_d©a
 = 
VIDEO_H262
;

500 ià(!
	`¡rcmp
("-³s",
¬gv
[
ii
]) || !strcmp("-ts",argv[ii]))

501 
u£_³s
 = 
TRUE
;

502 ià(!
	`¡rcmp
("-£rv”",
¬gv
[
ii
]))

504 
u£_£rv”
 = 
TRUE
;

505 
u£_³s
 = 
TRUE
;

506 
as_TS
 = 
TRUE
;

508 ià(!
	`¡rcmp
("-tsout",
¬gv
[
ii
]))

509 
as_TS
 = 
TRUE
;

510 ià(!
	`¡rcmp
("-¡dout",
¬gv
[
ii
]))

512 
had_ouut_Çme
 = 
TRUE
;

513 
u£_¡dout
 = 
TRUE
;

514 
	`»dœeù_ouut_¡d”r
();

516 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

518 
	`CHECKARG
("e¤ev”£",
ii
);

519 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

520 
	`»dœeù_ouut_¡d”r
();

521 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

522 
	`»dœeù_ouut_¡dout
();

525 
	`åršt_”r
("###ƒsreverse: "

527 " '¡d”r')\n",
¬gv
[
ii
+1]);

530 
ii
++;

532 ià(!
	`¡rcmp
("-ho¡",
¬gv
[
ii
]))

534 
	`CHECKARG
("e¤ev”£",
ii
);

535 
”r
 = 
	`ho¡_v®ue
("e¤ev”£",
¬gv
[
ii
],¬gv[ii+1],&
ouut_Çme
,&
pÜt
);

536 ià(
”r
)  1;

537 
had_ouut_Çme
 = 
TRUE
;

538 
u£_tı
 = 
TRUE
;

539 
as_TS
 = 
TRUE
;

540 
ii
++;

542 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

544 
v”bo£
 = 
TRUE
;

545 
qu›t
 = 
FALSE
;

547 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

549 
v”bo£
 = 
FALSE
;

550 
qu›t
 = 
TRUE
;

552 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

554 
	`CHECKARG
("e¤ev”£",
ii
);

555 
”r
 = 
	`št_v®ue
("e¤ev”£",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

556 ià(
”r
)  1;

557 
ii
++;

559 ià(!
	`¡rcmp
("-äeq",
¬gv
[
ii
]))

561 
	`CHECKARG
("e¤ev”£",
ii
);

562 
”r
 = 
	`št_v®ue
("e¤ev”£",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
äequ’cy
);

563 ià(
”r
)  1;

564 
ii
++;

568 
	`åršt_”r
("###ƒsreverse: "

569 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

575 ià(
had_šput_Çme
 && 
had_ouut_Çme
)

577 
	`åršt_”r
("###ƒ¤ev”£: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

580 ià(
had_šput_Çme
)

582 
ouut_Çme
 = 
¬gv
[
ii
];

583 
had_ouut_Çme
 = 
TRUE
;

587 
šput_Çme
 = 
¬gv
[
ii
];

588 
had_šput_Çme
 = 
TRUE
;

591 
ii
++;

594 ià(!
had_šput_Çme
)

596 
	`´št_”r
("###ƒsreverse: No input file specified\n");

599 ià(!
had_ouut_Çme
)

601 
	`´št_”r
("###ƒsreverse: No output file specified\n");

606 ià(
u£_¡dout
)

608 
v”bo£
 = 
FALSE
;

609 
qu›t
 = 
TRUE
;

612 
”r
 = 
	`İ’_šput_as_ES
(
šput_Çme
,
u£_³s
,
qu›t
,

613 
fÜû_¡»am_ty³
,
wªt_d©a
,&
is_d©a
,&
es
);

614 ià(
”r
)

616 
	`´št_”r
("###ƒsreverse: Error opening input file\n");

620 ià(
is_d©a
 =ğ
VIDEO_H262
)

621 
¡»am_ty³
 = 
MPEG2_VIDEO_STREAM_TYPE
;

622 ià(
is_d©a
 =ğ
VIDEO_H264
)

623 
¡»am_ty³
 = 
AVC_VIDEO_STREAM_TYPE
;

626 
	`´št_”r
("###ƒsreverse: Unexpectedype of video data\n");

630 ià(
as_TS
)

632 ià(
u£_¡dout
)

633 
”r
 = 
	`tswr™e_İ’
(
TS_W_STDOUT
,
NULL
,NULL,0,
qu›t
,&(
ouut
.
ts_ouut
));

634 ià(
u£_tı
)

635 
”r
 = 
	`tswr™e_İ’
(
TS_W_TCP
,
ouut_Çme
,
NULL
,
pÜt
,
qu›t
,&(
ouut
.
ts_ouut
));

637 
”r
 = 
	`tswr™e_İ’
(
TS_W_FILE
,
ouut_Çme
,
NULL
,0,
qu›t
,&(
ouut
.
ts_ouut
));

638 ià(
”r
)

640 
	`åršt_”r
("###ƒ¤ev”£: UÇbËØİ’ %s\n",
ouut_Çme
);

641 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

647 
ouut
.
es_ouut
 = 
	`fİ’
(
ouut_Çme
,"wb");

648 ià(
ouut
.
es_ouut
 =ğ
NULL
)

650 
	`åršt_”r
("###ƒsreverse: Unableo open output file %s: %s\n",

651 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

652 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

655 ià(!
qu›t
)

656 
	`åršt_msg
("Wr™šgØ %s\n",
ouut_Çme
);

659 ià(!
qu›t
)

661 ià(
as_TS
)

662 
	`´št_msg
("Writing‡s Transport Stream\n");

663 
	`åršt_msg
("F‹ršg f»q’cy %d\n",
äequ’cy
);

664 ià(
max
)

665 
	`åršt_msg
("Stİpšg‡ soÚ‡á” %d % a possibË\n",
max
,

666 (
is_d©a
 =ğ
VIDEO_H262
?"MPEG2 items":"NAL units"));

669 ià(
u£_³s
)

671 #ià
SHOW_REVERSE_DATA


672 ià(
show_»v”£_d©a
)

673 
es
->
»ad”
->
debug_»ad_·ck‘s
 = 
TRUE
;

675 ià(
u£_£rv”
)

678 
	`£t_£rv”_ouut
(
es
->
»ad”
,
ouut
.
ts_ouut
,
FALSE
,100);

679 
es
->
»ad”
->
debug_»ad_·ck‘s
 = 
TRUE
;

686 ià(
as_TS
)

688 ià(
u£_³s
)

690 ià(!
qu›t
)

691 
	`åršt_msg
("Usingransport stream id 1, PMT PID %#x,…rogram 1 ="

692 " PID %#x\n",
DEFAULT_PMT_PID
,
DEFAULT_VIDEO_PID
);

693 
	`£t_PES_»ad”_´og¿m_d©a
(
es
->
»ad”
,1,
DEFAULT_PMT_PID
,

694 
DEFAULT_VIDEO_PID
,

695 
DEFAULT_AUDIO_PID
,

696 
DEFAULT_VIDEO_PID
);

703 ià(!
qu›t
)

704 
	`åršt_msg
("Usingransport stream id 1, PMT PID %#x,…rogram 1 ="

705 " PID %#x, sŒ—my³ %#x\n",
DEFAULT_PMT_PID
,
DEFAULT_VIDEO_PID
,

706 
¡»am_ty³
);

707 
”r
 = 
	`wr™e_TS_´og¿m_d©a
(
ouut
.
ts_ouut
,

708 1,1,
DEFAULT_PMT_PID
,
DEFAULT_VIDEO_PID
,

709 
¡»am_ty³
);

710 ià(
”r
)

712 
	`´št_”r
("###ƒsreverse: Error writing out TS…rogram data\n");

713 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

714 ià(
as_TS
)

715 (è
	`tswr™e_şo£
(
ouut
.
ts_ouut
,
TRUE
);

716 ià(
had_ouut_Çme
 && !
u£_¡dout
)

718 
”r
 = 
	`fşo£
(
ouut
.
es_ouut
);

719 ià(
”r
)

720 
	`åršt_”r
("###ƒsreverse: (Error closing output file %s: %s)\n",

721 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

728 ià(
is_d©a
 =ğ
VIDEO_H262
)

729 
”r
 = 
	`»v”£_h262
(
es
,
ouut
,
max
,
äequ’cy
,
as_TS
,
v”bo£
,
qu›t
);

731 
”r
 = 
	`»v”£_acûss_un™s
(
es
,
ouut
,
max
,
äequ’cy
,
as_TS
,
v”bo£
,
qu›t
);

733 ià(
”r
)

735 
	`´št_”r
("###ƒsreverse: Error„eversing input\n");

736 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

737 ià(
as_TS
)

738 (è
	`tswr™e_şo£
(
ouut
.
ts_ouut
,
TRUE
);

739 ià(
had_ouut_Çme
 && !
u£_¡dout
)

741 
”r
 = 
	`fşo£
(
ouut
.
es_ouut
);

742 ià(
”r
)

743 
	`åršt_”r
("###ƒsreverse: (Error closing output file %s: %s)\n",

744 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

750 ià(
as_TS
)

752 
”r
 = 
	`tswr™e_şo£
(
ouut
.
ts_ouut
,
qu›t
);

753 ià(
”r
)

755 
	`åršt_”r
("###ƒsreverse: Error closing output file %s",

756 
ouut_Çme
);

757 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

761 ià(!
u£_¡dout
)

763 
”ºo
 = 0;

764 
”r
 = 
	`fşo£
(
ouut
.
es_ouut
);

765 ià(
”r
)

767 
	`åršt_”r
("###ƒsreverse: Error closing output file %s: %s\n",

768 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

769 (è
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

774 
”r
 = 
	`şo£_šput_as_ES
(
šput_Çme
,&
es
);

775 ià(
”r
)

777 
	`´št_”r
("###ƒsreverse: Error closing input file\n");

781 
	}
}

	@ethernet.c

30 
	~"‘h”Ãt.h
"

31 
	~<¡ršg.h
>

32 
	~"misc_âs.h
"

34 
	$‘h”Ãt_·ck‘_äom_pÿp
(
pÿ´ec_hdr_t
 *
hdr
,

35 cÚ¡ 
ušt8_t
 *
d©a
,

36 cÚ¡ 
ušt32_t
 
Ën
,

37 
‘h”Ãt_·ck‘_t
 *
pkt
,

38 
ušt32_t
 *
out_¡
,

39 
ušt32_t
 *
out_Ën
)

41 
ušt32_t
 
eoh
;

42 cÚ¡ 
ušt8_t
 *
p
 = 
d©a
;

43 cÚ¡ 
ušt8_t
 * cÚ¡ 
eİ
 = 
d©a
 + 
Ën
;

45 
pkt
->
vÏn_couÁ
 = 0;

48 ià(
Ën
 < 14)

50  
ETHERNET_ERR_PKT_TOO_SHORT
;

54 
	`memıy
(
pkt
->
d¡_addr
, 
p
, 6);

55 
p
 += 6;

56 
	`memıy
(
pkt
->
¤c_addr
, 
p
, 6);

57 
p
 += 6;

60 
pkt
->
ty³ÜËn
 = 
	`ušt_16_be
(
p
);

61 
p
 += 2;

67 ià(
pkt
->
ty³ÜËn
 <= 0x5DC)

69 (*
out_Ën
èğ
pkt
->
ty³ÜËn
;

71 
eoh
 = 14;

76 
pkt
->
ty³ÜËn
 == 0x8100)

78 ià(
pkt
->
vÏn_couÁ
 >ğ
ETHERNET_VLANS_MAX
)

80  
ETHERNET_ERR_TOO_MANY_VLANS
;

82 ià(
p
 + 4 > 
eİ
)

84  
ETHERNET_ERR_PKT_TOO_SHORT
;

87 
pkt
->
vÏns
[pkt->
vÏn_couÁ
].
pı
 = (
p
[0] >> 5) & 7;

88 
pkt
->
vÏns
[pkt->
vÏn_couÁ
].
cfi
 = (
p
[0] >> 4) & 1;

89 
pkt
->
vÏns
[pkt->
vÏn_couÁ
].
vid
 = 
	`ušt_16_be
(
p
) & 0xfff;

90 
p
 += 2;

91 ++
pkt
->
vÏn_couÁ
;

93 
pkt
->
ty³ÜËn
 = 
	`ušt_16_be
(
p
);

94 
p
 += 2;

97 
eoh
 = 
p
 - 
d©a
;

100 (*
out_Ën
èğ
Ën
 - 
eoh
;

103 (*
out_¡
èğ
eoh
;

106 
	}
}

	@ethernet.h

30 #iâdeà
_‘h”Ãt_h


31 
	#_‘h”Ãt_h


	)

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~"com·t.h
"

37 
	~"pÿp.h
"

39 
	s‘h”Ãt_vÏn_šfo_s


41 
	mcfi
;

42 
	mpı
;

43 
	mvid
;

44 } 
	t‘h”Ãt_vÏn_šfo_t
;

46 
	s‘h”Ãt_·ck‘_s


49 
ušt8_t
 
	m¤c_addr
[6];

52 
ušt8_t
 
	md¡_addr
[6];

56 
	#ETHERNET_MAY_BE_IP
(
ty³ÜËn
è(Ñy³ÜËnè=ğ0x800 || (ty³ÜËnè<ğ0x5DC)

	)

58 
	#ETHERNET_TYPE_IP
 0x800

	)

60 
ušt16_t
 
	mty³ÜËn
;

62 
	#ETHERNET_VLANS_MAX
 2

	)

63 
	mvÏn_couÁ
;

64 
‘h”Ãt_vÏn_šfo_t
 
	mvÏns
[
ETHERNET_VLANS_MAX
];

67 
ušt32_t
 
	mchecksum
;

68 } 
	t‘h”Ãt_·ck‘_t
;

70 
	#ETHERNET_ERR_PKT_TOO_SHORT
 (-1)

	)

71 
	#ETHERNET_ERR_TOO_MANY_VLANS
 (-2)

	)

80 
‘h”Ãt_·ck‘_äom_pÿp
(
pÿ´ec_hdr_t
 *
hdr
,

81 cÚ¡ 
ušt8_t
 *
d©a
,

82 cÚ¡ 
ušt32_t
 
Ën
,

83 
‘h”Ãt_·ck‘_t
 *
pkt
,

84 
ušt32_t
 *
out_¡
,

85 
ušt32_t
 *
out_Ën
);

	@filter.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<”ºo.h
>

34 
	~<fú.h
>

35 
	~<¡ršg.h
>

36 #ifdeà
_WIN32


37 
	~<io.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"es_âs.h
"

44 
	~"ts_âs.h
"

45 
	~"acûssun™_âs.h
"

46 
	~"h262_âs.h
"

47 
	~"misc_âs.h
"

48 
	~"´štšg_âs.h
"

49 
	~"f‹r_âs.h
"

51 
	#DEBUG
 0

	)

62 
	$Ãw_h262_f‹r_cÚ‹xt
(
h262_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
)

64 
h262_f‹r_cÚ‹xt_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_H262_FILTER_CONTEXT
);

65 ià(
Ãw
 =ğ
NULL
)

67 
	`´št_”r
("### Unableo‡llocate H.262 filter context\n");

70 
Ãw
->
h262
 = 
NULL
;

71 
Ãw
->
Ï¡_£q_hdr
 = 
NULL
;

72 
Ãw
->
Ãw_£q_hdr
 = 
FALSE
;

74 
	`»£t_h262_f‹r_cÚ‹xt
(
Ãw
);

76 *
fcÚ‹xt
 = 
Ãw
;

78 
	}
}

89 
	$bud_h262_f‹r_cÚ‹xt_¡r
(
h262_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

90 
h262_cÚ‹xt_p
 
h262
,

91 
®l_IP
)

93 
”r
 = 
	`Ãw_h262_f‹r_cÚ‹xt
(
fcÚ‹xt
);

94 ià(
”r
)  1;

96 (*
fcÚ‹xt
)->
h262
 = h262;

97 (*
fcÚ‹xt
)->
f‹r
 = 
FALSE
;

98 (*
fcÚ‹xt
)->
®Ìef
 = 
®l_IP
;

100 
	}
}

112 
	$bud_h262_f‹r_cÚ‹xt
(
h262_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

113 
h262_cÚ‹xt_p
 
h262
,

114 
äeq
)

116 
”r
 = 
	`Ãw_h262_f‹r_cÚ‹xt
(
fcÚ‹xt
);

117 ià(
”r
)  1;

119 (*
fcÚ‹xt
)->
h262
 = h262;

120 (*
fcÚ‹xt
)->
f‹r
 = 
TRUE
;

121 (*
fcÚ‹xt
)->
äeq
 = freq;

123 
	}
}

128 
	$»£t_h262_f‹r_cÚ‹xt
(
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
)

130 
fcÚ‹xt
->
³ndšg_EOF
 = 
FALSE
;

131 
fcÚ‹xt
->
Ï¡_was_¦iû
 = 
FALSE
;

132 
fcÚ‹xt
->
had_´evious_piùu»
 = 
FALSE
;

133 ià(
fcÚ‹xt
->
Ï¡_£q_hdr
 !ğ
NULL
)

134 
	`ä“_h262_piùu»
(&
fcÚ‹xt
->
Ï¡_£q_hdr
);

135 
fcÚ‹xt
->
Ãw_£q_hdr
 = 
FALSE
;

137 
fcÚ‹xt
->
couÁ
 = 0;

138 
fcÚ‹xt
->
äames_£’
 = 0;

139 
fcÚ‹xt
->
äames_wr™‹n
 = 0;

140 
	}
}

151 
	$ä“_h262_f‹r_cÚ‹xt
(
h262_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
)

153 ià((*
fcÚ‹xt
è=ğ
NULL
)

158 
	`»£t_h262_f‹r_cÚ‹xt
(*
fcÚ‹xt
);

161 (*
fcÚ‹xt
)->
h262
 = 
NULL
;

163 
	`ä“
(*
fcÚ‹xt
);

164 *
fcÚ‹xt
 = 
NULL
;

166 
	}
}

176 
	$Ãw_h264_f‹r_cÚ‹xt
(
h264_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
)

178 
h264_f‹r_cÚ‹xt_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_H264_FILTER_CONTEXT
);

179 ià(
Ãw
 =ğ
NULL
)

181 
	`´št_”r
("### Unableo‡llocate H.264 filter context\n");

188 
Ãw
->
acûss_un™_cÚ‹xt
 = 
NULL
;

190 
	`»£t_h264_f‹r_cÚ‹xt
(
Ãw
);

192 *
fcÚ‹xt
 = 
Ãw
;

194 
	}
}

206 
	$bud_h264_f‹r_cÚ‹xt_¡r
(
h264_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

207 
acûss_un™_cÚ‹xt_p
 
acûss
,

208 
®Ìef
)

210 
”r
 = 
	`Ãw_h264_f‹r_cÚ‹xt
(
fcÚ‹xt
);

211 ià(
”r
)  1;

213 (*
fcÚ‹xt
)->
acûss_un™_cÚ‹xt
 = 
acûss
;

214 (*
fcÚ‹xt
)->
f‹r
 = 
FALSE
;

215 (*
fcÚ‹xt
)->
®Ìef
 =‡llref;

217 
	}
}

229 
	$bud_h264_f‹r_cÚ‹xt
(
h264_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

230 
acûss_un™_cÚ‹xt_p
 
acûss
,

231 
äeq
)

233 
”r
 = 
	`Ãw_h264_f‹r_cÚ‹xt
(
fcÚ‹xt
);

234 ià(
”r
)  1;

236 (*
fcÚ‹xt
)->
acûss_un™_cÚ‹xt
 = 
acûss
;

237 (*
fcÚ‹xt
)->
f‹r
 = 
TRUE
;

238 (*
fcÚ‹xt
)->
äeq
 = freq;

240 
	}
}

245 
	$»£t_h264_f‹r_cÚ‹xt
(
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
)

249 
fcÚ‹xt
->
sk³d_»f_pic
 = 
FALSE
;

253 
fcÚ‹xt
->
Ï¡_acû±ed_was_nÙ_IDR
 = 
TRUE
;

255 
fcÚ‹xt
->
had_´evious_acûss_un™
 = 
FALSE
;

257 
fcÚ‹xt
->
nÙ_had_IDR
 = 
TRUE
;

259 
fcÚ‹xt
->
couÁ
 = 0;

260 
fcÚ‹xt
->
äames_£’
 = 0;

261 
fcÚ‹xt
->
äames_wr™‹n
 = 0;

262 
	}
}

273 
	$ä“_h264_f‹r_cÚ‹xt
(
h264_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
)

275 ià((*
fcÚ‹xt
è=ğ
NULL
)

280 
	`»£t_h264_f‹r_cÚ‹xt
(*
fcÚ‹xt
);

283 (*
fcÚ‹xt
)->
acûss_un™_cÚ‹xt
 = 
NULL
;

285 
	`ä“
(*
fcÚ‹xt
);

286 *
fcÚ‹xt
 = 
NULL
;

288 
	}
}

329 
	$g‘_Ãxt_¡r³d_h262_äame
(
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

330 
v”bo£
,

331 
qu›t
,

332 
h262_piùu»_p
 *
£q_hdr
,

333 
h262_piùu»_p
 *
äame
,

334 *
äames_£’
)

336 
”r
;

339 
h262_piùu»_p
 
this_piùu»
 = 
NULL
;

341 *
äames_£’
 = 0;

343 ià(
fcÚ‹xt
->
f‹r
)

345 
	`´št_”r
("### Calling get_next_stripped_h262_frame with‡ context"

353 ià(
	`es_commªd_chªged
(
fcÚ‹xt
->
h262
->
es
))

355 *
äame
 = *
£q_hdr
 = 
NULL
;

356  
COMMAND_RETURN_CODE
;

359 
”r
 = 
	`g‘_Ãxt_h262_äame
(
fcÚ‹xt
->
h262
,
v”bo£
,
qu›t
,&
this_piùu»
);

360 ià(
”r
 =ğ
EOF
)

362 *
äame
 = *
£q_hdr
 = 
NULL
;

363  
”r
;

365 ià(
”r
)

367 
	`´št_”r
("### Error filtering H.262 frames\n");

372 ià(
this_piùu»
->
is_piùu»
)

374 (*
äames_£’
) ++;

375 ià((
this_piùu»
->
piùu»_codšg_ty³
 == 1) ||

376 (
this_piùu»
->
piùu»_codšg_ty³
 =ğ2 && 
fcÚ‹xt
->
®Ìef
) )

378 *
äame
 = 
this_piùu»
;

379 ià(
fcÚ‹xt
->
Ãw_£q_hdr
)

380 *
£q_hdr
 = 
fcÚ‹xt
->
Ï¡_£q_hdr
;

382 *
£q_hdr
 = 
NULL
;

383 
fcÚ‹xt
->
Ãw_£q_hdr
 = 
FALSE
;

384 ià(
v”bo£
è
	`åršt_msg
(">> %s…icture \n",

385 (
this_piùu»
->
piùu»_codšg_ty³
==1?"I":"P"));

389 
	`ä“_h262_piùu»
(&
this_piùu»
);

391 ià(
this_piùu»
->
is_£qu’û_h—d”
)

394 ià(
fcÚ‹xt
->
Ï¡_£q_hdr
 =ğ
NULL
)

396 
fcÚ‹xt
->
Ï¡_£q_hdr
 = 
this_piùu»
;

397 
fcÚ‹xt
->
Ãw_£q_hdr
 = 
TRUE
;

398 ià(
v”bo£
è
	`´št_msg
(">> First sequence header\n");

400 ià(!
	`§me_h262_piùu»
(
this_piùu»
,
fcÚ‹xt
->
Ï¡_£q_hdr
))

402 ià(
v”bo£
è
	`´št_msg
(">> Different sequence header\n");

403 
	`ä“_h262_piùu»
(&
fcÚ‹xt
->
Ï¡_£q_hdr
);

404 
fcÚ‹xt
->
Ï¡_£q_hdr
 = 
this_piùu»
;

405 
fcÚ‹xt
->
Ãw_£q_hdr
 = 
TRUE
;

409 
fcÚ‹xt
->
Ãw_£q_hdr
 = 
FALSE
;

410 ià(
v”bo£
è
	`´št_msg
(">> Identical sequence header\n");

411 
	`ä“_h262_piùu»
(&
this_piùu»
);

415 
	}
}

455 
	$g‘_Ãxt_f‹»d_h262_äame
(
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

456 
v”bo£
,

457 
qu›t
,

458 
h262_piùu»_p
 *
£q_hdr
,

459 
h262_piùu»_p
 *
äame
,

460 *
äames_£’
)

462 
”r
;

465 
h262_piùu»_p
 
this_piùu»
 = 
NULL
;

467 *
äames_£’
 = 0;

469 ià(!
fcÚ‹xt
->
f‹r
)

471 
	`´št_”r
("### Calling get_next_filtered_h262_frame with‡ context"

479 ià(
	`es_commªd_chªged
(
fcÚ‹xt
->
h262
->
es
))

481 *
äame
 = *
£q_hdr
 = 
NULL
;

482  
COMMAND_RETURN_CODE
;

487 
fcÚ‹xt
->
h262
->
add_çke_afd
 = 
TRUE
;

489 
”r
 = 
	`g‘_Ãxt_h262_äame
(
fcÚ‹xt
->
h262
,
v”bo£
,
qu›t
,&
this_piùu»
);

490 ià(
”r
 =ğ
EOF
)

492 *
äame
 = *
£q_hdr
 = 
NULL
;

493 
fcÚ‹xt
->
h262
->
add_çke_afd
 = 
FALSE
;

494  
”r
;

496 ià(
”r
)

498 
	`´št_”r
("### Error filtering H.262 frames\n");

499 
fcÚ‹xt
->
h262
->
add_çke_afd
 = 
FALSE
;

504 
fcÚ‹xt
->
h262
->
add_çke_afd
 = 
FALSE
;

507 ià(
this_piùu»
->
is_piùu»
)

509 
fcÚ‹xt
->
couÁ
 ++;

510 (*
äames_£’
) ++;

512 
fcÚ‹xt
->
äames_£’
 ++;

514 ià(
this_piùu»
->
piùu»_codšg_ty³
 == 1 &&

515 
fcÚ‹xt
->
couÁ
 < fcÚ‹xt->
äeq
)

518 ià(
v”bo£
)

520 
	`åršt_msg
("+++ %d/%d DROP: ToØsoÚ\n",
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

523 ià(
this_piùu»
->
piùu»_codšg_ty³
 != 1)

526 ià(
v”bo£
)

528 
	`åršt_msg
("+++ %d/%d DROP: % piùu»\n",
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
,

529 
	`H262_PICTURE_CODING_STR
(
this_piùu»
->
piùu»_codšg_ty³
));

532 ià(
fcÚ‹xt
->
äeq
 > 0)

534 
piùu»s_wª‹d
 = 
fcÚ‹xt
->
äames_£’
 / fcÚ‹xt->
äeq
;

535 
»³©
 = 
piùu»s_wª‹d
 - 
fcÚ‹xt
->
äames_wr™‹n
;

536 ià(
»³©
 > 0 && 
fcÚ‹xt
->
had_´evious_piùu»
)

538 ià(
v”bo£
è
	`´št_msg
(">>> output†ast…icture‡gain\n");

539 
	`ä“_h262_piùu»
(&
this_piùu»
);

540 *
£q_hdr
 = 
NULL
;

541 *
äame
 = 
NULL
;

542 
fcÚ‹xt
->
äames_wr™‹n
 ++;

550 ià(
v”bo£
)

552 
	`åršt_msg
("+++ %d/%d KEEP\n",
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

554 
fcÚ‹xt
->
couÁ
 = 0;

555 
fcÚ‹xt
->
had_´evious_piùu»
 = 
TRUE
;

556 *
£q_hdr
 = 
fcÚ‹xt
->
Ï¡_£q_hdr
;

557 *
äame
 = 
this_piùu»
;

559 
fcÚ‹xt
->
äames_wr™‹n
 ++;

562 
	`ä“_h262_piùu»
(&
this_piùu»
);

564 ià(
this_piùu»
->
is_£qu’û_h—d”
)

567 ià(
fcÚ‹xt
->
Ï¡_£q_hdr
 !ğ
NULL
)

568 
	`ä“_h262_piùu»
(&
fcÚ‹xt
->
Ï¡_£q_hdr
);

569 
fcÚ‹xt
->
Ï¡_£q_hdr
 = 
this_piùu»
;

572 
	}
}

598 
	$g‘_Ãxt_¡r³d_h264_äame
(
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

599 
v”bo£
,

600 
qu›t
,

601 
acûss_un™_p
 *
äame
,

602 *
äames_£’
)

604 
”r
 = 0;

605 
k“p
 = 
FALSE
;

606 
acûss_un™_p
 
this_acûss_un™
 = 
NULL
;

608 *
äames_£’
 = 0;

612 ià(
	`es_commªd_chªged
(
fcÚ‹xt
->
acûss_un™_cÚ‹xt
->
Çc
->
es
))

613  
COMMAND_RETURN_CODE
;

615 ià(
v”bo£
)

616 
	`´št_msg
("\n");

618 
”r
 = 
	`g‘_Ãxt_h264_äame
(
fcÚ‹xt
->
acûss_un™_cÚ‹xt
,
qu›t
,
v”bo£
,

619 &
this_acûss_un™
);

620 ià(
”r
 =ğ
EOF
)

621  
”r
;

622 ià(
”r
)

625 (*
äames_£’
) ++;

627 ià(
this_acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

631 
k“p
 = 
FALSE
;

632 ià(
v”bo£
)

633 
	`´št_msg
("++ DROP:‚o…rimary…icture\n");

635 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_»f_idc
 == 0)

638 
k“p
 = 
FALSE
;

639 ià(
v”bo£
)

640 
	`´št_msg
("++ DROP:‚ot„eference\n");

642 ià(
fcÚ‹xt
->
®Ìef
)

645 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
 ||

646 
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_NON_IDR
)

648 
k“p
 = 
TRUE
;

649 ià(
v”bo£
)

650 
	`´št_msg
("++ KEEP:„eference…icture\n");

654 
k“p
 = 
FALSE
;

655 ià(
v”bo£
)

656 
	`´št_msg
("++ DROP: sequence or…arameter set,ƒtc.\n");

662 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
)

664 
k“p
 = 
TRUE
;

665 ià(
v”bo£
)

666 
	`´št_msg
("++ KEEP: IDR…icture\n");

668 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_NON_IDR
 &&

669 
	`®l_¦iûs_I
(
this_acûss_un™
))

671 
k“p
 = 
TRUE
;

672 ià(
v”bo£
)

673 
	`´št_msg
("++ KEEP:‡ll slices I\n");

677 
k“p
 = 
FALSE
;

678 ià(
v”bo£
)

679 
	`´št_msg
("++ DROP:‚ot IDR or‡ll slices I\n");

683 ià(
k“p
)

685 *
äame
 = 
this_acûss_un™
;

689 
	`ä“_acûss_un™
(&
this_acûss_un™
);

691 
	}
}

722 
	$g‘_Ãxt_f‹»d_h264_äame
(
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

723 
v”bo£
,

724 
qu›t
,

725 
acûss_un™_p
 *
äame
,

726 *
äames_£’
)

728 
”r
 = 0;

729 
k“p
 = 
FALSE
;

730 
acûss_un™_p
 
this_acûss_un™
 = 
NULL
;

732 *
äames_£’
 = 0;

736 ià(
	`es_commªd_chªged
(
fcÚ‹xt
->
acûss_un™_cÚ‹xt
->
Çc
->
es
))

737  
COMMAND_RETURN_CODE
;

739 ià(
v”bo£
)

740 
	`´št_msg
("\n");

742 
”r
 = 
	`g‘_Ãxt_h264_äame
(
fcÚ‹xt
->
acûss_un™_cÚ‹xt
,
qu›t
,
v”bo£
,

743 &
this_acûss_un™
);

744 ià(
”r
 =ğ
EOF
)

745  
”r
;

746 ià(
”r
)

749 
fcÚ‹xt
->
couÁ
 ++;

750 (*
äames_£’
) ++;

752 
fcÚ‹xt
->
äames_£’
 ++;

754 ià(
this_acûss_un™
->
´im¬y_¡¬t
 =ğ
NULL
)

758 
k“p
 = 
FALSE
;

759 ià(
v”bo£
)

760 
	`åršt_msg
("++ %d/%d DROP:‚o…rimary…icture\n",

761 
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

763 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_»f_idc
 == 0)

766 
k“p
 = 
FALSE
;

767 ià(
v”bo£
)

768 
	`åršt_msg
("++ %d/%d DROP:‚ot‡„eference frame\n",

769 
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

771 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
 &&

772 
fcÚ‹xt
->
Ï¡_acû±ed_was_nÙ_IDR
)

780 
k“p
 = 
TRUE
;

781 
fcÚ‹xt
->
nÙ_had_IDR
 = 
FALSE
;

782 
fcÚ‹xt
->
sk³d_»f_pic
 = 
FALSE
;

783 
fcÚ‹xt
->
Ï¡_acû±ed_was_nÙ_IDR
 = 
FALSE
;

784 ià(
v”bo£
)

785 
	`åršt_msg
("++ %d/%d KEEP: IDR‡nd†ast was‚ot\n",

786 
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

788 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
 &&

789 
fcÚ‹xt
->
nÙ_had_IDR
)

793 
k“p
 = 
TRUE
;

794 
fcÚ‹xt
->
sk³d_»f_pic
 = 
FALSE
;

795 
fcÚ‹xt
->
Ï¡_acû±ed_was_nÙ_IDR
 = 
FALSE
;

796 ià(
v”bo£
)

797 
	`åršt_msg
("++ %d/%d KEEP: IDR‡nd first IDR of filter„un\n",

798 
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

800 ià(
fcÚ‹xt
->
couÁ
 < fcÚ‹xt->
äeq
)

804 
k“p
 = 
FALSE
;

805 
fcÚ‹xt
->
sk³d_»f_pic
 = 
TRUE
;

806 ià(
v”bo£
)

807 
	`åršt_msg
("++ %d/%d DROP: Too soon (skipping„ef frame)\n",

808 
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

810 ià(
this_acûss_un™
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
)

813 
k“p
 = 
TRUE
;

814 
fcÚ‹xt
->
sk³d_»f_pic
 = 
FALSE
;

815 
fcÚ‹xt
->
Ï¡_acû±ed_was_nÙ_IDR
 = 
FALSE
;

816 ià(
v”bo£
)

817 
	`åršt_msg
("++ %d/%d KEEP: IDR\n",
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

819 ià(
	`®l_¦iûs_I
(
this_acûss_un™
))

823 
k“p
 = 
TRUE
;

824 
fcÚ‹xt
->
Ï¡_acû±ed_was_nÙ_IDR
 = 
TRUE
;

825 ià(
v”bo£
)

826 
	`åršt_msg
("++ %d/%d KEEP: I f¿me\n",
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

828 ià(!
fcÚ‹xt
->
sk³d_»f_pic
 && 
	`®l_¦iûs_I_Ü_P
(
this_acûss_un™
))

833 
k“p
 = 
TRUE
;

834 
fcÚ‹xt
->
Ï¡_acû±ed_was_nÙ_IDR
 = 
TRUE
;

835 ià(
v”bo£
)

836 
	`åršt_msg
("++ %d/%d KEEP: P frame.‚o skipped„ef frames\n",

837 
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

841 
k“p
 = 
FALSE
;

842 
fcÚ‹xt
->
sk³d_»f_pic
 = 
TRUE
;

843 ià(
v”bo£
)

844 
	`åršt_msg
("++ %d/%d DROP:„ef frame skippedƒarlier\n",

845 
fcÚ‹xt
->
couÁ
,fcÚ‹xt->
äeq
);

848 ià(
k“p
)

850 *
äame
 = 
this_acûss_un™
;

851 
fcÚ‹xt
->
had_´evious_acûss_un™
 = 
TRUE
;

852 
fcÚ‹xt
->
äames_wr™‹n
 ++;

853 
fcÚ‹xt
->
couÁ
 = 0;

858 ià(
fcÚ‹xt
->
äeq
 > 0)

860 
acûss_un™s_wª‹d
 = 
fcÚ‹xt
->
äames_£’
 / fcÚ‹xt->
äeq
;

861 
»³©
 = 
acûss_un™s_wª‹d
 - 
fcÚ‹xt
->
äames_wr™‹n
;

862 ià(
»³©
 > 0 && 
fcÚ‹xt
->
had_´evious_acûss_un™
)

864 ià(
v”bo£
è
	`´št_msg
(">>> output†ast‡ccess unit‡gain\n");

865 
	`ä“_acûss_un™
(&
this_acûss_un™
);

866 *
äame
 = 
NULL
;

867 
fcÚ‹xt
->
äames_wr™‹n
 ++;

872 
	`ä“_acûss_un™
(&
this_acûss_un™
);

875 
	}
}

	@filter_defns.h

30 #iâdeà
_f‹r_deâs


31 
	#_f‹r_deâs


	)

33 
	~"com·t.h
"

34 
	~"es_deâs.h
"

35 
	~"h262_deâs.h
"

36 
	~"acûssun™_deâs.h
"

37 
	~"»v”£_deâs.h
"

50 
	sh262_f‹r_cÚ‹xt


52 
h262_cÚ‹xt_p
 
	mh262
;

53 
	mf‹r
;

54 
	mäeq
;

55 
	m®Ìef
;

60 
	m³ndšg_EOF
;

63 
	mcouÁ
;

64 
	mÏ¡_was_¦iû
;

65 
	mhad_´evious_piùu»
;

66 
h262_piùu»_p
 
	mÏ¡_£q_hdr
;

69 
	mÃw_£q_hdr
;

71 
	mäames_£’
;

72 
	mäames_wr™‹n
;

74 
h262_f‹r_cÚ‹xt
 *
	th262_f‹r_cÚ‹xt_p
;

75 
	#SIZEOF_H262_FILTER_CONTEXT
 (
h262_f‹r_cÚ‹xt
)

	)

78 
	sh264_f‹r_cÚ‹xt


80 
acûss_un™_cÚ‹xt_p
 
	macûss_un™_cÚ‹xt
;

81 
	mf‹r
;

82 
	mäeq
;

83 
	m®Ìef
;

87 
	mcouÁ
;

90 
	msk³d_»f_pic
;

94 
	mÏ¡_acû±ed_was_nÙ_IDR
;

95 
	mhad_´evious_acûss_un™
;

98 
	mnÙ_had_IDR
;

100 
	mäames_£’
;

101 
	mäames_wr™‹n
;

103 
h264_f‹r_cÚ‹xt
 *
	th264_f‹r_cÚ‹xt_p
;

104 
	#SIZEOF_H264_FILTER_CONTEXT
 (
h264_f‹r_cÚ‹xt
)

	)

	@filter_fns.h

29 #iâdeà
_f‹r_âs


30 
	#_f‹r_âs


	)

32 
	~"f‹r_deâs.h
"

43 
bud_h262_f‹r_cÚ‹xt_¡r
(
h262_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

44 
h262_cÚ‹xt_p
 
h262
,

45 
®l_IP
);

56 
bud_h262_f‹r_cÚ‹xt
(
h262_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

57 
h262_cÚ‹xt_p
 
h262
,

58 
äeq
);

62 
»£t_h262_f‹r_cÚ‹xt
(
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
);

72 
ä“_h262_f‹r_cÚ‹xt
(
h262_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
);

83 
bud_h264_f‹r_cÚ‹xt_¡r
(
h264_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

84 
acûss_un™_cÚ‹xt_p
 
acûss
,

85 
®Ìef
);

96 
bud_h264_f‹r_cÚ‹xt
(
h264_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
,

97 
acûss_un™_cÚ‹xt_p
 
acûss
,

98 
äeq
);

102 
»£t_h264_f‹r_cÚ‹xt
(
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
);

112 
ä“_h264_f‹r_cÚ‹xt
(
h264_f‹r_cÚ‹xt_p
 *
fcÚ‹xt
);

150 
g‘_Ãxt_¡r³d_h262_äame
(
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

151 
v”bo£
,

152 
qu›t
,

153 
h262_piùu»_p
 *
£q_hdr
,

154 
h262_piùu»_p
 *
äame
,

155 *
äames_£’
);

194 
g‘_Ãxt_f‹»d_h262_äame
(
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

195 
v”bo£
,

196 
qu›t
,

197 
h262_piùu»_p
 *
£q_hdr
,

198 
h262_piùu»_p
 *
äame
,

199 *
äames_£’
);

221 
g‘_Ãxt_¡r³d_h264_äame
(
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

222 
v”bo£
,

223 
qu›t
,

224 
acûss_un™_p
 *
äame
,

225 *
äames_£’
);

255 
g‘_Ãxt_f‹»d_h264_äame
(
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt
,

256 
v”bo£
,

257 
qu›t
,

258 
acûss_un™_p
 *
äame
,

259 *
äames_£’
);

	@fmtx.c

29 
	~<¡dio.h
>

30 #ifdeà
_WIN32


31 
	~<¡ddef.h
>

33 
	~<uni¡d.h
>

35 
	~<¡ršg.h
>

37 
	~"com·t.h
"

38 
	~"fmtx.h
"

40 
TCHAR
 
	gfmtx_bufãrs
[
FMTX_BUFFERS_COUNT
][
FMTX_BUFFER_SIZE
];

41 
	gfmtx_buf_no
 = 0;

43 
TCHAR
 *
	$fmtx_®loc
()

45 cÚ¡ 
n
 = 
fmtx_buf_no
++ % 
FMTX_BUFFERS_COUNT
;

46  
fmtx_bufãrs
[
n
];

47 
	}
}

49 
	$äac_27MHz
(
št64_t
 
n
)

51  ()((
n
 < 0 ? -n :‚) % 300LL);

52 
	}
}

54 cÚ¡ 
TCHAR
 *
	$fmtx_time¡amp
(
št64_t
 
n
, 
æags
)

56 
TCHAR
 *
buf
 = 
	`fmtx_®loc
();

57 
št64_t
 
n27
 = 
n
 * ((
æags
 & 
FMTX_TS_N_27MHz
) != 0 ? 1LL : 300LL);

59 
æags
 & 
FMTX_TS_DISPLAY_MASK
)

62 
FMTX_TS_DISPLAY_90kHz_RAW
:

63 
	`_¢rštf
(
buf
, 
FMTX_BUFFER_SIZE
, 
	`_T
("%"è
I64FMT
 _T("dt"), 
n27
 / 300LL);

66 
FMTX_TS_DISPLAY_27MHz_RAW
:

67 
	`_¢rštf
(
buf
, 
FMTX_BUFFER_SIZE
, 
	`_T
("%"è
I64FMT
 _T("d:%03dt"), 
n27
 / 300LL, 
	`äac_27MHz
(n27));

70 
FMTX_TS_DISPLAY_90kHz_32BIT
:

72 
št64_t
 
n90
 = 
n27
 / 300LL;

73 
TCHAR
 * 
p
 = 
buf
;

74 ià(
n90
 < 0)

75 *
p
++ = 
	`_T
('-');

76 
	`_¢rštf
(
p
, 
FMTX_BUFFER_SIZE
, 
	`_T
("%ut"), ()(
n90
 < 0 ? -n90 :‚90));

80 
FMTX_TS_DISPLAY_ms
:

82 
	`_¢rštf
(
buf
, 
FMTX_BUFFER_SIZE
, 
	`_T
("%dms"), ()(
n27
 / 27000LL));

85 
FMTX_TS_DISPLAY_HMS
:

87 
h
, 
m
, 
s
, 
f
;

88 
št64_t
 
a27
 = 
n27
 < 0 ? -n27 :‚27;

89 
a27
 /ğ
	`I64K
(27);

90 
f
 = ()(
a27
 % 
	`I64K
(1000000));

91 
a27
 /ğ
	`I64K
(1000000);

92 
s
 = ()(
a27
 % 
	`I64K
(60));

93 
a27
 /ğ
	`I64K
(60);

94 
m
 = ()(
a27
 % 
	`I64K
(60));

95 
h
 = ()(
a27
 / 
	`I64K
(60));

96 
	`_¢rštf
(
buf
, 
FMTX_BUFFER_SIZE
, 
	`_T
("%s%u:%02u:%02u.%04u"), 
n27
 < 0 ? _T("-"è: _T(""), 
h
, 
m
, 
s
, 
f
/1000);

101  (cÚ¡ 
TCHAR
 *)
buf
;

102 
	}
}

105 cÚ¡ 
	ss2tsfss


107 cÚ¡ * 
	m¡r
;

108 
	mæags
;

109 } 
	gs2tsf
[] =

111 {"hms", 
FMTX_TS_DISPLAY_HMS
},

112 {"ms", 
FMTX_TS_DISPLAY_ms
},

113 {"90", 
FMTX_TS_DISPLAY_90kHz_RAW
},

114 {"32", 
FMTX_TS_DISPLAY_90kHz_32BIT
},

115 {"27", 
FMTX_TS_DISPLAY_27MHz_RAW
},

116 {
NULL
, -1}

119 
	$fmtx_¡r_to_time¡amp_æags
(cÚ¡ 
TCHAR
 *
¬g_¡r
)

121 cÚ¡ 
s2tsfss
 * 
p
;

122 
p
 = 
s2tsf
;…->
¡r
 !ğ
NULL
; ++p)

124 ià(
	`¡rcmp
(
p
->
¡r
, 
¬g_¡r
) == 0)

127  
p
->
æags
;

128 
	}
}

	@fmtx.h

29 
	#FMTX_BUFFERS_COUNT
 8

	)

30 
	#FMTX_BUFFER_SIZE
 128

	)

32 #ifdeà
_WIN32


33 
	~<tch¬.h
>

34 
	#I64FMT
 
	`_T
("I64")

	)

35 
	#I64K
(
x
èx##
I64


	)

37 
	tTCHAR
;

38 
	#_T
(
x
è
	)
x

39 
	#I64FMT
 "Î"

	)

40 
	#I64K
(
x
èx##
LL


	)

41 
	#_¡´štf
 
¥rštf


	)

42 
	#_¢rštf
 
¢´štf


	)

43 
	#_tcscmp
 
¡rcmp


	)

47 
	#FMTX_TS_N_90kHz
 0

48 
	#FMTX_TS_N_27MHz
 1

49 

	)

51 
	#FMTX_TS_DISPLAY_MASK
 0xff0

	)

52 
	#FMTX_TS_DISPLAY_90kHz_RAW
 0

	)

53 
	#FMTX_TS_DISPLAY_90kHz_32BIT
 0x10

	)

54 
	#FMTX_TS_DISPLAY_27MHz_RAW
 0x20

	)

55 
	#FMTX_TS_DISPLAY_ms
 0x30

	)

56 
	#FMTX_TS_DISPLAY_HMS
 0x40

	)

58 cÚ¡ 
TCHAR
 * 
fmtx_time¡amp
(
št64_t
 
n
, 
æags
);

59 
fmtx_¡r_to_time¡amp_æags
(cÚ¡ 
TCHAR
 * 
¬g_¡r
);

	@h222.c

30 
	~"h222_âs.h
"

32 cÚ¡ *
	$h222_¡»am_ty³_¡r
(
s
)

34 ià((0x1C < 
s
) && (s < 0x7E))

36 ià((0x80 <ğ
s
) && (s <= 0xFF))

39 
s
)

76 
	}
}

	@h222_defns.h

30 #iâdeà
_h222_deâs


31 
	#_h222_deâs


	)

37 
	~"h222_âs.h
"

84 
	#MPEG1_VIDEO_STREAM_TYPE
 0x01

	)

85 
	#MPEG2_VIDEO_STREAM_TYPE
 0x02

86 
	#AVC_VIDEO_STREAM_TYPE
 0x1B

87 
	#AVS_VIDEO_STREAM_TYPE
 0x42

88 
	#DVB_DOLBY_AUDIO_STREAM_TYPE
 0x06

89 
	#ATSC_DOLBY_AUDIO_STREAM_TYPE
 0x81

90 
	#MPEG2_AUDIO_STREAM_TYPE
 0x04

	)

91 
	#MPEG1_AUDIO_STREAM_TYPE
 0x03

	)

92 
	#ADTS_AUDIO_STREAM_TYPE
 0x0F

93 
	#MPEG4_PART2_VIDEO_STREAM_TYPE
 0x10

	)

94 
	#LATM_AUDIO_STREAM_TYPE
 0x11

95 

	)

96 
	#DOLBY_DVB_STREAM_TYPE
 0x06

97 
	#DOLBY_ATSC_STREAM_TYPE
 0x81

98 

	)

106 
	#IS_VIDEO_STREAM_TYPE
(
s
è((s)==
MPEG1_VIDEO_STREAM_TYPE
 || \

107 (
s
)==
MPEG2_VIDEO_STREAM_TYPE
 || \

108 (
s
)==
AVC_VIDEO_STREAM_TYPE
 || \

109 (
s
)==
AVS_VIDEO_STREAM_TYPE
 || \

110 (
s
)==
MPEG4_PART2_VIDEO_STREAM_TYPE
)

	)

121 
	#IS_DOLBY_STREAM_TYPE
(
s
è((s)==
DOLBY_DVB_STREAM_TYPE
 || \

122 (
s
)==
DOLBY_ATSC_STREAM_TYPE
)

	)

124 
	#IS_AUDIO_STREAM_TYPE
(
s
è((s)==
MPEG1_AUDIO_STREAM_TYPE
 || \

125 (
s
)==
MPEG2_AUDIO_STREAM_TYPE
 || \

126 (
s
)==
ADTS_AUDIO_STREAM_TYPE
 || \

127 (
s
)==
LATM_AUDIO_STREAM_TYPE
 || \

128 
	`IS_DOLBY_STREAM_TYPE
((
s
)))

	)

187 
	#PADDING_STREAM_ID
 0xBE

	)

188 
	#PRIVATE1_AUDIO_STREAM_ID
 0xBD

	)

189 
	#PRIVATE2_AUDIO_STREAM_ID
 0xBF

	)

190 
	#DEFAULT_VIDEO_STREAM_ID
 0xE0

191 
	#DEFAULT_AUDIO_STREAM_ID
 0xC0

192 

	)

193 
	#IS_AUDIO_STREAM_ID
(
id
è((id)==0xBD || ((idè>ğ0xC0 && (idè<ğ0xDF))

	)

194 
	#IS_VIDEO_STREAM_ID
(
id
è((idè>ğ0xE0 && (idè<ğ0xEF)

	)

199 
	stimšg


201 
ušt64_t
 
	mfœ¡_pü
;

202 
ušt64_t
 
	mÏ¡_pü
;

203 
	mfœ¡_pü_·ck‘
;

204 
	mÏ¡_pü_·ck‘
;

205 
	mhad_fœ¡_pü
;

207 
timšg
 *
	ttimšg_p
;

	@h222_fns.h

29 #iâdeà
_h222_âs


30 
	#_h222_âs


	)

36 cÚ¡ *
h222_¡»am_ty³_¡r
(
s
);

	@h262.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

34 
	~"com·t.h
"

35 
	~"´štšg_âs.h
"

36 
	~"h262_âs.h
"

37 
	~"es_âs.h
"

38 
	~"ts_âs.h
"

39 
	~"»v”£_âs.h
"

40 
	~"misc_âs.h
"

42 
	#DEBUG_GET_NEXT_PICTURE
 0

	)

43 
	#DEBUG_AFD
 0

	)

59 
	$´št_h262_¡¬t_code_¡r
(
by‹
 
¡¬t_code
)

61 
by‹
 
numb”
;

62 *
¡r
 = 
NULL
;

63 
¡¬t_code
)

66 0x00: 
¡r
 = "Picture"; ;

67 0xB0: 
¡r
 = "Reserved"; ;

68 0xB1: 
¡r
 = "Reserved"; ;

69 0xB2: 
¡r
 = "User data"; ;

70 0xB3: 
¡r
 = "SEQUENCE HEADER"; ;

71 0xB4: 
¡r
 = "Sequenceƒrror"; ;

72 0xB5: 
¡r
 = "Extension start"; ;

73 0xB6: 
¡r
 = "Reserved"; ;

74 0xB7: 
¡r
 = "SEQUENCE END"; ;

75 0xB8: 
¡r
 = "Group start"; ;

80 0xBC: 
¡r
 = "SYSTEM START: Program stream map"; ;

81 0xBD: 
¡r
 = "SYSTEM START: Private stream 1"; ;

82 0xBE: 
¡r
 = "SYSTEM START: Padding stream"; ;

83 0xBF: 
¡r
 = "SYSTEM START: Private stream 2"; ;

84 0xF0: 
¡r
 = "SYSTEM START: ECM stream"; ;

85 0xF1: 
¡r
 = "SYSTEM START: EMM stream"; ;

86 0xF2: 
¡r
 = "SYSTEM START: DSMCC stream"; ;

87 0xF3: 
¡r
 = "SYSTEM START: 13522 stream"; ;

88 0xF4: 
¡r
 = "SYSTEM START: H.222 A stream"; ;

89 0xF5: 
¡r
 = "SYSTEM START: H.222 B stream"; ;

90 0xF6: 
¡r
 = "SYSTEM START: H.222 C stream"; ;

91 0xF7: 
¡r
 = "SYSTEM START: H.222 D stream"; ;

92 0xF8: 
¡r
 = "SYSTEM START: H.222 E stream"; ;

93 0xF9: 
¡r
 = "SYSTEM START: Ancillary stream"; ;

94 0xFF: 
¡r
 = "SYSTEM START: Program stream directory"; ;

96 : 
¡r
 = 
NULL
; ;

99 ià(
¡r
 !ğ
NULL
)

100 
	`´št_msg
(
¡r
);

101 ià(
¡¬t_code
 == 0x47)

102 
	`´št_msg
("TRANSPORT STREAM sync byte");

103 ià(
¡¬t_code
 >= 0x01 && start_code <= 0xAF)

104 
	`åršt_msg
("Sliû, v”tiÿÈpo¢ %d",
¡¬t_code
);

105 ià(
¡¬t_code
 >= 0xC0 && start_code <=0xDF)

107 
numb”
 = 
¡¬t_code
 & 0x1F;

108 
	`åršt_msg
("SYSTEM START: AudiØ¡»am %02x",
numb”
);

110 ià(
¡¬t_code
 >= 0xE0 && start_code <= 0xEF)

112 
numb”
 = 
¡¬t_code
 & 0x0F;

113 
	`åršt_msg
("SYSTEM START: VideØ¡»am %x",
numb”
);

115 ià(
¡¬t_code
 >= 0xFC && start_code <= 0xFE)

116 
	`´št_msg
("SYSTEM START: Reserved data stream");

118 
	`´št_msg
("SYSTEM START: Unrecognised stream id");

119 
	}
}

126 
	$bud_h262_™em
(
h262_™em_p
 *
™em
)

128 
”r
;

129 
h262_™em_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_H262_ITEM
);

130 ià(
Ãw
 =ğ
NULL
)

132 
	`´št_”r
("### Unableo‡llocate MPEG2 item datastructure\n");

135 
”r
 = 
	`£tup_ES_un™
(&(
Ãw
->
un™
));

136 ià(
”r
)

138 
	`´št_”r
("### Unableo‡llocate MPEG2 item data buffer\n");

139 
	`ä“
(
Ãw
);

142 *
™em
 = 
Ãw
;

144 
	}
}

153 
	$ä“_h262_™em
(
h262_™em_p
 *
™em
)

155 ià(*
™em
 =ğ
NULL
)

157 
	`ş—r_ES_un™
(&(*
™em
)->
un™
);

158 
	`ä“
(*
™em
);

159 *
™em
 = 
NULL
;

160 
	}
}

165 
	$»pÜt_h262_™em
(
h262_™em_p
 
™em
)

167 
	`åršt_msg
(
OFFSET_T_FORMAT_08
 "/%04d: MPEG2 item %02x (",

168 
™em
->
un™
.
¡¬t_po¢
.
šfe
,

169 
™em
->
un™
.
¡¬t_po¢
.
š·ck‘
,™em->un™.
¡¬t_code
);

170 
	`´št_h262_¡¬t_code_¡r
(
™em
->
un™
.
¡¬t_code
);

171 
	`´št_msg
(")");

172 ià(
™em
->
un™
.
¡¬t_code
 == 0)

173 
	`åršt_msg
(" %d (%s)",
™em
->
piùu»_codšg_ty³
,

174 
	`H262_PICTURE_CODING_STR
(
™em
->
piùu»_codšg_ty³
));

175 
	`åršt_msg
(" siz%d",
™em
->
un™
.
d©a_Ën
);

176 
	`´št_msg
("\n");

177 
	}
}

196 
	$fšd_Ãxt_h262_™em
(
ES_p
 
es
,

197 
h262_™em_p
 *
™em
)

199 
”r
;

201 
”r
 = 
	`bud_h262_™em
(
™em
);

202 ià(
”r
)  1;

204 
”r
 = 
	`fšd_Ãxt_ES_un™
(
es
,&(*
™em
)->
un™
);

205 ià(
”r
)

207 
	`ä“_h262_™em
(
™em
);

208  
”r
;

212 ià((*
™em
)->
un™
.
¡¬t_code
 == 0)

214 (*
™em
)->
piùu»_codšg_ty³
 = ((*™em)->
un™
.
d©a
[5] & 0x38) >> 3;

217 
	}
}

228 
	$bud_h262_cÚ‹xt
(
ES_p
 
es
,

229 
h262_cÚ‹xt_p
 *
cÚ‹xt
)

231 
h262_cÚ‹xt_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_H262_CONTEXT
);

232 ià(
Ãw
 =ğ
NULL
)

234 
	`´št_”r
("### Unableo‡llocate H.262 context datastructure\n");

238 
Ãw
->
es
 =ƒs;

239 
Ãw
->
piùu»_šdex
 = 0;

240 
Ãw
->
Ï¡_™em
 = 
NULL
;

241 
Ãw
->
»v”£_d©a
 = 
NULL
;

242 
Ãw
->
couÁ_sšû_£q_hdr
 = 0;

243 
Ãw
->
Ï¡_a¥eù_¿tio_šfo
 = 
H262_UNSET_ASPECT_RATIO_INFO
;

244 
Ãw
->
Ï¡_afd
 = 
UNSET_AFD_BYTE
;

245 
Ãw
->
add_çke_afd
 = 
FALSE
;

247 *
cÚ‹xt
 = 
Ãw
;

249 
	}
}

260 
	$ä“_h262_cÚ‹xt
(
h262_cÚ‹xt_p
 *
cÚ‹xt
)

262 
h262_cÚ‹xt_p
 
cc
 = *
cÚ‹xt
;

264 ià(
cc
 =ğ
NULL
)

267 ià(
cc
->
Ï¡_™em
 !ğ
NULL
)

268 
	`ä“_h262_™em
(&
cc
->
Ï¡_™em
);

270 
cc
->
»v”£_d©a
 = 
NULL
;

272 
	`ä“
(*
cÚ‹xt
);

273 *
cÚ‹xt
 = 
NULL
;

275 
	}
}

288 
	$»wšd_h262_cÚ‹xt
(
h262_cÚ‹xt_p
 
cÚ‹xt
)

290 
ES_off£t
 
¡¬t_of_fe
 = {0,0};

293 ià(
cÚ‹xt
->
Ï¡_™em
)

294 
	`ä“_h262_™em
(&
cÚ‹xt
->
Ï¡_™em
);

296 
cÚ‹xt
->
piùu»_šdex
 = 0;

299 ià(
cÚ‹xt
->
»v”£_d©a
)

301 
cÚ‹xt
->
»v”£_d©a
->
Ï¡_po¢_added
 = -1;

302 
cÚ‹xt
->
couÁ_sšû_£q_hdr
 = 0;

306  
	`£ek_ES
(
cÚ‹xt
->
es
,
¡¬t_of_fe
);

307 
	}
}

320 
	$­³nd_to_h262_piùu»
(
h262_piùu»_p
 
piùu»
,

321 
h262_™em_p
 
™em
)

323 
ES_un™_p
 
un™
 = &(
™em
->unit);

325 ià(
	`is_h262_ex‹nsiÚ_¡¬t_™em
(
™em
))

327 
by‹
 *
d©a
 = 
un™
->data;

328 
ex‹nsiÚ_¡¬t_code_id
 = (
d©a
[4] & 0xF0) >> 4;

329 ià(
ex‹nsiÚ_¡¬t_code_id
 == 1)

331 
piùu»
->
´og»ssive_£qu’û
 = 
d©a
[5] & 0x08;

333 ià(
ex‹nsiÚ_¡¬t_code_id
 == 8)

335 
piùu»
->
piùu»_¡ruùu»
 = 
d©a
[6] & 0x03;

338  
	`­³nd_to_ES_un™_li¡
(
piùu»
->
li¡
,
un™
);

339 
	}
}

347 
	$bud_h262_piùu»
(
h262_cÚ‹xt_p
 
cÚ‹xt
,

348 
h262_piùu»_p
 *
piùu»
,

349 
h262_™em_p
 
™em
)

351 
”r
;

352 
ES_un™_p
 
un™
 = &(
™em
->unit);

353 
by‹
 *
d©a
 = 
un™
->data;

354 
h262_piùu»_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_H262_PICTURE
);

355 ià(
Ãw
 =ğ
NULL
)

357 
	`´št_”r
("### Unableo‡llocate H.262…icture datastructure\n");

361 
”r
 = 
	`bud_ES_un™_li¡
(&(
Ãw
->
li¡
));

362 ià(
”r
)

364 
	`´št_”r
("### Unableo‡llocate internal†ist for H.262…icture\n");

365 
	`ä“
(
Ãw
);

370 ià(
	`is_h262_piùu»_™em
(
™em
))

372 
Ãw
->
piùu»_codšg_ty³
 = 
™em
->picture_coding_type;

373 
Ãw
->
is_piùu»
 = 
TRUE
;

374 
Ãw
->
is_£qu’û_h—d”
 = 
FALSE
;

375 
Ãw
->
‹mpÜ®_»ã»nû
 = (
d©a
[4] << 2) | ((data[5] & 0xC0) >> 6);

378 
Ãw
->
piùu»_¡ruùu»
 = 3;

379 
Ãw
->
was_two_f›lds
 = 
FALSE
;

381 
Ãw
->
afd
 = 
cÚ‹xt
->
Ï¡_afd
;

382 
Ãw
->
a¥eù_¿tio_šfo
 = 
cÚ‹xt
->
Ï¡_a¥eù_¿tio_šfo
;

383 
Ãw
->
is_»®_afd
 = 
FALSE
;

385 ià(
	`is_h262_£q_h—d”_™em
(
™em
))

387 
Ãw
->
is_piùu»
 = 
FALSE
;

388 
Ãw
->
is_£qu’û_h—d”
 = 
TRUE
;

389 
Ãw
->
piùu»_codšg_ty³
 = 0;

390 
Ãw
->
a¥eù_¿tio_šfo
 = (
d©a
[7] & 0xF0) >> 4;

393 
Ãw
->
´og»ssive_£qu’û
 = 1;

395 ià(
	`is_h262_£q_’d_™em
(
™em
))

397 
Ãw
->
is_piùu»
 = 
FALSE
;

398 
Ãw
->
is_£qu’û_h—d”
 = 
FALSE
;

399 
Ãw
->
piùu»_codšg_ty³
 = 0;

403 
	`åršt_”r
("!!! Building H.262…icturehat starts with‡ %s (%02x)\n",

404 
	`H262_START_CODE_STR
(
™em
->
un™
.
¡¬t_code
),item->unit.start_code);

405 
Ãw
->
is_piùu»
 = 
FALSE
;

406 
Ãw
->
is_£qu’û_h—d”
 = 
FALSE
;

407 
Ãw
->
piùu»_codšg_ty³
 = 0;

410 
”r
 = 
	`­³nd_to_h262_piùu»
(
Ãw
,
™em
);

411 ià(
”r
)

413 
	`åršt_”r
("### Error‡ppending first itemo H.262 %s\n",

414 
	`H262_START_CODE_STR
(
™em
->
un™
.
¡¬t_code
));

415 
	`ä“_h262_piùu»
(&
Ãw
);

419 *
piùu»
 = 
Ãw
;

421 
	}
}

429 
	$­³nd_çke_afd
(
h262_piùu»_p
 
piùu»
,

430 
by‹
 
afd
)

432 
”r
;

433 
h262_™em_p
 
™em
 = 
NULL
;

435 ià(
™em
 =ğ
NULL
)

437 
”r
 = 
	`bud_h262_™em
(&
™em
);

438 ià(
”r
)

440 
	`´št_”r
("### Error building 'fake' AFD for H.262…icture\n");

443 
™em
->
un™
.
d©a
[0] = 0x00;

444 
™em
->
un™
.
d©a
[1] = 0x00;

445 
™em
->
un™
.
d©a
[2] = 0x01;

446 
™em
->
un™
.
d©a
[3] = 0xb2;

447 
™em
->
un™
.
d©a
[4] = 0x44;

448 
™em
->
un™
.
d©a
[5] = 0x54;

449 
™em
->
un™
.
d©a
[6] = 0x47;

450 
™em
->
un™
.
d©a
[7] = 0x31;

451 
™em
->
un™
.
d©a
[8] = 0x41;

452 
™em
->
un™
.
d©a
[9] = 
afd
;

453 
™em
->
un™
.
d©a_Ën
 = 10;

454 
™em
->
un™
.
¡¬t_code
 = 0xb2;

457 
™em
->
un™
.
d©a
[9] = 
afd
;

460 
”r
 = 
	`­³nd_to_h262_piùu»
(
piùu»
,
™em
);

461 ià(
”r
)

463 
	`´št_”r
("### Error‡ppending 'fake' AFDo H.262…icture\n");

467 
piùu»
->
afd
 =‡fd;

468 
piùu»
->
is_»®_afd
 = 
FALSE
;

470 
	}
}

481 
	$m”ge_f›lds
(
h262_piùu»_p
 
piùu»1
,

482 
h262_piùu»_p
 
piùu»2
)

484 
ii
;

485 
ii
 = 0; i˜< 
piùu»2
->
li¡
->
Ëngth
; ii++)

487 
”r
 = 
	`­³nd_to_ES_un™_li¡
(
piùu»1
->
li¡
,

488 &
piùu»2
->
li¡
->
¬¿y
[
ii
]);

489 ià(
”r
)

491 
	`´št_”r
("### Error mergingwo H.262 field…ictures\n");

495 
piùu»1
->
was_two_f›lds
 = 
TRUE
;

497 
	}
}

506 
	$ä“_h262_piùu»
(
h262_piùu»_p
 *
piùu»
)

508 
h262_piùu»_p
 
pic
 = *
piùu»
;

510 ià(
pic
 =ğ
NULL
)

513 ià(
pic
->
li¡
 !ğ
NULL
)

514 
	`ä“_ES_un™_li¡
(&
pic
->
li¡
);

516 
	`ä“
(*
piùu»
);

517 *
piùu»
 = 
NULL
;

519 
	}
}

529 
	$§me_h262_piùu»
(
h262_piùu»_p
 
piùu»1
,

530 
h262_piùu»_p
 
piùu»2
)

532 ià(
piùu»1
 =ğ
piùu»2
)

533  
TRUE
;

534 ià(
piùu»1
 =ğ
NULL
 || 
piùu»2
 == NULL)

535  
FALSE
;

537  
	`§me_ES_un™_li¡
(
piùu»1
->
li¡
,
piùu»2
->list);

538 
	}
}

546 
	$maybe_»memb”_this_piùu»
(
h262_cÚ‹xt_p
 
h262
,

547 
v”bo£
,

548 
h262_piùu»_p
 
this_piùu»
)

550 
”r
;

551 
ES_off£t
 
¡¬t_po¢
 = {0,0};

552 
ušt32_t
 
num_by‹s
 = 0;

553 ià(
this_piùu»
->
is_piùu»
)

555 ià(
this_piùu»
->
piùu»_codšg_ty³
 == 1)

558 (
h262
->
couÁ_sšû_£q_hdr
) ++;

560 
”r
 = 
	`g‘_ES_un™_li¡_bounds
(
this_piùu»
->
li¡
,&
¡¬t_po¢
,&
num_by‹s
);

561 ià(
”r
)

563 
	`´št_”r
("### Error working out…osition/size of H.262…icture\n");

567 
”r
 = 
	`»memb”_»v”£_h262_d©a
(
h262
->
»v”£_d©a
,h262->
piùu»_šdex
,

568 
¡¬t_po¢
,
num_by‹s
,

569 
h262
->
couÁ_sšû_£q_hdr
,

570 
this_piùu»
->
afd
);

571 ià(
”r
)

573 
	`´št_”r
("### Error„emembering„eversing data for H.262 item\n");

576 ià(
v”bo£
)

577 
	`åršt_msg
("REMEMBER I…iùu» %5d‡ˆ" 
OFFSET_T_FORMAT_08


578 "/%04d fÜ %5d\n",
h262
->
piùu»_šdex
,

579 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

582 ià(
this_piùu»
->
is_£qu’û_h—d”
)

585 
h262
->
couÁ_sšû_£q_hdr
 = 0;

586 
”r
 = 
	`g‘_ES_un™_li¡_bounds
(
this_piùu»
->
li¡
,&
¡¬t_po¢
,&
num_by‹s
);

587 ià(
”r
)

589 
	`´št_”r
("### Error working out…osition/size of H.262"

593 
”r
 = 
	`»memb”_»v”£_h262_d©a
(
h262
->
»v”£_d©a
,0,

594 
¡¬t_po¢
,
num_by‹s
,0,0);

595 ià(
”r
)

597 
	`´št_”r
("### Error„emembering„eversing data for H.262 item\n");

600 ià(
v”bo£
)

601 
	`åršt_msg
("REMEMBER Sequ’û h—d”‡ˆ" 
OFFSET_T_FORMAT_08


603 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

606 
	}
}

619 
	$exŒaù_AFD
(
h262_™em_p
 
™em
,

620 
by‹
 *
afd
)

622 ià(
™em
->
un™
.
d©a
[8] == 0x41)

625 ià(
™em
->
un™
.
d©a_Ën
 < 10)

627 
	`åršt_”r
("!!! AFDoo short (only %d bytes - AFD missing)\n",

628 
™em
->
un™
.
d©a_Ën
);

629 *
afd
 = 
UNSET_AFD_BYTE
;

632 *
afd
 = 
™em
->
un™
.
d©a
[9];

633 ià((
™em
->
un™
.
d©a
[9] & 0xF0) != 0xF0)

635 
	`åršt_”r
("### Bad AFD %02x (reserved bits‚ot 1111)\n",

636 
™em
->
un™
.
d©a
[9]);

640 ià(
™em
->
un™
.
d©a
[8] == 0x01)

642 *
afd
 = 
UNSET_AFD_BYTE
;

646 
	`åršt_”r
("### AFD datastructure malformed: flag byte is %02x"

647 " in¡—d oà0x41 o¸0x01\n",
™em
->
un™
.
d©a
[8]);

648 ià(
™em
->
un™
.
d©a_Ën
 == 9)

649 *
afd
 = 
UNSET_AFD_BYTE
;

651 *
afd
 = 
™em
->
un™
.
d©a
[9];

655 
	}
}

657 #ià
DEBUG_GET_NEXT_PICTURE


661 
	$_show_™em
(
h262_™em_p
 
™em
)

663 
	`´št_msg
("__ ");

664 ià(
™em
 =ğ
NULL
)

666 
	`´št_msg
("<no item>\n");

669 ià(
	`is_h262_piùu»_™em
(
™em
))

670 
	`åršt_msg
("% piùu»",
	`H262_PICTURE_CODING_STR
(
™em
->
piùu»_codšg_ty³
));

671 ià(
	`is_h262_¦iû_™em
(
™em
))

672 
	`åršt_msg
("¦iû %2x",
™em
->
un™
.
¡¬t_code
);

674 
	`åršt_msg
("%s",
	`H262_START_CODE_STR
(
™em
->
un™
.
¡¬t_code
));

675 
	`åršt_msg
("‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

676 
™em
->
un™
.
¡¬t_po¢
.
šfe
,™em->un™.¡¬t_po¢.
š·ck‘
,

677 
™em
->
un™
.
d©a_Ën
);

678 
	}
}

699 
	$g‘_Ãxt_h262_sšgË_piùu»
(
h262_cÚ‹xt_p
 
cÚ‹xt
,

700 
v”bo£
,

701 
h262_piùu»_p
 *
piùu»
)

703 
”r
 = 0;

705 
š_£qu’û_h—d”
 = 
FALSE
;

706 
š_£qu’û_’d
 = 
FALSE
;

707 
š_piùu»
 = 
FALSE
;

708 
Ï¡_was_¦iû
 = 
FALSE
;

709 
had_afd
 = 
FALSE
;

711 
h262_™em_p
 
™em
 = 
cÚ‹xt
->
Ï¡_™em
;

713 #ià
DEBUG_GET_NEXT_PICTURE


714 
num_¦iûs
 = 0;

715 
had_¦iû
 = 
FALSE
;

716 
Ï¡_¦iû_¡¬t_code
 = 0;

717 ià(
v”bo£
 && 
cÚ‹xt
->
Ï¡_™em
è
	`´št_msg
("__„euse†ast item\n");

720 
cÚ‹xt
->
Ï¡_™em
 = 
NULL
;

725 ià(
™em
 =ğ
NULL
)

727 
”r
 = 
	`fšd_Ãxt_h262_™em
(
cÚ‹xt
->
es
,&
™em
);

728 ià(
”r
) ƒrr;

730 ià(
	`is_h262_piùu»_™em
(
™em
))

732 
š_piùu»
 = 
TRUE
;

735 ià(
	`is_h262_£q_h—d”_™em
(
™em
))

737 
š_£qu’û_h—d”
 = 
TRUE
;

740 ià(
	`is_h262_£q_’d_™em
(
™em
))

742 
š_£qu’û_’d
 = 
TRUE
;

745 #ià
DEBUG_GET_NEXT_PICTURE


746 ià(
v”bo£
)

747 
	`_show_™em
(
™em
);

749 
	`ä“_h262_™em
(&
™em
);

752 #ià
DEBUG_GET_NEXT_PICTURE


753 ià(
v”bo£
)

755 
	`´št_msg
("__ --------------------------------- <start…icture>\n");

756 
	`_show_™em
(
™em
);

760 
”r
 = 
	`bud_h262_piùu»
(
cÚ‹xt
,
piùu»
,
™em
);

761 ià(
”r
)  1;

763 
	`ä“_h262_™em
(&
™em
);

765 ià(
š_£qu’û_’d
)

768 #ià
DEBUG_GET_NEXT_PICTURE


769 ià(
v”bo£
)

770 
	`´št_msg
("__ --------------------------------- <end…icture>\n");

778 
”r
 = 
	`fšd_Ãxt_h262_™em
(
cÚ‹xt
->
es
,&
™em
);

779 ià(
”r
)

781 ià(
”r
 !ğ
EOF
)

782 
	`ä“_h262_piùu»
(
piùu»
);

783  
”r
;

786 ià(
š_piùu»
)

790 ià(
Ï¡_was_¦iû
 && !
	`is_h262_¦iû_™em
(
™em
))

792 
Ï¡_was_¦iû
 = 
	`is_h262_¦iû_™em
(
™em
);

794 ià(
š_£qu’û_h—d”
)

801 ià(!
	`is_h262_ex‹nsiÚ_¡¬t_™em
(
™em
) &&

802 !
	`is_h262_u£r_d©a_™em
(
™em
))

806 ià(
š_piùu»
)

808 ià(
	`is_h262_AFD_u£r_d©a_™em
(
™em
))

811 
”r
 = 
	`exŒaù_AFD
(
™em
,&(*
piùu»
)->
afd
);

812 ià(
”r
)

813 
	`åršt_”r
("!!! Assumšg AFD %x‡ˆ" 
OFFSET_T_FORMAT
 "/%d\n",

814 (*
piùu»
)->
afd
,

815 
™em
->
un™
.
¡¬t_po¢
.
šfe
,™em->un™.¡¬t_po¢.
š·ck‘
);

816 (*
piùu»
)->
is_»®_afd
 = 
TRUE
;

817 #ià
DEBUG_AFD


818 ià((*
piùu»
)->
afd
 !ğ
cÚ‹xt
->
Ï¡_afd
)

820 
	`´št_msg
("* ");

821 
	`»pÜt_h262_piùu»
(
¡dout
,*
piùu»
,
FALSE
);

824 
cÚ‹xt
->
Ï¡_afd
 = (*
piùu»
)->
afd
;

825 
had_afd
 = 
TRUE
;

827 ià(
cÚ‹xt
->
add_çke_afd
 && !
had_afd
 && 
	`is_h262_¦iû_™em
(
™em
))

832 
”r
 = 
	`­³nd_çke_afd
(*
piùu»
,
cÚ‹xt
->
Ï¡_afd
);

833 ià(
”r
)

835 
	`ä“_h262_piùu»
(
piùu»
);

838 
had_afd
 = 
TRUE
;

839 #ià
DEBUG_GET_NEXT_PICTURE


840 ià(
v”bo£
)

842 
	`´št_msg
("__ fake AFD ");

843 
	`´št_b™s
(4,(*
piùu»
)->
afd
);

844 
	`åršt_msg
(", i.e., %s",
	`SHORT_AFD_STR
((*
piùu»
)->
afd
));

845 
	`´št_msg
("\n");

851 #ià
DEBUG_GET_NEXT_PICTURE


852 ià(
v”bo£
)

854 ià(!
had_¦iû
)

855 
	`_show_™em
(
™em
);

856 ià(
	`is_h262_¦iû_™em
(
™em
))

858 
num_¦iûs
 ++;

859 
Ï¡_¦iû_¡¬t_code
 = 
™em
->
un™
.
¡¬t_code
;

860 ià(!
had_¦iû
)

861 
had_¦iû
 = 
TRUE
;

867 
”r
 = 
	`­³nd_to_h262_piùu»
(*
piùu»
,
™em
);

868 ià(
”r
)

870 
	`´št_”r
("### Error‡dding itemo H.262 sequence header\n");

871 
	`ä“_h262_piùu»
(
piùu»
);

874 
	`ä“_h262_™em
(&
™em
);

877 ià(
š_piùu»
)

878 
cÚ‹xt
->
piùu»_šdex
 ++;

880 
cÚ‹xt
->
Ï¡_a¥eù_¿tio_šfo
 = (*
piùu»
)->
a¥eù_¿tio_šfo
;

882 
cÚ‹xt
->
Ï¡_™em
 = 
™em
;

883 #ià
DEBUG_GET_NEXT_PICTURE


884 ià(
v”bo£
)

886 ià(
š_piùu»
)

888 ià(
num_¦iûs
 > 1)

890 
ES_un™_p
 
un™
 = &(*
piùu»
)->
li¡
->
¬¿y
[(*piùu»)->li¡->
Ëngth
-1];

891 
	`´št_msg
("__ ...\n");

892 
	`åršt_msg
("__ sliû %2x",
Ï¡_¦iû_¡¬t_code
);

893 
	`åršt_msg
("‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

894 
un™
->
¡¬t_po¢
.
šfe
,un™->¡¬t_po¢.
š·ck‘
,

895 
un™
->
d©a_Ën
);

897 
	`åršt_msg
("__ (%2d sliûs)\n",
num_¦iûs
);

899 
	`´št_msg
("__ --------------------------------- <end…icture>\n");

900 ià(
š_piùu»
 || 
š_£qu’û_h—d”
)

901 
	`_show_™em
(
™em
);

905 
	}
}

925 
	$g‘_Ãxt_f›ld_of_·œ
(
h262_cÚ‹xt_p
 
cÚ‹xt
,

926 
v”bo£
,

927 
qu›t
,

928 
fœ¡_time
,

929 
h262_piùu»_p
 *
piùu»
)

931 
”r
;

932 
h262_piùu»_p
 
£cÚd
;

934 ià(
v”bo£
)

935 
	`åršt_msg
("@@ Looking for second field (%sime)\n",

936 (
fœ¡_time
?"first":"second"));

939 
”r
 = 
	`g‘_Ãxt_h262_sšgË_piùu»
(
cÚ‹xt
,
v”bo£
,&
£cÚd
);

940 ià(
”r
)

942 ià(
”r
 !ğ
EOF
)

943 
	`´št_”r
("### Tryingo„ead second field\n");

944  
”r
;

947 ià(!
	`is_h262_f›ld_piùu»
(
£cÚd
))

950 ià(!
qu›t
)

951 
	`åršt_”r
("!!! Field followed by‡ %s - ignoringhe field\n",

952 (
£cÚd
->
is_piùu»
?"frame":"sequence header"));

953 
	`ä“_h262_piùu»
(
piùu»
);

954 *
piùu»
 = 
£cÚd
;

957 ià((*
piùu»
)->
‹mpÜ®_»ã»nû
 =ğ
£cÚd
->temporal_reference)

960 ià(
v”bo£
è
	`´št_msg
("@@ Mergingwo fields\n");

961 
”r
 = 
	`m”ge_f›lds
(*
piùu»
,
£cÚd
);

962 ià(
”r
)

964 
	`ä“_h262_piùu»
(&
£cÚd
);

967 
	`ä“_h262_piùu»
(&
£cÚd
);

969 ià(
fœ¡_time
)

971 ià(!
qu›t
)

972 
	`åršt_”r
("!!! Field withemporal„ef %d (%x) followed by"

974 (*
piùu»
)->
‹mpÜ®_»ã»nû
,(*picture)->temporal_reference,

975 
£cÚd
->
‹mpÜ®_»ã»nû
,second->temporal_reference);

978 
	`ä“_h262_piùu»
(
piùu»
);

979 *
piùu»
 = 
£cÚd
;

980 
”r
 = 
	`g‘_Ãxt_f›ld_of_·œ
(
cÚ‹xt
,
v”bo£
,
qu›t
,
FALSE
,
piùu»
);

981 ià(
”r
)  1;

985 
	`´št_”r
("### Adjacent fields do‚ot shareemporal„eferences"

990 
	}
}

1034 
	$g‘_Ãxt_h262_äame
(
h262_cÚ‹xt_p
 
cÚ‹xt
,

1035 
v”bo£
,

1036 
qu›t
,

1037 
h262_piùu»_p
 *
piùu»
)

1039 
”r
;

1041 
”r
 = 
	`g‘_Ãxt_h262_sšgË_piùu»
(
cÚ‹xt
,
v”bo£
,
piùu»
);

1042 ià(
”r
) ƒrr;

1044 ià(
	`is_h262_f›ld_piùu»
(*
piùu»
))

1048 
”r
 = 
	`g‘_Ãxt_f›ld_of_·œ
(
cÚ‹xt
,
v”bo£
,
qu›t
,
TRUE
,
piùu»
);

1049 ià(
”r
)

1051 
	`ä“_h262_piùu»
(
piùu»
);

1056 ià(
cÚ‹xt
->
»v”£_d©a
)

1058 
”r
 = 
	`maybe_»memb”_this_piùu»
(
cÚ‹xt
,
v”bo£
,*
piùu»
);

1059 ià(
”r
)

1061 
	`ä“_h262_piùu»
(
piùu»
);

1067 
	}
}

1078 
	$wr™e_h262_piùu»_as_TS
(
TS_wr™”_p
 
tswr™”
,

1079 
h262_piùu»_p
 
piùu»
,

1080 
ušt32_t
 
pid
)

1082 
ii
;

1083 
ES_un™_li¡_p
 
li¡
;

1085 ià(
piùu»
 =ğ
NULL
 ||…iùu»->
li¡
 == NULL)

1088 
li¡
 = 
piùu»
->list;

1090 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

1092 
”r
;

1093 
ES_un™_p
 
un™
 = &(
li¡
->
¬¿y
[
ii
]);

1095 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,
un™
->
d©a
,un™->
d©a_Ën
,
pid
,

1096 
DEFAULT_VIDEO_STREAM_ID
);

1097 ià(
”r
)

1099 
	`´št_”r
("### Error writing out…icture†isto TS\n");

1100  
”r
;

1104 
	}
}

1114 
	$wr™e_h262_piùu»_as_ES
(
FILE
 *
ouut
,

1115 
h262_piùu»_p
 
piùu»
)

1117 
ii
;

1118 
ES_un™_li¡_p
 
li¡
;

1120 ià(
piùu»
 =ğ
NULL
 ||…iùu»->
li¡
 == NULL)

1123 
li¡
 = 
piùu»
->list;

1125 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

1127 
”r
;

1128 
ES_un™_p
 
un™
 = &(
li¡
->
¬¿y
[
ii
]);

1129 
”r
 = 
	`wr™e_ES_un™
(
ouut
,
un™
);

1130 ià(
”r
)

1132 
	`´št_”r
("### Error writing out…icture†isto ES\n");

1133  
”r
;

1137 
	}
}

1146 
	$»pÜt_h262_piùu»
(
h262_piùu»_p
 
piùu»
,

1147 
»pÜt_d©a
)

1149 ià(
piùu»
->
is_piùu»
)

1151 
	`åršt_msg
("%s %s #%02d",

1152 
	`H262_PICTURE_CODING_STR
(
piùu»
->
piùu»_codšg_ty³
),

1153 
	`H262_PICTURE_STRUCTURE_STR
(
piùu»
->
piùu»_¡ruùu»
),

1154 
piùu»
->
‹mpÜ®_»ã»nû
);

1156 ià(
piùu»
->
was_two_f›lds
)

1157 
	`´št_msg
(" (merged)");

1159 
	`åršt_msg
(" %s",
	`H262_ASPECT_RATIO_INFO_STR
(
piùu»
->
a¥eù_¿tio_šfo
));

1161 ià(
piùu»
->
is_»®_afd
)

1162 
	`´št_msg
(" AFD ");

1164 
	`´št_msg
("‡fd ");

1165 
	`´št_b™s
(4,
piùu»
->
afd
);

1166 
	`åršt_msg
(", i.e., %s",
	`SHORT_AFD_STR
(
piùu»
->
afd
));

1167 
	`´št_msg
("\n");

1169 ià(
piùu»
->
is_£qu’û_h—d”
)

1171 
	`´št_msg
("Sequence header: ");

1173 
piùu»
->
´og»ssive_£qu’û
)

1175 0: 
	`´št_msg
("frames‡nd fields"); ;

1176 1: 
	`´št_msg
("progressive frames only"); ;

1178 
	`åršt_msg
("progressive_sequence=%d",

1179 
piùu»
->
´og»ssive_£qu’û
);

1182 
	`åršt_msg
(",‡spect„atio %s",

1183 
	`H262_ASPECT_RATIO_INFO_STR
(
piùu»
->
a¥eù_¿tio_šfo
));

1184 
	`´št_msg
("\n");

1188 
	`´št_msg
("Sequenceƒnd\n");

1190 ià(
»pÜt_d©a
)

1191 
	`»pÜt_ES_un™_li¡
("ES un™s",
piùu»
->
li¡
);

1192 
	}
}

	@h262_defns.h

29 #iâdeà
_h262_deâs


30 
	#_h262_deâs


	)

32 
	~<¡dio.h
>

33 
	~"com·t.h
"

34 
	~"es_deâs.h
"

35 
	~"ts_deâs.h
"

40 
h262_cÚ‹xt
 *
	th262_cÚ‹xt_p
;

41 
	g»v”£_d©a
;

45 
	s_h262_™em


47 
ES_un™
 
	mun™
;

50 
by‹
 
	mpiùu»_codšg_ty³
;

52 
_h262_™em
 *
	th262_™em_p
;

53 
	#SIZEOF_H262_ITEM
 (
_h262_™em
)

	)

58 
	s_h262_piùu»


61 
ES_un™_li¡_p
 
	mli¡
;

66 
	mis_piùu»
;

67 
	mis_£qu’û_h—d”
;

72 
by‹
 
	mpiùu»_codšg_ty³
;

73 
by‹
 
	mpiùu»_¡ruùu»
;

74 
ušt16_t
 
	m‹mpÜ®_»ã»nû
;

75 
by‹
 
	mafd
;

77 
by‹
 
	mis_»®_afd
;

78 
	mwas_two_f›lds
;

85 
by‹
 
	m´og»ssive_£qu’û
;

89 
by‹
 
	ma¥eù_¿tio_šfo
;

91 
_h262_piùu»
 *
	th262_piùu»_p
;

92 
	#SIZEOF_H262_PICTURE
 (
_h262_piùu»
)

	)

96 
	#H262_START_CODE_STR
(
b
) \

97 ((
b
)==0x00?"picture": \

98 (
b
)>=0x01 && b<=0xAF?"slice": \

99 (
b
)==0xB0?"reserved": \

100 (
b
)==0xB1?"reserved": \

101 (
b
)==0xB2?"user data": \

102 (
b
)==0xB3?"sequence header": \

103 (
b
)==0xB4?"sequenceƒrror": \

104 (
b
)==0xB5?"extension start": \

105 (
b
)==0xB6?"reserved": \

106 (
b
)==0xB7?"sequenceƒnd": \

107 (
b
)==0xB8?"group start": \

108 (
b
)>=0xB9?"sy¡em s¹":"???")

	)

110 
	#is_h262_piùu»_™em
(
™em
è((™em)->
un™
.
¡¬t_code
==0x00)

	)

111 
	#is_h262_¦iû_™em
(
™em
è((™em)->
un™
.
¡¬t_code
>=0x01 && \

112 (
™em
)->
un™
.
¡¬t_code
<=0xAF)

	)

113 
	#is_h262_u£r_d©a_™em
(
™em
è((™em)->
un™
.
¡¬t_code
==0xB2)

	)

114 
	#is_h262_£q_h—d”_™em
(
™em
è((™em)->
un™
.
¡¬t_code
==0xB3)

	)

115 
	#is_h262_£q_’d_™em
(
™em
è((™em)->
un™
.
¡¬t_code
==0xB7)

	)

116 
	#is_h262_group_¡¬t_™em
(
™em
è((™em)->
un™
.
¡¬t_code
==0xB8)

	)

117 
	#is_h262_ex‹nsiÚ_¡¬t_™em
(
™em
è((™em)->
un™
.
¡¬t_code
==0xB5)

	)

119 
	#H262_PICTURE_CODING_STR
(
s
) \

120 ((
s
)==0?"Forbidden": \

121 (
s
)==1?"I": \

122 (
s
)==2?"P": \

123 (
s
)==3?"B": \

124 (
s
)==4?"D":"Re£rved")

	)

127 
	#is_I_piùu»
(
piùu»
è(Õiùu»)->
piùu»_codšg_ty³
==1)

	)

128 
	#is_P_piùu»
(
piùu»
è(Õiùu»)->
piùu»_codšg_ty³
==2)

	)

130 
	#H262_PICTURE_STRUCTURE_STR
(
s
) \

131 ((
s
)==0?"Reserved": \

132 (
s
)==1?"Top Field": \

133 (
s
)==2?"Bottom Field": \

134 (
s
)==3?"F¿me":"???")

	)

136 
	#is_h262_f›ld_piùu»
(
piùu»
è(Õiùu»)->
is_piùu»
 && \

137 ((
piùu»
)->
piùu»_¡ruùu»
 == 1 ||\

138 (
piùu»
)->
piùu»_¡ruùu»
 =ğ2))

	)

140 
	#is_h262_AFD_u£r_d©a_™em
(
™em
) \

141 ((
™em
)->
un™
.
¡¬t_code
 == 0xB2 && \

142 (
™em
)->
un™
.
d©a_Ën
 > 8 && \

143 (
™em
)->
un™
.
d©a
[4] == 0x44 && \

144 (
™em
)->
un™
.
d©a
[5] == 0x54 && \

145 (
™em
)->
un™
.
d©a
[6] == 0x47 && \

146 (
™em
)->
un™
.
d©a
[7] =ğ0x31)

	)

148 
	#UNSET_AFD_BYTE
 0xF8

149 

	)

152 
	#AFD_STR
(
afd
) \

153 ((
afd
)==0xF2?"ATSC: box 16:9 (top)": \

154 (
afd
)==0xF3?"ATSC: box 14:9 (top)": \

155 (
afd
)==0xF4?"ATSC: box > 16:9 (center)": \

156 (
afd
)==0xF8?"Active format‡s coded frame": \

157 (
afd
)==0xF9?"4:3 (centre)": \

158 (
afd
)==0xFA?"16:9 (centre)": \

159 (
afd
)==0xFB?"14:9 (centre)": \

160 (
afd
)==0xFC?"reserved": \

161 (
afd
)==0xFD?"4:3 (with shoot &…rotect 14:9 centre)": \

162 (
afd
)==0xFE?"16:9 (with shoot &…rotect 14:9 centre)": \

163 (
afd
)==0xFF?"16:9 (w™h shoÙ &…rÙeù 4:3 c’Œe)":"»£rved")

	)

165 
	#SHORT_AFD_STR
(
afd
) \

166 ((
afd
)==0xF2?"ATSC: box 16:9 (top)": \

167 (
afd
)==0xF3?"ATSC: box 14:9 (top)": \

168 (
afd
)==0xF4?"ATSC: box > 16:9 (center)": \

169 (
afd
)==0xF8?"As coded frame": \

170 (
afd
)==0xF9?"4:3 (centre)": \

171 (
afd
)==0xFA?"16:9 (centre)": \

172 (
afd
)==0xFB?"14:9 (centre)": \

173 (
afd
)==0xFC?"reserved": \

174 (
afd
)==0xFD?"4:3 (14:9)": \

175 (
afd
)==0xFE?"16:9 (14:9)": \

176 (
afd
)==0xFF?"16:9 (4:3)":"»£rved")

	)

181 
	#H262_UNSET_ASPECT_RATIO_INFO
 0xFF

	)

182 
	#H262_ASPECT_RATIO_INFO_STR
(
¿t
) ((rat)==0xFF?"Unset": \

183 (
¿t
)==0?"Forbidden‡spect„atio": \

184 (
¿t
)==1?"Square": \

185 (
¿t
)==2?"4:3": \

186 (
¿t
)==3?"16:9": \

187 "Re£rved‡¥eù„©io")

	)

192 
	sh262_cÚ‹xt


194 
ES_p
 
	mes
;

203 
ušt32_t
 
	mpiùu»_šdex
;

208 
h262_™em_p
 
	mÏ¡_™em
;

211 
by‹
 
	mÏ¡_a¥eù_¿tio_šfo
;

225 
by‹
 
	mÏ¡_afd
;

237 
	madd_çke_afd
;

241 
»v”£_d©a
 * 
	m»v”£_d©a
;

244 
by‹
 
	mcouÁ_sšû_£q_hdr
;

246 
	#SIZEOF_H262_CONTEXT
 (
h262_cÚ‹xt
)

	)

	@h262_fns.h

29 #iâdeà
_h262_âs


30 
	#_h262_âs


	)

32 
	~"h262_deâs.h
"

47 
´št_h262_¡¬t_code_¡r
(
by‹
 
¡¬t_code
);

53 
bud_h262_™em
(
h262_™em_p
 *
™em
);

61 
ä“_h262_™em
(
h262_™em_p
 *
™em
);

65 
»pÜt_h262_™em
(
h262_™em_p
 
™em
);

83 
fšd_Ãxt_h262_™em
(
ES_p
 
es
,

84 
h262_™em_p
 *
™em
);

94 
bud_h262_cÚ‹xt
(
ES_p
 
es
,

95 
h262_cÚ‹xt_p
 *
cÚ‹xt
);

105 
ä“_h262_cÚ‹xt
(
h262_cÚ‹xt_p
 *
cÚ‹xt
);

117 
»wšd_h262_cÚ‹xt
(
h262_cÚ‹xt_p
 
cÚ‹xt
);

125 
ä“_h262_piùu»
(
h262_piùu»_p
 *
piùu»
);

134 
§me_h262_piùu»
(
h262_piùu»_p
 
piùu»1
,

135 
h262_piùu»_p
 
piùu»2
);

154 
g‘_Ãxt_h262_sšgË_piùu»
(
h262_cÚ‹xt_p
 
cÚ‹xt
,

155 
v”bo£
,

156 
h262_piùu»_p
 *
piùu»
);

196 
g‘_Ãxt_h262_äame
(
h262_cÚ‹xt_p
 
cÚ‹xt
,

197 
v”bo£
,

198 
qu›t
,

199 
h262_piùu»_p
 *
piùu»
);

209 
wr™e_h262_piùu»_as_TS
(
TS_wr™”_p
 
tswr™”
,

210 
h262_piùu»_p
 
piùu»
,

211 
ušt32_t
 
pid
);

220 
wr™e_h262_piùu»_as_ES
(
FILE
 *
ouut
,

221 
h262_piùu»_p
 
piùu»
);

228 
»pÜt_h262_piùu»
(
h262_piùu»_p
 
piùu»
,

229 
»pÜt_d©a
);

	@ipv4.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

34 
	~"v4.h
"

35 
	~"misc_âs.h
"

36 
	~<¡ršg.h
>

38 
	$v4_äom_·ylßd
(cÚ¡ 
ušt8_t
 *
d©a
,

39 cÚ¡ 
ušt32_t
 
Ën
,

40 
v4_h—d”_t
 *
out_hdr
,

41 
ušt32_t
 *
out_¡
,

42 
ušt32_t
 *
out_Ën
)

44 
ušt32_t
 
cur_f›ld
;

47 ià(
Ën
 < 20)

49  
IPV4_ERR_PKT_TOO_SHORT
;

53 
cur_f›ld
 = 
	`ušt_32_be
(&
d©a
[0]);

55 
out_hdr
->
v”siÚ
 = (
cur_f›ld
 >> 28)&0xf;

56 
out_hdr
->
hdr_Ëngth
 = (
cur_f›ld
 >> 24)& 0xf;

57 
out_hdr
->
£rv_ty³
 = (
cur_f›ld
 >> 16) & 0xff;

58 
out_hdr
->
Ëngth
 = (
cur_f›ld
) & 0xffff;

61 
cur_f›ld
 = 
	`ušt_32_be
(&
d©a
[4]);

63 
out_hdr
->
id’t
 = (
cur_f›ld
 >> 16) & 0xffff;

64 
out_hdr
->
æags
 = (
cur_f›ld
 >> 13) & 7;

65 
out_hdr
->
äag_off£t
 = (
cur_f›ld
 & 0x1fff);

68 
cur_f›ld
 = 
	`ušt_32_be
(&
d©a
[8]);

70 
out_hdr
->
‰l
 = (
cur_f›ld
 >> 24) & 0xff;

71 
out_hdr
->
´Ùo
 = (
cur_f›ld
 >> 16) & 0xff;

72 
out_hdr
->
csum
 = (
cur_f›ld
) & 0xffff;

75 
out_hdr
->
¤c_addr
 = 
	`ušt_32_be
(&
d©a
[12]);

77 
out_hdr
->
de¡_addr
 = 
	`ušt_32_be
(&
d©a
[16]);

80 (*
out_¡
èğ(
out_hdr
->
hdr_Ëngth
 << 2);

81 (*
out_Ën
èğ
Ën
 - (
out_hdr
->
hdr_Ëngth
 << 2);

84 
	}
}

87 
	$v4_udp_äom_·ylßd
(cÚ¡ 
ušt8_t
 *
d©a
,

88 cÚ¡ 
ušt32_t
 
Ën
,

89 
v4_udp_h—d”_t
 *
out_hdr
,

90 
ušt32_t
 *
out_¡
,

91 
ušt32_t
 *
out_Ën
)

93 
ušt32_t
 
cur_f›ld
;

96 ià(
Ën
 < 8)

98  
IPV4_ERR_PKT_TOO_SHORT
;

101 
cur_f›ld
 = 
	`ušt_32_be
(&
d©a
[0]);

102 
out_hdr
->
sourû_pÜt
 = (
cur_f›ld
 >> 16)&0xffff;

103 
out_hdr
->
de¡_pÜt
 = (
cur_f›ld
) & 0xffff;

105 
cur_f›ld
 = 
	`ušt_32_be
(&
d©a
[4]);

106 
out_hdr
->
Ëngth
 = (
cur_f›ld
 >> 16) & 0xffff;

107 
out_hdr
->
csum
 = (
cur_f›ld
) &0xffff;

109 (*
out_¡
) = 8;

110 (*
out_Ën
èğ
Ën
 - 8;

113 
	}
}

	@ipv4.h

30 #iâdeà
_v4_h


31 
	#_v4_h


	)

33 
	~"com·t.h
"

38 
	sv4_h—d”_s


41 
ušt8_t
 
	mv”siÚ
;

44 
ušt8_t
 
	mhdr_Ëngth
;

47 
ušt8_t
 
	m£rv_ty³
;

50 
ušt16_t
 
	mËngth
;

53 
ušt16_t
 
	mid’t
;

56 
ušt8_t
 
	mæags
;

59 
ušt16_t
 
	mäag_off£t
;

62 
ušt8_t
 
	m‰l
;

65 
ušt8_t
 
	m´Ùo
;

68 
ušt16_t
 
	mcsum
;

71 
ušt32_t
 
	m¤c_addr
;

74 
ušt32_t
 
	mde¡_addr
;

78 } 
	tv4_h—d”_t
;

81 
	#IPV4_HDR_IS_UDP
(
h
è((h)->
´Ùo
 =ğ17)

	)

83 
	#IPV4_ERR_PKT_TOO_SHORT
 (-1)

	)

92 
v4_äom_·ylßd
(cÚ¡ 
ušt8_t
 *
d©a
,

93 cÚ¡ 
ušt32_t
 
Ën
,

94 
v4_h—d”_t
 *
out_hdr
,

95 
ušt32_t
 *
out_¡
,

96 
ušt32_t
 *
out_Ën
);

99 
	sv4_udp_h—d”_s


102 
ušt16_t
 
	msourû_pÜt
;

105 
ušt16_t
 
	mde¡_pÜt
;

108 
ušt16_t
 
	mËngth
;

111 
ušt16_t
 
	mcsum
;

112 } 
	tv4_udp_h—d”_t
;

119 
v4_udp_äom_·ylßd
(cÚ¡ 
ušt8_t
 *
d©a
,

120 cÚ¡ 
ušt32_t
 
Ën
,

121 
v4_udp_h—d”_t
 *
out_hdr
,

122 
ušt32_t
 *
out_¡
,

123 
ušt32_t
 *
out_Ën
);

	@l2audio.c

37 
	~<¡dio.h
>

38 
	~<¡dlib.h
>

39 
	~<”ºo.h
>

40 
	~<¡ršg.h
>

42 
	~"com·t.h
"

43 
	~"misc_âs.h
"

44 
	~"´štšg_âs.h
"

45 
	~"l2audio_âs.h
"

47 
	#DEBUG
 0

	)

51 cÚ¡ 
	gb™¿‹_v1l1
[] =

56 cÚ¡ 
	gb™¿‹_v1l2
[] =

61 cÚ¡ 
	gb™¿‹_v1l3
[] =

66 cÚ¡ 
	gb™¿‹_v2l1
[] =

71 cÚ¡ 
	gb™¿‹_v2l2
[] =

77 cÚ¡ * cÚ¡ 
	gb™¿‹_bË
[3][3] =

79 { 
b™¿‹_v1l1
, 
b™¿‹_v1l2
, 
b™¿‹_v1l3
 },

80 { 
b™¿‹_v2l1
, 
b™¿‹_v2l2
, bitrate_v2l2 },

81 { 
b™¿‹_v2l1
, 
b™¿‹_v2l2
, bitrate_v2l2 }

85 cÚ¡ 
	g§m¶šg_bË
[3][3] =

95 
	#AUD_FRAME_RATE_N_0
 96000

	)

96 
	#AUD_FRAME_RATE_N_1
 88200

	)

97 
	#AUD_FRAME_RATE_N_2
 64000

	)

98 
	#AUD_FRAME_RATE_N_3
 48000

	)

99 
	#AUD_FRAME_RATE_N_4
 44100

	)

100 
	#AUD_FRAME_RATE_N_5
 32000

	)

101 
	#AUD_FRAME_RATE_N_6
 24000

	)

102 
	#AUD_FRAME_RATE_N_7
 22050

	)

103 
	#AUD_FRAME_RATE_N_8
 16000

	)

104 
	#AUD_FRAME_RATE_N_9
 12000

	)

105 
	#AUD_FRAME_RATE_N_10
 11025

	)

106 
	#AUD_FRAME_RATE_N_11
 8000

	)

107 
	#AUD_FRAME_RATE_N_12
 7350

	)

108 
	#AUD_FRAME_RATE_N_13
 0

	)

109 
	#AUD_FRAME_RATE_N_14
 0

	)

110 
	#AUD_FRAME_RATE_N_15
 0

	)

112 cÚ¡ 
	gaud_äame_¿‹_n
[16] =

114 
AUD_FRAME_RATE_N_0
,

115 
AUD_FRAME_RATE_N_1
,

116 
AUD_FRAME_RATE_N_2
,

117 
AUD_FRAME_RATE_N_3
,

118 
AUD_FRAME_RATE_N_4
,

119 
AUD_FRAME_RATE_N_5
,

120 
AUD_FRAME_RATE_N_6
,

121 
AUD_FRAME_RATE_N_7
,

122 
AUD_FRAME_RATE_N_8
,

123 
AUD_FRAME_RATE_N_9
,

124 
AUD_FRAME_RATE_N_10
,

125 
AUD_FRAME_RATE_N_11
,

126 
AUD_FRAME_RATE_N_12
,

127 
AUD_FRAME_RATE_N_13
,

128 
AUD_FRAME_RATE_N_14
,

129 
AUD_FRAME_RATE_N_15


138 
	$³ek_äame_h—d”
(cÚ¡ 
ušt32_t
 
h—d”
)

140 
v”siÚ
, 
Ïy”
, 
·ddšg
;

143 
b™¿‹_’c
, 
§m¶šg_’c
;

144 
b™¿‹
, 
§m¶šg
;

145 
by‹
 
¿‹
;

146 
äamesize
, 
äam–’
;

153 
v”siÚ
 = (
h—d”
 >> 19) & 0x03;

154 ià(
v”siÚ
 == 1)

156 
	`´št_”r
("### Illegal version (1) in MPEG†ayer 2‡udio header\n");

159 
v”siÚ
 = (version == 3) ? 1: (version == 2) ? 2: 3;

166 
Ïy”
 = (
h—d”
 >> 17) & 0x03;

167 ià(
Ïy”
 == 0)

169 
	`´št_”r
("### Illegal†ayer (0) in MPEG†ayer 2‡udio header\n");

172 
Ïy”
 = 4 -†ayer;

178 
b™¿‹_’c
 = (
h—d”
 >> 12) & 0x0f;

179 ià(
b™¿‹_’c
 == 0x0f)

181 
	`´št_”r
("### Illegal bitrate_enc (0x0f) in MPEG†ayer 2‡udio header\n");

185 
b™¿‹
 = (
b™¿‹_bË
[
v”siÚ
-1][
Ïy”
-1])[
b™¿‹_’c
];

186 ià(
b™¿‹
 == 0)

188 
	`´št_”r
("### Illegal bitrate (0 kbits/channel) in MPEG†evel 2"

194 
§m¶šg_’c
 = (
h—d”
 >> 10) & 0x03;

195 ià(
§m¶šg_’c
 == 3)

197 
	`´št_”r
("### Illegal sampleing_enc (3) in MPEG†ayer 2‡udio header\n");

200 
§m¶šg
 = 
§m¶šg_bË
[
v”siÚ
-1][
§m¶šg_’c
];

203 
¿‹
 = (
v”siÚ
 * 3è+ (
§m¶šg_’c
 & 2) + (sampling_enc == 0);

206 
·ddšg
 = (
h—d”
 >> 9) & 0x01;

225 ià(
Ïy”
 == 1)

227 
äamesize
 = 384;

228 
äam–’
 = (12000 * 
b™¿‹
 / 
aud_äame_¿‹_n
[
¿‹
] + 
·ddšg
) * 4;

230 ià(
v”siÚ
 == 1)

232 
äamesize
 = 1152;

233 
äam–’
 = (144000 * 
b™¿‹
 / 
aud_äame_¿‹_n
[
¿‹
] + 
·ddšg
);

237 
äamesize
 = 576;

238 
äam–’
 = (72000 * 
b™¿‹
 / 
aud_äame_¿‹_n
[
¿‹
] + 
·ddšg
);

240  
äam–’
;

241 
	}
}

248 
šlše
 
	$bud_audio_äame
(
audio_äame_p
 *
äame
)

250 
audio_äame_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_AUDIO_FRAME
);

251 ià(
Ãw
 =ğ
NULL
)

253 
	`´št_”r
("### Unableo‡llocate‡udio frame datastructure\n");

257 
Ãw
->
d©a
 = 
NULL
;

258 
Ãw
->
d©a_Ën
 = 0;

260 *
äame
 = 
Ãw
;

262 
	}
}

276 
	$»ad_Ãxt_l2audio_äame
(
fe
,

277 
audio_äame_p
 *
äame
)

279 
	#JUST_ENOUGH
 6

280 

	)

281 
”r
, 
ii
;

282 
by‹
 
h—d”
[
JUST_ENOUGH
];

283 
by‹
 *
d©a
 = 
NULL
;

284 
äame_Ëngth
;

286 
off£t_t
 
po¢
 = 
	`‹Î_fe
(
fe
);

287 #ià
DEBUG


288 
	`åršt_msg
("Off£t: " 
OFFSET_T_FORMAT
 "\n",
po¢
);

291 
”r
 = 
	`»ad_by‹s
(
fe
,
JUST_ENOUGH
,
h—d”
);

292 ià(
”r
 =ğ
EOF
)

293  
EOF
;

294 ià(
”r
)

296 
	`åršt_”r
("### Error„eading header bytes of MPEG†ayer 2‡udio frame\n"

297 " (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n",
po¢
);

298 
	`ä“
(
d©a
);

302 #ià
DEBUG


303 
	`´št_msg
("MPEG†ayer 2 frame\n");

304 
	`´št_d©a
(
TRUE
,"S¹",
h—d”
,
JUST_ENOUGH
,JUST_ENOUGH);

307 
h—d”
[0] != 0xFF || (header[1] & 0xe0) != 0xe0)

309 
sk
 = 
JUST_ENOUGH
;

310 
	`åršt_”r
("### MPEG†ayer 2‡udio frame does‚ot start with '1111 1111 111x'\n"

313 (
h—d”
[0] & 0xF0) >> 4,

314 (
h—d”
[0] & 0x0F),

315 (
h—d”
[1] & 0xe0) >> 4);

316 
	`åršt_”r
(" (š f¿m¡¬tšg‡ˆ" 
OFFSET_T_FORMAT
 ")\n",
po¢
);

319 
”r
 = 
	`»ad_by‹s
(
fe
,1,
h—d”
);

320 
sk
++;

321 ià(
”r
 =ğ0 && 
h—d”
[0] == 0xff)

323 
”r
 = 
	`»ad_by‹s
(
fe
,1,
h—d”
 + 1);

324 
sk
++;

325 ià(
”r
 =ğ0 && (
h—d”
[1] & 0xe0) == 0xe0)

327 
”r
 = 
	`»ad_by‹s
(
fe
,
JUST_ENOUGH
 - 2, 
h—d”
 + 2);

331 } !
”r
);

332 ià(
”r
)  1;

333 
	`åršt_”r
("#################### Resumšg‡á” %d sk³d by‹s\n",
sk
);

336 
äame_Ëngth
 = 
	`³ek_äame_h—d”
((
h—d”
[1] << 16) | (header[2] << 8) | header[3]);

337 ià(
äame_Ëngth
 < 1)

339 
	`´št_”r
("### Bad MPEG†ayer 2‡udio header\n");

343 
d©a
 = 
	`m®loc
(
äame_Ëngth
);

344 ià(
d©a
 =ğ
NULL
)

346 
	`´št_”r
("### Unableoƒxtend data buffer for MPEG†ayer 2‡udio frame\n");

347 
	`ä“
(
d©a
);

351 
ii
=0; ii<
JUST_ENOUGH
; ii++)

352 
d©a
[
ii
] = 
h—d”
[ii];

354 
”r
 = 
	`»ad_by‹s
(
fe
,
äame_Ëngth
 - 
JUST_ENOUGH
,&(
d©a
[JUST_ENOUGH]));

355 ià(
”r
)

357 ià(
”r
 =ğ
EOF
)

358 
	`´št_”r
("### Unexpected EOF„eading„est of MPEG†ayer 2‡udio frame\n");

360 
	`´št_”r
("### Error„eading„est of MPEG†ayer 2‡udio frame\n");

361 
	`ä“
(
d©a
);

365 
”r
 = 
	`bud_audio_äame
(
äame
);

366 ià(
”r
)

368 
	`ä“
(
d©a
);

371 (*
äame
)->
d©a
 = data;

372 (*
äame
)->
d©a_Ën
 = 
äame_Ëngth
;

375 
	}
}

	@l2audio_fns.h

37 #iâdeà
_l2audio_âs


38 
	#_l2audio_âs


	)

40 
	~"audio_deâs.h
"

49 
ä“_audio_äame
(
audio_äame_p
 *
äame
);

63 
»ad_Ãxt_l2audio_äame
(
fe
,

64 
audio_äame_p
 *
äame
);

	@m2ts2ts.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<”ºo.h
>

34 
	~<¡ršg.h
>

35 
	~<fú.h
>

36 #ifdeà
_WIN32


37 
	~<¡ddef.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"ts_deâs.h
"

44 
	~"misc_âs.h
"

45 
	~"´štšg_âs.h
"

46 
	~"v”siÚ.h
"

48 
	#M2TS_PACKET_SIZE
 (4 + 
TS_PACKET_SIZE
)

	)

50 
	s_m2ts_·ck‘_bufãr


52 
_m2ts_·ck‘_bufãr
 * 
	mÃxt
;

53 
_m2ts_·ck‘_bufãr
 * 
	m´ev
;

54 
ušt32_t
 
	mtime¡amp
;

55 
by‹
 * 
	mts_·ck‘
;

56 
by‹
 
	mm2ts_·ck‘
[
M2TS_PACKET_SIZE
];

59 
_m2ts_·ck‘_bufãr
 *
	tm2ts_·ck‘_bufãr_p
;

68 
	$·r£_m2ts_·ck‘
(
m2ts_·ck‘_bufãr_p
 
·ck‘_bufãr
)

70 
·ck‘_bufãr
->
time¡amp
 =

71 (((
ušt32_t
)(
·ck‘_bufãr
->
m2ts_·ck‘
[0])) << 24) |

72 (((
ušt32_t
)(
·ck‘_bufãr
->
m2ts_·ck‘
[1])) << 16) |

73 (((
ušt32_t
)(
·ck‘_bufãr
->
m2ts_·ck‘
[2])) << 8) |

74 ((
ušt32_t
)(
·ck‘_bufãr
->
m2ts_·ck‘
[3]));

75 
·ck‘_bufãr
->
ts_·ck‘
 =…ack‘_bufãr->
m2ts_·ck‘
 + 4;

76 
·ck‘_bufãr
->
Ãxt
 = 
NULL
;

77 
·ck‘_bufãr
->
´ev
 = 
NULL
;

78 
	}
}

89 
	$exŒaù_·ck‘s
(
šput
, 
FILE
 * 
ouut
,

90 cÚ¡ 
»Üd”_bufãr_size
,

91 
v”bo£
, 
qu›t
)

93 
”r
;

94 
m2ts_·ck‘_bufãr_p
 
»Üd”_bufãr_h—d
 = 
NULL
;

95 
m2ts_·ck‘_bufãr_p
 
»Üd”_bufãr_
 = 
NULL
;

96 
»Üd”_bufãr_’Œ›s
 = 0;

97 
m2ts_·ck‘_bufãr_p
 
·ck‘_bufãr_š_hªd
 = 
NULL
;

98 
m2ts_·ck‘_bufãr_p
 
·ck‘_bufãr
;

99 
m2ts_·ck‘_bufãr_p
 
p
;

100 
wr™‹n
;

106 ià(
·ck‘_bufãr_š_hªd
 !ğ
NULL
)

108 
·ck‘_bufãr
 = 
·ck‘_bufãr_š_hªd
;

109 
·ck‘_bufãr_š_hªd
 = 
NULL
;

113 
·ck‘_bufãr
 = 
	`m®loc
((
_m2ts_·ck‘_bufãr
));

115 
	`åršt_msg
("AÎoÿ‹d bufã¸@ %p\n", 
·ck‘_bufãr
);

116 ià(
·ck‘_bufãr
 =ğ
NULL
)

118 
	`´št_”r
( "### m2ts2ts: out of memory‡llocating M2TS…acket buffer\n");

119 
»Üd”_bufãr_h—d
 !ğ
NULL
)

121 
·ck‘_bufãr
 = 
»Üd”_bufãr_h—d
->
Ãxt
;

122 
	`ä“
(
»Üd”_bufãr_h—d
);

123 
»Üd”_bufãr_h—d
 = 
·ck‘_bufãr
;

125 ià(
·ck‘_bufãr_š_hªd
 !ğ
NULL
)

126 
	`ä“
(
·ck‘_bufãr_š_hªd
);

130 
”r
 = 
	`»ad_by‹s
(
šput
, 
M2TS_PACKET_SIZE
, 
·ck‘_bufãr
->
m2ts_·ck‘
);

131 ià(
”r
 =ğ
EOF
)

134 ià(!
qu›t
)

135 
	`´št_msg
("m2ts2ts: Reachedƒnd of file\n");

138 ià(
”r
)

141 
»Üd”_bufãr_h—d
 !ğ
NULL
)

143 
·ck‘_bufãr
 = 
»Üd”_bufãr_h—d
->
Ãxt
;

144 
	`ä“
(
»Üd”_bufãr_h—d
);

145 
»Üd”_bufãr_h—d
 = 
·ck‘_bufãr
;

147 ià(
·ck‘_bufãr_š_hªd
 !ğ
NULL
)

148 
	`ä“
(
·ck‘_bufãr_š_hªd
);

151 
	`·r£_m2ts_·ck‘
(
·ck‘_bufãr
);

152 ià(
v”bo£
)

153 
	`åršt_msg
("R—dime¡am°0x%08x\n", 
·ck‘_bufãr
->
time¡amp
);

158 
p
 = 
»Üd”_bufãr_
;

159 ià(
p
 !ğ
NULL
)

160 
	`åršt_msg
("tailimestamp = 0x%08x @ %p\n",

161 
p
->
time¡amp
,…);

162 
p
 !ğ
NULL
 &&…->
time¡amp
 > 
·ck‘_bufãr
->timestamp)

164 
p
 =…->
´ev
;

165 ià(
p
 !ğ
NULL
)

166 
	`åršt_msg
("pimestamp = 0x%08x @ %p\n",

167 
p
->
time¡amp
,…);

170 ià(
p
 =ğ
NULL
)

173 
	`åršt_msg
("### Insert %p‡t head: %p\n",

174 
·ck‘_bufãr
,

175 
»Üd”_bufãr_h—d
);

176 
·ck‘_bufãr
->
Ãxt
 = 
»Üd”_bufãr_h—d
;

177 
»Üd”_bufãr_h—d
 = 
·ck‘_bufãr
;

178 
·ck‘_bufãr
->
´ev
 = 
NULL
;

179 ià(
»Üd”_bufãr_
 =ğ
NULL
)

182 
»Üd”_bufãr_
 = 
·ck‘_bufãr
;

186 
·ck‘_bufãr
->
Ãxt
->
´ev
 =…acket_buffer;

192 
·ck‘_bufãr
->
Ãxt
 = 
p
->next;

193 
p
->
Ãxt
 = 
·ck‘_bufãr
;

194 
·ck‘_bufãr
->
´ev
 = 
p
;

195 ià(
p
 =ğ
»Üd”_bufãr_
)

198 
»Üd”_bufãr_
 = 
·ck‘_bufãr
;

202 ià(
v”bo£
)

203 
	`åršt_msg
("Reordered…acketimestamp=0x%08x\n",

204 
·ck‘_bufãr
->
time¡amp
);

205 
·ck‘_bufãr
->
Ãxt
->
´ev
 =…acket_buffer;

208 
	`åršt_msg
("###…acket‡t %p,…rev=%p,‚ext=%p\n",

209 
·ck‘_bufãr
,

210 (
·ck‘_bufãr
->
´ev
),

211 (
·ck‘_bufãr
->
Ãxt
));

212 
»Üd”_bufãr_’Œ›s
++;

214 ià(
»Üd”_bufãr_’Œ›s
 > ()
»Üd”_bufãr_size
)

217 
	`åršt_msg
("### queue head @ %p,‚ext=%p\n",

218 
»Üd”_bufãr_h—d
,

219 (
»Üd”_bufãr_h—d
->
Ãxt
));

220 
·ck‘_bufãr
 = 
»Üd”_bufãr_h—d
;

221 
»Üd”_bufãr_h—d
 =„eÜd”_bufãr_h—d->
Ãxt
;

222 
»Üd”_bufãr_h—d
->
´ev
 = 
NULL
;

223 
wr™‹n
 = 
	`fwr™e
(
·ck‘_bufãr
->
ts_·ck‘
,

224 
TS_PACKET_SIZE
, 1, 
ouut
);

225 ià(
wr™‹n
 != 1)

228 
	`åršt_”r
( "### m2ts2ts: Error writing TS…acket: %s\n",

229 
	`¡»¼Ü
(
”ºo
));

230 
	`ä“
(
·ck‘_bufãr
);

231 
»Üd”_bufãr_h—d
 !ğ
NULL
)

233 
·ck‘_bufãr
 = 
»Üd”_bufãr_h—d
->
Ãxt
;

234 
	`ä“
(
»Üd”_bufãr_h—d
);

235 
»Üd”_bufãr_h—d
 = 
·ck‘_bufãr
;

241 
»Üd”_bufãr_’Œ›s
--;

242 ià(
v”bo£
)

243 
	`åršt_msg
("Wr™‹Àtime¡am°0x%08x\n", 
·ck‘_bufãr
->
time¡amp
);

244 
·ck‘_bufãr_š_hªd
 = 
·ck‘_bufãr
;

248 
	`ä“
(
·ck‘_bufãr_š_hªd
);

251 
»Üd”_bufãr_h—d
 !ğ
NULL
)

253 
·ck‘_bufãr
 = 
»Üd”_bufãr_h—d
->
Ãxt
;

254 
wr™‹n
 = 
	`fwr™e
(
»Üd”_bufãr_h—d
->
ts_·ck‘
,

255 
TS_PACKET_SIZE
, 1, 
ouut
);

256 ià(
wr™‹n
 != 1)

259 
	`åršt_”r
( "### m2ts2ts: Error writing final TS…ackets: %s\n",

260 
	`¡»¼Ü
(
”ºo
));

261 
»Üd”_bufãr_h—d
 !ğ
NULL
)

263 
·ck‘_bufãr
 = 
»Üd”_bufãr_h—d
->
Ãxt
;

264 
	`ä“
(
»Üd”_bufãr_h—d
);

265 
»Üd”_bufãr_h—d
 = 
·ck‘_bufãr
;

268 
	`ä“
(
»Üd”_bufãr_h—d
);

269 
»Üd”_bufãr_h—d
 = 
·ck‘_bufãr
;

273 
	}
}

277 
	$´št_u§ge
()

279 
	`´št_msg
("Usage: m2ts2es [switches] [<infile>] [<outfile>]\n"

281 
	`REPORT_VERSION
("m2ts2ts");

282 
	`´št_msg
("\n"

298 
	}
}

302 
	$maš
(
¬gc
, *
¬gv
[])

304 
u£_¡dout
 = 
FALSE
;

305 
u£_¡dš
 = 
FALSE
;

306 *
šput_Çme
 = 
NULL
;

307 *
ouut_Çme
 = 
NULL
;

308 
had_šput_Çme
 = 
FALSE
;

309 
had_ouut_Çme
 = 
FALSE
;

311 
šput
 = -1;

312 
FILE
 *
ouut
 = 
NULL
;

313 
»Üd”_buff_size
 = 4;

314 
qu›t
 = 
FALSE
;

315 
v”bo£
 = 
FALSE
;

317 
”r
 = 0;

318 
ii
 = 1;

320 ià(
¬gc
 < 2)

322 
	`´št_u§ge
();

327 
ii
 < 
¬gc
)

329 ià(
¬gv
[
ii
][0] == '-')

331 ià(!
	`¡rcmp
("--h–p", 
¬gv
[
ii
]) || !strcmp("-h",‡rgv[ii]) ||

332 !
	`¡rcmp
("-h–p", 
¬gv
[
ii
]))

334 
	`´št_u§ge
();

337 ià(!
	`¡rcmp
("-v”bo£", 
¬gv
[
ii
]) || !strcmp("-v",‡rgv[ii]))

339 
v”bo£
 = 
TRUE
;

340 
qu›t
 = 
FALSE
;

342 ià(!
	`¡rcmp
("-qu›t", 
¬gv
[
ii
]) || !strcmp("-q",‡rgv[ii]))

344 
v”bo£
 = 
FALSE
;

345 
qu›t
 = 
TRUE
;

347 ià(!
	`¡rcmp
("-bufãr", 
¬gv
[
ii
]) || !strcmp("-b",‡rgv[ii]))

349 
	`CHECKARG
("m2ts2ts",
ii
);

350 
”r
 = 
	`unsigÃd_v®ue
("m2ts2ts", 
¬gv
[
ii
],‡rgv[ii+1],

351 0, &
»Üd”_buff_size
);

352 ià(
”r
)  1;

353 
ii
++;

355 ià(!
	`¡rcmp
("-¡dš", 
¬gv
[
ii
]))

357 
u£_¡dš
 = 
TRUE
;

358 
had_šput_Çme
 = 
TRUE
;

360 ià(!
	`¡rcmp
("-¡dout", 
¬gv
[
ii
]))

362 
u£_¡dout
 = 
TRUE
;

363 
had_ouut_Çme
 = 
TRUE
;

364 
	`»dœeù_ouut_¡d”r
();

366 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

368 
	`CHECKARG
("m2ts2ts",
ii
);

369 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

370 
	`»dœeù_ouut_¡d”r
();

371 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

372 
	`»dœeù_ouut_¡dout
();

375 
	`åršt_”r
("### m2ts2ts: "

377 " '¡d”r')\n",
¬gv
[
ii
+1]);

380 
ii
++;

384 
	`åršt_”r
( "### m2ts2ts: "

385 "UÄecogni£d commªd†šsw™ch '%s'\n", 
¬gv
[
ii
]);

391 ià(
had_šput_Çme
 && 
had_ouut_Çme
)

393 
	`åršt_”r
Ğ"### m2ts2ts: UÃx³ùed '%s'\n", 
¬gv
[
ii
]);

396 ià(
had_šput_Çme
)

398 
ouut_Çme
 = 
¬gv
[
ii
];

399 
had_ouut_Çme
 = 
TRUE
;

403 
šput_Çme
 = 
¬gv
[
ii
];

404 
had_šput_Çme
 = 
TRUE
;

407 
ii
++;

410 ià(!
had_šput_Çme
)

412 
	`´št_”r
( "### m2ts2ts: No input file specified\n");

416 ià(!
had_ouut_Çme
)

418 
	`´št_”r
( "### m2ts2ts: No output file specified\n");

423 ià(
u£_¡dout
)

425 
v”bo£
 = 
FALSE
;

426 
qu›t
 = 
TRUE
;

429 ià(
u£_¡dš
)

431 
šput
 = 
STDIN_FILENO
;

435 
šput
 = 
	`İ’_bš¬y_fe
(
šput_Çme
, 
FALSE
);

436 ià(
šput
 == -1)

438 
	`åršt_”r
( "### m2ts2ts: Unableo open input file %s\n",

439 
šput_Çme
);

443 ià(!
qu›t
)

444 
	`åršt_msg
("R—dšg from %s\n", (
u£_¡dš
 ? "<¡dš>" : 
šput_Çme
));

446 ià(
u£_¡dout
)

448 
ouut
 = 
¡dout
;

452 
ouut
 = 
	`fİ’
(
ouut_Çme
, "wb");

453 ià(
ouut
 =ğ
NULL
)

455 ià(!
u£_¡dš
)

456 (è
	`şo£_fe
(
šput
);

457 
	`åršt_”r
( "### m2ts2ts: Unableo open output file %s: %s\n",

458 
ouut_Çme
, 
	`¡»¼Ü
(
”ºo
));

462 ià(!
qu›t
)

463 
	`åršt_msg
("Wr™šgØ %s\n", (
u£_¡dout
 ? "<¡dout>" : 
ouut_Çme
));

466 
”r
 = 
	`exŒaù_·ck‘s
(
šput
, 
ouut
, 
»Üd”_buff_size
, 
v”bo£
, 
qu›t
);

467 ià(
”r
)

469 
	`´št_”r
( "### m2ts2ts: Errorƒxtracting data\n");

470 ià(!
u£_¡dš
è(è
	`şo£_fe
(
šput
);

471 ià(!
u£_¡dout
è(è
	`fşo£
(
ouut
);

476 ià(!
u£_¡dout
)

478 
”ºo
 = 0;

479 
”r
 = 
	`fşo£
(
ouut
);

480 ià(
”r
)

482 
	`åršt_”r
( "### m2ts2ts: Error closing output file %s: %s\n",

483 
ouut_Çme
, 
	`¡»¼Ü
(
”ºo
));

484 (è
	`şo£_fe
(
šput
);

489 ià(!
u£_¡dš
)

491 
”r
 = 
	`şo£_fe
(
šput
);

492 ià(
”r
)

493 
	`åršt_”r
( "### m2ts2ts: Error closing input file %s\n",

494 
šput_Çme
);

497 
	}
}

	@misc.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<m©h.h
>

34 
	~<lim™s.h
>

35 
	~<”ºo.h
>

36 
	~<¡ršg.h
>

37 
	~<fú.h
>

39 #ifdeà
_WIN32


40 
	~<wšsock2.h
>

41 
	~<ws2tı.h
>

42 
	~<io.h
>

45 
	~<sys/ty³s.h
>

46 
	~<sys/sock‘.h
>

47 
	~<Ãtdb.h
>

48 
	~<Ãtš‘/š.h
>

49 
	~<¬·/š‘.h
>

50 
	~<uni¡d.h
>

53 
	~"com·t.h
"

54 
	~"misc_âs.h
"

55 
	~"es_âs.h
"

56 
	~"³s_âs.h
"

57 
	~"´štšg_âs.h
"

59 
	#DEBUG_SEEK
 1

	)

65 
ušt32_t
 
	güc_bË
[256];

70 
	$make_üc_bË
()

72 
i
, 
j
;

73 
®»ady_dÚe
 = 0;

74 
ušt32_t
 
üc
;

76 ià(
®»ady_dÚe
)

79 
®»ady_dÚe
 = 1;

81 
i
 = 0; i < 256; i++)

83 
üc
 = 
i
 << 24;

84 
j
 = 0; j < 8; j++)

86 ià(
üc
 & 0x80000000L)

87 
üc
 = (üø<< 1è^ 
CRC32_POLY
;

89 
üc
 = ( crc << 1 );

91 
üc_bË
[
i
] = 
üc
;

94 
	}
}

105 
ušt32_t
 
	$üc32_block
(
ušt32_t
 
üc
, 
by‹
 *
pD©a
, 
blk_Ën
)

107 
bË_made
 = 
FALSE
;

108 
i
, 
j
;

110 ià(!
bË_made
è
	`make_üc_bË
();

112 
j
 = 0; j < 
blk_Ën
; j++)

114 
i
 = ((
üc
 >> 24è^ *
pD©a
++) & 0xff;

115 
üc
 = (üø<< 8è^ 
üc_bË
[
i
];

117  
üc
;

118 
	}
}

136 
	$´št_d©a
(
is_msg
,

137 cÚ¡ *
Çme
,

138 cÚ¡ 
by‹
 
d©a
[],

139 
Ëngth
,

140 
max
)

142 
ii
;

144 ià(
Ëngth
 == 0)

146 
	`åršt_msg_Ü_”r
(
is_msg
,"% (0 by‹s)\n",
Çme
);

150 
	#MAX_LINE_LENGTH
 80

	)

152 
	`åršt_msg_Ü_”r
(
is_msg
,"% (%d by‹%s):",
Çme
,
Ëngth
,(length==1?"":"s"));

153 ià(
d©a
 =ğ
NULL
)

154 
	`åršt_msg_Ü_”r
(
is_msg
," <null>");

157 
ii
 = 0; i˜< (
Ëngth
<
max
?length:max); ii++)

158 
	`åršt_msg_Ü_”r
(
is_msg
," %02x",
d©a
[
ii
]);

159 ià(
max
 < 
Ëngth
)

160 
	`åršt_msg_Ü_”r
(
is_msg
,"...");

162 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

163 
	}
}

180 
	$´št_’d_of_d©a
(*
Çme
,

181 
by‹
 
d©a
[],

182 
Ëngth
,

183 
max
)

185 
ii
;

186 ià(
Ëngth
 == 0)

188 
	`åršt_msg
("% (0 by‹s)\n",
Çme
);

192 
	`åršt_msg
("% (%d by‹%s):",
Çme
,
Ëngth
,(length==1?"":"s"));

193 ià(
d©a
 =ğ
NULL
)

194 
	`´št_msg
(" <null>");

197 ià(
max
 < 
Ëngth
)

198 
	`´št_msg
(" ...");

199 
ii
 = (
Ëngth
<
max
?0:length-max); ii <†ength; ii++)

200 
	`åršt_msg
(" %02x",
d©a
[
ii
]);

202 
	`´št_msg
("\n");

203 
	}
}

208 
	$´št_b™s
(
num_b™s
,

209 
by‹
 
v®ue
)

211 
ii
;

212 
by‹
 
masks
[8] = {0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01};

213 
ii
 = 8-
num_b™s
; ii < 8; ii++)

215 
	`åršt_msg
("%d",((
v®ue
 & 
masks
[
ii
]) >> (8-ii-1)));

217 
	}
}

222 
	$log2
(
x
)

224 ià(
x
 == 2.0)

227  
	`log10
(
x
) /†og10(2);

228 
	}
}

247 
	$»ad_by‹s
(
šput
,

248 
num_by‹s
,

249 
by‹
 *
d©a
)

251 #ifdeà
_WIN32


252 
tÙ®
 = 0;

253 
Ëngth
;

255 
ssize_t
 
tÙ®
 = 0;

256 
ssize_t
 
Ëngth
;

261 
tÙ®
 < 
num_by‹s
)

263 
Ëngth
 = 
	`»ad
(
šput
,&(
d©a
[
tÙ®
]),
num_by‹s
-total);

264 ià(
Ëngth
 == 0)

265  
EOF
;

266 ià(
Ëngth
 == -1)

268 
	`åršt_”r
("### E¼Ü„—dšg %d by‹s: %s\n",
num_by‹s
,

269 
	`¡»¼Ü
(
”ºo
));

272 
tÙ®
 +ğ
Ëngth
;

275 
	}
}

292 
	$£ek_fe
(
fedes
,

293 
off£t_t
 
po¢
)

295 
off£t_t
 
Ãwpo¢
 = 
	`l£ek
(
fedes
,
po¢
,
SEEK_SET
);

296 ià(
Ãwpo¢
 == -1)

298 
	`åršt_”r
("### E¼Ü movšg (£ekšgètØpos™iÚ " 
OFFSET_T_FORMAT


299 " iÀfe: %s\n",
po¢
,
	`¡»¼Ü
(
”ºo
));

302 ià(
Ãwpo¢
 !ğ
po¢
)

304 
	`åršt_”r
("### E¼Ü movšg (£ekšgètØpos™iÚ " 
OFFSET_T_FORMAT


305 " iÀfe:‡ùu®ly movedØ" 
OFFSET_T_FORMAT
 "\n",
po¢
,
Ãwpo¢
);

309 
	}
}

324 
off£t_t
 
	$‹Î_fe
(
fedes
)

326 #ifdeà
_WIN32


327 
off£t_t
 
Ãwpo¢
 = 
	`_‹Î
(
fedes
);

329 
off£t_t
 
Ãwpo¢
 = 
	`l£ek
(
fedes
,0,
SEEK_CUR
);

331 ià(
Ãwpo¢
 == -1)

332 
	`åršt_”r
("### Error determining current…osition in file: %s\n",

333 
	`¡»¼Ü
(
”ºo
));

334  
Ãwpo¢
;

335 
	}
}

353 
	$İ’_bš¬y_fe
(*
f’ame
,

354 
fÜ_wr™e
)

356 #ifdeà
_WIN32


357 
æags
 = 
O_BINARY
;

359 
æags
 = 0;

361 
fedes
;

362 ià(
fÜ_wr™e
)

364 
æags
 = fÏg | 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
;

365 
fedes
 = 
	`İ’
(
f’ame
,
æags
,00777);

369 
æags
 = fÏg | 
O_RDONLY
;

370 
fedes
 = 
	`İ’
(
f’ame
,
æags
);

372 ià(
fedes
 == -1)

373 
	`åršt_”r
("### Error opening file %s for %s: %s\n",

374 
f’ame
,(
fÜ_wr™e
?"wr™e":"»ad"),
	`¡»¼Ü
(
”ºo
));

375  
fedes
;

376 
	}
}

385 
	$şo£_fe
(
fedes
)

387 
”r
;

389 ià(
fedes
 =ğ-1 || fede =ğ
STDIN_FILENO
)

392 
”r
 = 
	`şo£
(
fedes
);

393 ià(
”r
)

395 
	`åršt_”r
("### E¼Ü closšg fe: %s\n",
	`¡»¼Ü
(
”ºo
));

400 
	}
}

405 
	$İ’_šput_as_ES_usšg_PES
(*
Çme
,

406 
qu›t
,

407 
fÜû_¡»am_ty³
,

408 
wªt_d©a
,

409 *
is_d©a
,

410 
ES_p
 *
es
)

412 
”r
;

413 
PES_»ad”_p
 
»ad”
 = 
NULL
;

415 ià(
Çme
 =ğ
NULL
)

417 
	`´št_”r
("### Cannot use standard inputo„ead PES\n");

421 
”r
 = 
	`İ’_PES_»ad”
(
Çme
,!
qu›t
,!qu›t,&
»ad”
);

422 ià(
”r
)

424 
	`åršt_”r
("### E¼ÜryšgØbud PES„—d” fÜ iÅuˆf%s\n",
Çme
);

427 
”r
 = 
	`bud_–em’ry_¡»am_PES
(
»ad”
,
es
);

428 ià(
”r
)

430 
	`åršt_”r
("### Errorryingo build ES„eader from PES„eader\n"

431 " fÜ iÅuˆf%s\n",
Çme
);

432 (è
	`şo£_PES_»ad”
(&
»ad”
);

436 ià(!
qu›t
)

437 
	`åršt_msg
("R—dšg from %s\n",
Çme
);

439 ià(
fÜû_¡»am_ty³
)

441 ià(
fÜû_¡»am_ty³
)

442 *
is_d©a
 = 
wªt_d©a
;

444 *
is_d©a
 = 
VIDEO_H262
;

445 ià(!
qu›t
)

446 
	`åršt_msg
("Reading input‡s %s\n",

447 (*
is_d©a
==
VIDEO_H262
?"MPEG-2 (H.262)":

448 *
is_d©a
==
VIDEO_H264
?"MPEG-4/AVC (H.264)":

449 *
is_d©a
==
VIDEO_AVS
 ?"AVS":

454 *
is_d©a
 = 
»ad”
->
video_ty³
;

457 
	}
}

459 
	$İ’_šput_as_ES_dœeù
(*
Çme
,

460 
qu›t
,

461 
fÜû_¡»am_ty³
,

462 
wªt_d©a
,

463 *
is_d©a
,

464 
ES_p
 *
es
)

466 
”r
;

467 
u£_¡dš
 = (
Çme
 =ğ
NULL
);

468 
šput
 = -1;

470 ià(
u£_¡dš
)

472 
šput
 = 
STDIN_FILENO
;

476 
šput
 = 
	`İ’_bš¬y_fe
(
Çme
,
FALSE
);

477 ià(
šput
 == -1)  1;

480 
”r
 = 
	`bud_–em’ry_¡»am_fe
(
šput
,
es
);

481 ià(
”r
)

483 
	`åršt_”r
("### Error buildingƒlementary stream for %s\n",

484 
u£_¡dš
?"<¡dš>":
Çme
);

485 ià(!
u£_¡dš
)

486 (è
	`şo£_fe
(
šput
);

490 ià(!
qu›t
)

491 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
Çme
));

493 ià(
fÜû_¡»am_ty³
 || 
u£_¡dš
)

495 ià(
fÜû_¡»am_ty³
)

496 *
is_d©a
 = 
wªt_d©a
;

498 *
is_d©a
 = 
VIDEO_H262
;

499 ià(!
qu›t
)

500 
	`åršt_msg
("Reading input‡s %s\n",

501 (*
is_d©a
==
VIDEO_H262
?"MPEG-2 (H.262)":

502 *
is_d©a
==
VIDEO_H264
?"MPEG-4/AVC (H.264)":

503 *
is_d©a
==
VIDEO_AVS
 ?"AVS":

508 
video_ty³
;

509 
”r
 = 
	`decide_ES_video_ty³
(*
es
,
FALSE
,FALSE,&
video_ty³
);

510 ià(
”r
)

512 
	`åršt_”r
("### E¼Ü decidšg oÀ¡»amy³ fÜ f%s\n",
Çme
);

513 
	`şo£_–em’ry_¡»am
(
es
);

520 
	`ä“_–em’ry_¡»am
(
es
);

522 
”r
 = 
	`£ek_fe
(
šput
,0);

523 ià(
”r
)

525 
	`´št_”r
("### Error„eturningo start…osition in file‡fter"

527 (è
	`şo£_fe
(
šput
);

531 
”r
 = 
	`bud_–em’ry_¡»am_fe
(
šput
,
es
);

532 ià(
”r
)

534 
	`åršt_”r
("### E¼Ü (»)budšgƒËm’ry sŒ—m fÜ %s\n",
Çme
);

538 *
is_d©a
 = 
video_ty³
;

539 ià(!
qu›t
)

540 
	`åršt_msg
("Input‡ppearso be %s\n",

541 (*
is_d©a
==
VIDEO_H262
?"MPEG-2 (H.262)":

542 *
is_d©a
==
VIDEO_H264
?"MPEG-4/AVC (H.264)":

543 *
is_d©a
==
VIDEO_AVS
?"AVS":

544 *
is_d©a
==
VIDEO_UNKNOWN
?"Unknown":

548 
	}
}

585 
	$İ’_šput_as_ES
(*
Çme
,

586 
u£_³s
,

587 
qu›t
,

588 
fÜû_¡»am_ty³
,

589 
wªt_d©a
,

590 *
is_d©a
,

591 
ES_p
 *
es
)

593 ià(
u£_³s
)

594  
	`İ’_šput_as_ES_usšg_PES
(
Çme
, 
qu›t
, 
fÜû_¡»am_ty³
,

595 
wªt_d©a
, 
is_d©a
, 
es
);

597  
	`İ’_šput_as_ES_dœeù
(
Çme
, 
qu›t
, 
fÜû_¡»am_ty³
,

598 
wªt_d©a
, 
is_d©a
, 
es
);

599 
	}
}

613 
	$şo£_šput_as_ES
(*
Çme
,

614 
ES_p
 *
es
)

616 ià(!(*
es
)->
»adšg_ES
)

618 
”r
 = 
	`şo£_PES_»ad”
(&(*
es
)->
»ad”
);

619 ià(
”r
)

621 
	`åršt_”r
("### E¼Ü closšg PES„—d” fÜ f%s\n",
Çme
);

622 
	`şo£_–em’ry_¡»am
(
es
);

626 
	`şo£_–em’ry_¡»am
(
es
);

628 
	}
}

648 
	$unsigÃd_v®ue
(*
´efix
,

649 *
cmd
,

650 *
¬g
,

651 
ba£
,

652 
ušt32_t
 *
v®ue
)

654 *
±r
;

655 
v®
;

656 
”ºo
 = 0;

657 
v®
 = 
	`¡¹oul
(
¬g
,&
±r
,
ba£
);

658 ià(
”ºo
)

660 
	`´št_”r
("### ");

661 ià(
´efix
 !ğ
NULL
)

662 
	`åršt_”r
("%s: ",
´efix
);

663 ià(
”ºo
 =ğ
ERANGE
 && 
v®
 == 0)

664 
	`åršt_”r
("String cannot be convertedo (long) unsigned integer in %s %s\n",

665 
cmd
,
¬g
);

666 ià(
”ºo
 =ğ
ERANGE
 && (
v®
 =ğ
LONG_MAX
 || v® =ğ
LONG_MIN
))

667 
	`åršt_”r
("Numb” i toØbig (ov”æowsèš % %s\n",
cmd
,
¬g
);

669 
	`åršt_”r
("Cannot„ead‚umber in %s %s (%s)\n",

670 
cmd
,
¬g
,
	`¡»¼Ü
(
”ºo
));

673 ià(
±r
[0] != '\0')

675 
	`´št_”r
("### ");

676 ià(
´efix
 !ğ
NULL
)

677 
	`åršt_”r
("%s: ",
´efix
);

678 ià(
±r
-
¬g
 == 0)

679 
	`åršt_”r
("Argumento %s should be‡‚umber, in %s %s\n",

680 
cmd
,cmd,
¬g
);

682 
	`åršt_”r
("Unexpected characters ('%s')‡fterhe %.*s in %s %s\n",

683 
±r
,

684 ()(
±r
-
¬g
),arg,

685 
cmd
,
¬g
);

689 *
v®ue
 = 
v®
;

691 
	}
}

709 
	$št_v®ue
(*
´efix
,

710 *
cmd
,

711 *
¬g
,

712 
pos™ive
,

713 
ba£
,

714 *
v®ue
)

716 *
±r
;

717 
v®
;

718 
”ºo
 = 0;

719 
v®
 = 
	`¡¹Ş
(
¬g
,&
±r
,
ba£
);

720 ià(
”ºo
)

722 
	`´št_”r
("### ");

723 ià(
´efix
 !ğ
NULL
)

724 
	`åršt_”r
("%s: ",
´efix
);

725 ià(
”ºo
 =ğ
ERANGE
 && 
v®
 == 0)

726 
	`åršt_”r
("String cannot be convertedo (long) integer in %s %s\n",

727 
cmd
,
¬g
);

728 ià(
”ºo
 =ğ
ERANGE
 && (
v®
 =ğ
LONG_MAX
 || v® =ğ
LONG_MIN
))

729 
	`åršt_”r
("Numb” i toØbig (ov”æowsèš % %s\n",
cmd
,
¬g
);

731 
	`åršt_”r
("Cannot„ead‚umber in %s %s (%s)\n",

732 
cmd
,
¬g
,
	`¡»¼Ü
(
”ºo
));

735 ià(
±r
[0] != '\0')

737 
	`´št_”r
("### ");

738 ià(
´efix
 !ğ
NULL
)

739 
	`åršt_”r
("%s: ",
´efix
);

740 ià(
±r
-
¬g
 == 0)

741 
	`åršt_”r
("Argumento %s should be‡‚umber, in %s %s\n",

742 
cmd
,cmd,
¬g
);

744 
	`åršt_”r
("Unexpected characters ('%s')‡fterhe %.*s in %s %s\n",

745 
±r
,

746 ()(
±r
-
¬g
),arg,

747 
cmd
,
¬g
);

751 ià(
v®
 > 
INT_MAX
 || v® < 
INT_MIN
)

753 
	`´št_”r
("### ");

754 ià(
´efix
 !ğ
NULL
)

755 
	`åršt_”r
("%s: ",
´efix
);

756 
	`åršt_”r
("Value %ld (in %s %s) isoo†arge (to fit into 'int')\n",

757 
v®
,
cmd
,
¬g
);

761 ià(
pos™ive
 && 
v®
 < 0)

763 
	`´št_”r
("### ");

764 ià(
´efix
 !ğ
NULL
)

765 
	`åršt_”r
("%s: ",
´efix
);

766 
	`åršt_”r
("Value %ld (in %s %s) is†esshan zero\n",

767 
v®
,
cmd
,
¬g
);

771 *
v®ue
 = 
v®
;

773 
	}
}

792 
	$št_v®ue_š_¿nge
(*
´efix
,

793 *
cmd
,

794 *
¬g
,

795 
mšimum
,

796 
maximum
,

797 
ba£
,

798 *
v®ue
)

800 
”r
, 
‹mp
;

801 
”r
 = 
	`št_v®ue
(
´efix
,
cmd
,
¬g
,(
mšimum
 >ğ0),
ba£
,&
‹mp
);

802 ià(
”r
) ƒrr;

804 ià(
‹mp
 > 
maximum
 ||em°< 
mšimum
)

806 
	`´št_”r
("### ");

807 ià(
´efix
 !ğ
NULL
)

808 
	`åršt_”r
("%s: ",
´efix
);

809 
	`åršt_”r
("Value %d (in %s %s) is‚ot in„ange %d..%d (0x%x..0x%x)\n",

810 
‹mp
,
cmd
,
¬g
,
mšimum
,
maximum
,minimum,maximum);

813 *
v®ue
 = 
‹mp
;

815 
	}
}

831 
	$doubË_v®ue
(*
´efix
,

832 *
cmd
,

833 *
¬g
,

834 
pos™ive
,

835 *
v®ue
)

837 *
±r
;

838 
v®
;

839 
”ºo
 = 0;

840 
v®
 = 
	`¡¹od
(
¬g
,&
±r
);

841 ià(
”ºo
)

843 
	`´št_”r
("### ");

844 ià(
´efix
 !ğ
NULL
)

845 
	`åršt_”r
("%s: ",
´efix
);

846 ià(
”ºo
 =ğ
ERANGE
 && 
v®
 == 0)

847 
	`åršt_”r
("String cannot be convertedo (double) float in %s %s\n",

848 
cmd
,
¬g
);

849 ià(
”ºo
 =ğ
ERANGE
 && (
v®
 =ğ
HUGE_VAL
 || val == -HUGE_VAL))

850 
	`åršt_”r
("Numb” i toØbig (ov”æowsèš % %s\n",
cmd
,
¬g
);

852 
	`åršt_”r
("Cannot„ead‚umber in %s %s (%s)\n",

853 
cmd
,
¬g
,
	`¡»¼Ü
(
”ºo
));

856 ià(
±r
[0] != '\0')

858 
	`´št_”r
("### ");

859 ià(
´efix
 !ğ
NULL
)

860 
	`åršt_”r
("%s: ",
´efix
);

861 
	`åršt_”r
("Unexpected characters ('%s')‡fterhe %.*s in %s %s\n",

862 
±r
,

863 ()(
±r
-
¬g
),arg,

864 
cmd
,
¬g
);

868 ià(
pos™ive
 && 
v®
 < 0)

870 
	`´št_”r
("### ");

871 ià(
´efix
 !ğ
NULL
)

872 
	`åršt_”r
("%s: ",
´efix
);

873 
	`åršt_”r
("Value %f (in %s %s) is†esshan zero\n",

874 
v®
,
cmd
,
¬g
);

878 *
v®ue
 = 
v®
;

880 
	}
}

904 
	$ho¡_v®ue
(*
´efix
,

905 *
cmd
,

906 *
¬g
,

907 **
ho¡Çme
,

908 *
pÜt
)

910 *
p
 = 
	`¡rchr
(
¬g
,':');

912 *
ho¡Çme
 = 
¬g
;

914 ià(
p
 !ğ
NULL
)

916 *
±r
;

917 
p
[0] = '\0';

918 
”ºo
 = 0;

919 *
pÜt
 = 
	`¡¹Ş
(
p
+1,&
±r
,10);

920 ià(
”ºo
)

922 
p
[0] = ':';

923 
	`´št_”r
("### ");

924 ià(
´efix
 !ğ
NULL
)

925 
	`åršt_”r
("%s: ",
´efix
);

926 ià(
cmd
)

927 
	`åršt_”r
("Cannot„ead…ort‚umber in %s %s (%s)\n",

928 
cmd
,
¬g
,
	`¡»¼Ü
(
”ºo
));

930 
	`åršt_”r
("Cannot„ead…ort‚umber in %s (%s)\n",

931 
¬g
,
	`¡»¼Ü
(
”ºo
));

934 ià(
±r
[0] != '\0')

936 
p
[0] = ':';

937 
	`´št_”r
("### ");

938 ià(
´efix
 !ğ
NULL
)

939 
	`åršt_”r
("%s: ",
´efix
);

940 ià(
cmd
)

941 
	`åršt_”r
("Unexpected characters in…ort‚umber in %s %s\n",

942 
cmd
,
¬g
);

944 
	`åršt_”r
("UÃx³ùed ch¬aù” š…Üˆnumb” iÀ%s\n",
¬g
);

947 ià(*
pÜt
 < 0)

949 
p
[0] = ':';

950 
	`´št_”r
("### ");

951 ià(
´efix
 !ğ
NULL
)

952 
	`åršt_”r
("%s: ",
´efix
);

953 ià(
cmd
)

954 
	`åršt_”r
("Neg©ivpÜˆnumb” iÀ% %s\n",
cmd
,
¬g
);

956 
	`åršt_”r
("Neg©ivpÜˆnumb” iÀ%s\n",
¬g
);

961 
	}
}

963 #ifdeà
_WIN32


976 
	$wšsock_¡¬tup
()

980 
WORD
 
wV”siÚReque¡ed
;

981 
WSADATA
 
w§D©a
;

982 
”r
;

984 
wV”siÚReque¡ed
 = 
	`MAKEWORD
(2,2);

986 
”r
 = 
	`WSAS¹up
(
wV”siÚReque¡ed
,&
w§D©a
);

987 ià(
”r
 != 0)

990 
	`´št_”r
("### Unableo find‡ usable WinSock DLL\n");

998 ià(
	`LOBYTE
(
w§D©a
.
wV”siÚ
è!ğ2 || 
	`HIBYTE
(wsaData.wVersion) != 2 )

1000 
	`åršt_”r
("### WinSock DLL was version %d.%d,‚ot 2.2 or more\n",

1001 
	`LOBYTE
(
w§D©a
.
wV”siÚ
),
	`HIBYTE
(wsaData.wVersion));

1002 
	`WSACËªup
();

1006 
	}
}

1011 
	$´št_wšsock_”r
(
”r
)

1013 
”r
)

1015 
WSABASEERR
:

1016 
	`´št_”r
("(WSABASEERR) No Error");

1019 
WSAEINTR
:

1020 
	`´št_”r
("(WSAEINTR) Interrupted system call");

1023 
WSAEBADF
:

1024 
	`´št_”r
("(WSAEBADF) Bad file‚umber");

1027 
WSAEACCES
:

1028 
	`´št_”r
("(WSAEACCES) Permission denied");

1031 
WSAEFAULT
:

1032 
	`´št_”r
("(WSAEFAULT) Bad‡ddress");

1035 
WSAEINVAL
:

1036 
	`´št_”r
("(WSAEINVAL) Invalid‡rgument");

1039 
WSAEMFILE
:

1040 
	`´št_”r
("(WSAEMFILE) Too many open files");

1043 
WSAEWOULDBLOCK
:

1044 
	`´št_”r
("(WSAEWOULDBLOCK) Operation would block");

1047 
WSAEINPROGRESS
:

1048 
	`´št_”r
("(WSAEINPROGRESS) Aransaction is still in…rogress");

1051 
WSAEALREADY
:

1052 
	`´št_”r
("(WSAEALREADY) Operation‡lready in…rogress");

1055 
WSAENOTSOCK
:

1056 
	`´št_”r
("(WSAENOTSOCK) Socket operation on‚on-socket");

1059 
WSAEDESTADDRREQ
:

1060 
	`´št_”r
("(WSAEDESTADDRREQ) Destination‡ddress„equired");

1063 
WSAEMSGSIZE
:

1064 
	`´št_”r
("(WSAEMSGSIZE) Messageoo†ong");

1067 
WSAEPROTOTYPE
:

1068 
	`´št_”r
("(WSAEPROTOTYPE) Protocol wrongype for socket");

1071 
WSAENOPROTOOPT
:

1072 
	`´št_”r
("(WSAENOPROTOOPT) Bad…rotocol option");

1075 
WSAEPROTONOSUPPORT
:

1076 
	`´št_”r
("(WSAEPROTONOSUPPORT) Protocol‚ot supported");

1079 
WSAESOCKTNOSUPPORT
:

1080 
	`´št_”r
("(WSAESOCKTNOSUPPORT) Socketype‚ot supported");

1083 
WSAEOPNOTSUPP
:

1084 
	`´št_”r
("(WSAEOPNOTSUPP) Operation‚ot supported on socket");

1087 
WSAEPFNOSUPPORT
:

1088 
	`´št_”r
("(WSAEPFNOSUPPORT) Protocol family‚ot supported");

1091 
WSAEAFNOSUPPORT
:

1092 
	`´št_”r
("(WSAEAFNOSUPPORT) Address family‚ot supported by…rotocol family");

1095 
WSAEADDRINUSE
:

1096 
	`´št_”r
("(WSAEADDRINUSE) Address‡lready in use");

1099 
WSAEADDRNOTAVAIL
:

1100 
	`´št_”r
("(WSAEADDRNOTAVAIL) Can't‡ssign„equested‡ddress");

1103 
WSAENETDOWN
:

1104 
	`´št_”r
("(WSAENETDOWN) Network is down");

1107 
WSAENETUNREACH
:

1108 
	`´št_”r
("(WSAENETUNREACH) Network is unreachable");

1111 
WSAENETRESET
:

1112 
	`´št_”r
("(WSAENETRESET) Net dropped connection or„eset");

1115 
WSAECONNABORTED
:

1116 
	`´št_”r
("(WSAECONNABORTED) Software caused connection‡bort");

1119 
WSAECONNRESET
:

1120 
	`´št_”r
("(WSAECONNRESET) Connection„eset by…eer");

1123 
WSAENOBUFS
:

1124 
	`´št_”r
("(WSAENOBUFS) No buffer space‡vailable");

1127 
WSAEISCONN
:

1128 
	`´št_”r
("(WSAEISCONN) Socket is‡lready connected");

1131 
WSAENOTCONN
:

1132 
	`´št_”r
("(WSAENOTCONN) Socket is‚ot connected");

1135 
WSAESHUTDOWN
:

1136 
	`´št_”r
("(WSAESHUTDOWN) Can't send‡fter socket shutdown");

1139 
WSAETOOMANYREFS
:

1140 
	`´št_”r
("(WSAETOOMANYREFS) Too many„eferences, can't splice");

1143 
WSAETIMEDOUT
:

1144 
	`´št_”r
("(WSAETIMEDOUT) Connectionimed out");

1147 
WSAECONNREFUSED
:

1148 
	`´št_”r
("(WSAECONNREFUSED) Connection„efused");

1151 
WSAELOOP
:

1152 
	`´št_”r
("(WSAELOOP) Too many†evels of symbolic†inks");

1155 
WSAENAMETOOLONG
:

1156 
	`´št_”r
("(WSAENAMETOOLONG) File‚ameoo†ong");

1159 
WSAEHOSTDOWN
:

1160 
	`´št_”r
("(WSAEHOSTDOWN) Host is down");

1163 
WSAEHOSTUNREACH
:

1164 
	`´št_”r
("(WSAEHOSTUNREACH) No Routeo Host");

1167 
WSAENOTEMPTY
:

1168 
	`´št_”r
("(WSAENOTEMPTY) Directory‚otƒmpty");

1171 
WSAEPROCLIM
:

1172 
	`´št_”r
("(WSAEPROCLIM) Too many…rocesses");

1175 
WSAEUSERS
:

1176 
	`´št_”r
("(WSAEUSERS) Too many users");

1179 
WSAEDQUOT
:

1180 
	`´št_”r
("(WSAEDQUOT) Disc Quota Exceeded");

1183 
WSAESTALE
:

1184 
	`´št_”r
("(WSAESTALE) Stale NFS file handle");

1187 
WSASYSNOTREADY
:

1188 
	`´št_”r
("(WSASYSNOTREADY) Network SubSystem is unavailable");

1191 
WSAVERNOTSUPPORTED
:

1192 
	`´št_”r
("(WSAVERNOTSUPPORTED) WINSOCK DLL Version out of„ange");

1195 
WSANOTINITIALISED
:

1196 
	`´št_”r
("(WSANOTINITIALISED) Successful WSASTARTUP‚ot yet…erformed");

1199 
WSAEREMOTE
:

1200 
	`´št_”r
("(WSAEREMOTE) Too many†evels of„emote in…ath");

1203 
WSAHOST_NOT_FOUND
:

1204 
	`´št_”r
("(WSAHOST_NOT_FOUND) Host‚ot found");

1207 
WSATRY_AGAIN
:

1208 
	`´št_”r
("(WSATRY_AGAIN) Non-Authoritative Host‚ot found");

1211 
WSANO_RECOVERY
:

1212 
	`´št_”r
("(WSANO_RECOVERY) Non-Recoverableƒrrors: FORMERR, REFUSED, NOTIMP");

1215 
WSANO_DATA
:

1216 
	`´št_”r
("(WSANO_DATA) Valid‚ame,‚o data„ecord of„equestedype");

1220 
	`åršt_”r
("wšsockƒ¼Ü %d",
”r
);

1223 
	}
}

1230 
	$wšsock_ş—nup
()

1232 
”r
 = 
	`WSACËªup
();

1233 ià(
”r
 != 0)

1235 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1236 
	`´št_”r
("### Error cleaning up WinSock: ");

1237 
	`´št_wšsock_”r
(
”r
);

1238 
	`´št_”r
("\n");

1242 
	}
}

1271 
	$cÚÃù_sock‘
(*
ho¡Çme
,

1272 
pÜt
,

1273 
u£_tı
,

1274 *
muÉiÿ¡_içddr
)

1276 #ifdeà
_WIN32


1277 
SOCKET
 
ouut
;

1279 
ouut
;

1281 
»suÉ
;

1282 
ho¡’t
 *
hp
;

1283 
sockaddr_š
 
addr
;

1285 #ifdeà
_WIN32


1286 
”r
 = 
	`wšsock_¡¬tup
();

1287 ià(
”r
)  1;

1290 
ouut
 = 
	`sock‘
(
AF_INET
, (
u£_tı
?
SOCK_STREAM
:
SOCK_DGRAM
), 0);

1291 #ifdeà
_WIN32


1292 ià(
ouut
 =ğ
INVALID_SOCKET
)

1294 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1295 
	`´št_”r
("### Unableo create socket: ");

1296 
	`´št_wšsock_”r
(
”r
);

1297 
	`´št_”r
("\n");

1301 ià(
ouut
 == -1)

1303 
	`åršt_”r
("### UÇbËØü—‹ sock‘: %s\n",
	`¡»¼Ü
(
”ºo
));

1308 #ià
_WIN32


1313 
addr
 = 
	`š‘_addr
(
ho¡Çme
);

1314 ià(
addr
 !ğ
INADDR_NONE
)

1316 
addr
.
sš_addr
.
s_addr
 = 
addr
;

1317 
addr
.
sš_çmy
 = 
AF_INET
;

1321 
hp
 = 
	`g‘ho¡byÇme
(
ho¡Çme
);

1322 ià(
hp
 =ğ
NULL
)

1324 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1325 
	`åršt_”r
("### UÇbËØ»sŞvho¡ %s: ",
ho¡Çme
);

1326 
	`´št_wšsock_”r
(
”r
);

1327 
	`´št_”r
("\n");

1330 
	`memıy
(&
addr
.
sš_addr
.
s_addr
, 
hp
->
h_addr
, hp->
h_Ëngth
);

1331 
addr
.
sš_çmy
 = 
hp
->
h_add¹y³
;

1334 
addr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

1336 
hp
 = 
	`g‘ho¡byÇme
(
ho¡Çme
);

1337 ià(
hp
 =ğ
NULL
)

1339 
	`åršt_”r
("### Unableo„esolve host %s: %s\n",

1340 
ho¡Çme
,
	`h¡»¼Ü
(
h_”ºo
));

1343 
	`memıy
(&
addr
.
sš_addr
.
s_addr
, 
hp
->
h_addr
, hp->
h_Ëngth
);

1344 
addr
.
sš_çmy
 = 
hp
->
h_add¹y³
;

1345 #ià!
	`defšed
(
__lšux__
)

1347 
addr
.
sš_Ën
 = (
sockaddr_š
);

1349 
addr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

1352 ià(
	`IN_CLASSD
(
	`Áohl
(
addr
.
sš_addr
.
s_addr
)))

1355 
by‹
 
‰l
 = 16;

1356 
»suÉ
 = 
	`£tsockİt
(
ouut
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
,

1357 (*)&
‰l
, (ttl));

1358 #ifdeà
_WIN32


1359 ià(
»suÉ
 =ğ
SOCKET_ERROR
)

1361 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1362 
	`´št_”r
("### Error setting socket for IP_MULTICAST_TTL: ");

1363 
	`´št_wšsock_”r
(
”r
);

1364 
	`´št_”r
("\n");

1368 ià(
»suÉ
 < 0)

1370 
	`åršt_”r
("### Error setting socket for IP_MULTICAST_TTL: %s\n",

1371 
	`¡»¼Ü
(
”ºo
));

1376 ià(
muÉiÿ¡_içddr
)

1378 #ifdeà
_WIN32


1379 
addr
;

1380 
	`´št_”r
("!!! Specifyinghe multicast interface is‚ot supported on "

1383 
addr
 = 
	`š‘_addr
(
muÉiÿ¡_içddr
);

1384 ià(
addr
 =ğ
INADDR_NONE
)

1386 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1387 
	`åršt_”r
("### Errorranslating '%s'‡s‡ dotted IP‡ddress: ",

1388 
muÉiÿ¡_içddr
);

1389 
	`´št_wšsock_”r
(
”r
);

1390 
	`´št_”r
("\n");

1394 
š_addr
 
addr
;

1395 
	`š‘_©Ú
(
muÉiÿ¡_içddr
, &
addr
);

1397 
»suÉ
 = 
	`£tsockİt
(
ouut
,
IPPROTO_IP
,
IP_MULTICAST_IF
,

1398 (*)&
addr
,(addr));

1399 #ifdeà
_WIN32


1400 ià(
»suÉ
 =ğ
SOCKET_ERROR
)

1402 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1403 
	`åršt_”r
("### Unableo set multicast interface %s: ");

1404 
	`´št_wšsock_”r
(
”r
);

1405 
	`´št_”r
("\n");

1409 ià(
»suÉ
 < 0)

1411 
	`åršt_”r
("### Unableo set multicast interface %s: %s\n",

1412 
muÉiÿ¡_içddr
,
	`¡»¼Ü
(
”ºo
));

1419 
»suÉ
 = 
	`cÚÃù
(
ouut
,(
sockaddr
*)&
addr
,(ipaddr));

1420 #ifdeà
_WIN32


1421 ià(
»suÉ
 =ğ
SOCKET_ERROR
)

1423 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1424 
	`åršt_”r
("### UÇbËØcÚÃùØho¡ %s: ",
ho¡Çme
);

1425 
	`´št_wšsock_”r
(
”r
);

1426 
	`´št_”r
("\n");

1430 ià(
»suÉ
 < 0)

1432 
	`åršt_”r
("### Unableo connecto host %s: %s\n",

1433 
ho¡Çme
,
	`¡»¼Ü
(
”ºo
));

1437  
ouut
;

1438 
	}
}

1445 #ifdeà
_WIN32


1446 
	$discÚÃù_sock‘
(
SOCKET
 
sock‘
)

1448 
”r
 = 
	`şo£sock‘
(
sock‘
);

1449 ià(
”r
 != 0)

1451 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1452 
	`´št_”r
("### Error closing output: ");

1453 
	`´št_wšsock_”r
(
”r
);

1454 
	`´št_”r
("\n");

1458 
”r
 = 
	`wšsock_ş—nup
();

1459 ià(
”r
)  1;

1461 
	}
}

1463 
	$discÚÃù_sock‘
(
sock‘
)

1465 
”r
 = 
	`şo£
(
sock‘
);

1466 ià(
”r
 =ğ
EOF
)

1468 
	`åršt_”r
("### E¼Ü closšg ouut: %s\n",
	`¡»¼Ü
(
”ºo
));

1472 
	}
}

1475 cÚ¡ *
	$v4_addr_to_¡ršg
(cÚ¡ 
ušt32_t
 
addr
)

1477 
buf
[64];

1479 
	`¢´štf
(
buf
, (buf), "%d.%d.%d.%d",

1480 (
addr
 >> 24)&0xff,

1481 (
addr
 >> 16)&0xff,

1482 (
addr
 >> 8)&0xff,

1483 (
addr
 & 0xff));

1484  
buf
;

1485 
	}
}

1487 
	$v4_¡ršg_to_addr
(
ušt32_t
 *
de¡
, cÚ¡ *
¡ršg
)

1489 *
¡r_ıy
 = 
	`¡rdup
(
¡ršg
);

1490 
rv
 =0;

1491 *
p
, *
p2
;

1492 
v®
;

1493 
Ä
;

1494 
ušt32_t
 
out
 = 0;

1496 
Ä
 = 0,
p
 = 
¡r_ıy
;‚¸< 4 && *p;… = 
p2
+1, ++nr)

1498 *
px
 = 
NULL
;

1499 
p2
 = 
	`¡rchr
(
p
, '.');

1500 ià(
p2
)

1502 *
p2
 = '\0';

1504 
v®
 = 
	`¡¹oul
(
p
, &
px
, 0);

1505 ià(
px
 && *px)

1509 
out
 |ğ(
v®
 << ((3-
Ä
)<<3));

1512 (*
de¡
èğ
out
;

1513 
	`ä“
(
¡r_ıy
);

1514  
rv
;

1516 
	}
}

	@misc_defns.h

29 #iâdeà
_misc_deâs


30 
	#_misc_deâs


	)

32 
	~"tswr™e_deâs.h
"

33 
	~"video_deâs.h
"

38 
	u_wr™”


40 
FILE
 *
	mes_ouut
;

41 
TS_wr™”_p
 
	mts_ouut
;

43 
_wr™”
 
	tWRITER
;

48 
	#CHECKARG
(
´og¿m
,
¬gno
) \

49 ià((
¬gno
)+1 =ğ
¬gc
) \

51 
	`årštf
(
¡d”r
,"### %s: missšg‡rgum’ˆtØ%s\n",
´og¿m
,
¬gv
[(
¬gno
)]); \

53 }

	)

56 
	#ON
(
byt
,
msk
è((byˆ& msk)?1:0)

	)

	@misc_fns.h

28 #iâdeà
_misc_âs


29 
	#_misc_âs


	)

31 
	~"misc_deâs.h
"

32 
	~"es_deâs.h
"

33 #iâdeà
_WIN32


34 
	~<¡dšt.h
>

37 #ifdeà
_WIN32


38 
	~"com·t.h
"

39 
	~<wšsock2.h
>

42 
	#CRC32_POLY
 0x04c11db7L

	)

53 
ušt32_t
 
üc32_block
(ušt32_ˆ
üc
, 
by‹
 *
pD©a
, 
blk_Ën
);

58 
´št_b™s
(
num_b™s
,

59 
by‹
 
v®ue
);

77 
´št_d©a
(
is_msg
,

78 cÚ¡ *
Çme
,

79 cÚ¡ 
by‹
 
d©a
[],

80 
Ëngth
,

81 
max
);

97 
´št_’d_of_d©a
(*
Çme
,

98 
by‹
 
d©a
[],

99 
Ëngth
,

100 
max
);

104 
log2
(
x
);

124 
»ad_by‹s
(
šput
,

125 
num_by‹s
,

126 
by‹
 *
d©a
);

142 
£ek_fe
(
fedes
,

143 
off£t_t
 
po¢
);

157 
off£t_t
 
‹Î_fe
(
fedes
);

174 
İ’_bš¬y_fe
(*
f’ame
,

175 
fÜ_wr™e
);

181 
şo£_fe
(
fedes
);

221 
İ’_šput_as_ES
(*
Çme
,

222 
u£_³s
,

223 
qu›t
,

224 
fÜû_¡»am_ty³
,

225 
wªt_d©a
,

226 *
is_d©a
,

227 
ES_p
 *
es
);

240 
şo£_šput_as_ES
(*
Çme
,

241 
ES_p
 *
es
);

262 
unsigÃd_v®ue
(*
´efix
,

263 *
cmd
,

264 *
¬g
,

265 
ba£
,

266 
ušt32_t
 *
v®ue
);

283 
št_v®ue
(*
´efix
,

284 *
cmd
,

285 *
¡r
,

286 
pos™ive
,

287 
ba£
,

288 *
v®ue
);

306 
št_v®ue_š_¿nge
(*
´efix
,

307 *
cmd
,

308 *
¬g
,

309 
mšimum
,

310 
maximum
,

311 
ba£
,

312 *
v®ue
);

327 
doubË_v®ue
(*
´efix
,

328 *
cmd
,

329 *
¬g
,

330 
pos™ive
,

331 *
v®ue
);

353 
ho¡_v®ue
(*
´efix
,

354 *
cmd
,

355 *
¬g
,

356 **
ho¡Çme
,

357 *
pÜt
);

365 #ifdeà
_WIN32


374 
wšsock_¡¬tup
();

378 
´št_wšsock_”r
(
”r
);

399 
cÚÃù_sock‘
(*
ho¡Çme
,

400 
pÜt
,

401 
u£_tı
,

402 *
muÉiÿ¡_içddr
);

409 #ifdeà
_WIN32


410 
discÚÃù_sock‘
(
SOCKET
 
sock‘
);

412 
discÚÃù_sock‘
(
sock‘
);

416 cÚ¡ *
v4_addr_to_¡ršg
(cÚ¡ 
ušt32_t
 
addr
);

419 
v4_¡ršg_to_addr
(
ušt32_t
 *
de¡
, cÚ¡ *
addr
);

427 
šlše
 
ušt32_t
 
	$ušt_32_be
(cÚ¡ 
ušt8_t
 *cÚ¡ 
p
)

429  ((()
p
[0]&0xff) << 24) |

430 ((()
p
[1]&0xff) << 16) |

431 ((()
p
[2]&0xff) << 8) |

432 ((()
p
[3]&0xff));

433 
	}
}

436 
šlše
 
ušt32_t
 
	$ušt_32_Ë
(cÚ¡ 
ušt8_t
 *cÚ¡ 
p
)

438  ((()
p
[0]&0xff) |

439 ((()
p
[1]&0xff) << 8) |

440 ((()
p
[2]&0xff) << 16) |

441 ((()
p
[3]&0xff) << 24));

442 
	}
}

445 
šlše
 
ušt16_t
 
	$ušt_16_be
(cÚ¡ 
ušt8_t
 *cÚ¡ 
p
)

447  (((()
p
[0])&0xff)<<8) |

448 (((()
p
[1])&0xff));

449 
	}
}

451 
šlše
 
ušt16_t
 
	$ušt_16_Ë
(cÚ¡ 
ušt8_t
 *cÚ¡ 
p
)

453  ((()
p
[0]&0xff) |

454 (()
p
[1]&0xff)<<8);

455 
	}
}

462 
	#PCR_UNSIGNED_WRAP
 (300ULL * (1ULL << 33))

	)

465 
šlše
 
ušt64_t


466 
	$pü_unsigÃd_diff
(
ušt64_t
 
x
, ušt64_ˆ
y
)

468  
x
 > 
y
 ? x - y :

469 300ULL * (1ULL << 33è- (
y
 - 
x
);

470 
	}
}

472 
	#PCR_SIGNED_WRAP
 (300LL * (1LL << 33))

	)

473 
	#PCR_SIGNED_MAX
 (
PCR_SIGNED_WRAP
 / 2LL - 1LL)

	)

474 
	#PCR_SIGNED_MIN
 (-
PCR_SIGNED_WRAP
 / 2LL)

	)

477 
šlše
 
št64_t


478 
	$pü_sigÃd_diff
(
ušt64_t
 
x
, ušt64_ˆ
y
)

480 
št64_t
 
r
 = 
x
 - 
y
;

482  
r
 < 
PCR_SIGNED_MIN
 ?„ + 
PCR_SIGNED_WRAP
 :

483 
r
 > 
PCR_SIGNED_MAX
 ?„ - 
PCR_SIGNED_WRAP
 :

484 
r
;

485 
	}
}

488 
šlše
 
ušt64_t


489 
	$pü_unsigÃd_w¿p
(
ušt64_t
 
x
)

491  
x
 >ğ
PCR_UNSIGNED_WRAP
 ? x - PCR_UNSIGNED_WRAP : x;

492 
	}
}

494 
šlše
 
št64_t


495 
	$±s_sigÃd_diff
(
ušt64_t
 
x
, ušt64_ˆ
y
)

497 
št64_t
 
r
 = 
x
 - 
y
;

498  (
r
 << 31) >> 31;

499 
	}
}

	@nalunit.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<m©h.h
>

33 
	~<”ºo.h
>

34 #ifdeà
_WIN32


35 
	~<io.h
>

37 
	~<uni¡d.h
>

40 
	~"com·t.h
"

41 
	~"´štšg_âs.h
"

42 
	~"es_âs.h
"

43 
	~"ts_âs.h
"

44 
	~"b™d©a_âs.h
"

45 
	~"Çlun™_âs.h
"

46 
	~"misc_âs.h
"

47 
	~"´štšg_âs.h
"

49 
	#DEBUG
 0

	)

51 
	#REPORT_NAL_SHOWS_ADDRESS
 0

	)

56 
	$£t_show_Çl_»adšg_d‘as
(
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
,

57 
show
)

59 
cÚ‹xt
->
show_Çl_d‘as
 = 
show
;

61 
	}
}

71 
	$bud_Çl_un™_cÚ‹xt
(
ES_p
 
es
,

72 
Çl_un™_cÚ‹xt_p
 *
cÚ‹xt
)

74 
”r
;

75 
Çl_un™_cÚ‹xt_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_NAL_UNIT_CONTEXT
);

76 ià(
Ãw
 =ğ
NULL
)

78 
	`´št_”r
("### Unableo‡llocate NAL unit context datastructure\n");

81 
Ãw
->
es
 =ƒs;

82 
Ãw
->
couÁ
 = 0;

83 
Ãw
->
show_Çl_d‘as
 = 
FALSE
;

84 
”r
 = 
	`bud_·¿m_diù
(&
Ãw
->
£q_·¿m_diù
);

85 ià(
”r
)

87 
	`ä“
(
Ãw
);

88  
”r
;

90 
”r
 = 
	`bud_·¿m_diù
(&
Ãw
->
pic_·¿m_diù
);

91 ià(
”r
)

93 
	`ä“_·¿m_diù
(&
Ãw
->
£q_·¿m_diù
);

94 
	`ä“
(
Ãw
);

95  
”r
;

97 *
cÚ‹xt
 = 
Ãw
;

99 
	}
}

108 
	$ä“_Çl_un™_cÚ‹xt
(
Çl_un™_cÚ‹xt_p
 *
cÚ‹xt
)

110 
Çl_un™_cÚ‹xt_p
 
cc
 = *
cÚ‹xt
;

112 ià(
cc
 =ğ
NULL
)

115 
	`ä“_·¿m_diù
(&
cc
->
£q_·¿m_diù
);

116 
	`ä“_·¿m_diù
(&
cc
->
pic_·¿m_diù
);

118 
	`ä“
(*
cÚ‹xt
);

119 *
cÚ‹xt
 = 
NULL
;

121 
	}
}

134 
	$»wšd_Çl_un™_cÚ‹xt
(
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
)

136 
ES_off£t
 
¡¬t_of_fe
 = {0,0};

137  
	`£ek_ES
(
cÚ‹xt
->
es
,
¡¬t_of_fe
);

138 
	}
}

148 
	$bud_Çl_un™
(
Çl_un™_p
 *
Çl
)

150 
”r
;

151 
Çl_un™_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_NAL_UNIT
);

152 ià(
Ãw
 =ğ
NULL
)

154 
	`´št_”r
("### Unableo‡llocate NAL unit datastructure\n");

158 
”r
 = 
	`£tup_ES_un™
(&(
Ãw
->
un™
));

159 ià(
”r
)

161 
	`´št_”r
("### Unableo‡llocate NAL unit data buffer\n");

162 
	`ä“
(
Ãw
);

167 
Ãw
->
d©a
 = 
NULL
;

168 
Ãw
->
d©a_Ën
 = 0;

169 
Ãw
->
rb¥
 = 
NULL
;

170 
Ãw
->
rb¥_Ën
 = 0;

171 
Ãw
->
b™_d©a
 = 
NULL
;

173 
Ãw
->
Çl_un™_ty³
 = 
NAL_UNSPECIFIED
;

175 
Ãw
->
¡¬ts_piùu»_decided
 = 
FALSE
;

176 
Ãw
->
¡¬ts_piùu»
 = 
FALSE
;

177 
Ãw
->
¡¬t_»asÚ
 = 
NULL
;

178 
Ãw
->
decoded
 = 
FALSE
;

180 *
Çl
 = 
Ãw
;

182 
	}
}

187 
šlše
 
	$ş—r_Çl_un™
(
Çl_un™_p
 
Çl
)

189 
	`ş—r_ES_un™
(&(
Çl
->
un™
));

190 
Çl
->
d©a
 = 
NULL
;

191 
Çl
->
d©a_Ën
 = 0;

192 ià(
Çl
->
rb¥
 !ğ
NULL
)

194 
	`ä“
(
Çl
->
rb¥
);

195 
Çl
->
rb¥_Ën
 = 0;

197 
	`ä“_b™d©a
(&
Çl
->
b™_d©a
);

198 
	}
}

207 
	$ä“_Çl_un™
(
Çl_un™_p
 *
Çl
)

209 ià(*
Çl
 =ğ
NULL
)

211 
	`ş—r_Çl_un™
(*
Çl
);

212 
	`ä“
(*
Çl
);

213 *
Çl
 = 
NULL
;

214 
	}
}

237 
	$»move_emuÏtiÚ_´ev’tiÚ
(
by‹
 
d©a
[],

238 
d©a_Ën
,

239 
by‹
 *
rb¥
[],

240 *
rb¥_Ën
)

242 
ii
;

243 
po¢
 = 0;

244 
by‹
 
´ev1
 = 27;

245 
by‹
 
´ev2
 = 27;

246 
by‹
 *
tgt
 = 
NULL
;

249 
tgt
 = 
	`m®loc
(
d©a_Ën
);

250 ià(
tgt
 =ğ
NULL
)

252 
	`´št_”r
("### Cannot malloc RBSParget‡rray\n");

256 
ii
=1; ii<
d©a_Ën
; ii++)

258 ià(
´ev2
 =ğ0x00 && 
´ev1
 =ğ0x00 && 
d©a
[
ii
] == 0x03)

261 
tgt
[
po¢
++] = 
d©a
[
ii
];

262 
´ev2
 = 
´ev1
;

263 
´ev1
 = 
d©a
[
ii
];

265 *
rb¥
 = 
tgt
;

266 *
rb¥_Ën
 = 
po¢
;

268 
	}
}

277 
šlše
 
	$´•¬e_rb¥
(
Çl_un™_p
 
Çl
)

279 
”r
;

280 
b™d©a_p
 
bd
=
NULL
;

282 ià(
Çl
->
b™_d©a
 !ğ
NULL
)

289 ià(
Çl
->
rb¥
 =ğ
NULL
)

291 
”r
 = 
	`»move_emuÏtiÚ_´ev’tiÚ
(
Çl
->
d©a
,Çl->
d©a_Ën
,

292 &(
Çl
->
rb¥
),&Ò®->
rb¥_Ën
));

293 ià(
”r
)

295 
	`´št_”r
("### Error„emovingƒmulation…revention bytes\n");

300 
”r
 = 
	`bud_b™d©a
(&
bd
,
Çl
->
rb¥
,Çl->
rb¥_Ën
);

301 ià(
”r
)

303 
	`´št_”r
("### Unableo build bitdata datastructure for NAL RBSP\n");

306 
Çl
->
b™_d©a
 = 
bd
;

308 
	}
}

323 
	$»ad_¦iû_d©a
(
Çl_un™_p
 
Çl
,

324 
·¿m_diù_p
 
£q_·¿m_diù
,

325 
·¿m_diù_p
 
pic_·¿m_diù
,

326 
show_Çl_d‘as
)

328 
”r
;

329 
b™d©a_p
 
bd
 = 
Çl
->
b™_d©a
;

330 
ušt32_t
 
‹mp
;

331 
Çl_¦iû_d©a_p
 
d©a
 = &(
Çl
->
u
.
¦iû
);

332 
Çl_£q_·¿m_d©a_p
 
£q_·¿m_d©a
 = 
NULL
;

333 
Çl_pic_·¿m_d©a_p
 
pic_·¿m_d©a
 = 
NULL
;

335 
	#CHECK
(
Çme
) \

336 ià(
”r
) \

338 
	`åršt_”r
("### E¼Ü„—dšg % f›ld from sliû d©a\n",(
Çme
)); \

339 }

	)

341 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
fœ¡_mb_š_¦iû
);

342 
	`CHECK
("first_mb_in_slice");

343 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
¦iû_ty³
);

344 
	`CHECK
("slice_type");

345 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
‹mp
);

346 
	`CHECK
("pic_parameter_set_id");

347 
d©a
->
pic_·¿m‘”_£t_id
 = 
‹mp
;

349 ià(
show_Çl_d‘as
)

351 
	`åršt_msg
("@@ NAL " 
OFFSET_T_FORMAT_08
 "/%04d: size %d\n"

353 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,Çl->un™.¡¬t_po¢.
š·ck‘
,

354 
Çl
->
d©a_Ën
,

355 
Çl
->
Çl_»f_idc
,Çl->
Çl_un™_ty³
,

356 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
));

357 
	`åršt_msg
(" first_mb_in_slice %u, slice_type %u (%s),"

358 "…ic_·¿m‘”_£t_id %d\n",
d©a
->
fœ¡_mb_š_¦iû
,

359 
d©a
->
¦iû_ty³
,
	`NAL_SLICE_TYPE_STR
(data->slice_type),

360 
d©a
->
pic_·¿m‘”_£t_id
);

365 ià(
£q_·¿m_diù
 =ğ
NULL
 || 
pic_·¿m_diù
 == NULL)

372 
”r
 = 
	`g‘_pic_·¿m_d©a
(
pic_·¿m_diù
,
d©a
->
pic_·¿m‘”_£t_id
,

373 &
pic_·¿m_d©a
);

374 ià(
”r
)  1;

375 
”r
 = 
	`g‘_£q_·¿m_d©a
(
£q_·¿m_diù
,
pic_·¿m_d©a
->
£q_·¿m‘”_£t_id
,

376 &
£q_·¿m_d©a
);

377 ià(
”r
)  1;

382 
d©a
->
£q_·¿m_£t_pic_Üd”_út_ty³
 = 
£q_·¿m_d©a
->
pic_Üd”_út_ty³
;

384 ià(
show_Çl_d‘as
)

385 
	`åršt_msg
(" seq_param_set->pic_order_cnt_type %u\n",

386 
d©a
->
£q_·¿m_£t_pic_Üd”_út_ty³
);

388 
”r
 = 
	`»ad_b™s
(
bd
,
£q_·¿m_d©a
->
log2_max_äame_num
,&
d©a
->
äame_num
);

389 
	`CHECK
("frame_num");

391 ià(
show_Çl_d‘as
)

392 
	`åršt_msg
(" f¿me_num %u (%d b™s)\n",
d©a
->
äame_num
,

393 
£q_·¿m_d©a
->
log2_max_äame_num
);

395 
d©a
->
f›ld_pic_æag
 = 0;

396 
d©a
->
bÙtom_f›ld_æag
 = 0;

397 
d©a
->
bÙtom_f›ld_æag_´e£Á
 = 
FALSE
;

398 ià(!
£q_·¿m_d©a
->
äame_mbs_Úly_æag
)

400 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
f›ld_pic_æag
);

401 
	`CHECK
("field_pic_flag");

402 ià(
show_Çl_d‘as
)

403 
	`åršt_msg
(" f›ld_pic_æag %d\n",
d©a
->
f›ld_pic_æag
);

404 ià(
d©a
->
f›ld_pic_æag
)

406 
d©a
->
bÙtom_f›ld_æag_´e£Á
 = 
TRUE
;

407 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
bÙtom_f›ld_æag
);

408 
	`CHECK
("bottom_field_flag");

409 ià(
show_Çl_d‘as
)

410 
	`åršt_msg
(" bÙtom_f›ld_æag %d\n",
d©a
->
bÙtom_f›ld_æag
);

414 ià(
Çl
->
Çl_un™_ty³
 == 5)

416 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
idr_pic_id
);

417 
	`CHECK
("idr_pic_id");

418 ià(
show_Çl_d‘as
)

419 
	`åršt_msg
(" idr_pic_id %u\n",
d©a
->
idr_pic_id
);

422 
d©a
->
d–_pic_Üd”_út_bÙtom
 = 0;

423 
d©a
->
d–_pic_Üd”_út
[0] = 0;

424 
d©a
->
d–_pic_Üd”_út
[1] = 0;

425 ià(
£q_·¿m_d©a
->
pic_Üd”_út_ty³
 == 0)

427 
”r
 = 
	`»ad_b™s
(
bd
,
£q_·¿m_d©a
->
log2_max_pic_Üd”_út_lsb
,

428 &
d©a
->
pic_Üd”_út_lsb
);

429 
	`CHECK
("pic_order_cnt_lsb");

430 ià(
pic_·¿m_d©a
->
pic_Üd”_´e£Á_æag
 && !
d©a
->
f›ld_pic_æag
)

432 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
d©a
->
d–_pic_Üd”_út_bÙtom
);

433 
	`CHECK
("delta_pic_order_cnt_bottom");

435 ià(
show_Çl_d‘as
)

436 
	`åršt_msg
("…ic_order_cnt_lsb %u (%d bits)\n"

438 
d©a
->
pic_Üd”_út_lsb
,

439 
£q_·¿m_d©a
->
log2_max_pic_Üd”_út_lsb
,

440 
d©a
->
d–_pic_Üd”_út_bÙtom
);

442 ià(
£q_·¿m_d©a
->
pic_Üd”_út_ty³
 == 1 &&

443 !
£q_·¿m_d©a
->
d–_pic_Üd”_®ways_z”o_æag
)

445 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
d©a
->
d–_pic_Üd”_út
[0]);

446 
	`CHECK
("delta_pic_order_cnt[0]");

447 ià(
show_Çl_d‘as
)

448 
	`åršt_msg
(" d–_pic_Üd”_út[0] %d\n",
d©a
->
d–_pic_Üd”_út
[0]);

450 ià(
pic_·¿m_d©a
->
pic_Üd”_´e£Á_æag
 && !
d©a
->
f›ld_pic_æag
)

452 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
d©a
->
d–_pic_Üd”_út
[1]);

453 
	`CHECK
("delta_pic_order_cnt[1]");

454 ià(
show_Çl_d‘as
)

455 
	`åršt_msg
(" d–_pic_Üd”_út[1] %d\n",
d©a
->
d–_pic_Üd”_út
[1]);

463 
d©a
->
»dundªt_pic_út
 = 0;

464 
d©a
->
»dundªt_pic_út_´e£Á
 = 
FALSE
;

465 ià(
pic_·¿m_d©a
->
»dundªt_pic_út_´e£Á_æag
)

467 
d©a
->
»dundªt_pic_út_´e£Á
 = 
TRUE
;

468 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
»dundªt_pic_út
);

469 
	`CHECK
("redundant_pic_cnt");

470 ià(
show_Çl_d‘as
)

471 
	`åršt_msg
("„edundªt_pic_úˆ%u\n",
d©a
->
»dundªt_pic_út
);

474 
Çl
->
decoded
 = 
TRUE
;

476 
	}
}

487 
	$»ad_pic_·¿m_£t_d©a
(
Çl_un™_p
 
Çl
,

488 
show_Çl_d‘as
)

490 
”r
;

491 
b™d©a_p
 
bd
 = 
Çl
->
b™_d©a
;

492 
Çl_pic_·¿m_d©a_p
 
d©a
 = &(
Çl
->
u
.
pic
);

493 
ušt32_t
 
‹mp
;

495 
ušt32_t
 
num_»f_idx_10_aùive
;

496 
ušt32_t
 
num_»f_idx_11_aùive
;

497 
by‹
 
weigh‹d_´ed_æag
;

498 
ušt32_t
 
weigh‹d_b»d_idc
;

499 
št32_t
 
pic_š™_qp
;

500 
št32_t
 
pic_š™_qs
;

501 
št32_t
 
chroma_qp_šdex_off£t
;

502 
by‹
 
deblockšg_f‹r_cÚŒŞ_´e£Á_æag
;

503 
by‹
 
cÚ¡¿šed_šŒa_´ed_æag
;

505 #undeà
CHECK


506 
	#CHECK
(
Çme
) \

507 ià(
”r
) \

509 
	`åršt_”r
("### Error„eading %s field from…icture…arameter set\n",\

510 (
Çme
)); \

511 }

	)

515 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
‹mp
);

516 
	`CHECK
("pic_parameter_set_id");

517 
d©a
->
pic_·¿m‘”_£t_id
 = 
‹mp
;

518 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
‹mp
);

519 
	`CHECK
("seq_parameter_set_id");

520 
d©a
->
£q_·¿m‘”_£t_id
 = 
‹mp
;

521 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
’Œİy_codšg_mode_æag
);

522 
	`CHECK
("entropy_coding_mode_flag");

525 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
pic_Üd”_´e£Á_æag
);

526 
	`CHECK
("pic_order_present_flag");

528 ià(
show_Çl_d‘as
)

530 
	`åršt_msg
("@@ PPS " 
OFFSET_T_FORMAT_08
 "/%04d: size %d\n"

532 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,Çl->un™.¡¬t_po¢.
š·ck‘
,

533 
Çl
->
d©a_Ën
,

534 
Çl
->
Çl_»f_idc
,Çl->
Çl_un™_ty³
,

535 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
));

536 
	`åršt_msg
("…ic_parameter_set_id %d, seq_parameter_set_id %d\n",

537 
d©a
->
pic_·¿m‘”_£t_id
,d©a->
£q_·¿m‘”_£t_id
);

538 
	`åršt_msg
("ƒntropy_coding_mode_flag %d\n",

539 
d©a
->
’Œİy_codšg_mode_æag
);

540 
	`åršt_msg
("…ic_Üd”_´e£Á_æag %d\n",
d©a
->
pic_Üd”_´e£Á_æag
);

548 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
num_¦iû_groups
);

549 
	`CHECK
("num_slice_groups");

550 
d©a
->
num_¦iû_groups
 ++;

552 ià(
show_Çl_d‘as
)

553 
	`åršt_msg
("‚um_¦iû_group %u\n",
d©a
->
num_¦iû_groups
);

555 ià(
d©a
->
num_¦iû_groups
 > 1)

557 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
¦iû_group_m­_ty³
);

558 
	`CHECK
("slice_group_map_type");

559 ià(
show_Çl_d‘as
)

560 
	`åršt_msg
(" sliû_group_m­_ty³ %u\n",
d©a
->
¦iû_group_m­_ty³
);

561 ià(
d©a
->
¦iû_group_m­_ty³
 == 0)

564 
igroup
;

565 
igroup
=0; igrou°< 
d©a
->
num_¦iû_groups
; igroup++)

567 
ušt32_t
 
ignšt
;

568 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
ignšt
);

569 
	`CHECK
("run_length_minus1[x]");

572 ià(
d©a
->
¦iû_group_m­_ty³
 == 2)

575 
igroup
;

576 
igroup
=0; igrou°< (
d©a
->
num_¦iû_groups
 - 1); igroup++)

578 
ušt32_t
 
ignšt
;

579 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
ignšt
);

580 
	`CHECK
("top_left[x]");

581 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
ignšt
);

582 
	`CHECK
("bottom_right[x]");

585 ià(
d©a
->
¦iû_group_m­_ty³
 == 3 ||

586 
d©a
->
¦iû_group_m­_ty³
 == 4 ||

587 
d©a
->
¦iû_group_m­_ty³
 == 5)

589 
by‹
 
ignby‹
;

590 
ušt32_t
 
ignšt
;

591 
”r
 = 
	`»ad_b™
(
bd
,&
ignby‹
);

592 
	`CHECK
("slice_group_change_direction_flag");

593 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
ignšt
);

594 
	`CHECK
("slice_group_change_rate_minus1");

596 ià(
d©a
->
¦iû_group_m­_ty³
 == 6)

598 
ušt32_t
 
pic_size_š_m­_un™s
;

599 
ii
;

600 
size
;

601 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
pic_size_š_m­_un™s
);

602 
pic_size_š_m­_un™s
 ++;

603 
	`CHECK
("pic_size_in_map_units");

604 ià(
show_Çl_d‘as
)

605 
	`åršt_msg
("…ic_size_š_m­_un™ %u\n",
pic_size_š_m­_un™s
);

606 
size
 = (è
	`û
(
	`log2
(
d©a
->
num_¦iû_groups
));

608 
ii
=0; i˜< 
pic_size_š_m­_un™s
; ii++)

610 
ušt32_t
 
ignšt
;

611 
”r
 = 
	`»ad_b™s
(
bd
,
size
,&
ignšt
);

612 
	`CHECK
("slice_group_id[x]");

616 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
num_»f_idx_10_aùive
);

617 
	`CHECK
("num_ref_idx_10_active");

618 
num_»f_idx_10_aùive
 ++;

619 ià(
show_Çl_d‘as
)

620 
	`åršt_msg
("‚um_»f_idx_10_aùiv%u\n",
num_»f_idx_10_aùive
);

621 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
num_»f_idx_11_aùive
);

622 
	`CHECK
("num_ref_idx_11_active");

623 
num_»f_idx_11_aùive
 ++;

624 ià(
show_Çl_d‘as
)

625 
	`åršt_msg
("‚um_»f_idx_11_aùiv%u\n",
num_»f_idx_11_aùive
);

626 
”r
 = 
	`»ad_b™
(
bd
,&
weigh‹d_´ed_æag
);

627 
	`CHECK
("weighted_pred_flag");

628 ià(
show_Çl_d‘as
)

629 
	`åršt_msg
(" weigh‹d_´ed_æag %d\n",
weigh‹d_´ed_æag
);

630 
”r
 = 
	`»ad_b™s
(
bd
,2,&
weigh‹d_b»d_idc
);

631 
	`CHECK
("weighted_bipred_idc");

632 ià(
show_Çl_d‘as
)

633 
	`åršt_msg
(" weigh‹d_b»d_idø%u\n",
weigh‹d_b»d_idc
);

634 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
pic_š™_qp
);

635 
	`CHECK
("pic_init_qp");

636 
pic_š™_qp
 += 26;

637 ià(
show_Çl_d‘as
)

638 
	`åršt_msg
("…ic_š™_q°%d\n",
pic_š™_qp
);

639 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
pic_š™_qs
);

640 
	`CHECK
("pic_init_qs");

641 
pic_š™_qs
 += 26;

642 ià(
show_Çl_d‘as
)

643 
	`åršt_msg
("…ic_š™_q %d\n",
pic_š™_qs
);

644 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
chroma_qp_šdex_off£t
);

645 
	`CHECK
("chroma_qp_index_offset");

646 ià(
show_Çl_d‘as
)

647 
	`åršt_msg
(" chroma_qp_šdex_off£ˆ%d\n",
chroma_qp_šdex_off£t
);

648 
”r
 = 
	`»ad_b™
(
bd
,&
deblockšg_f‹r_cÚŒŞ_´e£Á_æag
);

649 
	`CHECK
("deblocking_filter_control_present_flag");

650 ià(
show_Çl_d‘as
)

651 
	`åršt_msg
(" deblocking_filter_control_present_flag %d\n",

652 
deblockšg_f‹r_cÚŒŞ_´e£Á_æag
);

653 
”r
 = 
	`»ad_b™
(
bd
,&
cÚ¡¿šed_šŒa_´ed_æag
);

654 
	`CHECK
("constrained_intra_pred_flag");

655 ià(
show_Çl_d‘as
)

656 
	`åršt_msg
(" cÚ¡¿šed_šŒa_´ed_æag %d\n",
cÚ¡¿šed_šŒa_´ed_æag
);

660 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
»dundªt_pic_út_´e£Á_æag
);

661 
	`CHECK
("redundant_pic_cnt_present_flag");

662 ià(
show_Çl_d‘as
)

663 
	`åršt_msg
("„edundant_pic_cnt_present_flag %d\n",

664 
d©a
->
»dundªt_pic_út_´e£Á_æag
);

666 
Çl
->
decoded
 = 
TRUE
;

668 
	}
}

679 
	$»ad_£q_·¿m_£t_d©a
(
Çl_un™_p
 
Çl
,

680 
show_Çl_d‘as
)

682 
”r
;

683 
b™d©a_p
 
bd
 = 
Çl
->
b™_d©a
;

684 
Çl_£q_·¿m_d©a_p
 
d©a
 = &(
Çl
->
u
.
£q
);

685 
ušt32_t
 
‹mp
;

687 
by‹
 
»£rved_z”o_5b™s
;

688 
ušt32_t
 
num_»f_äames
;

689 
by‹
 
g­s_š_äame_num_v®ue_®lowed_æag
;

690 
ušt32_t
 
pic_width_š_mbs
;

691 
ušt32_t
 
pic_height_š_m­_un™s
;

693 #undeà
CHECK


694 
	#CHECK
(
Çme
) \

695 ià(
”r
) \

697 
	`åršt_”r
("### Error„eading %s field from sequence…arameter set\n",\

698 (
Çme
)); \

699 }

	)

701 
”r
 = 
	`»ad_b™s_što_by‹
(
bd
,8,&
d©a
->
´ofe_idc
);

702 
	`CHECK
("profile_idc");

703 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
cÚ¡¿št_£t0_æag
);

704 
	`CHECK
("constraint_set0_flag");

705 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
cÚ¡¿št_£t1_æag
);

706 
	`CHECK
("constraint_set1_flag");

707 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
cÚ¡¿št_£t2_æag
);

708 
	`CHECK
("constraint_set2_flag");

709 
”r
 = 
	`»ad_b™s_što_by‹
(
bd
,5,&
»£rved_z”o_5b™s
);

710 
	`CHECK
("reserved_zero_5bits");

712 ià(
»£rved_z”o_5b™s
 != 0)

714 
	`åršt_”r
("###„eserved_zero_5bits‚ot zero (%d) in sequence"

715 "…¬am‘” s‘ NAL un™‡ˆ" 
OFFSET_T_FORMAT
 "/%d\n",

716 
»£rved_z”o_5b™s
,

717 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,Çl->un™.¡¬t_po¢.
š·ck‘
);

718 
	`´št_d©a
(
FALSE
," D©a",
Çl
->
b™_d©a
->
d©a
,Çl->b™_d©a->
d©a_Ën
,

725 
”r
 = 
	`»ad_b™s_što_by‹
(
bd
,8,&
d©a
->
Ëv–_idc
);

726 
	`CHECK
("level_idc");

728 ià(
show_Çl_d‘as
)

730 
	`åršt_msg
("@@ SPS " 
OFFSET_T_FORMAT_08
 "/%04d: size %d\n"

732 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,Çl->un™.¡¬t_po¢.
š·ck‘
,

733 
Çl
->
d©a_Ën
,

734 
Çl
->
Çl_»f_idc
,Çl->
Çl_un™_ty³
,

735 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
));

736 
	`åršt_msg
("…rofile_idc %u, constraint set flags: %d %d %d\n",

737 
d©a
->
´ofe_idc
,

738 
d©a
->
cÚ¡¿št_£t0_æag
,

739 
d©a
->
cÚ¡¿št_£t1_æag
,

740 
d©a
->
cÚ¡¿št_£t2_æag
);

741 
	`åršt_msg
("†ev–_idø%u\n",
d©a
->
Ëv–_idc
);

744 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
‹mp
);

745 
	`CHECK
("seq_parameter_set_id");

746 
d©a
->
£q_·¿m‘”_£t_id
 = 
‹mp
;

748 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
log2_max_äame_num
);

749 
	`CHECK
("log2_max_frame_num");

750 
d©a
->
log2_max_äame_num
 += 4;

752 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
pic_Üd”_út_ty³
);

753 
	`CHECK
("pic_order_cnt_type");

755 ià(
show_Çl_d‘as
)

757 
	`åršt_msg
(" seq_·¿m‘”_£t_id %u\n",
d©a
->
£q_·¿m‘”_£t_id
);

758 
	`åršt_msg
("†og2_max_äame_num %u\n",
d©a
->
log2_max_äame_num
);

759 
	`åršt_msg
("…ic_Üd”_út_ty³ %u\n",
d©a
->
pic_Üd”_út_ty³
);

762 ià(
d©a
->
pic_Üd”_út_ty³
 == 0)

764 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
d©a
->
log2_max_pic_Üd”_út_lsb
);

765 
	`CHECK
("log2_max_pic_order_cnt_lsb");

766 
d©a
->
log2_max_pic_Üd”_út_lsb
 += 4;

767 ià(
show_Çl_d‘as
)

768 
	`åršt_msg
("†og2_max_pic_order_cnt_lsb %u\n",

769 
d©a
->
log2_max_pic_Üd”_út_lsb
);

771 ià(
d©a
->
pic_Üd”_út_ty³
 == 1)

773 
ii
;

774 
št32_t
 
off£t_fÜ_nÚ_»f_pic
;

775 
št32_t
 
off£t_fÜ_tİ_to_bÙtom_f›ld
;

776 
ušt32_t
 
num_»f_äames_š_pic_Üd”_út_cyşe
;

778 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
d–_pic_Üd”_®ways_z”o_æag
);

779 
	`CHECK
("delta_pic_order_always_zero_flag");

780 ià(
show_Çl_d‘as
)

781 
	`åršt_msg
(" delta_pic_order_always_zero_flag %d\n",

782 
d©a
->
d–_pic_Üd”_®ways_z”o_æag
);

783 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
off£t_fÜ_nÚ_»f_pic
);

784 
	`CHECK
("offset_for_non_ref_pic");

785 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
off£t_fÜ_tİ_to_bÙtom_f›ld
);

786 
	`CHECK
("offset_for_top_to_bottom_field");

787 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
num_»f_äames_š_pic_Üd”_út_cyşe
);

788 
	`CHECK
("num_ref_frames_in_pic_order_cnt_cycle");

791 
ii
=0; i˜< 
num_»f_äames_š_pic_Üd”_út_cyşe
; ii++)

793 
št32_t
 
off£t_fÜ_»f_äame_XX
;

794 
”r
 = 
	`»ad_sigÃd_exp_gŞomb
(
bd
,&
off£t_fÜ_»f_äame_XX
);

795 
	`CHECK
("offset_for_ref_frame_X");

798 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
num_»f_äames
);

799 
	`CHECK
("num_ref_frames");

800 ià(
show_Çl_d‘as
)

801 
	`åršt_msg
("‚um_»f_äame %u\n",
num_»f_äames
);

802 
”r
 = 
	`»ad_b™
(
bd
,&
g­s_š_äame_num_v®ue_®lowed_æag
);

803 
	`CHECK
("gaps_in_frame_num_value_allowed_flag");

804 ià(
show_Çl_d‘as
)

805 ià(
show_Çl_d‘as
)

806 
	`åršt_msg
(" gaps_in_frame_num_value_allowed_flag %d\n",

807 
g­s_š_äame_num_v®ue_®lowed_æag
);

808 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
pic_width_š_mbs
);

809 
	`CHECK
("pic_width_in_mbs");

810 
pic_width_š_mbs
 ++;

811 ià(
show_Çl_d‘as
)

812 
	`åršt_msg
("…ic_width_š_mb %u\n",
pic_width_š_mbs
);

813 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
pic_height_š_m­_un™s
);

814 
	`CHECK
("pic_height_in_map_units");

815 
pic_height_š_m­_un™s
 ++;

816 ià(
show_Çl_d‘as
)

817 
	`åršt_msg
("…ic_height_š_m­_un™ %u\n",
pic_height_š_m­_un™s
);

819 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
äame_mbs_Úly_æag
);

820 
	`CHECK
("frame_mbs_only_flag");

821 ià(
show_Çl_d‘as
)

822 
	`åršt_msg
(" f¿me_mbs_Úly_æag %d\n",
d©a
->
äame_mbs_Úly_æag
);

824 
Çl
->
decoded
 = 
TRUE
;

826 
	}
}

833 
	$»ad_SEI_»cov”y_pošt
(
Çl_un™_p
 
Çl
,

834 
·ylßdSize
,

835 
show_Çl_d‘as
)

837 
”r
;

838 
b™d©a_p
 
bd
 = 
Çl
->
b™_d©a
;

839 
Çl_SEI_»cov”y_d©a_p
 
d©a
 = &(
Çl
->
u
.
£i_»cov”y
);

840 
ušt32_t
 
‹mp
;

842 #undeà
CHECK


843 
	#CHECK
(
Çme
) \

844 ià(
”r
) \

846 
	`åršt_”r
("### Error„eading %s field from SEI\n", \

847 (
Çme
)); \

848 }

	)

850 
”r
 = 
	`»ad_exp_gŞomb
(
bd
,&
‹mp
);

851 
	`CHECK
("recovery_frame_cnt");

852 
d©a
->
»cov”y_äame_út
 = 
‹mp
;

853 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
exaù_m©ch_æag
);

854 
	`CHECK
("exact_match_flag");

855 
”r
 = 
	`»ad_b™
(
bd
,&
d©a
->
brok’_lšk_æag
);

856 
	`CHECK
("broken_link_flag");

858 
”r
 = 
	`»ad_b™s
(
bd
,2,&
d©a
->
chªgšg_¦iû_group_idc
);

859 
	`CHECK
("changing_slice_group_idc");

861 
Çl
->
decoded
 = 
TRUE
;

863 ià(
show_Çl_d‘as
)

865 
	`´št_msg
("@@ Recovery Point SEI\n");

866 
	`åršt_msg
("„ecov”y_äame_úˆ%d\Àƒxaù_m©ch_æag %d\n", 
d©a
->
»cov”y_äame_út
, d©a->
exaù_m©ch_æag
);

867 
	`åršt_msg
(" brok’_lšk_æag %d\À chªgšg_¦iû_group_idø%d", 
d©a
->
brok’_lšk_æag
, d©a->
chªgšg_¦iû_group_idc
);

871 
	}
}

882 
	$»ad_SEI
(
Çl_un™_p
 
Çl
,

883 
show_Çl_d‘as
)

885 
”r
;

886 
SEI_·ylßdTy³
 = 0;

887 
SEI_·ylßdSize
 = 0;

888 
b™d©a_p
 
bd
 = 
Çl
->
b™_d©a
;

889 
ušt32_t
 
‹mp
 = 0;

891 #undeà
CHECK


892 
	#CHECK
(
Çme
) \

893 ià(
”r
) \

895 
	`åršt_”r
("### Error„eading %s field from SEI\n", \

896 (
Çme
)); \

897 }

	)

902 
”r
 = 
	`»ad_b™s
(
bd
,8,&
‹mp
);

903 
	`CHECK
("payloadType");

904 ià(
‹mp
 == 0xff)

905 
SEI_·ylßdTy³
 += 0xff;

909 
SEI_·ylßdTy³
 +ğ
‹mp
;

910 
Çl
->
u
.
£i_»cov”y
.
·ylßdTy³
 = 
SEI_·ylßdTy³
;

915 
”r
 = 
	`»ad_b™s
(
bd
,8,&
‹mp
);

916 
	`CHECK
("payloadSize");

917 ià(
‹mp
 == 0xff)

918 
SEI_·ylßdSize
 += 0xff;

922 
SEI_·ylßdSize
 +ğ
‹mp
;

923 
Çl
->
u
.
£i_»cov”y
.
·ylßdSize
 = 
SEI_·ylßdSize
;

925 ià(
SEI_·ylßdTy³
 == 6)

926 
”r
 = 
	`»ad_SEI_»cov”y_pošt
(
Çl
, 
SEI_·ylßdSize
, 
show_Çl_d‘as
);

929 
	}
}

951 
	$»ad_rb¥_d©a
(
Çl_un™_p
 
Çl
,

952 
·¿m_diù_p
 
£q_·¿m_diù
,

953 
·¿m_diù_p
 
pic_·¿m_diù
,

954 
show_Çl_d‘as
)

956 
”r
 = 0;

958 ià(
Çl
->
decoded
)

961 
”r
 = 
	`´•¬e_rb¥
(
Çl
);

962 ià(
”r
) ƒrr;

964 ià(
Çl
->
Çl_un™_ty³
 == 1 ||‚al->nal_unit_type == 5)

965 
”r
 = 
	`»ad_¦iû_d©a
(
Çl
,
£q_·¿m_diù
,
pic_·¿m_diù
,
show_Çl_d‘as
);

966 ià(
Çl
->
Çl_un™_ty³
 == 8)

967 
”r
 = 
	`»ad_pic_·¿m_£t_d©a
(
Çl
,
show_Çl_d‘as
);

968 ià(
Çl
->
Çl_un™_ty³
 == 7)

969 
”r
 = 
	`»ad_£q_·¿m_£t_d©a
(
Çl
,
show_Çl_d‘as
);

970 ià(
Çl
->
Çl_un™_ty³
 == 6)

971 
”r
 = 
	`»ad_SEI
(
Çl
,
show_Çl_d‘as
);

972 ià(
show_Çl_d‘as
)

973 
	`åršt_msg
("@@‚® " 
OFFSET_T_FORMAT_08
 "/%04d: size %d\n"

975 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,Çl->un™.¡¬t_po¢.
š·ck‘
,

976 
Çl
->
d©a_Ën
,

977 
Çl
->
Çl_»f_idc
,Çl->
Çl_un™_ty³
,

978 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
));

980 ià(
”r
)

982 
	`åršt_”r
("### Error„eading RBSP data for %s NAL (ref idc %x,"

983 " un™y³ %xè© " 
OFFSET_T_FORMAT_08
 "/%04d\n",

984 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
),

985 
Çl
->
Çl_»f_idc
,

986 
Çl
->
Çl_un™_ty³
,

987 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,

988 
Çl
->
un™
.
¡¬t_po¢
.
š·ck‘
);

993 ià(
Çl
->
rb¥
 !ğ
NULL
)

995 
	`ä“
(
Çl
->
rb¥
);

996 
Çl
->
rb¥
 = 
NULL
;

997 
Çl
->
rb¥_Ën
 = 0;

998 
	`ä“_b™d©a
(&
Çl
->
b™_d©a
);

1000  
”r
;

1001 
	}
}

1009 
	$Çl_is_¦iû
(
Çl_un™_p
 
Çl
)

1011  
Çl
->
Çl_un™_ty³
 == 1 ||‚al->nal_unit_type == 5;

1012 
	}
}

1019 
	$Çl_is_pic_·¿m_£t
(
Çl_un™_p
 
Çl
)

1021  
Çl
->
Çl_un™_ty³
 == 8;

1022 
	}
}

1029 
	$Çl_is_£q_·¿m_£t
(
Çl_un™_p
 
Çl
)

1031  
Çl
->
Çl_un™_ty³
 == 7;

1032 
	}
}

1037 
	$Çl_is_»dundªt
(
Çl_un™_p
 
Çl
)

1039  
	`Çl_is_¦iû
(
Çl
è&&‚®->
u
.
¦iû
.
»dundªt_pic_út_´e£Á
 &&

1040 
Çl
->
u
.
¦iû
.
»dundªt_pic_út
;

1041 
	}
}

1097 
	$Çl_is_fœ¡_VCL_NAL
(
Çl_un™_p
 
Çl
,

1098 
Çl_un™_p
 
Ï¡
)

1100 
Çl_¦iû_d©a_p
 
this
,
th©
;

1102 ià(
Çl
->
¡¬ts_piùu»_decided
)

1103  
Çl
->
¡¬ts_piùu»
;

1105 ià(!
Çl
->
decoded
)

1107 
	`´št_”r
("### Cannot decide if NAL unit is first VCL NAL\n"

1109  
FALSE
;

1119 ià(
Çl
->
Çl_un™_ty³
 !ğ
NAL_NON_IDR
 &&

1120 
Çl
->
Çl_un™_ty³
 !ğ
NAL_IDR
)

1122 
Çl
->
¡¬ts_piùu»
 = 
FALSE
;

1123 
Çl
->
¡¬ts_piùu»_decided
 = 
TRUE
;

1124  
FALSE
;

1127 
Çl
->
¡¬ts_piùu»
 = 
TRUE
;

1128 
Çl
->
¡¬ts_piùu»_decided
 = 
TRUE
;

1130 ià(
Ï¡
 =ğ
NULL
)

1134 
Çl
->
¡¬t_»asÚ
 = "First slice in data stream";

1135  
TRUE
;

1138 
this
 = &(
Çl
->
u
.
¦iû
);

1139 
th©
 = &(
Ï¡
->
u
.
¦iû
);

1141 ià(
this
->
äame_num
 !ğ
th©
->frame_num)

1142 
Çl
->
¡¬t_»asÚ
 = "Frame‚umber differs";

1143 ià(
this
->
f›ld_pic_æag
 !ğ
th©
->field_pic_flag)

1144 
Çl
->
¡¬t_»asÚ
 = "One is field,he other frame";

1145 ià(
this
->
bÙtom_f›ld_æag_´e£Á
 &&

1146 
th©
->
bÙtom_f›ld_æag_´e£Á
 &&

1147 
this
->
bÙtom_f›ld_æag
 !ğ
th©
->bottom_field_flag)

1149 
Çl
->
¡¬t_»asÚ
 = "One is bottom field,he otherop";

1153 ià(
Çl
->
Çl_»f_idc
 !ğ
Ï¡
->nal_ref_idc &&

1154 (
Çl
->
Çl_»f_idc
 =ğ0 || 
Ï¡
->nal_ref_idc == 0))

1155 
Çl
->
¡¬t_»asÚ
 = "One is„eference…icture,he other is‚ot";

1156 ià(
this
->
£q_·¿m_£t_pic_Üd”_út_ty³
 == 0 &&

1157 
th©
->
£q_·¿m_£t_pic_Üd”_út_ty³
 == 0 &&

1158 (
this
->
pic_Üd”_út_lsb
 !ğ
th©
->pic_order_cnt_lsb ||

1159 
this
->
d–_pic_Üd”_út_bÙtom
 !=

1160 
th©
->
d–_pic_Üd”_út_bÙtom
))

1161 
Çl
->
¡¬t_»asÚ
 = "Picture order counts differ";

1162 ià(
this
->
£q_·¿m_£t_pic_Üd”_út_ty³
 == 1 &&

1163 
th©
->
£q_·¿m_£t_pic_Üd”_út_ty³
 == 1 &&

1164 (
this
->
d–_pic_Üd”_út
[0] !ğ
th©
->delta_pic_order_cnt[0] ||

1165 
this
->
d–_pic_Üd”_út
[1] !ğ
th©
->delta_pic_order_cnt[1]))

1166 
Çl
->
¡¬t_»asÚ
 = "Picture delta counts differ";

1167 ià((
Çl
->
Çl_un™_ty³
 =ğ5 || 
Ï¡
->nal_unit_type == 5) &&

1168 
Çl
->
Çl_un™_ty³
 !ğ
Ï¡
->nal_unit_type)

1169 
Çl
->
¡¬t_»asÚ
 = "One IDR, one‚ot";

1170 ià(
Çl
->
Çl_un™_ty³
 =ğ5 && 
Ï¡
->nal_unit_type == 5 &&

1171 
this
->
idr_pic_id
 !ğ
th©
->idr_pic_id)

1172 
Çl
->
¡¬t_»asÚ
 = "Different IDRs";

1174 
Çl
->
¡¬ts_piùu»
 = 
FALSE
;

1176  
Çl
->
¡¬ts_piùu»
;

1177 
	}
}

1184 
	$»pÜt_Çl
(
is_msg
,

1185 
Çl_un™_p
 
Çl
)

1187 ià(
Çl
 =ğ
NULL
)

1188 
	`åršt_msg_Ü_”r
(
is_msg
,".............: NAL unit <null>\n");

1189 ià(
	`Çl_is_¦iû
(
Çl
è&& (Çl->
Çl_un™_ty³
 =ğ
NAL_IDR
 ||

1190 
Çl
->
Çl_un™_ty³
 =ğ
NAL_NON_IDR
))

1192 
	#SARRAYSIZE
 20

	)

1193 
wh©
[
SARRAYSIZE
];

1194 
	`¢´štf
(
wh©
,
SARRAYSIZE
,"(%s)",
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
));

1196 
wh©
[
SARRAYSIZE
-1] = '\0';

1197 
	`åršt_msg_Ü_”r
(
is_msg
,
OFFSET_T_FORMAT_08
 "/%04d: %x/%02x %-20s %u (%s) frame %u",

1198 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,

1199 
Çl
->
un™
.
¡¬t_po¢
.
š·ck‘
,

1200 
Çl
->
Çl_»f_idc
,

1201 
Çl
->
Çl_un™_ty³
,

1202 
wh©
,

1203 
Çl
->
u
.
¦iû
.
¦iû_ty³
,

1204 
	`NAL_SLICE_TYPE_STR
(
Çl
->
u
.
¦iû
.
¦iû_ty³
),

1205 
Çl
->
u
.
¦iû
.
äame_num
);

1206 ià(
Çl
->
u
.
¦iû
.
f›ld_pic_æag
)

1208 ià(
Çl
->
u
.
¦iû
.
bÙtom_f›ld_æag
)

1209 
	`åršt_msg_Ü_”r
(
is_msg
," [bottom]");

1211 
	`åršt_msg_Ü_”r
(
is_msg
," [top]");

1214 ià(
	`Çl_is_£q_·¿m_£t
(
Çl
))

1216 
	`åršt_msg_Ü_”r
(
is_msg
,
OFFSET_T_FORMAT_08
 "/%04d: %x/%02x (%s %u)",

1217 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,

1218 
Çl
->
un™
.
¡¬t_po¢
.
š·ck‘
,

1219 
Çl
->
Çl_»f_idc
,

1220 
Çl
->
Çl_un™_ty³
,

1221 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
),

1222 
Çl
->
u
.
£q
.
£q_·¿m‘”_£t_id
);

1224 ià(
	`Çl_is_pic_·¿m_£t
(
Çl
))

1226 
	`åršt_msg_Ü_”r
(
is_msg
,
OFFSET_T_FORMAT_08
 "/%04d: %x/%02x (%s %u)",

1227 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,

1228 
Çl
->
un™
.
¡¬t_po¢
.
š·ck‘
,

1229 
Çl
->
Çl_»f_idc
,

1230 
Çl
->
Çl_un™_ty³
,

1231 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
),

1232 
Çl
->
u
.
pic
.
pic_·¿m‘”_£t_id
);

1235 
	`åršt_msg_Ü_”r
(
is_msg
,
OFFSET_T_FORMAT_08
 "/%04d: %x/%02x (%s)",

1236 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,

1237 
Çl
->
un™
.
¡¬t_po¢
.
š·ck‘
,

1238 
Çl
->
Çl_»f_idc
,

1239 
Çl
->
Çl_un™_ty³
,

1240 
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
));

1241 #ià
REPORT_NAL_SHOWS_ADDRESS


1242 
	`åršt_msg_Ü_”r
(
is_msg
," <%p>",
Çl
);

1244 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

1245 
	}
}

1259 
	$check_´ofe
(
Çl_un™_p
 
Çl
,

1260 
show_Çl_d‘as
)

1262 
Çl_£q_·¿m_d©a
 
d©a
;

1263 *
Çme
;

1265 ià(
Çl
 =ğ
NULL
)

1267 
	`´št_”r
("### Attempto check…rofile on‡ NULL NAL unit\n");

1270 ià(
Çl
->
Çl_un™_ty³
 != 7)

1272 
	`´št_”r
("### Attempto check…rofile on‡ NAL unithat is‚ot‡ "

1274 
	`»pÜt_Çl
(
FALSE
,
Çl
);

1277 ià(!
Çl
->
decoded
)

1282 
”r
 = 
	`»ad_rb¥_d©a
(
Çl
,
NULL
,NULL,
show_Çl_d‘as
);

1283 ià(
”r
)

1285 
	`´št_”r
("### Errorryingo decode RBSP for first sequence"

1291 
d©a
 = 
Çl
->
u
.
£q
;

1292 
Çme
 = (
d©a
.
´ofe_idc
==66?"baseline":

1293 
d©a
.
´ofe_idc
==77?"main":

1294 
d©a
.
´ofe_idc
==88?"extended":"<unknown>");

1296 ià(
d©a
.
´ofe_idc
 =ğ77 || d©a.
cÚ¡¿št_£t1_æag
 == 1)

1300 
sum
 = 
d©a
.
cÚ¡¿št_£t0_æag
 + d©a.
cÚ¡¿št_£t1_æag
 +

1301 
d©a
.
cÚ¡¿št_£t2_æag
;

1302 
	`´št_”r
("\n");

1303 
	`åršt_”r
("Warning: This bitstream declares itself‡s %s…rofile (%d)",

1304 
Çme
,
d©a
.
´ofe_idc
);

1305 ià(
sum
 == 0)

1306 
	`´št_”r
(".\n");

1309 
	`´št_”r
(",\n");

1310 
	`´št_”r
("‡nd‡s obeyinghe constraints ofhe");

1311 ià(
d©a
.
cÚ¡¿št_£t0_æag
è
	`´št_”r
(" baseline");

1312 ià(
d©a
.
cÚ¡¿št_£t1_æag
è
	`´št_”r
(" main");

1313 ià(
d©a
.
cÚ¡¿št_£t2_æag
è
	`´št_”r
("ƒxtended");

1314 
	`åršt_”r
("…rofe%s.\n",(
sum
==1?"":"s"));

1316 
	`åršt_”r
(" This software does‚ot support %s…rofile,\n",

1317 
Çme
);

1318 
	`´št_”r
("‡nd may give incorrect„esults or fail.\n\n");

1321 
	}
}

1339 
	$£tup_NAL_d©a
(
v”bo£
,

1340 
Çl_un™_p
 
Çl
)

1342 
fÜbidd’_z”o_b™
;

1347 
Çl
->
d©a
 = &Ò®->
un™
.data[3]);

1348 
Çl
->
d©a_Ën
 =‚®->
un™
.data_len - 3;

1351 
fÜbidd’_z”o_b™
 = 
Çl
->
d©a
[0] & 0x80;

1353 ià(
fÜbidd’_z”o_b™
)

1355 
	`åršt_”r
("### NAL forbidden_zero_bit is‚on-zero,‡t "

1356 
OFFSET_T_FORMAT
 "/%d\n",

1357 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,Çl->un™.¡¬t_po¢.
š·ck‘
);

1358 
	`åršt_”r
(" Fœ¡ by‹ oàNAL un™ i %02x",
Çl
->
d©a
[0]);

1359 ià(
Çl
->
d©a
[0] == 0xB3)

1360 
	`´št_”r
(", which is H.262 sequence header start code\n"

1362 
	`´št_”r
("\n");

1365 
Çl
->
Çl_»f_idc
 = (Çl->
d©a
[0] & 0x60) >> 5;

1366 
Çl
->
Çl_un™_ty³
 = (Çl->
d©a
[0] & 0x1F);

1368 ià(
v”bo£
)

1370 
	#SARRAYSIZE2
 20

	)

1371 
wh©
[
SARRAYSIZE2
];

1372 
	`¢´štf
(
wh©
,
SARRAYSIZE2
,"(%s)",
	`NAL_UNIT_TYPE_STR
(
Çl
->
Çl_un™_ty³
));

1374 
wh©
[
SARRAYSIZE2
-1] = '\0';

1375 
	`åršt_msg
(
OFFSET_T_FORMAT_08
 "/%04d: NAL unit %d/%d %-20s",

1376 
Çl
->
un™
.
¡¬t_po¢
.
šfe
,

1377 
Çl
->
un™
.
¡¬t_po¢
.
š·ck‘
,

1378 
Çl
->
Çl_»f_idc
,Çl->
Çl_un™_ty³
,
wh©
);

1383 ià(
Çl
->
d©a_Ën
 > 0)

1385 
ii
;

1386 
show_Ën
 = (
Çl
->
d©a_Ën
>10?10:nal->data_len);

1387 
	`åršt_msg
(" %6d:",
Çl
->
d©a_Ën
);

1388 
ii
 = 0; i˜< 
show_Ën
; ii++)

1389 
	`åršt_msg
(" %02x",
Çl
->
d©a
[
ii
]);

1390 ià(
show_Ën
 < 
Çl
->
d©a_Ën
)

1391 
	`´št_msg
("...");

1393 
	`´št_msg
("\n");

1396 
	}
}

1413 
	$fšd_Ãxt_NAL_un™
(
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
,

1414 
v”bo£
,

1415 
Çl_un™_p
 *
Çl
)

1417 
Ãed_fœ¡_£q_·¿m_£t
 = 
TRUE
;

1418 
”r
;

1420 
”r
 = 
	`bud_Çl_un™
(
Çl
);

1421 ià(
”r
)  1;

1423 
”r
 = 
	`fšd_Ãxt_ES_un™
(
cÚ‹xt
->
es
,&(*
Çl
)->
un™
);

1424 ià(
”r
)

1426 
	`ä“_Çl_un™
(
Çl
);

1427  
”r
;

1430 (
cÚ‹xt
->
couÁ
) ++;

1432 ià(
cÚ‹xt
->
show_Çl_d‘as
)

1433 
	`´št_msg
("\n");

1435 
”r
 = 
	`£tup_NAL_d©a
(
v”bo£
,*
Çl
);

1436 ià(
”r
)

1438 
	`ä“_Çl_un™
(
Çl
);

1439  
”r
;

1445 ià(
	`Çl_is_£q_·¿m_£t
(*
Çl
))

1447 ià(
Ãed_fœ¡_£q_·¿m_£t
)

1449 
	`check_´ofe
(*
Çl
,
cÚ‹xt
->
show_Çl_d‘as
);

1450 
Ãed_fœ¡_£q_·¿m_£t
 = 
FALSE
;

1457 
”r
 = 
	`»ad_rb¥_d©a
(*
Çl
,
cÚ‹xt
->
£q_·¿m_diù
,cÚ‹xt->
pic_·¿m_diù
,

1458 
cÚ‹xt
->
show_Çl_d‘as
);

1459 ià(
”r
)

1461 
	`ä“_Çl_un™
(
Çl
);

1467 ià(
	`Çl_is_pic_·¿m_£t
(*
Çl
))

1469 
”r
 = 
	`»memb”_·¿m_d©a
(
cÚ‹xt
->
pic_·¿m_diù
,

1470 (*
Çl
)->
u
.
pic
.
pic_·¿m‘”_£t_id
,*nal);

1471 ià(
”r
)

1473 
	`´št_”r
("### Error„emembering…icture…arameter set ");

1474 
	`»pÜt_Çl
(
FALSE
,*
Çl
);

1475 
	`ä“_Çl_un™
(
Çl
);

1479 ià(
	`Çl_is_£q_·¿m_£t
(*
Çl
))

1481 
”r
 = 
	`»memb”_·¿m_d©a
(
cÚ‹xt
->
£q_·¿m_diù
,

1482 (*
Çl
)->
u
.
£q
.
£q_·¿m‘”_£t_id
,*nal);

1483 ià(
”r
)

1485 
	`´št_”r
("### Error„emembering sequence…arameter set ");

1486 
	`»pÜt_Çl
(
FALSE
,*
Çl
);

1487 
	`ä“_Çl_un™
(
Çl
);

1493 
	}
}

1503 
	$wr™e_NAL_un™_as_ES
(
FILE
 *
ouut
,

1504 
Çl_un™_p
 
Çl
)

1506 
”r
 = 
	`wr™e_ES_un™
(
ouut
,&(
Çl
->
un™
));

1507 ià(
”r
)

1509 
	`´št_”r
("### Error writing NAL unit‡s ES\n");

1510  
”r
;

1514 
	}
}

1526 
	$wr™e_NAL_un™_as_TS
(
TS_wr™”_p
 
tswr™”
,

1527 
Çl_un™_p
 
Çl
,

1528 
ušt32_t
 
video_pid
)

1533 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
tswr™”
,

1534 
Çl
->
un™
.
d©a
,Çl->un™.
d©a_Ën
,

1535 
video_pid
,
DEFAULT_VIDEO_STREAM_ID
);

1536 ià(
”r
)

1538 
	`´št_”r
("### Error writing NAL unit‡s TS\n");

1539  
”r
;

1543 
	}
}

1554 
	$bud_·¿m_diù
(
·¿m_diù_p
 *
·¿m_diù
)

1556 
·¿m_diù_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_PARAM_DICT
);

1557 ià(
Ãw
 =ğ
NULL
)

1559 
	`´št_”r
("### Unableo‡llocate…arameter 'dictionary' datastructure\n");

1563 
Ãw
->
Ï¡_id
 = -1;

1564 
Ãw
->
Ï¡_šdex
 = -1;

1566 
Ãw
->
ids
 = 
	`m®loc
((
ušt32_t
)*
NAL_PIC_PARAM_START_SIZE
);

1567 ià(
Ãw
->
ids
 =ğ
NULL
)

1569 
	`´št_”r
("### Unableo‡llocate‡rray within 'dictionary'"

1571 
	`ä“
(
Ãw
);

1575 
Ãw
->
·¿ms
 = 
	`m®loc
(
SIZEOF_NAL_INNARDS
*
NAL_PIC_PARAM_START_SIZE
);

1576 ià(
Ãw
->
·¿ms
 =ğ
NULL
)

1578 
	`´št_”r
("### Unableo‡llocate‡rray within 'dictionary'"

1580 
	`ä“
(
Ãw
->
ids
);

1581 
	`ä“
(
Ãw
);

1585 
Ãw
->
po¢s
 = 
	`m®loc
(
SIZEOF_ES_OFFSET
*
NAL_PIC_PARAM_START_SIZE
);

1586 ià(
Ãw
->
po¢s
 =ğ
NULL
)

1588 
	`´št_”r
("### Unableo‡llocate‡rray within 'dictionary'"

1590 
	`ä“
(
Ãw
->
·¿ms
);

1591 
	`ä“
(
Ãw
->
ids
);

1592 
	`ä“
(
Ãw
);

1596 
Ãw
->
d©a_Ëns
 = 
	`m®loc
((
ušt32_t
)*
NAL_PIC_PARAM_START_SIZE
);

1597 ià(
Ãw
->
d©a_Ëns
 =ğ
NULL
)

1599 
	`´št_”r
("### Unableo‡llocate‡rray within 'dictionary'"

1601 
	`ä“
(
Ãw
->
·¿ms
);

1602 
	`ä“
(
Ãw
->
ids
);

1603 
	`ä“
(
Ãw
);

1607 
Ãw
->
size
 = 
NAL_PIC_PARAM_START_SIZE
;

1608 
Ãw
->
Ëngth
 = 0;

1610 *
·¿m_diù
 = 
Ãw
;

1612 
	}
}

1622 
	$ä“_·¿m_diù
(
·¿m_diù_p
 *
·¿m_diù
)

1624 ià(*
·¿m_diù
 =ğ
NULL
)

1626 
	`ä“
((*
·¿m_diù
)->
ids
);

1627 
	`ä“
((*
·¿m_diù
)->
·¿ms
);

1628 
	`ä“
((*
·¿m_diù
)->
po¢s
);

1629 
	`ä“
((*
·¿m_diù
)->
d©a_Ëns
);

1630 (*
·¿m_diù
)->
ids
 = 
NULL
;

1631 (*
·¿m_diù
)->
·¿ms
 = 
NULL
;

1632 (*
·¿m_diù
)->
po¢s
 = 
NULL
;

1633 (*
·¿m_diù
)->
d©a_Ëns
 = 
NULL
;

1634 
	`ä“
(*
·¿m_diù
);

1635 *
·¿m_diù
 = 
NULL
;

1636 
	}
}

1654 
	$»memb”_·¿m_d©a
(
·¿m_diù_p
 
·¿m_diù
,

1655 
ušt32_t
 
·¿m_id
,

1656 
Çl_un™_p
 
Çl
)

1658 
ii
;

1659 ià(
·¿m_id
 =ğ
·¿m_diù
->
Ï¡_id
)

1661 
·¿m_diù
->
·¿ms
[·¿m_diù->
Ï¡_šdex
] = 
Çl
->
u
;

1665 
ii
=0; ii<
·¿m_diù
->
Ëngth
; ii++)

1667 ià(
·¿m_diù
->
ids
[
ii
] =ğ
·¿m_id
)

1669 
·¿m_diù
->
·¿ms
[
ii
] = 
Çl
->
u
;

1670 
·¿m_diù
->
po¢s
[
ii
] = 
Çl
->
un™
.
¡¬t_po¢
;

1671 
·¿m_diù
->
d©a_Ëns
[
ii
] = 
Çl
->
un™
.
d©a_Ën
;

1672 
·¿m_diù
->
Ï¡_id
 = 
·¿m_id
;

1673 
·¿m_diù
->
Ï¡_šdex
 = 
ii
;

1678 ià(
·¿m_diù
->
Ëngth
 =ğ·¿m_diù->
size
)

1680 
Ãwsize
 = 
·¿m_diù
->
size
 + 
NAL_PIC_PARAM_INCREMENT
;

1681 
·¿m_diù
->
ids
 = 
	`»®loc
Õ¬am_diù->ids,
Ãwsize
*(
ušt32_t
));

1682 ià(
·¿m_diù
->
ids
 =ğ
NULL
)

1684 
	`´št_”r
("### Unableoƒxtend…arameter set dictionary‡rray\n");

1687 
·¿m_diù
->
·¿ms
 = 
	`»®loc
(param_dict->params,

1688 
Ãwsize
*
SIZEOF_NAL_INNARDS
);

1689 ià(
·¿m_diù
->
·¿ms
 =ğ
NULL
)

1691 
	`´št_”r
("### Unableoƒxtend…arameter set dictionary‡rray\n");

1694 
·¿m_diù
->
po¢s
 = 
	`»®loc
Õ¬am_diù->
·¿ms
,
Ãwsize
*
SIZEOF_ES_OFFSET
);

1695 ià(
·¿m_diù
->
po¢s
 =ğ
NULL
)

1697 
	`´št_”r
("### Unableoƒxtend…arameter set dictionary‡rray\n");

1700 
·¿m_diù
->
d©a_Ëns
 = 
	`»®loc
Õ¬am_diù->
·¿ms
,

1701 
Ãwsize
*(
ušt32_t
));

1702 ià(
·¿m_diù
->
d©a_Ëns
 =ğ
NULL
)

1704 
	`´št_”r
("### Unableoƒxtend…arameter set dictionary‡rray\n");

1707 
·¿m_diù
->
size
 = 
Ãwsize
;

1709 
·¿m_diù
->
ids
[·¿m_diù->
Ëngth
] = 
·¿m_id
;

1710 
·¿m_diù
->
·¿ms
[·¿m_diù->
Ëngth
] = 
Çl
->
u
;

1711 
·¿m_diù
->
po¢s
[·¿m_diù->
Ëngth
] = 
Çl
->
un™
.
¡¬t_po¢
;

1712 
·¿m_diù
->
d©a_Ëns
[·¿m_diù->
Ëngth
] = 
Çl
->
un™
.
d©a_Ën
;

1713 
·¿m_diù
->
Ï¡_id
 = 
·¿m_id
;

1714 
·¿m_diù
->
Ï¡_šdex
 =…¬am_diù->
Ëngth
;

1715 
·¿m_diù
->
Ëngth
++;

1717 
	}
}

1734 
šlše
 
	$lookup_·¿m_d©a
(
·¿m_diù_p
 
·¿m_diù
,

1735 
ušt32_t
 
·¿m_id
,

1736 
Çl_šÇrds_p
 *
·¿m_d©a
)

1738 
ii
;

1739 
ii
=0; ii<
·¿m_diù
->
Ëngth
; ii++)

1741 ià(
·¿m_diù
->
ids
[
ii
] =ğ
·¿m_id
)

1743 *
·¿m_d©a
 = &
·¿m_diù
->
·¿ms
[
ii
];

1744 
·¿m_diù
->
Ï¡_id
 = 
·¿m_id
;

1745 
·¿m_diù
->
Ï¡_šdex
 = 
ii
;

1750 
	}
}

1767 
	$g‘_pic_·¿m_d©a
(
·¿m_diù_p
 
pic_·¿m_diù
,

1768 
ušt32_t
 
pic_·¿m_id
,

1769 
Çl_pic_·¿m_d©a_p
 *
pic_·¿m_d©a
)

1771 
Çl_šÇrds_p
 
šÇrds
;

1772 
ab£Á
 = 
	`lookup_·¿m_d©a
(
pic_·¿m_diù
,
pic_·¿m_id
,&
šÇrds
);

1773 ià(
ab£Á
)

1775 
	`åršt_”r
("### Unableo find…icture…arameter set with id %u\n",

1776 
pic_·¿m_id
);

1779 *
pic_·¿m_d©a
 = &(
šÇrds
->
pic
);

1781 
	}
}

1798 
	$g‘_£q_·¿m_d©a
(
·¿m_diù_p
 
£q_·¿m_diù
,

1799 
ušt32_t
 
£q_·¿m_id
,

1800 
Çl_£q_·¿m_d©a_p
 *
£q_·¿m_d©a
)

1802 
Çl_šÇrds_p
 
šÇrds
;

1803 
ab£Á
 = 
	`lookup_·¿m_d©a
(
£q_·¿m_diù
,
£q_·¿m_id
,&
šÇrds
);

1804 ià(
ab£Á
)

1806 
	`åršt_”r
("### Unableo find sequence…arameter set with id %u\n",

1807 
£q_·¿m_id
);

1810 *
£q_·¿m_d©a
 = &(
šÇrds
->
£q
);

1812 
	}
}

1828 
	$bud_Çl_un™_li¡
(
Çl_un™_li¡_p
 *
li¡
)

1830 
Çl_un™_li¡_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_NAL_UNIT_LIST
);

1831 ià(
Ãw
 =ğ
NULL
)

1833 
	`´št_”r
("### Unableo‡llocate NAL unit†ist datastructure\n");

1837 
Ãw
->
Ëngth
 = 0;

1838 
Ãw
->
size
 = 
NAL_UNIT_LIST_START_SIZE
;

1839 
Ãw
->
¬¿y
 = 
	`m®loc
((
Çl_un™_p
)*
NAL_UNIT_LIST_START_SIZE
);

1840 ià(
Ãw
->
¬¿y
 =ğ
NULL
)

1842 
	`ä“
(
Ãw
);

1843 
	`´št_”r
("### Unableo‡llocate‡rray in NAL unit†ist datastructure\n");

1847 *
li¡
 = 
Ãw
;

1849 
	}
}

1856 
	$­³nd_to_Çl_un™_li¡
(
Çl_un™_li¡_p
 
li¡
,

1857 
Çl_un™_p
 
Çl
)

1859 ià(
li¡
->
Ëngth
 =ğli¡->
size
)

1861 
Ãwsize
 = 
li¡
->
size
 + 
NAL_UNIT_LIST_INCREMENT
;

1862 
li¡
->
¬¿y
 = 
	`»®loc
Öi¡->¬¿y,
Ãwsize
*(
Çl_un™_p
));

1863 ià(
li¡
->
¬¿y
 =ğ
NULL
)

1865 
	`´št_”r
("### Unableoƒxtend NAL unit†ist‡rray\n");

1868 
li¡
->
size
 = 
Ãwsize
;

1870 
li¡
->
¬¿y
[li¡->
Ëngth
++] = 
Çl
;

1872 
	}
}

1880 
šlše
 
	$ş—r_Çl_un™_li¡
(
Çl_un™_li¡_p
 
li¡
,

1881 
d“p
)

1883 ià(
li¡
->
¬¿y
 !ğ
NULL
)

1885 
ii
;

1886 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

1888 ià(
d“p
)

1890 
Çl_un™_p
 
Çl
 = 
li¡
->
¬¿y
[
ii
];

1891 ià(
Çl
 !ğ
NULL
)

1893 
	`ş—r_Çl_un™
(
Çl
);

1894 
	`ä“
(
Çl
);

1897 
li¡
->
¬¿y
[
ii
] = 
NULL
;

1899 
	`ä“
(
li¡
->
¬¿y
);

1900 
li¡
->
¬¿y
 = 
NULL
;

1902 
li¡
->
Ëngth
 = 0;

1903 
li¡
->
size
 = 0;

1904 
	}
}

1912 
	$»£t_Çl_un™_li¡
(
Çl_un™_li¡_p
 
li¡
,

1913 
d“p
)

1915 ià(
li¡
->
¬¿y
 !ğ
NULL
)

1917 
ii
;

1918 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

1920 ià(
d“p
)

1922 
Çl_un™_p
 
Çl
 = 
li¡
->
¬¿y
[
ii
];

1923 ià(
Çl
 !ğ
NULL
)

1925 
	`ş—r_Çl_un™
(
Çl
);

1926 
	`ä“
(
Çl
);

1929 
li¡
->
¬¿y
[
ii
] = 
NULL
;

1934 
li¡
->
Ëngth
 = 0;

1935 
	}
}

1947 
	$ä“_Çl_un™_li¡
(
Çl_un™_li¡_p
 *
li¡
,

1948 
d“p
)

1950 ià(*
li¡
 =ğ
NULL
)

1952 
	`ş—r_Çl_un™_li¡
(*
li¡
,
d“p
);

1953 
	`ä“
(*
li¡
);

1954 *
li¡
 = 
NULL
;

1955 
	}
}

1960 
	$»pÜt_Çl_un™_li¡
(
is_msg
,

1961 *
´efix
,

1962 
Çl_un™_li¡_p
 
li¡
)

1964 ià(
´efix
 =ğ
NULL
)

1965 
´efix
 = "";

1966 ià(
li¡
->
¬¿y
 =ğ
NULL
)

1967 
	`åršt_msg_Ü_”r
(
is_msg
,"%s<em±y>\n",
´efix
);

1970 
ii
;

1971 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

1973 
	`åršt_msg_Ü_”r
(
is_msg
,"%s",
´efix
);

1974 
	`»pÜt_Çl
(
is_msg
,
li¡
->
¬¿y
[
ii
]);

1977 
	}
}

	@nalunit_defns.h

29 #iâdeà
_Çlun™_deâs


30 
	#_Çlun™_deâs


	)

32 
	~<¡dio.h
>

33 
	~"com·t.h
"

34 
	~"es_deâs.h
"

35 
	~"b™d©a_deâs.h
"

40 
	eNAL_UNIT_TYPE


42 
	mNAL_UNSPECIFIED
,

43 
	mNAL_NON_IDR
,

44 
	mNAL_PARTITION_A
,

45 
	mNAL_PARTITION_B
,

46 
	mNAL_PARTITION_C
,

47 
	mNAL_IDR
,

48 
	mNAL_SEI
,

49 
	mNAL_SEQ_PARAM_SET
,

50 
	mNAL_PIC_PARAM_SET
,

51 
	mNAL_ACCESS_UNIT_DELIM
,

52 
	mNAL_END_OF_SEQ
,

53 
	mNAL_END_OF_STREAM
,

54 
	mNAL_FILLER


57 
	#NAL_UNIT_TYPE_STR
(
a
) \

58 ((
a
)==
NAL_UNSPECIFIED
?"unspecified": \

59 (
a
)==
NAL_NON_IDR
?"non-IDR": \

60 (
a
)==
NAL_PARTITION_A
?"partition A": \

61 (
a
)==
NAL_PARTITION_B
?"partition B": \

62 (
a
)==
NAL_PARTITION_C
?"partition C": \

63 (
a
)==
NAL_IDR
?"IDR": \

64 (
a
)==
NAL_SEI
?"SEI": \

65 (
a
)==
NAL_SEQ_PARAM_SET
?"seq…aram set": \

66 (
a
)==
NAL_PIC_PARAM_SET
?"pic…aram set": \

67 (
a
)==
NAL_ACCESS_UNIT_DELIM
?"access unit delim": \

68 (
a
)==
NAL_END_OF_SEQ
?"end of seq": \

69 (
a
)==
NAL_END_OF_STREAM
?"end of stream": \

70 (
a
)==
NAL_FILLER
?"fËr":"???")

	)

72 
	#SLICE_P
 0

	)

73 
	#SLICE_B
 1

	)

74 
	#SLICE_I
 2

	)

75 
	#SLICE_SP
 3

	)

76 
	#SLICE_SI
 4

	)

77 
	#ALL_SLICES_P
 5

	)

78 
	#ALL_SLICES_B
 6

	)

79 
	#ALL_SLICES_I
 7

	)

80 
	#ALL_SLICES_SP
 8

	)

81 
	#ALL_SLICES_SI
 9

	)

83 
	#NAL_SLICE_TYPE_STR
(
a
) \

84 ((
a
)==
SLICE_P
?"Fœ¡ P": (a)==
SLICE_B
?"Fœ¡ B": (a)==
SLICE_I
?"First I": \

85 (
a
)==
SLICE_SP
?"Fœ¡ SP": (a)==
SLICE_SI
?"First SI": \

86 (
a
)==
ALL_SLICES_P
?"AÎ P": (a)==
ALL_SLICES_B
?"All B": \

87 (
a
)==
ALL_SLICES_I
?"AÎ I": (a)==
ALL_SLICES_SP
?"All SP": \

88 (
a
)==
ALL_SLICES_SI
?"AÎ SI":"??")

	)

95 
	sÇl_¦iû_d©a


97 
ušt32_t
 
	m£q_·¿m_£t_pic_Üd”_út_ty³
;

98 
ušt32_t
 
	mfœ¡_mb_š_¦iû
;

99 
ušt32_t
 
	m¦iû_ty³
;

100 
ušt32_t
 
	mpic_·¿m‘”_£t_id
;

101 
ušt32_t
 
	mäame_num
;

103 
by‹
 
	mf›ld_pic_æag
;

104 
by‹
 
	mbÙtom_f›ld_æag
;

105 
	mbÙtom_f›ld_æag_´e£Á
;

106 
ušt32_t
 
	midr_pic_id
;

107 
ušt32_t
 
	mpic_Üd”_út_lsb
;

108 
št32_t
 
	md–_pic_Üd”_út_bÙtom
;

109 
št32_t
 
	md–_pic_Üd”_út
[2];

110 
ušt32_t
 
	m»dundªt_pic_út
;

111 
	m»dundªt_pic_út_´e£Á
;

113 
Çl_¦iû_d©a
 *
	tÇl_¦iû_d©a_p
;

114 
	#SIZEOF_NAL_SLICE_DATA
 (
Çl_¦iû_d©a
)

	)

118 
	sÇl_£q_·¿m_d©a


120 
by‹
 
	m´ofe_idc
;

121 
by‹
 
	mcÚ¡¿št_£t0_æag
;

122 
by‹
 
	mcÚ¡¿št_£t1_æag
;

123 
by‹
 
	mcÚ¡¿št_£t2_æag
;

124 
by‹
 
	mËv–_idc
;

125 
ušt32_t
 
	m£q_·¿m‘”_£t_id
;

126 
ušt32_t
 
	mlog2_max_äame_num
;

127 
ušt32_t
 
	mpic_Üd”_út_ty³
;

128 
ušt32_t
 
	mlog2_max_pic_Üd”_út_lsb
;

129 
by‹
 
	md–_pic_Üd”_®ways_z”o_æag
;

130 
by‹
 
	mäame_mbs_Úly_æag
;

132 
Çl_£q_·¿m_d©a
 *
	tÇl_£q_·¿m_d©a_p
;

133 
	#SIZEOF_NAL_SEQ_PARAM_DATA
 (
Çl_£q_·¿m_d©a
)

	)

137 
	sÇl_pic_·¿m_d©a


139 
	mpic_·¿m‘”_£t_id
;

140 
	m£q_·¿m‘”_£t_id
;

141 
by‹
 
	m’Œİy_codšg_mode_æag
;

142 
by‹
 
	mpic_Üd”_´e£Á_æag
;

143 
ušt32_t
 
	mnum_¦iû_groups
;

144 
ušt32_t
 
	m¦iû_group_m­_ty³
;

146 
by‹
 
	m»dundªt_pic_út_´e£Á_æag
;

148 
Çl_pic_·¿m_d©a
 *
	tÇl_pic_·¿m_d©a_p
;

149 
	#SIZEOF_NAL_PIC_PARAM_DATA
 (
Çl_pic_·¿m_d©a
)

	)

153 
	sÇl_SEI_»cov”y_d©a


155 
	m·ylßdTy³
;

156 
	m·ylßdSize
;

158 
	m»cov”y_äame_út
;

159 
by‹
 
	mexaù_m©ch_æag
;

160 
by‹
 
	mbrok’_lšk_æag
;

161 
ušt32_t
 
	mchªgšg_¦iû_group_idc
;

163 
Çl_SEI_»cov”y_d©a
 *
	tÇl_SEI_»cov”y_d©a_p
;

164 
	#SIZEOF_NAL_SEI_RECOVERY_DATA
 (
Çl_SEI_»cov”y_d©a
)

	)

168 
	uÇl_šÇrds


170 
Çl_¦iû_d©a
 
	m¦iû
;

171 
Çl_£q_·¿m_d©a
 
	m£q
;

172 
Çl_pic_·¿m_d©a
 
	mpic
;

173 
Çl_SEI_»cov”y_d©a
 
	m£i_»cov”y
;

175 
Çl_šÇrds
 *
	tÇl_šÇrds_p
;

176 
	#SIZEOF_NAL_INNARDS
 (
Çl_šÇrds
)

	)

183 
	s·¿m_diù


185 
	mÏ¡_id
;

186 
	mÏ¡_šdex
;

187 *
	mids
;

188 
Çl_šÇrds
 *
	m·¿ms
;

189 
ES_off£t
 *
	mpo¢s
;

190 
ušt32_t
 *
	md©a_Ëns
;

191 
	msize
, 
	mËngth
;

193 
·¿m_diù
 *
	t·¿m_diù_p
;

194 
	#SIZEOF_PARAM_DICT
 (
·¿m_diù
)

	)

196 
	#NAL_PIC_PARAM_START_SIZE
 20

	)

197 
	#NAL_PIC_PARAM_INCREMENT
 20

	)

201 
	sÇl_un™


203 
ES_un™
 
	mun™
;

212 
by‹
 *
	md©a
;

213 
	md©a_Ën
;

217 
by‹
 *
	mrb¥
;

218 
	mrb¥_Ën
;

219 
b™d©a_p
 
	mb™_d©a
;

222 
	mÇl_»f_idc
;

223 
NAL_UNIT_TYPE
 
	mÇl_un™_ty³
;

224 
	m¡¬ts_piùu»_decided
;

225 
	m¡¬ts_piùu»
;

226 *
	m¡¬t_»asÚ
;

228 
	mdecoded
;

229 
Çl_šÇrds
 
	mu
;

231 
Çl_un™
 *
	tÇl_un™_p
;

232 
	#SIZEOF_NAL_UNIT
 (
Çl_un™
)

	)

236 
	sÇl_un™_li¡


238 
Çl_un™_p
 *
	m¬¿y
;

239 
	mËngth
;

240 
	msize
;

242 
Çl_un™_li¡
 *
	tÇl_un™_li¡_p
;

243 
	#SIZEOF_NAL_UNIT_LIST
 (
Çl_un™_li¡
)

	)

245 
	#NAL_UNIT_LIST_START_SIZE
 20

	)

246 
	#NAL_UNIT_LIST_INCREMENT
 20

	)

250 
	sÇl_un™_cÚ‹xt


252 
ES_p
 
	mes
;

253 
	mcouÁ
;

255 
·¿m_diù_p
 
	m£q_·¿m_diù
;

256 
·¿m_diù_p
 
	mpic_·¿m_diù
;

259 
	mshow_Çl_d‘as
;

261 
Çl_un™_cÚ‹xt
 *
	tÇl_un™_cÚ‹xt_p
;

262 
	#SIZEOF_NAL_UNIT_CONTEXT
 (
Çl_un™_cÚ‹xt
)

	)

	@nalunit_fns.h

29 #iâdeà
_Çlun™_âs


30 
	#_Çlun™_âs


	)

32 
	~"Çlun™_deâs.h
"

37 
£t_show_Çl_»adšg_d‘as
(
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
,

38 
show
);

45 
bud_Çl_un™_cÚ‹xt
(
ES_p
 
es
,

46 
Çl_un™_cÚ‹xt_p
 *
cÚ‹xt
);

54 
ä“_Çl_un™_cÚ‹xt
(
Çl_un™_cÚ‹xt_p
 *
cÚ‹xt
);

66 
»wšd_Çl_un™_cÚ‹xt
(
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
);

72 
bud_Çl_un™
(
Çl_un™_p
 *
Çl
);

81 
ä“_Çl_un™
(
Çl_un™_p
 *
Çl
);

98 
fšd_Ãxt_NAL_un™
(
Çl_un™_cÚ‹xt_p
 
cÚ‹xt
,

99 
v”bo£
,

100 
Çl_un™_p
 *
Çl
);

110 
wr™e_NAL_un™_as_ES
(
FILE
 *
ouut
,

111 
Çl_un™_p
 
Çl
);

122 
wr™e_NAL_un™_as_TS
(
TS_wr™”_p
 
tswr™”
,

123 
Çl_un™_p
 
Çl
,

124 
ušt32_t
 
video_pid
);

132 
bud_·¿m_diù
(
·¿m_diù_p
 *
·¿m_diù
);

142 
ä“_·¿m_diù
(
·¿m_diù_p
 *
·¿m_diù
);

160 
»memb”_·¿m_d©a
(
·¿m_diù_p
 
·¿m_diù
,

161 
ušt32_t
 
·¿m_id
,

162 
Çl_un™_p
 
Çl
);

179 
g‘_pic_·¿m_d©a
(
·¿m_diù_p
 
pic_·¿m_diù
,

180 
ušt32_t
 
pic_·¿m_id
,

181 
Çl_pic_·¿m_d©a_p
 *
pic_·¿m_d©a
);

198 
g‘_£q_·¿m_d©a
(
·¿m_diù_p
 
£q_·¿m_diù
,

199 
ušt32_t
 
£q_·¿m_id
,

200 
Çl_£q_·¿m_d©a_p
 *
£q_·¿m_d©a
);

208 
Çl_is_¦iû
(
Çl_un™_p
 
Çl
);

215 
Çl_is_pic_·¿m_£t
(
Çl_un™_p
 
Çl
);

222 
Çl_is_£q_·¿m_£t
(
Çl_un™_p
 
Çl
);

227 
Çl_is_»dundªt
(
Çl_un™_p
 
Çl
);

283 
Çl_is_fœ¡_VCL_NAL
(
Çl_un™_p
 
Çl
,

284 
Çl_un™_p
 
Ï¡
);

300 
bud_Çl_un™_li¡
(
Çl_un™_li¡_p
 *
li¡
);

307 
­³nd_to_Çl_un™_li¡
(
Çl_un™_li¡_p
 
li¡
,

308 
Çl_un™_p
 
Çl
);

315 
»£t_Çl_un™_li¡
(
Çl_un™_li¡_p
 
li¡
,

316 
d“p
);

328 
ä“_Çl_un™_li¡
(
Çl_un™_li¡_p
 *
li¡
,

329 
d“p
);

334 
»pÜt_Çl_un™_li¡
(
is_msg
,

335 *
´efix
,

336 
Çl_un™_li¡_p
 
li¡
);

343 
»pÜt_Çl
(
is_msg
,

344 
Çl_un™_p
 
Çl
);

	@pcap.c

33 
	~"pÿp.h
"

34 
	~"misc_âs.h
"

36 
šlše
 
ušt32_t
 
	$ušt_32_ùx
(cÚ¡ 
_pÿp_io_ùx
 *cÚ¡ 
ùx
, cÚ¡ *
v
)

38  
ùx
->
is_be
 ? 
	`ušt_32_be
(
v
è: 
	`ušt_32_Ë
(v);

39 
	}
}

41 
šlše
 
ušt16_t
 
	$ušt_16_ùx
(cÚ¡ 
_pÿp_io_ùx
 *cÚ¡ 
ùx
, cÚ¡ *
v
)

43  
ùx
->
is_be
 ? 
	`ušt_16_be
(
v
è: 
	`ušt_16_Ë
(v);

44 
	}
}

47 
šlše
 
ušt64_t
 
	$ušt_64_be_ùx
(cÚ¡ 
_pÿp_io_ùx
 *cÚ¡ 
ùx
, cÚ¡ *
v
)

49  ((
ušt64_t
)
	`ušt_32_ùx
(
ùx
, 
v
) << 32) | (uint64_t)uint_32_ctx(ctx, (const *)v + 4);

50 
	}
}

52 
šlše
 
ušt64_t
 
	$ušt_64_ùx
(cÚ¡ 
_pÿp_io_ùx
 *cÚ¡ 
ùx
, cÚ¡ *
v
)

54  
ùx
->
is_be
 ?

55 ((
ušt64_t
)
	`ušt_32_be
(
v
è<< 32è| (ušt64_t)ušt_32_be((cÚ¡ 
ušt8_t
 *)v + 4) :

56 ((
ušt64_t
)
	`ušt_32_Ë
((cÚ¡ 
ušt8_t
 *)
v
 + 4) << 32) | (uint64_t)uint_32_le(v);

57 
	}
}

61 
	$»ad_block_h—d”
(cÚ¡ 
_pÿp_io_ùx
 *cÚ¡ 
ùx
, 
ušt32_t
 *cÚ¡ 
pL’gth
)

63 
ušt32_t
 
buf
[2];

64 
rv
;

66 *
pL’gth
 = 0;

67 
rv
 = 
	`ä—d
(
buf
, 8, 1, 
ùx
->
fe
);

68 ià(
rv
 != 1)

70 ià(
	`ãof
(
ùx
->
fe
))

76  
PCAP_ERR_FILE_READ
;

80 *
pL’gth
 = 
	`ušt_32_ùx
(
ùx
, 
buf
 + 1);

81  
	`ušt_32_ùx
(
ùx
, 
buf
 + 0);

82 
	}
}

85 
	$»ad_chunk
(
FILE
 *cÚ¡ 
f
, cÚ¡ 
size_t
 
Ën
, 
ušt8_t
 **cÚ¡ 
pBuf
)

87 
rv
;

88 *
buf
 = 
	`m®loc
(
Ën
);

90 *
pBuf
 = 
NULL
;

91 ià(
buf
 =ğ
NULL
)

93  
PCAP_ERR_OUT_OF_MEMORY
;

96 
rv
 = 
	`ä—d
(
buf
, 
Ën
, 1, 
f
);

97 ià(
rv
 != 1)

99 
	`ä“
(
buf
);

100 ià(
	`ãof
(
f
))

106  
PCAP_ERR_FILE_READ
;

110 *
pBuf
 = 
buf
;

112 
	}
}

114 
	$»ad_İtiÚs
(
FILE
 *cÚ¡ 
f
, cÚ¡ 
size_t
 
Ën
, 
ušt8_t
 **cÚ¡ 
pBuf
)

117 ià(
Ën
 <= 4)

119 
	`f£ek
(
f
, 
Ën
, 
SEEK_CUR
);

120 *
pBuf
 = 
NULL
;

124  
	`»ad_chunk
(
f
, 
Ën
, 
pBuf
);

125 
	}
}

127 
	epÿ²g_ty³_e


129 
	mPCAPNG_TYPE_INVALID_BLOCK
 = 0,

130 
	mPCAPNG_TYPE_INTERFACE_BLOCK
 = 1,

131 
	mPCAPNG_TYPE_PACKET_BLOCK
 = 2,

132 
	mPCAPNG_TYPE_SIMPLE_PACKET_BLOCK
 = 3,

133 
	mPCAPNG_TYPE_NAME_RESOLUTION_BLOCK
 = 4,

134 
	mPCAPNG_TYPE_INTERFACE_STATISTICS_BLOCK
 = 5,

135 
	mPCAPNG_TYPE_ENHANCED_PACKET_BLOCK
 = 6,

136 
	mPCAPNG_TYPE_SECTION_HEADER_BLOCK
 = 0x0a0d0d0a

137 } 
	tpÿ²g_ty³_t
;

139 
	spÿ²g_hdr_·ck‘_s


141 
ušt16_t
 
	mdrİs_couÁ
;

142 
ušt32_t
 
	mš‹rçû_id
;

143 
ušt32_t
 
	mÿ±u»d_Ën
;

144 
ušt32_t
 
	m·ck‘_Ën
;

145 
ušt64_t
 
	mtime¡amp
;

146 } 
	tpÿ²g_hdr_·ck‘_t
;

148 
	spÿ²g_hdr_£ùiÚ_s


150 
ušt16_t
 
	mmajÜ_v”siÚ
;

151 
ušt16_t
 
	mmšÜ_v”siÚ
;

152 
ušt64_t
 
	m£ùiÚ_Ëngth
;

153 } 
	tpÿ²g_hdr_£ùiÚ_t
;

157 
	spÿ²g_h—d”_s


159 
pÿ²g_ty³_t
 
	mty³
;

160 
ušt8_t
 *
	md©a
;

161 
ušt8_t
 *
	mİtiÚs
;

164 
pÿ²g_hdr_·ck‘_t
 
	m·ck‘
;

165 
pÿ²g_hdr_š‹rçû_t
 
	miçû
;

166 
pÿ²g_hdr_£ùiÚ_t
 
	m£ùiÚ
;

167 } 
	mhdr
;

168 } 
	tpÿ²g_h—d”_t
;

172 
	$ä“_block
(
pÿ²g_h—d”_t
 *cÚ¡ 
hdr
)

174 
hdr
->
ty³
 = 
PCAPNG_TYPE_INVALID_BLOCK
;

175 ià(
hdr
->
d©a
 !ğ
NULL
)

177 
	`ä“
(
hdr
->
d©a
);

178 
hdr
->
d©a
 = 
NULL
;

180 ià(
hdr
->
İtiÚs
 !ğ
NULL
)

182 
	`ä“
(
hdr
->
İtiÚs
);

183 
hdr
->
İtiÚs
 = 
NULL
;

185 
	}
}

187 
	$do_£ùiÚ_h—d”
(
_pÿp_io_ùx
 *cÚ¡ 
ùx
, 
ušt32_t
 
Ëngth
, cÚ¡ 
ušt8_t
 *cÚ¡ 
buf
,

188 
pÿ²g_h—d”_t
 *cÚ¡ 
hdr
)

190 
ušt32_t
 
magic
;

191 
rv
;

194 
ùx
->
is_ng
 = 1;

196 
magic
 = 
	`ušt_32_ùx
(
ùx
, 
buf
 + 0);

198 
	`´štf
("Magiøğ%08x, L’ = %#x\n", 
magic
, 
Ëngth
);

200 ià(
magic
 == 0x1a2b3c4d)

204 ià(
magic
 == 0x4d3c2b1a)

207 
ùx
->
is_be
 = !ctx->is_be;

209 
Ëngth
 = (length >> 16) | (length << 16);

210 
Ëngth
 = ((length >> 8) & 0xff00ff) | ((length << 8) & 0xff00ff00);

214  
PCAP_ERR_INVALID_MAGIC
;

218 #ià
SIZEOF_PCAP_HDR_ON_DISC
 != 24

219 #”rÜ 
I
 
am
 
cÚfu£d


223 ià(
Ëngth
 < 28)

225  
PCAP_ERR_BAD_LENGTH
;

228 
Ëngth
 -= 24;

230 
hdr
->hdr.
£ùiÚ
.
majÜ_v”siÚ
 = 
	`ušt_16_ùx
(
ùx
, 
buf
 + 4);

231 
hdr
->hdr.
£ùiÚ
.
mšÜ_v”siÚ
 = 
	`ušt_16_ùx
(
ùx
, 
buf
 + 6);

232 
hdr
->hdr.
£ùiÚ
.
£ùiÚ_Ëngth
 = 
	`ušt_64_ùx
(
ùx
, 
buf
 + 8);

234 ià((
rv
 = 
	`»ad_İtiÚs
(
ùx
->
fe
, 
Ëngth
, &
hdr
->
İtiÚs
)) <= 0)

235  
rv
;

238 
	}
}

240 
	$»ad_block
(
_pÿp_io_ùx
 *cÚ¡ 
ùx
, 
pÿ²g_h—d”_t
 *cÚ¡ 
hdr
)

242 
rv
 = 1;

243 
hdr_ty³
;

244 
ušt32_t
 
Ëngth
;

246 
hdr
->
ty³
 = 
PCAPNG_TYPE_INVALID_BLOCK
;

247 
hdr
->
d©a
 = 
NULL
;

248 
hdr
->
İtiÚs
 = 
NULL
;

250 ià((
hdr_ty³
 = 
	`»ad_block_h—d”
(
ùx
, &
Ëngth
)) <= 0)

252  
hdr_ty³
;

256 ià(
hdr_ty³
 !ğ
PCAPNG_TYPE_SECTION_HEADER_BLOCK
)

258 ià(
Ëngth
 > 0x100000 ||†ength < 8)

260  
PCAP_ERR_BAD_LENGTH
;

262 
Ëngth
 -= 8;

265 
hdr_ty³
)

267 
PCAPNG_TYPE_INTERFACE_BLOCK
:

269 
ušt8_t
 
buf
[8];

271 ià(
Ëngth
 < 12)

272  
PCAP_ERR_BAD_LENGTH
;

274 ià(
	`ä—d
(
buf
, 8, 1, 
ùx
->
fe
) != 1)

275  
PCAP_ERR_FILE_READ
;

277 
hdr
->hdr.
içû
.
lšk_ty³
 = 
	`ušt_16_ùx
(
ùx
, 
buf
 + 0);

278 
hdr
->hdr.
içû
.
¢­_Ën
 = 
	`ušt_32_ùx
(
ùx
, 
buf
 + 4);

280 ià((
rv
 = 
	`»ad_İtiÚs
(
ùx
->
fe
, 
Ëngth
 - 8, &
hdr
->
İtiÚs
)) <= 0)

281  
rv
;

285 ià(
ùx
->
if_couÁ
 + 1 > ctx->
if_size
)

287 ià(
ùx
->
š‹rçûs
 =ğ
NULL
)

289 ià((
ùx
->
š‹rçûs
 = 
	`m®loc
((*ùx->š‹rçûsè* 4)è=ğ
NULL
)

290  
PCAP_ERR_OUT_OF_MEMORY
;

291 
ùx
->
if_size
 = 4;

295 
pÿ²g_hdr_š‹rçû_t
 *
»sized
 = 
	`»®loc
(
ùx
->
š‹rçûs
,

296 (*
ùx
->
š‹rçûs
è* ctx->
if_size
 * 2);

297 ià(
»sized
 =ğ
NULL
)

298  
PCAP_ERR_OUT_OF_MEMORY
;

299 
ùx
->
if_size
 *= 2;

300 
ùx
->
š‹rçûs
 = 
»sized
;

304 
ùx
->
š‹rçûs
[ùx->
if_couÁ
++] = 
hdr
->hdr.
içû
;

308 
PCAPNG_TYPE_PACKET_BLOCK
:

309 
PCAPNG_TYPE_ENHANCED_PACKET_BLOCK
:

311 
ušt8_t
 
buf
[20];

312 
size_t
 
d©a_Ën
;

314 ià(
Ëngth
 < 24)

315  
PCAP_ERR_BAD_LENGTH
;

317 ià(
	`ä—d
(
buf
, 20, 1, 
ùx
->
fe
) != 1)

318  
PCAP_ERR_FILE_READ
;

320 ià(
hdr_ty³
 =ğ
PCAPNG_TYPE_PACKET_BLOCK
)

322 
hdr
->hdr.
·ck‘
.
š‹rçû_id
 = 
	`ušt_16_ùx
(
ùx
, 
buf
 + 0);

323 
hdr
->hdr.
·ck‘
.
drİs_couÁ
 = 
	`ušt_16_ùx
(
ùx
, 
buf
 + 2);

327 
hdr
->hdr.
·ck‘
.
š‹rçû_id
 = 
	`ušt_32_ùx
(
ùx
, 
buf
 + 0);

328 
hdr
->hdr.
·ck‘
.
drİs_couÁ
 = 0;

330 
hdr
->hdr.
·ck‘
.
time¡amp
 = 
	`ušt_64_be_ùx
(
ùx
, 
buf
 + 4);

331 
hdr
->hdr.
·ck‘
.
ÿ±u»d_Ën
 = 
	`ušt_32_ùx
(
ùx
, 
buf
 + 12);

332 
hdr
->hdr.
·ck‘
.
·ck‘_Ën
 = 
	`ušt_32_ùx
(
ùx
, 
buf
 + 16);

334 ià(
hdr
->hdr.
·ck‘
.
š‹rçû_id
 >ğ
ùx
->
if_couÁ
)

335  
PCAP_ERR_BAD_INTERFACE_ID
;

337 
Ëngth
 -= 20;

338 
d©a_Ën
 = (
hdr
->hdr.
·ck‘
.
ÿ±u»d_Ën
 + 3) & ~3;

340 ià(
Ëngth
 - 4 < 
d©a_Ën
)

341  
PCAP_ERR_BAD_LENGTH
;

343 ià((
rv
 = 
	`»ad_chunk
(
ùx
->
fe
, 
d©a_Ën
, &
hdr
->
d©a
)) <= 0)

346 
Ëngth
 -ğ
d©a_Ën
;

348 ià((
rv
 = 
	`»ad_İtiÚs
(
ùx
->
fe
, 
Ëngth
, &
hdr
->
İtiÚs
)) <= 0)

354 
PCAPNG_TYPE_SECTION_HEADER_BLOCK
:

356 
ušt8_t
 
buf
[16];

361 ià(
ùx
->
š‹rçûs
 !ğ
NULL
)

363 
	`ä“
(
ùx
->
š‹rçûs
);

364 
ùx
->
š‹rçûs
 = 
NULL
;

365 
ùx
->
if_couÁ
 = 0;

366 
ùx
->
if_size
 = 0;

369 ià(
	`ä—d
(
buf
, 16, 1, 
ùx
->
fe
) != 1)

370  
PCAP_ERR_FILE_READ
;

372 ià((
rv
 = 
	`do_£ùiÚ_h—d”
(
ùx
, 
Ëngth
, 
buf
, 
hdr
)) < 0)

373  
rv
;

379 
	`f£ek
(
ùx
->
fe
, 
Ëngth
, 
SEEK_CUR
);

383 ià(
rv
 <= 0)

385 
	`ä“_block
(
hdr
);

389 
hdr
->
ty³
 = 
hdr_ty³
;

392  
rv
;

393 
	}
}

396 
	$pÿp_»ad_h—d”
(
PCAP_»ad”_p
 
ùx
, 
pÿp_hdr_t
 *
hdr
)

398 
ušt8_t
 
hdr_v®
[
SIZEOF_PCAP_HDR_ON_DISC
];

399 
rv
;

400 
ušt32_t
 
magic
;

403 
rv
 = 
	`ä—d
(&
hdr_v®
[0], 
SIZEOF_PCAP_HDR_ON_DISC
, 1, 
ùx
->
fe
);

404 ià(
rv
 != 1)

406 ià(
	`ãof
(
ùx
->
fe
))

412  
PCAP_ERR_FILE_READ
;

416 
magic
 = 
	`ušt_32_be
(
hdr_v®
 + 0);

418 ià(
magic
 =ğ
PCAPNG_TYPE_SECTION_HEADER_BLOCK
)

420 
pÿ²g_h—d”_t
 
nghdr
 = { 0 };

422 
	`´štf
("NG header found\n");

425 
ùx
->
is_ng
 = 1;

427 ià((
rv
 = 
	`do_£ùiÚ_h—d”
(
ùx
, 
	`ušt_32_ùx
(ùx, 
hdr_v®
 + 4), hdr_v® + 8, &
nghdr
)) <= 0)

428  
rv
;

430 
hdr
->
magic_numb”
 = 0x1a2b3c4d;

432 
hdr
->
v”siÚ_majÜ
 = 
nghdr
.hdr.
£ùiÚ
.
majÜ_v”siÚ
;

433 
hdr
->
v”siÚ_mšÜ
 = 
nghdr
.hdr.
£ùiÚ
.
mšÜ_v”siÚ
;

435 
	`´štf
("V”siÚ: %d.%d\n", 
hdr
->
v”siÚ_majÜ
, hdr->
v”siÚ_mšÜ
);

441 
	`ä“_block
(&
nghdr
);

443 ià((
rv
 = 
	`»ad_block
(
ùx
, &
nghdr
)) <= 0)

445  
rv
;

448 ià(
nghdr
.
ty³
 =ğ
PCAPNG_TYPE_INTERFACE_BLOCK
)

450 
hdr
->
¢­Ën
 = 
nghdr
.hdr.
içû
.
¢­_Ën
;

451 
hdr
->
ÃtwÜk
 = 
nghdr
.hdr.
içû
.
lšk_ty³
;

452 
	`ä“_block
(&
nghdr
);

459 
ùx
->
is_ng
 = 0;

464 ià(
magic
 == 0xa1b2c3d4)

467 
ùx
->
is_be
 = 1;

469 ià(
magic
 == 0xd4c3b2a1)

472 
ùx
->
is_be
 = 0;

476  
PCAP_ERR_INVALID_MAGIC
;

479 
hdr
->
magic_numb”
 = 0xa1b2c3d4;

481 
hdr
->
v”siÚ_majÜ
 = (
ùx
->
is_be
 ? 
	`ušt_16_be
(&
hdr_v®
[4]) :

482 
	`ušt_16_Ë
(&
hdr_v®
[4]));

483 
hdr
->
v”siÚ_mšÜ
 = (
ùx
->
is_be
 ? 
	`ušt_16_be
(&
hdr_v®
[6]) :

484 
	`ušt_16_Ë
(&
hdr_v®
[6]));

485 
hdr
->
thiszÚe
 = (
št32_t
)(
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[8]) :

486 
	`ušt_32_Ë
(&
hdr_v®
[8]));

487 
hdr
->
sigfigs
 = (
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[12]) :

488 
	`ušt_32_Ë
(&
hdr_v®
[12]));

489 
hdr
->
¢­Ën
 = (
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[16]) :

490 
	`ušt_32_Ë
(&
hdr_v®
[16]));

491 
hdr
->
ÃtwÜk
 = (
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[20]) :

492 
	`ušt_32_Ë
(&
hdr_v®
[20]));

497 
	}
}

499 
	$pÿp_»ad_pkth—d”
(
PCAP_»ad”_p
 
ùx
, 
pÿ´ec_hdr_t
 *
hdr
)

501 
ušt8_t
 
hdr_v®
[
SIZEOF_PCAPREC_HDR_ON_DISC
];

502 
rv
;

504 
rv
 = 
	`ä—d
(&
hdr_v®
[0], 
SIZEOF_PCAPREC_HDR_ON_DISC
, 1, 
ùx
->
fe
);

505 ià(
rv
 != 1)

507 ià(
	`ãof
(
ùx
->
fe
))

513  
PCAP_ERR_FILE_READ
;

517 
hdr
->
ts_£c
 = (
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[0]) :

518 
	`ušt_32_Ë
(&
hdr_v®
[0]));

519 
hdr
->
ts_u£c
 = (
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[4]) :

520 
	`ušt_32_Ë
(&
hdr_v®
[4]));

521 
hdr
->
šş_Ën
 = (
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[8]) :

522 
	`ušt_32_Ë
(&
hdr_v®
[8]));

523 
hdr
->
Üig_Ën
 = (
ùx
->
is_be
 ? 
	`ušt_32_be
(&
hdr_v®
[12]) :

524 
	`ušt_32_Ë
(&
hdr_v®
[12]));

527 
	}
}

529 
	$pÿp_İ’
(
PCAP_»ad”_p
 *
ùx_p
, 
pÿp_hdr_t
 *
out_hdr
,

530 cÚ¡ *
f’ame
)

532 
FILE
 *
åŒ
 = (
f’ame
 ? 
	`fİ’
(f’ame, "rb"è: 
¡dš
);

533 
PCAP_»ad”_p
 
ùx
;

534 
rv
;

536 (*
ùx_p
èğ
NULL
;

538 ià(!
åŒ
)

543 
ùx
 = (
PCAP_»ad”_p
)
	`ÿÎoc
(
SIZEOF_PCAP_READER
, 1);

544 ià(!
ùx
)

546 
	`fşo£
(
åŒ
);

551 
ùx
->
fe
 = 
åŒ
;

553 
rv
 = 
	`pÿp_»ad_h—d”
(
ùx
, 
out_hdr
);

555 ià(
rv
 != 1)

558 
	`fşo£
(
ùx
->
fe
);

559 
	`ä“
(
ùx
);

563 (*
ùx_p
èğ
ùx
;

566 
	}
}

568 
	$pÿp_»ad_Ãxt
(
PCAP_»ad”_p
 
ùx
, 
pÿ´ec_hdr_t
 *
out_hdr
,

569 
ušt8_t
 **
out_d©a
,

570 
ušt32_t
 *
out_Ën
)

572 
rv
;

574 (*
out_d©a
èğ
NULL
; (*
out_Ën
) = 0;

576 ià(
ùx
->
is_ng
)

580 
pÿ²g_h—d”_t
 
nghdr
;

582 ià((
rv
 = 
	`»ad_block
(
ùx
, &
nghdr
)) <= 0)

584  
rv
;

587 ià(
nghdr
.
ty³
 =ğ
PCAPNG_TYPE_PACKET_BLOCK
 ||

588 
nghdr
.
ty³
 =ğ
PCAPNG_TYPE_ENHANCED_PACKET_BLOCK
)

590 *
out_d©a
 = 
nghdr
.
d©a
;

591 *
out_Ën
 = 
nghdr
.
hdr
.
·ck‘
.
ÿ±u»d_Ën
;

593 
out_hdr
->
šş_Ën
 = 
nghdr
.
hdr
.
·ck‘
.
ÿ±u»d_Ën
;

594 
out_hdr
->
Üig_Ën
 = 
nghdr
.
hdr
.
·ck‘
.
·ck‘_Ën
;

595 
out_hdr
->
ts_£c
 = (
ušt32_t
)(
nghdr
.
hdr
.
·ck‘
.
time¡amp
 / 1000000);

596 
out_hdr
->
ts_u£c
 = (
ušt32_t
)(
nghdr
.
hdr
.
·ck‘
.
time¡amp
 % 1000000);

599 
nghdr
.
d©a
 = 
NULL
;

600 
	`ä“_block
(&
nghdr
);

604 
	`ä“_block
(&
nghdr
);

609 
rv
 = 
	`pÿp_»ad_pkth—d”
(
ùx
, 
out_hdr
);

610 ià(
rv
 != 1)

611 { 
rv
; }

614 (*
out_d©a
èğ(
ušt8_t
*)
	`m®loc
(
out_hdr
->
šş_Ën
);

616 ià(!(*
out_d©a
))

622 (*
out_Ën
èğ
out_hdr
->
šş_Ën
;

624 
rv
 = 
	`ä—d
((*
out_d©a
), (*
out_Ën
), 1, 
ùx
->
fe
);

625 ià(
rv
 != 1)

627 
	`ä“
(*
out_d©a
); (*out_d©aèğ
NULL
;

628 *
out_Ën
 = 0;

630 ià(
	`ãof
(
ùx
->
fe
))

638  
rv
;

641 ià(
rv
 == 1)

649 
	}
}

651 
	$pÿp_şo£
(
PCAP_»ad”_p
 *cÚ¡ 
pùx
)

653 
PCAP_»ad”_p
 
ùx
 = *
pùx
;

655 ià(
ùx
 =ğ
NULL
)

658 ià(
ùx
->
š‹rçûs
 !ğ
NULL
)

660 
	`ä“
(
ùx
->
š‹rçûs
);

662 ià(
ùx
->
fe
 !ğ
NULL
)

664 
	`fşo£
(
ùx
->
fe
);

666 
	`ä“
(
ùx
);

669 
	}
}

	@pcap.h

32 #iâdeà
_pÿp_h


33 
	#_pÿp_h


	)

35 
	~<¡dio.h
>

36 
	~<¡dlib.h
>

37 
	~"com·t.h
"

40 
	#PCAP_ERR_OUT_OF_MEMORY
 (-8)

	)

43 
	#PCAP_ERR_FILE_READ
 (-9)

	)

46 
	#PCAP_ERR_INVALID_MAGIC
 (-10)

	)

48 
	#PCAP_ERR_BAD_LENGTH
 (-11);

	)

50 
	#PCAP_ERR_BAD_INTERFACE_ID
 (-12);

	)

53 
	spÿp_hdr_s


58 
ušt32_t
 
	mmagic_numb”
;

61 
ušt16_t
 
	mv”siÚ_majÜ
;

64 
ušt16_t
 
	mv”siÚ_mšÜ
;

67 
št32_t
 
	mthiszÚe
;

70 
ušt32_t
 
	msigfigs
;

73 
ušt32_t
 
	m¢­Ën
;

80 
	#PCAP_NETWORK_TYPE_NONE
 0

	)

81 
	#PCAP_NETWORK_TYPE_ETHERNET
 1

	)

84 
ušt32_t
 
	mÃtwÜk
;

86 } 
	tpÿp_hdr_t
;

88 
	#SIZEOF_PCAP_HDR_ON_DISC
 (4 + 2 + 2 + 4 + 4 + 4 + 4)

	)

92 
	spÿ´ec_hdr_s


95 
ušt32_t
 
	mts_£c
;

98 
ušt32_t
 
	mts_u£c
;

101 
ušt32_t
 
	mšş_Ën
;

104 
ušt32_t
 
	mÜig_Ën
;

106 } 
	tpÿ´ec_hdr_t
;

108 
	#SIZEOF_PCAPREC_HDR_ON_DISC
 (4 + 4 + 4 + 4)

	)

111 
	spÿ²g_hdr_š‹rçû_s


113 
ušt16_t
 
	mlšk_ty³
;

114 
ušt32_t
 
	m¢­_Ën
;

115 } 
	tpÿ²g_hdr_š‹rçû_t
;

118 
	s_pÿp_io_ùx


121 
	mis_ng
;

124 
	mis_be
;

127 
FILE
 *
	mfe
;

129 
ušt32_t
 
	mif_couÁ
;

130 
ušt32_t
 
	mif_size
;

131 
pÿ²g_hdr_š‹rçû_t
 * 
	mš‹rçûs
;

133 } 
	tPCAP_»ad”_t
;

135 
_pÿp_io_ùx
 *
	tPCAP_»ad”_p
;

136 
	#SIZEOF_PCAP_READER
 (
_pÿp_io_ùx
)

	)

143 
pÿp_İ’
(
PCAP_»ad”_p
 *
ùx_p
, 
pÿp_hdr_t
 *
out_hdr
,

144 cÚ¡ *
f’ame
);

153 
pÿp_»ad_Ãxt
(
PCAP_»ad”_p
 
ùx_p
, 
pÿ´ec_hdr_t
 *
out_hdr
,

154 
ušt8_t
 **
out_d©a
,

155 
ušt32_t
 *
out_Ën
);

158 
pÿp_şo£
(
PCAP_»ad”_p
 * cÚ¡ 
ùx_p
);

	@pcapreport.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<lim™s.h
>

34 
	~<”ºo.h
>

35 
	~<¡ršg.h
>

36 
	~<fú.h
>

37 
	~<lim™s.h
>

38 
	~<time.h
>

39 #ifdeà
_WIN32


40 
	~<¡ddef.h
>

42 
	~<uni¡d.h
>

43 
	~<sys/sock‘.h
>

44 
	~<Ãtš‘/š.h
>

45 
	~<¬·/š‘.h
>

48 
	~"com·t.h
"

49 
	~"pÿp.h
"

50 
	~"‘h”Ãt.h
"

51 
	~"v4.h
"

52 
	~"v”siÚ.h
"

53 
	~"misc_âs.h
"

54 
	~"ts_âs.h
"

55 
	~"fmtx.h
"

57 
pÿ´•Üt_¡»am_¡ruù
 
	tpÿ´•Üt_¡»am_t
;

59 
	#JITTER_BUF_SIZE
 1024

	)

61 
	sj™‹r_–_¡ruù
 {

62 
ušt32_t
 
	mt
;

63 
	md–
;

64 } 
	tj™‹r_–_t
;

66 
	sj™‹r_’v_¡ruù
 {

67 
	mmš_v®
;

68 
	mmax_v®
;

69 
	mš_n
;

70 
	mout_n
;

71 
	mËn
;

72 
j™‹r_–_t
 
	mbuf
[
JITTER_BUF_SIZE
];

73 } 
	tj™‹r_’v_t
;

75 
pÿ´•Üt_£ùiÚ_¡ruù
 
	tpÿ´•Üt_£ùiÚ_t
;

76 
	spÿ´•Üt_£ùiÚ_¡ruù
 {

77 
pÿ´•Üt_£ùiÚ_t
 * 
	mÃxt
;

78 
	m£ùiÚ_no
;

79 
	mpü_couÁ
;

80 
	mj™‹r_max
;

81 
ušt32_t
 
	mpkt_¡¬t
;

82 
ušt32_t
 
	mpkt_fš®
;

83 
ušt64_t
 
	mtime_¡¬t
;

84 
ušt64_t
 
	mtime_fœ¡
;

85 
ušt64_t
 
	mtime_Ï¡
;

86 
ušt64_t
 
	mtime_fš®
;

87 
ušt64_t
 
	mpü_¡¬t
;

88 
ušt64_t
 
	mpü_Ï¡
;

89 
št64_t
 
	mskew_Ï¡
;

90 
št64_t
 
	mskew_mš
;

91 
št64_t
 
	mskew_max
;

92 
ušt64_t
 
	mts_by‹_¡¬t
;

93 
ušt64_t
 
	mts_by‹_fš®
;

94 
št32_t
 
	m¹p_skew_mš
;

95 
št32_t
 
	m¹p_skew_max
;

98 
	spÿ´•Üt_vÏn_šfo_s


100 
ušt16_t
 
	mvid
;

101 
ušt16_t
 
	mcfim­
;

102 
ušt16_t
 
	mpım­
;

103 } 
	tpÿ´•Üt_vÏn_šfo_t
;

105 
	spÿ´•Üt_¹p_šfo_s


107 
ušt16_t
 
	mÏ¡_£q
;

108 
ušt32_t
 
	mn
;

109 
ušt32_t
 
	ms¤c
;

110 
	mmuÉË_s¤c
;

111 } 
	tpÿ´•Üt_¹p_šfo_t
;

114 
	s¹p_h—d”_s


116 
	mis_¹p_ts
;

117 
	mis_¹p_¿w
;

118 
	mm¬k”
;

119 
ušt8_t
 
	m·ylßd_ty³
;

120 
ušt16_t
 
	m£qu’û_numb”
;

121 
ušt32_t
 
	mtime¡amp
;

122 
ušt32_t
 
	ms¤c
;

123 
ušt32_t
 
	mh—d”_Ën
;

124 
ušt32_t
 
	m·d_Ën
;

127 } 
	t¹p_h—d”_t
;

129 
	spÿ´•Üt_¡»am_¡ruù
 {

130 
pÿ´•Üt_¡»am_t
 * 
	mhash_Ãxt
;

132 cÚ¡ *
	mouut_Çme
;

133 
FILE
 *
	mouut_fe
;

134 
ušt32_t
 
	mouut_de¡_addr
;

135 
ušt32_t
 
	mouut_de¡_pÜt
;

137 
FILE
 * 
	mcsv_fe
;

138 cÚ¡ * 
	mcsv_Çme
;

140 
	m¡»am_no
;

141 
	mfÜû
;

142 
	mts_good
;

143 
	m£’_good
;

144 
	m£’_bad
;

145 
	m£’_dodgy
;

146 
	mmuÉË_pü_pids
;

148 
TS_»ad”_p
 
	mts_r
;

150 
ušt32_t
 
	mpü_pid
;

153 
by‹
 *
	mtmp_buf
;

154 
ušt32_t
 
	mtmp_Ën
;

157 
ušt32_t
 
	mts_couÁ”
;

160 
ušt32_t
 
	mpkts_ov”Ëngth
;

163 
št64_t
 
	mskew_discÚtšu™y_th»shŞd
;

165 
št64_t
 
	mÏ¡_time_off£t
;

167 
ušt64_t
 
	mts_by‹s
;

169 
pÿ´•Üt_£ùiÚ_t
 * 
	m£ùiÚ_fœ¡
;

170 
pÿ´•Üt_£ùiÚ_t
 * 
	m£ùiÚ_Ï¡
;

172 
	mvÏn_couÁ
;

173 
pÿ´•Üt_vÏn_šfo_t
 
	mvÏns
[
ETHERNET_VLANS_MAX
];

174 
pÿ´•Üt_¹p_šfo_t
 
	m¹p_šfo
;

176 
j™‹r_’v_t
 
	mj™‹r
;

180 
	spÿ´•Üt_äagm’t_¡ruù


182 
	mš_u£
;

183 
ušt16_t
 
	mid’t
;

184 
ušt16_t
 
	mcu¼’t_Ën
;

185 
by‹
 
	mpkt
[65536];

186 } 
	tpÿ´•Üt_äagm’t_t
;

188 
	spÿ´•Üt_»as£mbly_¡ruù


190 
pÿ´•Üt_äagm’t_t
 
	mäag
;

191 } 
	tpÿ´•Üt_»as£mbly_t
;

195 
	spÿ´•Üt_ùx_¡ruù


197 
	mu£_¡dš
;

198 *
	mšput_Çme
;

199 cÚ¡ * 
	mba£_Çme
;

200 
	mhad_šput_Çme
;

201 
	mexŒaù_d©a
;

202 
	mdump_d©a
;

203 
	mdump_exŒa
;

204 
	mtime_»pÜt
;

205 
	mv”bo£
;

206 
	mª®y£
;

207 
	mexŒaù
;

208 
	m¡»am_couÁ
;

209 
	mcsv_g’
;

210 
	mgood_ts_Úly
;

211 
	mk“p_bad
;

212 
	mfe_¥l™_£ùiÚ
;

213 
PCAP_»ad”_p
 
	mpü—d”
;

214 
pÿp_hdr_t
 
	mpÿp_hdr
;

216 
	mtfmt
;

219 
ušt32_t
 
	mpkt_couÁ”
;

221 
ušt32_t
 
	mf‹r_de¡_addr
;

222 
ušt32_t
 
	mf‹r_de¡_pÜt
;

224 cÚ¡ * 
	mouut_Çme_ba£
;

226 
št64_t
 
	mİt_skew_discÚtšu™y_th»shŞd
;

228 
ušt64_t
 
	mtime_¡¬t
;

229 
ušt32_t
 
	mtime_u£c
;

230 
time_t
 
	mtime_£c
;

232 
ušt8_t
 
	m¹p_¿w_wª‹d
[256];

234 
pÿ´•Üt_¡»am_t
 * 
	m¡»am_hash
[256];

235 
pÿ´•Üt_»as£mbly_t
 
	m»as£mbly_’v
;

236 } 
	tpÿ´•Üt_ùx_t
;

240 
	$j™‹r_v®ue
(cÚ¡ 
j™‹r_’v_t
 * cÚ¡ 
je
)

242  
je
->
max_v®
 - je->
mš_v®
;

243 
	}
}

246 
	$j™‹r_add
(
j™‹r_’v_t
 * cÚ¡ 
je
, cÚ¡ 
d–
, cÚ¡ 
ušt32_t
 
time
, cÚ¡ ušt32_ˆ
¿nge
)

248 
j™‹r_–_t
 * cÚ¡ 
eob
 = 
je
->
buf
 + 
JITTER_BUF_SIZE
;

249 
j™‹r_–_t
 * cÚ¡ 
š_–
 = 
je
->
buf
 + je->
š_n
;

250 
j™‹r_–_t
 * 
out_–
 = 
je
->
buf
 + je->
out_n
;

251 
j™‹r_–_t
 * cÚ¡ 
Ãxt_–
 = (
je
->
š_n
 =ğ
JITTER_BUF_SIZE
 - 1è? je->
buf
 : 
š_–
 + 1;

252 
Ãeds_sÿn
 = 
FALSE
;

256 
š_–
 !ğ
out_–
 && (
time
 - out_–->
t
 > 
¿nge
 || out_– =ğ
Ãxt_–
))

258 ià(
out_–
->
d–
 =ğ
je
->
mš_v®
 || out_–->d– =ğje->
max_v®
)

259 
Ãeds_sÿn
 = 
TRUE
;

262 ià(++
out_–
 >ğ
eob
)

263 
out_–
 = 
je
->
buf
;

266 ià(
Ãeds_sÿn
 || 
š_–
 =ğ
out_–
)

271 cÚ¡ 
j™‹r_–_t
 * 
–
 = 
out_–
;

272 
mš_v®
 = 
d–
;

273 
max_v®
 = 
d–
;

275 
–
 !ğ
š_–
)

277 ià(
–
->
d–
 > 
max_v®
)

278 
max_v®
 = 
–
->
d–
;

279 ià(
–
->
d–
 < 
mš_v®
)

280 
mš_v®
 = 
–
->
d–
;

282 ià(++
–
 >ğ
eob
)

283 
–
 = 
je
->
buf
;

286 
je
->
max_v®
 = max_val;

287 
je
->
mš_v®
 = min_val;

293 ià(
d–
 > 
je
->
max_v®
)

294 
je
->
max_v®
 = 
d–
;

295 ià(
d–
 < 
je
->
mš_v®
)

296 
je
->
mš_v®
 = 
d–
;

300 
š_–
->
t
 = 
time
;

301 
š_–
->
d–
 = delta;

304 
je
->
š_n
 = 
Ãxt_–
 - je->
buf
;

305 
je
->
out_n
 = 
out_–
 - je->
buf
;

307  
	`j™‹r_v®ue
(
je
);

308 
	}
}

311 
	$j™‹r_ş—r
(
j™‹r_’v_t
 * cÚ¡ 
je
)

313 
je
->
š_n
 = 0;

314 
je
->
out_n
 = 0;

315 
je
->
max_v®
 = 0;

316 
je
->
mš_v®
 = 0;

317 
	}
}

319 
ušt64_t


320 
	$pkt_time
(cÚ¡ 
pÿ´ec_hdr_t
 * cÚ¡ 
pÿp_pkt_hdr
)

322  (((
št64_t
)
pÿp_pkt_hdr
->
ts_u£c
*9)/100) +

323 ((
št64_t
)
pÿp_pkt_hdr
->
ts_£c
 * 90000);

324 
	}
}

328 
	$vÏn_Çme
(cÚ¡ * 
´efix
, cÚ¡ 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
, cÚ¡ 
size_t
 
bËn
, * cÚ¡ 
buf
)

330 ià(
¡
->
vÏn_couÁ
 == 0)

332 
buf
[0] = '\0';

336 
i
;

337 
size_t
 
n
 = 
	`¡¾’
(
´efix
);

338 * 
p
 = 
buf
;

339 * cÚ¡ 
eob
 = 
buf
 + 
bËn
;

341 
	`memıy
(
p
, 
´efix
, 
n
);

342 
p
 +ğ
n
;

344 
i
 = 0; i < 
¡
->
vÏn_couÁ
 && 
eob
 - 
p
 > 2; ++i)

346 cÚ¡ 
pÿ´•Üt_vÏn_šfo_t
 * cÚ¡ 
vi
 = 
¡
->
vÏns
 + 
i
;

347 ià(
i
 != 0)

348 *
p
++ = '.';

349 
p
 +ğ
	`¢´štf
Õ, 
eob
 -…, "%d", 
vi
->
vid
);

352  
buf
;

353 
	}
}

357 
	$£ùiÚ_Çme
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, cÚ¡ 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
, * cÚ¡ 
pbuf
, cÚ¡ 
size_t
 
pbuf_Ën
)

359 ià(!
ùx
->
fe_¥l™_£ùiÚ
)

361 *
pbuf
 = '\0';

362  
pbuf
;

365 
	`¢´štf
(
pbuf
, 
pbuf_Ën
, "_S%d", 
¡
->
£ùiÚ_Ï¡
 =ğ
NULL
 ? 0 : st->£ùiÚ_Ï¡->
£ùiÚ_no
);

366  
pbuf
;

367 
	}
}

370 
	$¡»am_g’_Çmes2
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
,

371 cÚ¡ 
¹p_h—d”_t
 * cÚ¡ 
¹p_h—d”
)

373 cÚ¡ 
ušt32_t
 
de¡_addr
 = 
¡
->
ouut_de¡_addr
;

374 cÚ¡ 
ušt32_t
 
de¡_pÜt
 = 
¡
->
ouut_de¡_pÜt
;

375 
pbuf
[32], 
pbuf2
[32];

376 
id’tif›r
[64];

377 cÚ¡ * cÚ¡ 
ba£_Çme
 = 
ùx
->
ouut_Çme_ba£
 !ğ
NULL
 ? ctx->output_name_base : ctx->base_name;

378 cÚ¡ 
size_t
 
ba£_Ën
 = 
	`¡¾’
(
ba£_Çme
);

379 
fixed_exŒaù_Çme
 = 
FALSE
;

381 ià(
ùx
->
f‹r_de¡_addr
 =ğ0 || ctx->
f‹r_de¡_pÜt
 == 0)

383 
	`¢´štf
(
id’tif›r
, 64, "%s_%u.%u.%u.%u_%u%s",

384 
	`vÏn_Çme
("_V", 
¡
, (
pbuf
),…buf),

385 
de¡_addr
 >> 24, (dest_addr >> 16) & 0xff,

386 (
de¡_addr
 >> 8) & 0xff, dest_addr & 0xff,

387 
de¡_pÜt
,

388 
	`£ùiÚ_Çme
(
ùx
, 
¡
, 
pbuf2
, (pbuf2)));

392 
id’tif›r
[0] = '\0';

395 
fixed_exŒaù_Çme
 = (
ùx
->
ouut_Çme_ba£
 !ğ
NULL
);

398 ià(
ùx
->
exŒaù
)

400 * 
Çme
 = 
	`m®loc
(
ba£_Ën
 + 64);

401 
	`memıy
(
Çme
, 
ba£_Çme
, 
ba£_Ën
 + 1);

403 ià(!
fixed_exŒaù_Çme
)

404 
	`¢´štf
(
Çme
 + 
ba£_Ën
, 64, "%s.%s", 
id’tif›r
,

405 (
¹p_h—d”
 !ğ
NULL
 &&„_h—d”->
is_¹p_¿w
) ? "rtp" : "ts");

406 
¡
->
ouut_Çme
 = 
Çme
;

409 ià(
ùx
->
csv_g’
)

411 * 
Çme
 = 
	`m®loc
(
ba£_Ën
 + 64);

412 
	`memıy
(
Çme
, 
ùx
->
ba£_Çme
, 
ba£_Ën
);

413 
	`¢´štf
(
Çme
 + 
ba£_Ën
, 64, "%s.csv", 
id’tif›r
);

414 
¡
->
csv_Çme
 = 
Çme
;

416 
	}
}

419 
	$¡»am_g’_Çmes
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
,

420 cÚ¡ 
¹p_h—d”_t
 * cÚ¡ 
¹p_h—d”
)

423 ià(
ùx
->
exŒaù
 || ctx->
csv_g’
)

424 
	`¡»am_g’_Çmes2
(
ùx
, 
¡
, 
¹p_h—d”
);

425 
	}
}

428 
	$¡»am_şo£_fes
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
)

430 ià(
¡
->
ouut_fe
 !ğ
NULL
)

432 ià(
¡
->
£’_dodgy
 != 0)

434 
	`åršt_msg
(">%d> WARNING: %d dodgy…acket%s writteno: %s\n",

435 
¡
->
¡»am_no
,

436 
¡
->
£’_dodgy
, st->£’_dodgy =ğ1 ? "" : "s", st->
ouut_Çme
);

438 ià(
¡
->
£’_bad
 != 0)

440 
	`åršt_msg
(">%d> WARNING: %d bad…acket%sƒxcluded from: %s\n",

441 
¡
->
¡»am_no
,

442 
¡
->
£’_bad
, st->£’_bad =ğ1 ? "" : "s", st->
ouut_Çme
);

444 
	`fşo£
(
¡
->
ouut_fe
);

445 
¡
->
ouut_fe
 = 
NULL
;

447 ià(
¡
->
csv_fe
 !ğ
NULL
)

449 
	`fşo£
(
¡
->
csv_fe
);

450 
¡
->
csv_fe
 = 
NULL
;

452 
	}
}

456 
pÿ´•Üt_£ùiÚ_t
 *

457 
	$£ùiÚ_ü—‹
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
, cÚ¡ 
pÿ´ec_hdr_t
 * cÚ¡ 
pÿp_pkt_hdr
)

459 
pÿ´•Üt_£ùiÚ_t
 * cÚ¡ 
t£ù
 = 
	`ÿÎoc
(1, (*tsect));

460 
pÿ´•Üt_£ùiÚ_t
 * cÚ¡ 
Ï¡
 = 
¡
->
£ùiÚ_Ï¡
;

462 ià(
ùx
->
fe_¥l™_£ùiÚ
)

463 
	`¡»am_şo£_fes
(
ùx
, 
¡
);

465 ià(
t£ù
 =ğ
NULL
)

466  
NULL
;

470 ià(
Ï¡
 =ğ
NULL
)

473 
¡
->
£ùiÚ_fœ¡
 = 
t£ù
;

478 
t£ù
->
£ùiÚ_no
 = 
Ï¡
->section_no + 1;

479 
Ï¡
->
Ãxt
 = 
t£ù
;

481 
¡
->
£ùiÚ_Ï¡
 = 
t£ù
;

484 
t£ù
->
¹p_skew_max
 = -0x7fffffff;

485 
t£ù
->
¹p_skew_mš
 = 0x7fffffff;

486 
t£ù
->
skew_max
 = -0x7fffffff;

487 
t£ù
->
skew_mš
 = 0x7fffffff;

489 
t£ù
->
time_fš®
 =

490 
t£ù
->
time_¡¬t
 = 
	`pkt_time
(
pÿp_pkt_hdr
);

491 
t£ù
->
pkt_fš®
 =

492 
t£ù
->
pkt_¡¬t
 = 
ùx
->
pkt_couÁ”
;

493 
t£ù
->
ts_by‹_¡¬t
 =

494 
t£ù
->
ts_by‹_fš®
 = 
¡
->
ts_by‹s
;

496 ià(
ùx
->
fe_¥l™_£ùiÚ
 || 
Ï¡
 =ğ
NULL
)

497 
	`¡»am_g’_Çmes
(
ùx
, 
¡
, 
NULL
);

499  
t£ù
;

500 
	}
}

503 
	#SKEW_DISCONTINUITY_THRESHOLD
 (6*90000)

	)

505 
	$dige¡_times_»ad
(*
hªdË
, 
by‹
 *
out_buf
, 
size_t
 
Ën
)

507 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
 = 
hªdË
;

508 
Ä_by‹s
 = (
Ën
 < 
¡
->
tmp_Ën
 ?†en : st->tmp_len);

509 
Ãw_tmp_Ën
 = 
¡
->
tmp_Ën
 - 
Ä_by‹s
;

511 
	`memıy
(
out_buf
, 
¡
->
tmp_buf
, 
Ä_by‹s
);

512 
	`memmove
(
¡
->
tmp_buf
, &¡->tmp_buf[
Ä_by‹s
],

513 
Ãw_tmp_Ën
);

514 
¡
->
tmp_Ën
 = 
Ãw_tmp_Ën
;

517  
Ä_by‹s
;

518 
	}
}

521 
	$dige¡_times_£ek
(*
hªdË
, 
off£t_t
 
v®
)

525 
	}
}

528 
št64_t


529 
	$±s_diff
(cÚ¡ 
ušt64_t
 
a
, cÚ¡ ušt64_ˆ
b
)

531  ((
št64_t
)(
a
 - 
b
) << 31) >> 31;

532 
	}
}

534 
št64_t


535 
	$±s_diff_abs
(cÚ¡ 
ušt64_t
 
a
, cÚ¡ ušt64_ˆ
b
)

537 cÚ¡ 
št64_t
 
t
 = 
	`±s_diff
(
a
, 
b
);

538  
t
 < 0 ? -t :;

539 
	}
}

542 
	$dige¡_times
(
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
,

543 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
,

544 cÚ¡ 
pÿ´ec_hdr_t
 * cÚ¡ 
pÿp_pkt_hdr
,

545 cÚ¡ 
‘h”Ãt_·ck‘_t
 * cÚ¡ 
•kt
,

546 cÚ¡ 
v4_h—d”_t
 * cÚ¡ 
v4_h—d”
,

547 cÚ¡ 
v4_udp_h—d”_t
 * cÚ¡ 
udp_h—d”
,

548 cÚ¡ 
¹p_h—d”_t
 * cÚ¡ 
¹p_h—d”
,

549 cÚ¡ 
by‹
 * cÚ¡ 
d©a
,

550 cÚ¡ 
ušt32_t
 
Ën
)

552 
rv
;

553 
¹p_£q_d–
 = 0;

557 ià(
¹p_h—d”
->
is_¹p_ts
)

559 
pÿ´•Üt_¹p_šfo_t
 * cÚ¡ 
ri
 = &
¡
->
¹p_šfo
;

561 ià(
ri
->
s¤c
 !ğ
¹p_h—d”
->s¤ø&&„i->
n
 !ğ0 && !ri->
muÉË_s¤c
)

563 
	`åršt_msg
("!%d! MuÉË SSRC d‘eùed: SSRCs: %u,%u,...\n", 
¡
->
¡»am_no
,

564 
ri
->
s¤c
, 
¹p_h—d”
->ssrc);

565 
ri
->
muÉË_s¤c
 = 
TRUE
;

568 
¹p_£q_d–
 = 
ri
->
n
 == 0 ? 0 :

569 (
¹p_h—d”
->
£qu’û_numb”
 - (
ri
->
Ï¡_£q
 + 1)) & 0xffffU;

571 ià(
¹p_£q_d–
 != 0)

573 
	`åršt_msg
("!%d! @%u: RTP seq d– (%u->%uè!ğ1\n", 
¡
->
¡»am_no
, 
ùx
->
pkt_couÁ”
,

574 
ri
->
Ï¡_£q
, 
¹p_h—d”
->
£qu’û_numb”
);

577 ++
ri
->
n
;

578 
ri
->
s¤c
 = 
¹p_h—d”
->ssrc;

579 
ri
->
Ï¡_£q
 = 
¹p_h—d”
->
£qu’û_numb”
;

583 ià(
¡
->
ts_r
 =ğ
NULL
)

585 
rv
 = 
	`bud_TS_»ad”_w™h_âs
(
¡
,

586 
dige¡_times_»ad
,

587 
dige¡_times_£ek
,

588 &
¡
->
ts_r
);

589 ià(
rv
)

591 
	`´št_”r
( "###…capreport: Cannot creates„eader.\n");

598 
pkts
 = 
Ën
 / 
TS_PACKET_SIZE
;

599 
pk’
 = 
pkts
 * 
TS_PACKET_SIZE
;

601 ià(
pk’
 !ğ
Ën
)

602 ++
¡
->
pkts_ov”Ëngth
;

604 
¡
->
tmp_buf
 = (
by‹
 *)
	`»®loc
(¡->tmp_buf, st->
tmp_Ën
 + 
pk’
);

605 
	`memıy
(&
¡
->
tmp_buf
[¡->
tmp_Ën
], 
d©a
, 
pk’
);

606 
¡
->
tmp_Ën
 +ğ
pk’
;

612 
by‹
 *
pkt
;

613 
rv
;

615 
rv
 = 
	`»ad_Ãxt_TS_·ck‘
(
¡
->
ts_r
, &
pkt
);

616 ià(
rv
 =ğ
EOF
)

625 cÚ¡ 
ušt64_t
 
t_pü
 = 
	`pkt_time
(
pÿp_pkt_hdr
);

626 
ušt32_t
 
pid
;

627 
pusi
;

628 
by‹
 *
ad­t
;

629 
ad­t_Ën
;

630 
by‹
 *
·ylßd
;

631 
·ylßd_Ën
;

633 
rv
 = 
	`¥l™_TS_·ck‘
(
pkt
, &
pid
, &
pusi
, &
ad­t
, &
ad­t_Ën
,

634 &
·ylßd
, &
·ylßd_Ën
);

635 ià(
rv
)

637 
	`åršt_msg
(">%d> WARNING: TS…acket %d […acket %d @ %d.%d s ] cannot be split.\n",

638 
¡
->
¡»am_no
,

639 
¡
->
ts_couÁ”
, 
ùx
->
pkt_couÁ”
,

640 
pÿp_pkt_hdr
->
ts_£c
,…ÿp_pkt_hdr->
ts_u£c
);

647 ià(
ad­t
 && 
ad­t_Ën
)

649 
has_pü
;

650 
ušt64_t
 
pü
;

651 
št64_t
 
pü_time_off£t
;

653 
	`g‘_PCR_äom_ad­tiÚ_f›ld
(
ad­t
, 
ad­t_Ën
, &
has_pü
,

654 &
pü
);

656 ià(
has_pü
)

658 
št64_t
 
skew
;

660 ià(
ùx
->
time_»pÜt
)

662 
	`åršt_msg
(">%d> Found PCR %Îd‡ˆ%d.%d s \n", 
¡
->
¡»am_no
,

663 
pü
, 
pÿp_pkt_hdr
->
ts_£c
,…ÿp_pkt_hdr->
ts_u£c
);

666 ià(
¡
->
pü_pid
 == 0)

667 
¡
->
pü_pid
 = 
pid
;

669 ià(
pid
 !ğ
¡
->
pü_pid
)

672 ià(!
¡
->
muÉË_pü_pids
)

674 
	`åršt_msg
("!%d! Multiple PCR…ids detected:…ids: %d,%d,...\n",

675 
¡
->
¡»am_no
, st->
pü_pid
, 
pid
);

677 
¡
->
muÉË_pü_pids
 = 
TRUE
;

681 
pÿ´•Üt_£ùiÚ_t
 * 
t£ù
 = 
¡
->
£ùiÚ_Ï¡
;

682 
cur_j™‹r
;

686 
pü
 /= 300;

691 
pü_time_off£t
 = 
	`±s_diff
(
t_pü
, 
pü
);

693 
skew
 = 
t£ù
->
pü_couÁ
 == 0 ? 0LL :

694 
pü_time_off£t
 - 
	`±s_diff
(
t£ù
->
time_fœ¡
,£ù->
pü_¡¬t
);

697 ià(
¡
->
skew_discÚtšu™y_th»shŞd
 > 0 && 
t£ù
->
pü_couÁ
 != 0)

699 cÚ¡ 
št64_t
 
pü_d–
 = 
	`±s_diff_abs
(
pü
, 
t£ù
->
pü_Ï¡
);

700 cÚ¡ 
št64_t
 
time_d–
 = 
	`±s_diff_abs
(
t_pü
, 
t£ù
->
time_Ï¡
);

701 cÚ¡ 
št64_t
 
skew_d–
 = 
skew
 - 
t£ù
->
skew_Ï¡
;

703 ià(
pü_d–
 > 
¡
->
skew_discÚtšu™y_th»shŞd
 ||

704 
time_d–
 > 
¡
->
skew_discÚtšu™y_th»shŞd
 ||

705 
skew_d–
 > 
¡
->
skew_discÚtšu™y_th»shŞd
)

707 
	`£ùiÚ_ü—‹
(
ùx
, 
¡
, 
pÿp_pkt_hdr
);

708 
t£ù
 = 
¡
->
£ùiÚ_Ï¡
;

712 ià(
t£ù
->
pü_couÁ
 == 0)

714 ià(
t£ù
->
£ùiÚ_no
 != 0)

716 
	`åršt_msg
(">%d> Skew discontinuity! Skew = %lld (> %lld)‡t"

718 
¡
->
¡»am_no
,

719 
skew
, 
¡
->
skew_discÚtšu™y_th»shŞd
,

720 
¡
->
ts_couÁ”
, 
ùx
->
pkt_couÁ”
,

721 
pü
, 
pÿp_pkt_hdr
->
ts_£c
,

722 
pÿp_pkt_hdr
->
ts_u£c
);

725 
t£ù
->
pkt_fš®
 = 
ùx
->
pkt_couÁ”
;

726 
t£ù
->
pü_Ï¡
 =

727 
t£ù
->
pü_¡¬t
 = 
pü
;

728 
t£ù
->
time_Ï¡
 =

729 
t£ù
->
time_fœ¡
 = 
t_pü
;

731 
	`j™‹r_ş—r
(&
¡
->
j™‹r
);

732 
skew
 = 0;

733 
¡
->
Ï¡_time_off£t
 = 0;

738 
cur_j™‹r
 = 
	`j™‹r_add
(&
¡
->
j™‹r
, ()
skew
,

739 (
ušt32_t
)(
t_pü
 & 0xffffffffU), 90000 * 10);

741 ià(
t£ù
->
skew_max
 < 
skew
)

742 
t£ù
->
skew_max
 = 
skew
;

743 ià(
t£ù
->
skew_mš
 > 
skew
)

744 
t£ù
->
skew_mš
 = 
skew
;

746 ià(
t£ù
->
j™‹r_max
 < 
cur_j™‹r
)

747 
t£ù
->
j™‹r_max
 = 
cur_j™‹r
;

749 ià(
¹p_h—d”
->
is_¹p_ts
)

752 
št32_t
 
¹p_skew
 = (št32_t)(
¹p_h—d”
->
time¡amp
 - (
ušt32_t
)(
t_pü
 & 0xffffffffU));

753 ià(
t£ù
->
¹p_skew_max
 < 
¹p_skew
)

754 
t£ù
->
¹p_skew_max
 = 
¹p_skew
;

755 ià(
t£ù
->
¹p_skew_mš
 > 
¹p_skew
)

756 
t£ù
->
¹p_skew_mš
 = 
¹p_skew
;

759 ià(
ùx
->
time_»pÜt
)

761 
št64_t
 
»l_tim
 = 
t_pü
 - 
t£ù
->
time_fœ¡
;

762 
skew_¿‹
 = (
»l_tim
 == 0) ? 0.0 :

763 ()
skew
 / (()(()
»l_tim
 / (60*90000)));

765 
	`åršt_msg
(">%d> [ts %d‚et %d ] PCR %lld Time %d.%d [rel %d.%d] - skew = %lld (delta = %lld,„ate = %.4g PTS/min) - jitter=%u\n",

766 
¡
->
¡»am_no
,

767 
¡
->
ts_couÁ”
, 
ùx
->
pkt_couÁ”
,

768 
pü
,

769 
pÿp_pkt_hdr
->
ts_£c
,…ÿp_pkt_hdr->
ts_u£c
,

770 ()(
»l_tim
 / (
št64_t
)1000000),

771 ()
»l_tim
%1000000,

772 
skew
, 
pü_time_off£t
 - 
¡
->
Ï¡_time_off£t
,

773 
skew_¿‹
, 
cur_j™‹r
);

776 ià(
¡
->
csv_Çme
 !ğ
NULL
)

778 ià(
¡
->
csv_fe
 =ğ
NULL
)

780 ià((
¡
->
csv_fe
 = 
	`fİ’
(¡->
csv_Çme
, "wt")è=ğ
NULL
)

782 
	`åršt_”r
("###…capreport: Cannot open %s .\n",

783 
¡
->
csv_Çme
);

784 
	`ex™
(1);

786 
	`årštf
(
¡
->
csv_fe
, "\"PKT\",\"Time\",\"PCR\",\"Skew\",\"Jitter\"\n");

788 
	`årštf
(
¡
->
csv_fe
, "%d," 
LLU_FORMAT
 "," LLU_FORMAT "," 
LLD_FORMAT
 ",%u\n", 
ùx
->
pkt_couÁ”
,

789 
t_pü
 - 
ùx
->
time_¡¬t
, 
pü
, 
skew
, 
cur_j™‹r
);

793 
t£ù
->
pü_Ï¡
 = 
pü
;

794 
t£ù
->
time_Ï¡
 = 
t_pü
;

795 
t£ù
->
skew_Ï¡
 = 
skew
;

797 
¡
->
Ï¡_time_off£t
 = 
pü_time_off£t
;

798 ++
t£ù
->
pü_couÁ
;

805 ++
¡
->
ts_couÁ”
;

806 
¡
->
ts_by‹s
 +ğ
TS_PACKET_SIZE
;

809 
pÿ´•Üt_£ùiÚ_t
 * cÚ¡ 
t£ù
 = 
¡
->
£ùiÚ_Ï¡
;

810 ià(
t£ù
 !ğ
NULL
)

812 
t£ù
->
time_fš®
 = 
t_pü
;

813 
t£ù
->
ts_by‹_fš®
 = 
¡
->
ts_by‹s
;

814 
t£ù
->
pkt_fš®
 = 
ùx
->
pkt_couÁ”
;

820 
	}
}

822 
	$wr™e_out_·ck‘
(
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
,

823 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
,

824 cÚ¡ 
by‹
 *
d©a
,

825 cÚ¡ 
ušt32_t
 
Ën
)

827 
rv
;

828 
pkts
 = 
Ën
 / 188;

830 ià(
¡
->
ouut_Çme
)

832 ià(
¡
->
ouut_fe
 =ğ
NULL
)

834 
	`åršt_msg
("pcapreport: Dumping %s…ackets for %s:%do %s\n",

835 
ùx
->
good_ts_Úly
 ? "goods" : ctx->
k“p_bad
 ? "all" : "ts",

836 
	`v4_addr_to_¡ršg
(
¡
->
ouut_de¡_addr
),

837 
¡
->
ouut_de¡_pÜt
,

838 
¡
->
ouut_Çme
);

839 
¡
->
ouut_fe
 = 
	`fİ’
(¡->
ouut_Çme
, "wb");

840 ià(!
¡
->
ouut_fe
)

842 
	`åršt_”r
("###…capreport: Cannot open %s .\n",

843 
¡
->
ouut_Çme
);

848 ià(
ùx
->
v”bo£
)

850 
	`åršt_msg
("++ Dumpšg %d by‹ tØouuˆfe.\n", 
Ën
);

852 
rv
 = 
	`fwr™e
(
d©a
, 188, 
pkts
, 
¡
->
ouut_fe
);

853 ià(
rv
 !ğ
pkts
)

855 
	`åršt_”r
( "###…capreport: Couldn't write %d bytes"

857 
Ën
, 
¡
->
ouut_Çme
,

858 
	`ã¼Ü
(
¡
->
ouut_fe
));

863 
	}
}

866 
	$¡»am_ts_check
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
,

867 cÚ¡ 
by‹
 * cÚ¡ 
d©a
,

868 cÚ¡ 
ušt32_t
 
Ën
)

870 cÚ¡ 
by‹
 * 
±r
;

871 
good
 = 0;

872 
bad
 = 0;

874 ià(
¡
->
fÜû
)

875 
¡
->
ts_good
 = 10;

877 ià(
Ën
 % 188 != 0)

878 ++
bad
;

880 ++
good
;

882 
±r
 = 
d©a
;…Œ < d©¨+ 
Ën
;…tr += 188)

884 ià(*
±r
 != 0x47)

885 ++
bad
;

887 ++
good
;

890 
¡
->
ts_good
 +ğ
good
 - 
bad
;

892 ià(
¡
->
ts_good
 > 10)

893 
¡
->
ts_good
 = 10;

894 ià(
¡
->
ts_good
 < -10)

895 
¡
->
ts_good
 = -10;

897 ià(
¡
->
ts_good
 <ğ0 || (
bad
 !ğ0 && 
ùx
->
good_ts_Úly
))

899 ++
¡
->
£’_bad
;

900  
FALSE
;

903 ià(
bad
 != 0)

904 ++
¡
->
£’_dodgy
;

905 ++
¡
->
£’_good
;

906  
TRUE
;

907 
	}
}

913 
	$wr™e_¹p_¿w_·ck‘
(
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
,

914 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
,

915 cÚ¡ 
by‹
 *
d©a
,

916 cÚ¡ 
ušt32_t
 
Ën
)

918 ià(
¡
->
ouut_Çme
)

920 
rv
;

922 ià(
¡
->
ouut_fe
 =ğ
NULL
)

924 
	`åršt_msg
("pcapreport: Dumping„aw RTP…ackets for %s:%do %s\n",

925 
	`v4_addr_to_¡ršg
(
¡
->
ouut_de¡_addr
),

926 
¡
->
ouut_de¡_pÜt
,

927 
¡
->
ouut_Çme
);

928 
¡
->
ouut_fe
 = 
	`fİ’
(¡->
ouut_Çme
, "wb");

929 ià(!
¡
->
ouut_fe
)

931 
	`åršt_”r
("###…capreport: Cannot open %s .\n",

932 
¡
->
ouut_Çme
);

937 ià(
ùx
->
v”bo£
)

939 
	`åršt_msg
("++ Dumpšg %d by‹ tØouuˆfe.\n", 
Ën
);

944 
by‹
 
hdr
[8];

945 
hdr
[0] = 'R';

946 
hdr
[1] = 'T';

947 
hdr
[2] = 'P';

948 
hdr
[3] = ' ';

949 
hdr
[4] = (
Ën
 >> 24) & 0xff;

950 
hdr
[5] = (
Ën
 >> 16) & 0xff;

951 
hdr
[6] = (
Ën
 >> 8) & 0xff;

952 
hdr
[7] = 
Ën
 & 0xff;

953 
rv
 = 
	`fwr™e
(
hdr
, (hdr), 1, 
¡
->
ouut_fe
);

954 ià(
rv
 != 1)

956 
	`åršt_”r
( "###…capreport: Couldn't write RTP hdr bytes"

958 
¡
->
ouut_Çme
,

959 
	`ã¼Ü
(
¡
->
ouut_fe
));

964 
rv
 = 
	`fwr™e
(
d©a
, 1, 
Ën
, 
¡
->
ouut_fe
);

965 ià(
rv
 !ğ
Ën
)

967 
	`åršt_”r
( "###…capreport: Couldn't write %d bytes"

969 
Ën
, 
¡
->
ouut_Çme
,

970 
	`ã¼Ü
(
¡
->
ouut_fe
));

976 
	}
}

979 
	$¡»am_¹p_check
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
,

980 cÚ¡ 
by‹
 * cÚ¡ 
d©a
,

981 cÚ¡ 
ušt32_t
 
Ën
,

982 
¹p_h—d”_t
 * cÚ¡ 
rh
)

984 
ušt32_t
 
off£t
;

985 
ušt32_t
 
·dËn
 = 0;

986 
·ylßd_ty³
;

987 
is_¿w
 = 
FALSE
;

990 
	`mem£t
(
rh
, 0, (*rh));

993 ià(
Ën
 < 12)

994  
FALSE
;

998 ià((
d©a
[0] & 0xc0) != 0x80)

999  
FALSE
;

1001 
·ylßd_ty³
 = 
d©a
[1] & 0x7f;

1002 ià(
ùx
->
¹p_¿w_wª‹d
[
·ylßd_ty³
] != 0)

1003 
is_¿w
 = 
TRUE
;

1004 ià((
d©a
[1] & 0x7f) != 33)

1005  
FALSE
;

1010 
off£t
 = 12 + (
d©a
[0] & 0xf) * 4;

1013 ià((
d©a
[0] & 0x20) != 0)

1015 
·dËn
 = 
d©a
[
Ën
 - 1];

1017 ià(
·dËn
 == 0)

1018  
FALSE
;

1022 ià((
d©a
[0] & 0x10) != 0)

1024 ià(
off£t
 + 4 + 
·dËn
 > 
Ën
)

1025  
FALSE
;

1027 
off£t
 +ğ4 + 
	`ušt_16_be
(
d©a
 + offset + 2);

1031 ià(!
is_¿w
 && (
off£t
 + 188 + 
·dËn
 > 
Ën
 || 
d©a
[offset] != 0x47))

1032  
FALSE
;

1034 
rh
->
is_¹p_¿w
 = 
is_¿w
;

1035 
rh
->
is_¹p_ts
 = !
is_¿w
;

1036 
rh
->
m¬k”
 = ((
d©a
[1] & 0x80) != 0);

1037 
rh
->
·ylßd_ty³
 = (
ušt8_t
)payload_type;

1038 
rh
->
£qu’û_numb”
 = 
	`ušt_16_be
(
d©a
 + 2);

1039 
rh
->
time¡amp
 = 
	`ušt_32_be
(
d©a
 + 4);

1040 
rh
->
s¤c
 = 
	`ušt_32_be
(
d©a
 + 8);

1041 
rh
->
h—d”_Ën
 = 
off£t
;

1042 
rh
->
·d_Ën
 = 
·dËn
;

1044  
TRUE
;

1045 
	}
}

1048 
	$¡»am_m”ge_vÏn_šfo
(
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
, cÚ¡ 
‘h”Ãt_·ck‘_t
 * cÚ¡ 
•kt
)

1050 
i
;

1051 
i
 = 0; i < 
•kt
->
vÏn_couÁ
; ++i)

1053 
¡
->
vÏns
[
i
].
cfim­
 |ğ(1 << 
•kt
->vÏns[i].
cfi
);

1054 
¡
->
vÏns
[
i
].
pım­
 |ğ(1 << 
•kt
->vÏns[i].
pı
);

1056 
	}
}

1062 
	$¡»am_şo£
(
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, 
pÿ´•Üt_¡»am_t
 ** 
p¡
)

1064 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
 = *
p¡
;

1067 *
p¡
 = 
¡
->
hash_Ãxt
;

1071 
pÿ´•Üt_£ùiÚ_t
 * 
p
 = 
¡
->
£ùiÚ_fœ¡
;

1072 
p
 !ğ
NULL
)

1074 
pÿ´•Üt_£ùiÚ_t
 * 
Å
 = 
p
->
Ãxt
;

1075 
	`ä“
(
p
);

1076 
p
 = 
Å
;

1079 
	`¡»am_şo£_fes
(
ùx
, 
¡
);

1081 ià(
¡
->
csv_Çme
 !ğ
NULL
)

1082 
	`ä“
((*)
¡
->
csv_Çme
);

1083 ià(
¡
->
ouut_Çme
 !ğ
NULL
)

1084 
	`ä“
((*)
¡
->
ouut_Çme
);

1085 
	`ä“
(
¡
);

1086 
	}
}

1089 
pÿ´•Üt_¡»am_t
 *

1090 
	$¡»am_ü—‹
(
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, cÚ¡ 
pÿ´ec_hdr_t
 * cÚ¡ 
pÿp_pkt_hdr
,

1091 cÚ¡ 
‘h”Ãt_·ck‘_t
 * cÚ¡ 
•kt
, 
ušt32_t
 cÚ¡ 
de¡_addr
, cÚ¡ ušt32_ˆ
de¡_pÜt
)

1093 
i
;

1094 
pÿ´•Üt_¡»am_t
 * 
¡
 = 
	`ÿÎoc
(1, (*st));

1095 
¡
->
¡»am_no
 = 
ùx
->
¡»am_couÁ
++;

1096 
¡
->
ouut_de¡_addr
 = 
de¡_addr
;

1097 
¡
->
ouut_de¡_pÜt
 = 
de¡_pÜt
;

1098 
¡
->
vÏn_couÁ
 = 
•kt
->vlan_count;

1099 
i
 = 0; i < 
•kt
->
vÏn_couÁ
; ++i)

1101 
¡
->
vÏns
[
i
].
vid
 = 
•kt
->vlans[i].vid;

1105 
¡
->
skew_discÚtšu™y_th»shŞd
 = 
ùx
->
İt_skew_discÚtšu™y_th»shŞd
;

1106 
¡
->
fÜû
 = 
ùx
->
k“p_bad
;

1110 ià(
	`£ùiÚ_ü—‹
(
ùx
, 
¡
, 
pÿp_pkt_hdr
è=ğ
NULL
)

1112 
	`¡»am_şo£
(
ùx
, &
¡
);

1113  
NULL
;

1116  
¡
;

1117 
	}
}

1120 
	$m­_to_¡ršg
(
n
, cÚ¡ 
size_t
 
bËn
, * cÚ¡ 
buf
)

1122 
i
 = 0;

1123 * 
p
 = 
buf
;

1124 * cÚ¡ 
eob
 = 
buf
 + 
bËn
;

1125 
fœ¡
 = 
TRUE
;

1127 
n
 !ğ0 && 
eob
 - 
p
 > 2)

1129 ià((
n
 & 1) != 0)

1131 ià(!
fœ¡
)

1132 *
p
++ = ',';

1133 
p
 +ğ
	`¢´štf
Õ, 
eob
 -…, "%d", 
i
);

1134 
fœ¡
 = 
FALSE
;

1136 
n
 >>= 1;

1137 ++
i
;

1139  
buf
;

1140 
	}
}

1143 
	$¡»am_ª®ysis
(cÚ¡ 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
, cÚ¡ 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
)

1145 
ušt32_t
 
de¡_addr
 = 
¡
->
ouut_de¡_addr
;

1146 
pbuf
[32];

1148 ià(
ùx
->
v”bo£
 < 1 && 
¡
->
£’_good
 == 0)

1151 
	`åršt_msg
("Stream %d: Dest:%s %u.%u.%u.%u:%u\n",

1152 
¡
->
¡»am_no
,

1153 
	`vÏn_Çme
(" VLAN:", 
¡
, (
pbuf
),…buf),

1154 
de¡_addr
 >> 24, (dest_addr >> 16) & 0xff,

1155 (
de¡_addr
 >> 8) & 0xff, dest_addr & 0xff,

1156 
¡
->
ouut_de¡_pÜt
);

1157 ià(
¡
->
vÏn_couÁ
 != 0)

1159 
i
;

1161 
i
 = 0; i < 
¡
->
vÏn_couÁ
; ++i)

1163 cÚ¡ 
pÿ´•Üt_vÏn_šfo_t
 * cÚ¡ 
vi
 = 
¡
->
vÏns
 + 
i
;

1164 
pbuf1
[64], 
pbuf2
[64];

1166 
	`åršt_msg
(" VLAN %d: cfi:[%s],…ı[%s]\n", 
vi
->
vid
,

1167 
	`m­_to_¡ršg
(
vi
->
cfim­
, (
pbuf1
),…buf1), m­_to_¡ršg(vi->
pım­
, (
pbuf2
),…buf2));

1171 ià(
¡
->
£’_good
 == 0)

1174 
	`åršt_msg
(" NØTS d‘eùed: Pkts=%u\n", 
¡
->
£’_bad
);

1178 cÚ¡ 
pÿ´•Üt_£ùiÚ_t
 * 
t£ù
;

1180 
	`åršt_msg
(" Pkts: Good=%d, Dodgy=%d, Bad=%d, Overlength=%u\n",

1181 
¡
->
£’_good
 - st->
£’_dodgy
, st->£’_dodgy, st->
£’_bad
, st->
pkts_ov”Ëngth
);

1183 ià(
¡
->
¹p_šfo
.
n
 != 0)

1185 cÚ¡ 
pÿ´•Üt_¹p_šfo_t
 * cÚ¡ 
ri
 = &
¡
->
¹p_šfo
;

1186 
	`åršt_msg
(" RTP TS…ack‘s: %d, SSRC: %u%s\n", 
ri
->
n
,„i->
s¤c
,„i->
muÉË_s¤c
 ? "..." : "");

1189 
	`åršt_msg
(" PCR PID: %d (%#x)%s\n", 
¡
->
pü_pid
, st->pcr_pid,

1190 !
¡
->
muÉË_pü_pids
 ? "" : " ### Other PCR PIDs in stream -‚otracked");

1192 
t£ù
 = 
¡
->
£ùiÚ_fœ¡
;£ù !ğ
NULL
;£ù =£ù->
Ãxt
)

1194 
ušt64_t
 
time_off£t
 = 
ùx
->
time_¡¬t
;

1195 
št64_t
 
time_Ën
 = 
t£ù
->
time_Ï¡
 -£ù->
time_fœ¡
;

1196 
št64_t
 
time_Ën2
 = 
t£ù
->
time_fš®
 -£ù->
time_¡¬t
;

1197 
št64_t
 
pü_Ën
 = 
	`±s_diff
(
t£ù
->
pü_Ï¡
,£ù->
pü_¡¬t
);

1198 
št64_t
 
driá
 = 
time_Ën
 - 
pü_Ën
;

1199 
	`åršt_msg
(" SeùiÚ %d:\n", 
t£ù
->
£ùiÚ_no
);

1200 
	`åršt_msg
(" Pkts: %u->%u\n", 
t£ù
->
pkt_¡¬t
,£ù->
pkt_fš®
);

1201 
	`åršt_msg
(" TS By‹s: %Îu (%Îu b™s/£c)\n", 
t£ù
->
ts_by‹_fš®
 -£ù->
ts_by‹_¡¬t
,

1202 
time_Ën2
 =ğ0LL ? 0LL : (
t£ù
->
ts_by‹_fš®
 -£ù->
ts_by‹_¡¬t
) * 8ULL * 90000ULL /ime_len2);

1203 
	`åršt_msg
(" Time (Total): %s->%s (%s)\n",

1204 
	`fmtx_time¡amp
(
t£ù
->
time_¡¬t
 - 
time_off£t
, 
ùx
->
tfmt
),

1205 
	`fmtx_time¡amp
(
t£ù
->
time_fš®
 - 
time_off£t
, 
ùx
->
tfmt
),

1206 
	`fmtx_time¡amp
(
time_Ën2
, 
ùx
->
tfmt
));

1207 ià(
t£ù
->
pü_couÁ
 == 0)

1209 
	`åršt_msg
(" No PCRs seen\n");

1213 
	`åršt_msg
(" Time (PCRs): %s->%s (%s)\n",

1214 
	`fmtx_time¡amp
(
t£ù
->
time_fœ¡
 - 
time_off£t
, 
ùx
->
tfmt
),

1215 
	`fmtx_time¡amp
(
t£ù
->
time_Ï¡
 - 
time_off£t
, 
ùx
->
tfmt
),

1216 
	`fmtx_time¡amp
(
time_Ën
, 
ùx
->
tfmt
));

1217 
	`åršt_msg
(" PCR[count=%u]: %s->%s (%s)\n",

1218 
t£ù
->
pü_couÁ
,

1219 
	`fmtx_time¡amp
(
t£ù
->
pü_¡¬t
, 
ùx
->
tfmt
),

1220 
	`fmtx_time¡amp
(
t£ù
->
pü_Ï¡
, 
ùx
->
tfmt
),

1221 
	`fmtx_time¡amp
(
pü_Ën
, 
ùx
->
tfmt
));

1222 
	`åršt_msg
(" Drift: diff=%s;„ate=%s/min; 1s…er %llds%s\n",

1223 
	`fmtx_time¡amp
(
time_Ën
 - 
pü_Ën
, 
ùx
->
tfmt
),

1224 
	`fmtx_time¡amp
(
time_Ën
 =ğ0 ? 0LL : 
driá
 * 60LL * 90000LL /ime_Ën, 
ùx
->
tfmt
),

1225 
driá
 =ğ0 ? 0LL : 
time_Ën
 / drift,

1226 
driá
 == 0 ? "" : drift < 0 ? " (fast)" : " (slow)");

1227 
	`åršt_msg
(" Max j™‹r: %s; Skew mš: %s, max: %s\n", 
	`fmtx_time¡amp
(
t£ù
->
j™‹r_max
, 
ùx
->
tfmt
),

1228 
	`fmtx_time¡amp
(
t£ù
->
skew_mš
, 
ùx
->
tfmt
),

1229 
	`fmtx_time¡amp
(
t£ù
->
skew_max
, 
ùx
->
tfmt
));

1231 ià(
¡
->
¹p_šfo
.
n
 != 0)

1233 
	`åršt_msg
(" PCR/RTP skew: min=%s max=%s (diff=%s)\n",

1234 
	`fmtx_time¡amp
(
t£ù
->
¹p_skew_mš
, 
ùx
->
tfmt
),

1235 
	`fmtx_time¡amp
(
t£ù
->
¹p_skew_max
, 
ùx
->
tfmt
),

1236 
	`fmtx_time¡amp
(
t£ù
->
¹p_skew_max
 -£ù->
¹p_skew_mš
, 
ùx
->
tfmt
));

1241 
	`åršt_msg
("\n");

1242 
	}
}

1246 
	$¡»am_hash
(
ušt32_t
 cÚ¡ 
de¡_addr
, cÚ¡ ušt32_ˆ
de¡_pÜt
)

1248 
ušt32_t
 
x
 = 
de¡_addr
 ^ 
de¡_pÜt
;

1249 
x
 ^= x >> 16;

1250  (
x
 ^ (x >> 8)) & 0xff;

1251 
	}
}

1254 
	$¡»am_vÏn_m©ch
(cÚ¡ 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
, cÚ¡ 
‘h”Ãt_·ck‘_t
 * cÚ¡ 
•kt
)

1256 
i
;

1258 ià(
•kt
->
vÏn_couÁ
 !ğ
¡
->vlan_count)

1259  
FALSE
;

1261 
i
 = 0; i < 
•kt
->
vÏn_couÁ
; ++i)

1263 ià(
•kt
->
vÏns
[
i
].
vid
 !ğ
¡
->vlans[i].vid)

1264  
FALSE
;

1266  
TRUE
;

1267 
	}
}

1269 
pÿ´•Üt_¡»am_t
 *

1270 
	$¡»am_fšd
(
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
,

1271 cÚ¡ 
pÿ´ec_hdr_t
 * cÚ¡ 
pÿp_pkt_hdr
, cÚ¡ 
‘h”Ãt_·ck‘_t
 * cÚ¡ 
•kt
,

1272 
ušt32_t
 cÚ¡ 
de¡_addr
, cÚ¡ ušt32_ˆ
de¡_pÜt
)

1274 cÚ¡ 
h
 = 
	`¡»am_hash
(
de¡_addr
, 
de¡_pÜt
);

1275 
pÿ´•Üt_¡»am_t
 ** 
p¡
 = 
ùx
->
¡»am_hash
 + 
h
;

1276 
pÿ´•Üt_¡»am_t
 * 
¡
;

1278 (
¡
 = *
p¡
è!ğ
NULL
)

1280 ià(
¡
->
ouut_de¡_addr
 =ğ
de¡_addr
 && st->
ouut_de¡_pÜt
 =ğ
de¡_pÜt
 &&

1281 
	`¡»am_vÏn_m©ch
(
¡
, 
•kt
))

1283  
¡
;

1285 
p¡
 = &
¡
->
hash_Ãxt
;

1288 ià((
¡
 = 
	`¡»am_ü—‹
(
ùx
, 
pÿp_pkt_hdr
, 
•kt
, 
de¡_addr
, 
de¡_pÜt
)è=ğ
NULL
)

1289  
NULL
;

1291 *
p¡
 = 
¡
;

1292  
¡
;

1293 
	}
}

1296 
	$¡»am_sÜt_â
(cÚ¡ *
va
, cÚ¡ * 
vb
)

1298 cÚ¡ 
pÿ´•Üt_¡»am_t
 * cÚ¡ * cÚ¡ 
·
 = 
va
;

1299 cÚ¡ 
pÿ´•Üt_¡»am_t
 * cÚ¡ * cÚ¡ 
pb
 = 
vb
;

1300  (*
·
)->
¡»am_no
 - (*
pb
)->stream_no;

1301 
	}
}

1304 
	$_»as£mbË
(
pÿ´•Üt_»as£mbly_t
 * cÚ¡ 
»as
, cÚ¡ 
v4_h—d”_t
 * cÚ¡ 

, 
by‹
 * cÚ¡ 
š_d©a
,

1305 
by‹
 ** cÚ¡ 
out_pd©a
, 
ušt32_t
 * cÚ¡ 
out_¶’
)

1307 
ušt32_t
 
äag_Ën
 = 

->
Ëngth
 - ip->
hdr_Ëngth
 * 4;

1308 
ušt32_t
 
äag_off£t
 = 

->frag_offset * 8;

1309 
äag_fš®
 = (

->
æags
 & 1) == 0;

1312 *
out_pd©a
 = (*)
NULL
;

1313 *
out_¶’
 = 0;

1315 ià(
äag_fš®
 && 
äag_off£t
 == 0)

1318 *
out_pd©a
 = 
š_d©a
;

1319 *
out_¶’
 = 
äag_Ën
;

1323 ià((
äag_Ën
 & 7è!ğ0 && !
äag_fš®
)

1326 
	`åršt_”r
("### NÚ-fš® f¿gm’ˆw™h bad†’gth: %d\n", 
äag_Ën
);

1330 ià(
äag_Ën
 + 
äag_off£t
 >= 0x10000)

1334 
	`åršt_”r
("### F¿gm’ˆ’d >ğ64k: %d+%d\n", 
äag_off£t
, 
äag_Ën
);

1340 
pÿ´•Üt_äagm’t_t
 * 
äag
 = &
»as
->frag;

1342 ià(
äag
->
š_u£
 && f¿g->
id’t
 !ğ

->ident)

1344 
	`åršt_”r
("### Multi-packet fragment„eassembly NIF -…revious…acket discarded\n");

1345 
äag
->
š_u£
 = 0;

1349 ià(!
äag
->
š_u£
)

1351 
äag
->
š_u£
 = 1;

1352 
äag
->
cu¼’t_Ën
 = 0;

1353 
äag
->
id’t
 = 

->ident;

1356 ià(
äag
->
cu¼’t_Ën
 !ğ
äag_off£t
)

1358 
	`åršt_”r
("### Reordering fragment„eassembly NIF -…acket discarded\n");

1359 
äag
->
š_u£
 = 0;

1363 
äag
->
cu¼’t_Ën
 = 
äag_off£t
 + 
äag_Ën
;

1365 
	`memıy
(
äag
->
pkt
 + 

->
äag_off£t
 * 8, 
š_d©a
, 
äag_Ën
);

1367 ià(!
äag_fš®
)

1370 *
out_pd©a
 = 
äag
->
pkt
;

1371 *
out_¶’
 = 
äag
->
cu¼’t_Ën
;

1372 
äag
->
š_u£
 = 0;

1375 
	}
}

1378 
	$_»as£mbly_š™
(
pÿ´•Üt_»as£mbly_t
 * cÚ¡ 
»as
)

1380 
	`mem£t
(
»as
, 0, (*reas));

1382 
	}
}

1385 
	$´št_u§ge
()

1387 
	`´št_msg
(

1391 
	`REPORT_VERSION
("pcapreport");

1392 
	`´št_msg
(

1441 
	}
}

1443 
	gmª·ge
[] =

1501 cÚ¡ *
	gÚech¬¬g
[26] =

1532 
	$maš
(
¬gc
, **
¬gv
)

1534 
”r
 = 0;

1535 
ii
 = 1;

1536 
pÿ´•Üt_ùx_t
 
sùx
 = {0};

1537 
pÿ´•Üt_ùx_t
 * cÚ¡ 
ùx
 = &
sùx
;

1539 
ùx
->
İt_skew_discÚtšu™y_th»shŞd
 = 
SKEW_DISCONTINUITY_THRESHOLD
;

1540 
ùx
->
tfmt
 = 
FMTX_TS_DISPLAY_90kHz_RAW
;

1541 
ùx
->
¹p_¿w_wª‹d
[96] = 1;

1543 
	`_»as£mbly_š™
(&
ùx
->
»as£mbly_’v
);

1545 ià(
¬gc
 < 2)

1547 
	`´št_u§ge
();

1551 
ii
 < 
¬gc
)

1553 ià(
¬gv
[
ii
][0] == '-')

1556 cÚ¡ 
c
 = 
¬gv
[
ii
][1];

1557 cÚ¡ * cÚ¡ 
¬g
 = 
c
 >ğ'a' && c <ğ'z' && 
¬gv
[
ii
][2] =ğ0 ? 
Úech¬¬g
[c - 'a'] :

1558 
¬gv
[
ii
][1] == '-' ?‡rgv[ii] + 2 :‡rgv[ii] + 1;

1560 ià(
	`¡rcmp
("h–p", 
¬g
) == 0)

1562 ià(
ii
 + 1 < 
¬gc
 && 
	`¡rcmp
("d‘a", 
¬gv
[ii + 1]) == 0)

1564 
	`fwr™e
(
mª·ge
, (mª·ge), 1, 
¡dout
);

1565 
	`ex™
(0);

1567 
	`´št_u§ge
();

1570 ià(!
	`¡rcmp
("”r",
¬g
))

1572 
	`CHECKARG
("pÿ´•Üt",
ii
);

1573 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

1574 
	`»dœeù_ouut_¡d”r
();

1575 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

1576 
	`»dœeù_ouut_¡dout
();

1579 
	`åršt_”r
("###…capreport: "

1581 " '¡d”r')\n",
¬gv
[
ii
+1]);

1584 
ii
++;

1586 ià(!
	`¡rcmp
("ouut", 
¬g
))

1588 
	`CHECKARG
("pÿ´•Üt",
ii
);

1589 
ùx
->
ouut_Çme_ba£
 = 
¬gv
[++
ii
];

1590 
ùx
->
exŒaù_d©a
 = 
TRUE
;

1592 ià(!
	`¡rcmp
("times", 
¬g
))

1594 ++
ùx
->
time_»pÜt
;

1596 ià(!
	`¡rcmp
("ª®y£", 
¬g
))

1598 
ùx
->
ª®y£
 = 
TRUE
;

1600 ià(!
	`¡rcmp
("v”bo£", 
¬g
))

1602 ++
ùx
->
v”bo£
;

1604 ià(!
	`¡rcmp
("de¡", 
¬g
))

1606 *
ho¡Çme
;

1607 
pÜt
 = 0;

1609 
	`CHECKARG
("pÿ´•Üt",
ii
);

1610 
”r
 = 
	`ho¡_v®ue
("pÿ´•Üt", 
¬gv
[
ii
],‡rgv[ii+1], &
ho¡Çme
, &
pÜt
);

1611 ià(
”r
)  1;

1612 ++
ii
;

1614 
ùx
->
f‹r_de¡_pÜt
 = 
pÜt
;

1615 ià(
	`v4_¡ršg_to_addr
(&
ùx
->
f‹r_de¡_addr
, 
ho¡Çme
))

1617 
	`åršt_”r
( "###…capreport: '%s' is‚ot‡ host IP‡ddress (names‡re‚ot‡llowed!)\n",

1618 
ho¡Çme
);

1622 ià(!
	`¡rcmp
("dump-d©a", 
¬g
) || !strcmp("D",‡rg))

1624 ++
ùx
->
dump_d©a
;

1626 ià(!
	`¡rcmp
("exŒa-dump", 
¬g
) || !strcmp("E",‡rg))

1628 ++
ùx
->
dump_exŒa
;

1630 ià(!
	`¡rcmp
("skew-discÚtšu™y-th»shŞd", 
¬g
) ||

1631 !
	`¡rcmp
("skew", 
¬g
))

1633 
v®
;

1634 
	`CHECKARG
("pÿ´•Üt",
ii
);

1635 
”r
 = 
	`št_v®ue
("pÿ´•Üt", 
¬gv
[
ii
],‡rgv[ii+1], 
TRUE
, 0, &
v®
);

1636 ià(
”r
)  1;

1637 
ùx
->
İt_skew_discÚtšu™y_th»shŞd
 = 
v®
;

1638 ++
ii
;

1640 ià(
	`¡rcmp
("Çme", 
¬g
) == 0)

1642 
	`CHECKARG
("pÿ´•Üt",
ii
);

1643 
ùx
->
ba£_Çme
 = 
	`¡rdup
(
¬gv
[++
ii
]);

1645 ià(
	`¡rcmp
("exŒaù", 
¬g
) == 0)

1647 
ùx
->
exŒaù
 = 
TRUE
;

1649 ià(
	`¡rcmp
("csvg’", 
¬g
) == 0)

1651 
ùx
->
csv_g’
 = 
TRUE
;

1653 ià(
	`¡rcmp
("good-ts-Úly", 
¬g
) == 0)

1655 
ùx
->
good_ts_Úly
 = 
TRUE
;

1657 ià(
	`¡rcmp
("k“p-bad", 
¬g
) == 0)

1659 
ùx
->
k“p_bad
 = 
TRUE
;

1661 ià(
	`¡rcmp
("¥l™-£ùiÚ", 
¬g
) == 0)

1663 
ùx
->
fe_¥l™_£ùiÚ
 = 
TRUE
;

1665 ià(
	`¡rcmp
("tfmt", 
¬g
) == 0)

1667 
tfmt
;

1668 
	`CHECKARG
("pÿ´•Üt",
ii
);

1669 ià((
tfmt
 = 
	`fmtx_¡r_to_time¡amp_æags
(
¬gv
[
ii
 + 1])) < 0)

1671 
	`åršt_”r
("### BadimefÜm©: %s\n", 
¬gv
[
ii
 + 1]);

1672 
	`ex™
(1);

1674 
ùx
->
tfmt
 =fmt;

1675 ++
ii
;

1679 
	`åršt_”r
( "###…capreport: "

1680 "UÄecogni£d commªd†šsw™ch '%s'\n", 
¬gv
[
ii
]);

1686 ià(
ùx
->
had_šput_Çme
)

1688 
	`åršt_”r
Ğ"###…ÿ´•Üt: UÃx³ùed '%s'\n", 
¬gv
[
ii
]);

1693 
ùx
->
šput_Çme
 = 
¬gv
[
ii
];

1694 
ùx
->
had_šput_Çme
 = 
TRUE
;

1697 ++
ii
;

1700 ià(!
ùx
->
had_šput_Çme
)

1702 
	`´št_”r
("###…capreport: No input file specified\n");

1707 ià(
ùx
->
f‹r_de¡_addr
 !ğ0 && ctx->
f‹r_de¡_pÜt
 != 0)

1708 
ùx
->
k“p_bad
 = 
TRUE
;

1711 ià(
ùx
->
good_ts_Úly
)

1712 
ùx
->
k“p_bad
 = 
FALSE
;

1714 ià(
ùx
->
ba£_Çme
 =ğ
NULL
)

1718 cÚ¡ * cÚ¡ 
¡r_exts
[] = {

1722 cÚ¡ * cÚ¡ 
šput_Çme
 = 
ùx
->šput_Çm=ğ
NULL
 ? "pcap" : ctx->input_name;

1723 * cÚ¡ 
buf
 = 
	`¡rdup
(
ùx
->
šput_Çme
);

1724 cÚ¡ 
size_t
 
Ën
 = 
	`¡¾’
(
šput_Çme
);

1725 
i
;

1727 
i
 = 0; i !ğ(
¡r_exts
)/(strip_exts[0]); ++i)

1729 cÚ¡ 
size_t
 
ex’
 = 
	`¡¾’
(
¡r_exts
[
i
]);

1730 ià(
Ën
 > 
ex’
 && 
	`¡rcmp
(
¡r_exts
[
i
], 
buf
 +†en -ƒxtlen) == 0)

1732 
buf
[
Ën
 - 
ex’
] = 0;

1736 
ùx
->
ba£_Çme
 = 
buf
;

1739 
	`åršt_msg
("%s\n",
ùx
->
šput_Çme
);

1741 
”r
 = 
	`pÿp_İ’
(&
ùx
->
pü—d”
, &ùx->
pÿp_hdr
, ctx->
šput_Çme
);

1742 ià(
”r
)

1744 
	`åršt_”r
("###…capreport: Unableo open input file %s for„eading "

1746 
ùx
->
had_šput_Çme
?ùx->
šput_Çme
:"<¡dš>", 
”r
);

1749 
	`åršt_”r
(" %s\n",

1750 (
”r
==-1?"Unableo open file":

1751 
”r
==-2?"Unableo‡llocate PCAP„eader datastructure":

1752 
”r
==-4?"Unableo„ead PCAP header - is it‡ PCAP file?":

1757 
	`åršt_msg
("Capture made by version %u.%u†ocal_tz_correction "

1759 
ùx
->
pÿp_hdr
.
v”siÚ_majÜ
, ctx->pÿp_hdr.
v”siÚ_mšÜ
,

1760 
ùx
->
pÿp_hdr
.
thiszÚe
,

1761 
ùx
->
pÿp_hdr
.
sigfigs
,

1762 
ùx
->
pÿp_hdr
.
¢­Ën
,

1763 
ùx
->
pÿp_hdr
.
ÃtwÜk
);

1765 ià(
ùx
->
pÿp_hdr
.
¢­Ën
 < 65535)

1767 
	`åršt_”r
("###…capreport: WARNING snaplen is %d,‚ot >= 65535 - "

1769 
ùx
->
pÿp_hdr
.
¢­Ën
);

1774 
dÚe
 = 0;

1776 !
dÚe
)

1778 
pÿ´ec_hdr_t
 
»c_hdr
;

1779 
by‹
 *
d©a
 = 
NULL
;

1780 
ušt32_t
 
Ën
 = 0;

1781 
£Á_to_ouut
 = 0;

1783 
”r
 = 
	`pÿp_»ad_Ãxt
(
ùx
->
pü—d”
, &
»c_hdr
, &
d©a
, &
Ën
);

1784 
”r
)

1787 ++
dÚe
;

1791 
by‹
 *
®loÿ‹d
 = 
d©a
;

1794 ià(
ùx
->
pkt_couÁ”
++ == 0)

1797 
ùx
->
time_u£c
 = 
»c_hdr
.
ts_u£c
;

1798 
ùx
->
time_£c
 = 
»c_hdr
.
ts_£c
;

1799 
ùx
->
time_¡¬t
 = 
	`pkt_time
(&
»c_hdr
);

1802 ià(
ùx
->
v”bo£
)

1804 
	`åršt_msg
("pkt: Time = %d.%d orig_len = %d \n",

1805 
»c_hdr
.
ts_£c
,„ec_hdr.
ts_u£c
,

1806 
»c_hdr
.
Üig_Ën
);

1809 ià(!(
ùx
->
pÿp_hdr
.
ÃtwÜk
 =ğ
PCAP_NETWORK_TYPE_ETHERNET
))

1811 
dump_out
;

1815 
‘h”Ãt_·ck‘_t
 
•kt
;

1816 
ušt32_t
 
out_¡
, 
out_Ën
;

1817 
rv
;

1818 
v4_h—d”_t
 
v4_hdr
;

1819 
v4_udp_h—d”_t
 
udp_hdr
;

1821 
rv
 = 
	`‘h”Ãt_·ck‘_äom_pÿp
(&
»c_hdr
,

1822 
d©a
, 
Ën
,

1823 &
•kt
,

1824 &
out_¡
,

1825 &
out_Ën
);

1827 ià(
rv
)

1829 
dump_out
;

1833 ià(
ùx
->
v”bo£
)

1835 
	`åršt_msg
("++ 802.11: src %02x:%02x:%02x:%02x:%02x:%02x "

1838 
•kt
.
¤c_addr
[0],ƒpkt.src_addr[1],

1839 
•kt
.
¤c_addr
[2],ƒpkt.src_addr[3],

1840 
•kt
.
¤c_addr
[4],ƒpkt.src_addr[5],

1841 
•kt
.
d¡_addr
[0],ƒpkt.dst_addr[1],

1842 
•kt
.
d¡_addr
[2],ƒpkt.dst_addr[3],

1843 
•kt
.
d¡_addr
[4],ƒpkt.dst_addr[5],

1844 
•kt
.
ty³ÜËn
);

1847 
d©a
 = &d©a[
out_¡
];

1848 
Ën
 = 
out_Ën
;

1851 ià(
•kt
.
ty³ÜËn
 != 0x800)

1853 
dump_out
;

1857 
rv
 = 
	`v4_äom_·ylßd
(
d©a
, 
Ën
,

1858 &
v4_hdr
,

1859 &
out_¡
,

1860 &
out_Ën
);

1861 ià(
rv
)

1863 
dump_out
;

1866 ià(
ùx
->
v”bo£
)

1868 
	`åršt_msg
("++ IPv4: src = %s",

1869 
	`v4_addr_to_¡ršg
(
v4_hdr
.
¤c_addr
));

1870 
	`åršt_msg
(" dest = %s \n",

1871 
	`v4_addr_to_¡ršg
(
v4_hdr
.
de¡_addr
));

1873 
	`åršt_msg
("++ IPv4: version = 0x%x hdr_length = 0x%x"

1878 
v4_hdr
.
v”siÚ
,

1879 
v4_hdr
.
hdr_Ëngth
,

1880 
v4_hdr
.
£rv_ty³
,

1881 
v4_hdr
.
Ëngth
,

1882 
v4_hdr
.
id’t
,

1883 
v4_hdr
.
æags
,

1884 
v4_hdr
.
äag_off£t
,

1885 
v4_hdr
.
‰l
,

1886 
v4_hdr
.
´Ùo
,

1887 
v4_hdr
.
csum
);

1890 
d©a
 = &d©a[
out_¡
];

1891 
Ën
 = 
out_Ën
;

1893 ià(
	`_»as£mbË
(&
ùx
->
»as£mbly_’v
, &
v4_hdr
, 
d©a
, &d©a, &
Ën
) != 0)

1895 
dump_out
;

1898 ià(!(
	`IPV4_HDR_IS_UDP
(&
v4_hdr
)))

1900 
dump_out
;

1904 
rv
 = 
	`v4_udp_äom_·ylßd
(
d©a
, 
Ën
,

1905 &
udp_hdr
,

1906 &
out_¡
,

1907 &
out_Ën
);

1908 ià(
rv
)

1910 
dump_out
;

1913 ià(
ùx
->
v”bo£
)

1915 
	`åršt_msg
("++ udp: src…ort = %d "

1917 
udp_hdr
.
sourû_pÜt
,

1918 
udp_hdr
.
de¡_pÜt
,

1919 
udp_hdr
.
Ëngth
);

1922 
d©a
 = &d©a[
out_¡
];

1923 
Ën
 = 
out_Ën
;

1926 (
ùx
->
f‹r_de¡_addr
 =ğ0 || (
v4_hdr
.
de¡_addr
 == ctx->filter_dest_addr)) &&

1927 (
ùx
->
f‹r_de¡_pÜt
 =ğ0 || (
udp_hdr
.
de¡_pÜt
 == ctx->filter_dest_port)))

1929 
pÿ´•Üt_¡»am_t
 * cÚ¡ 
¡
 = 
	`¡»am_fšd
(
ùx
, &
»c_hdr
, &
•kt
,

1930 
v4_hdr
.
de¡_addr
, 
udp_hdr
.
de¡_pÜt
);

1931 
¹p_h—d”_t
 
¹p_hdr
;

1933 
	`¡»am_m”ge_vÏn_šfo
(
¡
, &
•kt
);

1935 ià(
	`¡»am_¹p_check
(
ùx
, 
¡
, 
d©a
, 
Ën
, &
¹p_hdr
))

1937 ià(
ùx
->
exŒaù
 && 
¹p_hdr
.
is_¹p_¿w
)

1939 
	`¡»am_g’_Çmes
(
ùx
, 
¡
, &
¹p_hdr
);

1940 
	`wr™e_¹p_¿w_·ck‘
(
ùx
, 
¡
, 
d©a
, 
Ën
);

1943 
d©a
 +ğ
¹p_hdr
.
h—d”_Ën
;

1944 
Ën
 -ğ
¹p_hdr
.
h—d”_Ën
 +„_hdr.
·d_Ën
;

1947 ià(
	`¡»am_ts_check
(
ùx
, 
¡
, 
d©a
, 
Ën
))

1949 ++
£Á_to_ouut
;

1951 ià(
ùx
->
time_»pÜt
 || ctx->
ª®y£
 || ctx->
csv_g’
 || (ùx->
exŒaù
 && ctx->
fe_¥l™_£ùiÚ
))

1953 
rv
 = 
	`dige¡_times
(
ùx
,

1954 
¡
,

1955 &
»c_hdr
,

1956 &
•kt
,

1957 &
v4_hdr
,

1958 &
udp_hdr
,

1959 &
¹p_hdr
,

1960 
d©a
, 
Ën
);

1961 ià(
rv
) { „v; }

1963 ià(
ùx
->
exŒaù
)

1965 
rv
 = 
	`wr™e_out_·ck‘
(
ùx
, 
¡
, 
d©a
, 
Ën
);

1966 ià(
rv
) { „v; }

1973 
dump_out
:

1974 ià(
ùx
->
dump_d©a
 || (ùx->
dump_exŒa
 && !
£Á_to_ouut
))

1976 
	`´št_d©a
(
TRUE
, "d©a", 
d©a
, 
Ën
,†en);

1978 
	`ä“
(
®loÿ‹d
);‡Îoÿ‹d = 
d©a
 = 
NULL
;

1983 
	`åršt_”r
( "###…capreport: Can't„ead…acket %d - code %d\n",

1984 
ùx
->
pkt_couÁ”
, 
”r
);

1985 ++
dÚe
;

1991 
	`pÿp_şo£
(&
ùx
->
pü—d”
);

1994 ià(
ùx
->
ª®y£
)

1998 cÚ¡ 
tm
 * cÚ¡ 
t
 = 
	`gmtime
(&
ùx
->
time_£c
);

2000 
	`åršt_msg
("Pÿ°¡¬ˆtime: %Îu (%d-%02d-%02d %d:%02d:%02d.%06d)\n", 
ùx
->
time_¡¬t
,

2001 
t
->
tm_y—r
 + 1900,->
tm_mÚ
 + 1,->
tm_mday
,

2002 
t
->
tm_hour
,->
tm_mš
,->
tm_£c
, 
ùx
->
time_u£c
);

2003 
	`åršt_msg
("Pÿ°pkts: %u\n", 
ùx
->
pkt_couÁ”
);

2004 
	`åršt_msg
("\n");

2007 ià(
ùx
->
¡»am_couÁ
 != 0)

2009 
i
;

2010 
j
 = 0;

2011 
pÿ´•Üt_¡»am_t
 ** cÚ¡ 
¡»ams
 = 
	`m®loc
(Õÿ´•Üt_¡»am_ˆ*è* 
ùx
->
¡»am_couÁ
);

2014 
i
 = 0; i != 256; ++i)

2016 
pÿ´•Üt_¡»am_t
 * 
¡
 = 
ùx
->
¡»am_hash
[
i
];

2017 
¡
 !ğ
NULL
)

2019 
¡»ams
[
j
++] = 
¡
;

2020 
¡
 = st->
hash_Ãxt
;

2025 
	`qsÜt
(
¡»ams
, 
ùx
->
¡»am_couÁ
, (
pÿ´•Üt_¡»am_t
 *), 
¡»am_sÜt_â
);

2028 
i
 = 0; i !ğ
ùx
->
¡»am_couÁ
; ++i)

2029 
	`¡»am_ª®ysis
(
ùx
, 
¡»ams
[
i
]);

2031 
	`ä“
(
¡»ams
);

2037 
i
;

2038 
i
 = 0; i != 256; ++i)

2040 
ùx
->
¡»am_hash
[
i
] !ğ
NULL
)

2041 
	`¡»am_şo£
(
ùx
, ctx->
¡»am_hash
 + 
i
);

2046 
	}
}

	@pes.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

34 
	~"com·t.h
"

35 
	~"ts_âs.h
"

36 
	~"ps_âs.h
"

37 
	~"es_âs.h
"

38 
	~"³s_âs.h
"

39 
	~"pidšt_âs.h
"

40 
	~"h262_âs.h
"

41 
	~"tswr™e_âs.h
"

42 
	~"´štšg_âs.h
"

43 
	~"misc_âs.h
"

47 
	#DEBUG_READ_PACKETS
 0

	)

48 
	#DEBUG_PES_ASSEMBLY
 0

	)

49 
	#DEBUG_PROGRAM_INFO
 1

	)

50 
	#SHOW_PROGRAM_INFO
 0

	)

52 
	#ALLOW_OVERLONG_PACKETS
 1

	)

58 
	#STREAM_ID_PROGRAM_STREAM_MAP
 0xbc

	)

59 
	#STREAM_ID_PRIVATE_STREAM_1
 0xbd

	)

60 
	#STREAM_ID_PADDING_STREAM
 0xbe

	)

61 
	#STREAM_ID_PRIVATE_STREAM_2
 0xbf

	)

62 
	#STREAM_ID_ECM_STREAM
 0xf0

	)

63 
	#STREAM_ID_EMM_STREAM
 0xf1

	)

64 
	#STREAM_ID_DSMCC_STREAM
 0xf2

	)

65 
	#STREAM_ID_13522_STREAM
 0xf3

	)

66 
	#STREAM_ID_H222_A_STREAM
 0xf4

	)

67 
	#STREAM_ID_H222_B_STREAM
 0xf5

	)

68 
	#STREAM_ID_H222_C_STREAM
 0xf6

	)

69 
	#STREAM_ID_H222_D_STREAM
 0xf7

	)

70 
	#STREAM_ID_H222_E_STREAM
 0xf8

	)

71 
	#STREAM_ID_ANCILLARY_STREAM
 0xf9

	)

72 
	#STREAM_ID_PROGRAM_STREAM_DIRECTORY
 0xff

	)

82 
	$bud_PES_·ck‘_d©a
(
PES_·ck‘_d©a_p
 *
d©a
)

84 
PES_·ck‘_d©a_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_PES_PACKET_DATA
);

85 ià(
Ãw
 =ğ
NULL
)

87 
	`´št_”r
("### Unableo‡llocate PES…acket datastructure\n");

91 
Ãw
->
d©a
 = 
NULL
;

92 
Ãw
->
d©a_Ën
 = 0;

93 
Ãw
->
es_d©a_Ën
 = 0;

94 
Ãw
->
Ëngth
 = 0;

95 
Ãw
->
po¢
 = 0;

96 
Ãw
->
is_video
 = 
TRUE
;

97 
Ãw
->
d©a_®ignm’t_šdiÿtÜ
 = 
FALSE
;

98 
Ãw
->
has_PTS
 = 
FALSE
;

100 *
d©a
 = 
Ãw
;

102 
	}
}

113 
šlše
 
	$ex‹nd_PES_·ck‘_d©a
(
PES_·ck‘_d©a_p
 
d©a
,

114 
by‹
 
by‹s
[],

115 
by‹s_Ën
)

117 ià(
d©a
->d©¨=ğ
NULL
)

119 
d©a
->d©¨ğ
	`m®loc
(
by‹s_Ën
);

120 ià(
d©a
->d©¨=ğ
NULL
)

122 
	`´št_”r
("### Unableoƒxtend PES…acket data‡rray\n");

125 
	`memıy
(
d©a
->d©a,
by‹s
,
by‹s_Ën
);

126 
d©a
->
d©a_Ën
 = 
by‹s_Ën
;

130 
d©a
->d©¨ğ
	`»®loc
(d©a->d©a,d©a->
d©a_Ën
 + 
by‹s_Ën
);

131 ià(
d©a
->d©¨=ğ
NULL
)

133 
	`´št_”r
("### Unableoƒxtend PES…acket data‡rray\n");

136 
	`memıy
(&(
d©a
->d©a[d©a->
d©a_Ën
]),
by‹s
,
by‹s_Ën
);

137 
d©a
->
d©a_Ën
 = d©a->d©a_ËÀ+ 
by‹s_Ën
;

140 
	}
}

151 
šlše
 
	$bud_dummy_PES_·ck‘_d©a
(
PES_·ck‘_d©a_p
 *
d©a
,

152 
d©a_Ën
)

154 
”r
;

155 
PES_·ck‘_d©a_p
 
loÿl_d©a
 = 
NULL
;

156 ià(
loÿl_d©a
 =ğ
NULL
)

158 
”r
 = 
	`bud_PES_·ck‘_d©a
(&
loÿl_d©a
);

159 ià(
”r
)

161 
	`´št_”r
("### Error building dummy PES…acket\n");

164 
loÿl_d©a
->
is_video
 = 
FALSE
;

166 ià(
loÿl_d©a
->
d©a
 =ğ
NULL
)

168 
loÿl_d©a
->
d©a
 = 
	`m®loc
(
d©a_Ën
);

169 ià(
loÿl_d©a
->
d©a
 =ğ
NULL
)

171 
	`´št_”r
("### Unableoƒxtend dummy PES…acket data‡rray\n");

174 
	`mem£t
(
loÿl_d©a
->
d©a
,0xFF,
d©a_Ën
);

176 ià(
d©a_Ën
 > 
loÿl_d©a
->data_len)

178 
loÿl_d©a
->
d©a
 = 
	`»®loc
Öoÿl_d©a->d©a,
d©a_Ën
);

179 ià(
loÿl_d©a
->
d©a
 =ğ
NULL
)

181 
	`´št_”r
("### Unableoƒxtend dummy PES…acket data‡rray\n");

184 
	`mem£t
(
loÿl_d©a
->
d©a
,0xFF,
d©a_Ën
);

187 ià(
d©a_Ën
 !ğ
loÿl_d©a
->data_len)

189 
PES_·ck‘_Ën
 = 
d©a_Ën
 - 6;

191 
loÿl_d©a
->
d©a
[0] = 0x00;

192 
loÿl_d©a
->
d©a
[1] = 0x00;

193 
loÿl_d©a
->
d©a
[2] = 0x01;

194 
loÿl_d©a
->
d©a
[3] = 
STREAM_ID_PADDING_STREAM
;

195 ià(
PES_·ck‘_Ën
 > 0xFFFF)

197 
loÿl_d©a
->
d©a
[4] = 0;

198 
loÿl_d©a
->
d©a
[5] = 0;

202 
loÿl_d©a
->
d©a
[4] = (
by‹
è((
PES_·ck‘_Ën
 & 0xFF00) >> 8);

203 
loÿl_d©a
->
d©a
[5] = (
by‹
è((
PES_·ck‘_Ën
 & 0x00FF));

205 
loÿl_d©a
->
d©a_Ën
 = data_len;

207 *
d©a
 = 
loÿl_d©a
;

209 
	}
}

217 
	$ä“_PES_·ck‘_d©a
(
PES_·ck‘_d©a_p
 *
d©a
)

219 ià((*
d©a
è=ğ
NULL
)

221 ià((*
d©a
)->d©¨!ğ
NULL
)

223 
	`ä“
((*
d©a
)->data);

224 (*
d©a
)->d©¨ğ
NULL
;

226 (*
d©a
)->
d©a_Ën
 = 0;

227 (*
d©a
)->
Ëngth
 = 0;

228 
	`ä“
(*
d©a
);

229 *
d©a
 = 
NULL
;

231 
	}
}

240 
	$š™_³¦i¡
(
³¦i¡_p
 
li¡
)

242 
ii
;

243 
li¡
->
Ëngth
 = 0;

244 
li¡
->
size
 = 
PESLIST_START_SIZE
;

245 
li¡
->
d©a
 = 
	`m®loc
(
SIZEOF_PES_PACKET_DATA
*
PESLIST_START_SIZE
);

246 ià(
li¡
->
d©a
 =ğ
NULL
)

248 
	`´št_”r
("### Unableo‡llocate PES‡rray in PID/PES data‡rray");

251 
li¡
->
pid
 = 
	`m®loc
((
ušt32_t
)*
PESLIST_START_SIZE
);

252 ià(
li¡
->
pid
 =ğ
NULL
)

254 
	`ä“
(
li¡
->
d©a
);

255 
	`´št_”r
("### Unableo‡llocate PID‡rray in PID/PES data‡rray\n");

259 
ii
=0; ii<
li¡
->
size
; ii++)

260 
li¡
->
d©a
[
ii
] = 
NULL
;

262 
	}
}

269 
	$bud_³¦i¡
(
³¦i¡_p
 *
li¡
)

271 
³¦i¡_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_PESLIST
);

272 ià(
Ãw
 =ğ
NULL
)

274 
	`´št_”r
("### Unableo‡llocate PID/PES data‡rray\n");

278 ià(
	`š™_³¦i¡
(
Ãw
))

281 *
li¡
 = 
Ãw
;

283 
	}
}

292 
	$ä“_³¦i¡
(
³¦i¡_p
 *
³¦i¡
)

294 
³¦i¡_p
 
li¡
 = *
³¦i¡
;

295 ià(
li¡
 =ğ
NULL
)

297 ià(
li¡
->
d©a
 !ğ
NULL
)

299 
ii
;

300 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

302 ià(
li¡
->
d©a
[
ii
] !ğ
NULL
)

303 
	`ä“_PES_·ck‘_d©a
(&
li¡
->
d©a
[
ii
]);

305 
	`ä“
(
li¡
->
d©a
);

306 
li¡
->
d©a
 = 
NULL
;

308 ià(
li¡
->
pid
 !ğ
NULL
)

310 
	`ä“
(
li¡
->
pid
);

311 
li¡
->
pid
 = 
NULL
;

313 
li¡
->
Ëngth
 = 0;

314 
li¡
->
size
 = 0;

315 
	`ä“
(
li¡
);

316 *
³¦i¡
 = 
NULL
;

317 
	}
}

326 
šlše
 
	$pid_šdex_š_³¦i¡
(
³¦i¡_p
 
li¡
,

327 
ušt32_t
 
pid
)

329 
ii
;

330 ià(
li¡
 =ğ
NULL
)

332 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

334 ià(
li¡
->
pid
[
ii
] ==…id)

335  
ii
;

338 
	}
}

347 
šlše
 
	$pid_š_³¦i¡
(
³¦i¡_p
 
li¡
,

348 
ušt32_t
 
pid
)

350  
	`pid_šdex_š_³¦i¡
(
li¡
,
pid
) != -1;

351 
	}
}

361 
	$¡¬t_·ck‘_š_³¦i¡
(
PES_»ad”_p
 
»ad”
,

362 
ušt32_t
 
pid
,

363 
is_video
,

364 
PES_·ck‘_d©a_p
 *
d©a
)

366 
”r
;

367 
ii
;

368 
³¦i¡_p
 
li¡
 = 
»ad”
->
·ck‘s
;

370 ià(
li¡
 =ğ
NULL
)

372 
	`´št_”r
("### Unableo‡ppendo NULL PID/PES data‡rray\n");

376 
”r
 = 
	`bud_PES_·ck‘_d©a
(
d©a
);

377 ià(
”r
)

379 
	`´št_”r
("### Unableo build‚ew PES…acket datastructure"

383 (*
d©a
)->
is_video
 = is_video;

385 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

387 ià(
li¡
->
pid
[
ii
] ==…id)

390 ià(
li¡
->
d©a
[
ii
] !ğ
NULL
)

392 
PES_·ck‘_d©a_p
 
·ck‘
 = 
li¡
->
d©a
[
ii
];

393 ià(
»ad”
->
give_w¬nšg
)

394 
	`åršt_”r
("!!! PID %04x (%d)‡lready has‡n unfinished PES…acket"

396 "„—d - ignÜšghem\n",
pid
,pid,
·ck‘
->
d©a_Ën
,

397 (
·ck‘
->
d©a_Ën
==1?"":"s"),·ck‘->
Ëngth
);

398 
	`ä“_PES_·ck‘_d©a
(&(
li¡
->
d©a
[
ii
]));

400 
li¡
->
d©a
[
ii
] = *data;

406 ià(
li¡
->
Ëngth
 =ğli¡->
size
)

408 
Ãwsize
 = 
li¡
->
size
 + 
PESLIST_INCREMENT
;

409 
li¡
->
d©a
 = 
	`»®loc
Öi¡->d©a,
Ãwsize
*
SIZEOF_PES_PACKET_DATA
);

410 ià(
li¡
->
d©a
 =ğ
NULL
)

412 
	`´št_”r
("### Unableoƒxtend PID/PES data‡rray\n");

413 
	`ä“_PES_·ck‘_d©a
(
d©a
);

416 
li¡
->
pid
 = 
	`»®loc
Öi¡->pid,
Ãwsize
*(
ušt32_t
));

417 ià(
li¡
->
pid
 =ğ
NULL
)

419 
	`´št_”r
("### Unableoƒxtend PID/PES data‡rray\n");

420 
	`ä“_PES_·ck‘_d©a
(
d©a
);

423 
li¡
->
size
 = 
Ãwsize
;

425 
li¡
->
pid
[li¡->
Ëngth
] =…id;

426 
li¡
->
d©a
[li¡->
Ëngth
] = *data;

427 
li¡
->
Ëngth
++;

429 
	}
}

438 
šlše
 
	$fšd_·ck‘_š_³¦i¡
(
³¦i¡_p
 
li¡
,

439 
ušt32_t
 
pid
,

440 
PES_·ck‘_d©a_p
 *
d©a
)

442 
šdex
 = 
	`pid_šdex_š_³¦i¡
(
li¡
,
pid
);

443 ià(
šdex
 == -1)

445 *
d©a
 = 
li¡
->d©a[
šdex
];

447 
	}
}

457 
	$ş—r_·ck‘_š_³¦i¡
(
³¦i¡_p
 
li¡
,

458 
ušt32_t
 
pid
)

460 
šdex
;

462 ià(
li¡
 =ğ
NULL
)

464 
	`´št_msg
("Unableo clear PES…acket in NULL PID/PES data‡rray\n");

468 
šdex
 = 
	`pid_šdex_š_³¦i¡
(
li¡
,
pid
);

469 ià(
šdex
 == -1)

471 
	`åršt_”r
("### Unableo find PID %04x (%x) in PID/PES data‡rray,"

472 " sØÿÂÙ cË¬ it d©a\n",
pid
,pid);

475 
li¡
->
d©a
[
šdex
] = 
NULL
;

477 
	}
}

491 
	$»ad_Ãxt_PES_·ck‘_äom_PS
(
PES_»ad”_p
 
»ad”
,

492 
PES_·ck‘_d©a_p
 *
·ck‘_d©a
)

499 
”r
;

500 
by‹
 
¡»am_id
;

501 
k“p
 = 
FALSE
;

502 
is_video
 = 
FALSE
;

503 
PS_·ck‘
 
·ck‘
 = {0};

504 
PS_·ck_h—d”
 
h—d”
 = {0};

506 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
»ad”
->
p¤—d”
,
FALSE
,&»ad”->
po¢
,

507 &
¡»am_id
);

508 ià(
”r
 =ğ
EOF
)

510 *
·ck‘_d©a
 = 
NULL
;

511  
EOF
;

513 ià(
”r
)

517 ià(
¡»am_id
 == 0xba)

519 
”r
 = 
	`»ad_PS_·ck_h—d”_body
(
»ad”
->
p¤—d”
,&
h—d”
);

520 ià(
”r
 =ğ
EOF
)

522 
	`åršt_”r
("!!! Unexpected EOF -…artial PS…acket‡t "

523 
OFFSET_T_FORMAT
 " ignÜed\n",
»ad”
->
po¢
);

524 *
·ck‘_d©a
 = 
NULL
;

525  
EOF
;

527 ià(
”r
)

529 
	`åršt_”r
("### Error„eading data for…ack header starting‡t "

530 
OFFSET_T_FORMAT
 "\n",
»ad”
->
po¢
);

536 
”r
 = 
	`»ad_PS_·ck‘_body
(
»ad”
->
p¤—d”
,
¡»am_id
,&
·ck‘
);

537 ià(
”r
 =ğ
EOF
)

539 
	`åršt_”r
("!!! Unexpected EOF -…artial PS…acket‡t "

540 
OFFSET_T_FORMAT
 " ignÜed\n",
»ad”
->
po¢
);

541 *
·ck‘_d©a
 = 
NULL
;

542  
EOF
;

544 ià(
”r
)

546 
	`åršt_”r
("### Error„eading PS…acket starting‡t "

547 
OFFSET_T_FORMAT
 "\n",
»ad”
->
po¢
);

559 ià(
¡»am_id
 == 0xbb ||

560 
¡»am_id
 == 0xbc ||

561 
¡»am_id
 == 0x01)

565 ià(
¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
)

568 ià(
»ad”
->
video_Úly
)

569 
k“p
 = 
FALSE
;

570 ià(
»ad”
->
audio_¡»am_id
 =ğ
¡»am_id
)

572 
k“p
 = 
TRUE
;

573 
is_video
 = 
FALSE
;

576 ià((
¡»am_id
 >= 0xc0) && (stream_id <= 0xdf))

579 ià(
»ad”
->
video_Úly
)

580 
k“p
 = 
FALSE
;

581 ià(
»ad”
->
audio_¡»am_id
 =ğ
¡»am_id
)

583 
k“p
 = 
TRUE
;

584 
is_video
 = 
FALSE
;

586 ià(
»ad”
->
audio_¡»am_id
 == 0)

589 
»ad”
->
audio_¡»am_id
 = 
¡»am_id
;

590 
k“p
 = 
TRUE
;

591 
is_video
 = 
FALSE
;

592 ià(
»ad”
->
give_šfo
)

593 
	`åršt_msg
("S–eùšg‡udiØ¡»am‚umb” %d\n",
¡»am_id
 & 0x1F);

596 ià(
¡»am_id
 >= 0xe0 && stream_id <= 0xef)

600 
k“p
 = 
TRUE
;

601 
is_video
 = 
TRUE
;

604 ià(
k“p
)

606 
”r
 = 
	`bud_PES_·ck‘_d©a
(
·ck‘_d©a
);

607 ià(
”r
)  1;

610 (*
·ck‘_d©a
)->
d©a
 = 
·ck‘
.data;

611 (*
·ck‘_d©a
)->
d©a_Ën
 = 
·ck‘
.data_len;

612 (*
·ck‘_d©a
)->
Ëngth
 = 
·ck‘
.
d©a_Ën
;

613 (*
·ck‘_d©a
)->
po¢
 = 
»ad”
->posn;

614 (*
·ck‘_d©a
)->
is_video
 = is_video;

616 
·ck‘
.
d©a
 = 
NULL
;

617 
·ck‘
.
d©a_Ën
 = 0;

620 
	`ş—r_PS_·ck‘
(&
·ck‘
);

623 
	}
}

636 
	$decide_pids
(
PES_»ad”_p
 
»ad”
)

638 
pmt_p
 
pmt
 = 
»ad”
->
´og¿m_m­
;

639 
ii
;

640 
had_video
 = 
FALSE
;

641 
had_audio
 = 
FALSE
;

643 ià(
pmt
 =ğ
NULL
)

649 
ii
 = 0; i˜< 
pmt
->
num_¡»ams
; ii++)

651 ià(
	`IS_VIDEO_STREAM_TYPE
(
pmt
->
¡»ams
[
ii
].
¡»am_ty³
))

653 ià(
had_video
)

655 ià(
»ad”
->
give_w¬nšg
)

656 
	`åršt_”r
("!!! Multiple video streams in TS…rogram %d, PMT"

657 "‡ˆ" 
OFFSET_T_FORMAT
 " - using PID %04x\n",

658 
»ad”
->
´og¿m_numb”
,»ad”->
po¢
,»ad”->
video_pid
);

661 ià(
»ad”
->
video_pid
 == 0)

663 
»ad”
->
video_pid
 = 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
;

664 
pmt
->
¡»ams
[
ii
].
¡»am_ty³
)

666 
AVC_VIDEO_STREAM_TYPE
:

667 
»ad”
->
is_h264
 = 
TRUE
;

668 
»ad”
->
video_ty³
 = 
VIDEO_H264
;

670 
MPEG2_VIDEO_STREAM_TYPE
:

671 
MPEG1_VIDEO_STREAM_TYPE
:

672 
»ad”
->
is_h264
 = 
FALSE
;

673 
»ad”
->
video_ty³
 = 
VIDEO_H262
;

675 
AVS_VIDEO_STREAM_TYPE
:

676 
»ad”
->
is_h264
 = 
FALSE
;

677 
»ad”
->
video_ty³
 = 
VIDEO_AVS
;

680 
»ad”
->
is_h264
 = 
FALSE
;

681 
»ad”
->
video_ty³
 = 
VIDEO_UNKNOWN
;

684 ià(
»ad”
->
give_šfo
)

685 
	`åršt_msg
(" Cho£ videØPID %04x\n",
»ad”
->
video_pid
);

687 ià(
pmt
->
¡»ams
[
ii
].
–em’ry_PID
 !ğ
»ad”
->
video_pid
)

689 ià(
»ad”
->
give_w¬nšg
)

690 
	`åršt_”r
("!!! Video streams‡ltered in TS…rogram %d, PMT"

691 "‡ˆ" 
OFFSET_T_FORMAT
 " - still using PID %04x\n",

692 
»ad”
->
´og¿m_numb”
,»ad”->
po¢
,»ad”->
video_pid
);

695 
had_video
 = 
TRUE
;

699 ià(
»ad”
->
video_Úly
)

701 ià(
»ad”
->
give_šfo
)

702 
	`´št_msg
(" Not interested in‡ny‡udio streams\n");

706 
ii
 = 0; i˜< 
pmt
->
num_¡»ams
; ii++)

710 ià(
	`IS_AUDIO_STREAM_TYPE
(
pmt
->
¡»ams
[
ii
].
¡»am_ty³
))

712 ià(
had_audio
)

714 ià(
»ad”
->
give_w¬nšg
)

715 
	`åršt_”r
("!!! Multiple‡udio streams in TS…rogram %d, PMT"

716 "‡ˆ" 
OFFSET_T_FORMAT
 " - using PID %04x\n",

717 
»ad”
->
´og¿m_numb”
,»ad”->
po¢
,»ad”->
audio_pid
);

720 ià(
»ad”
->
audio_pid
 == 0)

722 
»ad”
->
audio_pid
 = 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
;

723 ià(
»ad”
->
give_šfo
)

724 
	`åršt_msg
(" Cho£‡udiØPID %04x\n",
»ad”
->
audio_pid
);

725 ià(
	`IS_DOLBY_STREAM_TYPE
(
pmt
->
¡»ams
[
ii
].
¡»am_ty³
))

730 
»ad”
->
dŞby_¡»am_ty³
 = 
pmt
->
¡»ams
[
ii
].
¡»am_ty³
;

732 ià(!
»ad”
->
ov”ride_dŞby_¡»am_ty³
)

733 
»ad”
->
ouut_dŞby_¡»am_ty³
 =„—d”->
dŞby_¡»am_ty³
;

736 ià(
pmt
->
¡»ams
[
ii
].
–em’ry_PID
 !ğ
»ad”
->
audio_pid
)

738 ià(
»ad”
->
give_w¬nšg
)

739 
	`åršt_”r
("!!! Audio streams‡ltered in TS…rogram %d, PMT"

740 "‡ˆ" 
OFFSET_T_FORMAT
 " - still using PID %04x\n",

741 
»ad”
->
´og¿m_numb”
,»ad”->
po¢
,»ad”->
audio_pid
);

744 
had_audio
 = 
TRUE
;

748 ià(!
»ad”
->
ov”ride_´og¿m_d©a
)

751 
»ad”
->
ouut_video_pid
 =„—d”->
video_pid
;

752 
»ad”
->
ouut_audio_pid
 =„—d”->
audio_pid
;

753 
»ad”
->
ouut_pü_pid
 =„—d”->
pü_pid
;

754 
»ad”
->
ouut_pmt_pid
 =„—d”->
pmt_pid
;

756 
	}
}

766 
	$»fše_TS_´og¿m_šfo
(
PES_»ad”_p
 
»ad”
,

767 
pmt_p
 
pmt
)

770 ià(
»ad”
->
´og¿m_m­
 =ğ
NULL
)

772 
»ad”
->
´og¿m_m­
 = 
pmt
;

773 
»ad”
->
pü_pid
 = 
pmt
->
PCR_pid
;

774 #ià
DEBUG_PROGRAM_INFO


775 ià(
»ad”
->
give_šfo
)

777 
	`åršt_msg
("PMT…ack‘‡ˆ" 
OFFSET_T_FORMAT
 ": first PMT, used‡s-is\n",

778 
»ad”
->
po¢
);

779 
	`»pÜt_pmt
(
TRUE
," ",
»ad”
->
´og¿m_m­
);

782 ià(
»ad”
->
give_šfo
)

783 
	`»pÜt_pmt
(
TRUE
," ",
»ad”
->
´og¿m_m­
);

786 
	`decide_pids
(
»ad”
);

787 
»ad”
->
gÙ_´og¿m_d©a
 = 
TRUE
;

793 ià(
pmt
->
´og¿m_numb”
 !ğ
»ad”
->program_number)

795 ià(
»ad”
->
give_šfo
)

796 
	`åršt_msg
("IgnÜšg PMT fÜ…rog¿m %d\n",
pmt
->
´og¿m_numb”
);

797 
	`ä“_pmt
(&
pmt
);

801 ià(
	`§me_pmt
(
pmt
,
»ad”
->
´og¿m_m­
))

803 
	`ä“_pmt
(&
pmt
);

808 ià(
»ad”
->
give_w¬nšg
)

810 
	`åršt_”r
("!!! PMT iÀTS…ack‘‡ˆ" 
OFFSET_T_FORMAT


811 "„•Ïû ´eviou ´og¿m infÜm©iÚ\n",
»ad”
->
po¢
);

812 
	`´št_”r
(" Program information was:\n");

813 
	`»pÜt_pmt
(
FALSE
," ",
»ad”
->
´og¿m_m­
);

814 
	`´št_”r
(" New…rogram information is:\n");

815 
	`»pÜt_pmt
(
FALSE
," ",
pmt
);

817 ià(
»ad”
->
give_šfo
)

819 #ià
DEBUG_PROGRAM_INFO


820 
	`åršt_msg
("PMT…ack‘‡ˆ" 
OFFSET_T_FORMAT
 ": updating…rogram info\n",

821 
»ad”
->
po¢
);

823 
	`»pÜt_pmt
(
TRUE
," ",
pmt
);

826 
	`ä“_pmt
(&
»ad”
->
´og¿m_m­
);

827 
»ad”
->
´og¿m_m­
 = 
pmt
;

828 
»ad”
->
pü_pid
 = 
pmt
->
PCR_pid
;

831 
	`decide_pids
(
»ad”
);

833 
	}
}

847 
	$exŒaù_ªd_»fše_TS_´og¿m_šfo
(
PES_»ad”_p
 
»ad”
,

848 
ušt32_t
 
pmt_pid
,

849 
by‹
 
pmt_d©a
[],

850 
pmt_d©a_Ën
)

852 
”r
;

853 
pmt_p
 
pmt
 = 
NULL
;

855 
”r
 = 
	`exŒaù_pmt
(
FALSE
,
pmt_d©a
,
pmt_d©a_Ën
,
pmt_pid
,&
pmt
);

856 ià(
”r
)

858 
	`´št_”r
("### Errorƒxtracting stream†ist from PMT\n");

863 ià(
pmt
->
´og¿m_numb”
 !ğ
»ad”
->program_number)

865 #ià
DEBUG_PROGRAM_INFO


866 ià(
»ad”
->
give_šfo
)

867 
	`åršt_msg
("PMT…ack‘‡ˆ" 
OFFSET_T_FORMAT
 ":…rogram‚umber %d (not %d)\n",

868 
»ad”
->
po¢
,
pmt
->
´og¿m_numb”
,reader->program_number);

870 
	`ä“_pmt
(&
pmt
);

874 
”r
 = 
	`»fše_TS_´og¿m_šfo
(
»ad”
,
pmt
);

875 ià(
”r
)

877 
	`´št_”r
("### Error„efining TS…rogram information from PMT\n");

878 
	`ä“_pmt
(&
pmt
);

883 
	}
}

899 
	$fšd_fœ¡_PAT
(
PES_»ad”_p
 
»ad”
)

901 
”r
;

902 
num_»ad
;

903 
pidšt_li¡_p
 
´og_li¡
 = 
NULL
;

905 
”r
 = 
	`fšd_·t
(
»ad”
->
t¤—d”
,0,
FALSE
,!»ad”->
give_šfo
,

906 &
num_»ad
,&
´og_li¡
);

907 ià(
”r
)

909 
	`´št_”r
("### Error finding first PAT\n");

913 ià(
´og_li¡
->
Ëngth
 == 0)

915 
	`åršt_”r
("### NØ´og¿m defšed iÀfœ¡ PAT (© " 
OFFSET_T_FORMAT


916 ")\n",
»ad”
->
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

917 
	`ä“_pidšt_li¡
(&
´og_li¡
);

920 ià(
´og_li¡
->
Ëngth
 > 1 && 
»ad”
->
give_šfo
)

921 
	`´št_msg
("Multiple…rograms in PAT - usinghe first\n\n");

923 ià(
»ad”
->
´og¿m_numb”
 == 0)

925 
»ad”
->
´og¿m_numb”
 = 
´og_li¡
->
numb”
[0];

926 
»ad”
->
pmt_pid
 = 
´og_li¡
->
pid
[0];

930 
ii
;

931 
gÙ_´og¿m
 = 
FALSE
;

932 
ii
=0; ii<
´og_li¡
->
Ëngth
; ii++)

934 ià(
´og_li¡
->
numb”
[
ii
] =ğ
»ad”
->
´og¿m_numb”
)

936 
gÙ_´og¿m
 = 
TRUE
;

937 
»ad”
->
pmt_pid
 = 
´og_li¡
->
pid
[
ii
];

941 ià(!
gÙ_´og¿m
)

943 
	`åršt_”r
("### Program %d‚ot found in first PAT‡t "

944 
OFFSET_T_FORMAT
 "\n",
»ad”
->
´og¿m_numb”
,

945 
»ad”
->
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

949 
	`ä“_pidšt_li¡
(&
´og_li¡
);

951 
	}
}

962 
	$fšd_fœ¡_PMT
(
PES_»ad”_p
 
»ad”
)

964 
”r
;

965 
Ä—d
 = 0;

966 
pmt_p
 
pmt
 = 
NULL
;

970 
”r
 = 
	`fšd_Ãxt_pmt
(
»ad”
->
t¤—d”
,»ad”->
pmt_pid
,-1,0,

971 
FALSE
,!
»ad”
->
give_šfo
,&
Ä—d
,&
pmt
);

972 ià(
”r
)

974 
	`åršt_”r
("### Error†ooking for…rogram %d PMT with PID %04x"

975 "‡á” fœ¡ PAT\n",
»ad”
->
´og¿m_numb”
,»ad”->
pmt_pid
);

979 ià(
pmt
->
´og¿m_numb”
 =ğ
»ad”
->program_number)

982 ià(
»ad”
->
give_šfo
)

983 
	`åršt_msg
("(Program is %d,‚ot %d - ignoring it)\n",

984 
pmt
->
´og¿m_numb”
,
»ad”
->program_number);

986 
	`ä“_pmt
(&
pmt
);

989 
”r
 = 
	`»fše_TS_´og¿m_šfo
(
»ad”
,
pmt
);

990 ià(
”r
)

992 
	`´št_”r
("### Error„efining TS…rogram information from PMT\n");

993 
	`ä“_pmt
(&
pmt
);

998 
	}
}

1025 
	$d‘”mše_TS_´og¿m_šfo
(
PES_»ad”_p
 
»ad”
)

1027 
”r
;

1028 
”r
 = 
	`fšd_fœ¡_PAT
(
»ad”
);

1029 ià(
”r
)

1031 
	`´št_”r
("### Error finding TS…rogram information\n");

1034 
”r
 = 
	`fšd_fœ¡_PMT
(
»ad”
);

1035 ià(
”r
)

1037 
	`´št_”r
("### Error finding TS…rogram information\n");

1042 ià(
»ad”
->
t¤—d”
->
fe
 !ğ
STDIN_FILENO
)

1044 
”r
 = 
	`£ek_usšg_TS_»ad”
(
»ad”
->
t¤—d”
, 0);

1045 ià(
”r
)

1047 
	`´št_”r
("### Error„ewinding TS stream‡fter finding initial"

1053 
»ad”
->
po¢
 = 0;

1056 
	}
}

1071 
	$¡¬t_Ãw_PES_·ck‘
(
PES_»ad”_p
 
»ad”
,

1072 
ušt32_t
 
pid
,

1073 
by‹
 
·ylßd
[],

1074 
·ylßd_Ën
,

1075 
PES_·ck‘_d©a_p
 *
fšished
)

1077 
”r
;

1078 
šdex
;

1079 
PES_·ck‘_d©a_p
 
ju¡_’ded
 = 
NULL
;

1080 
PES_·ck‘_d©a_p
 
d©a
;

1083 #ià
DEBUG_PES_ASSEMBLY


1084 
	`åršt_msg
(": start‚ew %s PES…acket,…ayload_len = %d\n",

1085 (
pid
==
»ad”
->
video_pid
?"video":"audio"),
·ylßd_Ën
);

1086 
	`´št_d©a
(
TRUE
,"D©a",
·ylßd
,
·ylßd_Ën
,payload_len);

1089 ià(
·ylßd_Ën
 < 6)

1098 
	`åršt_”r
("### Only first %d byte%s of PES…acket in its first TS…acket,"

1099 "…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",
·ylßd_Ën
,

1100 (
·ylßd_Ën
==1?"":"s"),
»ad”
->
po¢
);

1103 ià(
·ylßd
[0] != 0 ||…ayload[1] != 0 ||…ayload[2] != 1)

1105 
	`åršt_”r
("### PES d©¨¡¬tšg iÀTS…ack‘‡ˆ" 
OFFSET_T_FORMAT


1107 
»ad”
->
po¢
,
·ylßd
[0],payload[1],payload[2]);

1115 
šdex
 = 
	`pid_šdex_š_³¦i¡
(
»ad”
->
·ck‘s
,
pid
);

1116 ià(
šdex
 != -1 &&

1117 
»ad”
->
·ck‘s
->
d©a
[
šdex
] !ğ
NULL
 &&

1118 
»ad”
->
·ck‘s
->
d©a
[
šdex
]->
Ëngth
 == 0)

1120 #ià
DEBUG_PES_ASSEMBLY


1121 
	`´št_msg
("@@@ justƒnded…revious…acket (by implication)\n");

1123 
ju¡_’ded
 = 
»ad”
->
·ck‘s
->
d©a
[
šdex
];

1124 
»ad”
->
·ck‘s
->
d©a
[
šdex
] = 
NULL
;

1128 #ià
DEBUG_PES_ASSEMBLY


1129 
	`´št_msg
("@@@ start…acket in PES†ist\n");

1131 
”r
 = 
	`¡¬t_·ck‘_š_³¦i¡
(
»ad”
,
pid
,pid=ô—d”->
video_pid
,&
d©a
);

1132 ià(
”r
)

1134 
	`åršt_”r
("### Errorryingo start‡‚ew PES…acket,"

1135 " fÜ TS…ack‘ " 
OFFSET_T_FORMAT
 "\n",
»ad”
->
po¢
);

1139 #ià
DEBUG_PES_ASSEMBLY


1140 
	`åršt_msg
("@@@ƒx‹nd…ack‘ - d©a_ËÀwa %d\n",
d©a
->
d©a_Ën
);

1142 
”r
 = 
	`ex‹nd_PES_·ck‘_d©a
(
d©a
,
·ylßd
,
·ylßd_Ën
);

1143 ià(
”r
)

1145 
	`´št_”r
("### Error„emembering data‡t start of PES…acket\n");

1148 #ià
DEBUG_PES_ASSEMBLY


1149 
	`åršt_msg
("@@@ d©a_ËÀi now %d\n",
d©a
->
d©a_Ën
);

1152 
d©a
->
Ëngth
 = ((
·ylßd
[4] << 8) |…ayload[5]);

1153 ià(
d©a
->
Ëngth
 != 0)

1154 
d©a
->
Ëngth
 += 6;

1155 #ià
DEBUG_PES_ASSEMBLY


1157 
	`´št_msg
("@@@ PES…acket marked‡s†ength 0\n");

1159 
d©a
->
po¢
 = 
»ad”
->posn;

1162 ià((
d©a
->
d©a_Ën
 > d©a->
Ëngth
) && data->length != 0)

1164 #ià
ALLOW_OVERLONG_PACKETS


1165 
exŒa
;

1166 
	`åršt_”r
("### Found %d bytes of PES data, butƒxpected %d"

1167 " (PES…ack‘†’gth + 6)\n",
d©a
->
d©a_Ën
,d©a->
Ëngth
);

1168 
exŒa
 = 
d©a
->
d©a_Ën
 - d©a->
Ëngth
;

1169 ià(
exŒa
 > 0)

1172 
äom
 = 
·ylßd_Ën
 - 
exŒa
;

1173 
	`´št_d©a
(
FALSE
," End oàd©a",
·ylßd
+
äom
,
exŒa
,extra);

1175 
	`åršt_”r
(" In %s PES…acket, PID %x, starting‡t "

1176 
OFFSET_T_FORMAT
 "\n",(
pid
==
»ad”
->
video_pid
?"video":"audio"),

1177 
pid
,
»ad”
->
po¢
);

1178 
	`´št_”r
("!!! Accepting…acket‡nyway\n");

1179 *
fšished
 = 
d©a
;

1180 
”r
 = 
	`ş—r_·ck‘_š_³¦i¡
(
»ad”
->
·ck‘s
,
pid
);

1181 ià(
”r
)  1;

1186 
	`åršt_”r
("### Found %d bytes of PES data, butƒxpected %d"

1187 " (PES…ack‘†’gth + 6)\n",
d©a
->
d©a_Ën
,d©a->
Ëngth
);

1191 ià(
d©a
->
Ëngth
 =ğd©a->
d©a_Ën
)

1193 *
fšished
 = 
d©a
;

1194 
”r
 = 
	`ş—r_·ck‘_š_³¦i¡
(
»ad”
->
·ck‘s
,
pid
);

1195 ià(
”r
)  1;

1198 *
fšished
 = 
NULL
;

1202 ià(
ju¡_’ded
)

1204 
»ad”
->
deã¼ed
 = *
fšished
;

1205 *
fšished
 = 
ju¡_’ded
;

1209 
	}
}

1224 
	$cÚtšue_PES_·ck‘
(
PES_»ad”_p
 
»ad”
,

1225 
ušt32_t
 
pid
,

1226 
by‹
 
·ylßd
[],

1227 
·ylßd_Ën
,

1228 
PES_·ck‘_d©a_p
 *
fšished
)

1230 
”r
;

1231 
PES_·ck‘_d©a_p
 
d©a
;

1233 #ià
DEBUG_PES_ASSEMBLY


1234 
	`åršt_msg
(": continue %s PES…acket\n",

1235 (
pid
==
»ad”
->
video_pid
?"video":"audio"));

1238 
”r
 = 
	`fšd_·ck‘_š_³¦i¡
(
»ad”
->
·ck‘s
,
pid
,&
d©a
);

1239 ià(
”r
 || 
d©a
 =ğ
NULL
)

1241 ià(
»ad”
->
give_w¬nšg
)

1242 
	`åršt_”r
("!!! TS…ack‘ w™h PID %04x‡ˆ" 
OFFSET_T_FORMAT


1244 
pid
,
»ad”
->
po¢
);

1245 *
fšished
 = 
NULL
;

1251 
”r
 = 
	`ex‹nd_PES_·ck‘_d©a
(
d©a
,
·ylßd
,
·ylßd_Ën
);

1252 ià(
”r
)

1254 
	`´št_”r
("### Error„emembering datao continue PES…acket\n");

1258 ià((
d©a
->
d©a_Ën
 > d©a->
Ëngth
) && data->length != 0)

1260 #ià
ALLOW_OVERLONG_PACKETS


1261 
exŒa
;

1262 
	`åršt_”r
("### Found %d bytes of PES data, butƒxpected %d"

1263 " (PES…ack‘†’gth + 6)\n",
d©a
->
d©a_Ën
,d©a->
Ëngth
);

1264 
exŒa
 = 
d©a
->
d©a_Ën
 - d©a->
Ëngth
;

1265 ià(
exŒa
 > 0)

1268 
äom
 = 
·ylßd_Ën
 - 
exŒa
;

1269 
	`´št_d©a
(
FALSE
," End oàd©a",
·ylßd
+
äom
,
exŒa
,extra);

1271 
	`åršt_”r
(" In %s PES…acket, PID %x, starting‡t "

1272 
OFFSET_T_FORMAT
 "\n",(
pid
==
»ad”
->
video_pid
?"video":"audio"),

1273 
pid
,
»ad”
->
po¢
);

1274 
	`´št_”r
("!!! Accepting…acket‡nyway\n");

1275 *
fšished
 = 
d©a
;

1276 
”r
 = 
	`ş—r_·ck‘_š_³¦i¡
(
»ad”
->
·ck‘s
,
pid
);

1277 ià(
”r
)  1;

1282 
	`åršt_”r
("### Found %d bytes of PES data, butƒxpected %d"

1283 " (PES…ack‘†’gth + 6)\n",
d©a
->
d©a_Ën
,d©a->
Ëngth
);

1287 ià(
d©a
->
d©a_Ën
 =ğd©a->
Ëngth
)

1289 *
fšished
 = 
d©a
;

1290 
”r
 = 
	`ş—r_·ck‘_š_³¦i¡
(
»ad”
->
·ck‘s
,
pid
);

1291 ià(
”r
)  1;

1294 *
fšished
 = 
NULL
;

1297 
	}
}

1312 
	$check_fÜ_EOF_·ck‘
(
PES_»ad”_p
 
»ad”
,

1313 
PES_·ck‘_d©a_p
 *
·ck‘_d©a
)

1315 
ii
;

1317 
ii
 = 0; i˜< 
»ad”
->
·ck‘s
->
Ëngth
; ii++)

1319 ià(
»ad”
->
·ck‘s
->
d©a
[
ii
] !ğ
NULL
 &&

1320 
»ad”
->
·ck‘s
->
d©a
[
ii
]->
Ëngth
 == 0)

1322 *
·ck‘_d©a
 = 
»ad”
->
·ck‘s
->
d©a
[
ii
];

1323 
»ad”
->
·ck‘s
->
d©a
[
ii
] = 
NULL
;

1327 *
·ck‘_d©a
 = 
NULL
;

1329 
	}
}

1340 
	$»ad_Ãxt_PES_·ck‘_äom_TS
(
PES_»ad”_p
 
»ad”
,

1341 
PES_·ck‘_d©a_p
 *
·ck‘_d©a
)

1345 ià(
»ad”
->
deã¼ed
)

1347 ià(
»ad”
->
video_Úly
 && !»ad”->
deã¼ed
->
is_video
)

1349 
	`ä“_PES_·ck‘_d©a
(&
»ad”
->
deã¼ed
);

1353 *
·ck‘_d©a
 = 
»ad”
->
deã¼ed
;

1354 
»ad”
->
deã¼ed
 = 
NULL
;

1355 #ià
DEBUG_PES_ASSEMBLY


1356 
	`´št_msg
("@@@„eturning deferred PES…acket\n");

1364 ià(
»ad”
->
had_eof
)

1366 *
·ck‘_d©a
 = 
NULL
;

1367  
EOF
;

1372 
”r
;

1373 
by‹
 *
ts_·ck‘
;

1374 
·ylßd_un™_¡¬t_šdiÿtÜ
;

1375 
by‹
 *
ad­t
;

1376 
ad­t_Ën
;

1377 
by‹
 *
·ylßd
;

1378 
·ylßd_Ën
;

1380 
ušt32_t
 
pid
;

1383 
»ad”
->
po¢
 =„—d”->
t¤—d”
->posn;

1388 
”r
 = 
	`»ad_Ãxt_TS_·ck‘
(
»ad”
->
t¤—d”
,&
ts_·ck‘
);

1389 ià(
”r
 =ğ
EOF
)

1397 
	`check_fÜ_EOF_·ck‘
(
»ad”
,
·ck‘_d©a
);

1398 ià(*
·ck‘_d©a
 =ğ
NULL
)

1399  
EOF
;

1403 ià(
”r
)

1405 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1406 
»ad”
->
po¢
);

1410 
”r
 = 
	`¥l™_TS_·ck‘
(
ts_·ck‘
,&
pid
,&
·ylßd_un™_¡¬t_šdiÿtÜ
,

1411 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

1412 ià(
”r
)

1414 
	`åršt_”r
("### E¼Ü iÁ”´‘šg TS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1415 
»ad”
->
po¢
);

1419 #ià
DEBUG_PES_ASSEMBLY


1420 
	`åršt_msg
("@@@ TS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 " with…id %3x",

1421 
»ad”
->
po¢
,
pid
);

1426 ià(
»ad”
->
wr™e_TS_·ck‘s
 &&„—d”->
tswr™”
 !ğ
NULL
 &&

1427 !
»ad”
->
suµ»ss_wr™šg
)

1429 
”r
 = 
	`tswr™e_wr™e
(
»ad”
->
tswr™”
,
ts_·ck‘
,
pid
,
FALSE
,0);

1430 ià(
”r
)

1432 
	`åršt_”r
("### Error writing TS…acket (PID %04x)‡t "

1433 
OFFSET_T_FORMAT
 "\n",
pid
,
»ad”
->
po¢
);

1438 ià(
pid
 == 0)

1442 #ià
DEBUG_PES_ASSEMBLY


1443 
	`´št_msg
(": PAT\n");

1446 ià(
pid
 =ğ
»ad”
->
pmt_pid
)

1448 #ià
DEBUG_PES_ASSEMBLY


1449 
	`´št_msg
(": PMT\n");

1452 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
»ad”
->
pmt_d©a
)

1456 
	`åršt_”r
("!!! Discarding…revious (uncompleted) PMT data‡t "

1457 
OFFSET_T_FORMAT
 "\n",
»ad”
->
po¢
);

1458 
	`ä“
(
»ad”
->
pmt_d©a
);

1459 
»ad”
->
pmt_d©a
 = 
NULL
;„—d”->
pmt_d©a_Ën
 =„—d”->
pmt_d©a_u£d
 = 0;

1461 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
»ad”
->
pmt_d©a
)

1465 
	`åršt_”r
("!!! Discarding PMT continuation,‚o PMT started,‡t "

1466 
OFFSET_T_FORMAT
 "\n",
»ad”
->
po¢
);

1470 
”r
 = 
	`bud_psi_d©a
(
FALSE
,
·ylßd
,
·ylßd_Ën
,
pid
,

1471 &
»ad”
->
pmt_d©a
,

1472 &
»ad”
->
pmt_d©a_Ën
,

1473 &
»ad”
->
pmt_d©a_u£d
);

1474 ià(
”r
)

1476 
	`åršt_”r
("### E¼Ü % PMT‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1477 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"),

1478 
»ad”
->
po¢
);

1479 ià(
»ad”
->
pmt_d©a
è
	`ä“
(reader->pmt_data);

1484 ià(
»ad”
->
pmt_d©a_Ën
 >„—d”->
pmt_d©a_u£d
)

1487 
”r
 = 
	`exŒaù_ªd_»fše_TS_´og¿m_šfo
(
»ad”
,
pid
,

1488 
»ad”
->
pmt_d©a
,

1489 
»ad”
->
pmt_d©a_Ën
);

1490 ià(
”r
)

1492 
	`åršt_”r
("### Error updating…rogram info from PMT"

1493 " (TS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 ")\n",
»ad”
->
po¢
);

1494 ià(
»ad”
->
pmt_d©a
è
	`ä“
(reader->pmt_data);

1498 
	`ä“
(
»ad”
->
pmt_d©a
);

1499 
»ad”
->
pmt_d©a
 = 
NULL
;„—d”->
pmt_d©a_Ën
 =„—d”->
pmt_d©a_u£d
 = 0;

1501 ià(
»ad”
->
wr™e_PES_·ck‘s
 && !»ad”->
suµ»ss_wr™šg
)

1505 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,»ad”->
tswr™”
);

1506 ià(
”r
)  1;

1508 
»ad”
->
´og¿m_šdex
 =„—d”->
´og¿m_äeq
;

1511 ià(
·ylßd_Ën
 > 0 &&

1512 (
pid
 =ğ
»ad”
->
video_pid
 ||

1513 (
pid
 =ğ
»ad”
->
audio_pid
 && !»ad”->
video_Úly
)))

1516 
PES_·ck‘_d©a_p
 
fšished
;

1517 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
)

1518 
”r
 = 
	`¡¬t_Ãw_PES_·ck‘
(
»ad”
,
pid
,
·ylßd
,
·ylßd_Ën
,

1519 &
fšished
);

1521 
”r
 = 
	`cÚtšue_PES_·ck‘
(
»ad”
,
pid
,
·ylßd
,
·ylßd_Ën
,

1522 &
fšished
);

1523 ià(
”r
)

1525 
	`åršt_”r
("### Error %s PES…acket (PID %04x)"

1526 " w™h TS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1527 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting":"continuing"),

1528 
pid
,
»ad”
->
po¢
);

1529 
	`´št_d©a
(
FALSE
," D©a",
·ylßd
,
·ylßd_Ën
,20);

1532 ià(
fšished
)

1534 #ià
DEBUG_PES_ASSEMBLY


1535 
	`åršt_msg
("@@@ PES…ack‘ w™h…id %x fšished\n",
pid
);

1536 
	`»pÜt_PES_d©a_¬¿y
(" ",
fšished
->
d©a
,fšished->
d©a_Ën
,
TRUE
);

1539 ià(
pid
 =ğ
»ad”
->
audio_pid
 &&„—d”->
video_Úly
)

1545 
	`ä“_PES_·ck‘_d©a
(&
fšished
);

1549 #ià
DEBUG_PES_ASSEMBLY


1550 
	`´št_msg
("@@@„eturn it\n");

1552 *
·ck‘_d©a
 = 
fšished
;

1557 #ià
DEBUG_PES_ASSEMBLY


1559 
	`´št_msg
("\n");

1563 
	}
}

1581 
	$d‘”mše_if_TS_fe
(
šput
,

1582 *
is_TS
)

1584 
”r
;

1585 
ii
;

1586 
by‹
 
buf
[
TS_PACKET_SIZE
];

1588 *
is_TS
 = 
TRUE
;

1590 
ii
 = 0; ii < 100; ii++)

1592 
”r
 = 
	`»ad_by‹s
(
šput
,
TS_PACKET_SIZE
,
buf
);

1593 ià(
”r
 =ğ
EOF
)

1595 ià(
”r
)

1597 
	`´št_”r
("### Errorryingo check if file is TS\n");

1600 ià(
buf
[0] != 0x47)

1602 *
is_TS
 = 
FALSE
;

1606 
”r
 = 
	`£ek_fe
(
šput
,0);

1607 ià(
”r
)

1609 
	`´št_”r
("### Error„ewinding file‡fter determining if it is TS\n");

1613 
	}
}

1627 
	$d‘”mše_PES_video_ty³
(
PES_»ad”_p
 
»ad”
)

1629 
”r
;

1630 
ES_p
 
es
;

1631 
Şd_video_Úly
 = 
»ad”
->
video_Úly
;

1633 
”r
 = 
	`bud_–em’ry_¡»am_PES
(
»ad”
,&
es
);

1634 ià(
”r
)

1636 
	`´št_”r
("### Error startingƒlementary stream before"

1641 
»ad”
->
video_Úly
 = 
TRUE
;

1643 
”r
 = 
	`decide_ES_video_ty³
(
es
,
FALSE
,FALSE,&
»ad”
->
video_ty³
);

1644 ià(
”r
)

1646 
	`´št_”r
("### Error deciding on PS videoype\n");

1647 
	`ä“_–em’ry_¡»am
(&
es
);

1650 
	`ä“_–em’ry_¡»am
(&
es
);

1652 
»ad”
->
is_h264
 = (»ad”->
video_ty³
 =ğ
VIDEO_H264
);

1653 
»ad”
->
video_Úly
 = 
Şd_video_Úly
;

1655 
”r
 = 
	`»wšd_´og¿m_¡»am
(
»ad”
->
p¤—d”
);

1656 ià(
”r
)

1658 
	`´št_”r
("### Error„ewinding PS stream‡fter determining itsype\n");

1662 
	}
}

1675 
	$bud_PES_»ad”_d©a¡ruùu»
(
give_šfo
,

1676 
give_w¬nšgs
,

1677 
PES_»ad”_p
 *
»ad”
)

1679 
”r
;

1680 
PES_»ad”_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_PES_READER
);

1681 ià(
Ãw
 =ğ
NULL
)

1683 
	`´št_”r
("### Unableo‡llocate PES„eader datastructure\n");

1687 
Ãw
->
t¤—d”
 = 
NULL
;

1688 
Ãw
->
p¤—d”
 = 
NULL
;

1689 
Ãw
->
is_TS
 = 
FALSE
;

1690 
Ãw
->
give_šfo
 = give_info;

1691 
Ãw
->
give_w¬nšg
 = 
give_w¬nšgs
;

1692 
Ãw
->
po¢
 = 0;

1693 
Ãw
->
is_h264
 = 
FALSE
;

1694 
Ãw
->
video_ty³
 = 
VIDEO_UNKNOWN
;

1695 
Ãw
->
·ck‘
 = 
NULL
;

1697 
Ãw
->
´og¿m_numb”
 = 0;

1698 
Ãw
->
´og¿m_m­
 = 
NULL
;

1699 
Ãw
->
video_Úly
 = 
FALSE
;

1700 
Ãw
->
audio_¡»am_id
 = 0;

1702 
Ãw
->
pmt_d©a
 = 
NULL
;

1703 
Ãw
->
pmt_d©a_Ën
 = 0;

1704 
Ãw
->
pmt_d©a_u£d
 = 0;

1706 
Ãw
->
video_pid
 =‚ew->
audio_pid
 = 0;

1707 
Ãw
->
pü_pid
 =‚ew->
pmt_pid
 = 0;

1708 
Ãw
->
gÙ_´og¿m_d©a
 = 
FALSE
;

1710 
Ãw
->
ouut_´og¿m_numb”
 = 0;

1711 
Ãw
->
ouut_video_pid
 =‚ew->
ouut_audio_pid
 = 0;

1712 
Ãw
->
ouut_pü_pid
 =‚ew->
ouut_pmt_pid
 = 0;

1713 
Ãw
->
ov”ride_´og¿m_d©a
 = 
FALSE
;

1715 
Ãw
->
ouut_dŞby_¡»am_ty³
 =

1716 
Ãw
->
dŞby_¡»am_ty³
 = 
DVB_DOLBY_AUDIO_STREAM_TYPE
;

1717 
Ãw
->
ov”ride_dŞby_¡»am_ty³
 = 
FALSE
;

1719 
Ãw
->
tswr™”
 = 
NULL
;

1720 
Ãw
->
wr™e_PES_·ck‘s
 = 
FALSE
;

1721 
Ãw
->
wr™e_TS_·ck‘s
 = 
FALSE
;

1722 
Ãw
->
suµ»ss_wr™šg
 = 
TRUE
;

1723 
Ãw
->
dÚt_wr™e_cu¼’t_·ck‘
 = 
FALSE
;

1724 
Ãw
->
³s_·ddšg
 = 0;

1726 
Ãw
->
debug_»ad_·ck‘s
 = 
FALSE
;

1728 
”r
 = 
	`bud_³¦i¡
(&
Ãw
->
·ck‘s
);

1729 ià(
”r
)

1731 
	`´št_”r
("### Error building PES„eader datastructure\n");

1732 
	`ä“
(
Ãw
);

1736 
Ãw
->
deã¼ed
 = 
NULL
;

1737 
Ãw
->
had_eof
 = 
FALSE
;

1738 *
»ad”
 = 
Ãw
;

1740 
	}
}

1754 
	$bud_PS_PES_»ad”
(
PS_»ad”_p
 
ps
,

1755 
give_šfo
,

1756 
give_w¬nšgs
,

1757 
PES_»ad”_p
 *
»ad”
)

1759 
”r
;

1761 
”r
 = 
	`bud_PES_»ad”_d©a¡ruùu»
(
give_šfo
,
give_w¬nšgs
,
»ad”
);

1762 ià(
”r
)  1;

1764 (*
»ad”
)->
is_TS
 = 
FALSE
;

1765 (*
»ad”
)->
p¤—d”
 = 
ps
;

1768 
”r
 = 
	`d‘”mše_PES_video_ty³
(*
»ad”
);

1769 ià(
”r
)

1771 
	`´št_”r
("### Error determining PS streamype\n");

1772 (è
	`ä“_PES_»ad”
(
»ad”
);

1776 
	}
}

1793 
	$bud_TS_PES_»ad”
(
TS_»ad”_p
 
t¤—d”
,

1794 
give_šfo
,

1795 
give_w¬nšgs
,

1796 
ušt16_t
 
´og¿m_numb”
,

1797 
PES_»ad”_p
 *
»ad”
)

1799 
”r
;

1801 
”r
 = 
	`bud_PES_»ad”_d©a¡ruùu»
(
give_šfo
,
give_w¬nšgs
,
»ad”
);

1802 ià(
”r
)  1;

1804 (*
»ad”
)->
is_TS
 = 
TRUE
;

1805 (*
»ad”
)->
t¤—d”
 =sreader;

1807 (*
»ad”
)->
´og¿m_numb”
 =…rogram_number;

1808 (*
»ad”
)->
ouut_´og¿m_numb”
 = 
´og¿m_numb”
;

1812 
”r
 = 
	`d‘”mše_TS_´og¿m_šfo
(*
»ad”
);

1813 ià(
”r
)

1815 
	`´št_”r
("### Error determining/checking…rogram‚umber\n");

1816 (è
	`ä“_PES_»ad”
(
»ad”
);

1820 
	}
}

1838 
	$bud_PES_»ad”
(
šput
,

1839 
is_TS
,

1840 
give_šfo
,

1841 
give_w¬nšgs
,

1842 
ušt16_t
 
´og¿m_numb”
,

1843 
PES_»ad”_p
 *
»ad”
)

1845 
”r
;

1847 ià(
is_TS
)

1849 
TS_»ad”_p
 
t¤—d”
;

1850 
”r
 = 
	`bud_TS_»ad”
(
šput
,&
t¤—d”
);

1851 ià(
”r
)

1853 
	`´št_”r
("### Error building TS specific„eader\n");

1856 
”r
 = 
	`bud_TS_PES_»ad”
(
t¤—d”
,
give_šfo
,
give_w¬nšgs
,
´og¿m_numb”
,

1857 
»ad”
);

1858 ià(
”r
)

1860 
	`´št_”r
("### Error building TS specific„eader\n");

1861 
	`ä“_TS_»ad”
(&
t¤—d”
);

1867 
PS_»ad”_p
 
ps
;

1868 
”r
 = 
	`bud_PS_»ad”
(
šput
,!
give_šfo
,&
ps
);

1869 ià(
”r
)

1871 
	`´št_”r
("### Error building PS specific„eader\n");

1874 
”r
 = 
	`bud_PS_PES_»ad”
(
ps
,
give_šfo
,
give_w¬nšgs
,
»ad”
);

1875 ià(
”r
)

1877 
	`´št_”r
("### Error building PS specific„eader\n");

1878 
	`ä“_PS_»ad”
(&
ps
);

1883 
	}
}

1905 
	$İ’_PES_»ad”_fÜ_TS
(*
f’ame
,

1906 
ušt16_t
 
´og¿m_numb”
,

1907 
give_šfo
,

1908 
give_w¬nšgs
,

1909 
PES_»ad”_p
 *
»ad”
)

1911 
”r
;

1912 
šput
;

1914 
šput
 = 
	`İ’_bš¬y_fe
(
f’ame
,
FALSE
);

1915 ià(
šput
 == -1)

1917 
	`åršt_”r
("### UÇbËØİ’ iÅuˆTS f%s\n",
f’ame
);

1920 
”r
 = 
	`bud_PES_»ad”
(
šput
,
TRUE
,
give_šfo
,
give_w¬nšgs
,
´og¿m_numb”
,

1921 
»ad”
);

1922 ià(
”r
)  1;

1924 
	}
}

1939 
	$İ’_PES_»ad”_fÜ_PS
(*
f’ame
,

1940 
give_šfo
,

1941 
give_w¬nšgs
,

1942 
PES_»ad”_p
 *
»ad”
)

1944 
šput
 = 
	`İ’_bš¬y_fe
(
f’ame
,
FALSE
);

1945 ià(
šput
 == -1)

1947 
	`åršt_”r
("### UÇbËØİ’ iÅuˆPS f%s\n",
f’ame
);

1950  
	`bud_PES_»ad”
(
šput
,
FALSE
,
give_šfo
,
give_w¬nšgs
,0,
»ad”
);

1951 
	}
}

1992 
	$İ’_PES_»ad”
(*
f’ame
,

1993 
give_šfo
,

1994 
give_w¬nšgs
,

1995 
PES_»ad”_p
 *
»ad”
)

1997 
”r
;

1998 
šput
;

1999 
is_TS
;

2001 
šput
 = 
	`İ’_bš¬y_fe
(
f’ame
,
FALSE
);

2002 ià(
šput
 == -1)

2004 
	`åršt_”r
("### UÇbËØİ’ iÅuˆf%s\n",
f’ame
);

2007 
”r
 = 
	`d‘”mše_if_TS_fe
(
šput
,&
is_TS
);

2008 ià(
”r
)

2010 (è
	`şo£_fe
(
šput
);

2013 ià(
is_TS
)

2014  
	`bud_PES_»ad”
(
šput
,
TRUE
,
give_šfo
,
give_w¬nšgs
,0,
»ad”
);

2016  
	`bud_PES_»ad”
(
šput
,
FALSE
,
give_šfo
,
give_w¬nšgs
,0,
»ad”
);

2017 
	}
}

2028 
	$£t_PES_»ad”_video_Úly
(
PES_»ad”_p
 
»ad”
,

2029 
video_Úly
)

2031 
»ad”
->
video_Úly
 = video_only;

2033 
	}
}

2050 
	$£t_PES_»ad”_audio_¡»am
(
PES_»ad”_p
 
»ad”
,

2051 
¡»am_numb”
)

2053 ià(
¡»am_numb”
 < 0 || stream_number > 0x1F)

2055 
	`åršt_”r
("### Audio stream‚umber %d is‚ot in„ange 0-31\n",

2056 
¡»am_numb”
);

2059 
»ad”
->
audio_¡»am_id
 = 0xc0 | 
¡»am_numb”
;

2061 
	}
}

2075 
	$£t_PES_»ad”_audio_´iv©e1
(
PES_»ad”_p
 
»ad”
)

2077 
»ad”
->
audio_¡»am_id
 = 
PRIVATE1_AUDIO_STREAM_ID
;

2079 
	}
}

2105 
	$£t_PES_»ad”_´og¿m_d©a
(
PES_»ad”_p
 
»ad”
,

2106 
ušt16_t
 
´og¿m_numb”
,

2107 
ušt32_t
 
pmt_pid
,

2108 
ušt32_t
 
video_pid
,

2109 
ušt32_t
 
audio_pid
,

2110 
ušt32_t
 
pü_pid
)

2112 ià(
´og¿m_numb”
 == 0)

2113 
´og¿m_numb”
 = 1;

2115 ià(
»ad”
->
is_TS
)

2117 
»ad”
->
ov”ride_´og¿m_d©a
 = 
TRUE
;

2118 
»ad”
->
ouut_´og¿m_numb”
 = 
´og¿m_numb”
;

2119 
»ad”
->
ouut_pmt_pid
 = 
pmt_pid
;

2120 
»ad”
->
ouut_pü_pid
 = 
pü_pid
;

2121 
»ad”
->
ouut_video_pid
 = 
video_pid
;

2122 
»ad”
->
ouut_audio_pid
 = 
audio_pid
;

2126 
»ad”
->
ouut_´og¿m_numb”
 =„—d”->
´og¿m_numb”
 =…rogram_number;

2127 
»ad”
->
ouut_pmt_pid
 =„—d”->
pmt_pid
 =…mt_pid;

2128 
»ad”
->
ouut_pü_pid
 =„—d”->
pü_pid
 =…cr_pid;

2129 
»ad”
->
ouut_video_pid
 =„—d”->
video_pid
 = video_pid;

2130 
»ad”
->
ouut_audio_pid
 =„—d”->
audio_pid
 =‡udio_pid;

2131 
»ad”
->
gÙ_´og¿m_d©a
 = 
TRUE
;

2134 
	}
}

2140 
	$£t_PES_»ad”_h264
(
PES_»ad”_p
 
»ad”
)

2142 
»ad”
->
is_h264
 = 
TRUE
;

2143 
»ad”
->
video_ty³
 = 
VIDEO_H264
;

2144 
	}
}

2151 
	$£t_PES_»ad”_video_ty³
(
PES_»ad”_p
 
»ad”
,

2152 
video_ty³
)

2154 
»ad”
->
video_ty³
 = video_type;

2155 
»ad”
->
is_h264
 = (
video_ty³
 =ğ
VIDEO_H264
);

2156 
	}
}

2170 
	$£t_PES_»ad”_dŞby_¡»am_ty³
(
PES_»ad”_p
 
»ad”
,

2171 
is_dvb
)

2173 
»ad”
->
ov”ride_dŞby_¡»am_ty³
 = 
TRUE
;

2174 
»ad”
->
ouut_dŞby_¡»am_ty³
 = (
is_dvb
?
DVB_DOLBY_AUDIO_STREAM_TYPE
:

2175 
ATSC_DOLBY_AUDIO_STREAM_TYPE
);

2176 
	}
}

2197 
	$£t_PES_»ad”_pos™iÚ
(
PES_»ad”_p
 
»ad”
,

2198 
off£t_t
 
po¢
)

2200 
”r
;

2202 ià(
»ad”
->
is_TS
)

2203 
”r
 = 
	`£ek_usšg_TS_»ad”
(
»ad”
->
t¤—d”
,
po¢
);

2205 
”r
 = 
	`£ek_usšg_PS_»ad”
(
»ad”
->
p¤—d”
,
po¢
);

2206 ià(
”r
)  1;

2210 
»ad”
->
po¢
 =…osn;

2214 ià(
»ad”
->
is_TS
)

2216 
ii
;

2217 
ii
=0; ii<
»ad”
->
·ck‘s
->
Ëngth
; ii++)

2218 
	`ä“_PES_·ck‘_d©a
(&
»ad”
->
·ck‘s
->
d©a
[
ii
]);

2219 ià(
»ad”
->
deã¼ed
)

2220 
	`ä“_PES_·ck‘_d©a
(&
»ad”
->
deã¼ed
);

2221 
»ad”
->
had_eof
 = 
FALSE
;

2224 
	}
}

2235 
	$ä“_PES_»ad”
(
PES_»ad”_p
 *
»ad”
)

2237 
”r
 = 0;

2239 ià((*
»ad”
è=ğ
NULL
)

2241 ià((*
»ad”
)->
·ck‘
 !ğ
NULL
)

2242 
	`ä“_PES_·ck‘_d©a
(&(*
»ad”
)->
·ck‘
);

2245 (*
»ad”
)->
t¤—d”
 = 
NULL
;

2246 (*
»ad”
)->
p¤—d”
 = 
NULL
;

2248 ià((*
»ad”
)->
´og¿m_m­
 !ğ
NULL
)

2250 
	`ä“_pmt
(&(*
»ad”
)->
´og¿m_m­
);

2252 ià((*
»ad”
)->
pmt_d©a
 !ğ
NULL
)

2254 
	`ä“
((*
»ad”
)->
pmt_d©a
);

2255 (*
»ad”
)->
pmt_d©a
 = 
NULL
;

2256 (*
»ad”
)->
pmt_d©a_Ën
 = 0;

2257 (*
»ad”
)->
pmt_d©a_u£d
 = 0;

2259 ià((*
»ad”
)->
·ck‘s
 !ğ
NULL
)

2261 
	`ä“_³¦i¡
(&(*
»ad”
)->
·ck‘s
);

2263 ià((*
»ad”
)->
is_TS
)

2264 
	`ä“_TS_»ad”
(&(*
»ad”
)->
t¤—d”
);

2266 
	`ä“_PS_»ad”
(&(*
»ad”
)->
p¤—d”
);

2267 
	`ä“
(*
»ad”
);

2268 *
»ad”
 = 
NULL
;

2269  
”r
;

2270 
	}
}

2281 
	$şo£_PES_»ad”
(
PES_»ad”_p
 *
»ad”
)

2283 
”r
 = 0;

2284 
”r2
;

2286 ià((*
»ad”
è=ğ
NULL
)

2289 ià((*
»ad”
)->
is_TS
)

2291 ià((*
»ad”
)->
t¤—d”
 !ğ
NULL
)

2293 
”r
 = 
	`şo£_TS_»ad”
(&(*
»ad”
)->
t¤—d”
);

2294 ià(
”r
è
	`´št_”r
("### Error closing TS„eader\n");

2299 ià((*
»ad”
)->
p¤—d”
 !ğ
NULL
)

2301 
”r
 = 
	`şo£_PS_fe
(&(*
»ad”
)->
p¤—d”
);

2302 ià(
”r
è
	`´št_”r
("### Error closing PS„eader\n");

2306 
”r2
 = 
	`ä“_PES_»ad”
(
»ad”
);

2307 ià(
”r
)

2308  
”r
;

2310  
”r2
;

2311 
	}
}

2321 
	$»ad_Ãxt_PES_·ck‘
(
PES_»ad”_p
 
»ad”
)

2323 
”r
;

2325 ià(
»ad”
->
·ck‘
 !ğ
NULL
)

2327 ià(
»ad”
->
wr™e_PES_·ck‘s
 &&„—d”->
tswr™”
 !ğ
NULL
 &&

2328 !
»ad”
->
suµ»ss_wr™šg
 &&

2329 !
»ad”
->
dÚt_wr™e_cu¼’t_·ck‘
)

2332 
ušt32_t
 
pid
;

2333 
by‹
 
¡»am_id
;

2334 ià(
»ad”
->
´og¿m_šdex
 == 0)

2337 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,»ad”->
tswr™”
);

2338 ià(
”r
)  1;

2339 
»ad”
->
´og¿m_šdex
 =„—d”->
´og¿m_äeq
;

2342 
»ad”
->
´og¿m_šdex
 --;

2343 #ià
DEBUG_READ_PACKETS


2344 ià(
»ad”
->
debug_»ad_·ck‘s
)

2346 
	`åršt_msg
("<<wr™PES…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "†en %d",

2347 
»ad”
->
·ck‘
->
po¢
,

2348 
»ad”
->
·ck‘
->
d©a_Ën
);

2349 ià(
»ad”
->
·ck‘
->
is_video
)

2351 
	`åršt_msg
(" VIDEOƒ¦’ %d",
»ad”
->
·ck‘
->
es_d©a_Ën
);

2352 ià(
»ad”
->
·ck‘
->
d©a_®ignm’t_šdiÿtÜ
)

2353 
	`´št_msg
("‡ligned");

2355 
	`´št_msg
(">>\n");

2358 ià(
»ad”
->
·ck‘
->
is_video
)

2360 
pid
 = 
»ad”
->
ouut_video_pid
;

2361 
¡»am_id
 = 
DEFAULT_VIDEO_STREAM_ID
;

2365 
pid
 = 
»ad”
->
ouut_audio_pid
;

2366 
¡»am_id
 = 
DEFAULT_AUDIO_STREAM_ID
;

2368 
”r
 = 
	`wr™e_PES_as_TS_PES_·ck‘
(
»ad”
->
tswr™”
,

2369 
»ad”
->
·ck‘
->
d©a
,

2370 
»ad”
->
·ck‘
->
d©a_Ën
,

2371 
pid
,
¡»am_id
,
FALSE
,0,0);

2372 ià(
”r
)

2374 
	`´št_”r
("### Error writing out PES…acket‡s TS\n");

2377 ià(
»ad”
->
³s_·ddšg
)

2380 
ii
;

2381 
PES_·ck‘_d©a_p
 
dummy
;

2382 
”r
 = 
	`bud_dummy_PES_·ck‘_d©a
(&
dummy
,
»ad”
->
·ck‘
->
d©a_Ën
);

2383 ià(
”r
)  1;

2384 
ii
 = 0; i˜< 
»ad”
->
³s_·ddšg
; ii++)

2386 
”r
 = 
	`wr™e_PES_as_TS_PES_·ck‘
(
»ad”
->
tswr™”
,

2387 
dummy
->
d©a
,dummy->
d©a_Ën
,

2388 
pid
,
STREAM_ID_PADDING_STREAM
,
FALSE
,0,0);

2389 ià(
”r
)

2391 
	`´št_”r
("### Error writing out dummy PES…acket‡s TS\n");

2398 
	`ä“_PES_·ck‘_d©a
(&
»ad”
->
·ck‘
);

2402 
»ad”
->
dÚt_wr™e_cu¼’t_·ck‘
 = 
FALSE
;

2404 ià(
»ad”
->
is_TS
)

2405 
”r
 = 
	`»ad_Ãxt_PES_·ck‘_äom_TS
(
»ad”
,&»ad”->
·ck‘
);

2407 
”r
 = 
	`»ad_Ãxt_PES_·ck‘_äom_PS
(
»ad”
,&»ad”->
·ck‘
);

2408 #ià
DEBUG_READ_PACKETS


2409 ià(
»ad”
->
debug_»ad_·ck‘s
)

2411 ià(
”r
==
EOF
)

2412 
	`´št_msg
("<<EOF>>\n");

2413 ià(!
”r
)

2414 
	`åršt_msg
("<<Ãw PES…ack‘‡ˆ" 
OFFSET_T_FORMAT
 ">>\n",

2415 
»ad”
->
·ck‘
->
po¢
);

2420 ià(!
”r
)

2421 
»ad”
->
·ck‘
->
has_PTS
 = 
	`PES_·ck‘_has_PTS
(reader->packet);

2422  
”r
;

2423 
	}
}

2438 
	$ÿlc_m³g1_³s_off£t
(
by‹
 *
d©a
, 
d©a_Ën
)

2440 
po¢
 = 6;

2442 
po¢
 < 
d©a_Ën
 && 
d©a
[posn] == 0xFF)

2443 
po¢
++;

2445 ià(
po¢
 < 
d©a_Ën
)

2447 ià((
d©a
[
po¢
] & 0xC0) == 0x40)

2448 
po¢
 += 2;

2450 ià((
d©a
[
po¢
] & 0xF0) == 0x20)

2451 
po¢
 += 5;

2452 ià((
d©a
[
po¢
] & 0xF0) == 0x30)

2453 
po¢
 += 10;

2454 ià(
d©a
[
po¢
] == 0x0F)

2455 
po¢
 ++;

2458 
	`åršt_”r
("### MPEG-1 PES…acket has 0x%1xX"

2459 " in¡—d oà0x40, 0x2X, 0x3X o¸0x0F\n",(
d©a
[
po¢
]&0xF0)>>4);

2460 
po¢
 ++;

2463  
po¢
;

2464 
	}
}

2477 
šlše
 
	$£tup_PES_as_ES
(
PES_·ck‘_d©a_p
 
·ck‘
)

2479 
by‹
 
¡»am_id
;

2480 
off£t
;

2482 ià(!
·ck‘
->
is_video
)

2484 
·ck‘
->
es_d©a
 =…ack‘->
d©a
 + 6;

2485 
·ck‘
->
es_d©a_Ën
 = 0;

2489 
¡»am_id
 = 
·ck‘
->
d©a
[3];

2491 
¡»am_id
)

2493 
STREAM_ID_PROGRAM_STREAM_MAP
:

2494 
STREAM_ID_PRIVATE_STREAM_2
:

2495 
STREAM_ID_ECM_STREAM
:

2496 
STREAM_ID_EMM_STREAM
:

2497 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

2498 
STREAM_ID_DSMCC_STREAM
:

2499 
STREAM_ID_H222_E_STREAM
:

2501 
·ck‘
->
es_d©a
 =…ack‘->
d©a
 + 6;

2502 
·ck‘
->
es_d©a_Ën
 = 0;

2504 
STREAM_ID_PADDING_STREAM
:

2506 
·ck‘
->
es_d©a
 =…ack‘->
d©a
 + 6;

2507 
·ck‘
->
es_d©a_Ën
 = 0;

2517 ià(
	`IS_H222_PES
(
·ck‘
->
d©a
))

2528 
PES_h—d”_d©a_Ëngth
 = 
·ck‘
->
d©a
[8];

2529 
off£t
 = 9 + 
PES_h—d”_d©a_Ëngth
;

2531 
·ck‘
->
d©a_®ignm’t_šdiÿtÜ
 = (·ck‘->
d©a
[6] & 0x04) >> 2;

2536 
off£t
 = 
	`ÿlc_m³g1_³s_off£t
(
·ck‘
->
d©a
,·ck‘->
d©a_Ën
);

2538 
·ck‘
->
es_d©a
 =…ack‘->
d©a
 + 
off£t
;

2539 
·ck‘
->
es_d©a_Ën
 =…ack‘->
d©a_Ën
 - 
off£t
;

2541 
	`´št_d©a
(
TRUE
," ",
·ck‘
->
es_d©a
,·ck‘->
es_d©a_Ën
,20);

2544 #ifdeà
DEBUG


2545 ià(
»ad”
->
give_šfo
)

2546 
	`´št_d©a
(
TRUE
,".. ES d©a",
·ck‘
->
es_d©a
,·ck‘->
es_d©a_Ën
,20);

2550 
	}
}

2561 
	$»ad_Ãxt_PES_ES_·ck‘
(
PES_»ad”_p
 
»ad”
)

2565 
”r
 = 
	`»ad_Ãxt_PES_·ck‘
(
»ad”
);

2566 ià(
”r
) ƒrr;

2568 #ifdeà
DEBUG


2569 ià(
»ad”
->
give_šfo
)

2571 
	`åršt_msg
(".. PES…ack‘‡ˆ" 
OFFSET_T_FORMAT
 " is %x (",

2572 
»ad”
->
·ck‘
->
po¢
,»ad”->·ck‘->
d©a
[3]);

2573 
	`´št_¡»am_id
(
TRUE
,
»ad”
->
·ck‘
->
d©a
[3]);

2574 
	`åršt_msg
(")%s\n",(
»ad”
->
·ck‘
->
is_video
?" VIDEO":""));

2578 ià(
»ad”
->
·ck‘
->
is_video
)

2580 ià(
»ad”
->
debug_»ad_·ck‘s
)

2581 
	`»pÜt_PES_d©a_¬¿y
("",
»ad”
->
·ck‘
->
d©a
,»ad”->·ck‘->
d©a_Ën
,

2582 
TRUE
);

2584 
	`£tup_PES_as_ES
(
»ad”
->
·ck‘
);

2585 ià(
»ad”
->
·ck‘
->
es_d©a_Ën
 > 0)

2590 
	}
}

2605 
	$decode_±s_dts
(
by‹
 
d©a
[],

2606 
»quœed_gu¬d
,

2607 
ušt64_t
 *
v®ue
)

2609 
ušt64_t
 
±s1
,
±s2
,
±s3
;

2610 
m¬k”
;

2611 *
wh©
;

2612 
gu¬d
 = (
d©a
[0] & 0xF0) >> 4;

2617 
d©a0
 = 
d©a
[0];

2618 
d©a1
 = 
d©a
[1];

2619 
d©a2
 = 
d©a
[2];

2620 
d©a3
 = 
d©a
[3];

2621 
d©a4
 = 
d©a
[4];

2623 
»quœed_gu¬d
)

2625 2: 
wh©
 = "PTS"; ;

2626 3: 
wh©
 = "PTS"; ;

2627 1: 
wh©
 = "DTS"; ;

2628 : 
wh©
 = "PTS/DTS"; ;

2631 ià(
gu¬d
 !ğ
»quœed_gu¬d
)

2633 
	`åršt_”r
("!!! Guard bits‡t start of %s data‡re %x,‚ot %x\n",

2634 
wh©
,
gu¬d
,
»quœed_gu¬d
);

2637 
±s1
 = (
d©a0
 & 0x0E) >> 1;

2638 
m¬k”
 = 
d©a0
 & 0x01;

2639 ià(
m¬k”
 != 1)

2641 
	`åršt_”r
("### Fœ¡ % m¬k” i nÙ 1",
wh©
);

2645 
±s2
 = (
d©a1
 << 7è| ((
d©a2
 & 0xFE) >> 1);

2646 
m¬k”
 = 
d©a2
 & 0x01;

2647 ià(
m¬k”
 != 1)

2649 
	`åršt_”r
("### SecÚd % m¬k” i nÙ 1",
wh©
);

2653 
±s3
 = (
d©a3
 << 7è| ((
d©a4
 & 0xFE) >> 1);

2654 
m¬k”
 = 
d©a4
 & 0x01;

2655 ià(
m¬k”
 != 1)

2657 
	`åršt_”r
("### Thœd % m¬k” i nÙ 1",
wh©
);

2661 *
v®ue
 = (
±s1
 << 30è| (
±s2
 << 15è| 
±s3
;

2663 
	}
}

2673 
	$’code_±s_dts
(
by‹
 
d©a
[],

2674 
gu¬d_b™s
,

2675 
ušt64_t
 
v®ue
)

2677 
±s1
,
±s2
,
±s3
;

2679 
	#MAX_PTS_VALUE
 0x1FFFFFFFFLL

	)

2681 ià(
v®ue
 > 
MAX_PTS_VALUE
)

2683 *
wh©
;

2684 
ušt64_t
 
‹mp
 = 
v®ue
;

2685 
‹mp
 > 
MAX_PTS_VALUE
)

2686 
‹mp
 -ğ
MAX_PTS_VALUE
;

2687 
gu¬d_b™s
)

2689 2: 
wh©
 = "PTS‡lone"; ;

2690 3: 
wh©
 = "PTS before DTS"; ;

2691 1: 
wh©
 = "DTS‡fter PTS"; ;

2692 : 
wh©
 = "PTS/DTS/???"; ;

2694 
	`åršt_”r
("!!! v®u" 
LLU_FORMAT
 " for %s is morehan " LLU_FORMAT

2695 " -„eduûdØ" 
LLU_FORMAT
 "\n",
v®ue
,
wh©
,
MAX_PTS_VALUE
,
‹mp
);

2696 
v®ue
 = 
‹mp
;

2699 
±s1
 = ()((
v®ue
 >> 30) & 0x07);

2700 
±s2
 = ()((
v®ue
 >> 15) & 0x7FFF);

2701 
±s3
 = ()Ğ
v®ue
 & 0x7FFF);

2703 
d©a
[0] = (
gu¬d_b™s
 << 4è| (
±s1
 << 1) | 0x01;

2704 
d©a
[1] = (
±s2
 & 0x7F80) >> 7;

2705 
d©a
[2] = ((
±s2
 & 0x007F) << 1) | 0x01;

2706 
d©a
[3] = (
±s3
 & 0x7F80) >> 7;

2707 
d©a
[4] = ((
±s3
 & 0x007F) << 1) | 0x01;

2708 
	}
}

2717 
	$PES_·ck‘_has_PTS
(
PES_·ck‘_d©a_p
 
·ck‘
)

2719 
by‹
 *
d©a
 = 
·ck‘
->data;

2721 
by‹
 
¡»am_id
;

2722 
·ck‘_Ëngth
;

2723 
by‹
 *
by‹s
;

2725 
PTS_DTS_æags
;

2727 ià(
d©a
[0] != 0 || data[1] != 0 || data[2] != 1)

2729 
	`åršt_”r
("### PES_packet_has_PTS: "

2731 
d©a
[0],data[1],data[2]);

2732  
FALSE
;

2735 
¡»am_id
 = 
d©a
[3];

2736 
·ck‘_Ëngth
 = (
d©a
[4] << 8) | data[5];

2737 
by‹s
 = 
d©a
 + 6;

2742 ià(
·ck‘_Ëngth
 == 0)

2743 
·ck‘_Ëngth
 = 
·ck‘
->
d©a_Ën
 - 6;

2745 
¡»am_id
)

2747 
STREAM_ID_PROGRAM_STREAM_MAP
:

2748 
STREAM_ID_PRIVATE_STREAM_2
:

2749 
STREAM_ID_ECM_STREAM
:

2750 
STREAM_ID_EMM_STREAM
:

2751 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

2752 
STREAM_ID_DSMCC_STREAM
:

2753 
STREAM_ID_H222_E_STREAM
:

2754  
FALSE
;

2755 
STREAM_ID_PADDING_STREAM
:

2756  
FALSE
;

2761 ià(
	`IS_H222_PES
(
d©a
))

2764 
PTS_DTS_æags
 = (
by‹s
[1] & 0xC0) >> 6;

2771 
po¢
 = 0;

2773 
po¢
 < 
·ck‘_Ëngth
 && 
by‹s
[posn] == 0xFF)

2774 
po¢
++;

2775 ià(
po¢
 =ğ
·ck‘_Ëngth
)

2776  
FALSE
;

2777 ià((
by‹s
[
po¢
] & 0xC0) == 0x40)

2778 
po¢
 += 2;

2779 ià(
po¢
 =ğ
·ck‘_Ëngth
)

2780  
FALSE
;

2781 ià((
by‹s
[
po¢
] & 0xF0) == 0x20)

2782 
PTS_DTS_æags
 = 2;

2783 ià((
by‹s
[
po¢
] & 0xF0) == 0x30)

2784 
PTS_DTS_æags
 = 3;

2786 
PTS_DTS_æags
 = 0;

2789  (
PTS_DTS_æags
 == 2 || PTS_DTS_flags == 3);

2790 
	}
}

2802 
	$»pÜt_PES_d©a_¬¿y
(*
´efix
,

2803 
by‹
 *
d©a
,

2804 
d©a_Ën
,

2805 
show_d©a
)

2809 
by‹
 
¡»am_id
;

2810 
·ck‘_Ëngth
;

2811 
by‹
 *
by‹s
;

2813 
”r
;

2814 
ušt64_t
 
±s
, 
dts
;

2816 
gÙ_±s
 = 
FALSE
;

2817 
gÙ_dts
 = 
FALSE
;

2819 ià(
d©a
[0] != 0 || data[1] != 0 || data[2] != 1)

2821 
	`åršt_”r
("### PES…acket start code…refix is %02x %02x %02x,‚ot 00 00 01",

2822 
d©a
[0],data[1],data[2]);

2826 
¡»am_id
 = 
d©a
[3];

2827 
·ck‘_Ëngth
 = (
d©a
[4] << 8) | data[5];

2828 
by‹s
 = 
d©a
 + 6;

2833 
	`åršt_msg
("%sPES…ack‘: sŒ—m id %02x (",
´efix
,
¡»am_id
);

2834 
	`´št_¡»am_id
(
TRUE
,
¡»am_id
);

2835 
	`åršt_msg
("),…ack‘†’gth %d",
·ck‘_Ëngth
);

2836 ià(
·ck‘_Ëngth
 == 0)

2838 
·ck‘_Ëngth
 = 
d©a_Ën
 - 6;

2839 
	`åršt_msg
(" (aùu®†’gth %d)",
·ck‘_Ëngth
);

2841 ià(
·ck‘_Ëngth
 !ğ
d©a_Ën
 - 6)

2843 
	`åršt_msg
(" (aùu®†’gth %d)",
d©a_Ën
 - 6);

2846 
¡»am_id
)

2848 
STREAM_ID_PROGRAM_STREAM_MAP
:

2849 
STREAM_ID_PRIVATE_STREAM_2
:

2850 
STREAM_ID_ECM_STREAM
:

2851 
STREAM_ID_EMM_STREAM
:

2852 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

2853 
STREAM_ID_DSMCC_STREAM
:

2854 
STREAM_ID_H222_E_STREAM
:

2855 
	`´št_msg
("\n Just data bytes\n");

2856 
	`´št_d©a
(
TRUE
," ",
by‹s
,
·ck‘_Ëngth
,20);

2858 
STREAM_ID_PADDING_STREAM
:

2859 
	`´št_msg
("\n");

2865 ià(
	`IS_H222_PES
(
d©a
))

2868 
PES_süamblšg_cÚŒŞ
;

2869 
PES_´iÜ™y
;

2870 
d©a_®ignm’t_šdiÿtÜ
;

2871 
cİyright
;

2872 
Üigš®_Ü_cİy
;

2873 
PTS_DTS_æags
;

2874 
ESCR_æag
;

2875 
ES_¿‹_æag
;

2876 
DSM_Œick_mode_æag
;

2877 
add™iÚ®_cİy_šfo_æag
;

2878 
PES_CRC_æag
;

2879 
PES_ex‹nsiÚ_æag
;

2880 
PES_h—d”_d©a_Ëngth
;

2881 
	`´št_msg
("\n");

2883 
PES_süamblšg_cÚŒŞ
 = (
by‹s
[0] & 0x30) >> 4;

2884 
PES_´iÜ™y
 = (
by‹s
[0] & 0x08) >> 3;

2885 
d©a_®ignm’t_šdiÿtÜ
 = (
by‹s
[0] & 0x04) >> 2;

2886 
cİyright
 = (
by‹s
[0] & 0x02) >> 1;

2887 
Üigš®_Ü_cİy
 = 
by‹s
[0] & 0x01;

2889 
	`åršt_msg
("%s scrambling %d,…riority %d, data %s, %s, %s\n",

2890 
´efix
,

2891 
PES_süamblšg_cÚŒŞ
,

2892 
PES_´iÜ™y
,

2893 (
d©a_®ignm’t_šdiÿtÜ
?"aligned":"unaligned"),

2894 (
cİyright
?"copyrighted":"copyright undefined"),

2895 (
Üigš®_Ü_cİy
?"original":"copy"));

2897 
PTS_DTS_æags
 = (
by‹s
[1] & 0xC0) >> 6;

2898 
ESCR_æag
 = (
by‹s
[1] & 0x20) >> 5;

2899 
ES_¿‹_æag
 = (
by‹s
[1] & 0x10) >> 4;

2900 
DSM_Œick_mode_æag
 = (
by‹s
[1] & 0x08) >> 3;

2901 
add™iÚ®_cİy_šfo_æag
 = (
by‹s
[1] & 0x04) >> 2;

2902 
PES_CRC_æag
 = (
by‹s
[1] & 0x02) >> 1;

2903 
PES_ex‹nsiÚ_æag
 = 
by‹s
[1] & 0x01;

2905 
	`åršt_msg
("%s %s, ESCR %d, ES_rate %d, DSMrick mode %d,‡dditional copy"

2907 
´efix
,

2908 (
PTS_DTS_æags
==2?"PTS":

2909 
PTS_DTS_æags
==3?"PTS & DTS":

2910 
PTS_DTS_æags
==0?"no PTS/DTS":"<bad PTS/DTS flag>"),

2911 
ESCR_æag
,
ES_¿‹_æag
,
DSM_Œick_mode_æag
,

2912 
add™iÚ®_cİy_šfo_æag
,
PES_CRC_æag
,
PES_ex‹nsiÚ_æag
);

2914 
PES_h—d”_d©a_Ëngth
 = 
by‹s
[2];

2916 
	`åršt_msg
("%  PES h—d” d©¨Ëngth %d\n",
´efix
,
PES_h—d”_d©a_Ëngth
);

2918 ià(
PTS_DTS_æags
 == 2)

2920 
”r
 = 
	`decode_±s_dts
(&
by‹s
[3],2,&
±s
);

2921 ià(
”r
)  1;

2922 
gÙ_±s
 = 
TRUE
;

2924 ià(
PTS_DTS_æags
 == 3)

2926 
”r
 = 
	`decode_±s_dts
(&
by‹s
[3],3,&
±s
);

2927 ià(
”r
)  1;

2928 
gÙ_±s
 = 
TRUE
;

2929 
”r
 = 
	`decode_±s_dts
(&
by‹s
[8],1,&
dts
);

2930 ià(
”r
)  1;

2931 
gÙ_dts
 = 
TRUE
;

2933 ià(
gÙ_±s
 || 
gÙ_dts
)

2935 
	`åršt_msg
("%  PTS " 
LLU_FORMAT
,
´efix
,
±s
);

2936 ià(
gÙ_dts
)

2937 
	`åršt_msg
(", DTS " 
LLU_FORMAT
,
dts
);

2938 
	`´št_msg
("\n");

2941 ià(
show_d©a
)

2943 
by‹s
 +ğ3 + 
PES_h—d”_d©a_Ëngth
;

2944 ià(
´efix
 && 
	`¡¾’
(prefix) > 0)

2945 
	`åršt_msg
("%s",
´efix
);

2946 
	`´št_d©a
(
TRUE
," ",
by‹s
,
·ck‘_Ëngth
-3-
PES_h—d”_d©a_Ëngth
,20);

2952 
po¢
 = 0;

2953 
	`´št_msg
(" (MPEG-1)\n");

2955 
po¢
 < 
·ck‘_Ëngth
 && 
by‹s
[posn] == 0xFF)

2956 
po¢
++;

2957 ià(
po¢
 < 
·ck‘_Ëngth
)

2959 ià((
by‹s
[
po¢
] & 0xC0) == 0x40)

2960 
po¢
 += 2;

2961 ià(
po¢
 =ğ
·ck‘_Ëngth
)

2964 ià((
by‹s
[
po¢
] & 0xF0) == 0x20)

2966 
”r
 = 
	`decode_±s_dts
(&
by‹s
[
po¢
],2,&
±s
);

2967 ià(
”r
)  1;

2968 
gÙ_±s
 = 
TRUE
;

2969 
po¢
 += 5;

2971 ià((
by‹s
[
po¢
] & 0xF0) == 0x30)

2973 
”r
 = 
	`decode_±s_dts
(&
by‹s
[
po¢
],3,&
±s
);

2974 ià(
”r
)  1;

2975 
gÙ_±s
 = 
TRUE
;

2976 
po¢
 += 5;

2977 
”r
 = 
	`decode_±s_dts
(&
by‹s
[
po¢
],1,&
dts
);

2978 ià(
”r
)  1;

2979 
gÙ_dts
 = 
TRUE
;

2980 
po¢
 += 5;

2982 ià(
by‹s
[
po¢
] == 0x0F)

2983 
po¢
 ++;

2986 
	`åršt_”r
("### MPEG-1 PES…acket has 0x%1xX"

2987 " in¡—d oà0x40, 0x2X, 0x3X o¸0x0F\n",(
by‹s
[
po¢
]&0xF0)>>4);

2988 
po¢
 ++;

2990 ià(
gÙ_±s
 || 
gÙ_dts
)

2992 
	`åršt_msg
("%  PTS " 
LLU_FORMAT
,
´efix
,
±s
);

2993 ià(
gÙ_dts
)

2994 
	`åršt_msg
(", DTS " 
LLU_FORMAT
,
dts
);

2995 
	`´št_msg
("\n");

2998 ià(
show_d©a
)

3000 
by‹s
 +ğ
po¢
;

3001 ià(
´efix
 && 
	`¡¾’
(prefix) > 0)

3002 
	`åršt_msg
("%s",
´efix
);

3003 
	`´št_d©a
(
TRUE
," ",
by‹s
,
·ck‘_Ëngth
-
po¢
,20);

3009 
	}
}

3027 
	$»pÜt_PES_d©a_¬¿y2
(
¡»am_ty³
,

3028 
by‹
 *
·ylßd
,

3029 
·ylßd_Ën
,

3030 
show_d©a_Ën
)

3032 
”r
;

3033 
w™h_±s
 = 
FALSE
;

3034 
w™h_dts
 = 
FALSE
;

3035 
ušt64_t
 
±s
, 
dts
;

3036 
PES_·ck‘_Ëngth
;

3037 
by‹
 *
d©a
 = 
NULL
;

3038 
d©a_Ën
 = 0;

3039 
by‹
 
¡»am_id
;

3041 ià(
·ylßd_Ën
 == 0)

3043 
	`´št_msg
(" Payload has†ength 0\n");

3046 ià(
·ylßd
 =ğ
NULL
)

3048 
	`åršt_msg
(" Paylßd i NULL, buˆshould bËngth %d\n",
·ylßd_Ën
);

3052 
¡»am_id
 = 
·ylßd
[3];

3053 
PES_·ck‘_Ëngth
 = (
·ylßd
[4] << 8) |…ayload[5];

3054 
	`´št_msg
(" PES header\n");

3055 
	`åršt_msg
(" Start code: %02x %02x %02x\n",

3056 
·ylßd
[0],payload[1],payload[2]);

3057 
	`åršt_msg
(" SŒ—m ID: %02x (%dè",
¡»am_id
,stream_id);

3058 
	`´št_h262_¡¬t_code_¡r
(
¡»am_id
);

3059 
	`´št_msg
("\n");

3060 
	`åršt_msg
(" PES…acket†ength: %04x (%d)\n",

3061 
PES_·ck‘_Ëngth
,PES_packet_length);

3063 ià(
	`IS_H222_PES
(
·ylßd
))

3066 
¡»am_id
)

3068 
STREAM_ID_PROGRAM_STREAM_MAP
:

3069 
STREAM_ID_PRIVATE_STREAM_2
:

3070 
STREAM_ID_ECM_STREAM
:

3071 
STREAM_ID_EMM_STREAM
:

3072 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

3073 
STREAM_ID_DSMCC_STREAM
:

3074 
STREAM_ID_H222_E_STREAM
:

3075 
	`´št_msg
(" Just data bytes\n");

3076 
	`´št_d©a
(
TRUE
," D©a",
·ylßd
+6,
·ylßd_Ën
-6,1000);

3078 
STREAM_ID_PADDING_STREAM
:

3079 
	`´št_msg
(" Padding stream\n");

3085 
	`åršt_msg
(" FÏgs: %02x %02x",
·ylßd
[6],payload[7]);

3086 ià(
·ylßd
[6] != 0)

3088 
süambË
 = (
·ylßd
[6] & 0x30) >> 8;

3089 ià(
süambË
 !ğ0è
	`åršt_msg
(" scramble-control %d",scramble);

3090 ià(
	`ON
(
·ylßd
[6],0x08)è
	`´št_msg
(" PES-priority");

3091 ià(
	`ON
(
·ylßd
[6],0x04)è
	`´št_msg
(" data-aligned");

3092 ià(
	`ON
(
·ylßd
[6],0x02)è
	`´št_msg
(" copyright");

3093 ià(
	`ON
(
·ylßd
[6],0x01)è
	`´št_msg
(" original/copy");

3095 ià(
·ylßd
[7] != 0)

3097 
	`´št_msg
(" :");

3098 ià(
	`ON
(
·ylßd
[7],0x80))

3100 
w™h_±s
 = 
TRUE
;

3101 
	`´št_msg
(" PTS");

3103 ià(
	`ON
(
·ylßd
[7],0x40))

3105 
w™h_dts
 = 
TRUE
;

3106 
	`´št_msg
(" DTS");

3108 ià(
	`ON
(
·ylßd
[7],0x20)è
	`´št_msg
(" ESCR");

3109 ià(
	`ON
(
·ylßd
[7],0x10)è
	`´št_msg
(" ES-rate");

3110 ià(
	`ON
(
·ylßd
[7],0x08)è
	`´št_msg
(" DSM-trick-mode");

3111 ià(
	`ON
(
·ylßd
[7],0x04)è
	`´št_msg
(" more-copy-info");

3112 ià(
	`ON
(
·ylßd
[7],0x02)è
	`´št_msg
(" CRC");

3113 ià(
	`ON
(
·ylßd
[7],0x01)è
	`´št_msg
("ƒxtension");

3115 
	`´št_msg
("\n");

3116 
	`åršt_msg
(" PES h—d”†’ %d\n", 
·ylßd
[8]);

3118 ià(
w™h_±s
)

3120 
”r
 = 
	`decode_±s_dts
(&(
·ylßd
[9]),(
w™h_dts
?3:2),&
±s
);

3121 ià(!
”r
)

3122 
	`åršt_msg
(" PTS " 
LLU_FORMAT
 "\n",
±s
);

3124 ià(
w™h_dts
)

3126 
”r
 = 
	`decode_±s_dts
(&(
·ylßd
[14]),1,&
dts
);

3127 ià(!
”r
)

3128 
	`åršt_msg
(" DTS " 
LLU_FORMAT
 "\n",
dts
);

3131 
d©a
 = 
·ylßd
 + 9 +…ayload[8];

3132 
d©a_Ën
 = 
·ylßd_Ën
 - 9 - 
·ylßd
[8];

3138 ià(
¡»am_ty³
 == 0x06 || stream_type == 0x81)

3140 ià(
d©a_Ën
 >ğ2 && 
d©a
[0] == 0x0B && data[1] == 0x77)

3141 
	`´št_msg
(" AC-3‡udio data\n");

3142 ià(
d©a_Ën
 >= 4 &&

3143 
d©a
[0] == 0x7F && data[1] == 0xFE &&

3144 
d©a
[1] == 0x80 && data[2] == 0x01)

3145 
	`´št_msg
(" DTS‡udio data\n");

3151 
po¢
 = 0;

3152 
	`´št_msg
(" MPEG-1…acket†ayer…acket\n");

3154 ià(
¡»am_id
 !ğ
STREAM_ID_PRIVATE_STREAM_2
)

3157 
po¢
 < 
PES_·ck‘_Ëngth
 && 
·ylßd
[6+posn] == 0xFF)

3158 
po¢
++;

3159 ià(
po¢
 != 0)

3160 
	`åršt_msg
(" %d stuffšg by‹%s\n",
po¢
,posn==1?"":"s");

3162 ià(
po¢
 < 
PES_·ck‘_Ëngth
)

3164 ià((
·ylßd
[6+
po¢
] & 0xC0) == 0x40)

3166 
	`åršt_msg
(" STD bufã¸sÿË %d\n",
	`ON
(
·ylßd
[6+
po¢
],5));

3167 
	`åršt_msg
(" STD bufã¸siz%d\n",(
·ylßd
[6+
po¢
] & 0x1F) << 8 |

3168 (
·ylßd
[6+
po¢
+1]));

3169 
po¢
 += 2;

3171 ià(
po¢
 =ğ
PES_·ck‘_Ëngth
)

3174 ià((
·ylßd
[6+
po¢
] & 0xF0) == 0x20)

3176 
”r
 = 
	`decode_±s_dts
(&
·ylßd
[6+
po¢
],2,&
±s
);

3177 ià(
”r
) ;

3178 
w™h_±s
 = 
TRUE
;

3179 
po¢
 += 5;

3181 ià((
·ylßd
[6+
po¢
] & 0xF0) == 0x30)

3183 
”r
 = 
	`decode_±s_dts
(&
·ylßd
[6+
po¢
],3,&
±s
);

3184 ià(
”r
) ;

3185 
w™h_±s
 = 
TRUE
;

3186 
po¢
 += 5;

3187 
”r
 = 
	`decode_±s_dts
(&
·ylßd
[6+
po¢
],1,&
dts
);

3188 ià(
”r
) ;

3189 
w™h_dts
 = 
TRUE
;

3190 
po¢
 += 5;

3192 ià(
·ylßd
[6+
po¢
] == 0x0F)

3193 
po¢
 ++;

3196 
	`åršt_”r
("### MPEG-1 PES…acket has 0x%1xX"

3197 " in¡—d oà0x40, 0x2X, 0x3X o¸0x0F\n",(
·ylßd
[
po¢
]&0xF0)>>4);

3198 
po¢
 ++;

3200 ià(
w™h_±s
 || 
w™h_dts
)

3202 
	`åršt_msg
(" PTS " 
LLU_FORMAT
 "\n",
±s
);

3203 ià(
w™h_dts
)

3204 
	`åršt_msg
(" DTS " 
LLU_FORMAT
 "\n",
dts
);

3205 
	`´št_msg
("\n");

3208 
d©a
 = 
·ylßd
 + 6 + 
po¢
;

3209 
d©a_Ën
 = 
·ylßd_Ën
 - 6 - 
po¢
;

3214 
d©a
 = 
·ylßd
 + 6;

3215 
d©a_Ën
 = 
·ylßd_Ën
 - 6;

3218 ià(
show_d©a_Ën
)

3219 
	`´št_d©a
(
TRUE
," D©a",
d©a
,
d©a_Ën
,
show_d©a_Ën
);

3220 
	}
}

3232 
	$fšd_PTS_š_PES
(
by‹
 
d©a
[],

3233 
št32_t
 
d©a_Ën
,

3234 *
gÙ_±s
,

3235 
ušt64_t
 *
±s
)

3237 
by‹
 
¡»am_id
;

3238 
·ck‘_Ëngth
;

3239 
by‹
 *
by‹s
;

3241 
PTS_DTS_æags
;

3243 *
gÙ_±s
 = 
FALSE
;

3245 ià(
d©a
[0] != 0 || data[1] != 0 || data[2] != 1)

3247 
	`åršt_”r
("### find_PTS_in_PES:"

3249 
d©a
[0],data[1],data[2]);

3253 
¡»am_id
 = 
d©a
[3];

3254 
·ck‘_Ëngth
 = (
d©a
[4] << 8) | data[5];

3259 
¡»am_id
)

3261 
STREAM_ID_PROGRAM_STREAM_MAP
:

3262 
STREAM_ID_PRIVATE_STREAM_2
:

3263 
STREAM_ID_ECM_STREAM
:

3264 
STREAM_ID_EMM_STREAM
:

3265 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

3266 
STREAM_ID_DSMCC_STREAM
:

3267 
STREAM_ID_H222_E_STREAM
:

3269 
STREAM_ID_PADDING_STREAM
:

3275 
by‹s
 = 
d©a
 + 6;

3276 ià(
	`IS_H222_PES
(
d©a
))

3279 
PTS_DTS_æags
 = (
by‹s
[1] & 0xC0) >> 6;

3281 ià(
PTS_DTS_æags
 == 2 || PTS_DTS_flags == 3)

3283 
”r
 = 
	`decode_±s_dts
(&
by‹s
[3],
PTS_DTS_æags
,
±s
);

3284 ià(
”r
)  1;

3285 *
gÙ_±s
 = 
TRUE
;

3290 
po¢
 = 0;

3291 
m¬k”
;

3294 
po¢
 < 
·ck‘_Ëngth
 && 
by‹s
[posn] == 0xFF)

3295 
po¢
++;

3296 ià(
po¢
 < 
·ck‘_Ëngth
)

3298 ià((
by‹s
[
po¢
] & 0xC0) == 0x40)

3299 
po¢
 += 2;

3300 ià(
po¢
 =ğ
·ck‘_Ëngth
)

3302 
m¬k”
 = (
by‹s
[
po¢
] & 0xF0) >> 4;

3303 ià(
m¬k”
 == 2 ||

3304 
m¬k”
 == 3)

3306 
”r
 = 
	`decode_±s_dts
(&
by‹s
[
po¢
],
m¬k”
,
±s
);

3307 ià(
”r
)  1;

3308 *
gÙ_±s
 = 
TRUE
;

3313 
	}
}

3325 
	$fšd_DTS_š_PES
(
by‹
 
d©a
[],

3326 
št32_t
 
d©a_Ën
,

3327 *
gÙ_dts
,

3328 
ušt64_t
 *
dts
)

3330 
by‹
 
¡»am_id
;

3331 
·ck‘_Ëngth
;

3332 
by‹
 *
by‹s
;

3334 
PTS_DTS_æags
;

3336 *
gÙ_dts
 = 
FALSE
;

3338 ià(
d©a
[0] != 0 || data[1] != 0 || data[2] != 1)

3340 
	`åršt_”r
("### find_DTS_in_PES:"

3342 
d©a
[0],data[1],data[2]);

3346 
¡»am_id
 = 
d©a
[3];

3347 
·ck‘_Ëngth
 = (
d©a
[4] << 8) | data[5];

3352 
¡»am_id
)

3354 
STREAM_ID_PROGRAM_STREAM_MAP
:

3355 
STREAM_ID_PRIVATE_STREAM_2
:

3356 
STREAM_ID_ECM_STREAM
:

3357 
STREAM_ID_EMM_STREAM
:

3358 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

3359 
STREAM_ID_DSMCC_STREAM
:

3360 
STREAM_ID_H222_E_STREAM
:

3362 
STREAM_ID_PADDING_STREAM
:

3368 
by‹s
 = 
d©a
 + 6;

3369 ià(
	`IS_H222_PES
(
d©a
))

3372 
PTS_DTS_æags
 = (
by‹s
[1] & 0xC0) >> 6;

3374 ià(
PTS_DTS_æags
 == 3)

3377 
”r
 = 
	`decode_±s_dts
(&
by‹s
[8],1,
dts
);

3378 ià(
”r
)  1;

3379 *
gÙ_dts
 = 
TRUE
;

3384 
po¢
 = 0;

3387 
po¢
 < 
·ck‘_Ëngth
 && 
by‹s
[posn] == 0xFF)

3388 
po¢
++;

3389 ià(
po¢
 < 
·ck‘_Ëngth
)

3391 ià((
by‹s
[
po¢
] & 0xC0) == 0x40)

3392 
po¢
 += 2;

3393 ià(
po¢
 =ğ
·ck‘_Ëngth
)

3396 ià((
by‹s
[
po¢
] & 0xF0) == 0x30)

3398 
”r
 = 
	`decode_±s_dts
(&
by‹s
[
po¢
+5],1,
dts
);

3399 ià(
”r
)  1;

3400 *
gÙ_dts
 = 
TRUE
;

3405 
	}
}

3419 
	$fšd_PTS_DTS_š_PES
(
by‹
 
d©a
[],

3420 
št32_t
 
d©a_Ën
,

3421 *
gÙ_±s
,

3422 
ušt64_t
 *
±s
,

3423 *
gÙ_dts
,

3424 
ušt64_t
 *
dts
)

3426 
by‹
 
¡»am_id
;

3427 
·ck‘_Ëngth
;

3428 
by‹
 *
by‹s
;

3430 
PTS_DTS_æags
;

3432 *
gÙ_±s
 = 
FALSE
;

3433 *
gÙ_dts
 = 
FALSE
;

3435 ià(
d©a
[0] != 0 || data[1] != 0 || data[2] != 1)

3437 
	`åršt_”r
("### find_PTS_DTS_in_PES"

3439 
d©a
[0],data[1],data[2]);

3443 
¡»am_id
 = 
d©a
[3];

3444 
·ck‘_Ëngth
 = (
d©a
[4] << 8) | data[5];

3449 
¡»am_id
)

3451 
STREAM_ID_PROGRAM_STREAM_MAP
:

3452 
STREAM_ID_PRIVATE_STREAM_2
:

3453 
STREAM_ID_ECM_STREAM
:

3454 
STREAM_ID_EMM_STREAM
:

3455 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

3456 
STREAM_ID_DSMCC_STREAM
:

3457 
STREAM_ID_H222_E_STREAM
:

3459 
STREAM_ID_PADDING_STREAM
:

3465 
by‹s
 = 
d©a
 + 6;

3466 ià(
	`IS_H222_PES
(
d©a
))

3469 
PTS_DTS_æags
 = (
by‹s
[1] & 0xC0) >> 6;

3471 ià(
PTS_DTS_æags
 == 2 || PTS_DTS_flags == 3)

3473 
”r
 = 
	`decode_±s_dts
(&
by‹s
[3],
PTS_DTS_æags
,
±s
);

3474 ià(
”r
)  1;

3475 *
gÙ_±s
 = 
TRUE
;

3477 ià(
PTS_DTS_æags
 == 3)

3480 
”r
 = 
	`decode_±s_dts
(&
by‹s
[8],1,
dts
);

3481 ià(
”r
)  1;

3482 *
gÙ_dts
 = 
TRUE
;

3487 
po¢
 = 0;

3488 
m¬k”
;

3491 
po¢
 < 
·ck‘_Ëngth
 && 
by‹s
[posn] == 0xFF)

3492 
po¢
++;

3493 ià(
po¢
 < 
·ck‘_Ëngth
)

3495 ià((
by‹s
[
po¢
] & 0xC0) == 0x40)

3496 
po¢
 += 2;

3497 ià(
po¢
 =ğ
·ck‘_Ëngth
)

3499 
m¬k”
 = (
by‹s
[
po¢
] & 0xF0) >> 4;

3500 ià(
m¬k”
 == 2 ||

3501 
m¬k”
 == 3)

3503 
”r
 = 
	`decode_±s_dts
(&
by‹s
[
po¢
],
m¬k”
,
±s
);

3504 ià(
”r
)  1;

3505 *
gÙ_±s
 = 
TRUE
;

3507 ià(
m¬k”
 == 3)

3509 
”r
 = 
	`decode_±s_dts
(&
by‹s
[
po¢
+5],1,
dts
);

3510 ià(
”r
)  1;

3511 *
gÙ_dts
 = 
TRUE
;

3517 ià(*
gÙ_±s
 && !*
gÙ_dts
)

3519 *
dts
 = *
±s
;

3520 *
gÙ_dts
 = 
TRUE
;

3523 
	}
}

3535 
	$fšd_ESCR_š_PES
(
by‹
 
d©a
[],

3536 
št32_t
 
d©a_Ën
,

3537 *
gÙ_esü
,

3538 
ušt64_t
 *
esü
)

3540 
by‹
 
¡»am_id
;

3541 
·ck‘_Ëngth
;

3542 
by‹
 *
by‹s
;

3544 *
gÙ_esü
 = 
FALSE
;

3545 *
esü
 = 0;

3547 ià(
d©a
[0] != 0 || data[1] != 0 || data[2] != 1)

3549 
	`åršt_”r
("### find_ESCR_in_PES:"

3551 
d©a
[0],data[1],data[2]);

3555 
¡»am_id
 = 
d©a
[3];

3556 
·ck‘_Ëngth
 = (
d©a
[4] << 8) | data[5];

3561 
¡»am_id
)

3563 
STREAM_ID_PROGRAM_STREAM_MAP
:

3564 
STREAM_ID_PRIVATE_STREAM_2
:

3565 
STREAM_ID_ECM_STREAM
:

3566 
STREAM_ID_EMM_STREAM
:

3567 
STREAM_ID_PROGRAM_STREAM_DIRECTORY
:

3568 
STREAM_ID_DSMCC_STREAM
:

3569 
STREAM_ID_H222_E_STREAM
:

3571 
STREAM_ID_PADDING_STREAM
:

3577 
by‹s
 = 
d©a
 + 6;

3578 ià(
	`IS_H222_PES
(
d©a
))

3581 *
gÙ_esü
 = (
by‹s
[1] & 0x20) == 0x20;

3582 ià(*
gÙ_esü
)

3584 
ušt64_t
 
ESCR_ba£
;

3585 
ušt32_t
 
ESCR_exŠ
;

3586 
PTS_DTS_æags
 = (
by‹s
[1] & 0xC0) >> 6;

3587 
off£t
;

3588 ià(
PTS_DTS_æags
 == 2)

3589 
off£t
 = 2 + 5;

3590 ià(
PTS_DTS_æags
 == 3)

3591 
off£t
 = 2 + 10;

3593 
off£t
 = 2 + 0;

3594 
ESCR_ba£
 =

3595 (
by‹s
[
off£t
+4] >> 3) |

3596 (
by‹s
[
off£t
+3] << 5) |

3597 (
by‹s
[
off£t
+2] << 13) |

3598 (
by‹s
[
off£t
+1] << 20) |

3599 ((((
ušt64_t
)
by‹s
[
off£t
]) & 0x03) << 28) |

3600 ((((
ušt64_t
)
by‹s
[
off£t
]) & 0x38) << 27);

3601 
ESCR_exŠ
 =

3602 (
by‹s
[
off£t
+5] >> 1) |

3603 (
by‹s
[
off£t
+4] << 7);

3604 *
esü
 = 
ESCR_ba£
 * 300 + 
ESCR_exŠ
;

3608 
	}
}

3632 
	$£t_£rv”_ouut
(
PES_»ad”_p
 
»ad”
,

3633 
TS_wr™”_p
 
tswr™”
,

3634 
wr™e_PES
,

3635 
´og¿m_äeq
)

3637 
»ad”
->
tswr™”
 =swriter;

3638 
»ad”
->
´og¿m_äeq
 =…rogram_freq;

3639 
»ad”
->
´og¿m_šdex
 = 0;

3640 
»ad”
->
wr™e_PES_·ck‘s
 = 
wr™e_PES
;

3641 
»ad”
->
wr™e_TS_·ck‘s
 = !
wr™e_PES
;

3642 
»ad”
->
suµ»ss_wr™šg
 = 
FALSE
;

3644 
	}
}

3656 
	$¡¬t_£rv”_ouut
(
PES_»ad”_p
 
»ad”
)

3658 ià(
»ad”
 !ğ
NULL
)

3659 
»ad”
->
suµ»ss_wr™šg
 = 
FALSE
;

3661 
	}
}

3670 
	$¡İ_£rv”_ouut
(
PES_»ad”_p
 
»ad”
)

3672 ià(
»ad”
 !ğ
NULL
)

3673 
»ad”
->
suµ»ss_wr™šg
 = 
TRUE
;

3675 
	}
}

3692 
	$£t_£rv”_·ddšg
(
PES_»ad”_p
 
»ad”
,

3693 
exŒa
)

3695 
»ad”
->
³s_·ddšg
 = 
exŒa
;

3697 
	}
}

3706 
	$wr™e_´og¿m_d©a
(
PES_»ad”_p
 
»ad”
,

3707 
TS_wr™”_p
 
ouut
)

3710 
num_´ogs
 = 0;

3711 
ušt32_t
 
´og_pids
[2];

3712 
by‹
 
´og_ty³
[2];

3713 
”r
;

3714 
ušt32_t
 
pü_pid
;

3719 ià(
»ad”
->
wr™e_TS_·ck‘s
 &&

3720 !
»ad”
->
suµ»ss_wr™šg
)

3728 ià(!
»ad”
->
gÙ_´og¿m_d©a
)

3731 ià(
»ad”
->
is_TS
)

3734 ià(
»ad”
->
video_pid
 != 0)

3736 
pmt_¡»am_p
 
¡»am
 = 
	`pid_¡»am_š_pmt
(
»ad”
->
´og¿m_m­
,

3737 
»ad”
->
video_pid
);

3738 ià(
¡»am
 =ğ
NULL
)

3740 
	`åršt_”r
("### Cannot find video PID %04x in…rogram map\n",

3741 
»ad”
->
video_pid
);

3744 
´og_pids
[0] = 
»ad”
->
ouut_video_pid
;

3745 
´og_ty³
[0] = 
¡»am
->
¡»am_ty³
;

3746 
num_´ogs
 = 1;

3748 ià(
»ad”
->
audio_pid
 != 0)

3750 
pmt_¡»am_p
 
¡»am
 = 
	`pid_¡»am_š_pmt
(
»ad”
->
´og¿m_m­
,

3751 
»ad”
->
audio_pid
);

3752 ià(
¡»am
 =ğ
NULL
)

3754 
	`åršt_”r
("### Cannot find‡udio PID %04x in…rogram map\n",

3755 
»ad”
->
audio_pid
);

3758 
´og_pids
[
num_´ogs
] = 
»ad”
->
ouut_audio_pid
;

3759 
´og_ty³
[
num_´ogs
] = 
¡»am
->
¡»am_ty³
;

3760 
num_´ogs
++;

3772 
num_´ogs
 = 1;

3773 
´og_pids
[0] = 
»ad”
->
ouut_video_pid
;

3774 
»ad”
->
video_ty³
)

3776 
VIDEO_H264
:

3777 
´og_ty³
[0] = 
AVC_VIDEO_STREAM_TYPE
;

3779 
VIDEO_H262
:

3780 
´og_ty³
[0] = 
MPEG2_VIDEO_STREAM_TYPE
;

3782 
VIDEO_AVS
:

3783 
´og_ty³
[0] = 
AVS_VIDEO_STREAM_TYPE
;

3786 
´og_ty³
[0] = 
MPEG2_VIDEO_STREAM_TYPE
;

3790 
´og_pids
[1] = 
»ad”
->
ouut_audio_pid
;

3791 ià(
»ad”
->
audio_¡»am_id
 == 0)

3795 
´og_ty³
[1] = 
MPEG2_AUDIO_STREAM_TYPE
;

3799 ià(
»ad”
->
audio_¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
)

3800 
´og_ty³
[1] = 
»ad”
->
ouut_dŞby_¡»am_ty³
;

3802 
´og_ty³
[1] = 
MPEG2_AUDIO_STREAM_TYPE
;

3804 
num_´ogs
 = 2;

3807 
pü_pid
 = 
»ad”
->
ouut_pü_pid
;

3808 ià(
pü_pid
 == 0)

3809 
pü_pid
 = 
»ad”
->
ouut_video_pid
;

3811 #ià
SHOW_PROGRAM_INFO


3812 ià(
»ad”
->
give_šfo
)

3814 
	`åršt_msg
("PROGRAM %d:…mt %x (%d),…cr %x (%d)\n"

3816 
»ad”
->
ouut_´og¿m_numb”
,

3817 
»ad”
->
ouut_pmt_pid
,reader->output_pmt_pid,

3818 
pü_pid
,pcr_pid,

3819 
»ad”
->
ouut_video_pid
,reader->output_video_pid,

3820 
´og_ty³
[0],
	`h222_¡»am_ty³_¡r
(prog_type[0]));

3821 ià(
num_´ogs
 == 2)

3822 
	`åršt_msg
("‡udio %x (%d)ype %02x (%s)\n",

3823 
»ad”
->
ouut_audio_pid
,reader->output_audio_pid,

3824 
´og_ty³
[1],
	`h222_¡»am_ty³_¡r
(prog_type[1]));

3828 
”r
 = 
	`wr™e_TS_´og¿m_d©a2
(
ouut
,

3830 
»ad”
->
ouut_´og¿m_numb”
,

3831 
»ad”
->
ouut_pmt_pid
,
pü_pid
,

3832 
num_´ogs
,
´og_pids
,
´og_ty³
);

3833 ià(
”r
)

3835 
	`´št_”r
("### Error writing out TS…rogram data\n");

3839 
	}
}

	@pes_defns.h

29 #iâdeà
_³s_deâs


30 
	#_³s_deâs


	)

32 
	~"com·t.h
"

33 
	~"pidšt_deâs.h
"

34 
	~"ps_deâs.h
"

35 
	~"ts_deâs.h
"

36 
	~"tswr™e_deâs.h
"

40 
	sPES_·ck‘_d©a


42 
by‹
 *
	md©a
;

43 
št32_t
 
	md©a_Ën
;

44 
št32_t
 
	mËngth
;

45 
off£t_t
 
	mpo¢
;

46 
	mis_video
;

51 
by‹
 *
	mes_d©a
;

52 
št32_t
 
	mes_d©a_Ën
;

56 
	md©a_®ignm’t_šdiÿtÜ
;

60 
	mhas_PTS
;

68 
PES_·ck‘_d©a
 *
	tPES_·ck‘_d©a_p
;

69 
	#SIZEOF_PES_PACKET_DATA
 (
PES_·ck‘_d©a
)

	)

73 
	s³¦i¡


75 
ušt32_t
 *
	mpid
;

76 
PES_·ck‘_d©a_p
 *
	md©a
;

77 
	mËngth
;

78 
	msize
;

80 
³¦i¡
 *
	t³¦i¡_p
;

81 
	#SIZEOF_PESLIST
 (
³¦i¡
)

	)

83 
	#PESLIST_START_SIZE
 2

84 
	#PESLIST_INCREMENT
 1

85 

	)

89 
	sPES_»ad”


91 
	mis_TS
;

94 
TS_»ad”_p
 
	mt¤—d”
;

96 
PS_»ad”_p
 
	mp¤—d”
;

98 
	mgive_šfo
;

99 
	mgive_w¬nšg
;

101 
PES_·ck‘_d©a_p
 
	m·ck‘
;

105 
off£t_t
 
	mpo¢
;

108 
	mis_h264
;

109 
	mvideo_ty³
;

112 
	mvideo_Úly
;

117 
by‹
 
	maudio_¡»am_id
;

121 
	mgÙ_´og¿m_d©a
;

122 
pmt_p
 
	m´og¿m_m­
;

124 
ušt32_t
 
	mvideo_pid
;

125 
ušt32_t
 
	maudio_pid
;

126 
ušt32_t
 
	mpü_pid
;

127 
ušt16_t
 
	m´og¿m_numb”
;

128 
ušt32_t
 
	mpmt_pid
;

132 
by‹
 *
	mpmt_d©a
;

133 
	mpmt_d©a_Ën
;

134 
	mpmt_d©a_u£d
;

144 
	mov”ride_´og¿m_d©a
;

146 
ušt32_t
 
	mouut_video_pid
;

147 
ušt32_t
 
	mouut_audio_pid
;

148 
ušt32_t
 
	mouut_pü_pid
;

149 
ušt16_t
 
	mouut_´og¿m_numb”
;

150 
ušt32_t
 
	mouut_pmt_pid
;

154 
by‹
 
	mdŞby_¡»am_ty³
;

155 
by‹
 
	mouut_dŞby_¡»am_ty³
;

156 
	mov”ride_dŞby_¡»am_ty³
;

165 
³¦i¡_p
 
	m·ck‘s
;

176 
PES_·ck‘_d©a_p
 
	mdeã¼ed
;

180 
	mhad_eof
;

185 
	mwr™e_PES_·ck‘s
;

186 
TS_wr™”_p
 
	mtswr™”
;

187 
	m´og¿m_äeq
;

188 
	m´og¿m_šdex
;

195 
	mdÚt_wr™e_cu¼’t_·ck‘
;

201 
	m³s_·ddšg
;

206 
	mwr™e_TS_·ck‘s
;

212 
	msuµ»ss_wr™šg
;

218 
	mdebug_»ad_·ck‘s
;

220 
PES_»ad”
 *
	tPES_»ad”_p
;

221 
	#SIZEOF_PES_READER
 (
PES_»ad”
)

	)

226 
	#IS_H222_PES
(
d©a
è((d©a[6] & 0xC0è=ğ0x80)

	)

	@pes_fns.h

29 #iâdeà
_³s_âs


30 
	#_³s_âs


	)

32 
	~"³s_deâs.h
"

33 
	~"es_deâs.h
"

41 
ä“_PES_·ck‘_d©a
(
PES_·ck‘_d©a_p
 *
d©a
);

55 
d‘”mše_if_TS_fe
(
šput
,

56 *
is_TS
);

69 
bud_PS_PES_»ad”
(
PS_»ad”_p
 
ps
,

70 
give_šfo
,

71 
give_w¬nšgs
,

72 
PES_»ad”_p
 *
»ad”
);

88 
bud_TS_PES_»ad”
(
TS_»ad”_p
 
t¤—d”
,

89 
give_šfo
,

90 
give_w¬nšgs
,

91 
ušt16_t
 
´og¿m_numb”
,

92 
PES_»ad”_p
 *
»ad”
);

109 
bud_PES_»ad”
(
šput
,

110 
is_TS
,

111 
give_šfo
,

112 
give_w¬nšgs
,

113 
ušt16_t
 
´og¿m_numb”
,

114 
PES_»ad”_p
 *
»ad”
);

132 
İ’_PES_»ad”_fÜ_TS
(*
f’ame
,

133 
ušt16_t
 
´og¿m_numb”
,

134 
give_šfo
,

135 
give_w¬nšgs
,

136 
PES_»ad”_p
 *
»ad”
);

150 
İ’_PES_»ad”_fÜ_PS
(*
f’ame
,

151 
give_šfo
,

152 
give_w¬nšgs
,

153 
PES_»ad”_p
 *
»ad”
);

174 
İ’_PES_»ad”
(*
f’ame
,

175 
give_šfo
,

176 
give_w¬nšgs
,

177 
PES_»ad”_p
 *
»ad”
);

187 
£t_PES_»ad”_video_Úly
(
PES_»ad”_p
 
»ad”
,

188 
video_Úly
);

204 
£t_PES_»ad”_audio_¡»am
(
PES_»ad”_p
 
»ad”
,

205 
¡»am_numb”
);

217 
£t_PES_»ad”_audio_´iv©e1
(
PES_»ad”_p
 
»ad”
);

238 
£t_PES_»ad”_´og¿m_d©a
(
PES_»ad”_p
 
»ad”
,

239 
ušt16_t
 
´og¿m_numb”
,

240 
ušt32_t
 
pmt_pid
,

241 
ušt32_t
 
video_pid
,

242 
ušt32_t
 
audio_pid
,

243 
ušt32_t
 
pü_pid
);

248 
£t_PES_»ad”_h264
(
PES_»ad”_p
 
»ad”
);

254 
£t_PES_»ad”_video_ty³
(
PES_»ad”_p
 
»ad”
,

255 
video_ty³
);

268 
£t_PES_»ad”_dŞby_¡»am_ty³
(
PES_»ad”_p
 
»ad”
,

269 
is_dvb
);

289 
£t_PES_»ad”_pos™iÚ
(
PES_»ad”_p
 
»ad”
,

290 
off£t_t
 
po¢
);

300 
ä“_PES_»ad”
(
PES_»ad”_p
 *
»ad”
);

310 
şo£_PES_»ad”
(
PES_»ad”_p
 *
»ad”
);

319 
»ad_Ãxt_PES_·ck‘
(
PES_»ad”_p
 
»ad”
);

331 
ÿlc_m³g1_³s_off£t
(
by‹
 *
d©a
, 
d©a_Ën
);

342 
»ad_Ãxt_PES_ES_·ck‘
(
PES_»ad”_p
 
»ad”
);

353 
fšd_PTS_š_PES
(
by‹
 
d©a
[],

354 
št32_t
 
d©a_Ën
,

355 *
gÙ_±s
,

356 
ušt64_t
 *
±s
);

367 
fšd_DTS_š_PES
(
by‹
 
d©a
[],

368 
št32_t
 
d©a_Ën
,

369 *
gÙ_dts
,

370 
ušt64_t
 *
dts
);

383 
fšd_PTS_DTS_š_PES
(
by‹
 
d©a
[],

384 
št32_t
 
d©a_Ën
,

385 *
gÙ_±s
,

386 
ušt64_t
 *
±s
,

387 *
gÙ_dts
,

388 
ušt64_t
 *
dts
);

399 
fšd_ESCR_š_PES
(
by‹
 
d©a
[],

400 
št32_t
 
d©a_Ën
,

401 *
gÙ_esü
,

402 
ušt64_t
 *
esü
);

413 
decode_±s_dts
(
by‹
 
d©a
[],

414 
»quœed_gu¬d
,

415 
ušt64_t
 *
v®ue
);

424 
’code_±s_dts
(
by‹
 
d©a
[],

425 
gu¬d_b™s
,

426 
ušt64_t
 
v®ue
);

434 
PES_·ck‘_has_PTS
(
PES_·ck‘_d©a_p
 
·ck‘
);

445 
»pÜt_PES_d©a_¬¿y
(*
´efix
,

446 
by‹
 *
d©a
,

447 
d©a_Ën
,

448 
show_d©a
);

465 
»pÜt_PES_d©a_¬¿y2
(
¡»am_ty³
,

466 
by‹
 *
·ylßd
,

467 
·ylßd_Ën
,

468 
show_d©a_Ën
);

493 
£t_£rv”_ouut
(
PES_»ad”_p
 
»ad”
,

494 
TS_wr™”_p
 
tswr™”
,

495 
wr™e_PES
,

496 
´og¿m_äeq
);

507 
¡¬t_£rv”_ouut
(
PES_»ad”_p
 
»ad”
);

518 
¡İ_£rv”_ouut
(
PES_»ad”_p
 
»ad”
);

534 
£t_£rv”_·ddšg
(
PES_»ad”_p
 
»ad”
,

535 
exŒa
);

543 
wr™e_´og¿m_d©a
(
PES_»ad”_p
 
»ad”
,

544 
TS_wr™”_p
 
ouut
);

	@pidint.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

33 
	~"com·t.h
"

34 
	~"pidšt_âs.h
"

35 
	~"misc_âs.h
"

36 
	~"´štšg_âs.h
"

37 
	~"ts_âs.h
"

38 
	~"h222_deâs.h
"

46 
	$š™_pidšt_li¡
(
pidšt_li¡_p
 
li¡
)

48 
li¡
->
Ëngth
 = 0;

49 
li¡
->
size
 = 
PIDINT_LIST_START_SIZE
;

50 
li¡
->
numb”
 = 
	`m®loc
(()*
PIDINT_LIST_START_SIZE
);

51 ià(
li¡
->
numb”
 =ğ
NULL
)

53 
	`´št_”r
("### Unableo‡llocate‡rray in…rogram†ist datastructure\n");

56 
li¡
->
pid
 = 
	`m®loc
((
ušt32_t
)*
PIDINT_LIST_START_SIZE
);

57 ià(
li¡
->
pid
 =ğ
NULL
)

59 
	`ä“
(
li¡
->
numb”
);

60 
	`´št_”r
("### Unableo‡llocate‡rray in…rogram†ist datastructure\n");

65 
	}
}

72 
	$bud_pidšt_li¡
(
pidšt_li¡_p
 *
li¡
)

74 
pidšt_li¡_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_PIDINT_LIST
);

75 ià(
Ãw
 =ğ
NULL
)

77 
	`´št_”r
("### Unableo‡llocate…id/int†ist datastructure\n");

81 ià(
	`š™_pidšt_li¡
(
Ãw
))

84 *
li¡
 = 
Ãw
;

86 
	}
}

93 
	$­³nd_to_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

94 
ušt32_t
 
pid
,

95 
´og¿m
)

97 ià(
li¡
 =ğ
NULL
)

99 
	`´št_”r
("### Unableo‡ppendo NULL…id/int†ist\n");

103 ià(
li¡
->
Ëngth
 =ğli¡->
size
)

105 
Ãwsize
 = 
li¡
->
size
 + 
PIDINT_LIST_INCREMENT
;

106 
li¡
->
numb”
 = 
	`»®loc
Öi¡->numb”,
Ãwsize
*());

107 ià(
li¡
->
numb”
 =ğ
NULL
)

109 
	`´št_”r
("### Unableoƒxtend…id/int†ist‡rray\n");

112 
li¡
->
pid
 = 
	`»®loc
Öi¡->pid,
Ãwsize
*(
ušt32_t
));

113 ià(
li¡
->
pid
 =ğ
NULL
)

115 
	`´št_”r
("### Unableoƒxtend…id/int†ist‡rray\n");

118 
li¡
->
size
 = 
Ãwsize
;

120 
li¡
->
numb”
[li¡->
Ëngth
] = 
´og¿m
;

121 
li¡
->
pid
[li¡->
Ëngth
] =…id;

122 
li¡
->
Ëngth
++;

124 
	}
}

131 
	$»move_äom_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

132 
ušt32_t
 
pid
)

134 
šdex
;

135 
ii
;

136 ià(
li¡
 =ğ
NULL
)

138 
	`´št_”r
("### Unableo„emoveƒntry from NULL…id/int†ist\n");

142 
šdex
 = 
	`pid_šdex_š_pidšt_li¡
(
li¡
,
pid
);

143 ià(
šdex
 == -1)

145 
	`åršt_”r
("### Cannot„emove PID %04x from…id/int†ist"

146 " - iˆi nÙh”e\n",
pid
);

150 
ii
 = 
šdex
; i˜< (
li¡
->
Ëngth
 - 1); ii++)

152 
li¡
->
pid
[
ii
] =†ist->pid[ii+1];

153 
li¡
->
numb”
[
ii
] =†ist->number[ii+1];

155 (
li¡
->
Ëngth
) --;

157 
	}
}

166 
	$ä“_pidšt_li¡
(
pidšt_li¡_p
 *
li¡
)

168 ià(*
li¡
 =ğ
NULL
)

170 ià((*
li¡
)->
numb”
 !ğ
NULL
)

172 
	`ä“
((*
li¡
)->
numb”
);

173 (*
li¡
)->
numb”
 = 
NULL
;

175 ià((*
li¡
)->
pid
 !ğ
NULL
)

177 
	`ä“
((*
li¡
)->
pid
);

178 (*
li¡
)->
pid
 = 
NULL
;

180 (*
li¡
)->
Ëngth
 = 0;

181 (*
li¡
)->
size
 = 0;

182 
	`ä“
(*
li¡
);

183 *
li¡
 = 
NULL
;

184 
	}
}

189 
	$»pÜt_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

190 *
li¡_Çme
,

191 *
št_Çme
,

192 
pid_fœ¡
)

194 ià(
li¡
 =ğ
NULL
)

195 
	`åršt_msg
("% i NULL\n",
li¡_Çme
);

196 ià(
li¡
->
Ëngth
 == 0)

197 
	`åršt_msg
("% i em±y\n",
li¡_Çme
);

200 
ii
;

201 
	`åršt_msg
("%s:\n",
li¡_Çme
);

202 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

204 ià(
pid_fœ¡
)

205 
	`åršt_msg
(" PID %04x (%d) -> %s %d\n",

206 
li¡
->
pid
[
ii
],li¡->pid[ii],
št_Çme
,li¡->
numb”
[ii]);

208 
	`åršt_msg
(" %s %d -> PID %04x (%d)\n",

209 
št_Çme
,
li¡
->
numb”
[
ii
],li¡->
pid
[ii],list->pid[ii]);

212 
	}
}

223 
	$pid_šdex_š_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

224 
ušt32_t
 
pid
)

226 
ii
;

227 ià(
li¡
 =ğ
NULL
)

229 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

231 ià(
li¡
->
pid
[
ii
] ==…id)

232  
ii
;

235 
	}
}

242 
	$pid_št_š_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

243 
ušt32_t
 
pid
,

244 *
numb”
)

246 
ii
;

247 ià(
li¡
 =ğ
NULL
)

249 
ii
 = 0; i˜< 
li¡
->
Ëngth
; ii++)

251 ià(
li¡
->
pid
[
ii
] ==…id)

253 *
numb”
 = 
li¡
->numb”[
ii
];

258 
	}
}

269 
	$pid_š_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

270 
ušt32_t
 
pid
)

272  
	`pid_šdex_š_pidšt_li¡
(
li¡
,
pid
) != -1;

273 
	}
}

286 
	$§me_pidšt_li¡
(
pidšt_li¡_p
 
li¡1
,

287 
pidšt_li¡_p
 
li¡2
)

289 
ii
;

290 ià(
li¡1
 =ğ
li¡2
)

291  
TRUE
;

292 ià(
li¡1
 =ğ
NULL
 || 
li¡2
 == NULL)

293  
FALSE
;

294 ià(
li¡1
->
Ëngth
 !ğ
li¡2
->length)

295  
FALSE
;

296 
ii
 = 0; i˜< 
li¡1
->
Ëngth
; ii++)

298 
ušt32_t
 
pid
 = 
li¡1
->pid[
ii
];

299 
idx
 = 
	`pid_šdex_š_pidšt_li¡
(
li¡2
,
pid
);

300 ià(
idx
 == -1)

301  
FALSE
;

302 ià(
li¡1
->
numb”
[
ii
] !ğ
li¡2
->numb”[
idx
])

303  
FALSE
;

305  
TRUE
;

306 
	}
}

314 
	$»pÜt_¡»am_li¡
(
pidšt_li¡_p
 
li¡
,

315 *
´efix
)

317 ià(
´efix
!=
NULL
è
	`´št_msg
(prefix);

318 ià(
li¡
 =ğ
NULL
)

319 
	`´št_msg
("Program stream†ist is NULL\n");

320 ià(
li¡
->
Ëngth
 == 0)

321 
	`´št_msg
("Program stream†ist isƒmpty\n");

324 
ii
;

325 
	`´št_msg
("Program streams:\n");

326 
ii
=0; ii<
li¡
->
Ëngth
; ii++)

328 ià(
´efix
!=
NULL
è
	`´št_msg
(prefix);

329 
	`åršt_msg
(" PID %04x (%d) -> Streamype %3d (%s)\n",

330 
li¡
->
pid
[
ii
],li¡->pid[ii],li¡->
numb”
[ii],

331 
	`h222_¡»am_ty³_¡r
(
li¡
->
numb”
[
ii
]));

334 
	}
}

342 
	$š™_pmt_¡»ams
(
pmt_p
 
pmt
)

344 
pmt
->
num_¡»ams
 = 0;

345 
pmt
->
¡»ams_size
 = 
PMT_STREAMS_START_SIZE
;

346 
pmt
->
¡»ams
 = 
	`m®loc
(
SIZEOF_PMT_STREAM
*
PMT_STREAMS_START_SIZE
);

347 ià(
pmt
->
¡»ams
 =ğ
NULL
)

349 
	`´št_”r
("### Unableo‡llocate streams in PMT datastructure\n");

354 
	}
}

369 
pmt_p
 
	$bud_pmt
(
ušt16_t
 
´og¿m_numb”
, 
by‹
 
v”siÚ_numb”
,

370 
ušt32_t
 
PCR_pid
)

372 
pmt_p
 
Ãw
;

374 ià(
v”siÚ_numb”
 > 31)

375 
v”siÚ_numb”
 = version_number % 32;

377 ià(
PCR_pid
 == 0)

378 
PCR_pid
 = 0x1FFF;

380 ià(
PCR_pid
 != 0x1FFF && (PCR_pid < 0x0010 || PCR_pid > 0x1ffe))

382 
	`åršt_”r
("### Error building PMT datastructure\n"

384 
PCR_pid
);

385  
NULL
;

388 
Ãw
 = 
	`m®loc
(
SIZEOF_PMT
);

389 ià(
Ãw
 =ğ
NULL
)

391 
	`´št_”r
("### Unableo‡llocate PMT datastructure\n");

392  
NULL
;

395 
Ãw
->
´og¿m_numb”
 =…rogram_number;

396 
Ãw
->
v”siÚ_numb”
 = version_number;

397 
Ãw
->
PCR_pid
 = PCR_pid;

398 
Ãw
->
´og¿m_šfo_Ëngth
 = 0;

399 
Ãw
->
´og¿m_šfo
 = 
NULL
;

401 ià(
	`š™_pmt_¡»ams
(
Ãw
))

403 
	`ä“
(
Ãw
);

404  
NULL
;

407  
Ãw
;

408 
	}
}

420 
	$£t_pmt_´og¿m_šfo
(
pmt_p
 
pmt
,

421 
ušt16_t
 
´og¿m_šfo_Ëngth
,

422 
by‹
 *
´og¿m_šfo
)

424 ià(
´og¿m_šfo_Ëngth
 > 
PMT_MAX_INFO_LENGTH
)

426 
	`åršt_”r
("### Program info†ength %d is morehan %d\n",

427 
´og¿m_šfo_Ëngth
,
PMT_MAX_INFO_LENGTH
);

430 ià(
pmt
->
´og¿m_šfo
 =ğ
NULL
)

432 
pmt
->
´og¿m_šfo
 = 
	`m®loc
(
´og¿m_šfo_Ëngth
);

433 ià(
pmt
->
´og¿m_šfo
 =ğ
NULL
)

435 
	`´št_”r
("### Unableo‡llocate…rogram info in PMT datastructure\n");

439 ià(
´og¿m_šfo_Ëngth
 !ğ
pmt
->program_info_length)

442 
pmt
->
´og¿m_šfo
 = 
	`»®loc
Õmt->´og¿m_šfo,
´og¿m_šfo_Ëngth
);

443 ià(
pmt
->
´og¿m_šfo
 =ğ
NULL
)

445 
	`´št_”r
("### Unableoƒxtend…rogram info in PMT datastructure\n");

449 
	`memıy
(
pmt
->
´og¿m_šfo
,´og¿m_šfo,
´og¿m_šfo_Ëngth
);

450 
pmt
->
´og¿m_šfo_Ëngth
 =…rogram_info_length;

452 
	}
}

461 
	$add_¡»am_to_pmt
(
pmt_p
 
pmt
,

462 
ušt32_t
 
–em’ry_PID
,

463 
by‹
 
¡»am_ty³
,

464 
ušt16_t
 
ES_šfo_Ëngth
,

465 
by‹
 *
ES_šfo
)

467 ià(
pmt
 =ğ
NULL
)

469 
	`´št_”r
("### Unableo‡ppendo NULL PMT datastructure\n");

473 ià(
–em’ry_PID
 < 0x0010 ||ƒlementary_PID > 0x1ffe)

475 
	`åršt_”r
("### Error‡dding streamo PMT\n"

477 
–em’ry_PID
);

481 ià(
ES_šfo_Ëngth
 > 
PMT_MAX_INFO_LENGTH
)

483 
	`åršt_”r
("### ES info†ength %d is morehan %d\n",

484 
ES_šfo_Ëngth
,
PMT_MAX_INFO_LENGTH
);

488 ià(
pmt
->
num_¡»ams
 =ğpmt->
¡»ams_size
)

490 
Ãwsize
 = 
pmt
->
¡»ams_size
 + 
PMT_STREAMS_INCREMENT
;

491 
pmt
->
¡»ams
 = 
	`»®loc
Õmt->¡»ams,
Ãwsize
*
SIZEOF_PMT_STREAM
);

492 ià(
pmt
->
¡»ams
 =ğ
NULL
)

494 
	`´št_”r
("### Unableoƒxtend PMT streams‡rray\n");

497 
pmt
->
¡»ams_size
 = 
Ãwsize
;

499 
pmt
->
¡»ams
[pmt->
num_¡»ams
].
¡»am_ty³
 = stream_type;

500 
pmt
->
¡»ams
[pmt->
num_¡»ams
].
–em’ry_PID
 =ƒlementary_PID;

501 
pmt
->
¡»ams
[pmt->
num_¡»ams
].
ES_šfo_Ëngth
 = ES_info_length;

502 ià(
ES_šfo_Ëngth
 > 0)

504 
pmt
->
¡»ams
[pmt->
num_¡»ams
].
ES_šfo
 = 
	`m®loc
(
ES_šfo_Ëngth
);

505 ià(
pmt
->
¡»ams
[pmt->
num_¡»ams
].
ES_šfo
 =ğ
NULL
)

507 
	`´št_”r
("### Unableo‡llocate PMT stream ES info\n");

510 
	`memıy
(
pmt
->
¡»ams
[pmt->
num_¡»ams
].
ES_šfo
,ES_šfo,
ES_šfo_Ëngth
);

513 
pmt
->
¡»ams
[pmt->
num_¡»ams
].
ES_šfo
 = 
NULL
;

514 
pmt
->
num_¡»ams
++;

516 
	}
}

521 
	$ä“_pmt_¡»am
(
pmt_¡»am_p
 
¡»am
)

523 ià(
¡»am
 =ğ
NULL
) ;

524 ià(
¡»am
->
ES_šfo
 !ğ
NULL
)

526 
	`ä“
(
¡»am
->
ES_šfo
);

527 
¡»am
->
ES_šfo
 = 
NULL
;

529 
	}
}

536 
	$»move_¡»am_äom_pmt
(
pmt_p
 
pmt
,

537 
ušt32_t
 
pid
)

539 
šdex
;

540 
ii
;

541 ià(
pmt
 =ğ
NULL
)

543 
	`´št_”r
("### Unableo„emoveƒntry from NULL PMT datastructure\n");

547 
šdex
 = 
	`pid_šdex_š_pmt
(
pmt
,
pid
);

548 ià(
šdex
 == -1)

550 
	`åršt_”r
("### Cannot„emove PID %04x from PMT datastructure"

551 " - iˆi nÙh”e\n",
pid
);

555 
	`ä“_pmt_¡»am
(&
pmt
->
¡»ams
[
šdex
]);

557 
ii
 = 
šdex
; i˜< (
pmt
->
num_¡»ams
 - 1); ii++)

558 
pmt
->
¡»ams
[
ii
] =…mt->streams[ii+1];

559 (
pmt
->
num_¡»ams
) --;

561 
	}
}

570 
	$ä“_pmt
(
pmt_p
 *
pmt
)

572 ià(*
pmt
 =ğ
NULL
)

574 ià((*
pmt
)->
num_¡»ams
 > 0)

576 
ii
;

577 
ii
 = 0; i˜< (*
pmt
)->
num_¡»ams
; ii++)

578 
	`ä“_pmt_¡»am
(&(*
pmt
)->
¡»ams
[
ii
]);

579 (*
pmt
)->
num_¡»ams
 = 0;

581 ià((*
pmt
)->
´og¿m_šfo
 !ğ
NULL
)

583 
	`ä“
((*
pmt
)->
´og¿m_šfo
);

584 (*
pmt
)->
´og¿m_šfo
 = 
NULL
;

586 
	`ä“
((*
pmt
)->
¡»ams
);

587 (*
pmt
)->
´og¿m_šfo_Ëngth
 = 0;

588 
	`ä“
(*
pmt
);

589 *
pmt
 = 
NULL
;

590 
	}
}

599 
	$pid_šdex_š_pmt
(
pmt_p
 
pmt
,

600 
ušt32_t
 
pid
)

602 
ii
;

603 ià(
pmt
 =ğ
NULL
)

605 
ii
 = 0; i˜< 
pmt
->
num_¡»ams
; ii++)

607 ià(
pmt
->
¡»ams
[
ii
].
–em’ry_PID
 =ğ
pid
)

608  
ii
;

611 
	}
}

619 
pmt_¡»am_p
 
	$pid_¡»am_š_pmt
(
pmt_p
 
pmt
,

620 
ušt32_t
 
pid
)

622 
ii
;

623 ià(
pmt
 =ğ
NULL
)

624  
NULL
;

625 
ii
 = 0; i˜< 
pmt
->
num_¡»ams
; ii++)

627 ià(
pmt
->
¡»ams
[
ii
].
–em’ry_PID
 =ğ
pid
)

628  &
pmt
->
¡»ams
[
ii
];

630  
NULL
;

631 
	}
}

640 
	$pid_š_pmt
(
pmt_p
 
pmt
,

641 
ušt32_t
 
pid
)

643  
	`pid_šdex_š_pmt
(
pmt
,
pid
) != -1;

644 
	}
}

651 
	$§me_pmt_¡»am
(
pmt_¡»am_p
 
¡r1
,

652 
pmt_¡»am_p
 
¡r2
)

654 ià(
¡r1
 =ğ
¡r2
)

655  
TRUE
;

656 ià(
¡r1
 =ğ
NULL
 || 
¡r2
 == NULL)

657  
FALSE
;

658 ià(
¡r1
->
–em’ry_PID
 !ğ
¡r2
->elementary_PID)

659  
FALSE
;

660 ià(
¡r1
->
ES_šfo_Ëngth
 !ğ
¡r2
->ES_info_length)

661  
FALSE
;

662 ià(
	`memcmp
(
¡r1
->
ES_šfo
,
¡r2
->ES_šfo,¡r1->
ES_šfo_Ëngth
))

663  
FALSE
;

665  
TRUE
;

666 
	}
}

682 
	$§me_pmt
(
pmt_p
 
pmt1
,

683 
pmt_p
 
pmt2
)

685 
ii
;

686 ià(
pmt1
 =ğ
pmt2
)

687  
TRUE
;

688 ià(
pmt1
 =ğ
NULL
 || 
pmt2
 == NULL)

689  
FALSE
;

690 ià(
pmt1
->
PCR_pid
 !ğ
pmt2
->PCR_pid)

691  
FALSE
;

692 ià(
pmt1
->
v”siÚ_numb”
 !ğ
pmt2
->version_number)

693  
FALSE
;

694 ià(
pmt1
->
´og¿m_šfo_Ëngth
 !ğ
pmt2
->program_info_length)

695  
FALSE
;

696 ià(
pmt1
->
num_¡»ams
 !ğ
pmt2
->num_streams)

697  
FALSE
;

698 ià(
	`memcmp
(
pmt1
->
´og¿m_šfo
,
pmt2
->program_info,

699 
pmt1
->
´og¿m_šfo_Ëngth
))

700  
FALSE
;

702 
ii
 = 0; i˜< 
pmt1
->
num_¡»ams
; ii++)

704 
ušt32_t
 
pid
 = 
pmt1
->
¡»ams
[
ii
].
–em’ry_PID
;

705 
idx
 = 
	`pid_šdex_š_pmt
(
pmt2
,
pid
);

706 ià(
idx
 == -1)

707  
FALSE
;

708 ià(!
	`§me_pmt_¡»am
(&
pmt1
->
¡»ams
[
ii
],&
pmt2
->¡»ams[
idx
]))

709  
FALSE
;

711  
TRUE
;

712 
	}
}

721 
	$»pÜt_pmt
(
is_msg
,

722 *
´efix
,

723 
pmt_p
 
pmt
)

725 ià(
´efix
!=
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,prefix);

726 ià(
pmt
 =ğ
NULL
)

728 
	`åršt_msg_Ü_”r
(
is_msg
,"PMT is NULL\n");

732 
	`åršt_msg_Ü_”r
(
is_msg
,"Program %d, version %d, PCR PID %04x (%d)\n",

733 
pmt
->
´og¿m_numb”
,pmt->
v”siÚ_numb”
,pmt->
PCR_pid
,pmt->PCR_pid);

735 ià(
pmt
->
´og¿m_šfo_Ëngth
 > 0)

737 ià(
´efix
!=
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,prefix);

738 
	`´št_d©a
(
is_msg
," Prog¿m info",
pmt
->
´og¿m_šfo
,

739 
pmt
->
´og¿m_šfo_Ëngth
,pmt->program_info_length);

740 
	`´št_desütÜs
(
is_msg
,
´efix
," ",
pmt
->
´og¿m_šfo
,

741 
pmt
->
´og¿m_šfo_Ëngth
);

743 ià(
pmt
->
num_¡»ams
 > 0)

745 
ii
;

746 ià(
´efix
!=
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,prefix);

747 
	`åršt_msg_Ü_”r
(
is_msg
,"Program streams:\n");

748 
ii
=0; ii<
pmt
->
num_¡»ams
; ii++)

750 ià(
´efix
!=
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,prefix);

751 
	`åršt_msg_Ü_”r
(
is_msg
," PID %04x (%4d) -> Streamype %02x (%3d) %s\n",

752 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
,

753 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
,

754 
pmt
->
¡»ams
[
ii
].
¡»am_ty³
,

755 
pmt
->
¡»ams
[
ii
].
¡»am_ty³
,

756 
	`h222_¡»am_ty³_¡r
(
pmt
->
¡»ams
[
ii
].
¡»am_ty³
));

757 ià(
pmt
->
¡»ams
[
ii
].
ES_šfo_Ëngth
 > 0)

759 ià(
´efix
!=
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,prefix);

760 
	`´št_d©a
(
is_msg
," ES info",

761 
pmt
->
¡»ams
[
ii
].
ES_šfo
,

762 
pmt
->
¡»ams
[
ii
].
ES_šfo_Ëngth
,

763 
pmt
->
¡»ams
[
ii
].
ES_šfo_Ëngth
);

764 
	`´št_desütÜs
(
is_msg
,
´efix
," ",

765 
pmt
->
¡»ams
[
ii
].
ES_šfo
,

766 
pmt
->
¡»ams
[
ii
].
ES_šfo_Ëngth
);

770 
	}
}

	@pidint_defns.h

35 #iâdeà
_pidšt_deâs


36 
	#_pidšt_deâs


	)

38 
	~"com·t.h
"

42 
	spidšt_li¡


44 *
	mnumb”
;

45 
ušt32_t
 *
	mpid
;

46 
	mËngth
;

47 
	msize
;

49 
pidšt_li¡
 *
	tpidšt_li¡_p
;

50 
	#SIZEOF_PIDINT_LIST
 (
pidšt_li¡
)

	)

52 
	#PIDINT_LIST_START_SIZE
 5

	)

53 
	#PIDINT_LIST_INCREMENT
 10

	)

58 
	s_pmt_¡»am


60 
by‹
 
	m¡»am_ty³
;

61 
ušt32_t
 
	m–em’ry_PID
;

62 
ušt16_t
 
	mES_šfo_Ëngth
;

63 
by‹
 *
	mES_šfo
;

65 
_pmt_¡»am
 *
	tpmt_¡»am_p
;

66 
	#SIZEOF_PMT_STREAM
 (
_pmt_¡»am
)

	)

68 
	s_pmt


70 
ušt16_t
 
	m´og¿m_numb”
;

71 
by‹
 
	mv”siÚ_numb”
;

72 
ušt32_t
 
	mPCR_pid
;

73 
ušt16_t
 
	m´og¿m_šfo_Ëngth
;

74 
by‹
 *
	m´og¿m_šfo
;

75 
	m¡»ams_size
;

76 
	mnum_¡»ams
;

77 
pmt_¡»am_p
 
	m¡»ams
;

79 
_pmt
 *
	tpmt_p
;

80 
	#SIZEOF_PMT
 (
_pmt
)

	)

82 
	#PMT_STREAMS_START_SIZE
 5

	)

83 
	#PMT_STREAMS_INCREMENT
 10

	)

85 
	#PMT_MAX_INFO_LENGTH
 0x3FF

86 

	)

	@pidint_fns.h

29 #iâdeà
_pidšt_âs


30 
	#_pidšt_âs


	)

32 
	~"pidšt_deâs.h
"

40 
š™_pidšt_li¡
(
pidšt_li¡_p
 
li¡
);

46 
bud_pidšt_li¡
(
pidšt_li¡_p
 *
li¡
);

52 
­³nd_to_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

53 
ušt32_t
 
pid
,

54 
´og¿m
);

60 
»move_äom_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

61 
ušt32_t
 
pid
);

69 
ä“_pidšt_li¡
(
pidšt_li¡_p
 *
li¡
);

73 
»pÜt_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

74 *
li¡_Çme
,

75 *
št_Çme
,

76 
pid_fœ¡
);

82 
pid_št_š_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

83 
ušt32_t
 
pid
,

84 *
numb”
);

94 
pid_šdex_š_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

95 
ušt32_t
 
pid
);

105 
pid_š_pidšt_li¡
(
pidšt_li¡_p
 
li¡
,

106 
ušt32_t
 
pid
);

118 
§me_pidšt_li¡
(
pidšt_li¡_p
 
li¡1
,

119 
pidšt_li¡_p
 
li¡2
);

126 
»pÜt_¡»am_li¡
(
pidšt_li¡_p
 
li¡
,

127 *
´efix
);

146 
pmt_p
 
bud_pmt
(
ušt16_t
 
´og¿m_numb”
, 
by‹
 
v”siÚ_numb”
,

147 
ušt32_t
 
PCR_pid
);

158 
£t_pmt_´og¿m_šfo
(
pmt_p
 
pmt
,

159 
ušt16_t
 
´og¿m_šfo_Ëngth
,

160 
by‹
 *
´og¿m_šfo
);

168 
add_¡»am_to_pmt
(
pmt_p
 
pmt
,

169 
ušt32_t
 
–em’ry_PID
,

170 
by‹
 
¡»am_ty³
,

171 
ušt16_t
 
ES_šfo_Ëngth
,

172 
by‹
 *
ES_šfo
);

178 
»move_¡»am_äom_pmt
(
pmt_p
 
pmt
,

179 
ušt32_t
 
pid
);

187 
ä“_pmt
(
pmt_p
 *
pmt
);

195 
pid_šdex_š_pmt
(
pmt_p
 
pmt
,

196 
ušt32_t
 
pid
);

203 
pmt_¡»am_p
 
pid_¡»am_š_pmt
(
pmt_p
 
pmt
,

204 
ušt32_t
 
pid
);

212 
pid_š_pmt
(
pmt_p
 
pmt
,

213 
ušt32_t
 
pid
);

227 
§me_pmt
(
pmt_p
 
pmt1
,

228 
pmt_p
 
pmt2
);

236 
»pÜt_pmt
(
is_msg
,

237 *
´efix
,

238 
pmt_p
 
pmt
);

	@printing.c

30 
	~<¡dio.h
>

31 
	~<¡d¬g.h
>

33 
	~"com·t.h
"

34 
	~"´štšg_âs.h
"

36 
	#DEBUG
 0

	)

42 
	$´št_mes§ge_to_¡dout
(cÚ¡ *
mes§ge
)

44 #ià
DEBUG


45 
	`åuts
("1>>",
¡dout
);

47 (è
	`åuts
(
mes§ge
,
¡dout
);

48 
	}
}

49 
	$´št_mes§ge_to_¡d”r
(cÚ¡ *
mes§ge
)

51 #ià
DEBUG


52 
	`åuts
("2>>",
¡d”r
);

54 (è
	`åuts
(
mes§ge
,
¡d”r
);

55 
	}
}

56 
	$åršt_mes§ge_to_¡dout
(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
)

58 #ià
DEBUG


59 
	`åuts
("3>>",
¡dout
);

61 (è
	`vårštf
(
¡dout
, 
fÜm©
, 
¬g_±r
);

62 
	}
}

63 
	$åršt_mes§ge_to_¡d”r
(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
)

65 #ià
DEBUG


66 
	`åuts
("4>>",
¡d”r
);

68 (è
	`vårštf
(
¡d”r
, 
fÜm©
, 
¬g_±r
);

69 
	}
}

70 
	$æush_¡dout
()

72 (è
	`fæush
(
¡dout
);

73 
	}
}

79 
	s´št_âs


81 (*
	m´št_mes§ge_â
è(cÚ¡ *
	mmes§ge
);

82 (*
	m´št_”rÜ_â
è(cÚ¡ *
	mmes§ge
);

84 (*
	måršt_mes§ge_â
è(cÚ¡ *
	mfÜm©
, 
va_li¡
 
	m¬g_±r
);

85 (*
	måršt_”rÜ_â
è(cÚ¡ *
	mfÜm©
, 
va_li¡
 
	m¬g_±r
);

87 (*
	mæush_mes§ge_â
) ();

90 
´št_âs
 
	gâs
 = { 
´št_mes§ge_to_¡dout
,

91 
´št_mes§ge_to_¡dout
,

92 
åršt_mes§ge_to_¡dout
,

93 
åršt_mes§ge_to_¡dout
,

94 
æush_¡dout
 };

96 #ià
DEBUG


97 
	$»pÜt_âs
(cÚ¡ *
why
)

99 
	`´štf
("Prštšg boundØ(%sèm:%p,ƒ:%p, fm:%p, fe:%p\n",
why
,

100 
âs
.
´št_mes§ge_â
,

101 
âs
.
´št_”rÜ_â
,

102 
âs
.
åršt_mes§ge_â
,

103 
âs
.
åršt_”rÜ_â
);

104 
	}
}

114 
	$´št_msg
(cÚ¡ *
‹xt
)

116 #ià
DEBUG


117 
	`´štf
("m:%°%s",
âs
.
´št_mes§ge_â
,
‹xt
);

118 
	`»pÜt_âs
("m");

120 
âs
.
	`´št_mes§ge_â
(
‹xt
);

121 
	}
}

127 
	$´št_”r
(cÚ¡ *
‹xt
)

129 #ià
DEBUG


130 
	`´štf
("e:%°%s",
âs
.
´št_”rÜ_â
,
‹xt
);

131 
	`»pÜt_âs
("e");

133 
âs
.
	`´št_”rÜ_â
(
‹xt
);

134 
	}
}

140 
	$åršt_msg
(cÚ¡ *
fÜm©
, ...)

142 
va_li¡
 
va_¬g
;

143 
	`va_¡¬t
(
va_¬g
, 
fÜm©
);

144 #ià
DEBUG


145 
	`´štf
("fm:%°%s",
âs
.
åršt_mes§ge_â
,
fÜm©
);

146 
	`»pÜt_âs
("fm");

148 
âs
.
	`åršt_mes§ge_â
(
fÜm©
, 
va_¬g
);

149 
	`va_’d
(
va_¬g
);

150 
	}
}

156 
	$åršt_”r
(cÚ¡ *
fÜm©
, ...)

158 
va_li¡
 
va_¬g
;

159 
	`va_¡¬t
(
va_¬g
, 
fÜm©
);

160 #ià
DEBUG


161 
	`´štf
("ã:%°%s",
âs
.
åršt_”rÜ_â
,
fÜm©
);

162 
	`»pÜt_âs
("fe");

164 
âs
.
	`åršt_”rÜ_â
(
fÜm©
, 
va_¬g
);

165 
	`va_’d
(
va_¬g
);

166 
	}
}

173 
	$åršt_msg_Ü_”r
(
is_msg
, cÚ¡ *
fÜm©
, ...)

175 
va_li¡
 
va_¬g
;

176 
	`va_¡¬t
(
va_¬g
, 
fÜm©
);

177 ià(
is_msg
)

179 #ià
DEBUG


180 
	`´štf
("?m:%°%s",
âs
.
åršt_mes§ge_â
,
fÜm©
);

181 
	`»pÜt_âs
("?m");

183 
âs
.
	`åršt_mes§ge_â
(
fÜm©
, 
va_¬g
);

187 #ià
DEBUG


188 
	`´štf
("?e:%°%s",
âs
.
åršt_”rÜ_â
,
fÜm©
);

189 
	`»pÜt_âs
("?e");

191 
âs
.
	`åršt_”rÜ_â
(
fÜm©
, 
va_¬g
);

193 
	`va_’d
(
va_¬g
);

194 
	}
}

198 
	$æush_msg
()

200 
âs
.
	`æush_mes§ge_â
();

201 
	}
}

212 
	$»dœeù_ouut_¡d”r
()

214 
âs
.
´št_mes§ge_â
 = &
´št_mes§ge_to_¡dout
;

215 
âs
.
´št_”rÜ_â
 = &
´št_mes§ge_to_¡d”r
;

216 
âs
.
åršt_mes§ge_â
 = &
åršt_mes§ge_to_¡dout
;

217 
âs
.
åršt_”rÜ_â
 = &
åršt_mes§ge_to_¡d”r
;

218 
âs
.
æush_mes§ge_â
 = &
æush_¡dout
;

220 #ià
DEBUG


221 
	`»pÜt_âs
("traditional");

223 
	}
}

232 
	$»dœeù_ouut_¡dout
()

234 
âs
.
´št_mes§ge_â
 = &
´št_mes§ge_to_¡dout
;

235 
âs
.
´št_”rÜ_â
 = &
´št_mes§ge_to_¡dout
;

236 
âs
.
åršt_mes§ge_â
 = &
åršt_mes§ge_to_¡dout
;

237 
âs
.
åršt_”rÜ_â
 = &
åršt_mes§ge_to_¡dout
;

238 
âs
.
æush_mes§ge_â
 = &
æush_¡dout
;

240 #ià
DEBUG


241 
	`»pÜt_âs
("stdout");

243 
	}
}

266 
»dœeù_ouut
Ğ(*
Ãw_´št_mes§ge_â
è(cÚ¡ *
mes§ge
),

267 (*
Ãw_´št_”rÜ_â
è(cÚ¡ *
mes§ge
),

268 (*
Ãw_åršt_mes§ge_â
è(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
),

269 (*
Ãw_åršt_”rÜ_â
è(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
),

270 (*
Ãw_æush_msg_â
) ()

273 ià(
Ãw_´št_mes§ge_â
 =ğ
NULL
 || 
Ãw_´št_”rÜ_â
 == NULL ||

274 
Ãw_åršt_mes§ge_â
 =ğ
NULL
 || 
Ãw_åršt_”rÜ_â
 == NULL ||

275 
Ãw_æush_msg_â
 =ğ
NULL
)

278 
âs
.
´št_mes§ge_â
 = 
Ãw_´št_mes§ge_â
;

279 
âs
.
´št_”rÜ_â
 = 
Ãw_´št_”rÜ_â
;

280 
âs
.
åršt_mes§ge_â
 = 
Ãw_åršt_mes§ge_â
;

281 
âs
.
åršt_”rÜ_â
 = 
Ãw_åršt_”rÜ_â
;

282 
âs
.
æush_mes§ge_â
 = 
Ãw_æush_msg_â
;

284 #ià
DEBUG


285 
	`»pÜt_âs
("specific");

289 
	}
}

291 
	$‹¡_C_´štšg
()

293 
	`´št_msg
("C Message\n");

294 
	`´št_”r
("C Error\n");

295 
	`åršt_msg
("C Message %s\n","Fred");

296 
	`åršt_”r
("C Error %s\n","Fred");

297 
	}
}

	@printing_defns.h

30 #iâdeà
_´štšg_deâs


31 
	#_´štšg_deâs


	)

33 
	~<¡dio.h
>

34 
	~<¡d¬g.h
>

	@printing_fns.h

29 #iâdeà
_´štšg_âs


30 
	#_´štšg_âs


	)

32 
	~"´štšg_deâs.h
"

40 
´št_msg
(cÚ¡ *
‹xt
);

44 
´št_”r
(cÚ¡ *
‹xt
);

48 
åršt_msg
(cÚ¡ *
fÜm©
, ...);

52 
åršt_”r
(cÚ¡ *
fÜm©
, ...);

57 
åršt_msg_Ü_”r
(
is_msg
, cÚ¡ *
fÜm©
, ...);

61 
æush_msg
();

71 
»dœeù_ouut_¡d”r
();

78 
»dœeù_ouut_¡dout
();

99 
»dœeù_ouut
Ğ(*
Ãw_´št_mes§ge_â
è(cÚ¡ *
mes§ge
),

100 (*
Ãw_´št_”rÜ_â
è(cÚ¡ *
mes§ge
),

101 (*
Ãw_åršt_mes§ge_â
è(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
),

102 (*
Ãw_åršt_”rÜ_â
è(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
),

103 (*
Ãw_æush_msg_â
) ()

107 
	`‹¡_C_´štšg
();

	@ps.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<fú.h
>

35 #ifdeà
_WIN32


36 
	~<¡ddef.h
>

37 
	~<io.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"ps_âs.h
"

44 
	~"ts_âs.h
"

45 
	~"³s_âs.h
"

46 
	~"pidšt_âs.h
"

47 
	~"misc_âs.h
"

48 
	~"´štšg_âs.h
"

50 
	#DEBUG
 0

	)

51 
	#DEBUG_AC3
 0

	)

54 
	#PACK_HEADER_SEARCH_DISTANCE
 100000

	)

58 
	#RECOVER_BROKEN_PS
 1

	)

68 
	s´og¿m_d©a


71 
ušt32_t
 
	mŒª¥Üt_¡»am_id
;

72 
ušt32_t
 
	m´og¿m_numb”
;

73 
ušt32_t
 
	mpmt_pid
;

74 
ušt32_t
 
	mpü_pid
;

75 
ušt32_t
 
	mvideo_pid
;

76 
ušt32_t
 
	maudio_pid
;

77 
	mvideo_¡»am
;

78 
	maudio_¡»am
;

79 
	mwªt_ac3
;

80 
	maudio_sub¡»am
;

81 
	mvideo_ty³
;

82 
	mis_dvd
;

83 
	mouut_dŞby_as_dvb
;

86 
pidšt_li¡_p
 
	m´og_li¡
;

87 
pmt_p
 
	mpmt
;

101 
šlše
 
	$g‘_mÜe_d©a
(
PS_»ad”_p
 
ps
)

105 #ifdeà
_WIN32


106 
Ën
 = 
	`_»ad
(
ps
->
šput
,&ps->
d©a
,
PS_READ_AHEAD_SIZE
);

108 
ssize_t
 
Ën
 = 
	`»ad
(
ps
->
šput
,&ps->
d©a
,
PS_READ_AHEAD_SIZE
);

110 ià(
Ën
 == 0)

111  
EOF
;

112 ià(
Ën
 == -1)

114 
	`åršt_”r
("### E¼Ü„—dšg‚exˆby‹s: %s\n",
	`¡»¼Ü
(
”ºo
));

117 
ps
->
d©a_po¢
 +ğps->
d©a_Ën
;

118 
ps
->
d©a_Ën
 = 
Ën
;

119 
ps
->
d©a_’d
 =…s->
d©a
 + 
Ën
;

120 
ps
->
d©a_±r
 =…s->
d©a
;

122 
	}
}

134 
	$bud_PS_»ad”
(
šput
,

135 
qu›t
,

136 
PS_»ad”_p
 *
ps
)

138 
”r
;

139 
PS_»ad”_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_PS_READER
);

140 ià(
Ãw
 =ğ
NULL
)

142 
	`´št_”r
("### Unableo‡llocate…rogram stream„ead context\n");

146 
Ãw
->
šput
 = input;

147 
Ãw
->
d©a_po¢
 = 0;

148 
Ãw
->
d©a_Ën
 = 0;

149 
Ãw
->
¡¬t
 = 0;

151 
”r
 = 
	`g‘_mÜe_d©a
(
Ãw
);

152 ià(
”r
)

154 
	`´št_”r
("### Unableo start„eading from‚ew PS„ead context\n");

155 
	`ä“
(
Ãw
);

160 
”r
 = 
	`fšd_PS_·ck_h—d”_¡¬t
(
Ãw
,
FALSE
,
PACK_HEADER_SEARCH_DISTANCE
,

161 &(
Ãw
->
¡¬t
));

162 ià(
”r
)

164 
	`åršt_”r
("### File does‚ot‡ppearo be PS\n"

166 
PACK_HEADER_SEARCH_DISTANCE
);

167 
	`ä“
(
Ãw
);

172 ià(
šput
 !ğ
STDIN_FILENO
)

175 
”r
 = 
	`£ek_usšg_PS_»ad”
(
Ãw
,Ãw->
¡¬t
);

176 ià(
”r
)

178 
	`´št_”r
("### Error seekingo start of first…ack header\n");

179 
	`ä“
(
Ãw
);

184 ià(!
qu›t
 && 
Ãw
->
¡¬t
 != 0)

185 
	`åršt_”r
("!!! PS file does‚ot start with…ack header\n"

186 " Fœ¡ PS…ack h—d” i © " 
OFFSET_T_FORMAT
 "\n",
Ãw
->
¡¬t
);

188 *
ps
 = 
Ãw
;

190 
	}
}

202 
	$ä“_PS_»ad”
(
PS_»ad”_p
 *
ps
)

204 ià(*
ps
 !ğ
NULL
)

206 (*
ps
)->
šput
 = -1;

207 
	`ä“
(*
ps
);

208 *
ps
 = 
NULL
;

210 
	}
}

222 
	$İ’_PS_fe
(*
Çme
,

223 
qu›t
,

224 
PS_»ad”_p
 *
ps
)

226 
f
;

228 ià(
Çme
 =ğ
NULL
)

229 
f
 = 
STDIN_FILENO
;

232 
f
 = 
	`İ’_bš¬y_fe
(
Çme
,
FALSE
);

233 ià(
f
 == -1)  1;

235  
	`bud_PS_»ad”
(
f
,
qu›t
,
ps
);

236 
	}
}

245 
	$şo£_PS_fe
(
PS_»ad”_p
 *
ps
)

247 ià((*
ps
)->
šput
 !ğ
STDIN_FILENO
)

249 
”r
 = 
	`şo£_fe
((*
ps
)->
šput
);

250 ià(
”r
)  1;

252 
	`ä“_PS_»ad”
(
ps
);

254 
	}
}

272 
	$d‘”mše_if_PS_is_h264
(
PS_»ad”_p
 
ps
,

273 *
is_h264
)

275 
”r
;

276 
PES_»ad”_p
 
»ad”
;

284 
”r
 = 
	`bud_PS_PES_»ad”
(
ps
,
FALSE
,FALSE,&
»ad”
);

285 ià(
”r
)

287 
	`´št_”r
("### Errorryingo determine PS streamype\n");

291 *
is_h264
 = 
»ad”
->is_h264;

292 (è
	`ä“_PES_»ad”
(&
»ad”
);

295 
”r
 = 
	`»wšd_´og¿m_¡»am
(
ps
);

296 ià(
”r
)

298 
	`´št_”r
("### Error„ewinding PS file‡fter determining itsype\n");

302 
	}
}

318 
	$d‘”mše_PS_video_ty³
(
PS_»ad”_p
 
ps
,

319 *
video_ty³
)

321 
”r
;

322 
PES_»ad”_p
 
»ad”
;

330 
”r
 = 
	`bud_PS_PES_»ad”
(
ps
,
FALSE
,FALSE,&
»ad”
);

331 ià(
”r
)

333 
	`´št_”r
("### Errorryingo determine PS streamype\n");

337 *
video_ty³
 = 
»ad”
->video_type;

338 (è
	`ä“_PES_»ad”
(&
»ad”
);

341 
”r
 = 
	`»wšd_´og¿m_¡»am
(
ps
);

342 ià(
”r
)

344 
	`´št_”r
("### Error„ewinding PS file‡fter determining itsype\n");

348 
	}
}

362 
	$£ek_usšg_PS_»ad”
(
PS_»ad”_p
 
ps
,

363 
off£t_t
 
po¢
)

365 
”r
 = 
	`£ek_fe
(
ps
->
šput
,
po¢
);

366 ià(
”r
)  1;

368 
ps
->
d©a_po¢
 = 
po¢
;

369 
ps
->
d©a_Ën
 = 0;

371  
	`g‘_mÜe_d©a
(
ps
);

372 
	}
}

379 
	$»wšd_´og¿m_¡»am
(
PS_»ad”_p
 
ps
)

381  
	`£ek_usšg_PS_»ad”
(
ps
,ps->
¡¬t
);

382 
	}
}

396 
	$»ad_PS_by‹s
(
PS_»ad”_p
 
ps
,

397 
num_by‹s
,

398 
by‹
 *
bufãr
,

399 
off£t_t
 *
po¢
)

401 
”r
;

402 
off£t
 = 0;

403 
num_by‹s_wª‹d
 = 
num_by‹s
;

404 
num_by‹s_Ëá
 = 
ps
->
d©a_’d
 -…s->
d©a_±r
;

406 ià(
po¢
 !ğ
NULL
)

407 *
po¢
 = 
ps
->
d©a_po¢
 + (ps->
d©a_±r
 -…s->
d©a
);

411 ià(
num_by‹s_Ëá
 < 
num_by‹s_wª‹d
)

413 
	`memıy
(&(
bufãr
[
off£t
]),
ps
->
d©a_±r
,
num_by‹s_Ëá
);

414 
off£t
 +ğ
num_by‹s_Ëá
;

415 
num_by‹s_wª‹d
 -ğ
num_by‹s_Ëá
;

416 
”r
 = 
	`g‘_mÜe_d©a
(
ps
);

417 ià(
”r
) ƒrr;

418 
num_by‹s_Ëá
 = 
ps
->
d©a_Ën
;

422 
	`memıy
(&(
bufãr
[
off£t
]),
ps
->
d©a_±r
,
num_by‹s_wª‹d
);

423 
ps
->
d©a_±r
 +ğ
num_by‹s_wª‹d
;

428 
	}
}

437 
	$´št_¡»am_id
(
is_msg
,

438 
by‹
 
¡»am_id
)

440 
by‹
 
numb”
;

441 *
¡r
 = 
NULL
;

442 
¡»am_id
)

445 0xB9: 
¡r
 = "PS MPEG_program_end_code"; ;

446 0xBA: 
¡r
 = "PS Pack header start code"; ;

447 0xBB: 
¡r
 = "PS System header start code"; ;

448 0xBC: 
¡r
 = "PS Program stream map"; ;

449 0xFF: 
¡r
 = "PS Program stream directory"; ;

452 0xBD: 
¡r
 = "Private stream 1"; ;

453 0xBE: 
¡r
 = "Padding stream"; ;

454 0xBF: 
¡r
 = "Private stream 2"; ;

455 0xF0: 
¡r
 = "ECM stream"; ;

456 0xF1: 
¡r
 = "EMM stream"; ;

457 0xF2: 
¡r
 = "DSMCC stream"; ;

458 0xF3: 
¡r
 = "13522 stream"; ;

459 0xF4: 
¡r
 = "H.222.1 A stream"; ;

460 0xF5: 
¡r
 = "H.222.1 B stream"; ;

461 0xF6: 
¡r
 = "H.222.1 C stream"; ;

462 0xF7: 
¡r
 = "H.222.1 D stream"; ;

463 0xF8: 
¡r
 = "H.222.1 E stream"; ;

464 0xF9: 
¡r
 = "Ancillary stream"; ;

466 0x00: 
¡r
 = "H.262 Picture"; ;

467 0xB2: 
¡r
 = "H.262 User data"; ;

468 0xB3: 
¡r
 = "H.262 Sequence header"; ;

469 0xB4: 
¡r
 = "H.262 Sequenceƒrror"; ;

470 0xB5: 
¡r
 = "H.262 Extension"; ;

471 0xB7: 
¡r
 = "H.262 Sequenceƒnd"; ;

472 0xB8: 
¡r
 = "H.262 Group start"; ;

474 : 
¡r
 = 
NULL
; ;

477 ià(
¡r
 !ğ
NULL
)

478 
	`åršt_msg_Ü_”r
(
is_msg
,
¡r
);

479 ià(
¡»am_id
 >= 0xC0 && stream_id <=0xDF)

481 
numb”
 = 
¡»am_id
 & 0x1F;

482 
	`åršt_msg_Ü_”r
(
is_msg
,"AudiØ¡»am 0x%02X",
numb”
);

484 ià(
¡»am_id
 >= 0xE0 && stream_id <= 0xEF)

486 
numb”
 = 
¡»am_id
 & 0x0F;

487 
	`åršt_msg_Ü_”r
(
is_msg
,"VideØ¡»am 0x%X",
numb”
);

489 ià(
¡»am_id
 >= 0xFC && stream_id <= 0xFE)

490 
	`åršt_msg_Ü_”r
(
is_msg
,"Reserved data stream");

492 
	`åršt_msg_Ü_”r
(
is_msg
,"Unrecognised stream id");

493 
	}
}

517 
	$fšd_PS_·ck‘_¡¬t
(
PS_»ad”_p
 
ps
,

518 
v”bo£
,

519 
ušt32_t
 
max
,

520 
off£t_t
 *
po¢
,

521 
by‹
 *
¡»am_id
)

523 
”r
;

524 
by‹
 
´ev1
 = 0xff;

525 
by‹
 
´ev2
 = 0xff;

526 
by‹
 
´ev3
 = 0xff;

527 
ušt32_t
 
couÁ
 = 0;

529 *
¡»am_id
 = 0;

532 
by‹
 *
±r
;

533 
±r
 = 
ps
->
d©a_±r
;…Œ <…s->
d©a_’d
;…tr++)

535 ià(
´ev3
 =ğ0x00 && 
´ev2
 =ğ0x00 && 
´ev1
 == 0x01)

537 ià(*
±r
 == 0xB9)

539 ià(
v”bo£
)

540 
	`´št_msg
("Stopping‡t MPEG_program_end_code\n");

541 *
¡»am_id
 = 0xB9;

542  
EOF
;

546 *
¡»am_id
 = *
±r
;

547 *
po¢
 = 
ps
->
d©a_po¢
 + (
±r
 -…s->
d©a
) - 3;

548 
ps
->
d©a_±r
 = 
±r
 + 1;

552 ià(
max
 > 0)

554 
couÁ
 ++;

555 ià(
couÁ
 > 
max
)

557 
	`åršt_”r
("### NØPS…ack‘ s¹ found iÀ%d by‹s\n",
max
);

561 
´ev3
 = 
´ev2
;

562 
´ev2
 = 
´ev1
;

563 
´ev1
 = *
±r
;

566 
”r
 = 
	`g‘_mÜe_d©a
(
ps
);

567 ià(
”r
) ƒrr;

569 
	}
}

594 
	$fšd_PS_·ck_h—d”_¡¬t
(
PS_»ad”_p
 
ps
,

595 
v”bo£
,

596 
ušt32_t
 
max
,

597 
off£t_t
 *
po¢
)

599 
”r
;

600 
by‹
 
¡»am_id
 = 0;

602 
¡»am_id
 != 0xBA)

604 
”r
 = 
	`fšd_PS_·ck‘_¡¬t
(
ps
,
v”bo£
,
max
,
po¢
,&
¡»am_id
);

605 ià(
”r
)

607 
	`´št_”r
("### Error†ooking for PS…ack header (0xBA)\n");

610 ià(
v”bo£
)

612 
	`åršt_”r
(" Found: sŒ—m id %02X‡ˆ" 
OFFSET_T_FORMAT
 " (",

613 
¡»am_id
,*
po¢
);

614 
	`´št_¡»am_id
(
FALSE
,
¡»am_id
);

615 
	`´št_”r
(")\n");

619 
	}
}

638 
	$»ad_PS_·ck‘_body
(
PS_»ad”_p
 
ps
,

639 
by‹
 
¡»am_id
,

640 
PS_·ck‘_p
 
·ck‘
)

642 
”r
;

643 
by‹
 
buf
[2];

646 
”r
 = 
	`»ad_PS_by‹s
(
ps
,2,
buf
,
NULL
);

647 ià(
”r
)

649 
	`åršt_”r
("### %s„eading PS…acket†ength\n",

650 (
”r
==
EOF
?"Unexpectedƒnd of file":"Error"));

651 ià(
·ck‘
->
d©a
!=
NULL
è
	`ä“
(packet->data);

652 
·ck‘
->
d©a
 = 
NULL
;

653  
”r
;

656 
·ck‘
->
·ck‘_Ëngth
 = (
buf
[0] << 8) | buf[1];

658 #ià
DEBUG


659 
	`åršt_msg
("Pack‘†’gth %d\n",
·ck‘
->
·ck‘_Ëngth
);

666 ià(
·ck‘
->
·ck‘_Ëngth
 == 0)

668 
	`´št_”r
("### Packet has†ength 0 -‚ot‡llowed in PS\n");

669 ià(
·ck‘
->
d©a
!=
NULL
è
	`ä“
(packet->data);

670 
·ck‘
->
d©a
 = 
NULL
;

677 
·ck‘
->
d©a
 = 
	`»®loc
Õack‘->d©a,·ck‘->
·ck‘_Ëngth
 + 6 + 10);

679 
·ck‘
->
d©a
 = 
	`»®loc
Õack‘->d©a,·ck‘->
·ck‘_Ëngth
 + 6);

681 ià(
·ck‘
->
d©a
 =ğ
NULL
)

683 
	`´št_”r
("### Unableo‡llocate PS…acket data buffer\n");

686 
·ck‘
->
d©a_Ën
 =…ack‘->
·ck‘_Ëngth
 + 6;

689 
·ck‘
->
d©a
[0] = 0;

690 
·ck‘
->
d©a
[1] = 0;

691 
·ck‘
->
d©a
[2] = 1;

692 
·ck‘
->
d©a
[3] = 
¡»am_id
;

693 
·ck‘
->
d©a
[4] = 
buf
[0];

694 
·ck‘
->
d©a
[5] = 
buf
[1];

697 
”r
 = 
	`»ad_PS_by‹s
(
ps
,
·ck‘
->
·ck‘_Ëngth
,&Õack‘->
d©a
[6]),
NULL
);

698 ià(
”r
)

700 
	`åršt_”r
("### %s„eading„est of PS…acket\n",

701 (
”r
==
EOF
?"Unexpectedƒnd of file":"Error"));

702 ià(
·ck‘
->
d©a
!=
NULL
è
	`ä“
(packet->data);

703 
·ck‘
->
d©a
 = 
NULL
;

704  
”r
;

708 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 0] = 0;

709 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 1] = 0;

710 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 2] = 0;

711 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 3] = 0;

712 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 4] = 0;

713 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 5] = 0;

714 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 6] = 0;

715 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 7] = 0;

716 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 8] = 0;

717 
·ck‘
->
d©a
[·ck‘->
d©a_Ën
 + 9] = 0;

718 
·ck‘
->
·ck‘_Ëngth
 += 10;

719 
·ck‘
->
d©a_Ën
 += 10;

722 
	}
}

734 
	$»ad_PS_·ck_h—d”_body
(
PS_»ad”_p
 
ps
,

735 
PS_·ck_h—d”_p
 
hdr
)

737 
”r
;

738 
by‹
 
dummy
[8];

741 
”r
 = 
	`»ad_PS_by‹s
(
ps
,8,
hdr
->
d©a
,
NULL
);

742 ià(
”r
)

744 
	`åršt_”r
("### %s„eading body of PS…ack header\n",

745 (
”r
==
EOF
?"Unexpectedƒnd of file":"Error"));

746  
”r
;

749 ià((
hdr
->
d©a
[0] & 0xF0) == 0x20)

751 #ià
DEBUG


752 
	`´št_msg
("ISO/IEC 11171-1/MPEG-1…ack header\n");

753 
	`´št_d©a
(
TRUE
,"Pack h—d”",
hdr
->
d©a
,8,8);

755 
hdr
->
·ck_¡uffšg_Ëngth
 = 0;

756 
hdr
->
sü
 =

757 (((
ušt64_t
)(
hdr
->
d©a
[0] & 0x09)) << 29) |

758 (((
ušt64_t
è
hdr
->
d©a
[1] ) << 22) |

759 (((
ušt64_t
)(
hdr
->
d©a
[2] & 0xFE)) << 14) |

760 (((
ušt64_t
è
hdr
->
d©a
[3] ) << 7) |

761 (((
ušt64_t
)(
hdr
->
d©a
[4] & 0xFE)) >> 1);

762 
hdr
->
´og¿m_mux_¿‹
 =

763 (((
ušt32_t
)(
hdr
->
d©a
[5] & 0x7F)) << 15) |

764 (((
ušt32_t
è
hdr
->
d©a
[6] ) << 7) |

765 (((
ušt32_t
)(
hdr
->
d©a
[7] & 0xFE)) >> 1);

774 
hdr
->
sü
 = hdr->scr * 300;

775 
hdr
->
sü_ba£
 = hdr->
sü
 / 300;

776 
hdr
->
sü_exŠ
 = 0;

780 #ià
DEBUG


781 
	`´št_msg
("ISO/IEC 13818-1/H.222.0…ack header\n");

783 
”r
 = 
	`»ad_PS_by‹s
(
ps
,2,&(
hdr
->
d©a
[8]),
NULL
);

784 ià(
”r
)

786 
	`åršt_”r
("### %s„eading†ast 2 bytes of body of PS…ack header\n",

787 (
”r
==
EOF
?"Unexpectedƒnd of file":"Error"));

788  
”r
;

790 #ià
DEBUG


791 
	`´št_d©a
(
TRUE
,"Pack h—d”",
hdr
->
d©a
,10,10);

793 
hdr
->
sü_ba£
 =

794 (((
ušt64_t
)(
hdr
->
d©a
[0] & 0x38)) << 27) |

795 (((
ušt64_t
)(
hdr
->
d©a
[0] & 0x03)) << 28) |

796 (((
ušt64_t
è
hdr
->
d©a
[1] ) << 20) |

797 (((
ušt64_t
)(
hdr
->
d©a
[2] & 0xF8)) << 12) |

798 (((
ušt64_t
)(
hdr
->
d©a
[2] & 0x03)) << 13) |

799 (((
ušt64_t
è
hdr
->
d©a
[3] ) << 5) |

800 (((
ušt64_t
)(
hdr
->
d©a
[4] & 0xF8)) >> 3);

801 
hdr
->
sü_exŠ
 =

802 (((
ušt32_t
)(
hdr
->
d©a
[4] & 0x03)) << 7) |

803 (((
ušt32_t
è
hdr
->
d©a
[5] ) >> 1);

804 
hdr
->
sü
 = hdr->
sü_ba£
 * 300 + hdr->
sü_exŠ
;

805 
hdr
->
´og¿m_mux_¿‹
 =

806 (((
ušt32_t
)
hdr
->
d©a
[6] << 14)) |

807 (((
ušt32_t
)
hdr
->
d©a
[7] << 6)) |

808 (((
ušt32_t
)
hdr
->
d©a
[8] >> 2));

809 
hdr
->
·ck_¡uffšg_Ëngth
 = hdr->
d©a
[9] & 0x07;

812 #ià
DEBUG


813 
	`åršt_msg
("Pack h—d” body: sü_ba£ " 
LLU_FORMAT
 ", scr_extn %u, scr "

814 
LLU_FORMAT
 ", mux„ate %u, stuffing %d\n",

815 
hdr
->
sü_ba£
,hdr->
sü_exŠ
,hdr->
sü
,hdr->
´og¿m_mux_¿‹
,

816 
hdr
->
·ck_¡uffšg_Ëngth
);

820 ià(
hdr
->
·ck_¡uffšg_Ëngth
 > 0)

822 
”r
 = 
	`»ad_PS_by‹s
(
ps
,
hdr
->
·ck_¡uffšg_Ëngth
,
dummy
,
NULL
);

823 ià(
”r
)

825 
	`åršt_”r
("### %s„eading PS…ack header stuffing bytes\n",

826 (
”r
==
EOF
?"Unexpectedƒnd of file":"Error"));

827  
”r
;

831 
	}
}

837 
	$ş—r_PS_·ck‘
(
PS_·ck‘_p
 
·ck‘
)

839 ià(
·ck‘
->
d©a
 !ğ
NULL
)

841 
	`ä“
(
·ck‘
->
d©a
);

842 
·ck‘
->
d©a
 = 
NULL
;

843 
·ck‘
->
d©a_Ën
 = 0;

845 
·ck‘
->
·ck‘_Ëngth
 = 0;

846 
	}
}

855 
	$ä“_PS_·ck‘
(
PS_·ck‘_p
 *
·ck‘
)

857 ià(*
·ck‘
 =ğ
NULL
)

859 
	`ş—r_PS_·ck‘
(*
·ck‘
);

860 
	`ä“
(*
·ck‘
);

861 *
·ck‘
 = 
NULL
;

862 
	}
}

885 
	$»ad_PS_·ck‘_¡¬t
(
PS_»ad”_p
 
ps
,

886 
v”bo£
,

887 
off£t_t
 *
po¢
,

888 
by‹
 *
¡»am_id
)

890 
”r
;

891 
by‹
 
buf
[4];

893 *
¡»am_id
 = 0;

895 
”r
 = 
	`»ad_PS_by‹s
(
ps
,4,
buf
,
po¢
);

896 ià(
”r
 =ğ
EOF
)

897  
EOF
;

898 ià(
”r
)

900 
	`´št_”r
("### Error„eading start of PS…acket\n");

907 ià(
buf
[0] == 0 && buf[1] == 0 && buf[2] == 0)

910 
	`åršt_msg
("// %02x %02x %02x %02x\n",
buf
[0],buf[1],buf[2],buf[3]);

912 
buf
[2] == 0)

914 
buf
[2] = buf[3];

915 
”r
 = 
	`»ad_PS_by‹s
(
ps
,1,&(
buf
[3]),
po¢
);

916 ià(
”r
 =ğ
EOF
)

917  
EOF
;

918 ià(
”r
)

920 
	`´št_”r
("### Error skipping 00 bytes before start of PS…acket\n");

925 
	`åršt_msg
("\\\\ %02x %02x %02x %02x\n",
buf
[0],buf[1],buf[2],buf[3]);

929 ià(
buf
[0] != 0 || buf[1] != 0 || buf[2] != 1)

931 
	`åršt_”r
("!!! PS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 " should start "

933 *
po¢
,
buf
[0],buf[1],buf[2]);

934 #ià
RECOVER_BROKEN_PS


935 
	`´št_”r
("!!! Attemptingo find‚ext PS…ack header\n");

936 
”r
 = 
	`fšd_PS_·ck_h—d”_¡¬t
(
ps
,
TRUE
,0,
po¢
);

937 ià(
”r
 =ğ
EOF
)

938  
EOF
;

939 ià(
”r
)

941 
	`´št_”r
("### Errorryingo find start of‚ext…ack header\n");

944 
	`åršt_”r
("!!! CÚtšušg w™h PS…ack h—d”‡ˆ" 
OFFSET_T_FORMAT


945 "\n",*
po¢
);

946 *
¡»am_id
 = 0xBA;

953 *
¡»am_id
 = 
buf
[3];

955 #ià
DEBUG


956 
	`åršt_msg
("Pack‘‡ˆ" 
OFFSET_T_FORMAT
 ", sŒ—m id %02X (",*
po¢
,*
¡»am_id
);

957 
	`´št_¡»am_id
(
TRUE
,*
¡»am_id
);

958 
	`´št_msg
(")\n");

961 ià(
buf
[3] == 0xB9)

963 ià(
v”bo£
)

964 
	`´št_msg
("Stopping‡t MPEG_program_end_code\n");

965  
EOF
;

969 
	}
}

975 
šlše
 
	$d‘”mše_ac3_d‘as
(
by‹
 *
d©a
, 
v”bo£
,

976 
by‹
 *
bsmod
, by‹ *
acmod
)

979 
fscod
 = (
d©a
[4] & 0xC0) >> 6;

980 
ämsizecode
 = (
d©a
[4] & 0x3F);

982 
bsid
 = (
d©a
[5] & 0xF8) >> 3;

983 *
bsmod
 = (
d©a
[5] & 0x07);

984 *
acmod
 = (
d©a
[6] & 0xC0) >> 6;

985 ià(
v”bo£
)

987 
	`åršt_msg
(" fscod %x (§m¶¿‹ %skHz)\n",
fscod
,

988 (
fscod
==0?"48":fscod==1?"44.1":fscod==2?"32":"??"));

989 
	`åršt_msg
(" frmsizecod%x\n",
ämsizecode
);

990 
	`åršt_msg
(" bsid %x (%s)\n",
bsid
,

991 (
bsid
==8?"standard":bsid==6?"A52a‡lternate":

992 
bsid
<8?"standard subset":"???"));

993 
	`åršt_msg
(" bsmod %x (%s)\n",*
bsmod
,
	`BSMOD_STR
(*bsmod,*
acmod
));

994 
	`åršt_msg
("‡cmod %x (%s)\n",*
acmod
,
	`ACMOD_STR
(*acmod));

996 
	}
}

1013 
	$id’tify_´iv©e1_d©a
(
PS_·ck‘
 *
·ck‘
,

1014 
is_dvd
,

1015 
v”bo£
,

1016 *
sub¡»am_šdex
,

1017 
by‹
 *
bsmod
,

1018 
by‹
 *
acmod
)

1022 
PES_h—d”_d©a_Ëngth
 = 
·ck‘
->
d©a
[6+2];

1023 
wh©
 = 
SUBSTREAM_OTHER
;

1024 
by‹
 *
d©a
;

1027 ià(
v”bo£
)

1029 
d©a_®ignm’t_šdiÿtÜ
 = (
·ck‘
->
d©a
[6] & 0x04);

1030 ià(
d©a_®ignm’t_šdiÿtÜ
)

1031 
	`´št_msg
("*** Data‡ligned\n");

1033 
	`´št_msg
("--- Data‚ot‡ligned\n");

1034 
	`åršt_msg
("*** PES header data†ength 0x%x (%d)\n",

1035 
PES_h—d”_d©a_Ëngth
,PES_header_data_length);

1039 *
sub¡»am_šdex
 = 0;

1040 *
bsmod
 = 0;

1041 *
acmod
 = 0;

1046 
d©a
 = 
·ck‘
->d©¨+ 6 + 3 + 
PES_h—d”_d©a_Ëngth
;

1049 ià(
is_dvd
)

1051 
sub¡»am_id
, 
äame_couÁ
, 
off£t
;

1052 
sub¡»am_id
 = 
d©a
[0];

1053 
äame_couÁ
 = 
d©a
[1];

1054 
off£t
 = (
d©a
[2] << 8) | data[3];

1055 ià(0x20 <ğ
sub¡»am_id
 && substream_id <= 0x3F)

1057 
wh©
 = 
SUBSTREAM_SUBPICTURES
;

1058 *
sub¡»am_šdex
 = 
sub¡»am_id
 - 0x20;

1060 ià(0x80 <ğ
sub¡»am_id
 && substream_id <= 0x87)

1062 
wh©
 = 
SUBSTREAM_AC3
;

1063 *
sub¡»am_šdex
 = 
sub¡»am_id
 - 0x80;

1065 ià(0x88 <ğ
sub¡»am_id
 && substream_id <= 0x8F)

1067 
wh©
 = 
SUBSTREAM_DTS
;

1068 *
sub¡»am_šdex
 = 
sub¡»am_id
 - 0x88;

1070 ià(0xA0 <ğ
sub¡»am_id
 && substream_id <= 0xA7)

1072 
wh©
 = 
SUBSTREAM_LPCM
;

1073 *
sub¡»am_šdex
 = 
sub¡»am_id
 - 0xA0;

1075 ià(
v”bo£
)

1077 
	`åršt_msg
(">>> sub¡»am_id %02x (% šdex %d)\n",
sub¡»am_id
,

1078 (
wh©
==
SUBSTREAM_AC3
?"AC3":

1079 
wh©
==
SUBSTREAM_DTS
?"DTS":

1080 
wh©
==
SUBSTREAM_LPCM
?"LPCM":

1081 
wh©
==
SUBSTREAM_SUBPICTURES
?"subpictures":"???"),

1082 *
sub¡»am_šdex
);

1083 
	`åršt_msg
(">>> f¿me_couÁ %02x (%d)\n",
äame_couÁ
,frame_count);

1084 
	`åršt_msg
(">>> off£ˆ %04x (%d)\n",
off£t
,offset);

1088 ià(
wh©
 =ğ
SUBSTREAM_AC3
 || wh© =ğ
SUBSTREAM_DTS
)

1090 
·ck‘_Ëngth
 = (
·ck‘
->
d©a
[4] << 8) |…acket->data[5];

1091 
by‹
 *
sub_d©a
 = 
d©a
 + 3 + 
off£t
;

1094 ià(
sub_d©a
 >ğ
·ck‘
->
d©a
 + 
·ck‘_Ëngth
)

1097 ià(
v”bo£
)

1098 
	`åršt_msg
("***ƒxpected %s, but data‡t %p is beyond"

1099 "…ack‘->’d‡ˆ%p\n",(
wh©
==
SUBSTREAM_DTS
?"DTS":"AC3"),

1100 
sub_d©a
,
·ck‘
->
d©a
+6+
·ck‘_Ëngth
);

1101 
wh©
 = 
SUBSTREAM_ERROR
;

1103 ià(
wh©
 =ğ
SUBSTREAM_AC3
 &&

1104 !(
sub_d©a
[0] == 0x0B && sub_data[1] == 0x77))

1106 
	`åršt_msg
("***ƒxpected AC3 sync 0x0B77, but found 0x%02x%02x\n",

1107 
sub_d©a
[0],sub_data[1]);

1108 
wh©
 = 
SUBSTREAM_ERROR
;

1110 ià(
wh©
 =ğ
SUBSTREAM_DTS
 &&

1111 !(
sub_d©a
[0] == 0x7F && sub_data[1] == 0xFE &&

1112 
sub_d©a
[2] == 0x80 && sub_data[3] == 0x01))

1114 
	`åršt_msg
("***ƒxpected DTS sync 0x7FFE8001,"

1116 
sub_d©a
[0],sub_data[1],sub_data[2],sub_data[3]);

1117 
wh©
 = 
SUBSTREAM_ERROR
;

1119 ià(
wh©
 =ğ
SUBSTREAM_AC3
)

1120 
	`d‘”mše_ac3_d‘as
(
sub_d©a
,
v”bo£
,
bsmod
,
acmod
);

1126 ià(
d©a
[0] == 0x0B && data[1] == 0x77)

1128 
wh©
 = 
SUBSTREAM_AC3
;

1129 
	`d‘”mše_ac3_d‘as
(
d©a
,
v”bo£
,
bsmod
,
acmod
);

1131 ià(
d©a
[0] == 0x7F && data[1] == 0xFE &&

1132 
d©a
[2] == 0x80 && data[3] == 0x01)

1133 
wh©
 = 
SUBSTREAM_DTS
;

1135 ià(
v”bo£
)

1137 
wh©
)

1139 
SUBSTREAM_AC3
:

1140 
	`´št_msg
("*** Looks†ike AC3\n");

1142 
SUBSTREAM_DTS
:

1143 
	`´št_msg
("*** Looks†ike DTS\n");

1145 
SUBSTREAM_LPCM
:

1146 
	`´št_msg
("*** Looks†ike LPCM\n");

1148 
SUBSTREAM_SUBPICTURES
:

1149 
	`´št_msg
("*** Looks†ike sub-pictures\n");

1151 
SUBSTREAM_OTHER
:

1152 
	`åršt_msg
("*** Other substream: %02x %02x %02x %02x\n",

1153 
d©a
[0],data[1],data[2],data[3]);

1156 
	`åršt_msg
("*** Error„ecognising substream: %02x %02x %02x %02x\n",

1157 
d©a
[0],data[1],data[2],data[3]);

1161  
wh©
;

1162 
	}
}

1182 
	$wr™e_video
(
TS_wr™”_p
 
ouut
,

1183 
PS_·ck_h—d”
 *
h—d”
,

1184 
by‹
 
¡»am_id
,

1185 
PS_·ck‘
 *
·ck‘
,

1186 
´og¿m_d©a
 *
´og_d©a
,

1187 *
num_video_ignÜed
,

1188 *
num_video_wr™‹n
,

1189 
v”bo£
,

1190 
qu›t
)

1192 
”r
;

1199 ià(
´og_d©a
->
video_¡»am
 == -1)

1201 
´og_d©a
->
video_¡»am
 = 
¡»am_id
;

1203 ià(
¡»am_id
 !ğ
´og_d©a
->
video_¡»am
)

1205 
ignÜed_¡»am
[
NUMBER_VIDEO_STREAMS
] = {0};

1206 
this_¡»am
 = 
¡»am_id
 & 0x0F;

1207 ià(!
ignÜed_¡»am
[
this_¡»am
])

1209 
ignÜed_¡»am
[
this_¡»am
] = 
TRUE
;

1210 ià(!
qu›t
)

1211 
	`åršt_msg
("IgnÜšg videØ¡»am 0x%x (%d)\n",
this_¡»am
,this_stream);

1213 (*
num_video_ignÜed
) ++;

1217 ià(*
num_video_wr™‹n
 == 0)

1219 ià(!
qu›t
)

1220 
	`åršt_msg
("Video: stream %d, PID 0x%03x, streamype 0x%02x\n"

1222 
¡»am_id
 & 0x0F,
´og_d©a
->
video_pid
,´og_d©a->
video_ty³
,

1223 
	`h222_¡»am_ty³_¡r
(
´og_d©a
->
video_ty³
));

1225 
”r
 = 
	`add_¡»am_to_pmt
(
´og_d©a
->
pmt
,´og_d©a->
video_pid
,

1226 
´og_d©a
->
video_ty³
,0,
NULL
);

1227 ià(
”r
)  1;

1228 
´og_d©a
->
pmt
->
v”siÚ_numb”
 ++;

1233 
”r
 = 
	`wr™e_·t_ªd_pmt
(
ouut
,

1234 
´og_d©a
->
Œª¥Üt_¡»am_id
,

1235 
´og_d©a
->
´og_li¡
,

1236 
´og_d©a
->
pmt_pid
,

1237 
´og_d©a
->
pmt
);

1238 ià(
”r
)

1240 
	`´št_”r
("### Error writing TS…rogram data before video…acket\n");

1246 
”r
 = 
	`wr™e_PES_as_TS_PES_·ck‘
(
ouut
,
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,

1247 
´og_d©a
->
video_pid
,

1248 
DEFAULT_VIDEO_STREAM_ID
,

1249 
TRUE
,
h—d”
->
sü_ba£
,h—d”->
sü_exŠ
);

1250 ià(
”r
)  1;

1252 (*
num_video_wr™‹n
) ++;

1253 ià(
v”bo£
)

1255 
	`´št_msg
("v");

1256 
	`æush_msg
();

1259 
	}
}

1270 
	$wr™e_DVD_AC3_d©a
(
TS_wr™”_p
 
ouut
,

1271 
PS_·ck‘
 *
·ck‘
,

1272 
´og¿m_d©a
 *
´og_d©a
)

1283 
PES_h—d”_d©a_Ëngth
 = 
·ck‘
->
d©a
[6+2];

1284 
by‹
 *
d©a
 = 
·ck‘
->d©¨+ 6 + 3 + 
PES_h—d”_d©a_Ëngth
;

1285 
d©a_Ën
 = 
·ck‘
->d©a_ËÀ- 6 - 3 - 
PES_h—d”_d©a_Ëngth
;

1287 
äame_couÁ
 = 
d©a
[1];

1288 
off£t
 = (
d©a
[2] << 8) | data[3];

1292 
gÙ_±s
;

1293 
ušt64_t
 
±s
;

1294 
PES_·ck‘_Ëngth
 = (
·ck‘
->
d©a
[4] << 8) |…acket->data[5];

1296 
”r
 = 
	`fšd_PTS_š_PES
(
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,&
gÙ_±s
,&
±s
);

1297 ià(
”r
)

1299 
	`´št_”r
("### Error†ooking for PTS in PES…acket\n");

1303 #ià
DEBUG_AC3


1304 
	`åršt_msg
(".. frame_count=%d, offset=%4d, got_pts=%d ",

1305 
äame_couÁ
,
off£t
,
gÙ_±s
);

1306 ià(
äame_couÁ
 > 0 && 
off£t
 > 0)

1308 ià(
d©a
[
off£t
+3]==0x0B && data[offset+4]==0x77)

1309 
	`´št_msg
("(frame is AC3)\n");

1311 
	`åršt_msg
("(frame‡ppearso start %02x %02x)\n",

1312 
d©a
[
off£t
+3],data[offset+4]);

1316 ià(
äame_couÁ
 =ğ0 || 
off£t
 <ğ1 || !
gÙ_±s
)

1325 #ià
DEBUG_AC3


1326 
	`åršt_msg
("movd©¨dowÀ4,†—všg %4d\n",
d©a_Ën
-4);

1329 (è
	`memmove
(
d©a
,d©a+4,
d©a_Ën
-4);

1332 
PES_·ck‘_Ëngth
 -= 4;

1333 
·ck‘
->
d©a
[4] = (
PES_·ck‘_Ëngth
 & 0xFF00) >> 8;

1334 
·ck‘
->
d©a
[5] = (
PES_·ck‘_Ëngth
 & 0x00FF);

1337 
”r
 = 
	`wr™e_PES_as_TS_PES_·ck‘
(
ouut
,
·ck‘
->
d©a
,·ck‘->
d©a_Ën
-4,

1338 
´og_d©a
->
audio_pid
,

1339 
PRIVATE1_AUDIO_STREAM_ID
,

1340 
FALSE
,0,0);

1341 ià(
”r
)  1;

1349 #ià
DEBUG_AC3


1350 
	`åršt_msg
("write first %4d bytes,hen move data down %4d,†eaving %4d\n",

1351 
off£t
-1,3+off£t,
d©a_Ën
-3-offset);

1355 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
,
d©a
+4,
off£t
-1,

1356 
´og_d©a
->
audio_pid
,

1357 
PRIVATE1_AUDIO_STREAM_ID
);

1358 ià(
”r
)  1;

1363 (è
	`memmove
(
d©a
,d©a+3+
off£t
,
d©a_Ën
-3-offset);

1366 
PES_·ck‘_Ëngth
 -ğ3 + 
off£t
;

1367 
·ck‘
->
d©a
[4] = (
PES_·ck‘_Ëngth
 & 0xFF00) >> 8;

1368 
·ck‘
->
d©a
[5] = (
PES_·ck‘_Ëngth
 & 0x00FF);

1371 
”r
 = 
	`wr™e_PES_as_TS_PES_·ck‘
(
ouut
,
·ck‘
->
d©a
,

1372 
·ck‘
->
d©a_Ën
-3-
off£t
,

1373 
´og_d©a
->
audio_pid
,

1374 
PRIVATE1_AUDIO_STREAM_ID
,

1375 
FALSE
,0,0);

1376 ià(
”r
)  1;

1379 
	}
}

1395 
	$wr™e_audio
(
TS_wr™”_p
 
ouut
,

1396 
by‹
 
¡»am_id
,

1397 
PS_·ck‘
 *
·ck‘
,

1398 
´og¿m_d©a
 *
´og_d©a
,

1399 *
num_audio_ignÜed
,

1400 *
num_audio_wr™‹n
,

1401 
v”bo£
,

1402 
qu›t
)

1404 
”r
;

1405 
sub¡»am_šdex
 = -1;

1406 
by‹
 
bsmod
 = 0xFF;

1407 
by‹
 
asmod
 = 0xFF;

1408 
is_h222_³s
 = 
	`IS_H222_PES
(
·ck‘
->
d©a
);

1421 ià(
´og_d©a
->
audio_¡»am
 == -1)

1423 ià(
¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
 && 
is_h222_³s
)

1426 
wh©
 = 
	`id’tify_´iv©e1_d©a
(
·ck‘
,
´og_d©a
->
is_dvd
,
v”bo£
,

1427 &
sub¡»am_šdex
,&
bsmod
,&
asmod
);

1428 ià(
wh©
 !ğ
SUBSTREAM_AC3
)

1433 
´og_d©a
->
audio_¡»am
 = 
¡»am_id
;

1434 
´og_d©a
->
audio_sub¡»am
 = 
sub¡»am_šdex
;

1437 
´og_d©a
->
audio_¡»am
 = 
¡»am_id
;

1439 ià(
¡»am_id
 !ğ
´og_d©a
->
audio_¡»am
)

1441 ià(!
qu›t
)

1443 
ignÜed_¡»am
[
NUMBER_AUDIO_STREAMS
] = {0};

1444 
this_¡»am
 = 
¡»am_id
 & 0x1F;

1445 ià(!
ignÜed_¡»am
[
this_¡»am
])

1447 
ignÜed_¡»am
[
this_¡»am
] = 
TRUE
;

1448 
	`åršt_msg
("IgnÜšg‡udiØ¡»am 0x%x (%d)\n",
this_¡»am
,this_stream);

1451 (*
num_audio_ignÜed
) ++;

1454 ià(
´og_d©a
->
is_dvd
 &&

1455 
¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
 &&

1456 
´og_d©a
->
audio_¡»am
 =ğ
PRIVATE1_AUDIO_STREAM_ID
 &&

1457 
is_h222_³s
)

1460 
wh©
 = 
	`id’tify_´iv©e1_d©a
(
·ck‘
,
´og_d©a
->
is_dvd
,
v”bo£
,

1461 &
sub¡»am_šdex
,&
bsmod
,&
asmod
);

1462 ià(
wh©
 !ğ
SUBSTREAM_AC3
)

1464 ià(!
qu›t
)

1466 
	#MAX_IGNORED_NON_AC3
 10

1467 
ušt32_t
 
ignÜed_nÚ_AC3
[
MAX_IGNORED_NON_AC3
] = {0};

	)

1468 
ušt32_t
 
lookfÜ
 = (
wh©
 << 16è| 
sub¡»am_šdex
;

1469 
ii
;

1470 
ii
 = 0; i˜< 
MAX_IGNORED_NON_AC3
; ii++)

1472 ià(
ignÜed_nÚ_AC3
[
ii
] =ğ
lookfÜ
)

1474 ià(
ignÜed_nÚ_AC3
[
ii
] == 0)

1477 
ignÜed_nÚ_AC3
[
ii
] = 
lookfÜ
;

1478 
	`åršt_msg
("Ignoring %sprivate_stream_1 substream 0x%x (%d)"

1480 (
	`SUBSTREAM_IS_AUDIO
(
wh©
)?"":"non-audio "),

1481 
sub¡»am_šdex
,sub¡»am_šdex,
	`SUBSTREAM_STR
(
wh©
));

1486 ià(
	`SUBSTREAM_IS_AUDIO
(
wh©
))

1487 (*
num_audio_ignÜed
) ++;

1490 ià(
sub¡»am_šdex
 !ğ
´og_d©a
->
audio_sub¡»am
)

1492 ià(!
qu›t
)

1494 
ignÜed_ac3_sub¡»am
[
NUMBER_AC3_SUBSTREAMS
] = {0};

1495 ià(!
ignÜed_ac3_sub¡»am
[
sub¡»am_šdex
])

1497 
ignÜed_ac3_sub¡»am
[
sub¡»am_šdex
] = 
TRUE
;

1498 
	`åršt_msg
("Ignoring…rivate_stream_1 substream 0x%x (%d) "

1499 "cÚššg AC3\n",
sub¡»am_šdex
,substream_index);

1502 (*
num_audio_ignÜed
) ++;

1507 ià(*
num_audio_wr™‹n
 == 0)

1509 
by‹
 
audio_¡»am_ty³
;

1510 ià(
¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
)

1512 ià(
´og_d©a
->
ouut_dŞby_as_dvb
)

1513 
audio_¡»am_ty³
 = 
DVB_DOLBY_AUDIO_STREAM_TYPE
;

1515 
audio_¡»am_ty³
 = 
ATSC_DOLBY_AUDIO_STREAM_TYPE
;

1518 
audio_¡»am_ty³
 = 
MPEG2_AUDIO_STREAM_TYPE
;

1520 ià(!
qu›t
)

1522 ià(
¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
)

1524 
	`´št_msg
("Audio:…rivate stream 1,");

1525 ià(
´og_d©a
->
is_dvd
 && 
is_h222_³s
)

1526 
	`åršt_msg
(" sub¡»am %d,",
´og_d©a
->
audio_sub¡»am
);

1527 
	`åršt_msg
(" PID 0x%03x, AC-3 (DŞby)\n",
´og_d©a
->
audio_pid
);

1528 
	`åršt_msg
(" %s\n‡udio coding mode %s\n",

1529 
	`BSMOD_STR
(
bsmod
,
asmod
),
	`ACMOD_STR
(asmod));

1533 
	`åršt_msg
("Audio: stream %d, PID 0x%03x, streamype 0x%02x = %s\n",

1534 
¡»am_id
 & 0x1F,
´og_d©a
->
audio_pid
,
audio_¡»am_ty³
,

1535 
	`h222_¡»am_ty³_¡r
(
audio_¡»am_ty³
));

1539 ià(
audio_¡»am_ty³
 =ğ
DVB_DOLBY_AUDIO_STREAM_TYPE
)

1541 
by‹
 
desc
[] = {0x6A, 0x01, 0x00};

1542 
desc_Ën
 = 3;

1543 
”r
 = 
	`add_¡»am_to_pmt
(
´og_d©a
->
pmt
,´og_d©a->
audio_pid
,

1544 
audio_¡»am_ty³
,
desc_Ën
,
desc
);

1546 ià(
audio_¡»am_ty³
 =ğ
ATSC_DOLBY_AUDIO_STREAM_TYPE
)

1548 
by‹
 
desc
[] = {0x05, 0x04, 0x41, 0x43, 0x2D, 0x33};

1549 
desc_Ën
 = 6;

1550 
”r
 = 
	`add_¡»am_to_pmt
(
´og_d©a
->
pmt
,´og_d©a->
audio_pid
,

1551 
audio_¡»am_ty³
,
desc_Ën
,
desc
);

1554 
”r
 = 
	`add_¡»am_to_pmt
(
´og_d©a
->
pmt
,´og_d©a->
audio_pid
,

1555 
audio_¡»am_ty³
,0,
NULL
);

1556 ià(
”r
)  1;

1557 
´og_d©a
->
pmt
->
v”siÚ_numb”
 ++;

1562 
”r
 = 
	`wr™e_·t_ªd_pmt
(
ouut
,

1563 
´og_d©a
->
Œª¥Üt_¡»am_id
,

1564 
´og_d©a
->
´og_li¡
,

1565 
´og_d©a
->
pmt_pid
,

1566 
´og_d©a
->
pmt
);

1567 ià(
”r
)

1569 
	`´št_”r
("### Error writing TS…rogram data before‡udio…acket\n");

1574 ià(
´og_d©a
->
is_dvd
 && 
¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
 &&

1575 
is_h222_³s
)

1578 
”r
 = 
	`wr™e_DVD_AC3_d©a
(
ouut
,
·ck‘
,
´og_d©a
);

1579 ià(
”r
)  1;

1583 
”r
 = 
	`wr™e_PES_as_TS_PES_·ck‘
(
ouut
,
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,

1584 
´og_d©a
->
audio_pid
,

1585 (
´og_d©a
->
wªt_ac3
?

1586 
PRIVATE1_AUDIO_STREAM_ID
:

1587 
DEFAULT_AUDIO_STREAM_ID
),

1588 
FALSE
,0,0);

1589 ià(
”r
)  1;

1592 (*
num_audio_wr™‹n
) ++;

1593 ià(
v”bo£
)

1595 
	`´št_msg
("a");

1596 
	`æush_msg
();

1599 
	}
}

1638 
	$_ps_to_ts
(
PS_»ad”_p
 
ps
,

1639 
TS_wr™”_p
 
ouut
,

1640 
´og¿m_d©a
 *
´og_d©a
,

1641 
·d_¡¬t
,

1642 
´og¿m_»³©
,

1643 
k“p_audio
,

1644 
max
,

1645 
v”bo£
,

1646 
qu›t
)

1648 
ii
, 
”r
;

1649 
off£t_t
 
po¢
 = 0;

1650 
couÁ
 = 0;

1651 
by‹
 
¡»am_id
;

1652 
’d_of_fe
 = 
FALSE
;

1655 
num_·cks
 = 0;

1656 
num_audio_wr™‹n
 = 0;

1657 
num_video_wr™‹n
 = 0;

1658 
num_video_ignÜed
 = 0;

1659 
num_audio_ignÜed
 = 0;

1661 
PS_·ck‘
 
·ck‘
 = {0};

1662 
PS_·ck_h—d”
 
h—d”
 = {0};

1667 
ii
=0; ii<
·d_¡¬t
; ii++)

1669 
”r
 = 
	`wr™e_TS_nuÎ_·ck‘
(
ouut
);

1670 ià(
”r
)  1;

1673 ià(!
qu›t
)

1674 
	`åršt_msg
("Writingransport stream id 1, PMT PID 0x%02x, PCR PID 0x%02x\n",

1675 
´og_d©a
->
pmt_pid
,´og_d©a->
pü_pid
);

1679 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
v”bo£
,&
po¢
,&
¡»am_id
);

1680 ià(
”r
 =ğ
EOF
)

1682 
	`´št_”r
("### Error„eading first…ack header\n");

1683 
	`´št_”r
(" Unexpectedƒnd of PS‡t start of stream\n");

1686 ià(
”r
)

1688 
	`´št_”r
("### Error„eading first…ack header\n");

1691 
couÁ
 ++;

1693 ià(
¡»am_id
 != 0xba)

1695 
	`´št_”r
("### Program stream does‚ot start with…ack header\n");

1696 
	`åršt_”r
(" Fœ¡…ack‘ ha ¡»am id %02X (",
¡»am_id
);

1697 
	`´št_¡»am_id
(
FALSE
,
¡»am_id
);

1698 
	`´št_”r
(")\n");

1706 
	#READ_NEXT_PS_PACKET_START
 \

1707 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
FALSE
,&
po¢
,&
¡»am_id
); \

1708 ià(
”r
 =ğ
EOF
) \

1710 
’d_of_fe
 = 
TRUE
; \

1713 ià(
”r
) \

1715 
couÁ
 ++;

	)

1720 
num_sy¡em_h—d”s
 = 0;

1722 ià(
max
 > 0 && 
num_·cks
 >= max)

1724 ià(
v”bo£
)

1725 
	`åršt_msg
("Stİpšg‡á” %d…acks\n",
num_·cks
);

1729 
num_·cks
 ++;

1733 ià(
num_·cks
 % 
´og¿m_»³©
 == 0)

1735 ià(
v”bo£
)

1737 
	`´št_msg
("PGM");

1738 
	`æush_msg
();

1740 
”r
 = 
	`wr™e_·t_ªd_pmt
(
ouut
,

1741 
´og_d©a
->
Œª¥Üt_¡»am_id
,

1742 
´og_d©a
->
´og_li¡
,

1743 
´og_d©a
->
pmt_pid
,

1744 
´og_d©a
->
pmt
);

1745 ià(
”r
)

1747 
	`´št_”r
("### Error writing out TS…rogram data\n");

1752 
”r
 = 
	`»ad_PS_·ck_h—d”_body
(
ps
,&
h—d”
);

1753 ià(
”r
)

1755 
	`åršt_”r
("### Error„eading data for…ack header starting‡t "

1756 
OFFSET_T_FORMAT
 "\n",
po¢
);

1761 
READ_NEXT_PS_PACKET_START
;

1764 ià(
¡»am_id
 == 0xbb)

1766 
”r
 = 
	`»ad_PS_·ck‘_body
(
ps
,
¡»am_id
,&
·ck‘
);

1767 ià(
”r
)

1769 
	`åršt_”r
("### Error„eading system header starting‡t "

1770 
OFFSET_T_FORMAT
 "\n",
po¢
);

1773 
num_sy¡em_h—d”s
 ++;

1775 
READ_NEXT_PS_PACKET_START
;

1778 ià(
’d_of_fe
)

1782 
¡»am_id
 != 0xba)

1784 
”r
 = 
	`»ad_PS_·ck‘_body
(
ps
,
¡»am_id
,&
·ck‘
);

1785 ià(
”r
)

1787 
	`åršt_”r
("### Error„eading PS…acket starting‡t "

1788 
OFFSET_T_FORMAT
 "\n",
po¢
);

1792 ià(
	`IS_AUDIO_STREAM_ID
(
¡»am_id
))

1794 ià(
k“p_audio
)

1796 
”r
 = 
	`wr™e_audio
(
ouut
,
¡»am_id
,&
·ck‘
,
´og_d©a
,

1797 &
num_audio_ignÜed
,&
num_audio_wr™‹n
,

1798 
v”bo£
,
qu›t
);

1799 ià(
”r
)

1801 
	`åršt_”r
("### Error writing‡udio…acket‡t "

1802 
OFFSET_T_FORMAT
 "ØTS\n",
po¢
);

1807 ià(
	`IS_VIDEO_STREAM_ID
(
¡»am_id
))

1809 
”r
 = 
	`wr™e_video
(
ouut
,&
h—d”
,
¡»am_id
,&
·ck‘
,
´og_d©a
,

1810 &
num_video_ignÜed
,&
num_video_wr™‹n
,
v”bo£
,
qu›t
);

1811 ià(
”r
)

1813 
	`åršt_”r
("### E¼Ü wr™šg videØ·ck‘‡ˆ" 
OFFSET_T_FORMAT


1814 "ØTS\n",
po¢
);

1818 ià(
v”bo£
)

1824 
READ_NEXT_PS_PACKET_START
;

1826 ià(
’d_of_fe
)

1830 
	`ş—r_PS_·ck‘
(&
·ck‘
);

1832 ià(
v”bo£
è
	`´št_msg
("\n");

1833 ià(!
qu›t
)

1835 
	`åršt_msg
("Pack‘ ÑÙ®): %6d\n",
couÁ
);

1836 
	`åršt_msg
("Packs: %6d\n",
num_·cks
);

1837 
	`åršt_msg
("VideØ·ck‘ wr™‹n: %6d\n",
num_video_wr™‹n
);

1838 
	`åršt_msg
("AudiØ·ck‘ wr™‹n: %6d\n",
num_audio_wr™‹n
);

1840 ià(
num_video_ignÜed
 > 0)

1841 
	`åršt_msg
("VideØ·ck‘ ignÜed: %6d\n",
num_video_ignÜed
);

1842 ià(
num_audio_ignÜed
 > 0)

1843 
	`åršt_msg
("AudiØ·ck‘ ignÜed: %6d\n",
num_audio_ignÜed
);

1846 
	}
}

1887 
	$ps_to_ts
(
PS_»ad”_p
 
ps
,

1888 
TS_wr™”_p
 
ouut
,

1889 
·d_¡¬t
,

1890 
´og¿m_»³©
,

1891 
video_ty³
,

1892 
is_dvd
,

1893 
video_¡»am
,

1894 
audio_¡»am
,

1895 
wªt_ac3_audio
,

1896 
ouut_dŞby_as_dvb
,

1897 
ušt32_t
 
pmt_pid
,

1898 
ušt32_t
 
pü_pid
,

1899 
ušt32_t
 
video_pid
,

1900 
k“p_audio
,

1901 
ušt32_t
 
audio_pid
,

1902 
max
,

1903 
v”bo£
,

1904 
qu›t
)

1906 
”r
;

1907 
´og¿m_d©a
 
´og_d©a
 = {0};

1909 
´og_d©a
.
Œª¥Üt_¡»am_id
 = 1;

1910 
´og_d©a
.
´og¿m_numb”
 = 1;

1911 
´og_d©a
.
pmt_pid
 =…mt_pid;

1912 
´og_d©a
.
pü_pid
 =…cr_pid;

1913 
´og_d©a
.
video_pid
 = video_pid;

1914 
´og_d©a
.
audio_pid
 =‡udio_pid;

1915 
´og_d©a
.
video_ty³
 = video_type;

1916 
´og_d©a
.
ouut_dŞby_as_dvb
 = output_dolby_as_dvb;

1917 
´og_d©a
.
video_¡»am
 = video_stream;

1918 
´og_d©a
.
wªt_ac3
 = 
wªt_ac3_audio
;

1919 
´og_d©a
.
is_dvd
 = is_dvd;

1920 ià(
wªt_ac3_audio
)

1922 
´og_d©a
.
audio_¡»am
 = 
PRIVATE1_AUDIO_STREAM_ID
;

1923 ià(
is_dvd
)

1924 
´og_d©a
.
audio_sub¡»am
 = 
audio_¡»am
;

1926 
´og_d©a
.
audio_sub¡»am
 = -1;

1929 
´og_d©a
.
audio_¡»am
 =‡udio_stream;

1932 
	#PROGRAM_NUMBER
 1

	)

1933 
”r
 = 
	`bud_pidšt_li¡
(&
´og_d©a
.
´og_li¡
);

1934 ià(
”r
)  1;

1935 
”r
 = 
	`­³nd_to_pidšt_li¡
(
´og_d©a
.
´og_li¡
,
pmt_pid
,
PROGRAM_NUMBER
);

1936 ià(
”r
)

1938 
	`ä“_pidšt_li¡
(&
´og_d©a
.
´og_li¡
);

1941 
´og_d©a
.
pmt
 = 
	`bud_pmt
(
PROGRAM_NUMBER
,0,
pü_pid
);

1942 ià(
”r
)

1944 
	`ä“_pidšt_li¡
(&
´og_d©a
.
´og_li¡
);

1948 
”r
 = 
	`_ps_to_ts
(
ps
,
ouut
,&
´og_d©a
,
·d_¡¬t
,
´og¿m_»³©
,
k“p_audio
,

1949 
max
,
v”bo£
,
qu›t
);

1950 ià(
”r
)

1952 
	`ä“_pidšt_li¡
(&
´og_d©a
.
´og_li¡
);

1953 
	`ä“_pmt
(&
´og_d©a
.
pmt
);

1957 
	`ä“_pidšt_li¡
(&
´og_d©a
.
´og_li¡
);

1958 
	`ä“_pmt
(&
´og_d©a
.
pmt
);

1960 
	}
}

	@ps2ts.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<fú.h
>

33 
	~<”ºo.h
>

35 #ifdeà
_WIN32


36 
	~<¡ddef.h
>

38 
	~<uni¡d.h
>

41 
	~"com·t.h
"

42 
	~"³s_âs.h
"

43 
	~"ps_âs.h
"

44 
	~"ts_âs.h
"

45 
	~"tswr™e_âs.h
"

46 
	~"misc_âs.h
"

47 
	~"´štšg_âs.h
"

48 
	~"v”siÚ.h
"

50 
	$´št_u§ge
()

52 
	`´št_msg
(

56 
	`REPORT_VERSION
("ps2ts");

57 
	`´št_msg
(

161 
	}
}

163 
	$maš
(
¬gc
, **
¬gv
)

165 
u£_¡dš
 = 
FALSE
;

166 
u£_¡dout
 = 
FALSE
;

167 
u£_tı
 = 
FALSE
;

168 
pÜt
 = 88;

169 *
šput_Çme
 = 
NULL
;

170 *
ouut_Çme
 = 
NULL
;

171 
had_šput_Çme
 = 
FALSE
;

172 
had_ouut_Çme
 = 
FALSE
;

173 
PS_»ad”_p
 
ps
 = 
NULL
;

174 
TS_wr™”_p
 
ouut
 = 
NULL
;

175 
v”bo£
 = 
FALSE
;

176 
qu›t
 = 
FALSE
;

177 
max
 = 0;

178 
ušt32_t
 
pmt_pid
 = 0x66;

179 
ušt32_t
 
video_pid
 = 0x68;

180 
ušt32_t
 
pü_pid
 = 
video_pid
;

181 
ušt32_t
 
audio_pid
 = 0x67;

182 
k“p_audio
 = 
TRUE
;

183 
»³©_´og¿m_ev”y
 = 100;

184 
·d_¡¬t
 = 8;

185 
”r
 = 0;

186 
ii
 = 1;

188 
video_ty³
 = 
VIDEO_H262
;

189 
fÜû_¡»am_ty³
 = 
FALSE
;

191 
video_¡»am
 = -1;

192 
audio_¡»am
 = -1;

193 
wªt_ac3_audio
 = 
FALSE
;

195 
šput_is_dvd
 = 
TRUE
;

196 
wªt_dŞby_as_dvb
 = 
TRUE
;

198 ià(
¬gc
 < 2)

200 
	`´št_u§ge
();

204 
ii
 < 
¬gc
)

206 ià(
¬gv
[
ii
][0] == '-')

208 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-help",argv[ii]) ||

209 !
	`¡rcmp
("-h",
¬gv
[
ii
]))

211 
	`´št_u§ge
();

214 ià(!
	`¡rcmp
("-avc",
¬gv
[
ii
]) || !strcmp("-h264",argv[ii]))

216 
fÜû_¡»am_ty³
 = 
TRUE
;

217 
video_ty³
 = 
VIDEO_H264
;

219 ià(!
	`¡rcmp
("-h262",
¬gv
[
ii
]))

221 
fÜû_¡»am_ty³
 = 
TRUE
;

222 
video_ty³
 = 
VIDEO_H262
;

224 ià(!
	`¡rcmp
("-vty³",
¬gv
[
ii
]))

226 
	`CHECKARG
("ps2ts",
ii
);

227 
”r
 = 
	`št_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,0,

228 &
video_ty³
);

229 ià(
”r
)  1;

230 
ii
++;

231 
fÜû_¡»am_ty³
 = 
TRUE
;

233 ià(!
	`¡rcmp
("-mp42",
¬gv
[
ii
]))

235 
fÜû_¡»am_ty³
 = 
TRUE
;

236 
video_ty³
 = 
VIDEO_MPEG4_PART2
;

238 ià(!
	`¡rcmp
("-dŞby",
¬gv
[
ii
]))

240 
	`CHECKARG
("ps2ts",
ii
);

241 ià(!
	`¡rcmp
("dvb",
¬gv
[
ii
+1]))

242 
wªt_dŞby_as_dvb
 = 
TRUE
;

243 ià(!
	`¡rcmp
("©sc",
¬gv
[
ii
+1]))

244 
wªt_dŞby_as_dvb
 = 
FALSE
;

247 
	`´št_”r
("###…s2ts: -dolby must be followed by dvb or‡tsc\n");

250 
ii
++;

252 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

254 
had_šput_Çme
 = 
TRUE
;

255 
u£_¡dš
 = 
TRUE
;

257 ià(!
	`¡rcmp
("-¡dout",
¬gv
[
ii
]))

259 
had_ouut_Çme
 = 
TRUE
;

260 
u£_¡dout
 = 
TRUE
;

261 
	`»dœeù_ouut_¡d”r
();

263 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

265 
	`CHECKARG
("ps2ts",
ii
);

266 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

267 
	`»dœeù_ouut_¡d”r
();

268 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

269 
	`»dœeù_ouut_¡dout
();

272 
	`åršt_”r
("###…s2ts: "

274 " '¡d”r')\n",
¬gv
[
ii
+1]);

277 
ii
++;

279 ià(!
	`¡rcmp
("-dvd",
¬gv
[
ii
]))

281 
šput_is_dvd
 = 
TRUE
;

283 ià(!
	`¡rcmp
("-nÙdvd",
¬gv
[
ii
]) || !strcmp("-nodvd",argv[ii]))

285 
šput_is_dvd
 = 
FALSE
;

287 ià(!
	`¡rcmp
("-ho¡",
¬gv
[
ii
]))

289 
	`CHECKARG
("ps2ts",
ii
);

290 
”r
 = 
	`ho¡_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],&
ouut_Çme
,&
pÜt
);

291 ià(
”r
)  1;

292 
had_ouut_Çme
 = 
TRUE
;

293 
u£_tı
 = 
TRUE
;

294 
ii
++;

296 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

298 
v”bo£
 = 
TRUE
;

299 
qu›t
 = 
FALSE
;

301 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

303 
v”bo£
 = 
FALSE
;

304 
qu›t
 = 
TRUE
;

306 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

308 
	`CHECKARG
("ps2ts",
ii
);

309 
”r
 = 
	`št_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

310 ià(
”r
)  1;

311 
ii
++;

313 ià(!
	`¡rcmp
("-´•—t",
¬gv
[
ii
]))

315 
	`CHECKARG
("ps2ts",
ii
);

316 
”r
 = 
	`št_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

317 &
»³©_´og¿m_ev”y
);

318 ià(
”r
)  1;

319 
ii
++;

321 ià(!
	`¡rcmp
("-·d",
¬gv
[
ii
]))

323 
	`CHECKARG
("ps2ts",
ii
);

324 
”r
 = 
	`št_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
·d_¡¬t
);

325 ià(
”r
)  1;

326 
ii
++;

328 ià(!
	`¡rcmp
("-vpid",
¬gv
[
ii
]))

330 
	`CHECKARG
("ps2ts",
ii
);

331 
”r
 = 
	`unsigÃd_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],0,&
video_pid
);

332 ià(
”r
)  1;

333 
ii
++;

335 ià(!
	`¡rcmp
("-­id",
¬gv
[
ii
]))

337 
	`CHECKARG
("ps2ts",
ii
);

338 
”r
 = 
	`unsigÃd_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],0,&
audio_pid
);

339 ià(
”r
)  1;

340 
ii
++;

342 ià(!
	`¡rcmp
("-pmt",
¬gv
[
ii
]))

344 
	`CHECKARG
("ps2ts",
ii
);

345 
”r
 = 
	`unsigÃd_v®ue
("ps2ts",
¬gv
[
ii
],¬gv[ii+1],0,&
pmt_pid
);

346 ià(
”r
)  1;

347 
ii
++;

349 ià(!
	`¡rcmp
("-nßudio",
¬gv
[
ii
]))

351 
k“p_audio
 = 
FALSE
;

353 ià(!
	`¡rcmp
("-v¡»am",
¬gv
[
ii
]))

355 
	`CHECKARG
("ps2ts",
ii
);

356 
”r
 = 
	`št_v®ue_š_¿nge
("ps2ts",
¬gv
[
ii
],argv[ii+1],0,0xF,0,

357 &
video_¡»am
);

358 ià(
”r
)  1;

359 
ii
++;

361 ià(!
	`¡rcmp
("-a¡»am",
¬gv
[
ii
]))

363 
	`CHECKARG
("ps2ts",
ii
);

364 
”r
 = 
	`št_v®ue_š_¿nge
("ps2ts",
¬gv
[
ii
],argv[ii+1],0,0x1F,0,

365 &
audio_¡»am
);

366 ià(
”r
)  1;

367 
wªt_ac3_audio
 = 
FALSE
;

368 
ii
++;

370 ià(!
	`¡rcmp
("-ac3¡»am",
¬gv
[
ii
]))

372 
	`CHECKARG
("ps2ts",
ii
);

373 
”r
 = 
	`št_v®ue_š_¿nge
("ps2ts",
¬gv
[
ii
],argv[ii+1],0,0x7,0,

374 &
audio_¡»am
);

375 ià(
”r
)  1;

376 
wªt_ac3_audio
 = 
TRUE
;

377 
šput_is_dvd
 = 
TRUE
;

378 
ii
++;

382 
	`åršt_”r
("###…s2ts: "

383 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

389 ià(
had_šput_Çme
 && 
had_ouut_Çme
)

391 
	`åršt_”r
("###…s2ts: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

394 ià(
had_šput_Çme
)

396 
ouut_Çme
 = 
¬gv
[
ii
];

397 
had_ouut_Çme
 = 
TRUE
;

401 
šput_Çme
 = 
¬gv
[
ii
];

402 
had_šput_Çme
 = 
TRUE
;

405 
ii
++;

408 ià(!
had_šput_Çme
)

410 
	`´št_”r
("###…s2ts: No input file specified\n");

413 ià(!
had_ouut_Çme
)

415 
	`´št_”r
("###…s2ts: No output file specified\n");

420 ià(
u£_¡dout
)

422 
v”bo£
 = 
FALSE
;

423 
qu›t
 = 
TRUE
;

426 
”r
 = 
	`İ’_PS_fe
(
šput_Çme
,
qu›t
,&
ps
);

427 ià(
”r
)

429 
	`åršt_”r
("###…s2ts: Unableo open input %s\n",

430 (
u£_¡dš
?"<¡dš>":
šput_Çme
));

434 ià(!
qu›t
)

435 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

438 ià(
fÜû_¡»am_ty³
 || 
u£_¡dš
)

440 ià(!
qu›t
)

441 
	`åršt_msg
("Reading input‡s %s (0x%02x)\n",

442 
	`h222_¡»am_ty³_¡r
(
video_ty³
),video_type);

446 
”r
 = 
	`d‘”mše_PS_video_ty³
(
ps
,&
video_ty³
);

447 ià(
”r
)  1;

448 ià(!
qu›t
)

449 
	`åršt_msg
("Video‡ppearso be %s (0x%02x)\n",

450 
	`h222_¡»am_ty³_¡r
(
video_ty³
),video_type);

453 ià(!
qu›t
)

455 ià(
šput_is_dvd
)

456 
	`´št_msg
("Treating input‡s from DVD\n");

458 
	`´št_msg
("Treating input‡s NOT from DVD\n");

460 
	`´št_msg
("Reading video from ");

461 ià(
video_¡»am
 == -1)

462 
	`´št_msg
("first stream found");

464 
	`åršt_msg
("¡»am %0#x (%d)",
video_¡»am
,video_stream);

465 ià(
k“p_audio
)

467 
	`´št_msg
(",‡udio from ");

468 ià(
audio_¡»am
 == -1)

469 
	`åršt_msg
("fœ¡ % found",(
wªt_ac3_audio
?"AC3 stream":"stream"));

471 
	`åršt_msg
("% %0#x (%d)",(
wªt_ac3_audio
?"AC3 stream":"stream"),

472 
audio_¡»am
,audio_stream);

473 
	`´št_msg
("\n");

476 
	`åršt_msg
("Wr™šg videØw™h PID 0x%02x",
video_pid
);

477 ià(
k“p_audio
)

478 
	`åršt_msg
(",‡udiØw™h PID 0x%02x,",
audio_pid
);

479 
	`åršt_msg
(" PMT PID 0x%02x, PCR PID 0x%02x\n",
pmt_pid
,
pü_pid
);

480 ià(
max
)

481 
	`åršt_msg
("Stİpšg‡á” %d…rog¿m sŒ—m…ack‘s\n",
max
);

484 ià(
u£_¡dout
)

485 
”r
 = 
	`tswr™e_İ’
(
TS_W_STDOUT
,
NULL
,NULL,0,
qu›t
,&
ouut
);

486 ià(
u£_tı
)

487 
”r
 = 
	`tswr™e_İ’
(
TS_W_TCP
,
ouut_Çme
,
NULL
,
pÜt
,
qu›t
,&
ouut
);

489 
”r
 = 
	`tswr™e_İ’
(
TS_W_FILE
,
ouut_Çme
,
NULL
,0,
qu›t
,&
ouut
);

490 ià(
”r
)

492 
	`åršt_”r
("###…s2ts: UÇbËØİ’ %s\n",
ouut_Çme
);

493 (è
	`şo£_PS_fe
(&
ps
);

497 
”r
 = 
	`ps_to_ts
(
ps
,
ouut
,
·d_¡¬t
,
»³©_´og¿m_ev”y
,

498 
video_ty³
,
šput_is_dvd
,

499 
video_¡»am
,
audio_¡»am
,
wªt_ac3_audio
,

500 
wªt_dŞby_as_dvb
,
pmt_pid
,
pü_pid
,
video_pid
,

501 
k“p_audio
,
audio_pid
,
max
,
v”bo£
,
qu›t
);

502 ià(
”r
)

504 
	`´št_”r
("###…s2ts: Errorransferring data\n");

505 (è
	`şo£_PS_fe
(&
ps
);

506 (è
	`tswr™e_şo£
(
ouut
,
TRUE
);

511 
”r
 = 
	`tswr™e_şo£
(
ouut
,
qu›t
);

512 ià(
”r
)

513 
	`åršt_”r
("###…s2ts: E¼Ü closšg ouuˆ%s: %s\n",
ouut_Çme
,

514 
	`¡»¼Ü
(
”ºo
));

515 
”r
 = 
	`şo£_PS_fe
(&
ps
);

516 ià(
”r
)

517 
	`åršt_”r
("###…s2ts: Error closing input %s\n",

518 (
u£_¡dš
?"<¡dš>":
šput_Çme
));

520 
	}
}

	@ps_defns.h

30 #iâdeà
_ps_deâs


31 
	#_ps_deâs


	)

33 
	~"com·t.h
"

34 
	~"h222_deâs.h
"

35 
	~"tswr™e_deâs.h
"

40 
	#PS_READ_AHEAD_SIZE
 5000

41 

	)

42 
	sps_»ad”


44 
	mšput
;

45 
off£t_t
 
	m¡¬t
;

47 
by‹
 
	md©a
[
PS_READ_AHEAD_SIZE
];

48 
off£t_t
 
	md©a_po¢
;

49 
št32_t
 
	md©a_Ën
;

50 
by‹
 *
	md©a_’d
;

51 
by‹
 *
	md©a_±r
;

53 
ps_»ad”
 *
	tPS_»ad”_p
;

54 
	#SIZEOF_PS_READER
 (
ps_»ad”
)

	)

58 
	sPS_·ck_h—d”


60 
	mid
;

61 
by‹
 
	md©a
[10];

62 
ušt64_t
 
	msü
;

63 
ušt64_t
 
	msü_ba£
;

64 
ušt32_t
 
	msü_exŠ
;

65 
ušt32_t
 
	m´og¿m_mux_¿‹
;

66 
	m·ck_¡uffšg_Ëngth
;

68 
PS_·ck_h—d”
 *
	tPS_·ck_h—d”_p
;

69 
	#SIZEOF_PS_PACK_HEADER
 (
PS_·ck_h—d”
)

	)

74 
	sPS_·ck‘


76 
	mid
;

78 
by‹
 *
	md©a
;

79 
	md©a_Ën
;

81 
by‹
 
	m¡»am_id
;

82 
	m·ck‘_Ëngth
;

84 
PS_·ck‘
 *
	tPS_·ck‘_p
;

85 
	#SIZEOF_PS_PACKET
 (
PS_·ck‘
)

	)

90 
	#NUMBER_VIDEO_STREAMS
 0x0F

	)

91 
	#NUMBER_AUDIO_STREAMS
 0x1F

	)

92 
	#NUMBER_AC3_SUBSTREAMS
 0x08

	)

97 
	#SUBSTREAM_OTHER
 0

	)

98 
	#SUBSTREAM_AC3
 1

99 
	#SUBSTREAM_DTS
 2

100 
	#SUBSTREAM_LPCM
 3

101 
	#SUBSTREAM_SUBPICTURES
 4

102 
	#SUBSTREAM_ERROR
 5

103 
	#NUMBER_SUBSTREAM_TYPES
 6

104 

	)

105 
	#SUBSTREAM_STR
(
wh©
è((wh©)==
SUBSTREAM_OTHER
?"other": \

106 (
wh©
)==
SUBSTREAM_AC3
 ?"AC3": \

107 (
wh©
)==
SUBSTREAM_DTS
 ?"DTS": \

108 (
wh©
)==
SUBSTREAM_LPCM
 ?"LPCM": \

109 (
wh©
)==
SUBSTREAM_SUBPICTURES
?"subpictures": \

110 "???")

	)

112 
	#SUBSTREAM_IS_AUDIO
(
wh©
è((wh©)==
SUBSTREAM_AC3
|| \

113 (
wh©
)==
SUBSTREAM_DTS
|| \

114 (
wh©
)==
SUBSTREAM_LPCM
)

	)

116 
	#BSMOD_STR
(
bsmod
,
acmod
) \

117 ((
bsmod
)==0?"main‡udio service: complete main (CM)": \

118 (
bsmod
)==1?"main‡udio service: music &ƒffects (ME)": \

119 (
bsmod
)==2?"associated service: visually impaired (VI)": \

120 (
bsmod
)==3?"associated service: hearing impaired (HI)": \

121 (
bsmod
)==4?"associated service: dialogue (D)": \

122 (
bsmod
)==5?"associated service: commentary (C)": \

123 (
bsmod
)==6?"associated service:ƒmergency (E)": \

124 (
bsmod
)==7 && (
acmod
)==1?"associated service: voice over (VO)": \

125 (
bsmod
)==7 && (
acmod
)>=2 && (acmod)<=7?"main‡udio service: karaoke": \

126 "???")

	)

128 
	#ACMOD_STR
(
acmod
) ((acmod)==0?"1+1 Ch1,Ch2": \

129 (
acmod
)==1?"1/0 C": \

130 (
acmod
)==2?"2/0 L,R": \

131 (
acmod
)==3?"3/0 L,C,R": \

132 (
acmod
)==4?"2/1 L,R,S": \

133 (
acmod
)==5?"3/1 L,C,R,S": \

134 (
acmod
)==6?"2/2 L,R,SL,SR": \

135 (
acmod
)==7?"3/2 L,C,R,SL,SR":"???")

	)

	@ps_fns.h

30 #iâdeà
_ps_âs


31 
	#_ps_âs


	)

33 
	~"com·t.h
"

34 
	~"h222_deâs.h
"

35 
	~"tswr™e_deâs.h
"

36 
	~"ps_deâs.h
"

51 
bud_PS_»ad”
(
šput
,

52 
qu›t
,

53 
PS_»ad”_p
 *
ps
);

64 
ä“_PS_»ad”
(
PS_»ad”_p
 *
ps
);

74 
İ’_PS_fe
(*
Çme
,

75 
qu›t
,

76 
PS_»ad”_p
 *
ps
);

82 
şo£_PS_fe
(
PS_»ad”_p
 *
ps
);

99 
d‘”mše_if_PS_is_h264
(
PS_»ad”_p
 
ps
,

100 *
is_h264
);

115 
d‘”mše_PS_video_ty³
(
PS_»ad”_p
 
ps
,

116 *
video_ty³
);

129 
£ek_usšg_PS_»ad”
(
PS_»ad”_p
 
ps
,

130 
off£t_t
 
po¢
);

136 
»wšd_´og¿m_¡»am
(
PS_»ad”_p
 
ps
);

141 
´št_¡»am_id
(
is_msg
,

142 
by‹
 
¡»am_id
);

165 
fšd_PS_·ck‘_¡¬t
(
PS_»ad”_p
 
ps
,

166 
v”bo£
,

167 
ušt32_t
 
max
,

168 
off£t_t
 *
po¢
,

169 
by‹
 *
¡»am_id
);

193 
fšd_PS_·ck_h—d”_¡¬t
(
PS_»ad”_p
 
ps
,

194 
v”bo£
,

195 
ušt32_t
 
max
,

196 
off£t_t
 *
po¢
);

213 
»ad_PS_·ck‘_body
(
PS_»ad”_p
 
ps
,

214 
by‹
 
¡»am_id
,

215 
PS_·ck‘_p
 
·ck‘
);

225 
»ad_PS_·ck_h—d”_body
(
PS_»ad”_p
 
ps
,

226 
PS_·ck_h—d”_p
 
hdr
);

232 
ş—r_PS_·ck‘
(
PS_·ck‘_p
 
·ck‘
);

240 
ä“_PS_·ck‘
(
PS_·ck‘_p
 *
·ck‘
);

263 
»ad_PS_·ck‘_¡¬t
(
PS_»ad”_p
 
ps
,

264 
v”bo£
,

265 
off£t_t
 *
po¢
,

266 
by‹
 *
¡»am_id
);

283 
id’tify_´iv©e1_d©a
(
PS_·ck‘
 *
·ck‘
,

284 
is_dvd
,

285 
v”bo£
,

286 *
sub¡»am_šdex
,

287 
by‹
 *
bsmod
,

288 
by‹
 *
acmod
);

332 
ps_to_ts
(
PS_»ad”_p
 
ps
,

333 
TS_wr™”_p
 
ouut
,

334 
·d_¡¬t
,

335 
´og¿m_»³©
,

336 
video_ty³
,

337 
is_dvd
,

338 
video_¡»am
,

339 
audio_¡»am
,

340 
wªt_ac3_audio
,

341 
dŞby_is_dvb
,

342 
ušt32_t
 
pmt_pid
,

343 
ušt32_t
 
pü_pid
,

344 
ušt32_t
 
video_pid
,

345 
k“p_audio
,

346 
ušt32_t
 
audio_pid
,

347 
max
,

348 
v”bo£
,

349 
qu›t
);

	@psdots.c

30 
	~<¡dio.h
>

31 
	~<¡dlib.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

34 
	~<fú.h
>

35 
	~<lim™s.h
>

37 #ifdeà
_WIN32


38 
	~<¡ddef.h
>

40 
	~<uni¡d.h
>

43 
	~"com·t.h
"

44 
	~"ps_âs.h
"

45 
	~"misc_âs.h
"

46 
	~"´štšg_âs.h
"

47 
	~"v”siÚ.h
"

60 
	$»pÜt_ps_dÙs
(
PS_»ad”_p
 
ps
,

61 
max
,

62 
v”bo£
)

64 
”r
;

65 
couÁ
 = 0;

66 
num_·cks
 = 0;

67 
off£t_t
 
po¢
;

68 
by‹
 
¡»am_id
;

69 
’d_of_fe
 = 
FALSE
;

71 
PS_·ck‘
 
·ck‘
 = {0};

72 
PS_·ck_h—d”
 
h—d”
 = {0};

74 ià(
v”bo£
)

75 
	`´št_msg
("Characters„epresenthe following:\n"

92 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
FALSE
,&
po¢
,&
¡»am_id
);

93 ià(
”r
 =ğ
EOF
)

95 
	`´št_”r
("### Error„eading first…ack header\n");

96 
	`´št_”r
(" Unexpectedƒnd of PS‡t start of stream\n");

99 ià(
”r
)

101 
	`´št_”r
("### Error„eading first…ack header\n");

105 ià(
¡»am_id
 != 0xba)

107 
	`´št_”r
("### Program stream does‚ot start with…ack header\n");

108 
	`åršt_”r
(" Fœ¡…ack‘ ha ¡»am id %02X (",
¡»am_id
);

109 
	`´št_¡»am_id
(
FALSE
,
¡»am_id
);

110 
	`´št_”r
(")\n");

117 
num_sy¡em_h—d”s
 = 0;

119 ià(
max
 > 0 && 
num_·cks
 >= max)

121 
	`åršt_msg
("\nStİpšg‡á” %d…acks\n",
num_·cks
);

125 
num_·cks
 ++;

126 
	`´št_msg
("[");

127 
	`fæush
(
¡dout
);

129 
”r
 = 
	`»ad_PS_·ck_h—d”_body
(
ps
,&
h—d”
);

130 ià(
”r
)

132 
	`åršt_”r
("### Error„eading data for…ack header starting‡t "

133 
OFFSET_T_FORMAT
 "\n",
po¢
);

140 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
FALSE
,&
po¢
,&
¡»am_id
);

141 ià(
”r
 =ğ
EOF
)

143 
’d_of_fe
 = 
TRUE
;

144 ià(
¡»am_id
 == 0xB9)

146 
	`´št_msg
("]");

147 
	`fæush
(
¡dout
);

151 ià(
”r
)

154 ià(
¡»am_id
 == 0xbb)

156 
	`´št_msg
("H");

157 
	`fæush
(
¡dout
);

158 
”r
 = 
	`»ad_PS_·ck‘_body
(
ps
,
¡»am_id
,&
·ck‘
);

159 ià(
”r
)

161 
	`åršt_”r
("### Error„eading system header starting‡t "

162 
OFFSET_T_FORMAT
 "\n",
po¢
);

166 
num_sy¡em_h—d”s
 ++;

171 ià(
’d_of_fe
)

177 ià(
¡»am_id
 == 0xba)

180 ià(
¡»am_id
 == 0xBC)

181 
	`´št_msg
("M");

182 ià(
¡»am_id
 == 0xFF)

183 
	`´št_msg
("D");

184 ià(
¡»am_id
 == 0xBD)

185 
	`´št_msg
("p1");

186 ià(
¡»am_id
 == 0xBE)

187 
	`´št_msg
(".");

188 ià(
¡»am_id
 == 0xBF)

189 
	`´št_msg
("p2");

190 ià(
¡»am_id
 >= 0xC0 && stream_id <=0xDF)

192 
numb”
 = 
¡»am_id
 & 0x1F;

193 ià(
numb”
 == 0)

194 
	`´št_msg
("a");

196 
	`åršt_msg
("a%x",
numb”
);

198 ià(
¡»am_id
 >= 0xE0 && stream_id <= 0xEF)

200 
numb”
 = 
¡»am_id
 & 0x0F;

201 ià(
numb”
 == 0)

202 
	`´št_msg
("v");

204 
	`åršt_msg
("v%x",
numb”
);

207 
	`´št_msg
("?");

208 
	`fæush
(
¡dout
);

210 
”r
 = 
	`»ad_PS_·ck‘_body
(
ps
,
¡»am_id
,&
·ck‘
);

211 ià(
”r
)

213 
	`åršt_”r
("### Error„eading PS…acket starting‡t "

214 
OFFSET_T_FORMAT
 "\n",
po¢
);

218 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
FALSE
,&
po¢
,&
¡»am_id
);

219 ià(
”r
 =ğ
EOF
)

221 ià(
¡»am_id
 == 0xB9)

223 
	`´št_msg
("]");

224 
	`fæush
(
¡dout
);

226 
’d_of_fe
 = 
TRUE
;

229 ià(
”r
)

233 ià(
’d_of_fe
)

237 
	`ş—r_PS_·ck‘
(&
·ck‘
);

238 
	`åršt_msg
("\nRead %d PS…acket%s in %d…ack%s\n",

239 
couÁ
,(count==1?"":"s"),

240 
num_·cks
,(num_packs==1?"":"s"));

242 
	}
}

244 
	$´št_u§ge
()

246 
	`´št_msg
(

250 
	`REPORT_VERSION
("psdots");

251 
	`´št_msg
(

266 
	}
}

268 
	$maš
(
¬gc
, **
¬gv
)

270 
u£_¡dš
 = 
FALSE
;

271 *
šput_Çme
 = 
NULL
;

272 
had_šput_Çme
 = 
FALSE
;

274 
PS_»ad”_p
 
ps
;

275 
max
 = 0;

276 
v”bo£
 = 
FALSE
;

278 
”r
 = 0;

279 
ii
 = 1;

281 ià(
¬gc
 < 2)

283 
	`´št_u§ge
();

287 
ii
 < 
¬gc
)

289 ià(
¬gv
[
ii
][0] == '-')

291 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

292 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

294 
	`´št_u§ge
();

297 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

299 
	`CHECKARG
("psdÙs",
ii
);

300 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

301 
	`»dœeù_ouut_¡d”r
();

302 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

303 
	`»dœeù_ouut_¡dout
();

306 
	`åršt_”r
("###…sdots: "

308 " '¡d”r')\n",
¬gv
[
ii
+1]);

311 
ii
++;

313 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

315 
v”bo£
 = 
TRUE
;

317 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

319 
	`CHECKARG
("psdÙs",
ii
);

320 
”r
 = 
	`št_v®ue
("psdÙs",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

321 ià(
”r
)  1;

322 
ii
++;

324 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

326 
u£_¡dš
 = 
TRUE
;

327 
had_šput_Çme
 = 
TRUE
;

331 
	`åršt_”r
("###…sdots: "

332 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

338 ià(
had_šput_Çme
)

340 
	`åršt_”r
("###…sdÙs: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

345 
šput_Çme
 = 
¬gv
[
ii
];

346 
had_šput_Çme
 = 
TRUE
;

349 
ii
++;

352 ià(!
had_šput_Çme
)

354 
	`´št_”r
("###…sdots: No input file specified\n");

359 
”r
 = 
	`İ’_PS_fe
(
šput_Çme
,
FALSE
,&
ps
);

360 ià(
”r
)

362 
	`åršt_”r
("###…sdots: Unableo open input file %s\n",

363 (
u£_¡dš
?"<¡dš>":
šput_Çme
));

366 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

368 ià(
max
)

369 
	`åršt_msg
("Stİpšg‡á” %d PS…ack‘s\n",
max
);

371 
”r
 = 
	`»pÜt_ps_dÙs
(
ps
,
max
,
v”bo£
);

372 ià(
”r
)

373 
	`´št_”r
("###…sdots: Error„eporting on input stream\n");

376 
”r
 = 
	`şo£_PS_fe
(&
ps
);

377 ià(
”r
)

379 
	`åršt_”r
("###…sdots: Error closing input file %s\n",

380 (
u£_¡dš
?"<¡dš>":
šput_Çme
));

384 
	}
}

	@psreport.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<fú.h
>

34 
	~<lim™s.h
>

36 #ifdeà
_WIN32


37 
	~<¡ddef.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"ps_âs.h
"

44 
	~"³s_âs.h
"

45 
	~"misc_âs.h
"

46 
	~"´štšg_âs.h
"

47 
	~"v”siÚ.h
"

63 
	$»pÜt_ps
(
PS_»ad”_p
 
ps
,

64 
is_dvd
,

65 
max
,

66 
v”bo£
)

68 
”r
;

69 
off£t_t
 
po¢
 = 0;

70 
by‹
 
¡»am_id
;

71 
’d_of_fe
 = 
FALSE
;

73 
PS_·ck‘
 
·ck‘
 = {0};

74 
PS_·ck_h—d”
 
h—d”
 = {0};

77 
couÁ
 = 0;

78 
num_·cks
 = 0;

79 
num_m­s
 = 0;

80 
num_dœs
 = 0;

82 
num_video
[
NUMBER_VIDEO_STREAMS
];

83 
mš_video_size
[
NUMBER_VIDEO_STREAMS
];

84 
max_video_size
[
NUMBER_VIDEO_STREAMS
];

85 
sum_video_size
[
NUMBER_VIDEO_STREAMS
];

87 
num_audio
[
NUMBER_AUDIO_STREAMS
];

88 
mš_audio_size
[
NUMBER_AUDIO_STREAMS
];

89 
max_audio_size
[
NUMBER_AUDIO_STREAMS
];

90 
sum_audio_size
[
NUMBER_AUDIO_STREAMS
];

92 
	#cPRIVATE1
 0

	)

93 
	#cPRIVATE2
 1

	)

94 
	#cPRIVATE_SIZE
 2

	)

95 
num_´iv©e
[
cPRIVATE_SIZE
] = {0, 0};

96 
mš_´iv©e_size
[
cPRIVATE_SIZE
] = {
INT_MAX
, INT_MAX};

97 
max_´iv©e_size
[
cPRIVATE_SIZE
] = {0, 0};

98 
sum_´iv©e_size
[
cPRIVATE_SIZE
] = {0, 0};

100 
	#cAC3
 0

	)

101 
	#cDTS
 1

	)

102 
	#cLPCM
 2

	)

103 
	#cSUBPICTURES
 3

	)

104 
	#cOTHER
 4

	)

108 
	#cSIZE
 5

	)

109 
	#cDEPTH
 32

	)

110 
num_Ùh”
[
cSIZE
][
cDEPTH
];

111 
mš_Ùh”_size
[
cSIZE
][
cDEPTH
];

112 
max_Ùh”_size
[
cSIZE
][
cDEPTH
];

113 
sum_Ùh”_size
[
cSIZE
][
cDEPTH
];

116 
by‹
 
ac3_bsmod
[
cDEPTH
] = {0};

117 
by‹
 
ac3_acmod
[
cDEPTH
] = {0};

119 
ii
,
jj
;

120 
jj
=0; jj<
NUMBER_VIDEO_STREAMS
; jj++)

122 
num_video
[
jj
] = 0;

123 
mš_video_size
[
jj
] = 
INT_MAX
;

124 
max_video_size
[
jj
] = 0;

125 
sum_video_size
[
jj
] = 0.0;

127 
jj
=0; jj<
NUMBER_AUDIO_STREAMS
; jj++)

129 
num_audio
[
jj
] = 0;

130 
mš_audio_size
[
jj
] = 
INT_MAX
;

131 
max_audio_size
[
jj
] = 0;

132 
sum_audio_size
[
jj
] = 0.0;

134 
ii
=0; ii<
cSIZE
; ii++)

136 
jj
=0; jj<
cDEPTH
; jj++)

138 
num_Ùh”
[
ii
][
jj
] = 0;

139 
mš_Ùh”_size
[
ii
][
jj
] = 
INT_MAX
;

140 
max_Ùh”_size
[
ii
][
jj
] = 0;

141 
sum_Ùh”_size
[
ii
][
jj
] = 0.0;

147 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
v”bo£
,&
po¢
,&
¡»am_id
);

148 ià(
”r
 =ğ
EOF
)

150 
	`´št_”r
("### Error„eading first…ack header\n");

151 
	`´št_”r
(" Unexpectedƒnd of PS‡t start of stream\n");

154 ià(
”r
)

156 
	`´št_”r
("### Error„eading first…ack header\n");

159 
couÁ
++;

161 ià(
¡»am_id
 != 0xba)

163 
	`´št_”r
("### Program stream does‚ot start with…ack header\n");

164 
	`åršt_”r
(" Fœ¡…ack‘ ha ¡»am id %02X (",
¡»am_id
);

165 
	`´št_¡»am_id
(
FALSE
,
¡»am_id
);

166 
	`´št_”r
(")\n");

173 
num_sy¡em_h—d”s
 = 0;

175 ià(
max
 > 0 && 
num_·cks
 >= max)

177 ià(
v”bo£
)

178 
	`åršt_msg
("Stİpšg‡á” %d…acks\n",
num_·cks
);

182 
num_·cks
 ++;

184 
”r
 = 
	`»ad_PS_·ck_h—d”_body
(
ps
,&
h—d”
);

185 ià(
”r
)

187 
	`åršt_”r
("### Error„eading data for…ack header starting‡t "

188 
OFFSET_T_FORMAT
 "\n",
po¢
);

189 
give_up
;

192 ià(
v”bo£
)

193 
	`åršt_msg
("\n" 
OFFSET_T_FORMAT_08


194 ": Pack h—d”: SCR " 
LLD_FORMAT
 " (" LLD_FORMAT

195 "/%dèmux„©%d\n",
po¢
,
h—d”
.
sü
,h—d”.
sü_ba£
,

196 
h—d”
.
sü_exŠ
,h—d”.
´og¿m_mux_¿‹
);

201 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
v”bo£
,&
po¢
,&
¡»am_id
);

202 ià(
”r
 =ğ
EOF
)

204 
’d_of_fe
 = 
TRUE
;

207 ià(
”r
)

208 
give_up
;

209 
couÁ
++;

211 ià(
¡»am_id
 == 0xbb)

213 
”r
 = 
	`»ad_PS_·ck‘_body
(
ps
,
¡»am_id
,&
·ck‘
);

214 ià(
”r
)

216 
	`åršt_”r
("### Error„eading system header starting‡t "

217 
OFFSET_T_FORMAT
 "\n",
po¢
);

218 
give_up
;

221 
num_sy¡em_h—d”s
 ++;

222 ià(
v”bo£
)

223 
	`åršt_msg
(
OFFSET_T_FORMAT_08
 ": System header %d\n",

224 
po¢
,
num_sy¡em_h—d”s
);

230 ià(
’d_of_fe
)

236 ià(
¡»am_id
 == 0xba)

239 
”r
 = 
	`»ad_PS_·ck‘_body
(
ps
,
¡»am_id
,&
·ck‘
);

240 ià(
”r
)

242 
	`åršt_”r
("### Error„eading PS…acket starting‡t "

243 
OFFSET_T_FORMAT
 "\n",
po¢
);

244 
give_up
;

247 ià(
v”bo£
)

249 
	`åršt_msg
(
OFFSET_T_FORMAT_08
 ": PS Packet %2d stream %02X (",

250 
po¢
,
couÁ
,
¡»am_id
);

251 
	`´št_¡»am_id
(
TRUE
,
¡»am_id
);

252 
	`´št_msg
(")\n");

253 
	`´št_d©a
(
TRUE
," Packet",

254 
·ck‘
.
d©a
,·ck‘.
d©a_Ën
,20);

256 
	`´št_’d_of_d©a
(" ",
·ck‘
.
d©a
,·ck‘.
d©a_Ën
,20);

258 ià(
	`IS_AUDIO_STREAM_ID
(
¡»am_id
è|| 
	`IS_VIDEO_STREAM_ID
(stream_id))

260 
	`»pÜt_PES_d©a_¬¿y2
(-1,
·ck‘
.
d©a
,·ck‘.
d©a_Ën
,20);

262 
	`»pÜt_PES_d©a_¬¿y
(" ",
·ck‘
.
d©a
,·ck‘.
d©a_Ën
,
TRUE
);

266 ià(
¡»am_id
 == 0xBC)

267 
num_m­s
 ++;

268 ià(
¡»am_id
 == 0xFF)

269 
num_dœs
 ++;

270 ià(
¡»am_id
 =ğ
PRIVATE1_AUDIO_STREAM_ID
)

272 
sub¡»am_šdex
;

273 
by‹
 
bsmod
, 
acmod
;

274 
wh©
 = 
	`id’tify_´iv©e1_d©a
(&
·ck‘
,
is_dvd
,
v”bo£
,

275 &
sub¡»am_šdex
,&
bsmod
,&
acmod
);

277 
num_´iv©e
[
cPRIVATE1
] ++;

278 
sum_´iv©e_size
[
cPRIVATE1
] +ğ
·ck‘
.
d©a_Ën
;

279 ià(
·ck‘
.
d©a_Ën
 > 
max_´iv©e_size
[
cPRIVATE1
])

280 
max_´iv©e_size
[
cPRIVATE1
] = 
·ck‘
.
d©a_Ën
;

281 ià(
·ck‘
.
d©a_Ën
 < 
mš_´iv©e_size
[
cPRIVATE1
])

282 
mš_´iv©e_size
[
cPRIVATE1
] = 
·ck‘
.
d©a_Ën
;

284 ià(
wh©
 !ğ
SUBSTREAM_ERROR
)

286 
šdex
;

287 ià(
sub¡»am_šdex
 < 0 || sub¡»am_šdex >ğ
cDEPTH
)

289 
	`åršt_”r
("Internalƒrror: got substream index %d"

291 
sub¡»am_šdex
,
cDEPTH
-1);

292 
sub¡»am_šdex
 = 
cDEPTH
-1;

294 
wh©
)

296 
SUBSTREAM_AC3
:

297 
šdex
 = 
cAC3
;

298 
ac3_bsmod
[
sub¡»am_šdex
] = 
bsmod
;

299 
ac3_acmod
[
sub¡»am_šdex
] = 
acmod
;

301 
SUBSTREAM_DTS
: 
šdex
 = 
cDTS
; ;

302 
SUBSTREAM_LPCM
: 
šdex
 = 
cLPCM
; ;

303 
SUBSTREAM_SUBPICTURES
: 
šdex
 = 
cSUBPICTURES
; ;

304 
SUBSTREAM_OTHER
: 
šdex
 = 
cOTHER
; ;

305 : 
	`åršt_”r
("Internalƒrror: got substream id %d"

306 " (š¡—d, couÁšg i‹m wrÚgly‡ OTHER)\n",
wh©
);

307 
šdex
 = 
cOTHER
;

310 
num_Ùh”
[
šdex
][
sub¡»am_šdex
] ++;

311 
sum_Ùh”_size
[
šdex
][
sub¡»am_šdex
] +ğ
·ck‘
.
d©a_Ën
;

312 ià(
·ck‘
.
d©a_Ën
 > 
max_Ùh”_size
[
šdex
][
sub¡»am_šdex
])

313 
max_Ùh”_size
[
šdex
][
sub¡»am_šdex
] = 
·ck‘
.
d©a_Ën
;

314 ià(
·ck‘
.
d©a_Ën
 < 
mš_Ùh”_size
[
šdex
][
sub¡»am_šdex
])

315 
mš_Ùh”_size
[
šdex
][
sub¡»am_šdex
] = 
·ck‘
.
d©a_Ën
;

318 ià(
¡»am_id
 =ğ
PRIVATE2_AUDIO_STREAM_ID
)

320 
num_´iv©e
[
cPRIVATE2
] ++;

321 
sum_´iv©e_size
[
cPRIVATE2
] +ğ
·ck‘
.
d©a_Ën
;

322 ià(
·ck‘
.
d©a_Ën
 > 
max_´iv©e_size
[
cPRIVATE2
])

323 
max_´iv©e_size
[
cPRIVATE2
] = 
·ck‘
.
d©a_Ën
;

324 ià(
·ck‘
.
d©a_Ën
 < 
mš_´iv©e_size
[
cPRIVATE2
])

325 
mš_´iv©e_size
[
cPRIVATE2
] = 
·ck‘
.
d©a_Ën
;

327 ià(
	`IS_AUDIO_STREAM_ID
(
¡»am_id
))

329 
num
 = 
¡»am_id
 & 0x1F;

330 
num_audio
[
num
] ++;

331 
sum_audio_size
[
num
] +ğ
·ck‘
.
d©a_Ën
;

332 ià(
·ck‘
.
d©a_Ën
 > 
max_audio_size
[
num
])

333 
max_audio_size
[
num
] = 
·ck‘
.
d©a_Ën
;

334 ià(
·ck‘
.
d©a_Ën
 < 
mš_audio_size
[
num
])

335 
mš_audio_size
[
num
] = 
·ck‘
.
d©a_Ën
;

337 ià(
	`IS_VIDEO_STREAM_ID
(
¡»am_id
))

339 
num
 = 
¡»am_id
 & 0x0F;

340 
num_video
[
num
] ++;

341 
sum_video_size
[
num
] +ğ
·ck‘
.
d©a_Ën
;

342 ià(
·ck‘
.
d©a_Ën
 > 
max_video_size
[
num
])

343 
max_video_size
[
num
] = 
·ck‘
.
d©a_Ën
;

344 ià(
·ck‘
.
d©a_Ën
 < 
mš_video_size
[
num
])

345 
mš_video_size
[
num
] = 
·ck‘
.
d©a_Ën
;

347 
”r
 = 
	`»ad_PS_·ck‘_¡¬t
(
ps
,
v”bo£
,&
po¢
,&
¡»am_id
);

348 ià(
”r
 =ğ
EOF
)

350 
’d_of_fe
 = 
TRUE
;

353 ià(
”r
)

354 
give_up
;

355 
couÁ
++;

357 ià(
’d_of_fe
)

361 
give_up
:

362 
	`ş—r_PS_·ck‘
(&
·ck‘
);

365 
ii
;

366 
	`åršt_msg
("Pack‘ ÑÙ®): %8d\n",
couÁ
);

367 
	`åršt_msg
("Packs: %8d\n",
num_·cks
);

368 
ii
=0; ii<
NUMBER_VIDEO_STREAMS
; ii++)

369 ià(
num_video
[
ii
] > 0)

371 
	`åršt_msg
("VideØ·ck‘ (¡»am %2d): %8d",
ii
,
num_video
[ii]);

372 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

373 
mš_video_size
[
ii
],
max_video_size
[ii],

374 
sum_video_size
[
ii
]/
num_video
[ii]);

376 
ii
=0; ii<
NUMBER_AUDIO_STREAMS
; ii++)

377 ià(
num_audio
[
ii
] > 0)

379 
	`åršt_msg
("AudiØ·ck‘ (¡»am %2d): %8d",
ii
,
num_audio
[ii]);

380 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

381 
mš_audio_size
[
ii
],
max_audio_size
[ii],

382 
sum_audio_size
[
ii
]/
num_audio
[ii]);

384 ià(
num_´iv©e
[
cPRIVATE1
] > 0)

386 
ii
;

387 
	`åršt_msg
("Priv©e1…ack‘s: %8d",
num_´iv©e
[
cPRIVATE1
]);

388 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

389 
mš_´iv©e_size
[
cPRIVATE1
],
max_´iv©e_size
[cPRIVATE1],

390 
sum_´iv©e_size
[
cPRIVATE1
]/
num_´iv©e
[cPRIVATE1]);

391 
ii
=0; ii<
cDEPTH
; ii++)

393 ià(
num_Ùh”
[
cAC3
][
ii
] > 0)

395 
	`åršt_msg
(" AC3, index %2d: %8d",
ii
,
num_Ùh”
[
cAC3
][ii]);

396 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

397 
mš_Ùh”_size
[
cAC3
][
ii
],
max_Ùh”_size
[cAC3][ii],

398 
sum_Ùh”_size
[
cAC3
][
ii
]/
num_Ùh”
[cAC3][ii]);

399 
	`åršt_msg
(" %s\n",

400 
	`BSMOD_STR
(
ac3_bsmod
[
ii
],
ac3_acmod
[ii]));

401 
	`åršt_msg
("‡udio coding mode %s\n",

402 
	`ACMOD_STR
(
ac3_acmod
[
ii
]));

405 
ii
=0; ii<
cDEPTH
; ii++)

407 ià(
num_Ùh”
[
cDTS
][
ii
] > 0)

409 
	`åršt_msg
(" DTS, index %2d: %8d",
ii
,
num_Ùh”
[
cDTS
][ii]);

410 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

411 
mš_Ùh”_size
[
cDTS
][
ii
],
max_Ùh”_size
[cDTS][ii],

412 
sum_Ùh”_size
[
cDTS
][
ii
]/
num_Ùh”
[cDTS][ii]);

415 
ii
=0; ii<
cDEPTH
; ii++)

417 ià(
num_Ùh”
[
cLPCM
][
ii
] > 0)

419 
	`åršt_msg
(" LPCM, index %2d: %8d",
ii
,
num_Ùh”
[
cLPCM
][ii]);

420 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

421 
mš_Ùh”_size
[
cLPCM
][
ii
],
max_Ùh”_size
[cLPCM][ii],

422 
sum_Ùh”_size
[
cLPCM
][
ii
]/
num_Ùh”
[cLPCM][ii]);

425 
ii
=0; ii<
cDEPTH
; ii++)

427 ià(
num_Ùh”
[
cSUBPICTURES
][
ii
] > 0)

429 
	`åršt_msg
(" SUBPICTURES, index %2d: %8d",
ii
,
num_Ùh”
[
cSUBPICTURES
][ii]);

430 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

431 
mš_Ùh”_size
[
cSUBPICTURES
][
ii
],
max_Ùh”_size
[cSUBPICTURES][ii],

432 
sum_Ùh”_size
[
cSUBPICTURES
][
ii
]/
num_Ùh”
[cSUBPICTURES][ii]);

435 
ii
=0; ii<
cDEPTH
; ii++)

437 ià(
num_Ùh”
[
cOTHER
][
ii
] > 0)

439 
	`åršt_msg
(" OTHER, index %2d: %8d",
ii
,
num_Ùh”
[
cOTHER
][ii]);

440 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

441 
mš_Ùh”_size
[
cOTHER
][
ii
],
max_Ùh”_size
[cOTHER][ii],

442 
sum_Ùh”_size
[
cOTHER
][
ii
]/
num_Ùh”
[cOTHER][ii]);

446 ià(
num_´iv©e
[
cPRIVATE2
] > 0)

448 
	`åršt_msg
("Priv©e2…ack‘s: %8d",
num_´iv©e
[
cPRIVATE2
]);

449 
	`åršt_msg
(" min size %5d, max size %5d, mean size %7.1f\n",

450 
mš_´iv©e_size
[
cPRIVATE2
],
max_´iv©e_size
[cPRIVATE2],

451 
sum_´iv©e_size
[
cPRIVATE2
]/
num_´iv©e
[cPRIVATE2]);

453 
	`åršt_msg
("Prog¿m sŒ—m m­s: %8d\n",
num_m­s
);

454 
	`åršt_msg
("Prog¿m sŒ—m dœeùÜ›s: %8d\n",
num_m­s
);

457 
	}
}

459 
	$´št_u§ge
()

461 
	`´št_msg
(

465 
	`REPORT_VERSION
("psreport");

466 
	`´št_msg
(

485 
	}
}

487 
	$maš
(
¬gc
, **
¬gv
)

489 
u£_¡dš
 = 
FALSE
;

490 *
šput_Çme
 = 
NULL
;

491 
had_šput_Çme
 = 
FALSE
;

493 
PS_»ad”_p
 
ps
;

494 
max
 = 0;

495 
v”bo£
 = 
FALSE
;

496 
is_dvd
 = 
TRUE
;

498 
”r
 = 0;

499 
ii
 = 1;

501 ià(
¬gc
 < 2)

503 
	`´št_u§ge
();

507 
ii
 < 
¬gc
)

509 ià(
¬gv
[
ii
][0] == '-')

511 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

512 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

514 
	`´št_u§ge
();

517 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

519 
	`CHECKARG
("p¤•Üt",
ii
);

520 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

521 
	`»dœeù_ouut_¡d”r
();

522 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

523 
	`»dœeù_ouut_¡dout
();

526 
	`åršt_”r
("###…sreport: "

528 " '¡d”r')\n",
¬gv
[
ii
+1]);

531 
ii
++;

533 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

535 
v”bo£
 = 
TRUE
;

537 ià(!
	`¡rcmp
("-dvd",
¬gv
[
ii
]))

539 
is_dvd
 = 
TRUE
;

541 ià(!
	`¡rcmp
("-nÙdvd",
¬gv
[
ii
]) || !strcmp("-nodvd",argv[ii]))

543 
is_dvd
 = 
FALSE
;

545 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

547 
	`CHECKARG
("p¤•Üt",
ii
);

548 
”r
 = 
	`št_v®ue
("p¤•Üt",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

549 ià(
”r
)  1;

550 
ii
++;

552 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

554 
u£_¡dš
 = 
TRUE
;

555 
had_šput_Çme
 = 
TRUE
;

559 
	`åršt_”r
("###…sreport: "

560 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

566 ià(
had_šput_Çme
)

568 
	`åršt_”r
("###…¤•Üt: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

573 
šput_Çme
 = 
¬gv
[
ii
];

574 
had_šput_Çme
 = 
TRUE
;

577 
ii
++;

580 ià(!
had_šput_Çme
)

582 
	`´št_”r
("###…sreport: No input file specified\n");

586 
”r
 = 
	`İ’_PS_fe
(
šput_Çme
,
FALSE
,&
ps
);

587 ià(
”r
)

589 
	`åršt_”r
("###…sreport: Unableo open input file %s\n",

590 (
u£_¡dš
?"<¡dš>":
šput_Çme
));

593 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

594 ià(
is_dvd
)

595 
	`´št_msg
("Assuming data is from‡ DVD\n");

597 
	`´št_msg
("Assuming data is NOT from‡ DVD\n");

599 ià(
max
)

600 
	`åršt_msg
("Stİpšg‡á” %d PS…ack‘s\n",
max
);

602 
”r
 = 
	`»pÜt_ps
(
ps
,
is_dvd
,
max
,
v”bo£
);

603 ià(
”r
)

604 
	`´št_”r
("###…sreport: Error„eporting on input stream\n");

606 
”r
 = 
	`şo£_PS_fe
(&
ps
);

607 ià(
”r
)

609 
	`åršt_”r
("###…sreport: Error closing input file %s\n",

610 (
u£_¡dš
?"<¡dš>":
šput_Çme
));

614 
	}
}

	@reverse.c

49 
	~<¡dio.h
>

50 
	~<¡dlib.h
>

51 
	~<¡ršg.h
>

52 
	~<”ºo.h
>

54 
	~<time.h
>

56 
	~"com·t.h
"

57 
	~"misc_deâs.h
"

58 
	~"´štšg_âs.h
"

59 
	~"es_âs.h
"

60 
	~"h262_âs.h
"

61 
	~"Çlun™_âs.h
"

62 
	~"acûssun™_âs.h
"

63 
	~"ts_âs.h
"

64 
	~"tswr™e_âs.h
"

65 
	~"»v”£_âs.h
"

67 
	#DEBUG
 0

	)

72 
	#SEQUENCE_HEADER_ENTRY
(
»v
,
idx
è(!Ôev)->
is_h264
 && \

73 (
»v
)->
£q_off£t
[
idx
] =ğ0)

	)

96 
	$bud_»v”£_d©a
(
»v”£_d©a_p
 *
»v”£_d©a
,

97 
is_h264
)

99 
Ãwsize
 = 
REVERSE_ARRAY_START_SIZE
;

100 
»v”£_d©a_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_REVERSE_DATA
);

101 ià(
Ãw
 =ğ
NULL
)

103 
	`´št_”r
("### Unableo‡llocate„everse data datastructure\n");

107 
Ãw
->
¡¬t_fe
 = 
	`m®loc
(
Ãwsize
*(
off£t_t
));

108 ià(
Ãw
->
¡¬t_fe
 =ğ
NULL
)

110 
	`´št_”r
("### Unableo‡llocate„everse data‡rray (start_file)\n");

111 
	`ä“
(
Ãw
);

115 
Ãw
->
¡¬t_pkt
 = 
	`m®loc
(
Ãwsize
*(
št32_t
));

116 ià(
Ãw
->
¡¬t_pkt
 =ğ
NULL
)

118 
	`´št_”r
("### Unableo‡llocate„everse data‡rray (start_pkt)\n");

119 
	`ä“
(
Ãw
->
¡¬t_fe
);

120 
	`ä“
(
Ãw
);

124 
Ãw
->
šdex
 = 
	`m®loc
(
Ãwsize
*(
ušt32_t
));

125 ià(
Ãw
->
šdex
 =ğ
NULL
)

127 
	`´št_”r
("### Unableo‡llocate„everse data‡rray (index)\n");

128 
	`ä“
(
Ãw
->
¡¬t_fe
);

129 
	`ä“
(
Ãw
->
¡¬t_pkt
);

130 
	`ä“
(
Ãw
);

133 
Ãw
->
d©a_Ën
 = 
	`m®loc
(
Ãwsize
*(
št32_t
));

134 ià(
Ãw
->
d©a_Ën
 =ğ
NULL
)

136 
	`´št_”r
("### Unableo‡llocate„everse data‡rray (data_len)\n");

137 
	`ä“
(
Ãw
->
¡¬t_fe
);

138 
	`ä“
(
Ãw
->
¡¬t_pkt
);

139 
	`ä“
(
Ãw
->
šdex
);

140 
	`ä“
(
Ãw
);

144 ià(
is_h264
)

146 
Ãw
->
£q_off£t
 = 
NULL
;

147 
Ãw
->
afd_by‹
 = 
NULL
;

151 
Ãw
->
£q_off£t
 = 
	`m®loc
(
Ãwsize
);

152 ià(
Ãw
->
£q_off£t
 =ğ
NULL
)

154 
	`´št_”r
("### Unableo‡llocate„everse data‡rray (seq offset)\n");

155 
	`ä“
(
Ãw
->
¡¬t_fe
);

156 
	`ä“
(
Ãw
->
¡¬t_pkt
);

157 
	`ä“
(
Ãw
->
šdex
);

158 
	`ä“
(
Ãw
->
d©a_Ën
);

159 
	`ä“
(
Ãw
);

162 
Ãw
->
afd_by‹
 = 
	`m®loc
(
Ãwsize
);

163 ià(
Ãw
->
afd_by‹
 =ğ
NULL
)

165 
	`´št_”r
("### Unableo‡llocate„everse data‡rray (AFD)\n");

166 
	`ä“
(
Ãw
->
£q_off£t
);

167 
	`ä“
(
Ãw
->
¡¬t_fe
);

168 
	`ä“
(
Ãw
->
¡¬t_pkt
);

169 
	`ä“
(
Ãw
->
šdex
);

170 
	`ä“
(
Ãw
->
d©a_Ën
);

171 
	`ä“
(
Ãw
);

175 
Ãw
->
size
 = 
Ãwsize
;

176 
Ãw
->
Ëngth
 = 0;

177 
Ãw
->
num_piùu»s
 = 0;

179 
Ãw
->
is_h264
 = is_h264;

180 
Ãw
->
piùu»s_wr™‹n
 = 0;

181 
Ãw
->
piùu»s_k•t
 = 0;

182 
Ãw
->
fœ¡_wr™‹n
 = 0;

183 
Ãw
->
Ï¡_wr™‹n
 = 0;

184 
Ãw
->
Ï¡_po¢_added
 = 0;

185 
Ãw
->
ouut_£qu’û_h—d”s
 = !
is_h264
;

187 
Ãw
->
pid
 = 
DEFAULT_VIDEO_PID
;

188 
Ãw
->
¡»am_id
 = 
DEFAULT_VIDEO_STREAM_ID
;

190 *
»v”£_d©a
 = 
Ãw
;

192 
	}
}

201 
	$£t_»v”£_pid
(
»v”£_d©a_p
 
»v”£_d©a
,

202 
ušt32_t
 
pid
,

203 
by‹
 
¡»am_id
)

205 
»v”£_d©a
->
pid
 =…id;

206 
»v”£_d©a
->
¡»am_id
 = stream_id;

207 
	}
}

216 
	$add_h262_»v”£_cÚ‹xt
(
h262_cÚ‹xt_p
 
h262
,

217 
»v”£_d©a_p
 
»v”£_d©a
)

219 ià(
»v”£_d©a
->
is_h264
)

221 
	`´št_”r
("### Cannot‡dd‡n H.262 contexto‡n H.264„everse data"

225 
h262
->
»v”£_d©a
 =„everse_data;

226 
»v”£_d©a
->
h262
 = h262;

228 
	}
}

237 
	$add_acûss_un™_»v”£_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

238 
»v”£_d©a_p
 
»v”£_d©a
)

240 ià(!
»v”£_d©a
->
is_h264
)

242 
	`´št_”r
("### Cannot‡dd‡n H.264‡ccess unit contexto‡n"

246 
cÚ‹xt
->
»v”£_d©a
 =„everse_data;

247 
»v”£_d©a
->
h264
 = 
cÚ‹xt
;

249 
	}
}

256 
	$ä“_»v”£_d©a
(
»v”£_d©a_p
 *
»v”£_d©a
)

258 
»v”£_d©a_p
 
this
 = *
»v”£_d©a
;

260 ià(
this
 =ğ
NULL
)

263 ià(
this
->
£q_off£t
 !ğ
NULL
)

265 
	`ä“
(
this
->
£q_off£t
);

266 
this
->
£q_off£t
 = 
NULL
;

268 
	`ä“
(
this
->
šdex
);

269 
	`ä“
(
this
->
¡¬t_fe
);

270 
	`ä“
(
this
->
¡¬t_pkt
);

271 
	`ä“
(
this
->
d©a_Ën
);

272 
this
->
šdex
 = 
NULL
;

273 
this
->
¡¬t_fe
 = 
NULL
;

274 
this
->
¡¬t_pkt
 = 
NULL
;

275 
this
->
d©a_Ën
 = 
NULL
;

276 
this
->
Ëngth
 =his->
size
 = 0;

277 
	`ä“
(
this
);

278 *
»v”£_d©a
 = 
NULL
;

279 
	}
}

288 
šlše
 
	$cmp_off£ts
(
ES_off£t
 
off£t1
,

289 
off£t_t
 
fe_po¢2
,

290 
št32_t
 
pkt_po¢2
)

292 ià(
off£t1
.
šfe
 < 
fe_po¢2
)

294 ià(
off£t1
.
šfe
 > 
fe_po¢2
)

296 ià(
off£t1
.
š·ck‘
 < 
pkt_po¢2
)

298 ià(
off£t1
.
š·ck‘
 > 
pkt_po¢2
)

302 
	}
}

304 
	$debug_»v”£_d©a_´obËm
(
»v”£_d©a_p
 
»v”£_d©a
,

305 
ušt32_t
 
šdex
,

306 
ES_off£t
 
¡¬t_po¢
,

307 
ušt32_t
 
idx
)

309 
FILE
 *
‹mpfe
;

310 *
‹mpf’ame
 = "tsserve_reverse_problem.txt";

311 
ii
;

313 
‹mpfe
 = 
	`fİ’
(
‹mpf’ame
,"a+");

314 ià(
‹mpfe
 =ğ
NULL
)

316 
	`åršt_”r
("### Unableo open file %s - writing diagnostics"

317 "Ø¡d”¸š¡—d\n",
‹mpf’ame
);

318 
‹mpfe
 = 
¡d”r
;

322 
time_t
 
now
;

323 
	`åršt_”r
("### Aµ’dšg dŸgno¡ic tØf%s\n",
‹mpf’ame
);

324 
now
 = 
	`time
(
NULL
);

325 
	`årštf
(
‹mpfe
,"** %s:\n",
	`ùime
(&
now
));

328 
	`årštf
(
‹mpfe
,"TryšgØadd„ev”£ d©¨[%d] " 
OFFSET_T_FORMAT


330 
OFFSET_T_FORMAT
 "/%d\n",

331 
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
idx
,

332 
»v”£_d©a
->
šdex
[
idx
],»v”£_d©a->
¡¬t_fe
[idx],

333 
»v”£_d©a
->
¡¬t_pkt
[
idx
]);

334 
	`årštf
(
‹mpfe
,"Last…osn‡dded %d,†ength %d, index %d\n",

335 
»v”£_d©a
->
Ï¡_po¢_added
,»v”£_d©a->
Ëngth
,
šdex
);

336 
ii
=0; ii<
»v”£_d©a
->
Ëngth
; ii++)

337 ià(
»v”£_d©a
->
is_h264
 ||„ev”£_d©a->
£q_off£t
[
ii
])

338 
	`årštf
(
‹mpfe
," %3d: %4d‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

339 
ii
,
»v”£_d©a
->
šdex
[ii],

340 
»v”£_d©a
->
¡¬t_fe
[
ii
],

341 
»v”£_d©a
->
¡¬t_pkt
[
ii
],

342 
»v”£_d©a
->
d©a_Ën
[
ii
]);

344 
	`årštf
(
‹mpfe
," %3d: seqh‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

345 
ii
,

346 
»v”£_d©a
->
¡¬t_fe
[
ii
],

347 
»v”£_d©a
->
¡¬t_pkt
[
ii
],

348 
»v”£_d©a
->
d©a_Ën
[
ii
]);

349 ià(
‹mpfe
 !ğ
¡d”r
)

351 
	`årštf
(
‹mpfe
,"\n\n");

352 
	`fşo£
(
‹mpfe
);

354 
	}
}

374 
	$»memb”_»v”£_h262_d©a
(
»v”£_d©a_p
 
»v”£_d©a
,

375 
ušt32_t
 
šdex
,

376 
ES_off£t
 
¡¬t_po¢
,

377 
ušt32_t
 
Ëngth
,

378 
by‹
 
£q_off£t
,

379 
by‹
 
afd
)

381 ià(
»v”£_d©a
->
Ëngth
 > 0 &&

382 (
»v”£_d©a
->
Ï¡_po¢_added
 + 1è< (
ušt32_t
ìev”£_d©a->
Ëngth
)

388 
idx
 = 
»v”£_d©a
->
Ï¡_po¢_added
 + 1;

389 
cmp
 = 
	`cmp_off£ts
(
¡¬t_po¢
,

390 
»v”£_d©a
->
¡¬t_fe
[
idx
],

391 
»v”£_d©a
->
¡¬t_pkt
[
idx
]);

392 ià(
cmp
 == 0)

394 #ià
DEBUG


395 
	`åršt_msg
("++ Added [%d] " 
OFFSET_T_FORMAT
 "/%d‡gain\n",

396 
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
);

398 
»v”£_d©a
->
Ï¡_po¢_added
 ++;

403 
	`åršt_”r
("### TryšgØadd„ev”£ d©¨[%d] " 
OFFSET_T_FORMAT


405 
OFFSET_T_FORMAT
 "/%d\n",

406 
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
idx
,

407 
»v”£_d©a
->
šdex
[
idx
],»v”£_d©a->
¡¬t_fe
[idx],

408 
»v”£_d©a
->
¡¬t_pkt
[
idx
]);

409 
	`debug_»v”£_d©a_´obËm
(
»v”£_d©a
,
šdex
,
¡¬t_po¢
,
idx
);

414 ià(
»v”£_d©a
->
size
 =ğ»v”£_d©a->
Ëngth
)

416 
Ãwsize
 = 
»v”£_d©a
->
size
 + 
REVERSE_ARRAY_INCREMENT_SIZE
;

417 
»v”£_d©a
->
šdex
 = 
	`»®loc
(reverse_data->index,

418 
Ãwsize
*(
ušt32_t
));

419 ià(
»v”£_d©a
->
šdex
 =ğ
NULL
)

421 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (index)\n");

424 
»v”£_d©a
->
¡¬t_fe
 = 
	`»®loc
(reverse_data->start_file,

425 
Ãwsize
*(
off£t_t
));

426 ià(
»v”£_d©a
->
¡¬t_fe
 =ğ
NULL
)

428 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (start_file)\n");

431 
»v”£_d©a
->
¡¬t_pkt
 = 
	`»®loc
(reverse_data->start_pkt,

432 
Ãwsize
*(
št32_t
));

433 ià(
»v”£_d©a
->
¡¬t_pkt
 =ğ
NULL
)

435 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (start_pkt)\n");

438 
»v”£_d©a
->
d©a_Ën
 = 
	`»®loc
(reverse_data->data_len,

439 
Ãwsize
*(
št32_t
));

440 ià(
»v”£_d©a
->
d©a_Ën
 =ğ
NULL
)

442 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (length)\n");

446 ià(!
»v”£_d©a
->
is_h264
)

448 
»v”£_d©a
->
£q_off£t
 = 
	`»®loc
Ôev”£_d©a->£q_off£t,
Ãwsize
);

449 ià(
»v”£_d©a
->
£q_off£t
 =ğ
NULL
)

451 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (seq offset)\n");

454 
»v”£_d©a
->
afd_by‹
 = 
	`»®loc
Ôev”£_d©a->afd_by‹,
Ãwsize
);

455 ià(
»v”£_d©a
->
afd_by‹
 =ğ
NULL
)

457 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (AFD)\n");

461 
»v”£_d©a
->
size
 = 
Ãwsize
;

465 ià(
£q_off£t
 != 0)

467 
»v”£_d©a
->
num_piùu»s
 ++;

468 
»v”£_d©a
->
šdex
[»v”£_d©a->
Ëngth
] = index;

469 
»v”£_d©a
->
£q_off£t
[»v”£_d©a->
Ëngth
] = seq_offset;

470 
»v”£_d©a
->
afd_by‹
[»v”£_d©a->
Ëngth
] = 
afd
;

474 
»v”£_d©a
->
šdex
[»v”£_d©a->
Ëngth
] = 0;

475 
»v”£_d©a
->
£q_off£t
[»v”£_d©a->
Ëngth
] = 0;

476 
»v”£_d©a
->
afd_by‹
[»v”£_d©a->
Ëngth
] = 0;

479 
»v”£_d©a
->
¡¬t_fe
[»v”£_d©a->
Ëngth
] = 
¡¬t_po¢
.
šfe
;

480 
»v”£_d©a
->
¡¬t_pkt
[»v”£_d©a->
Ëngth
] = 
¡¬t_po¢
.
š·ck‘
;

481 
»v”£_d©a
->
d©a_Ën
[»v”£_d©a->
Ëngth
] =†ength;

483 
»v”£_d©a
->
Ï¡_po¢_added
 =„ev”£_d©a->
Ëngth
;

484 
»v”£_d©a
->
Ëngth
 ++;

486 
	}
}

502 
	$»memb”_»v”£_h264_d©a
(
»v”£_d©a_p
 
»v”£_d©a
,

503 
ušt32_t
 
šdex
,

504 
ES_off£t
 
¡¬t_po¢
,

505 
ušt32_t
 
Ëngth
)

507 ià(
»v”£_d©a
->
Ëngth
 > 0 &&

508 (
»v”£_d©a
->
Ï¡_po¢_added
 + 1è< (
ušt32_t
ìev”£_d©a->
Ëngth
)

514 
idx
 = 
»v”£_d©a
->
Ï¡_po¢_added
 + 1;

515 
cmp
 = 
	`cmp_off£ts
(
¡¬t_po¢
,

516 
»v”£_d©a
->
¡¬t_fe
[
idx
],

517 
»v”£_d©a
->
¡¬t_pkt
[
idx
]);

518 ià(
cmp
 == 0)

520 #ià
DEBUG


521 
	`åršt_msg
("++ Added [%d] " 
OFFSET_T_FORMAT
 "/%d‡gain\n",

522 
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
);

524 
»v”£_d©a
->
Ï¡_po¢_added
 ++;

529 
	`åršt_”r
("### TryšgØadd„ev”£ d©¨[%d] " 
OFFSET_T_FORMAT


531 
OFFSET_T_FORMAT
 "/%d\n",

532 
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
idx
,

533 
»v”£_d©a
->
šdex
[
idx
],»v”£_d©a->
¡¬t_fe
[idx],

534 
»v”£_d©a
->
¡¬t_pkt
[
idx
]);

535 
	`debug_»v”£_d©a_´obËm
(
»v”£_d©a
,
šdex
,
¡¬t_po¢
,
idx
);

540 ià(
»v”£_d©a
->
size
 =ğ»v”£_d©a->
Ëngth
)

542 
Ãwsize
 = 
»v”£_d©a
->
size
 + 
REVERSE_ARRAY_INCREMENT_SIZE
;

543 
»v”£_d©a
->
šdex
 = 
	`»®loc
(reverse_data->index,

544 
Ãwsize
*(
ušt32_t
));

545 ià(
»v”£_d©a
->
šdex
 =ğ
NULL
)

547 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (index)\n");

550 
»v”£_d©a
->
¡¬t_fe
 = 
	`»®loc
(reverse_data->start_file,

551 
Ãwsize
*(
off£t_t
));

552 ià(
»v”£_d©a
->
¡¬t_fe
 =ğ
NULL
)

554 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (start_file)\n");

557 
»v”£_d©a
->
¡¬t_pkt
 = 
	`»®loc
(reverse_data->start_pkt,

558 
Ãwsize
*(
št32_t
));

559 ià(
»v”£_d©a
->
¡¬t_pkt
 =ğ
NULL
)

561 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (start_pkt)\n");

564 
»v”£_d©a
->
d©a_Ën
 = 
	`»®loc
(reverse_data->data_len,

565 
Ãwsize
*(
št32_t
));

566 ià(
»v”£_d©a
->
d©a_Ën
 =ğ
NULL
)

568 
	`´št_”r
("### Unableoƒxtend„everse data‡rray (length)\n");

571 
»v”£_d©a
->
size
 = 
Ãwsize
;

574 
»v”£_d©a
->
num_piùu»s
 ++;

575 
»v”£_d©a
->
šdex
[»v”£_d©a->
Ëngth
] = index;

576 
»v”£_d©a
->
¡¬t_fe
[»v”£_d©a->
Ëngth
] = 
¡¬t_po¢
.
šfe
;

577 
»v”£_d©a
->
¡¬t_pkt
[»v”£_d©a->
Ëngth
] = 
¡¬t_po¢
.
š·ck‘
;

578 
»v”£_d©a
->
d©a_Ën
[»v”£_d©a->
Ëngth
] =†ength;

580 
»v”£_d©a
->
Ï¡_po¢_added
 =„ev”£_d©a->
Ëngth
;

581 
»v”£_d©a
->
Ëngth
 ++;

583 
	}
}

616 
	$g‘_»v”£_d©a
(
»v”£_d©a_p
 
»v”£_d©a
,

617 
which
,

618 
ušt32_t
 *
šdex
,

619 
ES_off£t
 *
¡¬t_po¢
,

620 
ušt32_t
 *
Ëngth
,

621 
by‹
 *
£q_off£t
,

622 
by‹
 *
afd
)

624 ià(
which
 >ğ
»v”£_d©a
->
Ëngth
 || which < 0)

626 
	`åršt_”r
("Requested„everse data index (%d) is out of„ange 0-%d\n",

627 
which
,
»v”£_d©a
->
Ëngth
-1);

631 ià(
šdex
 !ğ
NULL
)

632 *
šdex
 = 
»v”£_d©a
->šdex[
which
];

633 
¡¬t_po¢
->
šfe
 = 
»v”£_d©a
->
¡¬t_fe
[
which
];

634 
¡¬t_po¢
->
š·ck‘
 = 
»v”£_d©a
->
¡¬t_pkt
[
which
];

635 *
Ëngth
 = 
»v”£_d©a
->
d©a_Ën
[
which
];

636 ià(
£q_off£t
 !ğ
NULL
)

638 ià(
»v”£_d©a
->
is_h264
)

639 *
£q_off£t
 = 0;

641 *
£q_off£t
 = 
»v”£_d©a
->£q_off£t[
which
];

643 ià(
afd
 !ğ
NULL
)

645 ià(
»v”£_d©a
->
is_h264
)

646 *
afd
 = 0;

648 *
afd
 = 
»v”£_d©a
->
afd_by‹
[
which
];

651 
	}
}

670 
	$cŞËù_»v”£_h262
(
h262_cÚ‹xt_p
 
h262
,

671 
max
,

672 
v”bo£
,

673 
qu›t
)

675 
”r
 = 0;

677 
piùu»_couÁ
 = 0;

679 ià(
h262
->
»v”£_d©a
 =ğ
NULL
)

681 
	`´št_”r
("### Unableo collect„everse data for H.262…ictures\n");

682 
	`´št_”r
(" H.262 context does‚ot have„everse data"

689 
h262_piùu»_p
 
piùu»
 = 
NULL
;

691 ià(
	`es_commªd_chªged
(
h262
->
es
))

692  
COMMAND_RETURN_CODE
;

694 
”r
 = 
	`g‘_Ãxt_h262_äame
(
h262
,
v”bo£
,
qu›t
,&
piùu»
);

695 ià(
”r
 =ğ
EOF
)

696  
EOF
;

697 ià(
”r
)

700 ià(
piùu»
->
is_piùu»
)

701 
piùu»_couÁ
 ++;

703 
	`ä“_h262_piùu»
(&
piùu»
);

704 ià(
max
 > 0 && 
piùu»_couÁ
 >= max)

708 
	}
}

725 
	$cŞËù_»v”£_acûss_un™s
(
acûss_un™_cÚ‹xt_p
 
acÚ‹xt
,

726 
max
,

727 
v”bo£
,

728 
qu›t
)

730 
”r
 = 0;

731 
acûss_un™_couÁ
 = 0;

733 ià(
acÚ‹xt
->
»v”£_d©a
 =ğ
NULL
)

735 
	`´št_”r
("### Unableo collect„everse data for‡ccess units\n");

736 
	`´št_”r
(" Access unit context does‚ot have„everse data"

743 
acûss_un™_p
 
acûss_un™
;

745 ià(
	`es_commªd_chªged
(
acÚ‹xt
->
Çc
->
es
))

746  
COMMAND_RETURN_CODE
;

748 ià(
v”bo£
)

749 
	`´št_msg
("\n");

751 
”r
 = 
	`g‘_Ãxt_h264_äame
(
acÚ‹xt
,
qu›t
,
v”bo£
,&
acûss_un™
);

752 ià(
”r
 =ğ
EOF
)

753  
EOF
;

754 ià(
”r
)

757 
acûss_un™_couÁ
 ++;

759 
	`ä“_acûss_un™
(&
acûss_un™
);

761 ià(!
v”bo£
 && !
qu›t
 && (
acûss_un™_couÁ
 % 5000 == 0))

762 
	`åršt_msg
("Scanned %d NAL units in %d frames,"

764 
acÚ‹xt
->
Çc
->
couÁ
,
acûss_un™_couÁ
,

765 
acÚ‹xt
->
»v”£_d©a
->
Ëngth
);

768 ià(
acÚ‹xt
->
’d_of_¡»am
)

770 ià(!
qu›t
è
	`´št_msg
("Found End-of-stream NAL unit\n");

774 ià(
max
 > 0 && 
acûss_un™_couÁ
 >= max)

776 ià(
v”bo£
)

777 
	`åršt_msg
("\nStopping because %d frames have been„ead\n",

778 
acûss_un™_couÁ
);

783 
	}
}

794 
	$wr™e_·ck‘_d©a
(
WRITER
 
ouut
,

795 
as_TS
,

796 
by‹
 
d©a
[],

797 
d©a_Ën
,

798 
ušt32_t
 
pid
,

799 
by‹
 
¡»am_id
)

801 
”r
;

802 ià(
as_TS
)

810 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
.
ts_ouut
,
d©a
,
d©a_Ën
,

811 
pid
,
¡»am_id
);

812 ià(
”r
)

814 
	`´št_”r
("### Error writing data‡s TS PES…acket\n");

821 
size_t
 
wr™‹n
 = 
	`fwr™e
(
d©a
,1,
d©a_Ën
,
ouut
.
es_ouut
);

822 ià(
wr™‹n
 !ğ
d©a_Ën
)

824 
	`åršt_”r
("### Error writing out data: %s\n"

826 
	`¡»¼Ü
(
”ºo
),()
wr™‹n
,
d©a_Ën
);

831 
	}
}

836 
	$wr™e_piùu»_d©a
(
WRITER
 
ouut
,

837 
as_TS
,

838 
h262_piùu»_p
 
piùu»
,

839 
ušt32_t
 
pid
)

841 
”r
;

842 ià(
as_TS
)

844 
”r
 = 
	`wr™e_h262_piùu»_as_TS
(
ouut
.
ts_ouut
,
piùu»
,
pid
);

845 ià(
”r
)

847 
	`´št_”r
("### Error writing data‡s TS PES…acket\n");

853 
”r
 = 
	`wr™e_h262_piùu»_as_ES
(
ouut
.
es_ouut
,
piùu»
);

854 ià(
”r
)

856 
	`´št_”r
("### Error writing data‡s ES\n");

861 
	}
}

872 
	$»ad_h262_piùu»
(
h262_cÚ‹xt_p
 
cÚ‹xt
,

873 
ES_off£t
 
wh”e
,

874 
by‹
 
afd
,

875 
v”bo£
,

876 
h262_piùu»_p
 *
piùu»
)

878 
”r
;

879 
»v”£_d©a_p
 
»v”£_d©a
 = 
NULL
;

883 ià(
cÚ‹xt
->
Ï¡_™em
)

884 
	`ä“_h262_™em
(&
cÚ‹xt
->
Ï¡_™em
);

886 
”r
 = 
	`£ek_ES
(
cÚ‹xt
->
es
,
wh”e
);

887 ià(
”r
)

889 
	`´št_”r
("### Error seeking for H.262…ictureo„everse\n");

896 
»v”£_d©a
 = 
cÚ‹xt
->reverse_data;

897 
cÚ‹xt
->
»v”£_d©a
 = 
NULL
;

900 
cÚ‹xt
->
add_çke_afd
 = 
TRUE
;

901 
cÚ‹xt
->
Ï¡_afd
 = 
afd
;

903 
”r
 = 
	`g‘_Ãxt_h262_äame
(
cÚ‹xt
,
v”bo£
,
TRUE
,
piùu»
);

905 
cÚ‹xt
->
»v”£_d©a
 =„everse_data;

907 ià(
”r
)

909 
	`´št_”r
("### Error„eading H.262…icture when„eversing\n");

913 
	}
}

925 
	$ouut_£qu’û_h—d”
(
ES_p
 
es
,

926 
WRITER
 
ouut
,

927 
as_TS
,

928 
v”bo£
,

929 
ušt16_t
 
£q_šdex
,

930 
»v”£_d©a_p
 
»v”£_d©a
)

932 
”r
;

933 
ES_off£t
 
£q_po¢
;

934 
ušt32_t
 
£q_Ën
;

935 
by‹
 *
£q_d©a
 = 
NULL
;

936 
”r
 = 
	`g‘_»v”£_d©a
(
»v”£_d©a
,
£q_šdex
,
NULL
,&
£q_po¢
,&
£q_Ën
,

937 
NULL
,NULL);

938 ià(
”r
)

940 
	`åršt_”r
("### Error„etrieving sequence header†ocation‡t %d\n",

941 
£q_šdex
);

945 ià(
v”bo£
)

946 
	`åršt_msg
("Wr™šg sequ’û h—d” %2d from " 
OFFSET_T_FORMAT_08


948 
£q_šdex
,
£q_po¢
.
šfe
,£q_po¢.
š·ck‘
,
£q_Ën
);

950 
”r
 = 
	`»ad_ES_d©a
(
es
,
£q_po¢
,
£q_Ën
,
NULL
,&
£q_d©a
);

951 ià(
”r
)

953 
	`åršt_”r
("### Error„eading (sequence header) data"

954 " from " 
OFFSET_T_FORMAT
 "/%d for %d\n",

955 
£q_po¢
.
šfe
,£q_po¢.
š·ck‘
,
£q_Ën
);

958 
”r
 = 
	`wr™e_·ck‘_d©a
(
ouut
,
as_TS
,
£q_d©a
,
£q_Ën
,
»v”£_d©a
->
pid
,

959 
»v”£_d©a
->
¡»am_id
);

960 
	`ä“
(
£q_d©a
);

961 ià(
”r
)

963 
	`´št_”r
("### Error writing (sequence header) data‡s"

968 
	}
}

989 
	$ouut_äom_»v”£_d©a
(
ES_p
 
es
,

990 
WRITER
 
ouut
,

991 
as_TS
,

992 
v”bo£
,

993 
qu›t
,

994 
ušt32_t
 
off£t
,

995 
»v”£_d©a_p
 
»v”£_d©a
)

997 
w™h_£qu’û_h—d”s
 = (!
»v”£_d©a
->
is_h264
 &&

998 
»v”£_d©a
->
ouut_£qu’û_h—d”s
);

999 
ušt32_t
 
which
 = 
»v”£_d©a
->
Ëngth
 - 1;

1000 
is_h262
 = !
»v”£_d©a
->
is_h264
;

1001 
”r
;

1002 
ušt32_t
 
šdex
;

1003 
ES_off£t
 
¡¬t_po¢
;

1004 
ušt32_t
 
num_by‹s
;

1005 
by‹
 
£q_off£t
;

1006 
by‹
 
afd
;

1007 
ušt32_t
 
uu
;

1009 ià(
v”bo£
)

1010 
	`åršt_msg
("\nGOING BACK: off£ˆ%u, max…iøšdex %u\n",
off£t
,
which
);

1014 ià(
»v”£_d©a
->
Ëngth
 == 0)

1018 ià(
which
 > 0 && 
	`SEQUENCE_HEADER_ENTRY
(
»v”£_d©a
,which))

1019 
which
 --;

1021 ià(
v”bo£
)

1022 
	`åršt_msg
("†a¡‚Ú-£qu’û h—d”…iùu» i %u\n",
which
);

1024 
uu
 = 0; uu < 
off£t
; uu++)

1026 ià(
which
 > 1)

1028 
which
 --;

1029 ià(
	`SEQUENCE_HEADER_ENTRY
(
»v”£_d©a
,
which
))

1030 
which
 --;

1032 ià(
v”bo£
)

1033 
	`åršt_msg
(" back %uØ%d\n",
uu
,
which
);

1037 
”r
 = 
	`g‘_»v”£_d©a
(
»v”£_d©a
,
which
,&
šdex
,&
¡¬t_po¢
,&
num_by‹s
,

1038 &
£q_off£t
,&
afd
);

1039 ià(
”r
)  1;

1041 ià(
v”bo£
)

1042 
	`åršt_msg
("Piùu» [%03d] %4d from " 
OFFSET_T_FORMAT_08


1044 
which
,
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

1046 ià(
w™h_£qu’û_h—d”s
)

1049 
”r
 = 
	`ouut_£qu’û_h—d”
(
es
,
ouut
,
as_TS
,
v”bo£
,(
ušt16_t
)(
which
 - 
£q_off£t
),

1050 
»v”£_d©a
);

1051 ià(
”r
)

1053 
	`åršt_”r
("### Error„etrieving sequence header"

1054 " fÜ…iùu» %d (off£ˆ%d)\n",
which
,
£q_off£t
);

1059 ià(
is_h262
)

1061 
h262_piùu»_p
 
piùu»
;

1062 
”r
 = 
	`»ad_h262_piùu»
(
»v”£_d©a
->
h262
,
¡¬t_po¢
,
afd
,
v”bo£
,

1063 &
piùu»
);

1064 ià(
”r
)

1066 
	`åršt_”r
("### Error„eading H.262…icture from "

1067 
OFFSET_T_FORMAT
 "/%d for %d\n",

1068 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

1071 
”r
 = 
	`wr™e_piùu»_d©a
(
ouut
,
as_TS
,
piùu»
,
»v”£_d©a
->
pid
);

1072 ià(
”r
)

1074 
	`´št_”r
("### Error writing…icture\n");

1075 
	`ä“_h262_piùu»
(&
piùu»
);

1078 
	`ä“_h262_piùu»
(&
piùu»
);

1082 
by‹
 *
d©a
 = 
NULL
;

1083 
ušt32_t
 
d©a_Ën
 = 0;

1084 
”r
 = 
	`»ad_ES_d©a
(
es
,
¡¬t_po¢
,
num_by‹s
,&
d©a_Ën
,&
d©a
);

1085 ià(
”r
)

1087 
	`åršt_”r
("### E¼Ü„—dšg d©¨äom " 
OFFSET_T_FORMAT


1089 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

1092 
”r
 = 
	`wr™e_·ck‘_d©a
(
ouut
,
as_TS
,
d©a
,
num_by‹s
,
»v”£_d©a
->
pid
,

1093 
»v”£_d©a
->
¡»am_id
);

1094 ià(
”r
)

1096 
	`´št_”r
("### Error writing…icture‡s TS PES…acket\n");

1097 
	`ä“
(
d©a
);

1100 
	`ä“
(
d©a
);

1105 ià(
»v”£_d©a
->
is_h264
)

1106 
»v”£_d©a
->
h264
->
acûss_un™_šdex
 =„ev”£_d©a->
šdex
[
which
];

1108 
»v”£_d©a
->
h262
->
piùu»_šdex
 =„ev”£_d©a->
šdex
[
which
];

1114 
»v”£_d©a
->
Ï¡_po¢_added
 = 
which
;

1116 
	}
}

1140 
	$ouut_äom_»v”£_d©a_as_TS
(
ES_p
 
es
,

1141 
TS_wr™”_p
 
tswr™”
,

1142 
v”bo£
,

1143 
qu›t
,

1144 
ušt32_t
 
off£t
,

1145 
»v”£_d©a_p
 
»v”£_d©a
)

1147 
WRITER
 
wr™”
;

1148 
wr™”
.
ts_ouut
 = 
tswr™”
;

1149  
	`ouut_äom_»v”£_d©a
(
es
,
wr™”
,
TRUE
,
v”bo£
,
qu›t
,
off£t
,

1150 
»v”£_d©a
);

1151 
	}
}

1175 
	$ouut_äom_»v”£_d©a_as_ES
(
ES_p
 
es
,

1176 
FILE
 *
ouut
,

1177 
v”bo£
,

1178 
qu›t
,

1179 
ušt32_t
 
off£t
,

1180 
»v”£_d©a_p
 
»v”£_d©a
)

1182 
WRITER
 
wr™”
;

1183 
wr™”
.
es_ouut
 = 
ouut
;

1184  
	`ouut_äom_»v”£_d©a
(
es
,
wr™”
,
FALSE
,
v”bo£
,
qu›t
,
off£t
,

1185 
»v”£_d©a
);

1186 
	}
}

1213 
	$ouut_š_»v”£
(
ES_p
 
es
,

1214 
WRITER
 
ouut
,

1215 
as_TS
,

1216 
äequ’cy
,

1217 
v”bo£
,

1218 
qu›t
,

1219 
št32_t
 
¡¬t_w™h
,

1220 
max
,

1221 
»v”£_d©a_p
 
»v”£_d©a
)

1223 
ii
;

1224 
w™h_£qu’û_h—d”s
 = 
»v”£_d©a
->
ouut_£qu’û_h—d”s
;

1225 
by‹
 *
d©a
 = 
NULL
;

1226 
ušt32_t
 
d©a_Ën
 = 0;

1227 
h262_piùu»_p
 
piùu»
 = 
NULL
;

1228 
ušt32_t
 
Ï¡_£q_šdex
 = 
»v”£_d©a
->
Ëngth
;

1229 
max_pic_šdex
 = 
»v”£_d©a
->
Ëngth
-1;

1230 
fœ¡_aùu®_piùu»_šdex
 = 0;

1231 
is_h262
 = !
»v”£_d©a
->
is_h264
;

1233 
ušt32_t
 
¡¬t_šdex
;

1234 
ušt32_t
 
fš®_šdex
;

1235 
ušt32_t
 
Ï¡_šdex
;

1237 
ušt32_t
 
Ï¡_num_by‹s
 = 0;

1239 
»v”£_d©a
->
piùu»s_wr™‹n
 = 0;

1240 
»v”£_d©a
->
piùu»s_k•t
 = 0;

1241 
»v”£_d©a
->
fœ¡_wr™‹n
 = 0;

1242 
»v”£_d©a
->
Ï¡_wr™‹n
 = 0;

1246 ià(
»v”£_d©a
->
Ëngth
 == 0)

1248 ià(!
qu›t
)

1249 
	`´št_msg
("No datao„everse\n");

1254 
	`SEQUENCE_HEADER_ENTRY
(
»v”£_d©a
,
fœ¡_aùu®_piùu»_šdex
))

1255 
fœ¡_aùu®_piùu»_šdex
 ++;

1258 ià(
¡¬t_w™h
 < -1)

1260 ià(
¡¬t_w™h
 == -1)

1261 
¡¬t_šdex
 = 
»v”£_d©a
->
Ï¡_po¢_added
;

1262 ià(
¡¬t_w™h
 > 
max_pic_šdex
)

1263 
¡¬t_šdex
 = 
max_pic_šdex
;

1265 
¡¬t_šdex
 = 
¡¬t_w™h
;

1268 
¡¬t_šdex
 > 0 && 
	`SEQUENCE_HEADER_ENTRY
(
»v”£_d©a
,start_index))

1269 
¡¬t_šdex
 --;

1272 ià(
¡¬t_šdex
 < (
ušt32_t
)
fœ¡_aùu®_piùu»_šdex
)

1276 
fš®_šdex
 = 
»v”£_d©a
->
šdex
[
¡¬t_šdex
];

1279 
Ï¡_šdex
 = 
fš®_šdex
 + 
äequ’cy
;

1281 
»v”£_d©a
->
fœ¡_wr™‹n
 = 
¡¬t_šdex
;

1283 ià(
v”bo£
)

1284 
	`åršt_msg
("REVERSING: "

1286 
¡¬t_šdex
,
»v”£_d©a
->
šdex
[start_index],

1287 
fœ¡_aùu®_piùu»_šdex
,

1288 
»v”£_d©a
->
šdex
[
fœ¡_aùu®_piùu»_šdex
],
äequ’cy
,
max
);

1297 
ii
 = 
¡¬t_šdex
; i˜>ğ
fœ¡_aùu®_piùu»_šdex
; ii--)

1299 
”r
;

1300 
k“p
 = 
FALSE
;

1301 
ušt32_t
 
šdex
;

1302 
ES_off£t
 
¡¬t_po¢
;

1303 
ušt32_t
 
num_by‹s
;

1304 
by‹
 
£q_off£t
;

1305 
by‹
 
afd
;

1306 
ušt32_t
 
£q_šdex
;

1308 ià(
as_TS
 && 
	`tswr™e_commªd_chªged
(
ouut
.
ts_ouut
))

1310 ià(
d©a
 !ğ
NULL
è
	`ä“
(data);

1311 ià(
piùu»
 !ğ
NULL
è
	`ä“_h262_piùu»
(&picture);

1312  
COMMAND_RETURN_CODE
;

1315 
”r
 = 
	`g‘_»v”£_d©a
(
»v”£_d©a
,
ii
,&
šdex
,&
¡¬t_po¢
,&
num_by‹s
,

1316 &
£q_off£t
,&
afd
);

1317 ià(
”r
)  1;

1319 ià(
v”bo£
)

1320 
	`åršt_msg
("\nPiùu» [%03d] %4d from " 
OFFSET_T_FORMAT_08


1322 
ii
,
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

1325 ià(
¡¬t_po¢
.
šfe
 < 0)

1327 
	`åršt_”r
("!!! Start…osition for„everse item %d does‚ot make sense\n"

1328 " i‹m %d,…iùu» %d, s¹…o¢ " 
OFFSET_T_FORMAT


1329 "/%d,‚um by‹ %d, seq off£ˆ%d\n",
ii
,ii,
šdex
,

1330 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
,
£q_off£t
);

1331 
	`´št_”r
(" Ignoring item\n");

1333 ià(
is_h262
 && 
£q_off£t
 == 0)

1337 ià(
v”bo£
è
	`´št_msg
(".. Sequence header -‚o‚eedo write\n");

1339 ià(
äequ’cy
 != 0)

1341 
g­
 = 
Ï¡_šdex
 - 
šdex
;

1342 ià(
g­
 < 
äequ’cy
)

1344 ià(
v”bo£
è
	`åršt_msg
("++ %d/%d DROP: [%d] %doo soon\n",

1345 
g­
,
äequ’cy
,
ii
,
šdex
);

1351 
piùu»s_£’
 = 
fš®_šdex
 - 
šdex
;

1352 
piùu»s_wª‹d
 = 
piùu»s_£’
 / 
äequ’cy
;

1353 
»³©
 = 
piùu»s_wª‹d
 - 
»v”£_d©a
->
piùu»s_wr™‹n
;

1354 ià(
v”bo£
)

1355 
	`åršt_msg
("** Pictures seen = %d, wanted = %d, written = %d"

1356 " ->„•—ˆğ%d\n",
piùu»s_£’
,
piùu»s_wª‹d
,

1357 
»v”£_d©a
->
piùu»s_wr™‹n
,
»³©
);

1358 ià(
»³©
 > 0 && ((
is_h262
 && 
piùu»
 !ğ
NULL
) ||

1359 (!
is_h262
 && 
d©a
 !ğ
NULL
)))

1361 
jj
;

1362 ià(
v”bo£
)

1364 ià(
»³©
 == 1)

1365 
	`´št_msg
(">>„epeating†ast…icture\n");

1366 ià(
»³©
 > 1)

1367 
	`åršt_msg
(">>„•—tšg†a¡…iùu» %dimes\n",
»³©
);

1369 
jj
=0; jj<
»³©
; jj++)

1371 ià(
is_h262
)

1372 
”r
 = 
	`wr™e_piùu»_d©a
(
ouut
,
as_TS
,
piùu»
,
»v”£_d©a
->
pid
);

1374 
”r
 = 
	`wr™e_·ck‘_d©a
(
ouut
,
as_TS
,
d©a
,
Ï¡_num_by‹s
,

1375 
»v”£_d©a
->
pid
,»v”£_d©a->
¡»am_id
);

1376 ià(
”r
)

1378 
	`´št_”r
("### Error writing (picture) data\n");

1379 ià(
d©a
 !ğ
NULL
è
	`ä“
(data);

1380 ià(
piùu»
 !ğ
NULL
è
	`ä“_h262_piùu»
(&picture);

1383 
»v”£_d©a
->
piùu»s_wr™‹n
 ++;

1386 
k“p
 = 
TRUE
;

1387 ià(
v”bo£
è
	`åršt_msg
("++ %d/%d KEEP: wr™šg out\n",
g­
,
äequ’cy
);

1388 
Ï¡_šdex
 = 
šdex
;

1392 
k“p
 = 
TRUE
;

1396 ià(
ii
 =ğ
fœ¡_aùu®_piùu»_šdex
)

1398 ià(
v”bo£
 && !
k“p
)

1399 
	`´št_msg
("++ but KEEP first…icture„egardless\n");

1400 
k“p
 = 
TRUE
;

1403 ià(
k“p
)

1405 ià(
w™h_£qu’û_h—d”s
)

1408 
£q_šdex
 = 
ii
 - 
£q_off£t
;

1409 ià(
£q_šdex
 !ğ
Ï¡_£q_šdex
)

1411 
”r
 = 
	`ouut_£qu’û_h—d”
(
es
,
ouut
,
as_TS
,
v”bo£
,(
ušt16_t
)
£q_šdex
,

1412 
»v”£_d©a
);

1413 ià(
”r
)

1415 
	`åršt_”r
("### Error„etrieving sequence header"

1416 " fÜ…iùu» %d (off£ˆ%d)\n",
ii
,
£q_off£t
);

1417 ià(
d©a
 !ğ
NULL
è
	`ä“
(data);

1418 ià(
piùu»
 !ğ
NULL
è
	`ä“_h262_piùu»
(&picture);

1421 
Ï¡_£q_šdex
 = 
£q_šdex
;

1425 ià(
v”bo£
)

1426 
	`åršt_msg
("Wr™šg…iùu» [%03d] %4d from " 
OFFSET_T_FORMAT_08


1428 
ii
,
šdex
,
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

1430 ià(
is_h262
)

1432 ià(
piùu»
 !ğ
NULL
è
	`ä“_h262_piùu»
(&picture);

1433 
”r
 = 
	`»ad_h262_piùu»
(
»v”£_d©a
->
h262
,
¡¬t_po¢
,
afd
,

1434 
v”bo£
,&
piùu»
);

1435 ià(
”r
)

1437 
	`åršt_”r
("### Error„eading H.262…icture from "

1438 
OFFSET_T_FORMAT
 "/%d for %d\n",

1439 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

1442 
”r
 = 
	`wr™e_piùu»_d©a
(
ouut
,
as_TS
,
piùu»
,
»v”£_d©a
->
pid
);

1443 ià(
”r
)

1445 
	`´št_”r
("### Error writing…icture\n");

1446 
	`ä“_h262_piùu»
(&
piùu»
);

1452 
”r
 = 
	`»ad_ES_d©a
(
es
,
¡¬t_po¢
,
num_by‹s
,&
d©a_Ën
,&
d©a
);

1453 ià(
”r
)

1455 
	`åršt_”r
("### E¼Ü„—dšg d©¨äom " 
OFFSET_T_FORMAT


1457 
¡¬t_po¢
.
šfe
,¡¬t_po¢.
š·ck‘
,
num_by‹s
);

1458 ià(
d©a
 !ğ
NULL
è
	`ä“
(data);

1461 
”r
 = 
	`wr™e_·ck‘_d©a
(
ouut
,
as_TS
,
d©a
,
num_by‹s
,
»v”£_d©a
->
pid
,

1462 
»v”£_d©a
->
¡»am_id
);

1463 ià(
”r
)

1465 
	`´št_”r
("### Error writing…icture\n");

1466 ià(
d©a
 !ğ
NULL
è
	`ä“
(data);

1469 
Ï¡_num_by‹s
 = 
num_by‹s
;

1472 
»v”£_d©a
->
Ï¡_wr™‹n
 = 
ii
;

1473 
»v”£_d©a
->
piùu»s_wr™‹n
 ++;

1474 
»v”£_d©a
->
piùu»s_k•t
 ++;

1478 ià(
»v”£_d©a
->
is_h264
)

1479 
»v”£_d©a
->
h264
->
acûss_un™_šdex
 =„ev”£_d©a->
šdex
[
ii
];

1481 
»v”£_d©a
->
h262
->
piùu»_šdex
 =„ev”£_d©a->
šdex
[
ii
];

1486 
»v”£_d©a
->
Ï¡_po¢_added
 = 
ii
;

1488 ià(
v”bo£
)

1489 
	`åršt_msg
("Last written [%03d],…icture index %d,†ast_posn_added %d\n",

1490 
ii
,
»v”£_d©a
->
šdex
[ii],ii);

1493 ià(
max
 !ğ0 && ()(
fš®_šdex
 - 
šdex
 + 1) >= max)

1495 ià(
v”bo£
)

1496 
	`åršt_msg
("Break: max %d, final_index %d, index %d\n",

1497 
max
,
fš®_šdex
,
šdex
);

1501 ià(
d©a
 !ğ
NULL
è
	`ä“
(data);

1502 ià(
piùu»
 !ğ
NULL
è
	`ä“_h262_piùu»
(&picture);

1504 ià(
v”bo£
)

1505 
	`´št_msg
("END OF REVERSE\n");

1507 
	}
}

1535 
	$ouut_š_»v”£_as_TS
(
ES_p
 
es
,

1536 
TS_wr™”_p
 
tswr™”
,

1537 
äequ’cy
,

1538 
v”bo£
,

1539 
qu›t
,

1540 
št32_t
 
¡¬t_w™h
,

1541 
max
,

1542 
»v”£_d©a_p
 
»v”£_d©a
)

1544 
WRITER
 
wr™”
;

1545 
wr™”
.
ts_ouut
 = 
tswr™”
;

1546  
	`ouut_š_»v”£
(
es
,
wr™”
,
TRUE
,
äequ’cy
,
v”bo£
,
qu›t
,

1547 
¡¬t_w™h
,
max
,
»v”£_d©a
);

1548 
	}
}

1576 
	$ouut_š_»v”£_as_ES
(
ES_p
 
es
,

1577 
FILE
 *
ouut
,

1578 
äequ’cy
,

1579 
v”bo£
,

1580 
qu›t
,

1581 
št32_t
 
¡¬t_w™h
,

1582 
max
,

1583 
»v”£_d©a_p
 
»v”£_d©a
)

1585 
WRITER
 
wr™”
;

1586 
wr™”
.
es_ouut
 = 
ouut
;

1587  
	`ouut_š_»v”£
(
es
,
wr™”
,
FALSE
,
äequ’cy
,
v”bo£
,
qu›t
,

1588 
¡¬t_w™h
,
max
,
»v”£_d©a
);

1589 
	}
}

	@reverse_defns.h

28 #iâdeà
_»v”£_deâs


29 
	#_»v”£_deâs


	)

31 
	~"com·t.h
"

32 
	~"es_deâs.h
"

37 
»v”£_d©a
 *
	t»v”£_d©a_p
;

38 
	~"h262_deâs.h
"

39 
	~"acûssun™_deâs.h
"

45 
	s»v”£_d©a


47 
	mis_h264
;

52 
h262_cÚ‹xt_p
 
	mh262
;

53 
acûss_un™_cÚ‹xt_p
 
	mh264
;

57 
	mËngth
;

58 
	msize
;

59 
ušt32_t
 
	mnum_piùu»s
;

61 
ušt32_t
 *
	mšdex
;

62 
off£t_t
 *
	m¡¬t_fe
;

63 
št32_t
 *
	m¡¬t_pkt
;

64 
št32_t
 *
	md©a_Ën
;

66 
by‹
 *
	m£q_off£t
;

69 
by‹
 *
	mafd_by‹
;

97 
ušt32_t
 
	mÏ¡_po¢_added
;

100 
	mouut_£qu’û_h—d”s
;

105 
ušt32_t
 
	mpid
;

106 
by‹
 
	m¡»am_id
;

112 
	mpiùu»s_wr™‹n
;

113 
	mpiùu»s_k•t
;

114 
	mfœ¡_wr™‹n
;

115 
	mÏ¡_wr™‹n
;

122 
	#SIZEOF_REVERSE_DATA
 (
»v”£_d©a
)

	)

124 
	#REVERSE_ARRAY_START_SIZE
 1000

	)

125 
	#REVERSE_ARRAY_INCREMENT_SIZE
 500

	)

	@reverse_fns.h

28 #iâdeà
_»v”£_âs


29 
	#_»v”£_âs


	)

31 
	~"acûssun™_deâs.h
"

32 
	~"»v”£_deâs.h
"

33 
	~"h262_deâs.h
"

51 
bud_»v”£_d©a
(
»v”£_d©a_p
 *
»v”£_d©a
,

52 
is_h264
);

60 
£t_»v”£_pid
(
»v”£_d©a_p
 
»v”£_d©a
,

61 
ušt32_t
 
pid
,

62 
by‹
 
¡»am_id
);

70 
add_h262_»v”£_cÚ‹xt
(
h262_cÚ‹xt_p
 
h262
,

71 
»v”£_d©a_p
 
»v”£_d©a
);

79 
add_acûss_un™_»v”£_cÚ‹xt
(
acûss_un™_cÚ‹xt_p
 
cÚ‹xt
,

80 
»v”£_d©a_p
 
»v”£_d©a
);

87 
ä“_»v”£_d©a
(
»v”£_d©a_p
 *
»v”£_d©a
);

106 
»memb”_»v”£_h262_d©a
(
»v”£_d©a_p
 
»v”£_d©a
,

107 
ušt32_t
 
šdex
,

108 
ES_off£t
 
¡¬t_po¢
,

109 
ušt32_t
 
Ëngth
,

110 
by‹
 
£q_off£t
,

111 
by‹
 
afd
);

126 
»memb”_»v”£_h264_d©a
(
»v”£_d©a_p
 
»v”£_d©a
,

127 
ušt32_t
 
šdex
,

128 
ES_off£t
 
¡¬t_po¢
,

129 
ušt32_t
 
Ëngth
);

160 
g‘_»v”£_d©a
(
»v”£_d©a_p
 
»v”£_d©a
,

161 
which
,

162 
ušt32_t
 *
šdex
,

163 
ES_off£t
 *
¡¬t_po¢
,

164 
ušt32_t
 *
Ëngth
,

165 
by‹
 *
£q_off£t
,

166 
by‹
 *
afd
);

185 
cŞËù_»v”£_h262
(
h262_cÚ‹xt_p
 
h262
,

186 
max
,

187 
v”bo£
,

188 
qu›t
);

204 
cŞËù_»v”£_acûss_un™s
(
acûss_un™_cÚ‹xt_p
 
acÚ‹xt
,

205 
max
,

206 
v”bo£
,

207 
qu›t
);

230 
ouut_äom_»v”£_d©a_as_TS
(
ES_p
 
es
,

231 
TS_wr™”_p
 
tswr™”
,

232 
v”bo£
,

233 
qu›t
,

234 
ušt32_t
 
off£t
,

235 
»v”£_d©a_p
 
»v”£_d©a
);

258 
ouut_äom_»v”£_d©a_as_ES
(
ES_p
 
es
,

259 
FILE
 *
ouut
,

260 
v”bo£
,

261 
qu›t
,

262 
ušt32_t
 
off£t
,

263 
»v”£_d©a_p
 
»v”£_d©a
);

290 
ouut_š_»v”£_as_TS
(
ES_p
 
es
,

291 
TS_wr™”_p
 
tswr™”
,

292 
äequ’cy
,

293 
v”bo£
,

294 
qu›t
,

295 
št32_t
 
¡¬t_w™h
,

296 
max
,

297 
»v”£_d©a_p
 
»v”£_d©a
);

324 
ouut_š_»v”£_as_ES
(
ES_p
 
es
,

325 
FILE
 *
ouut
,

326 
äequ’cy
,

327 
v”bo£
,

328 
qu›t
,

329 
št32_t
 
¡¬t_w™h
,

330 
max
,

331 
»v”£_d©a_p
 
»v”£_d©a
);

	@rtp2264.c

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<lim™s.h
>

36 
	~<”ºo.h
>

37 
	~<¡ršg.h
>

38 
	~<fú.h
>

39 
	~<lim™s.h
>

40 
	~<time.h
>

41 #ifdeà
_WIN32


42 
	~<¡ddef.h
>

45 
	~"com·t.h
"

46 
	~"v”siÚ.h
"

47 
	~"misc_âs.h
"

48 
	~"fmtx.h
"

50 
	#RTP_HDR_LEN
 8

	)

52 
	#RTP_PREFIX_STRING
 "RTP "

	)

53 
	#RTP_PREFIX_LEN
 4

	)

54 
	#RTP_LEN_OFFSET
 4

	)

56 
	$c642b
(cÚ¡ 
c
)

58  (
c
 >= 'A' && c <= 'Z') ? c - 'A' :

59 (
c
 >= 'a' && c <= 'z') ? c - 'a' + 26 :

60 (
c
 >= '0' && c <= '9') ? c - '0' + 52 :

61 (
c
 == '+' || c == '-') ? 62 :

62 (
c
 == '/' || c == '_') ? 63 :

63 (
c
 == '=') ? -1 : -2;

64 
	}
}

66 
size_t
 
	$b64¡r2bšn
(
by‹
 * cÚ¡ 
de¡0
, cÚ¡ 
size_t
 
dËn
, cÚ¡ ** cÚ¡ 
¶a¡
, cÚ¡ * 
¤c
)

68 
by‹
 * 
de¡
 = 
de¡0
;

69 
ušt32_t
 
a
 = 0;

70 
ssize_t
 
i
 = 4;

71 
size_t
 
¦’
 = (
dËn
 * 4 + 5) / 3;

72 
b
;

74 (
b
 = 
	`c642b
(*
¤c
++)è>ğ0 && --
¦’
 != 0)

76 
a
 = (¨<< 6è| 
b
;

77 ià(--
i
 == 0)

79 *
de¡
++ = (
a
 >> 16) & 0xff;

80 *
de¡
++ = (
a
 >> 8) & 0xff;

81 *
de¡
++ = 
a
 & 0xff;

82 
i
 = 4;

87 ià(
i
 < 3)

89 
a
 <<ğ
i
 * 6;

90 *
de¡
++ = (
a
 >> 16) & 0xff;

93 ià(
b
 == -1)

94 
b
 = 
	`c642b
(*
¤c
++);

96 ià(
i
 == 1)

98 *
de¡
++ = (
a
 >> 8) & 0xff;

100 ià(
b
 == -1)

101 ++
¤c
;

104 ià(
¶a¡
 !ğ
NULL
)

105 *
¶a¡
 = 
¤c
 - 1;

107  
de¡
 - 
de¡0
;

108 
	}
}

111 
	$maš
(
¬gc
, **
¬gv
)

113 
FILE
 *
f_š
 = 
NULL
;

114 
FILE
 *
f_out
 = 
NULL
;

115 cÚ¡ * 
âame_š
;

116 cÚ¡ * 
âame_out
;

117 
zcouÁ
 = 0;

119 ià(
¬gc
 < 3)

121 
	`årštf
(
¡d”r
, "Usage: <in.rtp> <out.264>\n");

125 
âame_š
 = 
¬gv
[1];

126 
âame_out
 = 
¬gv
[2];

128 ià((
f_š
 = 
	`fİ’
(
âame_š
, "rb")è=ğ
NULL
)

130 
	`³¼Ü
(
¬gv
[1]);

134 ià((
f_out
 = 
	`fİ’
(
âame_out
, "wb")è=ğ
NULL
)

136 
	`³¼Ü
(
¬gv
[2]);

140 ià(
¬gc
 > 3)

142 
by‹
 
psbuf
[0x1000];

143 cÚ¡ * 
eo64
 = 
¬gv
[3];

145 
psbuf
[0] = 0;

146 
psbuf
[1] = 0;

147 
psbuf
[2] = 0;

148 
psbuf
[3] = 1;

152 
size_t
 
Ën
 = 
	`b64¡r2bšn
(
psbuf
 + 4, Õsbufè- 4, &
eo64
,ƒo64);

154 ià((*
eo64
 !ğ0 && *eo64 !ğ','è|| 
Ën
 == 0)

156 
	`årštf
(
¡d”r
, "Bad B64 sŒšg: '%s' (Ën=%zd, chr=%d)\n", 
¬gv
[3], 
Ën
, *
eo64
);

157 
	`ex™
(1);

160 ià(
	`fwr™e
(
psbuf
, 
Ën
 + 4, 1, 
f_out
) != 1)

162 
	`³¼Ü
(
âame_out
);

163 
	`ex™
(1);

165 } *
eo64
++ == ',');

170 
by‹
 
buf
[0x10000];

171 
ušt32_t
 
¹¶’
;

173 ià(
	`ä—d
(
buf
, 
RTP_HDR_LEN
, 1, 
f_š
) != 1)

175 ià(
	`ã¼Ü
(
f_š
))

176 
	`³¼Ü
(
âame_š
);

179 ià(
	`memcmp
(
buf
, 
RTP_PREFIX_STRING
, 
RTP_PREFIX_LEN
) != 0)

181 
	`årštf
(
¡d”r
, "### Bad RTP…refix\n");

184 
¹¶’
 = 
	`ušt_32_be
(
buf
 + 
RTP_LEN_OFFSET
);

185 ià(
¹¶’
 > (
buf
) ||„tplen < 12)

187 
	`årštf
(
¡d”r
, "### Bad RTP†’: %" 
PRIu32
 "\n", 
¹¶’
);

191 ià(
	`ä—d
(
buf
, 
¹¶’
, 1, 
f_š
) != 1)

193 ià(
	`ã¼Ü
(
f_š
))

194 
	`³¼Ü
(
âame_š
);

196 
	`årštf
(
¡d”r
, "### Unexpected EOF\n");

201 
size_t
 
off£t
 = 12 + (
buf
[0] & 0xf) * 4;

202 
size_t
 
·dËn
 = ((
buf
[0] & 0x20è!ğ0è? buf[
¹¶’
 - 1] : 0;

205 ià((
buf
[0] & 0x10) != 0)

206 
off£t
 +ğ4 + 
	`ušt_16_be
(
buf
 + offset + 2);

208 ià(
¹¶’
 < 
off£t
 + 
·dËn
 + 1)

210 
	`årštf
(
¡d”r
, "### Bad RTP offset +…adding\n");

216 cÚ¡ 
by‹
 * 
p
 = 
buf
 + 
off£t
;

217 cÚ¡ 
by‹
 * 
p_’d
 = 
buf
 + 
¹¶’
 - 
·dËn
;

218 
by‹
 
buf2
[0x18000];

219 
by‹
 * 
q
 = 
buf2
;

220 
by‹
 
sc1
 = *
p
++;

222 ià((
sc1
 & 0x1f) == 28)

224 
by‹
 
sc2
 = *
p
++;

225 ià((
sc2
 & 0x80) != 0)

228 
sc1
 = (sc1 & 0xe0è| (
sc2
 & 0x1f);

229 *
q
++ = 0;

230 *
q
++ = 0;

231 *
q
++ = 0;

232 *
q
++ = 1;

233 *
q
++ = 
sc1
;

234 
zcouÁ
 = 0;

236 
	`´štf
("F¿gm’‹d block w™h code: %x\n", 
sc1
);

242 *
q
++ = 0;

243 *
q
++ = 0;

244 *
q
++ = 0;

245 *
q
++ = 1;

246 *
q
++ = 
sc1
;

247 
zcouÁ
 = 0;

248 
	`´štf
("S¹ block w™h code: %x\n", 
sc1
);

253 
p
 < 
p_’d
)

255 cÚ¡ 
by‹
 
b
 = *
p
++;

257 ià(
zcouÁ
 =ğ2 && 
b
 <= 3)

259 *
q
++ = 3;

260 
zcouÁ
 = 0;

263 *
q
++ = 
b
;

264 
zcouÁ
 = (
b
 == 0) ? zcount + 1 : 0;

267 ià(
	`fwr™e
(
buf2
, 
q
 - buf2, 1, 
f_out
) != 1)

269 
	`³¼Ü
(
âame_out
);

270 
	`ex™
(1);

277 
	`fşo£
(
f_out
);

278 
	`fşo£
(
f_š
);

280 
	}
}

	@stream_type.c

30 
	~<¡dio.h
>

31 
	~<¡dlib.h
>

32 
	~<¡ršg.h
>

33 
	~<fú.h
>

34 
	~<”ºo.h
>

36 #ifdeà
_WIN32


37 
	~<¡ddef.h
>

38 
	~<io.h
>

40 
	~<uni¡d.h
>

43 
	~"com·t.h
"

44 
	~"es_âs.h
"

45 
	~"ts_âs.h
"

46 
	~"Çlun™_âs.h
"

47 
	~"h262_âs.h
"

48 
	~"misc_âs.h
"

49 
	~"´štšg_âs.h
"

50 
	~"v”siÚ.h
"

52 
	#STREAM_IS_TS
 10

	)

53 
	#STREAM_IS_PS
 11

	)

54 
	#STREAM_IS_H262
 12

	)

55 
	#STREAM_IS_H264
 14

	)

56 
	#STREAM_IS_AVS
 15

	)

57 
	#STREAM_MAYBE_PES
 5

	)

58 
	#STREAM_IS_UNSURE
 9

	)

59 
	#STREAM_IS_ERROR
 0

	)

67 
	$check_if_TS
(
šput
,

68 
by‹
 
cur_by‹
,

69 
v”bo£
,

70 *
decided
,

71 *
»suÉ
)

73 
ii
;

75 ià(
v”bo£
)

76 
	`´št_msg
("Is it Transport Stream?\n");

79 ià(
cur_by‹
 != 0x47)

81 ià(
v”bo£
)

82 
	`åršt_msg
(" Fœ¡ by‹ iÀfi 0x%02X‚Ù 0x47, sØ™ i nÙ\n",
cur_by‹
);

87 ià(
v”bo£
)

88 
	`´št_msg
(" First byte in file is 0x47, so it†ooks†ike Transport Stream\n");

91 ià(
v”bo£
)

92 
	`´št_msg
(" Checking‚ext 500…acketso see ifhey start 0x47\n");

93 
ii
=0; ii<500; ii++)

95 
by‹
 
buf
[
TS_PACKET_SIZE
];

96 
”r
 = 
	`»ad_by‹s
(
šput
,
TS_PACKET_SIZE
,
buf
);

97 ià(
”r
)

99 
	`åršt_”r
("### %sryingo„ead start of…acket %d\n",

100 (
”r
==
EOF
?"EOF":"E¼Ü"),
ii
+1);

103 ià(
buf
[
TS_PACKET_SIZE
-1] != 0x47)

105 ià(
v”bo£
)

106 
	`åršt_msg
(" Packet %d does‚ot start with 0x47 (%02x instead)\n",

107 
ii
+1,
buf
[
TS_PACKET_SIZE
-1]);

111 ià(
v”bo£
)

112 
	`´št_msg
("The checked…ackets‡ll start with 0x47 -†ooks†ike TS\n");

113 *
decided
 = 
TRUE
;

114 *
»suÉ
 = 
STREAM_IS_TS
;

116 
	}
}

123 
	$check_if_PS
(
šput
,

124 
v”bo£
,

125 *
decided
,

126 *
»suÉ
)

128 
”r
;

129 
by‹
 
buf
[10];

130 
¡uffšg_Ëngth
;

132 ià(
v”bo£
)

134 
	`´št_msg
("Is it Program Stream?\n");

135 
	`´št_msg
(" Tryingo„ead…ack header\n");

138 
”r
 = 
	`»ad_by‹s
(
šput
,4,
buf
);

139 ià(
”r
)

141 
	`åršt_”r
("### %sryingo„ead start of first PS…acket\n",

142 (
”r
==
EOF
?"EOF":"Error"));

146 ià(
buf
[0] != 0 || buf[1] != 0 || buf[2] != 1 || buf[3] != 0xba)

148 ià(
v”bo£
)

149 
	`åršt_msg
(" File starts %02X %02X %02X %02X,‚ot 00 00 01 BA -‚ot PS\n",

150 
buf
[0],buf[1],buf[2],buf[3]);

154 ià(
v”bo£
)

155 
	`´št_msg
(" File starts 00 00 01 BA - could be PS,"

158 
”r
 = 
	`»ad_by‹s
(
šput
,8,
buf
);

159 ià(
”r
)

161 
	`åršt_”r
("### %sryingo„ead body of PS…ack header\n",

162 (
”r
==
EOF
?"EOF":"Error"));

166 ià((
buf
[0] & 0xF0) == 0x20)

168 ià(
v”bo£
)

169 
	`´št_msg
(" Looks†ike ISO/IEC 11171-1/MPEG-1…ack header\n");

171 ià((
buf
[0] & 0xC0) == 0x40)

173 ià(
v”bo£
)

174 
	`´št_msg
(" Looks†ike ISO/IEC 13818-1/H.222.0…ack header\n");

175 
”r
 = 
	`»ad_by‹s
(
šput
,2,&(
buf
[8]));

176 ià(
”r
)

178 
	`åršt_”r
("### %sryingo„ead†ast 2 bytes of body of PS…ack header\n",

179 (
”r
==
EOF
?"EOF":"Error"));

183 
¡uffšg_Ëngth
 = 
buf
[9] & 0x07;

186 ià(
¡uffšg_Ëngth
 > 0)

188 
”r
 = 
	`»ad_by‹s
(
šput
,
¡uffšg_Ëngth
,
buf
);

189 ià(
”r
)

191 
	`åršt_”r
("### %sryingo„ead PS…ack header stuffing bytes\n",

192 (
”r
==
EOF
?"EOF":"Error"));

200 ià(
v”bo£
)

201 
	`´št_msg
(" OK,ryingo„ead start of‚ext…acket\n");

203 
”r
 = 
	`»ad_by‹s
(
šput
,4,
buf
);

204 ià(
”r
)

206 
	`åršt_”r
("### %sryingo„ead start of‚ext PS…acket\n",

207 (
”r
==
EOF
?"EOF":"Error"));

211 ià(
buf
[0] != 0 || buf[1] != 0 || buf[2] != 1)

213 ià(
v”bo£
)

214 
	`åršt_msg
(" Next 'packet' starts %02X %02X %02X,‚ot 00 00 01 -‚ot PS\n",

215 
buf
[0],buf[1],buf[2]);

219 ià(
v”bo£
)

220 
	`´št_msg
(" Start of second…acket found‡t„ight…lace -†ooks†ike PS\n");

222 *
decided
 = 
TRUE
;

223 *
»suÉ
 = 
STREAM_IS_PS
;

225 
	}
}

243 
	$d‘”mše_·ck‘_ty³
(
šput
,

244 
v”bo£
,

245 *
decided
,

246 *
»suÉ
)

248 
”r
;

249 #ifdeà
_WIN32


250 
Ëngth
;

252 
ssize_t
 
Ëngth
;

254 
by‹
 
fœ¡_by‹
;

255 
video_ty³
;

257 
Ëngth
 = 
	`»ad
(
šput
,&
fœ¡_by‹
,1);

258 ià(
Ëngth
 == 0)

260 
	`´št_”r
("### EOF„eading first byte\n");

263 ià(
Ëngth
 == -1)

265 
	`åršt_”r
("### E¼Ü„—dšg fœ¡ by‹: %s\n",
	`¡»¼Ü
(
”ºo
));

270 
”r
 = 
	`check_if_TS
(
šput
,
fœ¡_by‹
,
v”bo£
,
decided
,
»suÉ
);

271 ià(
”r
)

273 
	`şo£_fe
(
šput
);

276 ià(*
decided
)

278 
	`şo£_fe
(
šput
);

282 
	`£ek_fe
(
šput
,0);

285 
”r
 = 
	`check_if_PS
(
šput
,
v”bo£
,
decided
,
»suÉ
);

286 ià(
”r
)

288 
	`şo£_fe
(
šput
);

291 ià(*
decided
)

293 
	`şo£_fe
(
šput
);

297 
	`£ek_fe
(
šput
,0);

300 ià(
v”bo£
)

301 
	`´št_msg
("Is it‡n Elementary Stream we„ecognise?\n");

303 
”r
 = 
	`decide_ES_fe_video_ty³
(
šput
,!
v”bo£
,v”bo£,&
video_ty³
);

304 ià(
”r
)

306 
	`şo£_fe
(
šput
);

310 
video_ty³
)

312 
VIDEO_H264
:

313 *
»suÉ
 = 
STREAM_IS_H264
;

314 *
decided
 = 
TRUE
;

316 
VIDEO_H262
:

317 *
»suÉ
 = 
STREAM_IS_H262
;

318 *
decided
 = 
TRUE
;

320 
VIDEO_AVS
:

321 *
»suÉ
 = 
STREAM_IS_AVS
;

322 *
decided
 = 
TRUE
;

324 
VIDEO_UNKNOWN
:

325 *
»suÉ
 = 
STREAM_IS_UNSURE
;

326 *
decided
 = 
FALSE
;

327 ià(
v”bo£
è
	`´št_msg
("Still‚ot sure\n");

330 
	`åršt_msg
("### stream_type: Unexpected decision from"

331 " decide_ES_fe_video_ty³: %d\n",
video_ty³
);

332 
	`şo£_fe
(
šput
);

336 
	`şo£_fe
(
šput
);

338 
	}
}

340 
	$´št_u§ge
()

342 
	`´št_msg
(

346 
	`REPORT_VERSION
("stream_type");

347 
	`´št_msg
(

386 
	}
}

388 
	$maš
(
¬gc
, **
¬gv
)

390 *
šput_Çme
 = 
NULL
;

391 
had_šput_Çme
 = 
FALSE
;

392 
šput
 = -1;

393 
v”bo£
 = 
FALSE
;

394 
qu›t
 = 
FALSE
;

395 
”r
 = 0;

396 
ii
 = 1;

397 
decided
 = 
FALSE
;

398 
»suÉ
 = 
STREAM_IS_ERROR
;

400 ià(
¬gc
 < 2)

402 
	`´št_u§ge
();

406 
ii
 < 
¬gc
)

408 ià(
¬gv
[
ii
][0] == '-')

410 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

411 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

413 
	`´št_u§ge
();

414  
STREAM_IS_ERROR
;

416 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

418 
v”bo£
 = 
TRUE
;

419 
qu›t
 = 
FALSE
;

421 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

423 
	`CHECKARG
("¡»am_ty³",
ii
);

424 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

425 
	`»dœeù_ouut_¡d”r
();

426 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

427 
	`»dœeù_ouut_¡dout
();

430 
	`åršt_”r
("### stream_type: "

432 " '¡d”r')\n",
¬gv
[
ii
+1]);

435 
ii
++;

437 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

439 
v”bo£
 = 
FALSE
;

440 
qu›t
 = 
TRUE
;

444 
	`åršt_”r
("### stream_type: "

445 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

446  
STREAM_IS_ERROR
;

451 ià(
had_šput_Çme
)

453 
	`åršt_”r
("### sŒ—m_ty³: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

454  
STREAM_IS_ERROR
;

458 
šput_Çme
 = 
¬gv
[
ii
];

459 
had_šput_Çme
 = 
TRUE
;

462 
ii
++;

465 ià(!
had_šput_Çme
)

467 
	`´št_”r
("### stream_type: No input file specified\n");

468  
STREAM_IS_ERROR
;

471 
šput
 = 
	`İ’_bš¬y_fe
(
šput_Çme
,
FALSE
);

472 ià(
šput
 == -1)

474 
	`åršt_”r
("### stream_type: Unableo open input file %s\n",

475 
šput_Çme
);

479 ià(!
qu›t
)

480 
	`åršt_msg
("R—dšg from %s\n",
šput_Çme
);

483 
”r
 = 
	`d‘”mše_·ck‘_ty³
(
šput
,
v”bo£
,&
decided
,&
»suÉ
);

484 ià(
”r
)

486 
	`´št_”r
("### Unableo decide on streamype dueoƒrror\n");

487  
STREAM_IS_ERROR
;

490 ià(!
qu›t
)

492 ià(!
decided
)

494 
	`´št_msg
("Unableo decide\n");

495 
»suÉ
 = 
STREAM_IS_UNSURE
;

499 
»suÉ
)

501 
STREAM_IS_TS
:

502 
	`´št_msg
("It‡ppearso be Transport Stream\n");

504 
STREAM_IS_PS
:

505 
	`´št_msg
("It‡ppearso be Program Stream\n");

507 
STREAM_IS_H262
:

508 
	`´št_msg
("It‡ppearso be Elementary Stream, MPEG-2 (H.262)\n");

510 
STREAM_IS_H264
:

511 
	`´št_msg
("It‡ppearso be Elementary Stream, MPEG-4 (H.264)\n");

513 
STREAM_IS_AVS
:

514 
	`´št_msg
("It‡ppearso be Elementary Stream, AVS\n");

516 
STREAM_MAYBE_PES
:

517 
	`´št_msg
("It†ooks†ikelyo be PES\n");

519 
STREAM_IS_UNSURE
:

520 
	`´št_msg
("It is‚ot„ecognised\n");

523 
	`åršt_msg
("UÃx³ùed decisiÚ v®u%d\n",
»suÉ
);

524 
»suÉ
 = 
STREAM_IS_ERROR
;

529  
»suÉ
;

530 
	}
}

	@test_es_unit_list.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

32 
	~"com·t.h
"

33 
	~"es_âs.h
"

35 
	$maš
(
¬gc
, **
¬gv
)

37 
”r
, 
ii
;

38 
max
 = 
ES_UNIT_LIST_START_SIZE
 + 
ES_UNIT_LIST_INCREMENT
 + 3;

39 
ES_un™_li¡_p
 
li¡
 = 
NULL
;

40 
ES_un™_p
 
un™
 = 
NULL
;

42 
	`´štf
("Testing ES unit†ist\n");

43 
	`´štf
("Test 1 - differing ES units\n");

44 
”r
 = 
	`bud_ES_un™_li¡
(&
li¡
);

45 ià(
”r
)

47 
	`´štf
("Test failed - constructing†ist\n");

50 
ii
=0; ii<
max
; ii++)

52 
”r
 = 
	`bud_ES_un™
(&
un™
);

53 ià(
”r
)

55 
	`´štf
("Test failed - constructing ES unit\n");

58 
”r
 = 
	`­³nd_to_ES_un™_li¡
(
li¡
,
un™
);

59 ià(
”r
)

61 
	`´štf
("Te¡ faed -‡µ’dšg ES un™ %d\n",
ii
);

64 ià(
li¡
->
Ëngth
 >†i¡->
size
)

66 
	`´štf
("Test failed -†ist†ength = %d, size = %d\n",

67 
li¡
->
Ëngth
,li¡->
size
);

70 ià(
li¡
->
Ëngth
 !ğ
ii
+1)

72 
	`´štf
("Test failed -†ist†ength is %d,ƒxpected %d\n",

73 
li¡
->
Ëngth
,
ii
+1);

76 
	`ä“_ES_un™
(&
un™
);

79 
	`´štf
("Test 1 -„esetting†ist\n");

80 
	`»£t_ES_un™_li¡
(
li¡
);

81 ià(
li¡
->
Ëngth
 != 0)

83 
	`´štf
("Te¡ faed -†i¡†’gth i %d,‚Ù 0\n",
li¡
->
Ëngth
);

88 
ii
=0; ii<
max
+
ES_UNIT_LIST_INCREMENT
; ii++)

90 
”r
 = 
	`bud_ES_un™
(&
un™
);

91 ià(
”r
)

93 
	`´štf
("Test failed - constructing ES unit\n");

96 
”r
 = 
	`­³nd_to_ES_un™_li¡
(
li¡
,
un™
);

97 ià(
”r
)

99 
	`´štf
("Te¡ faed -‡µ’dšg ES un™ %d\n",
ii
);

102 ià(
li¡
->
Ëngth
 >†i¡->
size
)

104 
	`´štf
("Test failed -†ist†ength = %d, size = %d\n",

105 
li¡
->
Ëngth
,li¡->
size
);

108 ià(
li¡
->
Ëngth
 !ğ
ii
+1)

110 
	`´štf
("Test failed -†ist†ength is %d,ƒxpected %d\n",

111 
li¡
->
Ëngth
,
ii
+1);

114 
	`ä“_ES_un™
(&
un™
);

117 
	`´štf
("Test 1 - clearing†ist\n");

118 
	`ä“_ES_un™_li¡
(&
li¡
);

119 
	`´štf
("Test 1 succeeded\n");

121 
	`´štf
("Test 2 -he same ES unit inserted multipleimes\n");

122 
”r
 = 
	`bud_ES_un™_li¡
(&
li¡
);

123 ià(
”r
)

125 
	`´štf
("Test failed - constructing†ist\n");

128 
”r
 = 
	`bud_ES_un™
(&
un™
);

129 ià(
”r
)

131 
	`´štf
("Test failed - constructing ES unit\n");

136 
ii
=0; ii<5; ii++)

138 
”r
 = 
	`­³nd_to_ES_un™_li¡
(
li¡
,
un™
);

139 ià(
”r
)

141 
	`´štf
("Te¡ faed -‡µ’dšg ES un™ %d\n",
ii
);

146 
	`´štf
("Test 2 - clearing†ist\n");

147 
	`ä“_ES_un™_li¡
(&
li¡
);

148 
	`ä“_ES_un™
(&
un™
);

149 
	`´štf
("Test 2 succeeded\n");

151 
	}
}

	@test_nal_unit_list.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

32 
	~"com·t.h
"

33 
	~"Çlun™_âs.h
"

35 
	$maš
(
¬gc
, **
¬gv
)

37 
”r
, 
ii
;

38 
max
 = 
NAL_UNIT_LIST_START_SIZE
 + 
NAL_UNIT_LIST_INCREMENT
 + 3;

39 
Çl_un™_li¡_p
 
li¡
 = 
NULL
;

40 
Çl_un™_p
 
un™
 = 
NULL
;

42 
	`´štf
("NAL unit†ists‡re‚ow handled‡s NAL unit†ists, so...\n");

43 
	`´štf
("Testing NAL unit†ist\n");

44 
	`´štf
("Test 1 - differing NAL units\n");

45 
”r
 = 
	`bud_Çl_un™_li¡
(&
li¡
);

46 ià(
”r
)

48 
	`´štf
("Test failed - constructing†ist\n");

51 
ii
=0; ii<
max
; ii++)

53 
”r
 = 
	`bud_Çl_un™
(&
un™
);

54 ià(
”r
)

56 
	`´štf
("Test failed - constructing NAL unit\n");

59 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
li¡
,
un™
);

60 ià(
”r
)

62 
	`´štf
("Te¡ faed -‡µ’dšg NAL un™ %d\n",
ii
);

65 ià(
li¡
->
Ëngth
 >†i¡->
size
)

67 
	`´štf
("Test failed -†ist†ength = %d, size = %d\n",

68 
li¡
->
Ëngth
,li¡->
size
);

71 ià(
li¡
->
Ëngth
 !ğ
ii
+1)

73 
	`´štf
("Test failed -†ist†ength is %d,ƒxpected %d\n",

74 
li¡
->
Ëngth
,
ii
+1);

77 ià(
li¡
->
¬¿y
[
ii
] !ğ
un™
)

79 
	`´štf
("Test failed -†ist->array[%d] is %p,ƒxpected %p\n",

80 
ii
,
li¡
->
¬¿y
[ii],
un™
);

85 
	`´štf
("Test 1 -„esetting†ist\n");

86 
	`»£t_Çl_un™_li¡
(
li¡
,
TRUE
);

87 ià(
li¡
->
Ëngth
 != 0)

89 
	`´štf
("Te¡ faed -†i¡†’gth i %d,‚Ù 0\n",
li¡
->
Ëngth
);

92 ià(
li¡
->
¬¿y
[0] !ğ
NULL
)

94 
	`´štf
("Te¡ faed -†i¡->¬¿y[0] i %p,‚Ù NULL\n",
li¡
->
¬¿y
[0]);

99 
ii
=0; ii<
max
+
NAL_UNIT_LIST_INCREMENT
; ii++)

101 
”r
 = 
	`bud_Çl_un™
(&
un™
);

102 ià(
”r
)

104 
	`´štf
("Test failed - constructing NAL unit\n");

107 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
li¡
,
un™
);

108 ià(
”r
)

110 
	`´štf
("Te¡ faed -‡µ’dšg NAL un™ %d\n",
ii
);

113 ià(
li¡
->
Ëngth
 >†i¡->
size
)

115 
	`´štf
("Test failed -†ist†ength = %d, size = %d\n",

116 
li¡
->
Ëngth
,li¡->
size
);

119 ià(
li¡
->
Ëngth
 !ğ
ii
+1)

121 
	`´štf
("Test failed -†ist†ength is %d,ƒxpected %d\n",

122 
li¡
->
Ëngth
,
ii
+1);

125 ià(
li¡
->
¬¿y
[
ii
] !ğ
un™
)

127 
	`´štf
("Test failed -†ist->array[%d] is %p,ƒxpected %p\n",

128 
ii
,
li¡
->
¬¿y
[ii],
un™
);

133 
	`´štf
("Test 1 - clearing†ist\n");

134 
	`ä“_Çl_un™_li¡
(&
li¡
,
TRUE
);

135 
	`´štf
("Test 1 succeeded\n");

137 
	`´štf
("Test 2 -he same NAL unit inserted multipleimes\n");

138 
”r
 = 
	`bud_Çl_un™_li¡
(&
li¡
);

139 ià(
”r
)

141 
	`´štf
("Test failed - constructing†ist\n");

144 
”r
 = 
	`bud_Çl_un™
(&
un™
);

145 ià(
”r
)

147 
	`´štf
("Test failed - constructing NAL unit\n");

152 
ii
=0; ii<5; ii++)

154 
”r
 = 
	`­³nd_to_Çl_un™_li¡
(
li¡
,
un™
);

155 ià(
”r
)

157 
	`´štf
("Te¡ faed -‡µ’dšg NAL un™ %d\n",
ii
);

162 
	`´štf
("Test 2 - clearing†ist\n");

163 
	`ä“_Çl_un™_li¡
(&
li¡
,
FALSE
);

164 
	`ä“_Çl_un™
(&
un™
);

165 
	`´štf
("Test 2 succeeded\n");

167 
	}
}

	@test_pes.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<”ºo.h
>

34 
	~"com·t.h
"

35 
	~"³s_âs.h
"

36 
	~"pidšt_âs.h
"

37 
	~"misc_âs.h
"

38 
	~"ps_âs.h
"

39 
	~"ts_âs.h
"

40 
	~"es_âs.h
"

41 
	~"h262_âs.h
"

42 
	~"tswr™e_âs.h
"

43 
	~"v”siÚ.h
"

48 
	$wr™e_´og¿m_d©a_A
(
PES_»ad”_p
 
»ad”
,

49 
TS_wr™”_p
 
ouut
)

52 
num_´ogs
 = 0;

53 
ušt32_t
 
´og_pids
[2];

54 
by‹
 
´og_ty³
[2];

55 
”r
;

56 
ušt32_t
 
pü_pid
, 
pmt_pid
;

58 ià(
»ad”
->
is_TS
)

61 
numb”
;

63 ià(
»ad”
->
video_pid
 != 0)

65 
pmt_¡»am_p
 
¡»am
 = 
	`pid_¡»am_š_pmt
(
»ad”
->
´og¿m_m­
,

66 
»ad”
->
video_pid
);

67 ià(
¡»am
 =ğ
NULL
)

69 
	`årštf
(
¡d”r
,"### Cannot find video PID %04x in…rogram map\n",

70 
»ad”
->
video_pid
);

73 
´og_pids
[0] = 
»ad”
->
ouut_video_pid
;

74 
´og_ty³
[0] = 
¡»am
->
¡»am_ty³
;

75 
num_´ogs
 = 1;

76 
pü_pid
 = 
»ad”
->
video_pid
;

78 ià(
»ad”
->
audio_pid
 != 0)

80 
pmt_¡»am_p
 
¡»am
 = 
	`pid_¡»am_š_pmt
(
»ad”
->
´og¿m_m­
,

81 
»ad”
->
audio_pid
);

82 ià(
¡»am
 =ğ
NULL
)

84 
	`årštf
(
¡d”r
,"### Cannot find‡udio PID %04x in…rogram map\n",

85 
»ad”
->
audio_pid
);

88 
´og_pids
[
num_´ogs
] = 
»ad”
->
ouut_audio_pid
;

89 
´og_ty³
[
num_´ogs
] = 
¡»am
->
¡»am_ty³
;

90 
num_´ogs
++;

92 
pmt_pid
 = 
»ad”
->pmt_pid;

101 
num_´ogs
 = 1;

102 
´og_pids
[0] = 0x68;

103 
´og_ty³
[0] = 
MPEG2_VIDEO_STREAM_TYPE
;

104 
pü_pid
 = 0x68;

106 ià(
»ad”
->
audio_¡»am_id
 != 0)

108 
´og_pids
[1] = 0x67;

109 
´og_ty³
[1] = 
MPEG2_AUDIO_STREAM_TYPE
;

110 
num_´ogs
 = 2;

112 
pmt_pid
 = 0x66;

115 
”r
 = 
	`wr™e_TS_´og¿m_d©a2
(
ouut
,

117 
»ad”
->
´og¿m_numb”
,

118 
pmt_pid
,
pü_pid
,

119 
num_´ogs
,
´og_pids
,
´og_ty³
);

120 ià(
”r
)

122 
	`årštf
(
¡d”r
,"### Error writing out TS…rogram data\n");

127 
	}
}

134 
	$¶ay_³s_·ck‘s
(
PES_»ad”_p
 
»ad”
,

135 
TS_wr™”_p
 
ouut
)

137 
”r
;

138 
ii
;

139 
·d_¡¬t
 = 8;

140 
šdex
 = 0;

142 
ES_p
 
es
;

147 
ii
=0; ii<
·d_¡¬t
; ii++)

149 
”r
 = 
	`wr™e_TS_nuÎ_·ck‘
(
ouut
);

150 ià(
”r
)  1;

154 
”r
 = 
	`bud_–em’ry_¡»am_PES
(
»ad”
,&
es
);

155 ià(
”r
)

157 
	`årštf
(
¡d”r
,"### Errorryingo build ES„eader from PES„eader\n");

163 
h262_™em_p
 
™em
;

165 ià(
šdex
 % 500 == 0)

168 
”r
 = 
	`wr™e_´og¿m_d©a_A
(
»ad”
,
ouut
);

169 ià(
”r
)  1;

173 
šdex
++;

175 
”r
 = 
	`fšd_Ãxt_h262_™em
(
es
,&
™em
);

176 ià(
”r
 =ğ
EOF
)

178 ià(
”r
)

180 
	`årštf
(
¡d”r
,"### Error copying NAL units\n");

181  
”r
;

184 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
,
™em
->
un™
.
d©a
,

185 
™em
->
un™
.
d©a_Ën
,
DEFAULT_VIDEO_PID
,

186 
DEFAULT_VIDEO_STREAM_ID
);

187 ià(
”r
)

189 
	`årštf
(
¡d”r
,"### Error writing MPEG2 item\n");

190  
”r
;

193 
	`ä“_h262_™em
(&
™em
);

196 
	`şo£_–em’ry_¡»am
(&
es
);

198 
	}
}

200 
	$‹¡1
(
PES_»ad”_p
 
»ad”
,

201 
v”bo£
)

203 
PES_·ck‘_d©a_p
 
·ck‘
;

204 
ii
;

205 
”r
;

206 
by‹
 *
Şd_d©a
;

207 
ušt32_t
 
Şd_d©a_Ën
;

209 ià(
v”bo£
)

210 
	`´štf
("-------------------------- Test 1 --------------------------\n");

211 
ii
 = 0; ii < 10; ii++)

213 
”r
 = 
	`»ad_Ãxt_PES_·ck‘
(
»ad”
);

214 ià(
”r
 =ğ
EOF
)

216 ià(
»ad”
->
give_šfo
è
	`´štf
("EOF\n");

219 ià(
”r
)

221 
	`årštf
(
¡d”r
,"###est_pes: Error„eading‚ext PES…acket\n");

224 
·ck‘
 = 
»ad”
->packet;

225 ià(
v”bo£
)

227 
	`´štf
("\n>> PS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 " is %02x (",

228 
·ck‘
->
po¢
,·ck‘->
d©a
[3]);

229 
	`´št_¡»am_id
(
TRUE
,
·ck‘
->
d©a
[3]);

230 
	`´štf
(")\n");

231 
	`´št_d©a
(
TRUE
," D©a",
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,20);

233 
”r
 = 
	`»pÜt_PES_d©a_¬¿y
("",
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,
FALSE
);

234 ià(
”r
)  1;

238 
”r
 = 
	`»ad_Ãxt_PES_·ck‘
(
»ad”
);

239 ià(
”r
)

241 
	`årštf
(
¡d”r
,"###est_pes: Error„eading‚ext PES…acket\n");

244 
·ck‘
 = 
»ad”
->packet;

245 ià(
v”bo£
)

247 
	`´štf
("\n>> PS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 " is %02x (",

248 
·ck‘
->
po¢
,·ck‘->
d©a
[3]);

249 
	`´št_¡»am_id
(
TRUE
,
·ck‘
->
d©a
[3]);

250 
	`´štf
(")\n");

251 
	`´št_d©a
(
TRUE
," D©a",
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,20);

254 
Şd_d©a
 = 
	`m®loc
(
·ck‘
->
d©a_Ën
);

255 ià(
Şd_d©a
 =ğ
NULL
)

257 
	`årštf
(
¡d”r
,"### Error‡llocating data‡rray\n");

260 
	`memıy
(
Şd_d©a
,
·ck‘
->
d©a
,·ck‘->
d©a_Ën
);

261 
Şd_d©a_Ën
 = 
·ck‘
->
d©a_Ën
;

263 ià(
v”bo£
)

264 
	`´štf
("\n** Rewindingohe start of said…acket‡gain\n");

265 
”r
 = 
	`£t_PES_»ad”_pos™iÚ
(
»ad”
,
·ck‘
->
po¢
);

266 ià(
”r
)

268 
	`årštf
(
¡d”r
,"###est_pes: Error seekingo…revious PES…acket\n");

269 
	`ä“
(
Şd_d©a
);

273 ià(
v”bo£
)

274 
	`´štf
("** Reading…ackethe secondime\n");

275 
”r
 = 
	`»ad_Ãxt_PES_·ck‘
(
»ad”
);

276 ià(
”r
)

278 
	`årštf
(
¡d”r
,"###est_pes: Error„eading‚ext PES…acket\n");

279 
	`ä“
(
Şd_d©a
);

282 
·ck‘
 = 
»ad”
->packet;

283 ià(
v”bo£
)

285 
	`´štf
("\n>> PS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 " is %02x (",

286 
·ck‘
->
po¢
,·ck‘->
d©a
[3]);

287 
	`´št_¡»am_id
(
TRUE
,
·ck‘
->
d©a
[3]);

288 
	`´štf
(")\n");

289 
	`´št_d©a
(
TRUE
," D©a",
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,20);

291 ià(
·ck‘
->
d©a_Ën
 !ğ
Şd_d©a_Ën
)

293 
	`årštf
(
¡d”r
,

295 
Şd_d©a_Ën
,
·ck‘
->
d©a_Ën
);

296 
	`ä“
(
Şd_d©a
);

299 ià(
	`memcmp
(
·ck‘
->
d©a
,
Şd_d©a
,·ck‘->
d©a_Ën
))

301 
	`årštf
(
¡d”r
,"### Test1:…acket data differs\n");

302 
	`´št_d©a
(
FALSE
," Pack‘ 1",
Şd_d©a
,
Şd_d©a_Ën
,50);

303 
	`´št_d©a
(
FALSE
," Pack‘ 2",
·ck‘
->
d©a
,·ck‘->
d©a_Ën
,50);

304 
	`ä“
(
Şd_d©a
);

307 ià(
v”bo£
)

308 
	`´štf
("------------------------------------------------------------\n");

311 
	`ä“
(
Şd_d©a
);

314 
	}
}

316 
	$´št_u§ge
()

318 
	`´štf
(

322 
	`REPORT_VERSION
("test_pes");

323 
	`´štf
(

340 
	}
}

342 
	$maš
(
¬gc
, **
¬gv
)

344 *
šput_Çme
 = 
NULL
;

345 *
ouut_Çme
 = 
NULL
;

346 
had_šput_Çme
 = 
FALSE
;

347 
had_ouut_Çme
 = 
FALSE
;

348 
pÜt
 = 88;

349 
PES_»ad”_p
 
»ad”
 = 
NULL
;

350 
TS_wr™”_p
 
ouut
 = 
NULL
;

351 
qu›t
 = 
FALSE
;

352 
v”bo£
 = 
FALSE
;

353 
video_Úly
 = 
FALSE
;

354 
wªt_ouut
 = 
TRUE
;

356 
”r
;

357 
ii
 = 1;

359 ià(
¬gc
 < 2)

361 
	`´št_u§ge
();

364 
ii
 < 
¬gc
)

366 ià(
¬gv
[
ii
][0] == '-')

368 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

369 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

371 
	`´št_u§ge
();

374 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

376 
qu›t
 = 
TRUE
;

377 
v”bo£
 = 
FALSE
;

379 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

381 
v”bo£
 = 
TRUE
;

382 
qu›t
 = 
FALSE
;

384 ià(!
	`¡rcmp
("-nßudio",
¬gv
[
ii
]))

386 
video_Úly
 = 
TRUE
;

388 ià(!
	`¡rcmp
("-noho¡",
¬gv
[
ii
]))

390 
wªt_ouut
 = 
FALSE
;

394 
	`årštf
(
¡d”r
,"###est_pes: "

395 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

401 ià(
had_šput_Çme
 && (
wªt_ouut
 && 
had_ouut_Çme
))

403 
	`årštf
(
¡d”r
,"###e¡_³s: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

406 ià(
had_šput_Çme
 && 
wªt_ouut
)

408 
”r
 = 
	`ho¡_v®ue
("‹¡_³s",
NULL
,
¬gv
[
ii
],&
ouut_Çme
,&
pÜt
);

409 ià(
”r
)  1;

410 
had_ouut_Çme
 = 
TRUE
;

411 
ii
++;

415 
šput_Çme
 = 
¬gv
[
ii
];

416 
had_šput_Çme
 = 
TRUE
;

419 
ii
++;

422 ià(!
had_šput_Çme
)

424 
	`årštf
(
¡d”r
,"###est_pes: No input file specified\n");

427 ià(
wªt_ouut
 && !
had_ouut_Çme
)

429 
	`årštf
(
¡d”r
,"###est_pes: Noarget host specified\n");

433 
”r
 = 
	`İ’_PES_»ad”
(
šput_Çme
,!
qu›t
,!qu›t,&
»ad”
);

434 ià(
”r
)

436 
	`årštf
(
¡d”r
,"###e¡_³s: E¼Ü o³nšg f%s\n",
šput_Çme
);

440 ià(!
qu›t
)

441 
	`´štf
("O³Ãd f% × %s)\n",
šput_Çme
,(
»ad”
->
is_TS
?"TS":"PS"));

443 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

445 ià(
wªt_ouut
)

447 
”r
 = 
	`tswr™e_İ’
(
TS_W_TCP
,
ouut_Çme
,
NULL
,
pÜt
,
qu›t
,&
ouut
);

448 ià(
”r
)

450 (è
	`şo£_PES_»ad”
(&
»ad”
);

451 
	`årštf
(
¡d”r
,"###e¡_³s: UÇbËØcÚÃùØ%s\n",
ouut_Çme
);

456 
”r
 = 
	`‹¡1
(
»ad”
,
v”bo£
);

457 ià(
”r
)

459 
	`årštf
(
¡d”r
,"###est_pes: Test 1 failed\n");

460 (è
	`şo£_PES_»ad”
(&
»ad”
);

461 (è
	`tswr™e_şo£
(
ouut
,
TRUE
);

464 ià(!
qu›t
)

465 
	`´štf
("** Test 1…assed\n"

467 
”r
 = 
	`£t_PES_»ad”_pos™iÚ
(
»ad”
,0);

468 ià(
”r
)

470 
	`årštf
(
¡d”r
,"###est_pes: Error seekingo…revious PES…acket\n");

474 ià(
wªt_ouut
)

476 
”r
 = 
	`¶ay_³s_·ck‘s
(
»ad”
,
ouut
);

477 ià(
”r
)

479 
	`årštf
(
¡d”r
,"###est_pes: Error…laying PES…ackets\n");

480 (è
	`şo£_PES_»ad”
(&
»ad”
);

481 (è
	`tswr™e_şo£
(
ouut
,
TRUE
);

486 ià(
wªt_ouut
)

488 
”r
 = 
	`tswr™e_şo£
(
ouut
,
qu›t
);

489 ià(
”r
)

490 
	`årštf
(
¡d”r
,"###e¡_³s: E¼Ü closšg ouuˆ%s: %s\n",
ouut_Çme
,

491 
	`¡»¼Ü
(
”ºo
));

493 
”r
 = 
	`şo£_PES_»ad”
(&
»ad”
);

494 ià(
”r
)

496 
	`årštf
(
¡d”r
,"###e¡_³s: E¼Ü closšg f%s\n",
šput_Çme
);

501 
	}
}

	@test_printing.c

29 
	~<¡dio.h
>

31 
	~"´štšg_âs.h
"

32 
	~"v”siÚ.h
"

36 
	$´št_mes§ge_to_¡dout
(cÚ¡ *
mes§ge
)

38 (è
	`´štf
("<<<MSG>>> %s",
mes§ge
);

39 
	}
}

40 
	$´št_mes§ge_to_¡d”r
(cÚ¡ *
mes§ge
)

42 (è
	`´štf
("<<<ERR>>> %s",
mes§ge
);

43 
	}
}

44 
	$åršt_mes§ge_to_¡dout
(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
)

46 
	`´štf
("<<<MSG>>> ");

47 (è
	`vårštf
(
¡dout
, 
fÜm©
, 
¬g_±r
);

48 
	}
}

49 
	$åršt_mes§ge_to_¡d”r
(cÚ¡ *
fÜm©
, 
va_li¡
 
¬g_±r
)

51 
	`´štf
("<<<ERR>>> ");

52 (è
	`vårštf
(
¡dout
, 
fÜm©
, 
¬g_±r
);

53 
	}
}

55 
	$´št_u§ge
()

57 
	`´štf
(

61 
	`REPORT_VERSION
("test_printing");

62 
	`´štf
(

66 
	}
}

68 
	$maš
(
¬gc
, **
¬gv
)

70 
”r
;

72 ià(
¬gc
 > 1)

74 
	`´št_u§ge
();

78 
	`´štf
("A fairly crude set ofests, mainlyo checkhat‚othing falls over.\n");

79 
	`´štf
("Forƒach set ofests, you should see 4 messages,‡ll very similar.\n");

81 
	`´štf
("------------------------------------\n");

82 
	`´štf
("Testinghe default output functions\n");

83 
	`´štf
("------------------------------------\n");

84 
	`´št_msg
("1. Printing‡‚ormal message\n");

85 
	`´št_”r
("2. Printing‡nƒrror message\n");

86 
	`åršt_msg
("3. Printing‡ formatted '%s'\n","message");

87 
	`åršt_”r
("4. Printing‡ formatted '%s'\n","error");

89 
	`´štf
("-------------------------------------------\n");

90 
	`´štf
("Choosing 'traditional' output‡nd„epeating\n");

91 
	`´štf
("-------------------------------------------\n");

92 
	`»dœeù_ouut_¡d”r
();

93 
	`´št_msg
("1. Printing‡‚ormal message\n");

94 
	`´št_”r
("2. Printing‡nƒrror message\n");

95 
	`åršt_msg
("3. Printing‡ formatted '%s'\n","message");

96 
	`åršt_”r
("4. Printing‡ formatted '%s'\n","error");

98 
	`´štf
("---------------------------------------------\n");

99 
	`´štf
("Choosing 'all outputo stdout'‡nd„epeating\n");

100 
	`´štf
("---------------------------------------------\n");

101 
	`»dœeù_ouut_¡dout
();

102 
	`´št_msg
("1. Printing‡‚ormal message\n");

103 
	`´št_”r
("2. Printing‡nƒrror message\n");

104 
	`åršt_msg
("3. Printing‡ formatted '%s'\n","message");

105 
	`åršt_”r
("4. Printing‡ formatted '%s'\n","error");

107 
	`´štf
("-----------------------------------------\n");

108 
	`´štf
("Choosing 'custom functions'‡nd„epeating\n");

109 
	`´štf
("-----------------------------------------\n");

110 
”r
 = 
	`»dœeù_ouut
(
´št_mes§ge_to_¡dout
,

111 
´št_mes§ge_to_¡d”r
,

112 
åršt_mes§ge_to_¡dout
,

113 
åršt_mes§ge_to_¡d”r
);

114 ià(
”r
)

116 
	`´štf
("Oİ --h© w’ˆwrÚg: %d\n",
”r
);

119 
	`´št_msg
("1. Printing‡‚ormal message\n");

120 
	`´št_”r
("2. Printing‡nƒrror message\n");

121 
	`åršt_msg
("3. Printing‡ formatted '%s'\n","message");

122 
	`åršt_”r
("4. Printing‡ formatted '%s'\n","error");

124 
	`´štf
("---------------------------------------------\n");

125 
	`´štf
("Tryingo choose only *some* custom functions\n");

126 
	`´štf
("---------------------------------------------\n");

127 
”r
 = 
	`»dœeù_ouut
(
´št_mes§ge_to_¡dout
,

128 
´št_mes§ge_to_¡d”r
,

129 
NULL
,

130 
åršt_mes§ge_to_¡d”r
);

131 ià(
”r
 == 0)

133 
	`´štf
("Oh d—r,h©‡µ—»dØwÜk: %d\n",
”r
);

134 
	`´štf
("So what happens if wery ourests‡gain?\n");

135 
	`´št_msg
("1. Printing‡‚ormal message\n");

136 
	`´št_”r
("2. Printing‡nƒrror message\n");

137 
	`åršt_msg
("3. Printing‡ formatted '%s'\n","message");

138 
	`åršt_”r
("4. Printing‡ formatted '%s'\n","error");

141 
	`´štf
("Which failed - good\n");

143 
	`´štf
("------------------------------------------------------------------\n");

144 
	`´štf
("Afterhat (expected) failure,‡ll four messages should still work\n");

145 
	`´štf
("------------------------------------------------------------------\n");

146 
	`´št_msg
("1. Printing‡‚ormal message\n");

147 
	`´št_”r
("2. Printing‡nƒrror message\n");

148 
	`åršt_msg
("3. Printing‡ formatted '%s'\n","message");

149 
	`åršt_”r
("4. Printing‡ formatted '%s'\n","error");

152 
	}
}

	@ts.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<ùy³.h
>

33 
	~<”ºo.h
>

34 #ifdeà
_WIN32


35 
	~<io.h
>

37 
	~<uni¡d.h
>

40 
	~"com·t.h
"

41 
	~"ts_âs.h
"

42 
	~"tswr™e_âs.h
"

43 
	~"misc_âs.h
"

44 
	~"´štšg_âs.h
"

45 
	~"pidšt_âs.h
"

46 
	~"³s_âs.h
"

48 
	#DEBUG
 0

	)

49 
	#DEBUG_DTS
 0

	)

50 
	#DEBUG_WRITE_PACKETS
 0

	)

56 
	g»pÜt_bad_»£rved_b™s
 = 
FALSE
;

67 
	gcÚtšu™y_couÁ”
[0x1fff+1] = {0};

73 
šlše
 
	$Ãxt_cÚtšu™y_couÁ
(
ušt32_t
 
pid
)

75 
ušt32_t
 
Ãxt
 = (
cÚtšu™y_couÁ”
[
pid
] + 1) & 0x0f;

76 
cÚtšu™y_couÁ”
[
pid
] = 
Ãxt
;

77  
Ãxt
;

78 
	}
}

103 
	$PES_h—d”
(
ušt32_t
 
d©a_Ën
,

104 
by‹
 
¡»am_id
,

105 
w™h_PTS
,

106 
ušt64_t
 
±s
,

107 
w™h_DTS
,

108 
ušt64_t
 
dts
,

109 
by‹
 *
PES_hdr
,

110 *
PES_hdr_Ën
)

112 
exŒa_Ën
 = 0;

114 ià(
w™h_DTS
 && !
w™h_PTS
)

116 
w™h_PTS
 = 
TRUE
;

117 
±s
 = 
dts
;

121 ià(
w™h_DTS
 && 
±s
 =ğ
dts
)

122 
w™h_DTS
 = 
FALSE
;

125 
PES_hdr
[0] = 0x00;

126 
PES_hdr
[1] = 0x00;

127 
PES_hdr
[2] = 0x01;

129 
PES_hdr
[3] = 
¡»am_id
;

138 ià(
	`IS_AUDIO_STREAM_ID
(
¡»am_id
))

139 
PES_hdr
[6] = 0x84;

141 
PES_hdr
[6] = 0x80;

144 ià(
w™h_DTS
 && 
w™h_PTS
)

145 
PES_hdr
[7] = 0xC0;

146 ià(
w™h_PTS
)

147 
PES_hdr
[7] = 0x80;

149 
PES_hdr
[7] = 0x00;

152 ià(
w™h_DTS
 && 
w™h_PTS
)

154 
PES_hdr
[8] = 0x0A;

155 
	`’code_±s_dts
(&(
PES_hdr
[9]),3,
±s
);

156 
	`’code_±s_dts
(&(
PES_hdr
[14]),1,
dts
);

157 *
PES_hdr_Ën
 = 9 + 10;

158 
exŒa_Ën
 = 3 + 10;

160 ià(
w™h_PTS
)

162 
PES_hdr
[8] = 0x05;

163 
	`’code_±s_dts
(&(
PES_hdr
[9]),2,
±s
);

164 *
PES_hdr_Ën
 = 9 + 5;

165 
exŒa_Ën
 = 3 + 5;

169 
PES_hdr
[8] = 0x00;

170 *
PES_hdr_Ën
 = 9;

171 
exŒa_Ën
 = 3;

175 ià(
d©a_Ën
 > 0xFFFF || (d©a_ËÀ+ 
exŒa_Ën
) > 0xFFFF)

180 
PES_hdr
[4] = 0;

181 
PES_hdr
[5] = 0;

188 
d©a_Ën
 +ğ
exŒa_Ën
;

189 
PES_hdr
[4] = (
by‹
è((
d©a_Ën
 & 0xFF00) >> 8);

190 
PES_hdr
[5] = (
by‹
è((
d©a_Ën
 & 0x00FF));

192 
	}
}

227 
	$wr™e_TS_·ck‘_·¹s
(
TS_wr™”_p
 
ouut
,

228 
by‹
 
TS_·ck‘
[
TS_PACKET_SIZE
],

229 
TS_hdr_Ën
,

230 
by‹
 
³s_hdr
[],

231 
³s_hdr_Ën
,

232 
by‹
 
d©a
[],

233 
d©a_Ën
,

234 
ušt32_t
 
pid
,

235 
gÙ_pü
,

236 
ušt64_t
 
pü
)

238 
”r
;

239 
tÙ®_Ën
 = 
TS_hdr_Ën
 + 
³s_hdr_Ën
 + 
d©a_Ën
;

241 ià(
tÙ®_Ën
 !ğ
TS_PACKET_SIZE
)

243 
	`åršt_”r
("### TS…acket†ength is %d,‚ot 188 (composed of %d + %d + %d)\n",

244 
tÙ®_Ën
,
TS_hdr_Ën
,
³s_hdr_Ën
,
d©a_Ën
);

250 ià(
³s_hdr_Ën
 > 0)

251 
	`memıy
(&(
TS_·ck‘
[
TS_hdr_Ën
]),
³s_hdr
,
³s_hdr_Ën
);

253 ià(
d©a_Ën
 > 0)

254 
	`memıy
(&(
TS_·ck‘
[
TS_hdr_Ën
+
³s_hdr_Ën
]),
d©a
,
d©a_Ën
);

256 
”r
 = 
	`tswr™e_wr™e
(
ouut
,
TS_·ck‘
,
pid
,
gÙ_pü
,
pü
);

257 ià(
”r
)

259 
	`åršt_”r
("### E¼Ü wr™šg ouˆTS…ack‘: %s\n",
	`¡»¼Ü
(
”ºo
));

263 
	}
}

289 
	$wr™e_some_TS_PES_·ck‘
(
TS_wr™”_p
 
ouut
,

290 
by‹
 *
³s_hdr
,

291 
³s_hdr_Ën
,

292 
by‹
 *
d©a
,

293 
ušt32_t
 
d©a_Ën
,

294 
¡¬t
,

295 
£t_pusi
,

296 
ušt32_t
 
pid
,

297 
by‹
 
¡»am_id
,

298 
gÙ_PCR
,

299 
ušt64_t
 
PCR_ba£
,

300 
ušt32_t
 
PCR_exŠ
)

302 
	#DEBUG_THIS
 0

	)

303 
by‹
 
TS_·ck‘
[
TS_PACKET_SIZE
];

304 
TS_hdr_Ën
;

305 
ušt32_t
 
cÚŒŞs
 = 0;

306 
ušt32_t
 
³s_d©a_Ën
 = 0;

307 
”r
;

308 
gÙ_ad­tiÚ_f›ld
 = 
FALSE
;

309 
ušt32_t
 
¥aû_Ëá
;

311 ià(
pid
 < 0x0010 ||…id > 0x1ffe)

313 
	`åršt_”r
("### PID %03x i outsidËg®…rog¿m sŒ—m„ªge",
pid
);

320 ià(
³s_hdr
)

321 
³s_d©a_Ën
 = 
d©a_Ën
 + 
³s_hdr_Ën
;

324 
³s_hdr_Ën
 = 0;

325 
³s_d©a_Ën
 = 
d©a_Ën
;

328 #ià
DEBUG_THIS


329 ià(
¡¬t
)

330 
	`´št_msg
("TS_PES ");

332 
	`´št_msg
(" ");

333 
	`´št_d©a
(
TRUE
,"",
d©a
,
d©a_Ën
,20);

338 
TS_·ck‘
[0] = 0x47;

341 ià(
¡¬t
 && 
£t_pusi
)

342 
TS_·ck‘
[1] = (
by‹
)(0x40 | ((
pid
 & 0x1f00) >> 8));

344 
TS_·ck‘
[1] = (
by‹
)(0x00 | ((
pid
 & 0x1f00) >> 8));

345 
TS_·ck‘
[2] = (
by‹
)(
pid
 & 0xff);

348 ià(
¡¬t
 && 
gÙ_PCR
)

352 
cÚŒŞs
 = 0x30;

353 
TS_·ck‘
[3] = (
by‹
è(
cÚŒŞs
 | 
	`Ãxt_cÚtšu™y_couÁ
(
pid
));

355 
TS_·ck‘
[4] = 7;

356 
TS_·ck‘
[5] = 0x10;

357 
TS_·ck‘
[6] = (
by‹
è(
PCR_ba£
 >> 25);

358 
TS_·ck‘
[7] = (
by‹
è((
PCR_ba£
 >> 17) & 0xFF);

359 
TS_·ck‘
[8] = (
by‹
è((
PCR_ba£
 >> 9) & 0xFF);

360 
TS_·ck‘
[9] = (
by‹
è((
PCR_ba£
 >> 1) & 0xFF);

361 
TS_·ck‘
[10] = (
by‹
è(((
PCR_ba£
 & 0x1è<< 7è| 0x7E | (
PCR_exŠ
 >> 8));

362 
TS_·ck‘
[11] = (
by‹
è(
PCR_exŠ
 >> 1);

363 
TS_hdr_Ën
 = 12;

364 
¥aû_Ëá
 = 
MAX_TS_PAYLOAD_SIZE
 - 8;

365 
gÙ_ad­tiÚ_f›ld
 = 
TRUE
;

366 #ià
DEBUG_THIS


367 
	`åršt_msg
(" s¹ & gÙ_PCR -> w™h‡d­tiÚ f›ld, s·û†eá %d, TS_·ck‘[4] %d\n",
¥aû_Ëá
,
TS_·ck‘
[4]);

370 ià(
³s_d©a_Ën
 < 
MAX_TS_PAYLOAD_SIZE
)

375 
cÚŒŞs
 = 0x30;

376 
TS_·ck‘
[3] = (
by‹
)(
cÚŒŞs
 | 
	`Ãxt_cÚtšu™y_couÁ
(
pid
));

377 ià(
³s_d©a_Ën
 =ğ(
MAX_TS_PAYLOAD_SIZE
 - 1))

379 
TS_·ck‘
[4] = 0;

380 
TS_hdr_Ën
 = 5;

381 
¥aû_Ëá
 = 
MAX_TS_PAYLOAD_SIZE
 - 1;

385 
TS_·ck‘
[4] = 1;

386 
TS_·ck‘
[5] = 0;

387 
TS_hdr_Ën
 = 6;

388 
¥aû_Ëá
 = 
MAX_TS_PAYLOAD_SIZE
 - 2;

390 
gÙ_ad­tiÚ_f›ld
 = 
TRUE
;

391 #ià
DEBUG_THIS


392 
	`åršt_msg
(" <184,…ad w™hƒm±y‡d­tiÚ f›ld, s·û†eá %d, TS_·ck‘[4] %d\n",
¥aû_Ëá
,
TS_·ck‘
[4]);

400 
cÚŒŞs
 = 0x10;

401 
TS_·ck‘
[3] = (
by‹
)(
cÚŒŞs
 | 
	`Ãxt_cÚtšu™y_couÁ
(
pid
));

402 
TS_hdr_Ën
 = 4;

403 
¥aû_Ëá
 = 
MAX_TS_PAYLOAD_SIZE
;

404 #ià
DEBUG_THIS


405 
	`åršt_msg
(" >=184, s·û†eá %d\n",
¥aû_Ëá
);

409 ià(
gÙ_ad­tiÚ_f›ld
)

412 ià(
³s_d©a_Ën
 < 
¥aû_Ëá
)

414 
ii
;

415 
·dËn
 = 
¥aû_Ëá
 - 
³s_d©a_Ën
;

416 
ii
 = 0; i˜< 
·dËn
; ii++)

417 
TS_·ck‘
[
TS_hdr_Ën
+
ii
] = 0xFF;

418 
TS_·ck‘
[4] +ğ
·dËn
;

419 
TS_hdr_Ën
 +ğ
·dËn
;

420 
¥aû_Ëá
 -ğ
·dËn
;

421 #ià
DEBUG_THIS


422 
	`åršt_msg
(" stuffšg %d, s·û†eá %d, TS_·ck‘[4] %d\n",
·dËn
,
¥aû_Ëá
,
TS_·ck‘
[4]);

427 ià(
³s_d©a_Ën
 =ğ
¥aû_Ëá
)

429 #ià
DEBUG_THIS


430 
	`´št_msg
(" == fitsƒxactly\n");

433 
”r
 = 
	`wr™e_TS_·ck‘_·¹s
(
ouut
,

434 
TS_·ck‘
,
TS_hdr_Ën
,

435 
³s_hdr
,
³s_hdr_Ën
,

436 
d©a
,
d©a_Ën
,

437 
pid
,
gÙ_PCR
,(
PCR_ba£
*300)+
PCR_exŠ
);

438 ià(
”r
) ƒrr;

444 
šüem’t
 = 
¥aû_Ëá
 - 
³s_hdr_Ën
;

445 
”r
 = 
	`wr™e_TS_·ck‘_·¹s
(
ouut
,

446 
TS_·ck‘
,
TS_hdr_Ën
,

447 
³s_hdr
,
³s_hdr_Ën
,

448 
d©a
,
šüem’t
,

449 
pid
,
gÙ_PCR
,(
PCR_ba£
*300)+
PCR_exŠ
);

450 ià(
”r
) ƒrr;

451 #ià
DEBUG_THIS


452 
	`åršt_msg
(" =ğwrÙ%d,†—všg %d\n",
šüem’t
,
d©a_Ën
-increment);

456 ià((
d©a_Ën
 - 
šüem’t
) > 0)

458 
”r
 = 
	`wr™e_some_TS_PES_·ck‘
(
ouut
,
NULL
,0,

459 &(
d©a
[
šüem’t
]),
d©a_Ën
-increment,

460 
FALSE
,FALSE,
pid
,
¡»am_id
,FALSE,0,0);

461 ià(
”r
) ƒrr;

465 
	}
}

485 
	$wr™e_ES_as_TS_PES_·ck‘
(
TS_wr™”_p
 
ouut
,

486 
by‹
 
d©a
[],

487 
ušt32_t
 
d©a_Ën
,

488 
ušt32_t
 
pid
,

489 
by‹
 
¡»am_id
)

491 
by‹
 
³s_hdr
[
TS_PACKET_SIZE
];

492 
³s_hdr_Ën
 = 0;

494 #ià
DEBUG_WRITE_PACKETS


495 
	`åršt_msg
("|| ES‡ TS/PES,…id %x (%d)\n",
pid
,pid);

498 
	`PES_h—d”
(
d©a_Ën
,
¡»am_id
,
FALSE
,0,FALSE,0,
³s_hdr
,&
³s_hdr_Ën
);

500  
	`wr™e_some_TS_PES_·ck‘
(
ouut
,
³s_hdr
,
³s_hdr_Ën
,

501 
d©a
,
d©a_Ën
,
TRUE
,TRUE,
pid
,
¡»am_id
,

502 
FALSE
,0,0);

503 
	}
}

538 
	$wr™e_ES_as_TS_PES_·ck‘_w™h_±s_dts
(
TS_wr™”_p
 
ouut
,

539 
by‹
 
d©a
[],

540 
ušt32_t
 
d©a_Ën
,

541 
ušt32_t
 
pid
,

542 
by‹
 
¡»am_id
,

543 
gÙ_±s
,

544 
ušt64_t
 
±s
,

545 
gÙ_dts
,

546 
ušt64_t
 
dts
)

548 
by‹
 
³s_hdr
[
TS_PACKET_SIZE
];

549 
³s_hdr_Ën
 = 0;

551 #ià
DEBUG_WRITE_PACKETS


552 
	`åršt_msg
("|| ES‡ TS/PES w™h PTS/DTS,…id %x (%d)\n",
pid
,pid);

555 
	`PES_h—d”
(
d©a_Ën
,
¡»am_id
,
gÙ_±s
,
±s
,
gÙ_dts
,
dts
,
³s_hdr
,&
³s_hdr_Ën
);

557  
	`wr™e_some_TS_PES_·ck‘
(
ouut
,
³s_hdr
,
³s_hdr_Ën
,

558 
d©a
,
d©a_Ën
,
TRUE
,TRUE,
pid
,
¡»am_id
,

559 
gÙ_dts
,
dts
,0);

560 
	}
}

581 
	$wr™e_ES_as_TS_PES_·ck‘_w™h_pü
(
TS_wr™”_p
 
ouut
,

582 
by‹
 
d©a
[],

583 
ušt32_t
 
d©a_Ën
,

584 
ušt32_t
 
pid
,

585 
by‹
 
¡»am_id
,

586 
ušt64_t
 
pü_ba£
,

587 
ušt32_t
 
pü_exŠ
)

589 
by‹
 
³s_hdr
[
TS_PACKET_SIZE
];

590 
³s_hdr_Ën
 = 0;

592 #ià
DEBUG_WRITE_PACKETS


593 
	`åršt_msg
("|| ES‡ TS/PES w™h PCR,…id %x (%d)\n",
pid
,pid);

596 
	`PES_h—d”
(
d©a_Ën
,
¡»am_id
,
FALSE
,0,FALSE,0,
³s_hdr
,&
³s_hdr_Ën
);

598  
	`wr™e_some_TS_PES_·ck‘
(
ouut
,
³s_hdr
,
³s_hdr_Ën
,

599 
d©a
,
d©a_Ën
,
TRUE
,TRUE,
pid
,
¡»am_id
,

600 
TRUE
,
pü_ba£
,
pü_exŠ
);

601 
	}
}

623 
	$wr™e_PES_as_TS_PES_·ck‘
(
TS_wr™”_p
 
ouut
,

624 
by‹
 
d©a
[],

625 
ušt32_t
 
d©a_Ën
,

626 
ušt32_t
 
pid
,

627 
by‹
 
¡»am_id
,

628 
gÙ_pü
,

629 
ušt64_t
 
pü_ba£
,

630 
ušt32_t
 
pü_exŠ
)

635 
	#MPEG1_AS_ES
 1

	)

637 #ià
DEBUG_WRITE_PACKETS


638 
	`åršt_msg
("|| PES‡ TS/PES,…id %x (%d)\n",
pid
,pid);

642 
	`´št_d©a
(
TRUE
,"TS_PES",
d©a
,
d©a_Ën
,20);

643 
	`´št_’d_of_d©a
(" ",
d©a
,
d©a_Ën
,20);

646 #ià
MPEG1_AS_ES


647 ià(
	`IS_H222_PES
(
d©a
))

650  
	`wr™e_some_TS_PES_·ck‘
(
ouut
,
NULL
,0,

651 
d©a
,
d©a_Ën
,
TRUE
,TRUE,
pid
,
¡»am_id
,

652 
gÙ_pü
,
pü_ba£
,
pü_exŠ
);

653 #ià
MPEG1_AS_ES


658 
gÙ_±s
, 
gÙ_dts
;

659 
ušt64_t
 
±s
, 
dts
;

660 
off£t
 = 
	`ÿlc_m³g1_³s_off£t
(
d©a
,
d©a_Ën
);

661 
”r
 = 
	`fšd_PTS_DTS_š_PES
(
d©a
,
d©a_Ën
,

662 &
gÙ_±s
,&
±s
,&
gÙ_dts
,&
dts
);

663 ià(
”r
)

665 
gÙ_±s
 = 
FALSE
;

666 
gÙ_dts
 = 
FALSE
;

668  
	`wr™e_ES_as_TS_PES_·ck‘_w™h_±s_dts
(
ouut
,

669 
d©a
 + 
off£t
,

670 
d©a_Ën
 - 
off£t
,

671 
pid
,

672 
¡»am_id
,

673 
gÙ_±s
,
±s
,

674 
gÙ_dts
,
dts
);

677 
	}
}

693 
	$TS_´og¿m_·ck‘_hdr
(
ušt32_t
 
pid
,

694 
d©a_Ën
,

695 
by‹
 
TS_hdr
[
TS_PACKET_SIZE
],

696 *
TS_hdr_Ën
)

698 
ušt32_t
 
cÚŒŞs
 = 0;

699 
poš‹r
, 
ii
;

701 ià(
d©a_Ën
 > (
TS_PACKET_SIZE
 - 5))

703 
	`åršt_”r
("### PMT/PAT data for PID %02x isoo†ong (%d > 183)",

704 
pid
,
d©a_Ën
);

711 
TS_hdr
[0] = 0x47;

713 
TS_hdr
[1] = (
by‹
)(0x40 | ((
pid
 & 0x1f00) >> 8));

714 
TS_hdr
[2] = (
by‹
)(
pid
 & 0xff);

716 
cÚŒŞs
 = 0x10;

717 
TS_hdr
[3] = (
by‹
)(
cÚŒŞs
 | 
	`Ãxt_cÚtšu™y_couÁ
(
pid
));

722 
poš‹r
 = (
by‹
)(
TS_PACKET_SIZE
 - 5 - 
d©a_Ën
);

723 
TS_hdr
[4] = 
poš‹r
;

724 
ii
=0; ii<
poš‹r
; ii++)

725 
TS_hdr
[5+
ii
] = 0xff;

727 *
TS_hdr_Ën
 = 5+
poš‹r
;

729 
	}
}

748 
	$wr™e_TS_´og¿m_d©a
(
TS_wr™”_p
 
ouut
,

749 
ušt32_t
 
Œª¥Üt_¡»am_id
,

750 
ušt32_t
 
´og¿m_numb”
,

751 
ušt32_t
 
pmt_pid
,

752 
ušt32_t
 
pid
,

753 
by‹
 
¡»am_ty³
)

755 
”r
;

756 
pidšt_li¡_p
 
´og_li¡
;

757 
pmt_p
 
pmt
;

760 
”r
 = 
	`bud_pidšt_li¡
(&
´og_li¡
);

761 ià(
”r
)  1;

762 
”r
 = 
	`­³nd_to_pidšt_li¡
(
´og_li¡
,
pmt_pid
,
´og¿m_numb”
);

763 ià(
”r
)

765 
	`ä“_pidšt_li¡
(&
´og_li¡
);

769 
pmt
 = 
	`bud_pmt
((
ušt16_t
)
´og¿m_numb”
,0,
pid
);

770 ià(
pmt
 =ğ
NULL
)

772 
	`ä“_pidšt_li¡
(&
´og_li¡
);

775 
”r
 = 
	`add_¡»am_to_pmt
(
pmt
,
pid
,
¡»am_ty³
,0,
NULL
);

776 ià(
”r
)

778 
	`ä“_pidšt_li¡
(&
´og_li¡
);

779 
	`ä“_pmt
(&
pmt
);

783 
”r
 = 
	`wr™e_·t_ªd_pmt
(
ouut
,
Œª¥Üt_¡»am_id
,
´og_li¡
,
pmt_pid
,
pmt
);

784 ià(
”r
)

786 
	`ä“_pidšt_li¡
(&
´og_li¡
);

787 
	`ä“_pmt
(&
pmt
);

791 
	`ä“_pidšt_li¡
(&
´og_li¡
);

792 
	`ä“_pmt
(&
pmt
);

794 
	}
}

812 
	$wr™e_TS_´og¿m_d©a2
(
TS_wr™”_p
 
ouut
,

813 
ušt32_t
 
Œª¥Üt_¡»am_id
,

814 
ušt32_t
 
´og¿m_numb”
,

815 
ušt32_t
 
pmt_pid
,

816 
ušt32_t
 
pü_pid
,

817 
num_´ogs
,

818 
ušt32_t
 
´og_pid
[],

819 
by‹
 
´og_ty³
[])

821 
”r
;

822 
ii
;

823 
pidšt_li¡_p
 
´og_li¡
;

824 
pmt_p
 
pmt
;

827 
”r
 = 
	`bud_pidšt_li¡
(&
´og_li¡
);

828 ià(
”r
)  1;

829 
”r
 = 
	`­³nd_to_pidšt_li¡
(
´og_li¡
,
pmt_pid
,
´og¿m_numb”
);

830 ià(
”r
)

832 
	`ä“_pidšt_li¡
(&
´og_li¡
);

836 
pmt
 = 
	`bud_pmt
((
ušt16_t
)
´og¿m_numb”
,0,
pü_pid
);

837 ià(
pmt
 =ğ
NULL
)

839 
	`ä“_pidšt_li¡
(&
´og_li¡
);

842 
ii
=0; ii<
num_´ogs
; ii++)

844 
”r
 = 
	`add_¡»am_to_pmt
(
pmt
,
´og_pid
[
ii
],
´og_ty³
[ii],0,
NULL
);

845 ià(
”r
)

847 
	`ä“_pidšt_li¡
(&
´og_li¡
);

848 
	`ä“_pmt
(&
pmt
);

853 
”r
 = 
	`wr™e_·t_ªd_pmt
(
ouut
,
Œª¥Üt_¡»am_id
,
´og_li¡
,
pmt_pid
,
pmt
);

854 ià(
”r
)

856 
	`ä“_pidšt_li¡
(&
´og_li¡
);

857 
	`ä“_pmt
(&
pmt
);

861 
	`ä“_pidšt_li¡
(&
´og_li¡
);

862 
	`ä“_pmt
(&
pmt
);

864 
	}
}

875 
	$wr™e_·t
(
TS_wr™”_p
 
ouut
,

876 
ušt32_t
 
Œª¥Üt_¡»am_id
,

877 
pidšt_li¡_p
 
´og_li¡
)

879 
ii
;

880 
by‹
 
d©a
[1021+3];

881 
by‹
 
TS_·ck‘
[
TS_PACKET_SIZE
];

882 
TS_hdr_Ën
;

883 
”r
;

884 
£ùiÚ_Ëngth
;

885 
off£t
, 
d©a_Ëngth
;

886 
ušt32_t
 
üc32
;

888 #ià
DEBUG_WRITE_PACKETS


889 
	`´št_msg
("|| PAT…id 0\n");

892 
£ùiÚ_Ëngth
 = 9 + 
´og_li¡
->
Ëngth
 * 4;

893 ià(
£ùiÚ_Ëngth
 > 1021)

895 
	`´št_”r
("### PAT data isoo†ong - will‚ot fit in 1021 bytes\n");

897 
	`»pÜt_pidšt_li¡
(
´og_li¡
,"Prog¿m†i¡","Prog¿m",
FALSE
);

901 
d©a
[0] = 0x00;

903 
d©a
[1] = (
by‹
è(0xb0 | ((
£ùiÚ_Ëngth
 & 0x0F00) >> 8));

904 
d©a
[2] = (
by‹
è(
£ùiÚ_Ëngth
 & 0x0FF);

905 
d©a
[3] = (
by‹
è((
Œª¥Üt_¡»am_id
 & 0xFF00) >> 8);

906 
d©a
[4] = (
by‹
è(
Œª¥Üt_¡»am_id
 & 0x00FF);

908 
d©a
[5] = 0xc1;

911 
d©a
[6] = 0x00;

912 
d©a
[7] = 0x00;

914 
off£t
 = 8;

915 
ii
 = 0; i˜< 
´og_li¡
->
Ëngth
; ii++)

917 
d©a
[
off£t
+0] = (
by‹
è((
´og_li¡
->
numb”
[
ii
] & 0xFF00) >> 8);

918 
d©a
[
off£t
+1] = (
by‹
è(
´og_li¡
->
numb”
[
ii
] & 0x00FF);

919 
d©a
[
off£t
+2] = (
by‹
è(0xE0 | ((
´og_li¡
->
pid
[
ii
] & 0x1F00) >> 8));

920 
d©a
[
off£t
+3] = (
by‹
è(
´og_li¡
->
pid
[
ii
] & 0x00FF);

921 
off£t
 += 4;

924 
üc32
 = 
	`üc32_block
(0xffffffff,
d©a
,
off£t
);

925 
d©a
[12] = (
by‹
è((
üc32
 & 0xff000000) >> 24);

926 
d©a
[13] = (
by‹
è((
üc32
 & 0x00ff0000) >> 16);

927 
d©a
[14] = (
by‹
è((
üc32
 & 0x0000ff00) >> 8);

928 
d©a
[15] = (
by‹
è(
üc32
 & 0x000000ff);

929 
d©a_Ëngth
 = 
off£t
+4;

932 ià(
d©a_Ëngth
 !ğ
£ùiÚ_Ëngth
 + 3)

934 
	`åršt_”r
("### PAT†ength %d, section†ength+3 %d\n",

935 
d©a_Ëngth
,
£ùiÚ_Ëngth
+3);

940 
üc32
 = 
	`üc32_block
(0xffffffff,
d©a
,
d©a_Ëngth
);

941 ià(
üc32
 != 0)

943 
	`´št_”r
("### PAT CRC does‚ot self-cancel\n");

946 
”r
 = 
	`TS_´og¿m_·ck‘_hdr
(0x00,
d©a_Ëngth
,
TS_·ck‘
,&
TS_hdr_Ën
);

947 ià(
”r
)

949 
	`´št_”r
("### Error constructing PAT…acket header\n");

952 
”r
 = 
	`wr™e_TS_·ck‘_·¹s
(
ouut
,
TS_·ck‘
,
TS_hdr_Ën
,
NULL
,0,

953 
d©a
,
d©a_Ëngth
,0x00,
FALSE
,0);

954 ià(
”r
)

956 
	`´št_”r
("### Error writing PAT\n");

960 
	}
}

971 
	$wr™e_pmt
(
TS_wr™”_p
 
ouut
,

972 
ušt32_t
 
pmt_pid
,

973 
pmt_p
 
pmt
)

975 
ii
;

976 
by‹
 
d©a
[3+1021];

977 
by‹
 
TS_·ck‘
[
TS_PACKET_SIZE
];

978 
TS_hdr_Ën
;

979 
”r
;

980 
£ùiÚ_Ëngth
;

981 
off£t
, 
d©a_Ëngth
;

982 
ušt32_t
 
üc32
;

984 #ià
DEBUG_WRITE_PACKETS


985 
	`åršt_msg
("|| PMT…id %x (%d)\n",
pmt_pid
,pmt_pid);

988 ià(
pmt_pid
 < 0x0010 ||…mt_pid > 0x1ffe)

990 
	`åršt_”r
("### PMT PID %03x i outsidËg®„ªge\n",
pmt_pid
);

993 ià(
	`pid_š_pmt
(
pmt
,
pmt_pid
))

995 
	`åršt_”r
("### PMT PID‡nd…rogram %d PID‡re both %03x\n",

996 
	`pid_šdex_š_pmt
(
pmt
,
pmt_pid
),pmt_pid);

1003 
£ùiÚ_Ëngth
 = 13 + 
pmt
->
´og¿m_šfo_Ëngth
;

1004 
ii
 = 0; i˜< 
pmt
->
num_¡»ams
; ii++)

1005 
£ùiÚ_Ëngth
 +ğ5 + 
pmt
->
¡»ams
[
ii
].
ES_šfo_Ëngth
;

1006 ià(
£ùiÚ_Ëngth
 > 1021)

1008 
	`´št_”r
("### PMT data isoo†ong - will‚ot fit in 1021 bytes\n");

1009 
	`»pÜt_pmt
(
FALSE
," ",
pmt
);

1013 
d©a
[0] = 0x02;

1014 
d©a
[1] = (
by‹
è(0xb0 | ((
£ùiÚ_Ëngth
 & 0x0F00) >> 8));

1015 
d©a
[2] = (
by‹
è(
£ùiÚ_Ëngth
 & 0x0FF);

1016 
d©a
[3] = (
by‹
è((
pmt
->
´og¿m_numb”
 & 0xFF00) >> 8);

1017 
d©a
[4] = (
by‹
è(
pmt
->
´og¿m_numb”
 & 0x00FF);

1018 
d©a
[5] = 0xc1;

1019 
d©a
[6] = 0x00;

1020 
d©a
[7] = 0x00;

1021 
d©a
[8] = (
by‹
è(0xE0 | ((
pmt
->
PCR_pid
 & 0x1F00) >> 8));

1022 
d©a
[9] = (
by‹
è(
pmt
->
PCR_pid
 & 0x00FF);

1023 
d©a
[10] = 0xF0;

1024 
d©a
[11] = (
by‹
)
pmt
->
´og¿m_šfo_Ëngth
;

1025 ià(
pmt
->
´og¿m_šfo_Ëngth
 > 0)

1026 
	`memıy
(
d©a
+12,
pmt
->
´og¿m_šfo
,pmt->
´og¿m_šfo_Ëngth
);

1028 
off£t
 = 12 + 
pmt
->
´og¿m_šfo_Ëngth
;

1030 
ii
=0; i˜< 
pmt
->
num_¡»ams
; ii++)

1032 
ušt32_t
 
pid
 = 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
;

1033 
ušt16_t
 
Ën
 = 
pmt
->
¡»ams
[
ii
].
ES_šfo_Ëngth
;

1034 
d©a
[
off£t
+0] = 
pmt
->
¡»ams
[
ii
].
¡»am_ty³
;

1035 
d©a
[
off£t
+1] = (
by‹
è(0xE0 | ((
pid
 & 0x1F00) >> 8));

1036 
d©a
[
off£t
+2] = (
by‹
è(
pid
 & 0x00FF);

1037 
d©a
[
off£t
+3] = ((
Ën
 & 0xFF00) >> 8) | 0xF0;

1038 
d©a
[
off£t
+4] = 
Ën
 & 0x00FF;

1039 
	`memıy
(
d©a
+
off£t
+5,
pmt
->
¡»ams
[
ii
].
ES_šfo
,
Ën
);

1040 
off£t
 +ğ5 + 
Ën
;

1043 
üc32
 = 
	`üc32_block
(0xffffffff,
d©a
,
off£t
);

1044 
d©a
[
off£t
+0] = (
by‹
è((
üc32
 & 0xff000000) >> 24);

1045 
d©a
[
off£t
+1] = (
by‹
è((
üc32
 & 0x00ff0000) >> 16);

1046 
d©a
[
off£t
+2] = (
by‹
è((
üc32
 & 0x0000ff00) >> 8);

1047 
d©a
[
off£t
+3] = (
by‹
è(
üc32
 & 0x000000ff);

1048 
d©a_Ëngth
 = 
off£t
 + 4;

1051 ià(
d©a_Ëngth
 !ğ
£ùiÚ_Ëngth
 + 3)

1053 
	`åršt_”r
("### PMT†ength %d, section†ength+3 %d\n",

1054 
d©a_Ëngth
,
£ùiÚ_Ëngth
+3);

1059 
üc32
 = 
	`üc32_block
(0xffffffff,
d©a
,
d©a_Ëngth
);

1060 ià(
üc32
 != 0)

1062 
	`´št_”r
("### PMT CRC does‚ot self-cancel\n");

1065 
”r
 = 
	`TS_´og¿m_·ck‘_hdr
(
pmt_pid
,
d©a_Ëngth
,
TS_·ck‘
,&
TS_hdr_Ën
);

1066 ià(
”r
)

1068 
	`´št_”r
("### Error constructing PMT…acket header\n");

1071 
”r
 = 
	`wr™e_TS_·ck‘_·¹s
(
ouut
,
TS_·ck‘
,
TS_hdr_Ën
,
NULL
,0,

1072 
d©a
,
d©a_Ëngth
,0x02,
FALSE
,0);

1073 ià(
”r
)

1075 
	`´št_”r
("### Error writing PMT\n");

1079 
	}
}

1093 
	$wr™e_·t_ªd_pmt
(
TS_wr™”_p
 
ouut
,

1094 
ušt32_t
 
Œª¥Üt_¡»am_id
,

1095 
pidšt_li¡_p
 
´og_li¡
,

1096 
ušt32_t
 
pmt_pid
,

1097 
pmt_p
 
pmt
)

1099 
”r
;

1100 
”r
 = 
	`wr™e_·t
(
ouut
,
Œª¥Üt_¡»am_id
,
´og_li¡
);

1101 ià(
”r
)  1;

1102 
”r
 = 
	`wr™e_pmt
(
ouut
,
pmt_pid
,
pmt
);

1103 ià(
”r
)  1;

1105 
	}
}

1117 
	$wr™e_sšgË_´og¿m_·t
(
TS_wr™”_p
 
ouut
,

1118 
ušt32_t
 
Œª¥Üt_¡»am_id
,

1119 
ušt32_t
 
´og¿m_numb”
,

1120 
ušt32_t
 
pmt_pid
)

1122 
”r
;

1123 
pidšt_li¡_p
 
´og_li¡
;

1125 
”r
 = 
	`bud_pidšt_li¡
(&
´og_li¡
);

1126 ià(
”r
)  1;

1127 
”r
 = 
	`­³nd_to_pidšt_li¡
(
´og_li¡
,
pmt_pid
,
´og¿m_numb”
);

1128 ià(
”r
)

1130 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1134 
”r
 = 
	`wr™e_·t
(
ouut
,
Œª¥Üt_¡»am_id
,
´og_li¡
);

1135 ià(
”r
)

1137 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1141 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1143 
	}
}

1152 
	$wr™e_TS_nuÎ_·ck‘
(
TS_wr™”_p
 
ouut
)

1154 
by‹
 
TS_·ck‘
[
TS_PACKET_SIZE
];

1155 
”r
, 
ii
;

1157 #ià
DEBUG_WRITE_PACKETS


1158 
	`´št_msg
("|| Null…acket\n");

1161 
TS_·ck‘
[0] = 0x47;

1162 
TS_·ck‘
[1] = 0x1F;

1163 
TS_·ck‘
[2] = 0xFF;

1164 
TS_·ck‘
[3] = 0x20;

1165 
ii
=4; ii<
TS_PACKET_SIZE
; ii++)

1166 
TS_·ck‘
[
ii
] = 0xFF;

1168 
”r
 = 
	`wr™e_TS_·ck‘_·¹s
(
ouut
,
TS_·ck‘
,
TS_PACKET_SIZE
,
NULL
,0,NULL,0,

1169 0x1FF,
FALSE
,0);

1170 ià(
”r
)

1172 
	`´št_”r
("### Error writing‚ull TS…acket\n");

1176 
	}
}

1182 
ušt64_t
 
TWENTY_SEVEN_MHZ
 = 27000000;

1196 
	$Ãw_TS_»ad”
(
TS_»ad”_p
 *
t¤—d”
)

1198 
TS_»ad”_p
 
Ãw
 = 
	`m®loc
(
SIZEOF_TS_READER
);

1199 ià(
Ãw
 =ğ
NULL
)

1201 
	`´št_”r
("### Unableo‡llocate TS„ead-ahead buffer\n");

1205 
	`mem£t
(
Ãw
, '\0', 
SIZEOF_TS_READER
);

1207 
Ãw
->
fe
 = -1;

1209 *
t¤—d”
 = 
Ãw
;

1211 
	}
}

1224 
	$bud_TS_»ad”
(
fe
,

1225 
TS_»ad”_p
 *
t¤—d”
)

1227 
TS_»ad”_p
 
Ãw
;

1228 
”r
 = 
	`Ãw_TS_»ad”
(&
Ãw
);

1229 ià(
”r
)  1;

1231 
Ãw
->
fe
 = file;

1233 *
t¤—d”
 = 
Ãw
;

1235 
	}
}

1243 
bud_TS_»ad”_w™h_âs
(*
hªdË
,

1244 (*
»ad_â
)(*, 
by‹
 *, 
size_t
),

1245 (*
£ek_â
)(*, 
off£t_t
),

1246 
TS_»ad”_p
 *
t¤—d”
)

1248 
TS_»ad”_p
 
Ãw
;

1249 
”r
 = 
	`Ãw_TS_»ad”
(&
Ãw
);

1250 ià(
”r
)  1;

1252 
Ãw
->
hªdË
 = handle;

1253 
Ãw
->
»ad_â
 =„ead_fn;

1254 
Ãw
->
£ek_â
 = seek_fn;

1256 *
t¤—d”
 = 
Ãw
;

1258 
	}
}

1268 
	$İ’_fe_fÜ_TS_»ad
(*
f’ame
,

1269 
TS_»ad”_p
 *
t¤—d”
)

1271 
”r
;

1272 
fe
;

1274 ià(
f’ame
 =ğ
NULL
)

1275 
fe
 = 
STDIN_FILENO
;

1278 
fe
 = 
	`İ’_bš¬y_fe
(
f’ame
,
FALSE
);

1279 ià(
fe
 == -1)

1283 
”r
 = 
	`bud_TS_»ad”
(
fe
,
t¤—d”
);

1284 ià(
”r
)

1286 (è
	`şo£_fe
(
fe
);

1290 
	}
}

1297 
	$ä“_TS_»ad”
(
TS_»ad”_p
 *
t¤—d”
)

1299 ià(*
t¤—d”
 !ğ
NULL
)

1301 ià((*
t¤—d”
)->
pübuf
 !ğ
NULL
)

1302 
	`ä“
((*
t¤—d”
)->
pübuf
);

1303 (*
t¤—d”
)->
fe
 = -1;

1304 
	`ä“
(*
t¤—d”
);

1305 *
t¤—d”
 = 
NULL
;

1307 
	}
}

1317 
	$şo£_TS_»ad”
(
TS_»ad”_p
 *
t¤—d”
)

1319 
”r
 = 0;

1320 ià(*
t¤—d”
 =ğ
NULL
)

1322 ià((*
t¤—d”
)->
fe
 !ğ
STDIN_FILENO
 && (*tsreader)->file != -1)

1323 
”r
 = 
	`şo£_fe
((*
t¤—d”
)->
fe
);

1325 
	`ä“_TS_»ad”
(
t¤—d”
);

1326  
”r
;

1327 
	}
}

1342 
	$£ek_usšg_TS_»ad”
(
TS_»ad”_p
 
t¤—d”
,

1343 
off£t_t
 
po¢
)

1345 
t¤—d”
->
»ad_ah—d_±r
 = 
NULL
;

1346 
t¤—d”
->
»ad_ah—d_’d
 = 
NULL
;

1347 
t¤—d”
->
po¢
 =…osn;

1349 ià(
t¤—d”
->
£ek_â
)

1351  
t¤—d”
->
	`£ek_â
Ñ¤—d”->
hªdË
, 
po¢
);

1355  
	`£ek_fe
(
t¤—d”
->
fe
,
po¢
);

1357 
	}
}

1376 
	$»ad_Ãxt_TS_·ck‘s
(
TS_»ad”_p
 
t¤—d”
,

1377 
¡¬t_Ën
,

1378 
by‹
 *
·ck‘
[
TS_PACKET_SIZE
])

1380 #ifdeà
_WIN32


1381 
tÙ®
 = 
¡¬t_Ën
;

1382 
Ëngth
;

1384 
ssize_t
 
tÙ®
 = 
¡¬t_Ën
;

1385 
ssize_t
 
Ëngth
;

1389 *
·ck‘
 = 
NULL
;

1391 ià(
t¤—d”
->
»ad_ah—d_±r
 =ğt¤—d”->
»ad_ah—d_’d
)

1394 
tÙ®
 < 
TS_READ_AHEAD_BYTES
)

1396 ià(
t¤—d”
->
»ad_â
)

1397 
Ëngth
 = 
t¤—d”
->
	`»ad_â
Ñ¤—d”->
hªdË
,

1398 &(
t¤—d”
->
»ad_ah—d
[
tÙ®
]),

1399 
TS_READ_AHEAD_BYTES
-
tÙ®
);

1401 
Ëngth
 = 
	`»ad
(
t¤—d”
->
fe
,

1402 &(
t¤—d”
->
»ad_ah—d
[
tÙ®
]),

1403 
TS_READ_AHEAD_BYTES
 - 
tÙ®
);

1405 ià(
Ëngth
 == 0)

1407 ià(
Ëngth
 == -1)

1409 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘s: %s\n",
	`¡»¼Ü
(
”ºo
));

1412 
tÙ®
 +ğ
Ëngth
;

1418 ià(
tÙ®
 == 0)

1419  
EOF
;

1421 ià(
tÙ®
 % 
TS_PACKET_SIZE
 != 0)

1423 
	`åršt_”r
("!!! %d byte%s ignored‡tƒnd of file -‚otƒnough"

1425 ()(
tÙ®
 % 
TS_PACKET_SIZE
),(total % TS_PACKET_SIZE == 1?"":"s"));

1427 
tÙ®
 =Ù® - (tÙ® % 
TS_PACKET_SIZE
);

1428 ià(
tÙ®
 == 0)

1429  
EOF
;

1431 
t¤—d”
->
»ad_ah—d_±r
 =¤—d”->
»ad_ah—d
;

1432 
t¤—d”
->
»ad_ah—d_’d
 =¤—d”->
»ad_ah—d
 + 
tÙ®
;

1435 *
·ck‘
 = 
t¤—d”
->
»ad_ah—d_±r
;

1436 
t¤—d”
->
»ad_ah—d_±r
 +ğ
TS_PACKET_SIZE
;

1437 
t¤—d”
->
po¢
 +ğ
TS_PACKET_SIZE
;

1439 
	}
}

1462 
	$»ad_»¡_of_fœ¡_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

1463 
by‹
 
¡¬t
[4],

1464 
by‹
 **
·ck‘
)

1466 
t¤—d”
->
»ad_ah—d
[0] = 
¡¬t
[0];

1467 
t¤—d”
->
»ad_ah—d
[1] = 
¡¬t
[1];

1468 
t¤—d”
->
»ad_ah—d
[2] = 
¡¬t
[2];

1469 
t¤—d”
->
»ad_ah—d
[3] = 
¡¬t
[3];

1472  
	`»ad_Ãxt_TS_·ck‘s
(
t¤—d”
,4,
·ck‘
);

1473 
	}
}

1490 
	$»ad_Ãxt_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

1491 
by‹
 **
·ck‘
)

1493  
	`»ad_Ãxt_TS_·ck‘s
(
t¤—d”
,0,
·ck‘
);

1494 
	}
}

1512 
	$¡¬t_TS_·ck‘_bufãr
(
TS_»ad”_p
 
t¤—d”
)

1514 ià(
t¤—d”
->
pübuf
 =ğ
NULL
)

1516 
t¤—d”
->
pübuf
 = 
	`m®loc
(
SIZEOF_TS_PCR_BUFFER
);

1517 ià(
t¤—d”
->
pübuf
 =ğ
NULL
)

1519 
	`´št_”r
("### Unableo‡llocate TS PCR„ead-ahead buffer\n");

1523 
	`mem£t
(
t¤—d”
->
pübuf
, '\0', 
SIZEOF_TS_PCR_BUFFER
);

1525 
	}
}

1533 
	$fl_TS_·ck‘_bufãr
(
TS_»ad”_p
 
t¤—d”
)

1535 
ii
;

1538 
t¤—d”
->
pübuf
->
TS_bufãr_po¢
 +ğt¤—d”->pübuf->
TS_bufãr_Ën
;

1540 
t¤—d”
->
pübuf
->
TS_bufãr_Ën
 = 0;

1541 
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 = 0;

1542 
ii
=0; ii<
PCR_READ_AHEAD_SIZE
; ii++)

1544 
by‹
 *
d©a
;

1545 
ušt32_t
 
pid
;

1546 
gÙ_pü
;

1547 
ušt64_t
 
pü
;

1548 
·ylßd_un™_¡¬t_šdiÿtÜ
;

1549 
by‹
 *
ad­t
;

1550 
ad­t_Ën
;

1551 
by‹
 *
·ylßd
;

1552 
·ylßd_Ën
;

1555 
”r
 = 
	`»ad_Ãxt_TS_·ck‘
(
t¤—d”
,&
d©a
);

1556 ià(
”r
)

1558 ià(
”r
 =ğ
EOF
)

1563  
EOF
;

1567 
	`åršt_”r
("### Error (pre)reading TS…acket %d\n",

1568 
t¤—d”
->
pübuf
->
TS_bufãr_po¢
+
ii
);

1574 
	`memıy
(
t¤—d”
->
pübuf
->
TS_bufãr
[
ii
],
d©a
,
TS_PACKET_SIZE
);

1576 
”r
 = 
	`¥l™_TS_·ck‘
(
d©a
,&
pid
,&
·ylßd_un™_¡¬t_šdiÿtÜ
,

1577 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

1578 ià(
”r
)

1580 
	`åršt_”r
("### Error splitting TS…acket %d\n",

1581 
t¤—d”
->
pübuf
->
TS_bufãr_po¢
+
ii
);

1584 
t¤—d”
->
pübuf
->
TS_bufãr_Ën
 ++;

1586 ià(
pid
 !ğ
t¤—d”
->
pübuf
->
TS_bufãr_pü_pid
)

1589 
	`g‘_PCR_äom_ad­tiÚ_f›ld
(
ad­t
,
ad­t_Ën
,&
gÙ_pü
,&
pü
);

1590 ià(
gÙ_pü
)

1592 
t¤—d”
->
pübuf
->
TS_bufãr_´ev_pü
 =¤—d”->pübuf->
TS_bufãr_’d_pü
;

1593 
t¤—d”
->
pübuf
->
TS_bufãr_’d_pü
 = 
pü
;

1594 
t¤—d”
->
pübuf
->
TS_bufãr_time_³r_TS
 =

1595 
	`pü_unsigÃd_diff
(
t¤—d”
->
pübuf
->
TS_bufãr_’d_pü
,¤—d”->pübuf->
TS_bufãr_´ev_pü
) /

1596 
t¤—d”
->
pübuf
->
TS_bufãr_Ën
;

1602 
	`åršt_”r
("!!! Next PCR‚ot found when„eading forwards"

1603 " (fÜ %d TS…ack‘s, s¹šg‡ˆTS…ack‘ %d)\n",
PCR_READ_AHEAD_SIZE
,

1604 
t¤—d”
->
pübuf
->
TS_bufãr_po¢
);

1606 
	}
}

1618 
	$´ime_»ad_bufã»d_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

1619 
ušt32_t
 
pü_pid
)

1621 ià(
	`¡¬t_TS_·ck‘_bufãr
(
t¤—d”
))

1623 
t¤—d”
->
pübuf
->
TS_bufãr_pü_pid
 = 
pü_pid
;

1625 
	}
}

1651 
	$»ad_fœ¡_TS_·ck‘_äom_bufãr
(
TS_»ad”_p
 
t¤—d”
,

1652 
ušt32_t
 
pü_pid
,

1653 
ušt32_t
 
¡¬t_couÁ
,

1654 
by‹
 *
d©a
[
TS_PACKET_SIZE
],

1655 
ušt32_t
 *
pid
,

1656 
ušt64_t
 *
pü
,

1657 
ušt32_t
 *
couÁ
)

1659 
”r
;

1661 ià(
t¤—d”
->
pübuf
 =ğ
NULL
)

1663 
	`´št_”r
("### TS PCR„ead-ahead buffer has‚ot been set up\n"

1669 
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 = 0;

1670 
t¤—d”
->
pübuf
->
TS_bufãr_’d_pü
 = 0;

1671 
t¤—d”
->
pübuf
->
TS_bufãr_´ev_pü
 = 0;

1672 
t¤—d”
->
pübuf
->
TS_bufãr_po¢
 = 
¡¬t_couÁ
;

1673 
t¤—d”
->
pübuf
->
TS_bufãr_Ën
 = 0;

1674 
t¤—d”
->
pübuf
->
TS_bufãr_pü_pid
 = 
pü_pid
;

1675 
t¤—d”
->
pübuf
->
TS_had_EOF
 = 
FALSE
;

1678 
”r
 = 
	`fl_TS_·ck‘_bufãr
(
t¤—d”
);

1679 ià(
”r
) ƒrr;

1683 
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 =¤—d”->pübuf->
TS_bufãr_Ën
 - 1;

1686 *
pü
 = 
t¤—d”
->
pübuf
->
TS_bufãr_’d_pü
;

1688 *
d©a
 = 
t¤—d”
->
pübuf
->
TS_bufãr
[t¤—d”->pübuf->
TS_bufãr_Ãxt
];

1689 *
pid
 = 
t¤—d”
->
pübuf
->
TS_bufãr_pids
[t¤—d”->pübuf->
TS_bufãr_Ãxt
];

1691 *
couÁ
 = 
¡¬t_couÁ
 + 
t¤—d”
->
pübuf
->
TS_bufãr_Ën
;

1693 
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 ++;

1695 
	}
}

1711 
	$»ad_Ãxt_TS_·ck‘_äom_bufãr
(
TS_»ad”_p
 
t¤—d”
,

1712 
by‹
 *
d©a
[
TS_PACKET_SIZE
],

1713 
ušt32_t
 *
pid
,

1714 
ušt64_t
 *
pü
)

1716 
”r
;

1718 ià(
t¤—d”
->
pübuf
 =ğ
NULL
)

1720 
	`´št_”r
("### TS PCR„ead-ahead buffer has‚ot been set up\n"

1725 ià(
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 =ğt¤—d”->pübuf->
TS_bufãr_Ën
)

1727 ià(
t¤—d”
->
pübuf
->
TS_had_EOF
)

1731  
EOF
;

1735 
”r
 = 
	`fl_TS_·ck‘_bufãr
(
t¤—d”
);

1736 ià(
”r
 =ğ
EOF
)

1745 
t¤—d”
->
pübuf
->
TS_had_EOF
 = 
TRUE
;

1747 
t¤—d”
->
pübuf
->
TS_bufãr_´ev_pü
 =¤—d”->pübuf->
TS_bufãr_’d_pü
;

1749 ià(
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 =ğt¤—d”->pübuf->
TS_bufãr_Ën
)

1750  
”r
;

1752 ià(
”r
)

1753  
”r
;

1757 *
d©a
 = 
t¤—d”
->
pübuf
->
TS_bufãr
[t¤—d”->pübuf->
TS_bufãr_Ãxt
];

1758 *
pid
 = 
t¤—d”
->
pübuf
->
TS_bufãr_pids
[t¤—d”->pübuf->
TS_bufãr_Ãxt
];

1760 
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 ++;

1762 ià(
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
 =ğt¤—d”->pübuf->
TS_bufãr_Ën
 &&

1763 !
t¤—d”
->
pübuf
->
TS_had_EOF
)

1766 *
pü
 = 
t¤—d”
->
pübuf
->
TS_bufãr_’d_pü
;

1770 *
pü
 = 
	`pü_unsigÃd_w¿p
(
t¤—d”
->
pübuf
->
TS_bufãr_´ev_pü
 +

1771 
t¤—d”
->
pübuf
->
TS_bufãr_time_³r_TS
 *

1772 
t¤—d”
->
pübuf
->
TS_bufãr_Ãxt
);

1775 
	}
}

1806 
	$»ad_bufã»d_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

1807 
ušt32_t
 *
couÁ
,

1808 
by‹
 *
d©a
[
TS_PACKET_SIZE
],

1809 
ušt32_t
 *
pid
,

1810 
ušt64_t
 *
pü
,

1811 
max
,

1812 
loİ
,

1813 
off£t_t
 
¡¬t_po¢
,

1814 
ušt32_t
 
¡¬t_couÁ
,

1815 
qu›t
)

1817 
”r
;

1819 ià(
max
 > 0 && (*
couÁ
è>ğ(
ušt32_t
)max)

1821 ià(
loİ
)

1823 ià(!
qu›t
)

1824 
	`åršt_msg
("R—d %d…ack‘s,„ewšdšg‡nd cÚtšušg\n",
max
);

1825 
”r
 = 
	`£ek_usšg_TS_»ad”
(
t¤—d”
,
¡¬t_po¢
);

1826 ià(
”r
)  1;

1827 *
couÁ
 = 
¡¬t_couÁ
;

1831 ià(!
qu›t
è
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
max
);

1832  
EOF
;

1837 ià(*
couÁ
 =ğ
¡¬t_couÁ
)

1848 
”r
 = 
	`»ad_fœ¡_TS_·ck‘_äom_bufãr
(
t¤—d”
,

1849 
t¤—d”
->
pübuf
->
TS_bufãr_pü_pid
,

1850 
¡¬t_couÁ
,
d©a
,
pid
,
pü
,
couÁ
);

1851 ià(
”r
)

1853 ià(
”r
 =ğ
EOF
)

1855 
	`´št_”r
("### EOF†ooking for first PCR\n");

1860 
	`åršt_”r
("### Error„eading TS…acket %d,†ooking for first PCR\n",

1861 *
couÁ
);

1868 
”r
 = 
	`»ad_Ãxt_TS_·ck‘_äom_bufãr
(
t¤—d”
,
d©a
,
pid
,
pü
);

1869 ià(
”r
)

1871 ià(
”r
 =ğ
EOF
)

1873 ià(!
loİ
)

1874  
EOF
;

1875 ià(!
qu›t
)

1876 
	`åršt_msg
("EOF (after %d TS…ackets),„ewinding‡nd continuing\n",

1877 *
couÁ
);

1881 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘ %d\n",*
couÁ
);

1882 ià(!
loİ
)

1884 ià(!
qu›t
)

1885 
	`´št_msg
("!!! Rewinding‡nd continuing‡nyway\n");

1887 
”r
 = 
	`£ek_usšg_TS_»ad”
(
t¤—d”
,
¡¬t_po¢
);

1888 ià(
”r
)  1;

1890 *
couÁ
 = 
¡¬t_couÁ
;

1891 
”r
 = 
	`»ad_fœ¡_TS_·ck‘_äom_bufãr
(
t¤—d”
,

1892 
t¤—d”
->
pübuf
->
TS_bufãr_pü_pid
,

1893 
¡¬t_couÁ
,
d©a
,
pid
,
pü
,
couÁ
);

1894 ià(
”r
)

1896 
	`´št_”r
("### Failed„ewinding\n");

1901 (*
couÁ
) ++;

1904 
	}
}

1917 
	$g‘_PCR_äom_ad­tiÚ_f›ld
(
by‹
 
ad­t
[],

1918 
ad­t_Ën
,

1919 *
gÙ_pü
,

1920 
ušt64_t
 *
pü
)

1922 ià(
ad­t_Ën
 =ğ0 || 
ad­t
 =ğ
NULL
)

1923 *
gÙ_pü
 = 
FALSE
;

1924 ià(
ad­t
[0] & 0x10)

1926 *
gÙ_pü
 = 
TRUE
;

1932 *
pü
 = ((
ušt64_t
)
ad­t
[1] << 25) | (adapt[2] << 17) | (adapt[3] << 9) |

1933 (
ad­t
[4] << 1) | (adapt[5] >> 7);

1935 *
pü
 = ((*püè* 300è+ ((
ad­t
[5] & 1) << 8) +‡dapt[6];

1938 *
gÙ_pü
 = 
FALSE
;

1940 
	}
}

1950 
	$»pÜt_ad­tiÚ_f›ld
(
by‹
 
ad­t
[],

1951 
ad­t_Ën
)

1953 
gÙ_pü
;

1954 
ušt64_t
 
pü
;

1956 ià(
ad­t_Ën
 =ğ0 || 
ad­t
 =ğ
NULL
)

1959 
	`åršt_msg
(" Ad­tiÚ f›ld†’ %3d [æag %02x]",
ad­t_Ën
,
ad­t
[0]);

1960 ià(
ad­t
[0] != 0)

1962 
	`´št_msg
(":");

1963 ià(
	`ON
(
ad­t
[0],0x80)è
	`´št_msg
(" discontinuity ");

1964 ià(
	`ON
(
ad­t
[0],0x40)è
	`´št_msg
("„andom‡ccess ");

1965 ià(
	`ON
(
ad­t
[0],0x20)è
	`´št_msg
(" ES-priority ");

1966 ià(
	`ON
(
ad­t
[0],0x10)è
	`´št_msg
(" PCR ");

1967 ià(
	`ON
(
ad­t
[0],0x08)è
	`´št_msg
(" OPCR ");

1968 ià(
	`ON
(
ad­t
[0],0x04)è
	`´št_msg
(" splicing ");

1969 ià(
	`ON
(
ad­t
[0],0x02)è
	`´št_msg
("…rivate ");

1970 ià(
	`ON
(
ad­t
[0],0x01)è
	`´št_msg
("ƒxtension ");

1972 
	`´št_msg
("\n");

1974 
	`g‘_PCR_äom_ad­tiÚ_f›ld
(
ad­t
,
ad­t_Ën
,&
gÙ_pü
,&
pü
);

1975 ià(
gÙ_pü
)

1977 
	`åršt_msg
(" .. PCR %12" 
LLU_FORMAT_STUMP
 "\n", 
pü
);

1980 
	}
}

1993 
	$»pÜt_ad­tiÚ_timšg
(
timšg_p
 
times
,

1994 
by‹
 
ad­t
[],

1995 
ad­t_Ën
,

1996 
·ck‘_couÁ
)

1998 
gÙ_pü
;

1999 
ušt64_t
 
pü
;

2001 ià(
ad­t_Ën
 =ğ0 || 
ad­t
 =ğ
NULL
 || 
times
 == NULL)

2004 
	`g‘_PCR_äom_ad­tiÚ_f›ld
(
ad­t
,
ad­t_Ën
,&
gÙ_pü
,&
pü
);

2005 ià(
gÙ_pü
)

2007 
	`åršt_msg
(" .. PCR %12" 
LLU_FORMAT_STUMP
, 
pü
);

2008 ià(!
times
->
had_fœ¡_pü
)

2010 
times
->
Ï¡_pü_·ck‘
 =imes->
fœ¡_pü_·ck‘
 = 
·ck‘_couÁ
;

2011 
times
->
Ï¡_pü
 =imes->
fœ¡_pü
 = 
pü
;

2012 
times
->
had_fœ¡_pü
 = 
TRUE
;

2016 ià(
pü
 < 
times
->
Ï¡_pü
)

2017 
	`åršt_msg
(" DiscÚtšu™y: PCR wa %7" 
LLU_FORMAT_STUMP
 ",‚ow %7"

2018 
LLU_FORMAT_STUMP
,
times
->
Ï¡_pü
,
pü
);

2021 
	`åršt_msg
(" M—Àby‹¿‹ %7" 
LLU_FORMAT_STUMP
,

2022 ((
·ck‘_couÁ
 - 
times
->
fœ¡_pü_·ck‘
è* 
TS_PACKET_SIZE
) *

2023 
TWENTY_SEVEN_MHZ
 / 
	`pü_unsigÃd_diff
(
pü
, 
times
->
fœ¡_pü
));

2024 
	`åršt_msg
(" by‹¿‹ %7" 
LLU_FORMAT_STUMP
,

2025 ((
·ck‘_couÁ
 - 
times
->
Ï¡_pü_·ck‘
è* 
TS_PACKET_SIZE
) *

2026 
TWENTY_SEVEN_MHZ
 / 
	`pü_unsigÃd_diff
(
pü
, 
times
->
Ï¡_pü
));

2029 
times
->
Ï¡_pü_·ck‘
 = 
·ck‘_couÁ
;

2030 
times
->
Ï¡_pü
 = 
pü
;

2031 
	`´št_msg
("\n");

2034 
	}
}

2049 
	$»pÜt_·ylßd
(
show_d©a
,

2050 
¡»am_ty³
,

2051 
by‹
 
·ylßd
[
MAX_TS_PAYLOAD_SIZE
],

2052 
·ylßd_Ën
,

2053 
·ylßd_un™_¡¬t_šdiÿtÜ
)

2055 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
)

2056 
	`»pÜt_PES_d©a_¬¿y2
(
¡»am_ty³
,
·ylßd
,
·ylßd_Ën
, 
show_d©a
?1000:0);

2057 ià(
show_d©a
)

2058 
	`´št_d©a
(
TRUE
,"D©a",
·ylßd
,
·ylßd_Ën
,1000);

2059 
	}
}

2073 
	$exŒaù_´og_li¡_äom_·t
(
v”bo£
,

2074 
by‹
 
d©a
[],

2075 
d©a_Ën
,

2076 
pidšt_li¡_p
 *
´og_li¡
)

2078 
bË_id
;

2079 
£ùiÚ_syÁax_šdiÿtÜ
,
z”o_b™
,
»£rved1
;

2080 
£ùiÚ_Ëngth
;

2081 
Œª¥Üt_¡»am_id
;

2082 
v”siÚ_numb”
;

2083 
cu¼’t_Ãxt_šdiÿtÜ
;

2084 
£ùiÚ_numb”
;

2085 
Ï¡_£ùiÚ_numb”
;

2086 
ušt32_t
 
üc
 = 0;

2087 
ušt32_t
 
check_üc
;

2088 
by‹
 *
´og¿m_d©a
;

2089 
´og¿m_d©a_Ën
;

2090 
”r
;

2092 ià(
d©a_Ën
 == 0)

2094 
	`´št_”r
("### PAT data has zero†ength\n");

2097 ià(
d©a
 =ğ
NULL
)

2099 
	`´št_”r
("### PAT data is NULL\n");

2103 ià(
DEBUG
è
	`´št_d©a
(
TRUE
,"D©a",
d©a
,
d©a_Ën
,1000);

2106 
bË_id
 = 
d©a
[0];

2107 ià(
bË_id
 != 0)

2109 
	`åršt_”r
("### PATabË id i %0#8x, should b0\n",
bË_id
);

2114 
£ùiÚ_syÁax_šdiÿtÜ
 = (
d©a
[1] & 0x80) >> 7;

2115 
z”o_b™
 = (
d©a
[1] & 0x40) >> 6;

2116 
»£rved1
 = (
d©a
[1] & 0x30) >> 4;

2117 ià(
£ùiÚ_syÁax_šdiÿtÜ
 !ğ1 && 
»pÜt_bad_»£rved_b™s
)

2118 
	`´št_”r
("!!! PAT: section syntax indicator is 0,‚ot 1\n");

2119 ià(
z”o_b™
 !ğ0 && 
»pÜt_bad_»£rved_b™s
)

2120 
	`´št_”r
("!!! PAT: zero bit is 1,‚ot 0\n");

2121 ià(
»£rved1
 !ğ3 && 
»pÜt_bad_»£rved_b™s
)

2122 
	`åršt_”r
("!!! PAT:„e£rved1 i %d,‚Ù 3\n",
»£rved1
);

2124 
£ùiÚ_Ëngth
 = ((
d©a
[1] & 0xF) << 8) | data[2];

2125 ià(
v”bo£
)

2126 
	`åršt_msg
(" section†ength: %03x (%d)\n",

2127 
£ùiÚ_Ëngth
,section_length);

2131 ià(
£ùiÚ_Ëngth
 > 
d©a_Ën
 - 3)

2133 
	`åršt_”r
("### PAT section†ength %d is morehan"

2134 "†’gth oà»maššg d©¨%d\n",
£ùiÚ_Ëngth
,
d©a_Ën
-3);

2137 ià(
£ùiÚ_Ëngth
 < 
d©a_Ën
 - 3)

2139 
	`åršt_”r
("!!! PAT section†ength %d does‚ot use‡ll of"

2140 "„emaššg d©¨%d\n",
£ùiÚ_Ëngth
,
d©a_Ën
-3);

2142 
d©a_Ën
 = 
£ùiÚ_Ëngth
 + 3;

2144 
d©a_Ën
 = 
£ùiÚ_Ëngth
 + 3;

2146 
Œª¥Üt_¡»am_id
 = (
d©a
[3] << 8) | data[4];

2147 ià(
v”bo£
è
	`åršt_msg
("¿n¥Üˆ¡»am id: %04x\n",
Œª¥Üt_¡»am_id
);

2149 
v”siÚ_numb”
 = (
d©a
[5] & 0x3E) >> 1;

2150 
cu¼’t_Ãxt_šdiÿtÜ
 = 
d©a
[5] & 0x1;

2151 
£ùiÚ_numb”
 = 
d©a
[6];

2152 
Ï¡_£ùiÚ_numb”
 = 
d©a
[7];

2153 ià(
v”bo£
)

2154 
	`åršt_msg
(" version‚umber %02x, current‚ext %x, section‚umber %x,†ast"

2155 " seùiÚ‚umb” %x\n",
v”siÚ_numb”
,
cu¼’t_Ãxt_šdiÿtÜ
,

2156 
£ùiÚ_numb”
,
Ï¡_£ùiÚ_numb”
);

2160 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-4];

2161 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-3];

2162 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-2];

2163 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-1];

2166 
check_üc
 = 
	`üc32_block
(0xffffffff,
d©a
,
d©a_Ën
);

2167 ià(
check_üc
 != 0)

2169 
	`åršt_”r
("!!! Calculated CRC for PAT is %08x,‚ot 00000000"

2170 " (CRC iÀd©¨wa %08x)\n",
check_üc
,
üc
);

2176 
´og¿m_d©a
 = 
d©a
 + 8;

2177 
´og¿m_d©a_Ën
 = 
d©a_Ën
 - 8 - 4;

2181 
”r
 = 
	`bud_pidšt_li¡
(
´og_li¡
);

2182 ià(
”r
)  1;

2184 
´og¿m_d©a_Ën
 > 0)

2186 
´og¿m_numb”
 = (
´og¿m_d©a
[0] << 8) |…rogram_data[1];

2187 
ušt32_t
 
pid
 = ((
´og¿m_d©a
[2] & 0x1F) << 8) |…rogram_data[3];

2191 ià(!
´og¿m_numb”
)

2193 ià(
v”bo£
)

2194 
	`åršt_msg
(" N‘wÜk ID %04x (%3d)\n", 
pid
,…id);

2198 ià(
v”bo£
)

2199 
	`åršt_msg
(" Program %03x (%3d) -> PID %04x (%3d)\n",

2200 
´og¿m_numb”
,´og¿m_numb”,
pid
,pid);

2201 
”r
 = 
	`­³nd_to_pidšt_li¡
(*
´og_li¡
,
pid
,
´og¿m_numb”
);

2202 ià(
”r
)  1;

2204 
´og¿m_d©a
 =…rogram_data + 4;

2205 
´og¿m_d©a_Ën
 =…rogram_data_len - 4;

2208 
	}
}

2211 cÚ¡ * 
	$dvb_compÚ’t_ty³3_¡r
(
compÚ’t_ty³
)

2213 
compÚ’t_ty³
)

2243 ià(
compÚ’t_ty³
 >= 0xb0 && component_type <= 0xfe)

2250 
	}
}

2252 cÚ¡ * cÚ¡ 
desütÜ_Çmes
[] =

2324 
	$´št_ac3_audio_desütÜ
(cÚ¡ 
is_msg
, cÚ¡ 
by‹
 * cÚ¡ 
buf
, cÚ¡ 
Ën
)

2326 cÚ¡ 
by‹
 * 
p
 = 
buf
;

2327 cÚ¡ 
by‹
 * cÚ¡ 
eİ
 = 
p
 + 
Ën
;

2328 cÚ¡ * cÚ¡ 
§m¶e_¿‹_txt
[8] = {

2331 cÚ¡ 
b™_¿‹_n
[32] = {

2334 cÚ¡ * cÚ¡ 
dsurmod_txt
[4] = {

2337 cÚ¡ * cÚ¡ 
num_chªÃls_txt
[16] = {

2341 cÚ¡ * cÚ¡ 
´iÜ™y_txt
[4] = {

2344 
nc
;

2345 
bsmod
;

2347 ià(
p
 >ğ
eİ
)

2349 
too_shÜt
;

2351 
	`åršt_msg_Ü_”r
(
is_msg
, "§m¶e_¿‹: %s, bsid: %d", 
§m¶e_¿‹_txt
[*
p
 >> 5], *p & 0x1f);

2352 ++
p
;

2353 
	`åršt_msg_Ü_”r
(
is_msg
, ", b™_¿‹: % %dk, dsurmod: %s", *
p
 >> 7 ? "Upper" : "Exact",

2354 
b™_¿‹_n
[(*
p
 >> 2) & 31],

2355 
dsurmod_txt
[*
p
 & 3]);

2356 ià(++
p
 >ğ
eİ
)

2358 
too_shÜt
;

2360 
nc
 = (*
p
 >> 1) & 0x0f;

2361 
bsmod
 = *
p
 >> 5;

2362 
	`åršt_msg_Ü_”r
(
is_msg
, ", bsmod: %d,‚um_channels: %s, full_svc: %d",

2363 
bsmod
, 
num_chªÃls_txt
[
nc
], *
p
 & 1);

2364 ià(++
p
 >ğ
eİ
)

2366 
dÚe
;

2368 
	`åršt_msg_Ü_”r
(
is_msg
, ",†ªgcod: %d", *
p
);

2369 ià(
nc
 == 0)

2371 ià(++
p
 >ğ
eİ
)

2373 
dÚe
;

2375 
	`åršt_msg_Ü_”r
(
is_msg
, ",†ªgcod2: %d", *
p
);

2377 ià(++
p
 >ğ
eİ
)

2379 
dÚe
;

2381 ià(
bsmod
 < 2)

2383 
	`åršt_msg_Ü_”r
(
is_msg
, ", mašid: %d,…riÜ™y: %s", *
p
 >> 5, 
´iÜ™y_txt
[(*p >> 3) & 3]);

2384 ià((*
p
 & 7) != 7)

2386 
	`åršt_msg_Ü_”r
(
is_msg
, ",„e£rved(7): %d", *
p
 & 7);

2391 
	`åršt_msg_Ü_”r
(
is_msg
, ",‡svcæags: %#08x", *
p
);

2393 ià(++
p
 >ğ
eİ
)

2395 
dÚe
;

2398 
‹x’
 = *
p
 >> 1;

2399 cÚ¡ 
utf16
 = !(*
p
 & 1);

2400 
	`åršt_msg_Ü_”r
(
is_msg
, ",ext(%c): ", 
utf16
 ? 'U' : 'S');

2401 ià(
p
 + 
‹x’
 >ğ
eİ
)

2403 
too_shÜt
;

2405 ià(
‹x’
 == 0)

2407 
	`åršt_msg_Ü_”r
(
is_msg
, "<none>");

2409 ià(!
utf16
)

2411 
	`åršt_msg_Ü_”r
(
is_msg
, "\"");

2412 
‹x’
-- != 0)

2414 
	`åršt_msg_Ü_”r
(
is_msg
, "%c", *++
p
);

2416 
	`åršt_msg_Ü_”r
(
is_msg
, "\"");

2420 
	`åršt_msg_Ü_”r
(
is_msg
, "??");

2421 
p
 +ğ
‹x’
;

2424 ià(++
p
 >ğ
eİ
)

2426 
dÚe
;

2429 cÚ¡ 
Ïnguage_æag
 = *
p
 >> 7;

2430 cÚ¡ 
Ïnguage_æag_2
 = (*
p
 >> 6) & 1;

2432 ià((*
p
 & 0x1f) != 0x1f)

2434 
	`åršt_msg_Ü_”r
(
is_msg
, ",„e£rved(0x1f): %#x", *
p
 & 0x1f);

2437 ià(
Ïnguage_æag
)

2439 ià(++
p
 + 2 >ğ
eİ
)

2441 
too_shÜt
;

2443 
	`åršt_msg_Ü_”r
(
is_msg
, ",†ªguage: %c%c%c", 
p
[0],…[1],…[2]);

2444 
p
 += 2;

2446 ià(
Ïnguage_æag_2
)

2448 ià(++
p
 + 2 >ğ
eİ
)

2450 
too_shÜt
;

2452 
	`åršt_msg_Ü_”r
(
is_msg
, ",†ªguage_2: %c%c%c", 
p
[0],…[1],…[2]);

2453 
p
 += 2;

2457 ià(++
p
 >ğ
eİ
)

2459 
dÚe
;

2462 
	`´št_d©a
(
is_msg
, "add™iÚ®_šfo: ", 
p
, 
eİ
 -…,100);

2464 
dÚe
:

2465 
	`åršt_msg_Ü_”r
(
is_msg
, "\n");

2468 
too_shÜt
:

2469 
	`åršt_msg_Ü_”r
(
is_msg
, "; ### block short ###\n");

2470 
	}
}

2486 
	$´št_desütÜs
(
is_msg
,

2487 *
Ëad”1
,

2488 *
Ëad”2
,

2489 
by‹
 *
desc_d©a
,

2490 
desc_d©a_Ën
)

2492 
by‹
 
d©a_Ën
 = 
desc_d©a_Ën
;

2493 
by‹
 *
d©a
 = 
desc_d©a
;

2494 
d©a_Ën
 >= 2)

2496 
by‹
 
g
 = 
d©a
[0];

2497 
by‹
 
this_Ëngth
 = 
d©a
[1];

2499 
d©a
 += 2;

2500 
d©a_Ën
 -= 2;

2502 ià(
this_Ëngth
 > 
d©a_Ën
)

2505 
	`åršt_msg_Ü_”r
(
is_msg
,"Descriptor %x says†ength %d, but only %d bytes†eft\n",

2506 
g
,
this_Ëngth
,
d©a_Ën
);

2510 ià(
Ëad”1
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader1);

2511 ià(
Ëad”2
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader2);

2514 
ii
;

2515 
ušt32_t
 
‹mp_u
;

2517 
g
)

2520 
	`åršt_msg_Ü_”r
(
is_msg
,"Registration ");

2521 ià(
this_Ëngth
 >= 4)

2523 
ii
=0; ii<4; ii++)

2525 ià(
	`i¥ršt
(
d©a
[
ii
]))

2526 
	`åršt_msg_Ü_”r
(
is_msg
,"%c",
d©a
[
ii
]);

2528 
	`åršt_msg_Ü_”r
(
is_msg
,"<%02x>",
d©a
[
ii
]);

2530 ià(
this_Ëngth
 > 4)

2531 
ii
=4; i˜< 
this_Ëngth
; ii++)

2532 
	`åršt_msg_Ü_”r
(
is_msg
," %02x",
d©a
[
ii
]);

2534 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

2537 
	`åršt_msg_Ü_”r
(
is_msg
,"Conditional‡ccess: ");

2538 
‹mp_u
 = (
d©a
[0] << 8) | data[1];

2539 
	`åršt_msg_Ü_”r
(
is_msg
,"id %04x (%dè",
‹mp_u
,temp_u);

2540 
‹mp_u
 = ((
d©a
[2] & 0x1F) << 8) | data[3];

2541 
	`åršt_msg_Ü_”r
(
is_msg
,"PID %04x (%dè",
‹mp_u
,temp_u);

2542 ià(
d©a_Ën
 > 4)

2543 
	`´št_d©a
(
is_msg
,"d©a",&
d©a
[4],
d©a_Ën
-4,data_len-4);

2545 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

2548 
	`åršt_msg_Ü_”r
(
is_msg
,"Languages: ");

2549 
ii
 = 0; i˜< 
this_Ëngth
/4; ii++)

2551 
by‹
 
audio_ty³
;

2552 ià(
ii
 > 0è
	`åršt_msg_Ü_”r
(
is_msg
,", ");

2553 
	`åršt_msg_Ü_”r
(
is_msg
,"%c",*(
d©a
+(
ii
*4)+0));

2554 
	`åršt_msg_Ü_”r
(
is_msg
,"%c",*(
d©a
+(
ii
*4)+1));

2555 
	`åršt_msg_Ü_”r
(
is_msg
,"%c",*(
d©a
+(
ii
*4)+2));

2556 
audio_ty³
 = *(
d©a
+(
ii
*4)+3);

2557 
audio_ty³
)

2560 1: 
	`åršt_msg_Ü_”r
(
is_msg
,"/cleanƒffects"); ;

2561 2: 
	`åršt_msg_Ü_”r
(
is_msg
,"/hearing impaired"); ;

2562 3: 
	`åršt_msg_Ü_”r
(
is_msg
,"/visual impaired commentary"); ;

2563 : 
	`åršt_msg_Ü_”r
(
is_msg
,"/»£rved:0x%02x",
audio_ty³
); ;

2566 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

2571 cÚ¡ 
ušt8_t
 * 
p
 = 
d©a
;

2572 
t
;

2574 
	`åršt_msg_Ü_”r
(
is_msg
,"AVC video descriptor: ");

2576 ià(
this_Ëngth
 != 4)

2578 ià(
this_Ëngth
 < 4)

2581 
	`åršt_msg_Ü_”r
(
is_msg
,"### desütÜoØshÜˆ%d ###\n", 
this_Ëngth
);

2587 
	`åršt_msg_Ü_”r
(
is_msg
,"### desütÜoØlÚg %d ###: \n", 
this_Ëngth
);

2591 
	`åršt_msg_Ü_”r
(
is_msg
,"´ofidc: %d, ", *
p
++);

2592 
	`åršt_msg_Ü_”r
(
is_msg
,"constraint_set[");

2593 
t
 = *
p
;

2594 
ii
 = 0; ii != 6; ++ii)

2596 
	`åršt_msg_Ü_”r
(
is_msg
,"%c", (
t
 & 0x80è!ğ0 ? '0' + 
ii
 : '-');

2597 
t
 <<= 1;

2599 
	`åršt_msg_Ü_”r
(
is_msg
,"], AVC_com·tibË_æags: %d, ", *
p
++ & 3);

2600 
	`åršt_msg_Ü_”r
(
is_msg
,"Ëv–_idc: %d, ", *
p
++);

2601 
	`åršt_msg_Ü_”r
(
is_msg
,"AVC_¡l_´e£Á: %d, ", (*
p
 >> 7) & 1);

2602 
	`åršt_msg_Ü_”r
(
is_msg
,"AVC_24_hour_piùu»_æag: %d, ", (*
p
 >> 6) & 1);

2603 
	`åršt_msg_Ü_”r
(
is_msg
,"F¿me_Packšg_SEI_nÙ_´e£Á_æag: %d, ", (*
p
 >> 5) & 1);

2604 
	`åršt_msg_Ü_”r
(
is_msg
,"»£rved: %#x", *
p
 & 0x1f);

2606 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

2612 cÚ¡ 
ušt8_t
 * 
p
 = 
d©a
;

2613 
	`åršt_msg_Ü_”r
(
is_msg
,"AVCiming‡nd HRD descriptor: ");

2614 
	`åršt_msg_Ü_”r
(
is_msg
,"hrd_mªagem’t_v®id_æag: %d, ", (*
p
 & 0x80) != 0);

2615 ià((*
p
 & 0x7e) != 0x7e)

2617 
	`åršt_msg_Ü_”r
(
is_msg
,"»£rved: %#x, ", (*
p
 & 0x7e) >> 1);

2619 ià((*
p
++ & 1) != 0)

2621 
æag90
 = *
p
 >> 7;

2622 
ušt32_t
 
n
 = 1, 
k
 = 300;

2623 
ušt32_t
 
Áick
;

2625 ià(
æag90
)

2627 
	`åršt_msg_Ü_”r
(
is_msg
,"90kHz_æag, ", *
p
 & 0x7f);

2629 ià((*
p
 & 0x7f) != 0x7f)

2631 
	`åršt_msg_Ü_”r
(
is_msg
,"»£rved: %#x, ", *
p
 & 0x7f);

2633 ++
p
;

2634 ià(!
æag90
)

2636 
n
 = 
	`ušt_32_be
(
p
);

2637 
p
 += 4;

2638 
k
 = 
	`ušt_32_be
(
p
);

2639 
p
 += 4;

2640 
	`åršt_msg_Ü_”r
(
is_msg
,"N/K: %u/%u, ", 
n
, 
k
);

2642 
Áick
 = 
	`ušt_32_be
(
p
);

2643 
p
 += 4;

2644 
	`åršt_msg_Ü_”r
(
is_msg
,"num_un™s_š_tick: %u, ", 
Áick
);

2645 ià(
k
 =ğ0 || 
Áick
 == 0)

2646 
	`åršt_msg_Ü_”r
(
is_msg
,"(frame„ate: \?\?\?), ");

2648 
	`åršt_msg_Ü_”r
(
is_msg
,"(äam¿‹: %.6g), ", (()
n
 * 27000000.0è/ (()
k
 * ()
Áick
) / 2.0);

2650 
	`åršt_msg_Ü_”r
(
is_msg
,"fixed_äame_¿‹_æag: %u, ", *
p
 >> 7);

2651 
	`åršt_msg_Ü_”r
(
is_msg
,"‹mpÜ®_poc_æag: %u, ", (*
p
 >> 6) & 1);

2652 
	`åršt_msg_Ü_”r
(
is_msg
,"piùu»_to_di¥Ïy_cÚv”siÚ_æag: %u", (*
p
 >> 5) & 1);

2653 ià((*
p
 & 0x1f) != 0x1f)

2655 
	`åršt_msg_Ü_”r
(
is_msg
,",„e£rved: %#x", *
p
 & 0x1f);

2657 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

2662 
	`åršt_msg_Ü_”r
(
is_msg
,"MPEG2 stereoscopic video format: ");

2664 ià(
this_Ëngth
 != 1)

2666 ià(
this_Ëngth
 < 1)

2669 
	`åršt_msg_Ü_”r
(
is_msg
,"### desütÜoØshÜˆ%d ###\n", 
this_Ëngth
);

2675 
	`åršt_msg_Ü_”r
(
is_msg
,"### desütÜoØlÚg %d ###: \n", 
this_Ëngth
);

2679 ià((
d©a
[0] & 0x80) != 0)

2681 
	`åršt_msg_Ü_”r
(
is_msg
,"¬¿ngem’ˆnÙ…»£Á:„e£rved: %#x", 
d©a
[0] & 0x7f);

2685 
	`åršt_msg_Ü_”r
(
is_msg
,"arrangement: ");

2686 
d©a
[0])

2689 
	`åršt_msg_Ü_”r
(
is_msg
,"S3D side by side");

2692 
	`åršt_msg_Ü_”r
(
is_msg
,"S3Dop‡nd bottom");

2695 
	`åršt_msg_Ü_”r
(
is_msg
,"2D video");

2698 
	`åršt_msg_Ü_”r
(
is_msg
,"»£rved: %#x", 
d©a
[0] & 0x7f);

2702 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

2706 
ii
 = 0; i˜< 
this_Ëngth
; ii += 5)

2708 
jj
;

2709 
‹Ë‹xt_ty³
, 
‹Ë‹xt_magazše
, 
‹Ë‹xt_·ge
;

2710 ià(
ii
 == 0)

2711 
	`åršt_msg_Ü_”r
(
is_msg
,"Teletext: ");

2714 ià(
Ëad”1
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader1);

2715 ià(
Ëad”2
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader2);

2716 
	`åršt_msg_Ü_”r
(
is_msg
," ");

2718 
	`åršt_msg_Ü_”r
(
is_msg
,"language=");

2719 
jj
=
ii
; jj<ii+3; jj++)

2721 ià(
	`i¥ršt
(
d©a
[
jj
]))

2722 
	`åršt_msg_Ü_”r
(
is_msg
,"%c",
d©a
[
jj
]);

2724 
	`åršt_msg_Ü_”r
(
is_msg
,"<%02x>",
d©a
[
jj
]);

2726 
‹Ë‹xt_ty³
 = (
d©a
[
ii
+3] & 0xF8) >> 3;

2727 
‹Ë‹xt_magazše
 = (
d©a
[
ii
+3] & 0x07);

2728 
‹Ë‹xt_·ge
 = 
d©a
[
ii
+4];

2729 
	`åršt_msg_Ü_”r
(
is_msg
,",ype=");

2730 
‹Ë‹xt_ty³
)

2732 1: 
	`åršt_msg_Ü_”r
(
is_msg
,"Initial"); ;

2733 2: 
	`åršt_msg_Ü_”r
(
is_msg
,"Subtitles"); ;

2734 3: 
	`åršt_msg_Ü_”r
(
is_msg
,"Additional info"); ;

2735 4: 
	`åršt_msg_Ü_”r
(
is_msg
,"Programme schedule"); ;

2736 5: 
	`åršt_msg_Ü_”r
(
is_msg
,"Hearing impaired subtitles"); ;

2737 : 
	`åršt_msg_Ü_”r
(
is_msg
,"%x (»£rved)",
‹Ë‹xt_ty³
); ;

2739 
	`åršt_msg_Ü_”r
(
is_msg
,", magazš%d,…ag%x",
‹Ë‹xt_magazše
,
‹Ë‹xt_·ge
);

2740 
	`åršt_msg_Ü_”r
(
is_msg
,"\n");

2746 
	`åršt_msg_Ü_”r
(
is_msg
, "subtitling_descriptor(s):\n");

2748 
ii
 = 0; i˜+ 8 <ğ
this_Ëngth
; ii += 8)

2750 
Ïng
[4];

2751 
subt™lšg_ty³
 = 
d©a
[
ii
 + 3];

2752 
compos™iÚ_·ge_id
 = (
d©a
[
ii
 + 4] << 8) | data[ii + 5];

2753 
ªcÏry_·ge_id
 = (
d©a
[
ii
 + 6] << 8) | data[ii + 7];

2754 
Ïng
[0] = 
d©a
[
ii
 + 0];

2755 
Ïng
[1] = 
d©a
[
ii
 + 1];

2756 
Ïng
[2] = 
d©a
[
ii
 + 2];

2757 
Ïng
[3] = 0;

2758 ià(
Ëad”1
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader1);

2759 ià(
Ëad”2
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader2);

2760 
	`åršt_msg_Ü_”r
(
is_msg
,"†anguage='%s', subtitling_type=%u\n",

2761 
Ïng
, 
subt™lšg_ty³
);

2762 ià(
Ëad”1
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader1);

2763 ià(
Ëad”2
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader2);

2764 
	`åršt_msg_Ü_”r
(
is_msg
, " (%s)\n", 
	`dvb_compÚ’t_ty³3_¡r
(
subt™lšg_ty³
));

2765 ià(
Ëad”1
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader1);

2766 ià(
Ëad”2
 !ğ
NULL
è
	`åršt_msg_Ü_”r
(
is_msg
,"%s",leader2);

2767 
	`åršt_msg_Ü_”r
(
is_msg
,

2769 
compos™iÚ_·ge_id
, 
ªcÏry_·ge_id
);

2771 ià(
ii
 < 
this_Ëngth
)

2772 
	`åršt_msg_Ü_”r
(
is_msg
, "### %d s·» by‹ ©ƒnd oàdesütÜ\n", 
this_Ëngth
 - 
ii
);

2777 
	`´št_d©a
(
is_msg
,"DVB AC-3",
d©a
,
this_Ëngth
,100);

2781 
	`åršt_msg_Ü_”r
(
is_msg
, "ATSC AC-3: ");

2782 
	`´št_ac3_audio_desütÜ
(
is_msg
, 
d©a
, 
this_Ëngth
);

2787 
‹mp_c
[50];

2788 
	`¢´štf
(
‹mp_c
, (temp_c), "%s (%d)",

2789 
g
 < (
desütÜ_Çmes
)/(descriptor_names[0]) ?

2790 
desütÜ_Çmes
[
g
] :

2791 
g
 < 64 ? "Reserved" : "User Private",

2792 
g
);

2793 
	`´št_d©a
(
is_msg
,
‹mp_c
,
d©a
,
this_Ëngth
,100);

2798 
d©a_Ën
 -ğ
this_Ëngth
;

2799 
d©a
 +ğ
this_Ëngth
;

2802 
	}
}

2832 
	$bud_psi_d©a
(
v”bo£
,

2833 
by‹
 
·ylßd
[
MAX_TS_PAYLOAD_SIZE
],

2834 
·ylßd_Ën
,

2835 
ušt32_t
 
pid
,

2836 
by‹
 **
d©a
,

2837 *
d©a_Ën
,

2838 *
d©a_u£d
)

2840 
by‹
 *
·ck‘_d©a
;

2841 
·ck‘_d©a_Ën
;

2842 
poš‹r
;

2843 
£ùiÚ_Ëngth
;

2845 ià(
·ylßd_Ën
 == 0)

2847 
	`´št_”r
("### PMT…ayload has zero†ength\n");

2850 ià(
·ylßd
 =ğ
NULL
)

2852 
	`´št_”r
("### PMT…ayload is NULL\n");

2856 ià(*
d©a
 =ğ
NULL
)

2860 
poš‹r
 = 
·ylßd
[0];

2862 ià(
poš‹r
 > (
·ylßd_Ën
 - 1))

2864 
	`åršt_”r
("### PMT…ayload:…ointer is %d, which is offheƒnd of"

2865 "h·ck‘ (Ëngth %d)\n",
poš‹r
,
·ylßd_Ën
);

2870 
·ck‘_d©a
 = 
·ylßd
 + 
poš‹r
 + 1;

2871 
·ck‘_d©a_Ën
 = 
·ylßd_Ën
 - 
poš‹r
 - 1;

2872 ià(
DEBUG
è
	`´št_d©a
(
TRUE
,"D©a",
·ck‘_d©a
,
·ck‘_d©a_Ën
,1000);

2874 
£ùiÚ_Ëngth
 = ((
·ck‘_d©a
[1] & 0xF) << 8) |…acket_data[2];

2877 
	`´št_msg
("===========================================\n");

2878 
	`´št_d©a
(
TRUE
,"bud_pmt_d©aÒew)",
·ck‘_d©a
,
·ck‘_d©a_Ën
,packet_data_len);

2881 *
d©a_Ën
 = 
£ùiÚ_Ëngth
 + 3;

2887 ià(
·ck‘_d©a_Ën
 > *
d©a_Ën
)

2888 *
d©a_u£d
 = *
d©a_Ën
;

2890 *
d©a_u£d
 = 
·ck‘_d©a_Ën
;

2891 *
d©a
 = 
	`m®loc
(*
d©a_Ën
);

2892 ià(*
d©a
 =ğ
NULL
)

2894 
	`´št_”r
("### Unableo malloc PSI data‡rray\n");

2897 
	`memıy
(*
d©a
,
·ck‘_d©a
,*
d©a_Ën
);

2903 
¥aû_Ëá
 = *
d©a_Ën
 - *
d©a_u£d
;

2904 
·ck‘_d©a
 = 
·ylßd
;

2905 
·ck‘_d©a_Ën
 = 
·ylßd_Ën
;

2906 ià(
DEBUG
è
	`´št_d©a
(
TRUE
,"D©a",
·ck‘_d©a
,
·ck‘_d©a_Ën
,1000);

2909 
	`´št_msg
("===========================================\n");

2910 
	`´št_d©a
(
TRUE
,"bud_pmt_d©a(Şd)",
·ck‘_d©a
,
·ck‘_d©a_Ën
,100);

2912 ià(
¥aû_Ëá
 > 
·ck‘_d©a_Ën
)

2915 
	`memıy
(*
d©a
 + *
d©a_u£d
, 
·ck‘_d©a
, 
·ck‘_d©a_Ën
);

2916 *
d©a_u£d
 +ğ
·ck‘_d©a_Ën
;

2922 
	`memıy
(*
d©a
 + *
d©a_u£d
, 
·ck‘_d©a
, 
¥aû_Ëá
);

2923 *
d©a_u£d
 +ğ
¥aû_Ëá
;

2927 
	}
}

2942 
	$exŒaù_pmt
(
v”bo£
,

2943 
by‹
 
d©a
[],

2944 
d©a_Ën
,

2945 
ušt32_t
 
pid
,

2946 
pmt_p
 *
pmt
)

2948 
bË_id
;

2949 
£ùiÚ_syÁax_šdiÿtÜ
,
z”o_b™
,
»£rved
;

2950 
ušt16_t
 
´og¿m_numb”
;

2951 
ušt32_t
 
pü_pid
;

2952 
£ùiÚ_Ëngth
;

2953 
v”siÚ_numb”
;

2954 
cu¼’t_Ãxt_šdiÿtÜ
;

2955 
£ùiÚ_numb”
;

2956 
Ï¡_£ùiÚ_numb”
;

2957 
´og¿m_šfo_Ëngth
;

2958 
ušt32_t
 
üc
 = 0;

2959 
ušt32_t
 
check_üc
;

2960 
by‹
 *
¡»am_d©a
;

2961 
¡»am_d©a_Ën
;

2962 
”r
;

2964 ià(
d©a_Ën
 == 0)

2966 
	`´št_”r
("### PMT data has zero†ength\n");

2969 ià(
d©a
 =ğ
NULL
)

2971 
	`´št_”r
("### PMT data is NULL\n");

2975 ià(
DEBUG
è
	`´št_d©a
(
TRUE
,"D©a",
d©a
,
d©a_Ën
,1000);

2978 
bË_id
 = 
d©a
[0];

2979 ià(
bË_id
 != 2)

2984 ià(0x03 <ğ
bË_id
 &&able_id <=0xFE)

2986 ià(
v”bo£
)

2988 
	`åršt_msg
(" 'PMT' w™h PID %04x i u£¸´iv©bË %02x\n",
pid
,
bË_id
);

2989 
	`´št_d©a
(
TRUE
," D©a",
d©a
,
d©a_Ën
,20);

2994 ià(0x03 <ğ
bË_id
 &&able_id <= 0x3F)

2995 
	`åršt_”r
("### PMTable id is %0#x (H.222 / ISO/IEC 13818-1"

2996 "„e£rved), should b2\n",
bË_id
);

2998 
	`åršt_”r
("### PMTable id is %0#x (%s), should be 2\n",

2999 
bË_id
,(table_id==0x00?"PAT":

3000 
bË_id
==0x01?"CAT":

3001 
bË_id
==0xFF?"Forbidden":"???"));

3002 
	`´št_d©a
(
FALSE
," D©a",
d©a
,
d©a_Ën
,20);

3005 *
pmt
 = 
	`bud_pmt
(0,0,0);

3006 ià(*
pmt
 =ğ
NULL
)  1;

3011 
£ùiÚ_syÁax_šdiÿtÜ
 = (
d©a
[1] & 0x80) >> 7;

3012 
z”o_b™
 = (
d©a
[1] & 0x40) >> 6;

3013 
»£rved
 = (
d©a
[1] & 0x30) >> 4;

3014 ià(
£ùiÚ_syÁax_šdiÿtÜ
 !ğ1 && 
»pÜt_bad_»£rved_b™s
)

3015 
	`´št_”r
("!!! PMT: section syntax indicator is 0,‚ot 1\n");

3016 ià(
z”o_b™
 !ğ0 && 
»pÜt_bad_»£rved_b™s
)

3017 
	`´št_”r
("!!! PMT: zero bit is 1,‚ot 0\n");

3018 ià(
»£rved
 !ğ3 && 
»pÜt_bad_»£rved_b™s
)

3019 
	`åršt_”r
("!!! PMT:„e£rved (aá” z”Øb™èi %d,‚Ù 3\n",
»£rved
);

3021 
£ùiÚ_Ëngth
 = ((
d©a
[1] & 0xF) << 8) | data[2];

3022 ià(
v”bo£
)

3023 
	`åršt_msg
(" seùiÚ†’gth: %03x (%d)\n",
£ùiÚ_Ëngth
,section_length);

3027 ià(
£ùiÚ_Ëngth
 > 
d©a_Ën
 - 3)

3029 
	`åršt_”r
("### PMT section†ength %d is morehan"

3030 "†’gth oà»maššg d©¨%d\n",
£ùiÚ_Ëngth
,
d©a_Ën
-3);

3033 ià(
£ùiÚ_Ëngth
 < 
d©a_Ën
 - 3)

3035 
	`åršt_”r
("!!! PMT section†ength %d does‚ot use‡ll of"

3036 "„emaššg d©¨%d\n",
£ùiÚ_Ëngth
,
d©a_Ën
-3);

3038 
d©a_Ën
 = 
£ùiÚ_Ëngth
 + 3;

3041 
´og¿m_numb”
 = (
d©a
[3] << 8) | data[4];

3042 ià(
v”bo£
)

3043 
	`åršt_msg
("…rog¿m‚umb”: %04x\n",
´og¿m_numb”
);

3044 
»£rved
 = (
d©a
[5] & 0xC0) >> 6;

3045 ià(
»£rved
 !ğ3 && 
»pÜt_bad_»£rved_b™s
)

3046 
	`åršt_”r
("!!! PMT:„eserved (after…rogram_number)"

3047 " i %d,‚Ù 3\n",
»£rved
);

3048 
v”siÚ_numb”
 = (
d©a
[5] & 0x3E) >> 1;

3049 
cu¼’t_Ãxt_šdiÿtÜ
 = 
d©a
[5] & 0x1;

3050 
£ùiÚ_numb”
 = 
d©a
[6];

3051 
Ï¡_£ùiÚ_numb”
 = 
d©a
[7];

3052 ià(
v”bo£
)

3053 
	`åršt_msg
(" version‚umber %02x, current‚ext %x, section‚umber %x,†ast"

3054 " seùiÚ‚umb” %x\n",
v”siÚ_numb”
,
cu¼’t_Ãxt_šdiÿtÜ
,

3055 
£ùiÚ_numb”
,
Ï¡_£ùiÚ_numb”
);

3057 
»£rved
 = (
d©a
[8] & 0xE0) >> 5;

3058 ià(
»£rved
 !ğ7 && 
»pÜt_bad_»£rved_b™s
)

3059 
	`åršt_”r
("!!! PMT:„eserved (after†ast_section_number)"

3060 " i %d,‚Ù 7\n",
»£rved
);

3061 
pü_pid
 = ((
d©a
[8] & 0x1F) << 8) | data[9];

3062 ià(
v”bo£
)

3063 
	`åršt_msg
(" PCR PID: %04x\n",
pü_pid
);

3065 
»£rved
 = (
d©a
[10] & 0xF0) >> 4;

3066 ià(
»£rved
 !ğ0xF && 
»pÜt_bad_»£rved_b™s
)

3067 
	`åršt_”r
("!!! PMT:„eserved (after PCR PID)"

3068 " i %x,‚Ù F\n",
»£rved
);

3070 
´og¿m_šfo_Ëngth
 = ((
d©a
[10] & 0x0F) << 8) | data[11];

3071 ià(
v”bo£
)

3072 
	`åršt_msg
("…rog¿m infØËngth: %d\n",
´og¿m_šfo_Ëngth
);

3074 ià(
v”bo£
 && 
´og¿m_šfo_Ëngth
 > 0)

3076 
	`´št_msg
(" Program info:\n");

3077 
	`´št_desütÜs
(
TRUE
," ",
NULL
,&
d©a
[12],
´og¿m_šfo_Ëngth
);

3082 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-4];

3083 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-3];

3084 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-2];

3085 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-1];

3088 
check_üc
 = 
	`üc32_block
(0xffffffff,
d©a
,
d©a_Ën
);

3089 ià(
check_üc
 != 0)

3091 
	`åršt_”r
("!!! Calculated CRC for PMT (PID %04x) is %08x,‚ot 00000000"

3092 " (CRC iÀd©¨wa %08x)\n",
pid
,
check_üc
,
üc
);

3100 
¡»am_d©a
 = 
d©a
 + 12 + 
´og¿m_šfo_Ëngth
;

3101 
¡»am_d©a_Ën
 = 
d©a_Ën
 - 12 - 
´og¿m_šfo_Ëngth
 - 4;

3105 *
pmt
 = 
	`bud_pmt
(
´og¿m_numb”
,
v”siÚ_numb”
,
pü_pid
);

3106 ià(*
pmt
 =ğ
NULL
)  1;

3108 ià(
´og¿m_šfo_Ëngth
 > 0)

3110 
”r
 = 
	`£t_pmt_´og¿m_šfo
(*
pmt
,
´og¿m_šfo_Ëngth
,&
d©a
[12]);

3111 ià(
”r
)

3113 
	`ä“_pmt
(
pmt
);

3118 ià(
v”bo£
)

3119 
	`´št_msg
(" Program streams:\n");

3120 
¡»am_d©a_Ën
 > 0)

3122 
¡»am_ty³
 = 
¡»am_d©a
[0];

3123 
ušt32_t
 
pid
 = ((
¡»am_d©a
[1] & 0x1F) << 8) | stream_data[2];

3124 
ES_šfo_Ëngth
 = ((
¡»am_d©a
[3] & 0x0F) << 8) | stream_data[4];

3125 ià(
v”bo£
)

3127 
	`åršt_msg
(" PID %04x -> SŒ—m %02x %s\n",
pid
,
¡»am_ty³
,

3128 
	`h222_¡»am_ty³_¡r
(
¡»am_ty³
));

3129 ià(
ES_šfo_Ëngth
 > 0)

3130 
	`´št_desütÜs
(
TRUE
," ",
NULL
,&
¡»am_d©a
[5],
ES_šfo_Ëngth
);

3132 
”r
 = 
	`add_¡»am_to_pmt
(*
pmt
,
pid
,
¡»am_ty³
,
ES_šfo_Ëngth
,

3133 
¡»am_d©a
+5);

3134 ià(
”r
)

3136 
	`ä“_pmt
(
pmt
);

3139 
¡»am_d©a
 = sŒ—m_d©¨+ 5 + 
ES_šfo_Ëngth
;

3140 
¡»am_d©a_Ën
 = sŒ—m_d©a_ËÀ- 5 - 
ES_šfo_Ëngth
;

3143 
	}
}

3161 
	$exŒaù_¡»am_li¡_äom_pmt
(
v”bo£
,

3162 
by‹
 
·ylßd
[
MAX_TS_PAYLOAD_SIZE
],

3163 
·ylßd_Ën
,

3164 
ušt32_t
 
pid
,

3165 *
´og¿m_numb”
,

3166 
ušt32_t
 *
pü_pid
,

3167 
pidšt_li¡_p
 *
¡»am_li¡
)

3169 
by‹
 *
d©a
;

3170 
d©a_Ën
;

3171 
poš‹r
;

3172 
bË_id
;

3173 
£ùiÚ_syÁax_šdiÿtÜ
,
z”o_b™
,
»£rved
;

3174 
£ùiÚ_Ëngth
;

3175 
v”siÚ_numb”
;

3176 
cu¼’t_Ãxt_šdiÿtÜ
;

3177 
£ùiÚ_numb”
;

3178 
Ï¡_£ùiÚ_numb”
;

3179 
´og¿m_šfo_Ëngth
;

3180 
ušt32_t
 
üc
 = 0;

3181 
ušt32_t
 
check_üc
;

3182 
by‹
 *
¡»am_d©a
;

3183 
¡»am_d©a_Ën
;

3184 
”r
;

3186 ià(
·ylßd_Ën
 == 0)

3188 
	`´št_”r
("### PMT…ayload has zero†ength\n");

3191 ià(
·ylßd
 =ğ
NULL
)

3193 
	`´št_”r
("### PMT…ayload is NULL\n");

3196 
poš‹r
 = 
·ylßd
[0];

3198 ià(
poš‹r
 > (
·ylßd_Ën
 - 1))

3200 
	`åršt_”r
("### PMT…ayload:…ointer is %d, which is offheƒnd of"

3201 "h·ck‘ (Ëngth %d)\n",
poš‹r
,
·ylßd_Ën
);

3206 
d©a
 = 
·ylßd
 + 
poš‹r
 + 1;

3207 
d©a_Ën
 = 
·ylßd_Ën
 - 
poš‹r
 - 1;

3208 ià(
DEBUG
è
	`´št_d©a
(
TRUE
,"D©a",
d©a
,
d©a_Ën
,1000);

3211 
bË_id
 = 
d©a
[0];

3212 ià(
bË_id
 != 2)

3217 ià(0x03 <ğ
bË_id
 &&able_id <=0xFE)

3219 ià(
v”bo£
)

3221 
	`åršt_msg
(" 'PMT' w™h PID %04x i u£¸´iv©bË %02x\n",
pid
,
bË_id
);

3222 
	`´št_d©a
(
TRUE
," D©a",
d©a
,
d©a_Ën
,20);

3227 ià(0x03 <ğ
bË_id
 &&able_id <= 0x3F)

3228 
	`åršt_”r
("### PMTable id is %0#x (H.222 / ISO/IEC 13818-1"

3229 "„e£rved), should b2\n",
bË_id
);

3231 
	`åršt_”r
("### PMTable id is %0#x (%s), should be 2\n",

3232 
bË_id
,(table_id==0x00?"PAT":

3233 
bË_id
==0x01?"CAT":

3234 
bË_id
==0xFF?"Forbidden":"???"));

3235 
	`´št_d©a
(
FALSE
," D©a",
d©a
,
d©a_Ën
,20);

3238 *
´og¿m_numb”
 = 0;

3239 *
pü_pid
 = 0;

3240 *
¡»am_li¡
 = 
NULL
;

3245 
£ùiÚ_syÁax_šdiÿtÜ
 = (
d©a
[1] & 0x80) >> 7;

3246 
z”o_b™
 = (
d©a
[1] & 0x40) >> 6;

3247 
»£rved
 = (
d©a
[1] & 0x30) >> 4;

3248 ià(
£ùiÚ_syÁax_šdiÿtÜ
 !ğ1 && 
»pÜt_bad_»£rved_b™s
)

3249 
	`´št_”r
("!!! PMT: section syntax indicator is 0,‚ot 1\n");

3250 ià(
z”o_b™
 !ğ0 && 
»pÜt_bad_»£rved_b™s
)

3251 
	`´št_”r
("!!! PMT: zero bit is 1,‚ot 0\n");

3252 ià(
»£rved
 !ğ3 && 
»pÜt_bad_»£rved_b™s
)

3253 
	`åršt_”r
("!!! PMT:„e£rved (aá” z”Øb™èi %d,‚Ù 3\n",
»£rved
);

3255 
£ùiÚ_Ëngth
 = ((
d©a
[1] & 0xF) << 8) | data[2];

3256 ià(
v”bo£
)

3257 
	`åršt_msg
(" seùiÚ†’gth: %03x (%d)\n",
£ùiÚ_Ëngth
,section_length);

3262 ià(
£ùiÚ_Ëngth
 + 3 > 
d©a_Ën
)

3264 
	`åršt_”r
("### PMT continues into‡nother…acket - section†ength %d,"

3266 
£ùiÚ_Ëngth
,
d©a_Ën
-3);

3267 
	`åršt_”r
(" This software does‚ot support PMT data spanning"

3271 
d©a_Ën
 = 
£ùiÚ_Ëngth
 + 3;

3273 *
´og¿m_numb”
 = (
d©a
[3] << 8) | data[4];

3274 ià(
v”bo£
)

3275 
	`åršt_msg
("…rog¿m‚umb”: %04x\n",*
´og¿m_numb”
);

3276 
»£rved
 = (
d©a
[5] & 0xC0) >> 6;

3277 ià(
»£rved
 !ğ3 && 
»pÜt_bad_»£rved_b™s
)

3278 
	`åršt_”r
("!!! PMT:„eserved (after…rogram_number)"

3279 " i %d,‚Ù 3\n",
»£rved
);

3280 
v”siÚ_numb”
 = (
d©a
[5] & 0x3E) >> 1;

3281 
cu¼’t_Ãxt_šdiÿtÜ
 = 
d©a
[5] & 0x1;

3282 
£ùiÚ_numb”
 = 
d©a
[6];

3283 
Ï¡_£ùiÚ_numb”
 = 
d©a
[7];

3284 ià(
v”bo£
)

3285 
	`åršt_msg
(" version‚umber %02x, current‚ext %x, section‚umber %x,†ast"

3286 " seùiÚ‚umb” %x\n",
v”siÚ_numb”
,
cu¼’t_Ãxt_šdiÿtÜ
,

3287 
£ùiÚ_numb”
,
Ï¡_£ùiÚ_numb”
);

3289 
»£rved
 = (
d©a
[8] & 0xE0) >> 5;

3290 ià(
»£rved
 !ğ7 && 
»pÜt_bad_»£rved_b™s
)

3291 
	`åršt_”r
("!!! PMT:„eserved (after†ast_section_number)"

3292 " i %d,‚Ù 7\n",
»£rved
);

3293 *
pü_pid
 = ((
d©a
[8] & 0x1F) << 8) | data[9];

3294 ià(
v”bo£
)

3295 
	`åršt_msg
(" PCR PID: %04x\n",*
pü_pid
);

3297 
»£rved
 = (
d©a
[10] & 0xF0) >> 4;

3298 ià(
»£rved
 !ğ0xF && 
»pÜt_bad_»£rved_b™s
)

3299 
	`åršt_”r
("!!! PMT:„eserved (after PCR PID)"

3300 " i %x,‚Ù F\n",
»£rved
);

3302 
´og¿m_šfo_Ëngth
 = ((
d©a
[10] & 0x0F) << 8) | data[11];

3303 ià(
v”bo£
)

3304 
	`åršt_msg
("…rog¿m infØËngth: %d\n",
´og¿m_šfo_Ëngth
);

3306 ià(
v”bo£
 && 
´og¿m_šfo_Ëngth
 > 0)

3308 
	`´št_msg
(" Program info:\n");

3309 
	`´št_desütÜs
(
TRUE
," ",
NULL
,&
d©a
[12],
´og¿m_šfo_Ëngth
);

3314 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-4];

3315 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-3];

3316 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-2];

3317 
üc
 = (üø<< 8è| 
d©a
[
d©a_Ën
-1];

3320 
check_üc
 = 
	`üc32_block
(0xffffffff,
d©a
,
d©a_Ën
);

3321 ià(
check_üc
 != 0)

3323 
	`åršt_”r
("!!! Calculated CRC for PMT (PID %04x) is %08x,‚ot 00000000"

3324 " (CRC iÀd©¨wa %08x)\n",
pid
,
check_üc
,
üc
);

3331 
¡»am_d©a
 = 
d©a
 + 12 + 
´og¿m_šfo_Ëngth
;

3332 
¡»am_d©a_Ën
 = 
d©a_Ën
 - 12 - 
´og¿m_šfo_Ëngth
 - 4;

3336 
”r
 = 
	`bud_pidšt_li¡
(
¡»am_li¡
);

3337 ià(
”r
)  1;

3339 ià(
v”bo£
)

3340 
	`´št_msg
(" Program streams:\n");

3341 
¡»am_d©a_Ën
 > 0)

3343 
¡»am_ty³
 = 
¡»am_d©a
[0];

3344 
ušt32_t
 
pid
 = ((
¡»am_d©a
[1] & 0x1F) << 8) | stream_data[2];

3345 
ES_šfo_Ëngth
 = ((
¡»am_d©a
[3] & 0x0F) << 8) | stream_data[4];

3346 ià(
v”bo£
)

3348 
	#SARRAYSIZE
 40

	)

3349 
buf
[
SARRAYSIZE
];

3350 
	`¢´štf
(
buf
,
SARRAYSIZE
,"(%s)",
	`h222_¡»am_ty³_¡r
(
¡»am_ty³
));

3352 
buf
[
SARRAYSIZE
-1] = '\0';

3353 
	`åršt_msg
(" SŒ—m %02x %-40 -> PID %04x\n",
¡»am_ty³
,
buf
,
pid
);

3354 ià(
ES_šfo_Ëngth
 > 0)

3355 
	`´št_desütÜs
(
TRUE
," ",
NULL
,&
¡»am_d©a
[5],
ES_šfo_Ëngth
);

3358 
”r
 = 
	`­³nd_to_pidšt_li¡
(*
¡»am_li¡
,
pid
,
¡»am_ty³
);

3359 ià(
”r
)  1;

3360 
¡»am_d©a
 = sŒ—m_d©¨+ 5 + 
ES_šfo_Ëngth
;

3361 
¡»am_d©a_Ën
 = sŒ—m_d©a_ËÀ- 5 - 
ES_šfo_Ëngth
;

3364 
	}
}

3386 
	$¥l™_TS_·ck‘
(
by‹
 
buf
[
TS_PACKET_SIZE
],

3387 
ušt32_t
 *
pid
,

3388 *
·ylßd_un™_¡¬t_šdiÿtÜ
,

3389 
by‹
 *
ad­t
[],

3390 *
ad­t_Ën
,

3391 
by‹
 *
·ylßd
[],

3392 *
·ylßd_Ën
)

3394 
ad­tiÚ_f›ld_cÚŒŞ
;

3396 ià(
buf
[0] != 0x47)

3398 
	`åršt_”r
("### TS…ack‘ s¹ %02x,‚Ù %02x\n",
buf
[0],0x47);

3401 *
·ylßd_un™_¡¬t_šdiÿtÜ
 = (
buf
[1] & 0x40) >> 6;

3402 *
pid
 = ((
buf
[1] & 0x1f) << 8) | buf[2];

3404 ià(*
pid
 == 0x1FFF)

3408 *
ad­t
 = 
NULL
;

3409 *
ad­t_Ën
 = 0;

3410 *
·ylßd
 = 
NULL
;

3411 *
·ylßd_Ën
 = 0;

3415 
ad­tiÚ_f›ld_cÚŒŞ
 = (
buf
[3] & 0x30) >> 4;

3416 
ad­tiÚ_f›ld_cÚŒŞ
)

3419 
	`åršt_”r
("### Packet PID %04x has‡daptation field control = 0\n"

3421 *
pid
);

3422 *
ad­t
 = 
NULL
;

3423 *
ad­t_Ën
 = 0;

3424 *
·ylßd
 = 
NULL
;

3425 *
·ylßd_Ën
 = 0;

3429 *
ad­t
 = 
NULL
;

3430 *
ad­t_Ën
 = 0;

3431 *
·ylßd
 = 
buf
 + 4;

3432 *
·ylßd_Ën
 = 
TS_PACKET_SIZE
 - 4;

3436 *
ad­t_Ën
 = 
buf
[4];

3437 ià(*
ad­t_Ën
 == 0)

3438 *
ad­t
 = 
NULL
;

3440 *
ad­t
 = 
buf
 + 5;

3441 *
·ylßd
 = 
NULL
;

3442 *
·ylßd_Ën
 = 0;

3446 *
ad­t_Ën
 = 
buf
[4];

3447 ià(*
ad­t_Ën
 == 0)

3448 *
ad­t
 = 
NULL
;

3450 *
ad­t
 = 
buf
 + 5;

3451 *
·ylßd
 = 
buf
 + 5 + buf[4];

3452 *
·ylßd_Ën
 = 
TS_PACKET_SIZE
 - 5 - 
buf
[4];

3456 
	`åršt_”r
("### Packet PID %04x has‡daptation field control %x\n",

3457 *
pid
,
ad­tiÚ_f›ld_cÚŒŞ
);

3461 
	}
}

3490 
	$g‘_Ãxt_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

3491 
ušt32_t
 *
pid
,

3492 *
·ylßd_un™_¡¬t_šdiÿtÜ
,

3493 
by‹
 *
ad­t
[],

3494 *
ad­t_Ën
,

3495 
by‹
 *
·ylßd
[],

3496 *
·ylßd_Ën
)

3498 
”r
;

3499 
by‹
 *
·ck‘
;

3501 
”r
 = 
	`»ad_Ãxt_TS_·ck‘
(
t¤—d”
,&
·ck‘
);

3502 ià(
”r
 =ğ
EOF
)

3503  
EOF
;

3504 ià(
”r
)

3506 
	`´št_”r
("### Error„eading TS…acket\n");

3509  
	`¥l™_TS_·ck‘
(
·ck‘
,
pid
,
·ylßd_un™_¡¬t_šdiÿtÜ
,

3510 
ad­t
,
ad­t_Ën
,
·ylßd
,
·ylßd_Ën
);

3511 
	}
}

3527 
	$fšd_·t
(
TS_»ad”_p
 
t¤—d”
,

3528 
max
,

3529 
v”bo£
,

3530 
qu›t
,

3531 *
num_»ad
,

3532 
pidšt_li¡_p
 *
´og_li¡
)

3534 
”r
;

3535 
by‹
 *
·t_d©a
 = 
NULL
;

3536 
·t_d©a_Ën
 = 0;

3537 
·t_d©a_u£d
 = 0;

3539 *
´og_li¡
 = 
NULL
;

3540 *
num_»ad
 = 0;

3541 ià(!
qu›t
è
	`´št_msg
("Locating first PAT\n");

3545 
ušt32_t
 
pid
;

3546 
·ylßd_un™_¡¬t_šdiÿtÜ
;

3547 
by‹
 *
ad­t
, *
·ylßd
;

3548 
ad­t_Ën
, 
·ylßd_Ën
;

3550 
”r
 = 
	`g‘_Ãxt_TS_·ck‘
(
t¤—d”
,&
pid
,

3551 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

3552 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

3553 ià(
”r
 =ğ
EOF
)

3554  
EOF
;

3555 ià(
”r
)

3557 
	`´št_”r
("### Error„eading TS…acket\n");

3558 ià(
·t_d©a
è
	`ä“
(pat_data);

3562 (*
num_»ad
) ++;

3564 ià(
pid
 == 0x0000)

3566 ià(!
qu›t
)

3567 
	`åršt_msg
("Found PAT‡fter„eading %d…acket%s\n",

3568 *
num_»ad
,(*num_read==1?"":"s"));

3570 ià(
·ylßd_Ën
 == 0)

3572 
	`´št_”r
("### Packet is PAT, but has‚o…ayload\n");

3573 ià(
·t_d©a
è
	`ä“
(pat_data);

3577 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
·t_d©a
)

3580 
	`´št_”r
("!!! Discarding…revious (uncompleted) PAT data\n");

3581 
	`ä“
(
·t_d©a
);

3582 
·t_d©a
 = 
NULL
; 
·t_d©a_Ën
 = 0; 
·t_d©a_u£d
 = 0;

3584 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
·t_d©a
)

3586 
	`´št_”r
("!!! Discarding PAT continuation,‚o PAT started\n");

3590 
”r
 = 
	`bud_psi_d©a
(
v”bo£
,
·ylßd
,
·ylßd_Ën
,
pid
,

3591 &
·t_d©a
,&
·t_d©a_Ën
,&
·t_d©a_u£d
);

3592 ià(
”r
)

3594 
	`åršt_”r
("### Error %s PAT\n",

3595 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"));

3596 ià(
·t_d©a
è
	`ä“
(pat_data);

3600 ià(
·t_d©a_Ën
 =ğ
·t_d©a_u£d
)

3602 
”r
 = 
	`exŒaù_´og_li¡_äom_·t
(
v”bo£
,
·t_d©a
,
·t_d©a_Ën
,
´og_li¡
);

3603 ià(
·t_d©a
è
	`ä“
(pat_data);

3604  
”r
;

3608 ià(
max
 > 0 && *
num_»ad
 >= max)

3610 ià(!
qu›t
è
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
max
);

3611 ià(
·t_d©a
è
	`ä“
(pat_data);

3612  
EOF
;

3615 
	}
}

3635 
	$fšd_Ãxt_pmt
(
TS_»ad”_p
 
t¤—d”
,

3636 
ušt32_t
 
pmt_pid
,

3637 
´og¿m_numb”
,

3638 
max
,

3639 
v”bo£
,

3640 
qu›t
,

3641 *
num_»ad
,

3642 
pmt_p
 *
pmt
)

3644 
”r
;

3645 
by‹
 *
pmt_d©a
 = 
NULL
;

3646 
pmt_d©a_Ën
 = 0;

3647 
pmt_d©a_u£d
 = 0;

3649 *
pmt
 = 
NULL
;

3650 *
num_»ad
 = 0;

3651 ià(!
qu›t
è
	`´št_msg
("Locating‚ext PMT\n");

3655 
ušt32_t
 
pid
;

3656 
·ylßd_un™_¡¬t_šdiÿtÜ
;

3657 
by‹
 *
ad­t
, *
·ylßd
;

3658 
ad­t_Ën
, 
·ylßd_Ën
;

3660 
”r
 = 
	`g‘_Ãxt_TS_·ck‘
(
t¤—d”
,&
pid
,

3661 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

3662 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

3663 ià(
”r
 =ğ
EOF
)

3665 ià(
pmt_d©a
è
	`ä“
(pmt_data);

3666  
EOF
;

3668 ià(
”r
)

3670 
	`´št_”r
("### Error„eading TS…acket\n");

3671 ià(
pmt_d©a
è
	`ä“
(pmt_data);

3675 (*
num_»ad
) ++;

3677 ià(
pid
 =ğ
pmt_pid
)

3679 ià(!
qu›t
)

3680 
	`åršt_msg
("Found %s PMT with PID %04x (%d)‡fter„eading %d…acket%s\n",

3681 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"start of":"more of"),

3682 
pid
,pid,*
num_»ad
,(*num_read==1?"":"s"));

3684 ià(
·ylßd_Ën
 == 0)

3686 
	`åršt_”r
("### Packet is PMT with PID %04x (%d),"

3687 " buˆha nØ·ylßd\n",
pid
,pid);

3688 ià(
pmt_d©a
è
	`ä“
(pmt_data);

3692 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
pmt_d©a
)

3695 
	`´št_”r
("!!! Discarding…revious (uncompleted) PMT data\n");

3696 
	`ä“
(
pmt_d©a
);

3697 
pmt_d©a
 = 
NULL
; 
pmt_d©a_Ën
 = 0; 
pmt_d©a_u£d
 = 0;

3699 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
pmt_d©a
)

3701 
	`´št_”r
("!!! Discarding PMT continuation,‚o PMT started\n");

3705 
”r
 = 
	`bud_psi_d©a
(
v”bo£
,
·ylßd
,
·ylßd_Ën
,
pid
,

3706 &
pmt_d©a
,&
pmt_d©a_Ën
,&
pmt_d©a_u£d
);

3707 ià(
”r
)

3709 
	`åršt_”r
("### Error %s PMT\n",

3710 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"));

3711 ià(
pmt_d©a
è
	`ä“
(pmt_data);

3715 ià(
pmt_d©a_Ën
 =ğ
pmt_d©a_u£d
)

3717 
pmt_´og¿m_numb”
;

3719 
”r
 = 
	`exŒaù_pmt
(
v”bo£
,
pmt_d©a
,
pmt_d©a_Ën
,
pid
,
pmt
);

3720 
pmt_´og¿m_numb”
 = *
pmt
 =ğ
NULL
 ? -1 : ()((*pmt)->
´og¿m_numb”
);

3722 ià(
pmt_d©a
)

3724 
	`ä“
(
pmt_d©a
);

3725 
pmt_d©a
 = 
NULL
;

3731 ià(
”r
 =ğ0 && 
´og¿m_numb”
 >= 0)

3733 ià(
pmt_´og¿m_numb”
 !ğ
´og¿m_numb”
)

3735 
	`åršt_”r
("!!! Disÿrdšg PMT w™h…rog¿m‚umb” %d\n", 
pmt_´og¿m_numb”
);

3736 
	`ä“_pmt
(
pmt
);

3740  
”r
;

3744 ià(
max
 > 0 && *
num_»ad
 >= max)

3746 ià(!
qu›t
è
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
max
);

3747 ià(
pmt_d©a
è
	`ä“
(pmt_data);

3748  
EOF
;

3751 
	}
}

3772 
	$fšd_pmt
(
TS_»ad”_p
 
t¤—d”
,

3773 cÚ¡ 
»q_´og_no
,

3774 
max
,

3775 
v”bo£
,

3776 
qu›t
,

3777 *
num_»ad
,

3778 
pmt_p
 *
pmt
)

3780 
”r
;

3781 
pidšt_li¡_p
 
´og_li¡
 = 
NULL
;

3782 
soçr
;

3783 
´og_šdex
 = 0;

3784 
´og_no
 = 0;

3786 *
pmt
 = 
NULL
;

3788 
”r
 = 
	`fšd_·t
(
t¤—d”
,
max
,
v”bo£
,
qu›t
,&
soçr
,&
´og_li¡
);

3790 ià(
”r
 =ğ
EOF
)

3792 ià(!
qu›t
è
	`´št_msg
("No PAT found\n");

3795 ià(
”r
)

3797 
	`´št_”r
("### Error finding PAT\n");

3801 ià(!
qu›t
)

3803 
	`´št_msg
("\n");

3804 
	`»pÜt_pidšt_li¡
(
´og_li¡
,"Prog¿m†i¡","Prog¿m",
FALSE
);

3805 
	`´št_msg
("\n");

3808 ià(
´og_li¡
->
Ëngth
 == 0)

3810 ià(!
qu›t
è
	`åršt_msg
("NØ´og¿m defšed iÀPAT (·ck‘ %d)\n",
soçr
);

3813 ià(
´og_li¡
->
Ëngth
 > 1 && !
qu›t
)

3815 ià(
»q_´og_no
 == 1)

3816 
	`´št_msg
("Multiple…rograms in PAT - usinghe first‚on-zero\n\n");

3818 
	`åršt_msg
("MuÉË…rog¿m š PAT -…rog¿m %d\n\n", 
»q_´og_no
);

3821 
´og_šdex
 = 0;…rog_šdex < 
´og_li¡
->
Ëngth
; ++prog_index)

3823 ià(
´og_li¡
->
numb”
[
´og_šdex
] == 0)

3825 ià(++
´og_no
 =ğ
»q_´og_no
)

3829 ià(
´og_no
 == 0)

3831 
	`åršt_msg
("NØnÚ-z”Ø´og¿m_numb” š PAT (·ck‘ %d)\n",
soçr
);

3834 ià(
´og_no
 !ğ
»q_´og_no
)

3836 
	`åršt_msg
("UÇbËØfšd…rog¿m %d iÀPAT, oÆy found %d (·ck‘ %d)\n", 
»q_´og_no
, 
´og_no
, 
soçr
);

3841 
max
 -ğ
soçr
;

3843 
”r
 = 
	`fšd_Ãxt_pmt
(
t¤—d”
,
´og_li¡
->
pid
[
´og_šdex
],´og_li¡->
numb”
[prog_index],

3844 
max
,
v”bo£
,
qu›t
,
num_»ad
,
pmt
);

3846 
	`ä“_pidšt_li¡
(&
´og_li¡
);

3848 *
num_»ad
 +ğ
soçr
;

3850 ià(
”r
 =ğ
EOF
)

3852 ià(!
qu›t
è
	`´št_msg
("No PMT found\n");

3853  
EOF
;

3855 ià(
”r
)

3857 
	`´št_”r
("### Error finding PMT\n");

3861 ià(!
qu›t
)

3863 
	`´št_msg
("\n");

3864 
	`´št_msg
("Program map\n");

3865 
	`»pÜt_pmt
(
TRUE
," ",*
pmt
);

3866 
	`´št_msg
("\n");

3869 
	}
}

	@ts2es.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<”ºo.h
>

34 
	~<¡ršg.h
>

35 
	~<fú.h
>

36 #ifdeà
_WIN32


37 
	~<¡ddef.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"ts_âs.h
"

44 
	~"misc_âs.h
"

45 
	~"´štšg_âs.h
"

46 
	~"pidšt_âs.h
"

47 
	~"es_âs.h
"

48 
	~"³s_âs.h
"

49 
	~"v”siÚ.h
"

52 
	epid_exŒaù


54 
	mEXTRACT_UNDEFINED
,

55 
	mEXTRACT_VIDEO
,

56 
	mEXTRACT_AUDIO
,

57 
	mEXTRACT_PID
,

59 
pid_exŒaù
 
	tEXTRACT
;

67 
	$exŒaù_av_vŸ_³s
(*
šput_Çme
,

68 *
ouut_Çme
,

69 
wªt_video
,

70 
qu›t
)

72 
”r
;

73 
PES_»ad”_p
 
»ad”
 = 
NULL
;

74 
ES_p
 
es
 = 
NULL
;

75 
FILE
 *
ouut
;

77 ià(!
wªt_video
)

79 
	`´št_”r
("### Audio output is‚ot supported via PES inhis utility\n");

83 
ouut
 = 
	`fİ’
(
ouut_Çme
,"wb");

84 ià(
ouut
 =ğ
NULL
)

86 
	`åršt_”r
("### UÇbËØİ’ ouuˆf%s: %s\n",
ouut_Çme
,

87 
	`¡»¼Ü
(
”ºo
));

91 
”r
 = 
	`İ’_PES_»ad”
(
šput_Çme
,!
qu›t
,!qu›t,&
»ad”
);

92 ià(
”r
)

94 
	`åršt_”r
("### E¼Ü o³nšg f%s\n",
šput_Çme
);

95 
	`fşo£
(
ouut
);

99 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

102 
”r
 = 
	`bud_–em’ry_¡»am_PES
(
»ad”
,&
es
);

103 ià(
”r
)

105 
	`´št_”r
("### Errorryingo build ES„eader from PES„eader\n");

106 (è
	`şo£_PES_»ad”
(&
»ad”
);

107 (è
	`fşo£
(
ouut
);

113 
ES_un™_p
 
un™
;

114 
”r
 = 
	`fšd_ªd_bud_Ãxt_ES_un™
(
es
,&
un™
);

115 ià(
”r
 =ğ
EOF
)

117 ià(
”r
)

119 
	`´št_”r
("### Error„eading‚ext ES unit\n");

120 (è
	`fşo£
(
ouut
);

121 (è
	`şo£_PES_»ad”
(&
»ad”
);

122 
	`şo£_–em’ry_¡»am
(&
es
);

125 
”r
 = 
	`wr™e_ES_un™
(
ouut
,
un™
);

126 ià(
”r
)

128 
	`´št_”r
("### Error writing ES unit outo file\n");

129 
	`ä“_ES_un™
(&
un™
);

130 (è
	`fşo£
(
ouut
);

131 (è
	`şo£_PES_»ad”
(&
»ad”
);

132 
	`şo£_–em’ry_¡»am
(&
es
);

135 
	`ä“_ES_un™
(&
un™
);

138 (è
	`fşo£
(
ouut
);

139 (è
	`şo£_PES_»ad”
(&
»ad”
);

140 
	`şo£_–em’ry_¡»am
(&
es
);

142 
	}
}

149 
	$exŒaù_pid_·ck‘s
(
TS_»ad”_p
 
t¤—d”
,

150 
FILE
 *
ouut
,

151 
ušt32_t
 
pid_wª‹d
,

152 
max
,

153 
v”bo£
,

154 
qu›t
)

156 
”r
;

157 
couÁ
 = 0;

158 
exŒaùed
 = 0;

159 
³s_·ck‘_Ën
 = 0;

160 
gÙ_³s_·ck‘_Ën
 = 
FALSE
;

163 
Ãed_·ck‘_¡¬t
 = 
TRUE
;

167 
ušt32_t
 
pid
;

168 
·ylßd_un™_¡¬t_šdiÿtÜ
;

169 
by‹
 *
ad­t
, *
·ylßd
;

170 
ad­t_Ën
, 
·ylßd_Ën
;

172 ià(
max
 > 0 && 
couÁ
 >= max)

174 ià(!
qu›t
è
	`åršt_msg
("Stİpšg‡á” %d…ack‘s\n",
max
);

178 
”r
 = 
	`g‘_Ãxt_TS_·ck‘
(
t¤—d”
,&
pid
,

179 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

180 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

181 ià(
”r
 =ğ
EOF
)

183 ià(
”r
)

185 
	`´št_”r
("### Error„eading TS…acket\n");

189 
couÁ
++;

192 ià(
·ylßd_Ën
 == 0)

195 ià(
pid
 =ğ
pid_wª‹d
)

197 
by‹
 *
d©a
;

198 
d©a_Ën
;

199 
size_t
 
wr™‹n
;

201 ià(
v”bo£
)

203 
	`åršt_msg
("%4d: TS Pack‘ PID %04x",
couÁ
,
pid
);

204 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
)

205 
	`´št_msg
(" (start)");

206 ià(
Ãed_·ck‘_¡¬t
)

207 
	`´št_msg
(" <ignored>");

208 
	`´št_msg
("\n");

212 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
)

215 
off£t
;

217 ià(
Ãed_·ck‘_¡¬t
)

218 
Ãed_·ck‘_¡¬t
 = 
FALSE
;

220 
³s_·ck‘_Ën
 = (
·ylßd
[4] << 8) |…ayload[5];

221 ià(
v”bo£
è
	`åršt_msg
("PES…ack‘†’gth %d\n",
³s_·ck‘_Ën
);

222 
gÙ_³s_·ck‘_Ën
 = (
³s_·ck‘_Ën
 > 0);

224 ià(
	`IS_H222_PES
(
·ylßd
))

228 
off£t
 = 
·ylßd
[8] + 9;

233 
off£t
 = 
	`ÿlc_m³g1_³s_off£t
(
·ylßd
,
·ylßd_Ën
);

235 
d©a
 = &
·ylßd
[
off£t
];

236 
d©a_Ën
 = 
·ylßd_Ën
-
off£t
;

237 ià(
v”bo£
è
	`´št_d©a
(
TRUE
,"d©a",
d©a
,
d©a_Ën
,1000);

243 ià(
Ãed_·ck‘_¡¬t
)

248 
d©a
 = 
·ylßd
;

249 
d©a_Ën
 = 
·ylßd_Ën
;

250 ià(
v”bo£
è
	`´št_d©a
(
TRUE
,"D©a",
·ylßd
,
·ylßd_Ën
,1000);

252 ià(
gÙ_³s_·ck‘_Ën
)

255 ià(
d©a_Ën
 > 
³s_·ck‘_Ën
)

257 
d©a_Ën
 = 
³s_·ck‘_Ën
;

258 ià(
v”bo£
è
	`´št_d©a
(
TRUE
,"Reduûd d©a",
d©a
,
d©a_Ën
,1000);

259 
³s_·ck‘_Ën
 = 0;

262 
³s_·ck‘_Ën
 -ğ
d©a_Ën
;

265 ià(
d©a_Ën
 > 0)

268 
wr™‹n
 = 
	`fwr™e
(
d©a
,
d©a_Ën
,1,
ouut
);

269 ià(
wr™‹n
 != 1)

271 
	`åršt_”r
("### Error writing TS…acket - units written = %d\n",

272 ()
wr™‹n
);

276 
exŒaùed
 ++;

280 ià(!
qu›t
)

281 
	`åršt_msg
("Extracted %d of %d TS…acket%s\n",

282 
exŒaùed
,
couÁ
,(count==1?"":"s"));

287 ià(
qu›t
 && 
exŒaùed
 == 0)

288 
	`åršt_”r
("### No dataƒxtracted for PID %#04x (%d)\n",

289 
pid_wª‹d
,pid_wanted);

291 
	}
}

298 
	$exŒaù_av
(
šput
,

299 
FILE
 *
ouut
,

300 
wªt_video
,

301 
max
,

302 
v”bo£
,

303 
qu›t
)

305 
”r
, 
ii
;

306 
max_to_»ad
 = 
max
;

307 
tÙ®_num_»ad
 = 0;

308 
ušt32_t
 
pid
 = 0;

309 
TS_»ad”_p
 
t¤—d”
 = 
NULL
;

310 
pmt_p
 
pmt
 = 
NULL
;

313 
”r
 = 
	`bud_TS_»ad”
(
šput
,&
t¤—d”
);

314 ià(
”r
)  1;

319 
num_»ad
;

322 ià(
max
 > 0 && 
max_to_»ad
 <= 0)

325 
”r
 = 
	`fšd_pmt
(
t¤—d”
, 1, 
max_to_»ad
,
v”bo£
,
qu›t
,&
num_»ad
,&
pmt
);

326 ià(
”r
 =ğ
EOF
)

328 ià(!
qu›t
)

329 
	`´št_msg
("No…rogram stream information inhe input file\n");

330 
	`ä“_TS_»ad”
(&
t¤—d”
);

331 
	`ä“_pmt
(&
pmt
);

334 ià(
”r
)

336 
	`´št_”r
("### Error finding…rogram stream information\n");

337 
	`ä“_TS_»ad”
(&
t¤—d”
);

338 
	`ä“_pmt
(&
pmt
);

341 
max_to_»ad
 -ğ
num_»ad
;

342 
tÙ®_num_»ad
 +ğ
num_»ad
;

347 
ii
=0; i˜< 
pmt
->
num_¡»ams
; ii++)

349 ià(Ğ
wªt_video
 && 
	`IS_VIDEO_STREAM_TYPE
(
pmt
->
¡»ams
[
ii
].
¡»am_ty³
)) ||

350 (!
wªt_video
 && (
	`IS_AUDIO_STREAM_TYPE
(
pmt
->
¡»ams
[
ii
].
¡»am_ty³
))))

352 
pid
 = 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
;

356 
	`ä“_pmt
(&
pmt
);

360 ià(
pid
 != 0)

364 ià(
pid
 == 0)

366 
	`åršt_”r
("### No %s stream specified in first %d TS…ackets in input file\n",

367 (
wªt_video
?"video":"audio"),
max
);

368 
	`ä“_TS_»ad”
(&
t¤—d”
);

372 ià(!
qu›t
)

373 
	`åršt_msg
("ExŒaùšg % PID %04x (%d)\n",(
wªt_video
?"video":"audio"),

374 
pid
,pid);

377 
max
 -ğ
tÙ®_num_»ad
;

380 
”r
 = 
	`exŒaù_pid_·ck‘s
(
t¤—d”
,
ouut
,
pid
,
max
,
v”bo£
,
qu›t
);

381 
	`ä“_TS_»ad”
(&
t¤—d”
);

382  
”r
;

383 
	}
}

390 
	$exŒaù_pid
(
šput
,

391 
FILE
 *
ouut
,

392 
ušt32_t
 
pid_wª‹d
,

393 
max
,

394 
v”bo£
,

395 
qu›t
)

397 
”r
;

398 
TS_»ad”_p
 
t¤—d”
 = 
NULL
;

401 
”r
 = 
	`bud_TS_»ad”
(
šput
,&
t¤—d”
);

402 ià(
”r
)  1;

404 
”r
 = 
	`exŒaù_pid_·ck‘s
(
t¤—d”
,
ouut
,
pid_wª‹d
,
max
,
v”bo£
,
qu›t
);

406 
	`ä“_TS_»ad”
(&
t¤—d”
);

407  
”r
;

408 
	}
}

410 
	$´št_u§ge
()

412 
	`´št_msg
(

416 
	`REPORT_VERSION
("ts2es");

417 
	`´št_msg
(

449 
	}
}

451 
	$maš
(
¬gc
, **
¬gv
)

453 
u£_¡dout
 = 
FALSE
;

454 
u£_¡dš
 = 
FALSE
;

455 *
šput_Çme
 = 
NULL
;

456 *
ouut_Çme
 = 
NULL
;

457 
had_šput_Çme
 = 
FALSE
;

458 
had_ouut_Çme
 = 
FALSE
;

459 *
aùiÚ_sw™ch
 = "None";

461 
EXTRACT
 
exŒaù
 = 
EXTRACT_VIDEO
;

462 
šput
 = -1;

463 
FILE
 *
ouut
 = 
NULL
;

464 
max
 = 0;

465 
ušt32_t
 
pid
 = 0;

466 
qu›t
 = 
FALSE
;

467 
v”bo£
 = 
FALSE
;

468 
u£_³s
 = 
FALSE
;

470 
”r
 = 0;

471 
ii
 = 1;

473 ià(
¬gc
 < 2)

475 
	`´št_u§ge
();

479 
ii
 < 
¬gc
)

481 ià(
¬gv
[
ii
][0] == '-')

483 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

484 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

486 
	`´št_u§ge
();

489 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

491 
v”bo£
 = 
TRUE
;

492 
qu›t
 = 
FALSE
;

494 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

496 
v”bo£
 = 
FALSE
;

497 
qu›t
 = 
TRUE
;

499 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

501 
	`CHECKARG
("ts2es",
ii
);

502 
”r
 = 
	`št_v®ue
("ts2es",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

503 ià(
”r
)  1;

504 
ii
++;

506 ià(!
	`¡rcmp
("-³s",
¬gv
[
ii
]) || !strcmp("-ps",argv[ii]))

508 
u£_³s
 = 
TRUE
;

510 ià(!
	`¡rcmp
("-pid",
¬gv
[
ii
]))

512 
	`CHECKARG
("ts2es",
ii
);

513 
”r
 = 
	`unsigÃd_v®ue
("ts2es",
¬gv
[
ii
],¬gv[ii+1],0,&
pid
);

514 ià(
”r
)  1;

515 
ii
++;

516 
exŒaù
 = 
EXTRACT_PID
;

518 ià(!
	`¡rcmp
("-video",
¬gv
[
ii
]))

520 
exŒaù
 = 
EXTRACT_VIDEO
;

522 ià(!
	`¡rcmp
("-audio",
¬gv
[
ii
]))

524 
exŒaù
 = 
EXTRACT_AUDIO
;

526 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

528 
u£_¡dš
 = 
TRUE
;

529 
had_šput_Çme
 = 
TRUE
;

531 ià(!
	`¡rcmp
("-¡dout",
¬gv
[
ii
]))

533 
u£_¡dout
 = 
TRUE
;

534 
had_ouut_Çme
 = 
TRUE
;

535 
	`»dœeù_ouut_¡d”r
();

537 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

539 
	`CHECKARG
("ts2es",
ii
);

540 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

541 
	`»dœeù_ouut_¡d”r
();

542 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

543 
	`»dœeù_ouut_¡dout
();

546 
	`åršt_”r
("###s2es: "

548 " '¡d”r')\n",
¬gv
[
ii
+1]);

551 
ii
++;

555 
	`åršt_”r
("###s2es: "

556 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

562 ià(
had_šput_Çme
 && 
had_ouut_Çme
)

564 
	`åršt_”r
("###s2es: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

567 ià(
had_šput_Çme
)

569 
ouut_Çme
 = 
¬gv
[
ii
];

570 
had_ouut_Çme
 = 
TRUE
;

574 
šput_Çme
 = 
¬gv
[
ii
];

575 
had_šput_Çme
 = 
TRUE
;

578 
ii
++;

581 ià(!
had_šput_Çme
)

583 
	`´št_”r
("###s2es: No input file specified\n");

587 ià(!
had_ouut_Çme
)

589 
	`åršt_”r
("###s2es: "

590 "NØouuˆf¥ecif›d fÜ %s\n",
aùiÚ_sw™ch
);

596 ià(
u£_³s
 && 
exŒaù
 =ğ
EXTRACT_PID
)

598 
	`´št_”r
("###s2es: -pid is‚ot supported with -pes\n");

601 ià(
u£_³s
 && 
u£_¡dout
)

603 
	`´št_”r
("###s2es: -stdout is‚ot supported with -pes\n");

606 ià(
u£_³s
 && 
u£_¡dš
)

608 
	`´št_”r
("###s2es: -stdin is‚ot supported with -pes\n");

611 ià(
u£_³s
)

613 
”r
 = 
	`exŒaù_av_vŸ_³s
(
šput_Çme
,
ouut_Çme
,(
exŒaù
==
EXTRACT_VIDEO
),

614 
qu›t
);

615 ià(
”r
)

617 
	`´št_”r
("###s2es: Error writing via PES\n");

625 ià(
u£_¡dout
)

627 
v”bo£
 = 
FALSE
;

628 
qu›t
 = 
TRUE
;

631 ià(
u£_¡dš
)

632 
šput
 = 
STDIN_FILENO
;

635 
šput
 = 
	`İ’_bš¬y_fe
(
šput_Çme
,
FALSE
);

636 ià(
šput
 == -1)

638 
	`åršt_”r
("###s2es: UÇbËØİ’ iÅuˆf%s\n",
šput_Çme
);

642 ià(!
qu›t
)

643 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

645 ià(
had_ouut_Çme
)

647 ià(
u£_¡dout
)

648 
ouut
 = 
¡dout
;

651 
ouut
 = 
	`fİ’
(
ouut_Çme
,"wb");

652 ià(
ouut
 =ğ
NULL
)

654 ià(!
u£_¡dš
è(è
	`şo£_fe
(
šput
);

655 
	`åršt_”r
("###s2es: "

656 "UÇbËØİ’ ouuˆf%s: %s\n",
ouut_Çme
,

657 
	`¡»¼Ü
(
”ºo
));

661 ià(!
qu›t
)

662 
	`åršt_msg
("Wr™šgØ %s\n",(
u£_¡dout
?"<¡dout>":
ouut_Çme
));

665 ià(!
qu›t
)

667 ià(
exŒaù
 =ğ
EXTRACT_PID
)

668 
	`åršt_msg
("ExŒaùšg…ack‘ fÜ PID %04x (%d)\n",
pid
,pid);

670 
	`åršt_msg
("ExŒaùšg %s\n",(
exŒaù
==
EXTRACT_VIDEO
?"video":"audio"));

673 ià(
max
 && !
qu›t
)

674 
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
max
);

676 ià(
exŒaù
 =ğ
EXTRACT_PID
)

677 
”r
 = 
	`exŒaù_pid
(
šput
,
ouut
,
pid
,
max
,
v”bo£
,
qu›t
);

679 
”r
 = 
	`exŒaù_av
(
šput
,
ouut
,(
exŒaù
==
EXTRACT_VIDEO
),

680 
max
,
v”bo£
,
qu›t
);

681 ià(
”r
)

683 
	`´št_”r
("###s2es: Errorƒxtracting data\n");

684 ià(!
u£_¡dš
è(è
	`şo£_fe
(
šput
);

685 ià(!
u£_¡dout
è(è
	`fşo£
(
ouut
);

690 ià(!
u£_¡dout
)

692 
”ºo
 = 0;

693 
”r
 = 
	`fşo£
(
ouut
);

694 ià(
”r
)

696 
	`åršt_”r
("###s2es: Error closing output file %s: %s\n",

697 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

698 (è
	`şo£_fe
(
šput
);

702 ià(!
u£_¡dš
)

704 
”r
 = 
	`şo£_fe
(
šput
);

705 ià(
”r
)

706 
	`åršt_”r
("###s2es: E¼Ü closšg iÅuˆf%s\n",
šput_Çme
);

709 
	}
}

	@ts2ps.c

30 
	~<¡dio.h
>

31 
	~<¡dlib.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

34 
	~<fú.h
>

35 #ifdeà
_WIN32


36 
	~<¡ddef.h
>

38 
	~<uni¡d.h
>

41 
	~"com·t.h
"

42 
	~"ps_âs.h
"

43 
	~"ts_âs.h
"

44 
	~"misc_âs.h
"

45 
	~"´štšg_âs.h
"

46 
	~"pidšt_âs.h
"

47 
	~"³s_âs.h
"

48 
	~"v”siÚ.h
"

56 
	$wr™e_´og¿m_’d_code
(
FILE
 *
ouut
)

58 
by‹
 
´og¿m_’d_code
[] = {0x00, 0x00, 0x01, 0xB9};

59 
size_t
 
couÁ
 = 
	`fwr™e
(
´og¿m_’d_code
,4,1,
ouut
);

60 ià(
couÁ
 != 1)

62 
	`´št_”r
("### Error writing PS…rogramƒnd code\n");

66 
	}
}

73 
	$wr™e_·ck_h—d”
(
FILE
 *
ouut
)

75 
by‹
 
·ck_h—d”
[] = {0x00, 0x00, 0x01, 0xBA,

79 
size_t
 
couÁ
;

84 
couÁ
 = 
	`fwr™e
(
·ck_h—d”
,Õack_h—d”),1,
ouut
);

85 ià(
couÁ
 != 1)

87 
	`´št_”r
("### Error writing PS…ack header outo file\n");

91 
	}
}

99 
	$wr™e_PES_·ck‘
(
FILE
 *
ouut
,

100 
by‹
 *
d©a
,

101 
ušt16_t
 
d©a_Ën
,

102 
by‹
 
¡»am_id
)

104 
by‹
 
h—d”
[] = {0x00, 0x00, 0x01,

107 
size_t
 
couÁ
;

108 
ušt16_t
 
PES_·ck‘_Ëngth
 = 
d©a_Ën
 + 3;

110 
h—d”
[3] = 
¡»am_id
;

111 
h—d”
[4] = (
PES_·ck‘_Ëngth
 & 0xFF00) >> 8;

112 
h—d”
[5] = (
PES_·ck‘_Ëngth
 & 0x00FF);

114 
couÁ
 = 
	`fwr™e
(
h—d”
,(h—d”),1,
ouut
);

115 ià(
couÁ
 != 1)

117 
	`´št_”r
("### Error writing PS PES…acket header outo file\n");

121 
couÁ
 = 
	`fwr™e
(
d©a
,
d©a_Ën
,1,
ouut
);

122 ià(
couÁ
 != 1)

124 
	`´št_”r
("### Error writing PS PES…acket data outo file\n");

128 
	}
}

135 
	$exŒaù_d©a
(
šput
,

136 
FILE
 *
ouut
,

137 
ušt16_t
 
´og¿m_numb”
,

138 
max
,

139 
v”bo£
,

140 
qu›t
)

142 
”r
;

143 
PES_»ad”_p
 
»ad”
;

145 
”r
 = 
	`bud_PES_»ad”
(
šput
,
TRUE
,!
qu›t
,!qu›t,
´og¿m_numb”
,&
»ad”
);

146 ià(
”r
)

148 
	`´št_”r
("### Error building PES„eader over input file\n");

155 
size_t
 
couÁ
;

156 
”r
 = 
	`»ad_Ãxt_PES_·ck‘
(
»ad”
);

157 ià(
”r
 =ğ
EOF
)

159 ià(
”r
)

161 
	`´št_”r
("### Error„eading‚ext PES…acket\n");

162 (è
	`ä“_PES_»ad”
(&
»ad”
);

165 
”r
 = 
	`wr™e_·ck_h—d”
(
ouut
);

166 ià(
”r
)

168 
	`´št_”r
("### Error writing PS…ack header\n");

169 (è
	`ä“_PES_»ad”
(&
»ad”
);

177 ià(
»ad”
->
·ck‘
->
d©a
[4] == 0 &&

178 
»ad”
->
·ck‘
->
d©a
[5] == 0)

180 
št32_t
 
PES_·ck‘_Ëngth
 = 
»ad”
->
·ck‘
->
d©a_Ën
 - 6;

181 
by‹
 *
¡¬t
 = 
»ad”
->
·ck‘
->
d©a
;

186 
	#MAX_LENGTH
 0xFFFF

	)

187 ià(
PES_·ck‘_Ëngth
 > 
MAX_LENGTH
)

189 
	`åršt_”r
("PES…acket of 'zero'†ength is„eally %6d -oo†ong for one…acket\n",

190 
PES_·ck‘_Ëngth
);

192 
»ad”
->
·ck‘
->
d©a
[4] = (
MAX_LENGTH
 & 0xFF00) >> 8;

193 
»ad”
->
·ck‘
->
d©a
[5] = (
MAX_LENGTH
 & 0x00FF);

196 
	`åršt_”r
(".. wr™šg ouˆ%5d (%5dÙ®)\n",
MAX_LENGTH
,MAX_LENGTH+6);

197 
couÁ
 = 
	`fwr™e
(
»ad”
->
·ck‘
->
d©a
,
MAX_LENGTH
+6,1,
ouut
);

198 ià(
couÁ
 != 1)

200 
	`´št_”r
("### Error writing (start of) PES…acket outo file\n");

201 (è
	`ä“_PES_»ad”
(&
»ad”
);

204 
PES_·ck‘_Ëngth
 -ğ
MAX_LENGTH
;

205 
¡¬t
 +ğ
MAX_LENGTH
+6;

206 
PES_·ck‘_Ëngth
 > 0)

215 
this_Ëngth
 = 
	`mš
(
MAX_LENGTH
-3,
PES_·ck‘_Ëngth
);

216 
”r
;

217 
	`åršt_”r
(".. wr™šg ouˆ%5d\n",
this_Ëngth
);

218 
”r
 = 
	`wr™e_PES_·ck‘
(
ouut
,
¡¬t
,
this_Ëngth
,

219 
»ad”
->
·ck‘
->
d©a
[3]);

220 ià(
”r
)

222 
	`´št_”r
("### Error writing (part of) PES…acket outo file\n");

223 (è
	`ä“_PES_»ad”
(&
»ad”
);

226 
PES_·ck‘_Ëngth
 -ğ
this_Ëngth
;

227 
¡¬t
 +ğ
this_Ëngth
;

232 
	`åršt_”r
("PES…acket of 'zero'†ength,‡djustingo %6d-6=%6d"

234 
»ad”
->
·ck‘
->
d©a_Ën
,
PES_·ck‘_Ëngth
,

235 
»ad”
->
·ck‘
->
d©a
[3],»ad”->·ck‘->
Ëngth
);

236 
»ad”
->
·ck‘
->
d©a
[4] = (
PES_·ck‘_Ëngth
 & 0xFF00) >> 8;

237 
»ad”
->
·ck‘
->
d©a
[5] = (
PES_·ck‘_Ëngth
 & 0x00FF);

238 
couÁ
 = 
	`fwr™e
(
»ad”
->
·ck‘
->
d©a
,»ad”->·ck‘->
d©a_Ën
,1,
ouut
);

239 ià(
couÁ
 != 1)

241 
	`´št_”r
("### Error writing PES…acket outo file\n");

242 (è
	`ä“_PES_»ad”
(&
»ad”
);

249 
couÁ
 = 
	`fwr™e
(
»ad”
->
·ck‘
->
d©a
,»ad”->·ck‘->
d©a_Ën
,1,
ouut
);

250 ià(
couÁ
 != 1)

252 
	`´št_”r
("### Error writing PES…acket outo file\n");

253 (è
	`ä“_PES_»ad”
(&
»ad”
);

259 
”r
 = 
	`wr™e_´og¿m_’d_code
(
ouut
);

260 ià(
”r
)

262 (è
	`ä“_PES_»ad”
(&
»ad”
);

266 (è
	`ä“_PES_»ad”
(&
»ad”
);

268 
	}
}

270 
	$´št_u§ge
()

272 
	`´št_msg
(

276 
	`REPORT_VERSION
("ts2ps");

277 
	`´št_msg
(

301 
	}
}

303 
	$maš
(
¬gc
, **
¬gv
)

305 
u£_¡dout
 = 
FALSE
;

306 
u£_¡dš
 = 
FALSE
;

307 *
šput_Çme
 = 
NULL
;

308 *
ouut_Çme
 = 
NULL
;

309 
had_šput_Çme
 = 
FALSE
;

310 
had_ouut_Çme
 = 
FALSE
;

312 
šput
 = -1;

313 
FILE
 *
ouut
 = 
NULL
;

314 
max
 = 0;

315 
qu›t
 = 
FALSE
;

316 
v”bo£
 = 
FALSE
;

317 
ušt16_t
 
´og¿m_numb”
 = 0;

319 
”r
 = 0;

320 
ii
 = 1;

322 ià(
¬gc
 < 2)

324 
	`´št_u§ge
();

328 
ii
 < 
¬gc
)

330 ià(
¬gv
[
ii
][0] == '-')

332 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

333 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

335 
	`´št_u§ge
();

338 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

340 
v”bo£
 = 
TRUE
;

341 
qu›t
 = 
FALSE
;

343 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

345 
v”bo£
 = 
FALSE
;

346 
qu›t
 = 
TRUE
;

348 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

350 
	`CHECKARG
("ts2ps",
ii
);

351 
”r
 = 
	`št_v®ue
("ts2ps",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

352 ià(
”r
)  1;

353 
ii
++;

355 ià(!
	`¡rcmp
("-´og",
¬gv
[
ii
]))

357 
‹mp
;

358 
	`CHECKARG
("ts2ps",
ii
);

359 
”r
 = 
	`št_v®ue
("ts2ps",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
‹mp
);

360 ià(
”r
)  1;

361 
´og¿m_numb”
 = 
‹mp
;

362 
ii
++;

364 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

366 
u£_¡dš
 = 
TRUE
;

367 
had_šput_Çme
 = 
TRUE
;

369 ià(!
	`¡rcmp
("-¡dout",
¬gv
[
ii
]))

371 
u£_¡dout
 = 
TRUE
;

372 
had_ouut_Çme
 = 
TRUE
;

373 
	`»dœeù_ouut_¡d”r
();

375 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

377 
	`CHECKARG
("ts2ps",
ii
);

378 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

379 
	`»dœeù_ouut_¡d”r
();

380 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

381 
	`»dœeù_ouut_¡dout
();

384 
	`åršt_”r
("###s2ps: "

386 " '¡d”r')\n",
¬gv
[
ii
+1]);

389 
ii
++;

393 
	`åršt_”r
("###s2ps: "

394 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

400 ià(
had_šput_Çme
 && 
had_ouut_Çme
)

402 
	`åršt_”r
("###s2ps: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

405 ià(
had_šput_Çme
)

407 
ouut_Çme
 = 
¬gv
[
ii
];

408 
had_ouut_Çme
 = 
TRUE
;

412 
šput_Çme
 = 
¬gv
[
ii
];

413 
had_šput_Çme
 = 
TRUE
;

416 
ii
++;

419 ià(!
had_šput_Çme
)

421 
	`´št_”r
("###s2ps: No input file specified\n");

425 ià(!
had_ouut_Çme
)

427 
	`´št_”r
("###s2ps: No output file specified\n");

432 ià(
u£_¡dout
)

434 
v”bo£
 = 
FALSE
;

435 
qu›t
 = 
TRUE
;

438 ià(
u£_¡dš
)

439 
šput
 = 
STDIN_FILENO
;

442 
šput
 = 
	`İ’_bš¬y_fe
(
šput_Çme
,
FALSE
);

443 ià(
šput
 == -1)

445 
	`åršt_”r
("###s2ps: UÇbËØİ’ iÅuˆf%s\n",
šput_Çme
);

449 ià(!
qu›t
)

450 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

452 ià(
had_ouut_Çme
)

454 ià(
u£_¡dout
)

455 
ouut
 = 
¡dout
;

458 
ouut
 = 
	`fİ’
(
ouut_Çme
,"wb");

459 ià(
ouut
 =ğ
NULL
)

461 ià(!
u£_¡dš
è(è
	`şo£_fe
(
šput
);

462 
	`åršt_”r
("###s2ps: "

463 "UÇbËØİ’ ouuˆf%s: %s\n",
ouut_Çme
,

464 
	`¡»¼Ü
(
”ºo
));

468 ià(!
qu›t
)

469 
	`åršt_msg
("Wr™šgØ %s\n",(
u£_¡dout
?"<¡dout>":
ouut_Çme
));

472 ià(
max
 && !
qu›t
)

473 
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
max
);

475 
”r
 = 
	`exŒaù_d©a
(
šput
,
ouut
,
´og¿m_numb”
,
max
,
v”bo£
,
qu›t
);

476 ià(
”r
)

478 
	`´št_”r
("###s2ps: Errorƒxtracting data\n");

479 ià(!
u£_¡dš
è(è
	`şo£_fe
(
šput
);

480 ià(!
u£_¡dout
è(è
	`fşo£
(
ouut
);

485 ià(!
u£_¡dout
)

487 
”ºo
 = 0;

488 
”r
 = 
	`fşo£
(
ouut
);

489 ià(
”r
)

491 
	`åršt_”r
("###s2ps: Error closing output file %s: %s\n",

492 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

493 (è
	`şo£_fe
(
šput
);

497 ià(!
u£_¡dš
)

499 
”r
 = 
	`şo£_fe
(
šput
);

500 ià(
”r
)

501 
	`åršt_”r
("###s2ps: E¼Ü closšg iÅuˆf%s\n",
šput_Çme
);

504 
	}
}

	@ts_defns.h

29 #iâdeà
_ts_deâs


30 
	#_ts_deâs


	)

32 
	~"com·t.h
"

35 
	#TS_PACKET_SIZE
 188

	)

40 
	#MAX_TS_PAYLOAD_SIZE
 (
TS_PACKET_SIZE
-4)

	)

61 
	#PCR_READ_AHEAD_SIZE
 20000

62 

	)

63 
	s_ts_pü_bufãr


65 
by‹
 
	mTS_bufãr
[
PCR_READ_AHEAD_SIZE
][
TS_PACKET_SIZE
];

68 
ušt32_t
 
	mTS_bufãr_pids
[
PCR_READ_AHEAD_SIZE
];

71 
ušt32_t
 
	mTS_bufãr_pü_pid
;

74 
	mTS_bufãr_Ën
;

76 
	mTS_bufãr_Ãxt
;

78 
ušt64_t
 
	mTS_bufãr_’d_pü
;

80 
ušt64_t
 
	mTS_bufãr_´ev_pü
;

82 
ušt64_t
 
	mTS_bufãr_time_³r_TS
;

85 
	mTS_bufãr_po¢
;

89 
	mTS_had_EOF
;

91 
_ts_pü_bufãr
 *
	tTS_pü_bufãr_p
;

92 
	#SIZEOF_TS_PCR_BUFFER
 (
_ts_pü_bufãr
)

	)

96 
	#TS_READ_AHEAD_COUNT
 1024

98 
	#TS_READ_AHEAD_BYTES
 
TS_READ_AHEAD_COUNT
*
TS_PACKET_SIZE


	)

105 
	s_ts_»ad”


107 
	mfe
;

108 
off£t_t
 
	mpo¢
;

109 *
	mhªdË
;

114 (*
	m»ad_â
)(*, 
	mby‹
 *, 
	msize_t
);

115 (*
	m£ek_â
)(*, 
	moff£t_t
);

117 
by‹
 
	m»ad_ah—d
[
TS_READ_AHEAD_COUNT
*
TS_PACKET_SIZE
];

118 
by‹
 *
	m»ad_ah—d_±r
;

119 
by‹
 *
	m»ad_ah—d_’d
;

123 
TS_pü_bufãr_p
 
	mpübuf
;

125 
_ts_»ad”
 *
	tTS_»ad”_p
;

126 
	#SIZEOF_TS_READER
 (
_ts_»ad”
)

	)

	@ts_fns.h

30 #iâdeà
_ts_âs


31 
	#_ts_âs


	)

33 
	~"com·t.h
"

34 
	~"h222_deâs.h
"

35 
	~"tswr™e_deâs.h
"

36 
	~"pidšt_deâs.h
"

37 
	~"ts_deâs.h
"

61 
wr™e_TS_´og¿m_d©a
(
TS_wr™”_p
 
ouut
,

62 
ušt32_t
 
Œª¥Üt_¡»am_id
,

63 
ušt32_t
 
´og¿m_numb”
,

64 
ušt32_t
 
pmt_pid
,

65 
ušt32_t
 
pid
,

66 
by‹
 
¡»am_ty³
);

84 
wr™e_TS_´og¿m_d©a2
(
TS_wr™”_p
 
ouut
,

85 
ušt32_t
 
Œª¥Üt_¡»am_id
,

86 
ušt32_t
 
´og¿m_numb”
,

87 
ušt32_t
 
pmt_pid
,

88 
ušt32_t
 
pü_pid
,

89 
num_´ogs
,

90 
ušt32_t
 
´og_pid
[],

91 
by‹
 
´og_ty³
[]);

102 
wr™e_·t
(
TS_wr™”_p
 
ouut
,

103 
ušt32_t
 
Œª¥Üt_¡»am_id
,

104 
pidšt_li¡_p
 
´og_li¡
);

114 
wr™e_pmt
(
TS_wr™”_p
 
ouut
,

115 
ušt32_t
 
pmt_pid
,

116 
pmt_p
 
pmt
);

129 
wr™e_·t_ªd_pmt
(
TS_wr™”_p
 
ouut
,

130 
ušt32_t
 
Œª¥Üt_¡»am_id
,

131 
pidšt_li¡_p
 
´og_li¡
,

132 
ušt32_t
 
pmt_pid
,

133 
pmt_p
 
pmt
);

144 
wr™e_sšgË_´og¿m_·t
(
TS_wr™”_p
 
ouut
,

145 
ušt32_t
 
Œª¥Üt_¡»am_id
,

146 
ušt32_t
 
´og¿m_numb”
,

147 
ušt32_t
 
pmt_pid
);

166 
wr™e_ES_as_TS_PES_·ck‘
(
TS_wr™”_p
 
ouut
,

167 
by‹
 
d©a
[],

168 
ušt32_t
 
d©a_Ën
,

169 
ušt32_t
 
pid
,

170 
by‹
 
¡»am_id
);

204 
wr™e_ES_as_TS_PES_·ck‘_w™h_±s_dts
(
TS_wr™”_p
 
ouut
,

205 
by‹
 
d©a
[],

206 
ušt32_t
 
d©a_Ën
,

207 
ušt32_t
 
pid
,

208 
by‹
 
¡»am_id
,

209 
gÙ_±s
,

210 
ušt64_t
 
±s
,

211 
gÙ_dts
,

212 
ušt64_t
 
dts
);

232 
wr™e_ES_as_TS_PES_·ck‘_w™h_pü
(
TS_wr™”_p
 
ouut
,

233 
by‹
 
d©a
[],

234 
ušt32_t
 
d©a_Ën
,

235 
ušt32_t
 
pid
,

236 
by‹
 
¡»am_id
,

237 
ušt64_t
 
pü_ba£
,

238 
ušt32_t
 
pü_exŠ
);

259 
wr™e_PES_as_TS_PES_·ck‘
(
TS_wr™”_p
 
ouut
,

260 
by‹
 
d©a
[],

261 
ušt32_t
 
d©a_Ën
,

262 
ušt32_t
 
pid
,

263 
by‹
 
¡»am_id
,

264 
gÙ_pü
,

265 
ušt64_t
 
pü_ba£
,

266 
ušt32_t
 
pü_exŠ
);

274 
wr™e_TS_nuÎ_·ck‘
(
TS_wr™”_p
 
ouut
);

290 
bud_TS_»ad”
(
fe
,

291 
TS_»ad”_p
 *
t¤—d”
);

298 
bud_TS_»ad”_w™h_âs
(*
hªdË
,

299 (*
»ad_â
)(*, 
by‹
 *, 
size_t
),

300 (*
£ek_â
)(*, 
off£t_t
),

301 
TS_»ad”_p
 *
t¤—d”
);

310 
	`İ’_fe_fÜ_TS_»ad
(*
f’ame
,

311 
TS_»ad”_p
 *
t¤—d”
);

317 
	`ä“_TS_»ad”
(
TS_»ad”_p
 *
t¤—d”
);

326 
	`şo£_TS_»ad”
(
TS_»ad”_p
 *
t¤—d”
);

340 
	`£ek_usšg_TS_»ad”
(
TS_»ad”_p
 
t¤—d”
,

341 
off£t_t
 
po¢
);

363 
	`»ad_»¡_of_fœ¡_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

364 
by‹
 
¡¬t
[4],

365 
by‹
 **
·ck‘
);

381 
	`»ad_Ãxt_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

382 
by‹
 **
·ck‘
);

399 
	`´ime_»ad_bufã»d_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

400 
ušt32_t
 
pü_pid
);

425 
	`»ad_fœ¡_TS_·ck‘_äom_bufãr
(
TS_»ad”_p
 
t¤—d”
,

426 
ušt32_t
 
pü_pid
,

427 
ušt32_t
 
¡¬t_couÁ
,

428 
by‹
 *
d©a
[
TS_PACKET_SIZE
],

429 
ušt32_t
 *
pid
,

430 
ušt64_t
 *
pü
,

431 
ušt32_t
 *
couÁ
);

446 
	`»ad_Ãxt_TS_·ck‘_äom_bufãr
(
TS_»ad”_p
 
t¤—d”
,

447 
by‹
 *
d©a
[
TS_PACKET_SIZE
],

448 
ušt32_t
 *
pid
,

449 
ušt64_t
 *
pü
);

479 
	`»ad_bufã»d_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

480 
ušt32_t
 *
couÁ
,

481 
by‹
 *
d©a
[
TS_PACKET_SIZE
],

482 
ušt32_t
 *
pid
,

483 
ušt64_t
 *
pü
,

484 
max
,

485 
loİ
,

486 
off£t_t
 
¡¬t_po¢
,

487 
ušt32_t
 
¡¬t_couÁ
,

488 
qu›t
);

501 
	`g‘_PCR_äom_ad­tiÚ_f›ld
(
by‹
 
ad­t
[],

502 
ad­t_Ën
,

503 *
gÙ_pü
,

504 
ušt64_t
 *
pü
);

513 
	`»pÜt_ad­tiÚ_f›ld
(
by‹
 
ad­t
[],

514 
ad­t_Ën
);

526 
	`»pÜt_ad­tiÚ_timšg
(
timšg_p
 
times
,

527 
by‹
 
ad­t
[],

528 
ad­t_Ën
,

529 
·ck‘_couÁ
);

543 
	`»pÜt_·ylßd
(
show_d©a
,

544 
¡»am_ty³
,

545 
by‹
 
·ylßd
[
MAX_TS_PAYLOAD_SIZE
],

546 
·ylßd_Ën
,

547 
·ylßd_un™_¡¬t_šdiÿtÜ
);

560 
	`´št_desütÜs
(
is_msg
,

561 *
Ëad”1
,

562 *
Ëad”2
,

563 
by‹
 *
desc_d©a
,

564 
desc_d©a_Ën
);

578 
	`exŒaù_´og_li¡_äom_·t
(
v”bo£
,

579 
by‹
 
·ylßd
[
MAX_TS_PAYLOAD_SIZE
],

580 
·ylßd_Ën
,

581 
pidšt_li¡_p
 *
´og_li¡
);

598 
	`exŒaù_¡»am_li¡_äom_pmt
(
v”bo£
,

599 
by‹
 
·ylßd
[
MAX_TS_PAYLOAD_SIZE
],

600 
·ylßd_Ën
,

601 
ušt32_t
 
pid
,

602 *
´og¿m_numb”
,

603 
ušt32_t
 *
pü_pid
,

604 
pidšt_li¡_p
 *
¡»am_li¡
);

633 
	`bud_psi_d©a
(
v”bo£
,

634 
by‹
 
·ylßd
[
MAX_TS_PAYLOAD_SIZE
],

635 
·ylßd_Ën
,

636 
ušt32_t
 
pid
,

637 
by‹
 **
d©a
,

638 *
d©a_Ën
,

639 *
d©a_u£d
);

652 
	`exŒaù_pmt
(
v”bo£
,

653 
by‹
 
d©a
[],

654 
d©a_Ën
,

655 
ušt32_t
 
pid
,

656 
pmt_p
 *
pmt
);

677 
	`¥l™_TS_·ck‘
(
by‹
 
buf
[
TS_PACKET_SIZE
],

678 
ušt32_t
 *
pid
,

679 *
·ylßd_un™_¡¬t_šdiÿtÜ
,

680 
by‹
 *
ad­t
[],

681 *
ad­t_Ën
,

682 
by‹
 *
·ylßd
[],

683 *
·ylßd_Ën
);

711 
	`g‘_Ãxt_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

712 
ušt32_t
 *
pid
,

713 *
·ylßd_un™_¡¬t_šdiÿtÜ
,

714 
by‹
 *
ad­t
[],

715 *
ad­t_Ën
,

716 
by‹
 *
·ylßd
[],

717 *
·ylßd_Ën
);

732 
	`fšd_·t
(
TS_»ad”_p
 
t¤—d”
,

733 
max
,

734 
v”bo£
,

735 
qu›t
,

736 *
num_»ad
,

737 
pidšt_li¡_p
 *
´og_li¡
);

756 
	`fšd_Ãxt_pmt
(
TS_»ad”_p
 
t¤—d”
,

757 
ušt32_t
 
pmt_pid
,

758 
´og¿m_numb”
,

759 
max
,

760 
v”bo£
,
qu›t
,

761 *
num_»ad
,

762 
pmt_p
 *
pmt
);

782 
	`fšd_pmt
(
TS_»ad”_p
 
t¤—d”
,

783 cÚ¡ 
»q_´og_no
,

784 
max
,

785 
v”bo£
,

786 
qu›t
,

787 *
num_»ad
,

788 
pmt_p
 *
pmt
);

	@ts_packet_insert.c

27 
	~"com·t.h
"

28 
	~<¡dio.h
>

29 
	~<¡dlib.h
>

30 
	~<¡ršg.h
>

31 
	~<fú.h
>

32 
	~<sys/¡©.h
>

33 
	~<as£¹.h
>

34 
	~<”ºo.h
>

36 
	~"misc_âs.h
"

37 
	~"´štšg_âs.h
"

38 
	~"v”siÚ.h
"

40 
	#TS_PACKET_SIZE
 188

	)

42 
	#TO_BE16
(
äom
,
to
è*tØğ(0xFF & (äom>>8)); *Ño+1èğ(0xFF & from);

	)

44 
ušt8_t
 *
	$ü—‹_out_·ck‘
(*
š_d©a
, 
š_Ën
, 
ušt16_t
 
pid
)

46 
ušt8_t
 *
out_·ck‘
 = 
	`m®loc
(
TS_PACKET_SIZE
);

47 
ušt8_t
 *
±r
 = 
out_·ck‘
;

48 
ušt16_t
 
æags
;

49 
ušt16_t
 
æags_pid
;

51 ià(!
±r
)

52  
NULL
;

53 ià(
š_Ën
 > (
TS_PACKET_SIZE
 - 4))

54  
NULL
;

56 *
±r
 = 0x47;

57 
±r
++;

60 
æags
 = 0<<15;

63 
æags
 = flags | 0<<14;

66 
æags
 = flags | 0<<13;

68 
æags_pid
 = 
æags
 | 
pid
;

69 
	`TO_BE16
(
æags_pid
,
±r
);

70 
±r
+=2;

72 *
±r
 = 0x11;

73 
±r
++;

75 
	`memıy
(
±r
,
š_d©a
,
š_Ën
);

76 
±r
+=
š_Ën
;

78 
	`mem£t
(
±r
,0xFF,
TS_PACKET_SIZE
-ÕŒ-
out_·ck‘
));

79 
±r
+=
TS_PACKET_SIZE
-ÕŒ-
out_·ck‘
);

81 
	`as£¹
((
±r
-
TS_PACKET_SIZE
è=ğ
out_·ck‘
);

84 
i
;

85 
±r
 = 
out_·ck‘
;

86 
	`´št_msg
("Packeto be written is:\n");

87 
i
=0;i<
TS_PACKET_SIZE
;i++)

89 ià(!(
i
%16)è
	`´št_msg
("\n");

91 
	`åršt_msg
("%02x ",
±r
[
i
]);

93 
	`´št_msg
("\n\n");

96  
out_·ck‘
;

97 
	}
}

100 
	$š£¹_·ck‘s
(
fe
,

101 
out_fe
,

102 
ušt8_t
 *
out_·ck‘
,

103 *
·ck‘_numb”s
,
n_·ck
)

105 
ušt8_t
 
buf
[
TS_PACKET_SIZE
];

106 
rv
;

107 
·ck‘s_»ad
=0;

108 
by‹s_»ad
=0;

109 
·cknum_i
=0;

113 
rv
 = 
	`»ad
(
fe
, 
buf
, 
TS_PACKET_SIZE
);

115 ià(
rv
 == 0) ;

116 ià(
rv
 !ğ
TS_PACKET_SIZE
) „v;

118 
by‹s_»ad
+=
rv
;

120 ià(
·ck‘_numb”s
[
·cknum_i
]==
·ck‘s_»ad
 &&…acknum_i<
n_·ck
)

122 
	`åršt_msg
("Wr™šg‚ew…ack‘ befÜ·ck‘ %d...\n",
·ck‘s_»ad
);

124 
rv
 = 
	`wr™e
(
out_fe
,
out_·ck‘
,
TS_PACKET_SIZE
);

125 
	`as£¹
(
rv
 =ğ
TS_PACKET_SIZE
);

126 
·cknum_i
++;

129 
rv
 = 
	`wr™e
(
out_fe
,
buf
,rv);

131 
	`as£¹
(
rv
=
TS_PACKET_SIZE
);

133 
·ck‘s_»ad
++;

136 
	`åršt_msg
("\nR—d‡Ù® oà%d…ack‘ (%d by‹s)\n",
·ck‘s_»ad
,
by‹s_»ad
);

138 
	}
}

140 
off_t
 
	$g‘_fe_size
(
fe
)

142 
¡©
 
¡©_»t
;

143 
	`f¡©
(
fe
, &
¡©_»t
);

145  
¡©_»t
.
¡_size
;

146 
	}
}

149 
	$num_ch¬_š_¡ršg
(*
¡ršg
,
c
)

151 
i
;

152 
a
=0;

154 
i
=0; i<
	`¡¾’
(
¡ršg
);i++)

156 ià(
c
 =ğ*(
¡ršg
+
i
))

157 
a
++;

159  
a
;

160 
	}
}

162 
	$´št_u§ge
()

164 
	`´št_msg
(

168 
	`REPORT_VERSION
("ts_packet_insert");

169 
	`´št_msg
(

194 
	}
}

197 
	$sÜt_pos™iÚs
(*
š_¬¿y
,
size
)

199 
sÜ‹d
=0;

201 !
sÜ‹d
)

203 
i
;

205 
sÜ‹d
++;

207 
i
=0;i<
size
-1;i++)

209 ià(
š_¬¿y
[
i
]>in_array[i+1])

211 
tmp
;

213 
tmp
 = 
š_¬¿y
[
i
];

214 
š_¬¿y
[
i
] = in_array[i+1];

215 
š_¬¿y
[
i
+1] = 
tmp
;

218 
sÜ‹d
=0;

222 
	}
}

224 
	$maš
(
¬gc
, **
¬gv
)

226 *
ouut_fe_·th
 = "out.ts";

227 *
š_fe_·th
 = 
NULL
;

228 
š_fe_size
=0;

230 *
pos™iÚs
=
NULL
;

231 *
·ck‘_numb”s
=
NULL
;

232 
n_pos
 = 0;

234 
¬gno
 = 1;

235 
¬g_couÁ”
 = 0;

237 
ušt32_t
 
pid
=0x68;

239 *
out_¡ršg
="Inserted…acket";

241 ià(
¬gc
 < 2)

243 
	`´št_u§ge
();

247 
¬gno
 < 
¬gc
)

249 ià(
¬gv
[
¬gno
][0] == '-')

251 ià(!
	`¡rcmp
("-p",
¬gv
[
¬gno
]))

253 *
’d±r
;

254 *
pos™iÚ_¡ršg
;

255 
pos_šdex
;

257 ++
¬gno
;

259 
	`ä“
(
pos™iÚs
);

261 
n_pos
 = (
	`num_ch¬_š_¡ršg
(
¬gv
[
¬gno
],':')+1);

262 
pos™iÚs
 = 
	`m®loc
(
n_pos
 * ());

263 ià(!
pos™iÚs
)

265 
	`´št_”r
("malloc failed");

266 
	`ex™
(1);

269 
pos™iÚ_¡ršg
 = 
	`¡¹ok
(
¬gv
[
¬gno
],":");

270 
pos_šdex
=0;

271 
	`´št_msg
("Adding‚ew…ackets‡t:");

274 ià(!
pos™iÚ_¡ršg
)

277 
pos™iÚs
[
pos_šdex
] = 
	`¡¹od
(
pos™iÚ_¡ršg
,&
’d±r
);

279 ià(
’d±r
 =ğ
pos™iÚ_¡ršg
 || 
pos™iÚs
[
pos_šdex
]>1 ||…ositions[pos_index]<0)

281 
	`åršt_”r
("\nNÙ‡ v®id flßtšg…ošˆnumb” fÜ…os™iÚ (¬gum’ˆ%d)\n",
¬gno
);

282 
	`ex™
(1);

285 
	`åršt_msg
(" %d%%",()(
pos™iÚs
[
pos_šdex
]*100));

287 
pos™iÚ_¡ršg
 = 
	`¡¹ok
(
NULL
,":");

288 
pos_šdex
++;

290 
	`´št_msg
("\n");

291 
	`sÜt_pos™iÚs
(
pos™iÚs
,
n_pos
);

292 
	`as£¹
(
pos_šdex
 =ğ
n_pos
);

295 ià(!
	`¡rcmp
("-”r",
¬gv
[
¬gno
]))

297 
	`CHECKARG
("ts_·ck‘_š£¹",
¬gno
);

298 ià(!
	`¡rcmp
(
¬gv
[
¬gno
+1],"stderr"))

299 
	`»dœeù_ouut_¡d”r
();

300 ià(!
	`¡rcmp
(
¬gv
[
¬gno
+1],"stdout"))

301 
	`»dœeù_ouut_¡dout
();

304 
	`åršt_”r
("###s_packet_insert: "

306 " '¡d”r')\n",
¬gv
[
¬gno
+1]);

309 
¬gno
++;

311 ià(!
	`¡rcmp
("-pid",
¬gv
[
¬gno
]))

313 
”r
;

314 
	`CHECKARG
("ts_·ck‘_š£¹",
¬gno
);

315 
”r
 = 
	`unsigÃd_v®ue
("ts_·ck‘_š£¹",
¬gv
[
¬gno
],¬gv[¬gno+1],0,&
pid
);

316 ià(
”r
)  1;

317 
¬gno
++;

319 ià(!
	`¡rcmp
("-o",
¬gv
[
¬gno
]))

321 
	`CHECKARG
("ts_·ck‘_š£¹",
¬gno
);

322 
ouut_fe_·th
 = 
¬gv
[++
¬gno
];

324 ià(!
	`¡rcmp
("-s",
¬gv
[
¬gno
]))

326 
	`CHECKARG
("ts_·ck‘_š£¹",
¬gno
);

327 
out_¡ršg
 = 
¬gv
[++
¬gno
];

329 ià(!
	`¡rcmp
("-h",
¬gv
[
¬gno
]) || !strcmp("--help",argv[argno]))

331 
	`´št_u§ge
();

336 
	`åršt_msg
("\À*** UnknowÀİtiÚ %s, ignÜšg.\n\n",
¬gv
[
¬gno
]);

341 ià(
¬g_couÁ”
 == 0)

343 
š_fe_·th
 = 
¬gv
[
¬gno
];

344 
¬g_couÁ”
++;

348 
	`åršt_”r
Ğ"###s_·ck‘_š£¹: UÃx³ùed '%s'\n", 
¬gv
[
¬gno
]);

352 
¬gno
++;

355 ià(!
š_fe_·th
)

357 
	`´št_”r
("Error: No input file specified.\n");

358 
	`ex™
(1);

361 
	`åršt_msg
("R—dšg from fe: %s\n",
š_fe_·th
);

362 
	`åršt_msg
("Wr™šgØfe: %s\n",
ouut_fe_·th
);

363 
	`åršt_msg
("In£¹šg…ack‘ w™h PID %#x (%u)\n",
pid
,pid);

364 
	`åršt_msg
("Usšg ouuˆ¡ršg: %s\n",
out_¡ršg
);

367 
out_fe
;

368 
š_fe
 = 
	`İ’
(
š_fe_·th
,
O_RDONLY
);

370 ià(
š_fe
<0)

372 
	`åršt_”r
("Error: could‚ot open %s for„eading: %s\n",

373 
š_fe_·th
,
	`¡»¼Ü
(
”ºo
));

374 
	`ex™
(1);

377 
out_fe
 = 
	`İ’
(
ouut_fe_·th
,
O_WRONLY
 | 
O_TRUNC
 | 
O_CREAT
,0644);

378 ià(
out_fe
<0)

380 
	`åršt_”r
("Error: could‚ot open %s for„eading: %s\n",

381 
ouut_fe_·th
,
	`¡»¼Ü
(
”ºo
));

382 
	`ex™
(1);

385 
š_fe_size
 = 
	`g‘_fe_size
(
š_fe
);

387 ià(
š_fe_size
 % 
TS_PACKET_SIZE
)

389 
	`´št_”r
("Error: TS file†ength is‚ot‡ multiple of 188 bytes\n");

390 
	`ex™
(1);

394 
num_·ck
 = 
š_fe_size
 / 
TS_PACKET_SIZE
;

395 
i
;

396 
	`åršt_msg
("\nIÅuˆfi %ld by‹ lÚg w™h ",
š_fe_size
);

397 
	`åršt_msg
("%d TS…ack‘s\n",
num_·ck
);

399 
·ck‘_numb”s
 = 
	`m®loc
(
n_pos
 * ());

402 
i
=0;i<
n_pos
;i++)

404 
·ck‘_numb”s
[
i
] = ()(()
num_·ck
 * 
pos™iÚs
[i]);

410 
ušt8_t
 *
out_·ck‘
 = 
	`ü—‹_out_·ck‘
(
out_¡ršg
,

411 
	`¡¾’
(
out_¡ršg
)+1,

412 
pid
);

414 
	`š£¹_·ck‘s
(
š_fe
,
out_fe
,
out_·ck‘
,
·ck‘_numb”s
,
n_pos
);

419 
	}
}

	@tsdvbsub.c

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<”ºo.h
>

36 
	~<¡ršg.h
>

37 
	~<fú.h
>

38 #ifdeà
_WIN32


39 
	~<¡ddef.h
>

41 
	~<uni¡d.h
>

44 
	~"com·t.h
"

45 
	~"ts_âs.h
"

46 
	~"misc_âs.h
"

47 
	~"´štšg_âs.h
"

48 
	~"pidšt_âs.h
"

49 
	~"es_âs.h
"

50 
	~"³s_âs.h
"

51 
	~"v”siÚ.h
"

52 
	~"fmtx.h
"

55 
	epid_exŒaù


57 
	mEXTRACT_UNDEFINED
,

58 
	mEXTRACT_TS
,

59 
	mEXTRACT_PID
,

61 
pid_exŒaù
 
	tEXTRACT
;

63 
	sdvbd©a_s


65 
	mfound
;

66 
	m±s_v®id
;

67 
	mdts_v®id
;

68 
	md©a_Ën
;

69 
ušt64_t
 
	m±s
;

70 
ušt64_t
 
	mÏ¡_±s
;

71 
ušt64_t
 
	mdts
;

72 
ušt8_t
 
	md©a
[0x10000];

73 } 
	tdvbd©a_t
;

75 
dvbd©a_t
 
	gdvbd
 = {0};

77 
	gtfmt
 = 
FMTX_TS_DISPLAY_90kHz_RAW
;

79 
	#PROGNAME
 "tsdvbsub"

	)

81 
šlše
 
	$mem16be
(cÚ¡ 
ušt8_t
 * 
p
)

83  (
p
[0] << 8) |…[1];

84 
	}
}

86 cÚ¡ 
ušt8_t
 * 
	$·ge_compos™iÚ_£gm’t
(
dvbd©a_t
 * cÚ¡ 
dvbd
, cÚ¡ 
ušt8_t
 * 
p
, 
£gm’t_Ëngth
)

88 cÚ¡ 
ušt8_t
 * cÚ¡ 
eos
 = 
p
 + 
£gm’t_Ëngth
;

89 cÚ¡ * 
¡©e_‹xt
[] = {

92 
·ge_¡©e
;

93 
	`åršt_msg
("\npage_composition_segment\n");

94 
	`åršt_msg
("·ge_time_out: %d\n", *
p
++);

95 
	`åršt_msg
("·ge_v”siÚ_numb”: %d\n", 
p
[0] >> 4);

96 
·ge_¡©e
 = (
p
[0] >> 2) & 3;

97 
	`åršt_msg
("·ge_¡©e: %d (%s)\n", 
·ge_¡©e
, 
¡©e_‹xt
[page_state]);

98 
	`åršt_msg
("»£rved: %#x\n", 
p
[0] & 3);

99 ++
p
;

100 
p
 < 
eos
)

102 
	`åršt_msg
("»giÚ_id: %d\n", *
p
++);

103 
	`åršt_msg
("»£rved: %#x\n", *
p
++);

104 
	`åršt_msg
("»giÚ_hÜizÚl_add»ss: %d\n", 
	`mem16be
(
p
));

105 
p
 += 2;

106 
	`åršt_msg
("»giÚ_v”tiÿl_add»ss: %d\n", 
	`mem16be
(
p
));

107 
p
 += 2;

109  
p
;

110 
	}
}

112 cÚ¡ 
ušt8_t
 * 
	$»giÚ_compos™iÚ_£gm’t
(
dvbd©a_t
 * cÚ¡ 
dvbd
, cÚ¡ 
ušt8_t
 * 
p
, 
£gm’t_Ëngth
)

114 cÚ¡ 
ušt8_t
 * cÚ¡ 
eos
 = 
p
 + 
£gm’t_Ëngth
;

115 
»giÚ_fl_æag
;

117 
	`åršt_msg
("\nregion_composition_segment\n");

118 
	`åršt_msg
("»giÚ_id: %d\n", *
p
++);

119 
	`åršt_msg
("»giÚ_v”siÚ_numb”: %d\n", 
p
[0] >> 4);

120 
»giÚ_fl_æag
 = (
p
[0] >> 3) & 1;

121 
	`åršt_msg
("»giÚ_fl_æag: %d\n", 
»giÚ_fl_æag
);

122 
	`åršt_msg
("»£rved: %#x\n", 
p
[0] & 7);

123 ++
p
;

124 
	`åršt_msg
("»giÚ_width: %d\n", 
	`mem16be
(
p
));

125 
p
 += 2;

126 
	`åršt_msg
("»giÚ_height: %d\n", 
	`mem16be
(
p
));

127 
p
 += 2;

128 
	`åršt_msg
("»giÚ_Ëv–_of_com¶ex™y: %d\n", 
p
[0] >> 5);

129 
	`åršt_msg
("»giÚ_d•th: %d\n", (
p
[0] >> 2) & 7);

130 
	`åršt_msg
("»£rved: %#x\n", 
p
[0] & 3);

131 ++
p
;

132 
	`åršt_msg
("CLUT_id: %d\n", *
p
++);

133 
	`åršt_msg
("»giÚ_8-b™_pix–_code: %d\n", *
p
++);

134 
	`åršt_msg
("»giÚ_4-b™_pix–_code: %d\n", 
p
[0] >> 4);

135 
	`åršt_msg
("»giÚ_2-b™_pix–_code: %d\n", (
p
[0] >> 2) & 3);

136 
	`åršt_msg
("»£rved: %#x\n", 
p
[0] & 3);

137 ++
p
;

139 
p
 < 
eos
)

141 
objeù_ty³
;

142 
	`åršt_msg
("objeù_id: %d\n", 
	`mem16be
(
p
));

143 
p
 += 2;

144 
	`åršt_msg
("objeù_ty³: %d\n", 
objeù_ty³
 = (
p
[0] >> 6));

145 
	`åršt_msg
("objeù_´ovid”_æag: %d\n", (
p
[0] >> 4) & 3);

146 
	`åršt_msg
("objeù_hÜizÚl_pos™iÚ: %d\n", 
	`mem16be
(
p
) & 0xfff);

147 
p
 += 2;

148 
	`åršt_msg
("»£rved: %#x\n", 
p
[0] >> 4);

149 
	`åršt_msg
("objeù_v”tiÿl_pos™iÚ: %d\n", 
	`mem16be
(
p
) & 0xfff);

150 
p
 += 2;

151 ià(
objeù_ty³
 == 1 || object_type == 2)

153 
	`åršt_msg
("fÜeground_pix–_code: %d\n", *
p
++);

154 
	`åršt_msg
("background_pix–_code: %d\n", *
p
++);

157  
p
;

158 
	}
}

160 cÚ¡ 
ušt8_t
 * 
	$CLUT_defš™iÚ_£gm’t
(
dvbd©a_t
 * cÚ¡ 
dvbd
, cÚ¡ 
ušt8_t
 * 
p
, 
£gm’t_Ëngth
)

162 cÚ¡ 
ušt8_t
 * cÚ¡ 
eos
 = 
p
 + 
£gm’t_Ëngth
;

164 
	`åršt_msg
("\nCLUT definition_segment\n");

165 
	`åršt_msg
("CLUT_id: %d\n", *
p
++);

166 
	`åršt_msg
("CLUT_v”siÚ_numb”: %d\n", 
p
[0] >> 4);

167 
	`åršt_msg
("»£rved: %#x\n", 
p
[0] & 0xf);

168 ++
p
;

170 
p
 < 
eos
)

172 
fuÎ_¿nge_æag
;

173 
	`åršt_msg
("CLUT_’Œy_id: %d\n", *
p
++);

175 
	`åršt_msg
("2-b™/’Œy_CLUT_æag: %d\n", 
p
[0] >> 7);

176 
	`åršt_msg
("4-b™/’Œy_CLUT_æag: %d\n", (
p
[0] >> 6) & 1);

177 
	`åršt_msg
("8-b™/’Œy_CLUT_æag: %d\n", (
p
[0] >> 5) & 1);

178 
	`åršt_msg
("»£rved: %#x\n", (
p
[0] >> 1) & 0xf);

179 
	`åršt_msg
("fuÎ_¿nge_æag: %#x\n", 
fuÎ_¿nge_æag
 = (
p
[0] & 1));

180 ++
p
;

182 ià(
fuÎ_¿nge_æag
 == 1)

184 
	`åršt_msg
("Y-v®ue: %d\n", *
p
++);

185 
	`åršt_msg
("Cr-v®ue: %d\n", *
p
++);

186 
	`åršt_msg
("Cb-v®ue: %d\n", *
p
++);

187 
	`åršt_msg
("T-v®ue: %d\n", *
p
++);

191 
	`åršt_msg
("Y-v®ue: %d\n", 
p
[0] >> 2);

192 
	`åršt_msg
("Cr-v®ue: %d\n", ((
p
[0] & 3) << 2) | ((p[1] >> 6) & 3));

193 
	`åršt_msg
("Cb-v®ue: %d\n", (
p
[1] >> 2) & 0xf);

194 
	`åršt_msg
("T-v®ue: %d\n", 
p
[1] & 3);

195 
p
 += 2;

198  
p
;

199 
	}
}

201 cÚ¡ 
ušt8_t
 * 
	$objeù_d©a_£gm’t
(
dvbd©a_t
 * cÚ¡ 
dvbd
, cÚ¡ 
ušt8_t
 * 
p
, 
£gm’t_Ëngth
)

203 cÚ¡ 
ušt8_t
 * cÚ¡ 
sos
 = 
p
;

204 cÚ¡ 
ušt8_t
 * cÚ¡ 
eos
 = 
p
 + 
£gm’t_Ëngth
;

205 
objeù_codšg_m‘hod
;

207 
	`åršt_msg
("\nobject_data_segment\n");

208 
	`åršt_msg
("objeù_id: %d\n", 
	`mem16be
(
p
));

209 
p
 += 2;

210 
	`åršt_msg
("objeù_v”siÚ_numb”: %d\n", 
p
[0] >> 4);

211 
	`åršt_msg
("objeù_codšg_m‘hod: %d\n", 
objeù_codšg_m‘hod
 = ((
p
[0] >> 2) & 3));

212 
	`åršt_msg
("nÚ_modifyšg_cŞour_æag: %d\n", (
p
[0] >> 1) & 1);

213 
	`åršt_msg
("»£rved: %#x\n", 
p
[0] & 0x1);

214 ++
p
;

216 
objeù_codšg_m‘hod
)

220 
tİ_f›ld_d©a_block_Ëngth
;

221 
bÙtom_f›ld_d©a_block_Ëngth
;

222 
	`åršt_msg
("tİ_f›ld_d©a_block_Ëngth: %d\n", 
tİ_f›ld_d©a_block_Ëngth
 = 
	`mem16be
(
p
));

223 
p
 += 2;

224 
	`åršt_msg
("bÙtom_f›ld_d©a_block_Ëngth: %d\n", 
bÙtom_f›ld_d©a_block_Ëngth
 = 
	`mem16be
(
p
));

225 
p
 += 2;

226 
	`´št_d©a
(
TRUE
, "tİ…ix–-d©a:", 
p
, 
tİ_f›ld_d©a_block_Ëngth
, 0x10000);

227 
p
 +ğ
tİ_f›ld_d©a_block_Ëngth
;

228 
	`´št_d©a
(
TRUE
, "bÙtom…ix–-d©a:", 
p
, 
bÙtom_f›ld_d©a_block_Ëngth
, 0x10000);

229 
p
 +ğ
bÙtom_f›ld_d©a_block_Ëngth
;

230 ià(((
p
 - 
sos
) & 1) != 0)

232 
	`åršt_msg
("8_¡uff_b™s: %d\n", *
p
++);

239 
numb”_of_codes
;

240 
i
;

241 
	`åršt_msg
("numb”_of_codes: %d\n", 
numb”_of_codes
 = *
p
++);

242 
p
 += 2;

243 
i
 = 0; i !ğ
numb”_of_codes
; ++i)

245 
	`åršt_msg
("ch¬aù”_code: %d\n", 
	`mem16be
(
p
));

246 
p
 += 2;

252 
	`´št_d©a
(
TRUE
, "»£rved:", 
p
, 
eos
 -…, 0x10000);

256  
p
;

257 
	}
}

260 cÚ¡ 
ušt8_t
 * 
	$subt™lšg_£gm’t
(
dvbd©a_t
 * cÚ¡ 
dvbd
, cÚ¡ 
ušt8_t
 * 
p
)

262 
£gm’t_ty³
;

263 
£gm’t_Ëngth
;

264 cÚ¡ 
ušt8_t
 * 
p2
;

266 
	`åršt_msg
("\nsubtitling_segment\n");

267 
	`åršt_msg
("sync_by‹: %#x\n", *
p
++);

268 
	`åršt_msg
("£gm’t_ty³: %#x\n", 
£gm’t_ty³
 = *
p
++);

269 
	`åršt_msg
("·ge_id: %d\n", (
p
[0] << 8) |…[1]);

270 
p
 += 2;

271 
	`åršt_msg
("£gm’t_Ëngth: %d\n", 
£gm’t_Ëngth
 = ((
p
[0] << 8) |…[1]));

272 
p
 += 2;

273 
£gm’t_ty³
)

276 
p2
 = 
	`·ge_compos™iÚ_£gm’t
(
dvbd
, 
p
, 
£gm’t_Ëngth
);

280 
p2
 = 
	`»giÚ_compos™iÚ_£gm’t
(
dvbd
, 
p
, 
£gm’t_Ëngth
);

284 
p2
 = 
	`CLUT_defš™iÚ_£gm’t
(
dvbd
, 
p
, 
£gm’t_Ëngth
);

288 
p2
 = 
	`objeù_d©a_£gm’t
(
dvbd
, 
p
, 
£gm’t_Ëngth
);

292 
	`´št_d©a
(
TRUE
, "d©a", 
p
, 
£gm’t_Ëngth
, segment_length);

293 
p2
 = 
p
 + 
£gm’t_Ëngth
;

298 
p
 +ğ
£gm’t_Ëngth
;

300 ià(
p
 !ğ
p2
)

302 
	`åršt_msg
("###…arse†ength mismatch\n");

305  
p
;

306 
	}
}

308 
	$æush_dvbd
(
dvbd©a_t
 * cÚ¡ 
dvbd
)

310 cÚ¡ 
ušt8_t
 * 
p
 = 
dvbd
->
d©a
;

312 ià(!
dvbd
->
found
)

315 
	`åršt_msg
("\nPTS: %s, DTS: %s, PTS -†ast_PTS: %s\n",

316 !
dvbd
->
±s_v®id
 ? "nÚe" : 
	`fmtx_time¡amp
(dvbd->
±s
, 
tfmt
),

317 !
dvbd
->
dts_v®id
 ? "nÚe" : 
	`fmtx_time¡amp
(dvbd->
dts
, 
tfmt
),

318 !
dvbd
->
±s_v®id
 ? "????" : 
	`fmtx_time¡amp
(dvbd->
±s
 - dvbd->
Ï¡_±s
, 
tfmt
));

319 ià(
dvbd
->
±s_v®id
)

320 
dvbd
->
Ï¡_±s
 = dvbd->
±s
;

322 
	`åršt_msg
("d©¨Ëngth: %d\n\n", 
dvbd
->
d©a_Ën
);

324 
	`åršt_msg
("d©a_id’tif›r: %#x\n", *
p
++);

325 
	`åršt_msg
("subt™Ë_¡»am_id: %d\n", *
p
++);

327 *
p
 == 0xf)

329 
p
 = 
	`subt™lšg_£gm’t
(
dvbd
,…);

332 
	`åršt_msg
("’d_of_PES_d©a_f›ld_m¬k”: %#x\n", *
p
++);

334 ià(
dvbd
->
d©a_Ën
 > ()(
p
 - dvbd->
d©a
))

336 
	`´št_d©a
(
TRUE
, "exûs by‹s", 
p
, 
dvbd
->
d©a_Ën
 - (°- dvbd->
d©a
), 0x10000);

338 ià(
dvbd
->
d©a_Ën
 < ()(
p
 - dvbd->
d©a
))

340 
	`åršt_msg
("### overrun\n");

343 
dvbd
->
d©a_Ën
 = 0;

344 
dvbd
->
±s_v®id
 = 
FALSE
;

345 
dvbd
->
dts_v®id
 = 
FALSE
;

346 
dvbd
->
found
 = 
FALSE
;

347 
	`mem£t
(
dvbd
->
d©a
, 0, (dvbd->data));

348 
	}
}

350 
	$add_d©a_dvbd
(
dvbd©a_t
 * cÚ¡ 
dvbd
, cÚ¡ 
ušt8_t
 * cÚ¡ 
d©a
, 
Ën
)

352 
g­
 = (
dvbd
->
d©a
è- dvbd->
d©a_Ën
;

354 ià(
Ën
 == 0)

357 ià(
g­
 < 
Ën
)

359 
	`åršt_”r
("### Data buffer overflow\n");

360 
Ën
 = 
g­
;

362 
	`memıy
(
dvbd
->
d©a
 + dvbd->
d©a_Ën
, d©a, 
Ën
);

363 
dvbd
->
d©a_Ën
 +ğ
Ën
;

364 
	}
}

372 
	$exŒaù_pid_·ck‘s
(
TS_»ad”_p
 
t¤—d”
,

373 
ušt32_t
 
pid_wª‹d
,

374 
max
,

375 
v”bo£
,

376 
qu›t
)

378 
”r
;

379 
couÁ
 = 0;

380 
exŒaùed
 = 0;

381 
³s_·ck‘_Ën
 = 0;

382 
gÙ_³s_·ck‘_Ën
 = 
FALSE
;

385 
Ãed_·ck‘_¡¬t
 = 
TRUE
;

389 
ušt32_t
 
pid
;

390 
·ylßd_un™_¡¬t_šdiÿtÜ
;

391 
by‹
 *
ad­t
, *
·ylßd
;

392 
ad­t_Ën
, 
·ylßd_Ën
;

394 ià(
max
 > 0 && 
couÁ
 >= max)

396 ià(!
qu›t
è
	`åršt_msg
("Stİpšg‡á” %d…ack‘s\n",
max
);

400 
”r
 = 
	`g‘_Ãxt_TS_·ck‘
(
t¤—d”
,&
pid
,

401 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

402 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

403 ià(
”r
 =ğ
EOF
)

405 ià(
”r
)

407 
	`´št_”r
("### Error„eading TS…acket\n");

411 
couÁ
++;

414 ià(
·ylßd_Ën
 == 0)

417 ià(
pid
 =ğ
pid_wª‹d
)

419 
by‹
 *
d©a
;

420 
d©a_Ën
;

421 
³s_ov”æow
 = 0;

423 ià(
v”bo£
)

425 
	`åršt_msg
("%4d: TS Pack‘ PID %04x",
couÁ
,
pid
);

426 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
)

427 
	`´št_msg
(" (start)");

428 ià(
Ãed_·ck‘_¡¬t
)

429 
	`´št_msg
(" <ignored>");

430 
	`´št_msg
("\n");

434 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
)

437 
off£t
;

439 ià(
Ãed_·ck‘_¡¬t
)

440 
Ãed_·ck‘_¡¬t
 = 
FALSE
;

442 
³s_·ck‘_Ën
 = (
·ylßd
[4] << 8) |…ayload[5];

443 ià(
v”bo£
è
	`åršt_msg
("PES…ack‘†’gth %d\n",
³s_·ck‘_Ën
);

444 
gÙ_³s_·ck‘_Ën
 = (
³s_·ck‘_Ën
 > 0);

446 
	`æush_dvbd
(&
dvbd
);

448 
”r
 = 
	`fšd_PTS_DTS_š_PES
(
·ylßd
,
·ylßd_Ën
,

449 &
dvbd
.
±s_v®id
, &dvbd.
±s
, &dvbd.
dts_v®id
, &dvbd.
dts
);

450 
dvbd
.
found
 = 
TRUE
;

452 ià(
	`IS_H222_PES
(
·ylßd
))

456 
off£t
 = 
·ylßd
[8] + 9;

461 
off£t
 = 
	`ÿlc_m³g1_³s_off£t
(
·ylßd
,
·ylßd_Ën
);

463 
d©a
 = &
·ylßd
[
off£t
];

464 
d©a_Ën
 = 
·ylßd_Ën
-
off£t
;

465 ià(
v”bo£
è
	`´št_d©a
(
TRUE
,"d©a",
d©a
,
d©a_Ën
,1000);

471 ià(
Ãed_·ck‘_¡¬t
)

476 
d©a
 = 
·ylßd
;

477 
d©a_Ën
 = 
·ylßd_Ën
;

478 ià(
v”bo£
è
	`´št_d©a
(
TRUE
,"D©a",
·ylßd
,
·ylßd_Ën
,1000);

481 ià(
gÙ_³s_·ck‘_Ën
)

484 ià(
d©a_Ën
 > 
³s_·ck‘_Ën
)

486 
³s_ov”æow
 = 
d©a_Ën
 - 
³s_·ck‘_Ën
;

487 
d©a_Ën
 = 
³s_·ck‘_Ën
;

488 
³s_·ck‘_Ën
 = 0;

491 
³s_·ck‘_Ën
 -ğ
d©a_Ën
;

494 
	`add_d©a_dvbd
(&
dvbd
, 
d©a
, 
d©a_Ën
);

495 ià(
gÙ_³s_·ck‘_Ën
 && 
³s_·ck‘_Ën
 == 0)

497 
	`æush_dvbd
(&
dvbd
);

500 ià(
³s_ov”æow
)

502 
	`´št_d©a
(
TRUE
, "D©¨aá” PES", 
d©a
 + 
d©a_Ën
, 
³s_ov”æow
, 1000);

505 
exŒaùed
 ++;

509 ià(!
qu›t
)

510 
	`åršt_msg
("Extracted %d of %d TS…acket%s\n",

511 
exŒaùed
,
couÁ
,(count==1?"":"s"));

516 ià(
qu›t
 && 
exŒaùed
 == 0)

517 
	`åršt_”r
("### No dataƒxtracted for PID %#04x (%d)\n",

518 
pid_wª‹d
,pid_wanted);

520 
	}
}

527 
	$exŒaù_av
(
šput
,

528 cÚ¡ 
´og_no
,

529 
max
,

530 
v”bo£
,

531 
qu›t
)

533 
”r
, 
ii
;

534 
max_to_»ad
 = 
max
;

535 
tÙ®_num_»ad
 = 0;

536 
ušt32_t
 
pid
 = 0;

537 
TS_»ad”_p
 
t¤—d”
 = 
NULL
;

538 
pmt_p
 
pmt
 = 
NULL
;

541 
”r
 = 
	`bud_TS_»ad”
(
šput
,&
t¤—d”
);

542 ià(
”r
)  1;

547 
num_»ad
;

550 ià(
max
 > 0 && 
max_to_»ad
 <= 0)

553 
”r
 = 
	`fšd_pmt
(
t¤—d”
,
´og_no
,
max_to_»ad
,
v”bo£
,
qu›t
,&
num_»ad
,&
pmt
);

554 ià(
”r
 =ğ
EOF
)

556 ià(!
qu›t
)

557 
	`´št_msg
("No…rogram stream information inhe input file\n");

558 
	`ä“_TS_»ad”
(&
t¤—d”
);

559 
	`ä“_pmt
(&
pmt
);

562 ià(
”r
)

564 
	`´št_”r
("### Error finding…rogram stream information\n");

565 
	`ä“_TS_»ad”
(&
t¤—d”
);

566 
	`ä“_pmt
(&
pmt
);

569 
max_to_»ad
 -ğ
num_»ad
;

570 
tÙ®_num_»ad
 +ğ
num_»ad
;

575 
ii
=0; i˜< 
pmt
->
num_¡»ams
; ii++)

577 ià(
pmt
->
¡»ams
[
ii
].
¡»am_ty³
 == 6 &&

578 
pmt
->
¡»ams
[
ii
].
ES_šfo_Ëngth
 > 0 &&

579 
pmt
->
¡»ams
[
ii
].
ES_šfo
[0] == 0x59)

581 
pid
 = 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
;

585 
	`ä“_pmt
(&
pmt
);

589 ià(
pid
 != 0)

593 ià(
pid
 == 0)

595 
	`åršt_”r
("### No DVB subtitle stream specified in first %d TS…ackets in input file\n",

596 
max
);

597 
	`ä“_TS_»ad”
(&
t¤—d”
);

601 ià(!
qu›t
)

602 
	`åršt_msg
("ExŒaùšg DVB Subt™Ë PID %04x (%d)\n", 
pid
,pid);

605 
max
 -ğ
tÙ®_num_»ad
;

608 
”r
 = 
	`exŒaù_pid_·ck‘s
(
t¤—d”
,
pid
,
max
,
v”bo£
,
qu›t
);

609 
	`ä“_TS_»ad”
(&
t¤—d”
);

610  
”r
;

611 
	}
}

618 
	$exŒaù_pid
(
šput
,

619 
ušt32_t
 
pid_wª‹d
,

620 
max
,

621 
v”bo£
,

622 
qu›t
)

624 
”r
;

625 
TS_»ad”_p
 
t¤—d”
 = 
NULL
;

628 
”r
 = 
	`bud_TS_»ad”
(
šput
,&
t¤—d”
);

629 ià(
”r
)  1;

631 
”r
 = 
	`exŒaù_pid_·ck‘s
(
t¤—d”
,
pid_wª‹d
,
max
,
v”bo£
,
qu›t
);

633 
	`ä“_TS_»ad”
(&
t¤—d”
);

634  
”r
;

635 
	}
}

637 
	$´št_u§ge
()

639 
	`´št_msg
(

640 "U§ge: " 
PROGNAME
 " [switches] <infile>\n"

643 
	`REPORT_VERSION
(
PROGNAME
);

644 
	`´št_msg
(

667 
	}
}

669 
	$maš
(
¬gc
, **
¬gv
)

671 
u£_¡dš
 = 
FALSE
;

672 *
šput_Çme
 = 
NULL
;

673 
had_šput_Çme
 = 
FALSE
;

674 
EXTRACT
 
exŒaù
 = 
EXTRACT_TS
;

676 
šput
 = -1;

677 
maxts
 = 0;

678 
ušt32_t
 
pid
 = 0;

679 
qu›t
 = 
FALSE
;

680 
v”bo£
 = 
FALSE
;

681 
´og_no
 = 1;

683 
”r
 = 0;

684 
ii
 = 1;

686 ià(
¬gc
 < 2)

688 
	`´št_u§ge
();

692 
ii
 < 
¬gc
)

694 ià(
¬gv
[
ii
][0] == '-')

696 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

697 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

699 
	`´št_u§ge
();

702 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

704 
v”bo£
 = 
TRUE
;

705 
qu›t
 = 
FALSE
;

707 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

709 
v”bo£
 = 
FALSE
;

710 
qu›t
 = 
TRUE
;

712 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

714 
	`CHECKARG
(
PROGNAME
, 
ii
);

715 
”r
 = 
	`št_v®ue
(
PROGNAME
, 
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
maxts
);

716 ià(
”r
)  1;

717 
ii
++;

719 ià(!
	`¡rcmp
("-pid",
¬gv
[
ii
]))

721 
	`CHECKARG
(
PROGNAME
,
ii
);

722 
”r
 = 
	`unsigÃd_v®ue
(
PROGNAME
,
¬gv
[
ii
],¬gv[ii+1],0,&
pid
);

723 ià(
”r
)  1;

724 
ii
++;

725 
exŒaù
 = 
EXTRACT_PID
;

727 ià(!
	`¡rcmp
("-´og",
¬gv
[
ii
]))

729 
	`CHECKARG
(
PROGNAME
,
ii
);

730 
”r
 = 
	`št_v®ue
(
PROGNAME
, 
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
´og_no
);

731 ià(
”r
)  1;

732 
ii
++;

734 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

736 
u£_¡dš
 = 
TRUE
;

737 
had_šput_Çme
 = 
TRUE
;

739 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

741 
	`CHECKARG
(
PROGNAME
,
ii
);

742 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

743 
	`»dœeù_ouut_¡d”r
();

744 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

745 
	`»dœeù_ouut_¡dout
();

748 
	`åršt_”r
("### " 
PROGNAME
 ": "

750 " '¡d”r')\n",
¬gv
[
ii
+1]);

753 
ii
++;

755 ià(!
	`¡rcmp
("-tfmt",
¬gv
[
ii
]))

757 
	`CHECKARG
(
PROGNAME
,
ii
);

758 ià((
tfmt
 = 
	`fmtx_¡r_to_time¡amp_æags
(
¬gv
[
ii
 + 1])) < 0)

760 
	`åršt_msg
("###¤•Üt: Badime¡am°fÜm© '%s'\n",
¬gv
[
ii
+1]);

763 
ii
++;

767 
	`åršt_”r
("### " 
PROGNAME
 ": "

768 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

774 ià(
had_šput_Çme
)

776 
	`åršt_”r
("### " 
PROGNAME
 ": UÃx³ùed '%s'\n",
¬gv
[
ii
]);

781 
šput_Çme
 = 
¬gv
[
ii
];

782 
had_šput_Çme
 = 
TRUE
;

785 
ii
++;

788 ià(!
had_šput_Çme
)

790 
	`´št_”r
("### " 
PROGNAME
 ": No input file specified\n");

796 ià(
u£_¡dš
)

797 
šput
 = 
STDIN_FILENO
;

800 
šput
 = 
	`İ’_bš¬y_fe
(
šput_Çme
,
FALSE
);

801 ià(
šput
 == -1)

803 
	`åršt_”r
("### " 
PROGNAME
 ": UÇbËØİ’ iÅuˆf%s\n",
šput_Çme
);

807 ià(!
qu›t
)

808 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

810 ià(!
qu›t
)

812 ià(
exŒaù
 =ğ
EXTRACT_PID
)

813 
	`åršt_msg
("ExŒaùšg…ack‘ fÜ PID %04x (%d)\n",
pid
,pid);

816 ià(
maxts
 !ğ0 && !
qu›t
)

817 
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
maxts
);

819 ià(
exŒaù
 =ğ
EXTRACT_PID
)

820 
”r
 = 
	`exŒaù_pid
(
šput
,
pid
,
maxts
,
v”bo£
,
qu›t
);

822 
”r
 = 
	`exŒaù_av
(
šput
,
´og_no
,
maxts
,
v”bo£
,
qu›t
);

823 ià(
”r
)

825 
	`´št_”r
("### " 
PROGNAME
 ": Errorƒxtracting data\n");

826 ià(!
u£_¡dš
è(è
	`şo£_fe
(
šput
);

830 ià(!
u£_¡dš
)

832 
”r
 = 
	`şo£_fe
(
šput
);

833 ià(
”r
)

834 
	`åršt_”r
("### " 
PROGNAME
 ": E¼Ü closšg iÅuˆf%s\n",
šput_Çme
);

837 
	}
}

	@tsfilter.c

29 #ifdeà
_WIN32


30 
	~<¡ddef.h
>

32 
	~<uni¡d.h
>

35 
	~<¡dio.h
>

36 
	~<¡dlib.h
>

37 
	~<¡ršg.h
>

38 
	~"com·t.h
"

39 
	~"ts_âs.h
"

40 
	~"misc_âs.h
"

41 
	~"´štšg_âs.h
"

42 
	~"pidšt_âs.h
"

43 
	~"v”siÚ.h
"

44 
	~"tswr™e_deâs.h
"

45 
	~"tswr™e_âs.h
"

48 *
	gpidLi¡
 = 
NULL
;

49 
	gpidLi¡AÎoc
 = 0, 
	gpidLi¡U£d
 = 0;

51 
´št_u§ge
();

53 
	$’su»PidLi¡
(
Ä
)

55 ià(
pidLi¡AÎoc
 > 
Ä
) { ; }

56 
pidLi¡AÎoc
 = 
Ä
;

57 
pidLi¡
 = 
	`»®loc
ÕidLi¡, 
pidLi¡AÎoc
 * ());

58 
	}
}

62 
	$maš
(
¬gn
, *
¬gs
[])

64 
ii
 = 1;

65 
v”bo£
 = 
FALSE
;

66 
šv”t
 = 0;

67 
max_pkts
 = ()-1;

68 cÚ¡ *
šput_fe
 = 
NULL
, *
ouut_fe
 = NULL;

71 ià(
¬gn
 < 2)

73 
	`´št_u§ge
();

77 
	`’su»PidLi¡
(1024);

79 
ii
 < 
¬gn
)

81 ià(
¬gs
[
ii
][0] == '-')

83 ià(!
	`¡rcmp
("--h–p", 
¬gs
[
ii
]) || !strcmp("-h",‡rgs[ii]) ||

84 !
	`¡rcmp
("-h–p", 
¬gs
[
ii
]))

86 
	`´št_u§ge
();

89 ià(!
	`¡rcmp
("-v”bo£", 
¬gs
[
ii
]) || !strcmp("-v",‡rgs[ii]))

91 
v”bo£
 = 
TRUE
;

93 ià(!
	`¡rcmp
("-m", 
¬gs
[
ii
]) || !strcmp("-max",‡rgs[ii]))

95 ià(
¬gn
 <ğ
ii
)

97 
	`åršt_”r
("###sfilter: -max„equires‡n‡rgument\n");

100 
max_pkts
 = 
	`©oi
(
¬gs
[
ii
+1]);

101 ++
ii
;

103 ià(!
	`¡rcmp
("-!", 
¬gs
[
ii
]) || !strcmp("-invert",‡rgs[ii]))

105 
šv”t
 = 1;

107 ià(!
	`¡rcmp
("-i", 
¬gs
[
ii
]) || !strcmp("-input",‡rgs[ii]))

109 ià(
¬gn
 <ğ
ii
)

111 
	`åršt_”r
("###sfilter: -input„equires‡n‡rgument\n");

114 
šput_fe
 = 
¬gs
[
ii
+1];

115 ++
ii
;

117 ià(!
	`¡rcmp
("-o", 
¬gs
[
ii
]) || !strcmp("-output",‡rgs[ii]))

119 ià(
¬gn
 <ğ
ii
)

121 
	`åršt_”r
("###sfilter: -output„equires‡n‡rgument\n");

124 
ouut_fe
 = 
¬gs
[
ii
+1];

125 ++
ii
;

129 
	`åršt_”r
("###sfilter: "

130 "UÄecogni£d commªd†šsw™ch '%s'\n", 
¬gs
[
ii
]);

136 *
p
 = 
NULL
;

138 ià(
pidLi¡U£d
 >ğ
pidLi¡AÎoc
)

140 
	`’su»PidLi¡
(
pidLi¡AÎoc
 + 1024);

143 
pidLi¡
[
pidLi¡U£d
] = 
	`¡¹oul
(
¬gs
[
ii
], &
p
, 0);

144 ià(!(
p
 && *p == '\0'))

146 
	`åršt_”r
("###sfilter: '%s' wasn't‡ valid‚umber. \n",

147 
¬gs
[
ii
]);

150 ++
pidLi¡U£d
;

152 ++
ii
;

155 ià(!
pidLi¡U£d
)

157 
	`åršt_”r
("###sfilter: No…idso filter. \n");

163 
”r
;

164 
TS_»ad”_p
 
t¤—d”
;

165 
TS_wr™”_p
 
tswr™”
;

166 
by‹
 *
pkt
 = 
NULL
;

168 
pid
, 
pkt_num
;

169 
pusi
, 
ad­t_Ën
, 
·ylßd_Ën
;

170 
by‹
 *
ad­t
, *
·ylßd
;

173 
pkt_num
 = 0;

174 
”r
 = 
	`İ’_fe_fÜ_TS_»ad
((*)
šput_fe
, &
t¤—d”
);

175 ià(
”r
)

177 
	`åršt_”r
("##sfilter: Unableo open stdin for„eading TS.\n");

180 ià(
ouut_fe
)

182 
”r
 = 
	`tswr™e_İ’
(
TS_W_FILE
, (*)
ouut_fe
, 
NULL
, 0, 1, &
tswr™”
);

186 
”r
 = 
	`tswr™e_İ’
(
TS_W_STDOUT
, 
NULL
, NULL, 0, 1, &
tswr™”
);

188 ià(
”r
)

190 
	`åršt_”r
("##sfilter: Unableo open stdout for writing TS. \n");

196 
”r
 = 
	`»ad_Ãxt_TS_·ck‘
(
t¤—d”
, &
pkt
);

197 ià(
”r
 =ğ
EOF
)

203 
”r
 = 
	`¥l™_TS_·ck‘
(
pkt
, &
pid
, &
pusi
, &
ad­t
, &
ad­t_Ën
, &
·ylßd
,

204 &
·ylßd_Ën
);

205 ià(
”r
)

207 
	`åršt_”r
("### Error splitting TS…acket - continuing. \n");

211 
i
;

212 
found
 = 0;

214 
i
 = 0 ;˜< 
pidLi¡U£d
; ++i)

216 ià(
pid
 =ğ
pidLi¡
[
i
])

218 ++
found
;

223 ià(
max_pkts
 != ()-1 &&

224 
pkt_num
 > 
max_pkts
)

228 ià(!
šv”t
è{ ; } { 
found
 = 0; }

232 ià(
šv”t
)

234 
found
 = !found;

237 ià(
found
)

240 
”r
 = 
	`tswr™e_wr™e
(
tswr™”
,

241 
pkt
,

242 
pid
,

245 ià(
”r
)

247 
	`åršt_”r
("### E¼Ü wr™šg ouuˆ- %d \n", 
”r
);

251 ++
pkt_num
;

256 
	`tswr™e_şo£
(
tswr™”
, 1);

257 
	`şo£_TS_»ad”
(&
t¤—d”
);

260 
	}
}

262 
	$´št_u§ge
()

264 
	`´št_msg
(

267 
	`REPORT_VERSION
("tsfilter");

268 
	`´št_msg
(

284 
	}
}

	@tsinfo.c

30 
	~<¡dio.h
>

31 
	~<¡dlib.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

34 
	~<fú.h
>

36 #ifdeà
_WIN32


37 
	~<¡ddef.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"ts_âs.h
"

44 
	~"misc_âs.h
"

45 
	~"´štšg_âs.h
"

46 
	~"pidšt_âs.h
"

47 
	~"v”siÚ.h
"

56 
	$»pÜt_¡»ams
(
TS_»ad”_p
 
t¤—d”
,

57 
max
,

58 
v”bo£
)

60 
”r
;

61 
ii
;

66 
pidšt_li¡_p
 
this_´og_li¡
 = 
NULL
;

67 
pidšt_li¡_p
 
Ï¡_´og_li¡
 = 
NULL
;

68 
pmt_p
 
this_pmt
 = 
NULL
;

69 
pmt_p
 
Ï¡_pmt
 = 
NULL
;

71 
ušt32_t
 
pmt_pid
 = 0;

73 
by‹
 *
·t_d©a
 = 
NULL
;

74 
·t_d©a_Ën
 = 0;

75 
·t_d©a_u£d
 = 0;

77 
by‹
 *
pmt_d©a
 = 
NULL
;

78 
pmt_d©a_Ën
 = 0;

79 
pmt_d©a_u£d
 = 0;

81 
num_·ts
 = 0;

82 
num_pmts
 = 0;

84 
	`åršt_msg
("SÿÂšg %d TS…ack‘s\n",
max
);

86 
ii
=0; ii<
max
; ii++)

88 
ušt32_t
 
pid
;

89 
·ylßd_un™_¡¬t_šdiÿtÜ
;

90 
by‹
 *
ad­t
, *
·ylßd
;

91 
ad­t_Ën
, 
·ylßd_Ën
;

93 
”r
 = 
	`g‘_Ãxt_TS_·ck‘
(
t¤—d”
,&
pid
,

94 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

95 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

96 ià(
”r
 =ğ
EOF
)

98 
	`´št_msg
("EOF\n");

101 ià(
”r
)

103 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘ %d\n",
ii
+1);

104 ià(
·t_d©a
è
	`ä“
(pat_data);

105 
	`ä“_pidšt_li¡
(&
Ï¡_´og_li¡
);

106 
	`ä“_pmt
(&
Ï¡_pmt
);

107 ià(
pmt_d©a
è
	`ä“
(pmt_data);

111 ià(
pid
 == 0x0000)

113 
num_·ts
++;

114 ià(
v”bo£
)

115 
	`åršt_msg
("Pack‘ %d i PAT\n",
ii
+1);

116 ià(
·ylßd_Ën
 == 0)

118 
	`åršt_msg
("Pack‘ %d i PAT, buˆha nØ·ylßd\n",
ii
+1);

122 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
·t_d©a
)

126 
	`´št_”r
("!!! Discarding…revious (uncompleted) PAT data\n");

127 
	`ä“
(
·t_d©a
);

128 
·t_d©a
 = 
NULL
; 
·t_d©a_Ën
 = 0; 
·t_d©a_u£d
 = 0;

130 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
·t_d©a
)

134 
	`´št_”r
("!!! Discarding PAT continuation,‚o PAT started\n");

138 
”r
 = 
	`bud_psi_d©a
(
v”bo£
,
·ylßd
,
·ylßd_Ën
,
pid
,

139 &
·t_d©a
,&
·t_d©a_Ën
,&
·t_d©a_u£d
);

140 ià(
”r
)

142 
	`åršt_”r
("### Error %s PAT\n",

143 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"));

144 ià(
·t_d©a
è
	`ä“
(pat_data);

145 
	`ä“_pidšt_li¡
(&
Ï¡_´og_li¡
);

146 
	`ä“_pmt
(&
Ï¡_pmt
);

147 ià(
pmt_d©a
è
	`ä“
(pmt_data);

152 ià(
·t_d©a_Ën
 > 
·t_d©a_u£d
)

155 
”r
 = 
	`exŒaù_´og_li¡_äom_·t
(
v”bo£
,
·t_d©a
,
·t_d©a_Ën
,

156 &
this_´og_li¡
);

157 ià(
”r
)

159 
	`ä“_pidšt_li¡
(&
Ï¡_´og_li¡
);

160 
	`ä“_pmt
(&
Ï¡_pmt
);

161 ià(
pmt_d©a
è
	`ä“
(pmt_data);

162 
	`ä“
(
·t_d©a
);

163  
”r
;

166 
	`ä“
(
·t_d©a
);

167 
·t_d©a
 = 
NULL
; 
·t_d©a_Ën
 = 0; 
·t_d©a_u£d
 = 0;

168 
num_·ts
++;

170 ià(
”r
)

172 
	`ä“_pidšt_li¡
(&
Ï¡_´og_li¡
);

173 
	`ä“_pmt
(&
Ï¡_pmt
);

174 ià(
pmt_d©a
è
	`ä“
(pmt_data);

175  
”r
;

178 ià(!
	`§me_pidšt_li¡
(
this_´og_li¡
,
Ï¡_´og_li¡
))

180 ià(
Ï¡_´og_li¡
 !ğ
NULL
)

181 
	`åršt_msg
("\nPack‘ %d i PAT - cÚ‹Á chªged\n",
ii
+1);

182 ià(!
v”bo£
)

183 
	`åršt_msg
("\nPack‘ %d i PAT\n",
ii
+1);

185 
	`»pÜt_pidšt_li¡
(
this_´og_li¡
,"Prog¿m†i¡","Prog¿m",
FALSE
);

187 ià(
this_´og_li¡
->
Ëngth
 == 0)

188 
	`åršt_msg
("NØ´og¿m defšed iÀPAT (·ck‘ %d)\n",
ii
+1);

191 ià(
this_´og_li¡
->
Ëngth
 > 1)

192 
	`åršt_msg
("Multiple…rograms in PAT - usinghe first\n");

193 
pmt_pid
 = 
this_´og_li¡
->
pid
[0];

196 
	`ä“_pidšt_li¡
(&
Ï¡_´og_li¡
);

197 
Ï¡_´og_li¡
 = 
this_´og_li¡
;

199 ià(
pid
 =ğ
pmt_pid
)

201 ià(
v”bo£
)

202 
	`åršt_msg
("Pack‘ %d i PMT w™h PID %04x (%d)%s\n",
ii
+1,
pid
,pid,

203 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"[pusi]":""));

204 ià(
·ylßd_Ën
 == 0)

206 
	`åršt_msg
("Pack‘ %d i PMT, buˆha nØ·ylßd\n",
ii
+1);

210 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
pmt_d©a
)

214 
	`´št_”r
("!!! Discarding…revious (uncompleted) PMT data\n");

215 
	`ä“
(
pmt_d©a
);

216 
pmt_d©a
 = 
NULL
; 
pmt_d©a_Ën
 = 0; 
pmt_d©a_u£d
 = 0;

218 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
pmt_d©a
)

222 
	`´št_”r
("!!! Discarding PMT continuation,‚o PMT started\n");

226 
”r
 = 
	`bud_psi_d©a
(
v”bo£
,
·ylßd
,
·ylßd_Ën
,
pid
,

227 &
pmt_d©a
,&
pmt_d©a_Ën
,&
pmt_d©a_u£d
);

228 ià(
”r
)

230 
	`åršt_”r
("### Error %s PMT\n",

231 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"));

232 
	`ä“_pidšt_li¡
(&
this_´og_li¡
);

233 
	`ä“_pmt
(&
Ï¡_pmt
);

234 ià(
pmt_d©a
è
	`ä“
(pmt_data);

239 ià(
pmt_d©a_Ën
 > 
pmt_d©a_u£d
)

242 
”r
 = 
	`exŒaù_pmt
(
v”bo£
,
pmt_d©a
,
pmt_d©a_Ën
,
pid
,&
this_pmt
);

243 ià(
”r
)

245 
	`ä“_pidšt_li¡
(&
this_´og_li¡
);

246 
	`ä“_pmt
(&
Ï¡_pmt
);

247 ià(
pmt_d©a
è
	`ä“
(pmt_data);

248  
”r
;

251 
	`ä“
(
pmt_d©a
);

252 
pmt_d©a
 = 
NULL
; 
pmt_d©a_Ën
 = 0; 
pmt_d©a_u£d
 = 0;

253 
num_pmts
++;

255 ià(
	`§me_pmt
(
this_pmt
,
Ï¡_pmt
))

257 
	`ä“_pmt
(&
this_pmt
);

261 ià(
Ï¡_pmt
 !ğ
NULL
)

262 
	`åršt_msg
("\nPacket %d is PMT with PID %04x (%d)"

263 " - cÚ‹Á chªged\n",
ii
+1,
pid
,pid);

264 ià(!
v”bo£
)

265 
	`åršt_msg
("\nPack‘ %d i PMT w™h PID %04x (%d)\n",
ii
+1,
pid
,pid);

267 
	`»pÜt_pmt
(
TRUE
," ",
this_pmt
);

269 
	`ä“_pmt
(&
Ï¡_pmt
);

270 
Ï¡_pmt
 = 
this_pmt
;

274 
	`åršt_msg
("\nFound %d PAT…acket%s‡nd %d PMT…acket%s in %d TS…ackets\n",

275 
num_·ts
,(num_pats==1?"":"s"),

276 
num_pmts
,Òum_pmts==1?"":"s"),
max
);

278 
	`ä“_pidšt_li¡
(&
Ï¡_´og_li¡
);

279 
	`ä“_pmt
(&
Ï¡_pmt
);

280 ià(
pmt_d©a
è
	`ä“
(pmt_data);

282 
	}
}

284 
	$´št_u§ge
()

286 
	`´št_msg
(

290 
	`REPORT_VERSION
("tsinfo");

291 
	`´št_msg
(

306 
	}
}

308 
	$maš
(
¬gc
, **
¬gv
)

310 
u£_¡dš
 = 
FALSE
;

311 *
šput_Çme
 = 
NULL
;

312 
had_šput_Çme
 = 
FALSE
;

313 
max
 = 10000;

314 
v”bo£
 = 
FALSE
;

315 
lookfÜ
 = 1;

316 
”r
 = 0;

318 
TS_»ad”_p
 
t¤—d”
 = 
NULL
;

320 
ii
 = 1;

322 ià(
¬gc
 < 2)

324 
	`´št_u§ge
();

328 
ii
 < 
¬gc
)

330 ià(
¬gv
[
ii
][0] == '-')

332 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

333 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

335 
	`´št_u§ge
();

338 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

340 
	`CHECKARG
("tsšfo",
ii
);

341 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

342 
	`»dœeù_ouut_¡d”r
();

343 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

344 
	`»dœeù_ouut_¡dout
();

347 
	`åršt_”r
("###sinfo: "

349 " '¡d”r')\n",
¬gv
[
ii
+1]);

352 
ii
++;

354 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

356 
v”bo£
 = 
TRUE
;

358 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

360 
	`CHECKARG
("tsšfo",
ii
);

361 
”r
 = 
	`št_v®ue
("tsšfo",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

362 ià(
”r
)  1;

363 
ii
++;

365 ià(!
	`¡rcmp
("-»³©",
¬gv
[
ii
]))

367 
	`CHECKARG
("tsšfo",
ii
);

368 
”r
 = 
	`št_v®ue
("tsšfo",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
lookfÜ
);

369 ià(
”r
)  1;

370 
ii
++;

372 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

374 
u£_¡dš
 = 
TRUE
;

375 
had_šput_Çme
 = 
TRUE
;

379 
	`åršt_”r
("###sinfo: "

380 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

386 ià(
had_šput_Çme
)

388 
	`åršt_”r
("###sšfo: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

393 
šput_Çme
 = 
¬gv
[
ii
];

394 
had_šput_Çme
 = 
TRUE
;

397 
ii
++;

400 ià(!
had_šput_Çme
)

402 
	`´št_”r
("###sinfo: No input file specified\n");

406 
”r
 = 
	`İ’_fe_fÜ_TS_»ad
((
u£_¡dš
?
NULL
:
šput_Çme
),&
t¤—d”
);

407 ià(
”r
)

409 
	`åršt_”r
("###sinfo: Unableo open input file %s for„eading TS\n",

410 
u£_¡dš
?"<¡dš>":
šput_Çme
);

413 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

415 
”r
 = 
	`»pÜt_¡»ams
(
t¤—d”
,
max
,
v”bo£
);

416 ià(
”r
)

418 
	`´št_”r
("###sinfo: Error„eporting on stream\n");

419 (è
	`şo£_TS_»ad”
(&
t¤—d”
);

423 
”r
 = 
	`şo£_TS_»ad”
(&
t¤—d”
);

424 ià(
”r
)  1;

427 
	}
}

	@tsplay.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<fú.h
>

34 
	~<m©h.h
>

36 #ifdeà
_WIN32


37 
	~<¡ddef.h
>

39 
	~<uni¡d.h
>

42 
	~<time.h
>

44 
	~"com·t.h
"

45 
	~"´štšg_âs.h
"

46 
	~"t¥Ïy_âs.h
"

47 
	~"tswr™e_âs.h
"

48 
	~"´štšg_âs.h
"

49 
	~"misc_âs.h
"

50 
	~"v”siÚ.h
"

52 
	~"ps_âs.h
"

53 
	~"³s_âs.h
"

54 
	~"pidšt_âs.h
"

56 
	$´št_u§ge
(
summ¬y
)

58 
	`´št_msg
(

62 
	`REPORT_VERSION
("tsplay");

63 ià(
summ¬y
)

64 
	`´št_msg
(

71 
	`´št_msg
(

90 
	`´št_msg
(

107 ià(
summ¬y
)

108 
	`´št_msg
(

112 
	`´št_msg
(

118 
	`´št_msg
(

133 ià(
summ¬y
)

134 
	`´št_msg
(

141 
	`åršt_msg
(

172 
TSPLAY_REPORT_EVERY
);

173 
	}
}

175 
	$´št_h–p_h–p
()

177 
	`´št_msg
(

193 
	}
}

195 
	$´št_h–p_ts
()

197 
	`´št_msg
(

237 
	}
}

239 
	$´št_h–p_ps
()

241 
	`´št_msg
(

310 
	}
}

312 
	$´št_h–p_tunšg
()

314 
	`tswr™e_h–p_tunšg
();

315 
	}
}

317 
	$´št_h–p_‹¡šg
()

319 
	`tswr™e_h–p_‹¡šg
();

320 
	`´št_msg
(

326 
	}
}

328 
	$´št_h–p_debuggšg
()

330 
	`tswr™e_h–p_debug
();

331 
	}
}

333 
	$maš
(
¬gc
, **
¬gv
)

335 
TS_wr™”_p
 
tswr™”
;

336 
TS_cÚ‹xt
 
cÚ‹xt
;

337 *
šput_Çme
 = 
NULL
;

338 
had_šput_Çme
 = 
FALSE
;

339 
had_ouut_Çme
 = 
FALSE
;

340 
šput
 = -1;

341 
max
 = 0;

342 
qu›t
 = 
FALSE
;

343 
v”bo£
 = 
FALSE
;

344 
”r
 = 0;

345 
ii
 = 1;

346 
loİ
 = 
FALSE
;

347 
time_t
 
¡¬t
,
’d
;

348 
is_TS
;

351 
TS_wr™”_ty³
 
how
 = 
TS_W_UNDEFINED
;

352 *
ouut_Çme
 = 
NULL
;

353 
pÜt
 = 88;

354 
u£_ÃtwÜk
 = 
FALSE
;

355 *
muÉiÿ¡_if
 = 
NULL
;

357 
t¥Ïy_ouut_·û_mode
 
·û_mode
 = 
TSPLAY_OUTPUT_PACE_PCR2_TS
;

359 
ušt32_t
 
pid_to_ignÜe
 = 0;

360 
ušt32_t
 
ov”ride_pü_pid
 = 0;

363 
ušt32_t
 
pmt_pid
 = 0x66;

364 
ušt32_t
 
video_pid
 = 0x68;

365 
ušt32_t
 
pü_pid
 = 
video_pid
;

366 
ušt32_t
 
audio_pid
 = 0x67;

367 
»³©_´og¿m_ev”y
 = 100;

368 
·d_¡¬t
 = 8;

369 
šput_is_dvd
 = 
TRUE
;

371 
video_¡»am
 = -1;

372 
audio_¡»am
 = -1;

373 
wªt_ac3_audio
 = 
FALSE
;

375 
wªt_h262
 = 
TRUE
;

376 
fÜû_¡»am_ty³
 = 
FALSE
;

377 
wªt_dŞby_as_dvb
 = 
TRUE
;

378 
drİ_·ck‘s
 = 0;

379 
drİ_numb”
 = 0;

381 ià(
¬gc
 < 2)

383 
	`´št_u§ge
(
TRUE
);

388 
”r
 = 
	`tswr™e_´oûss_¬gs
("t¥Ïy",
¬gc
,
¬gv
,&
cÚ‹xt
);

389 ià(
”r
)  1;

392 
ii
 < 
¬gc
)

395 ià(!
	`¡rcmp
(
¬gv
[
ii
],
TSWRITE_PROCESSED
))

397 
ii
++;

401 ià(
¬gv
[
ii
][0] == '-')

403 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

404 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

406 ià(
¬gc
 =ğ(
ii
+1))

407 
	`´št_h–p_h–p
();

410 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"ps"))

411 
	`´št_h–p_ps
();

412 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"ts"))

413 
	`´št_h–p_ts
();

414 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"tuning"))

415 
	`´št_h–p_tunšg
();

416 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"test") || !strcmp(argv[ii+1],"testing"))

417 
	`´št_h–p_‹¡šg
();

418 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"debug") || !strcmp(argv[ii+1],"debugging"))

419 
	`´št_h–p_debuggšg
();

420 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"detail") || !strcmp(argv[ii+1],"details"))

421 
	`´št_u§ge
(
FALSE
);

422 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"all"))

424 
	`´št_u§ge
(
FALSE
);

425 
	`´št_msg
("\n");

426 
	`´št_h–p_ts
();

427 
	`´št_msg
("\n");

428 
	`´št_h–p_ps
();

429 
	`´št_msg
("\n");

430 
	`´št_h–p_tunšg
();

431 
	`´št_msg
("\n");

432 
	`´št_h–p_‹¡šg
();

433 
	`´št_msg
("\n");

434 
	`´št_h–p_debuggšg
();

435 
	`´št_msg
("\n");

436 
	`´št_h–p_h–p
();

440 
	`åršt_”r
("###splay: "

442 
¬gv
[
ii
],argv[ii+1]);

448 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

450 
qu›t
 = 
TRUE
;

451 
v”bo£
 = 
FALSE
;

453 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

455 
qu›t
 = 
FALSE
;

456 
v”bo£
 = 
TRUE
;

458 ià(!
	`¡rcmp
("-ouut",
¬gv
[
ii
]) || !strcmp("-o",argv[ii]))

460 
	`CHECKARG
("t¥Ïy",
ii
);

461 
had_ouut_Çme
 = 
TRUE
;

462 
u£_ÃtwÜk
 = 
FALSE
;

463 
how
 = 
TS_W_FILE
;

464 
ouut_Çme
 = 
¬gv
[
ii
+1];

465 
ii
++;

467 ià(!
	`¡rcmp
("-mÿ¡if",
¬gv
[
ii
]) || !strcmp("-i",argv[ii]))

469 
	`CHECKARG
("t¥Ïy",
ii
);

470 
muÉiÿ¡_if
 = 
¬gv
[
ii
+1];

471 
ii
++;

473 ià(!
	`¡rcmp
("-¡dout",
¬gv
[
ii
]))

475 
had_ouut_Çme
 = 
TRUE
;

476 
u£_ÃtwÜk
 = 
FALSE
;

477 
how
 = 
TS_W_STDOUT
;

478 
ouut_Çme
 = 
NULL
;

479 
	`»dœeù_ouut_¡d”r
();

481 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

483 
had_šput_Çme
 = 
TRUE
;

484 
šput_Çme
 = 
NULL
;

486 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

488 
	`CHECKARG
("t¥Ïy",
ii
);

489 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

490 
	`»dœeù_ouut_¡d”r
();

491 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

492 
	`»dœeù_ouut_¡dout
();

495 
	`åršt_”r
("###splay: "

497 " '¡d”r')\n",
¬gv
[
ii
+1]);

500 
ii
++;

502 ià(!
	`¡rcmp
("-tı",
¬gv
[
ii
]))

504 ià(
how
 =ğ
TS_W_STDOUT
 || how =ğ
TS_W_FILE
)

506 
	`´št_”r
("###splay: -tcp does‚ot make sense with file output\n");

509 
u£_ÃtwÜk
 = 
TRUE
;

510 
how
 = 
TS_W_TCP
;

512 ià(!
	`¡rcmp
("-udp",
¬gv
[
ii
]))

514 ià(
how
 =ğ
TS_W_STDOUT
 || how =ğ
TS_W_FILE
)

516 
	`´št_”r
("###splay: -udp does‚ot make sense with file output\n");

519 
u£_ÃtwÜk
 = 
TRUE
;

520 
how
 = 
TS_W_UDP
;

522 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

524 
	`CHECKARG
("t¥Ïy",
ii
);

525 
”r
 = 
	`št_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

526 ià(
”r
)  1;

527 
ii
++;

529 ià(!
	`¡rcmp
("-Şd·û",
¬gv
[
ii
]))

531 
·û_mode
 = 
TSPLAY_OUTPUT_PACE_FIXED
;

533 ià(!
	`¡rcmp
("-·û-pü1",
¬gv
[
ii
]))

535 
·û_mode
 = 
TSPLAY_OUTPUT_PACE_PCR1
;

537 ià(!
	`¡rcmp
("-·û-pü2-ts",
¬gv
[
ii
]))

539 
·û_mode
 = 
TSPLAY_OUTPUT_PACE_PCR2_TS
;

541 ià(!
	`¡rcmp
("-·û-pü2-pmt",
¬gv
[
ii
]))

543 
·û_mode
 = 
TSPLAY_OUTPUT_PACE_PCR2_PMT
;

545 ià(!
	`¡rcmp
("-fÜûpü",
¬gv
[
ii
]))

547 
	`CHECKARG
("t¥Ïy",
ii
);

548 
”r
 = 
	`unsigÃd_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],0,&
ov”ride_pü_pid
);

549 ià(
”r
)  1;

550 
ii
++;

552 ià(!
	`¡rcmp
("-loİ",
¬gv
[
ii
]))

554 
loİ
 = 
TRUE
;

556 ià(!
	`¡rcmp
("-avc",
¬gv
[
ii
]) || !strcmp("-h264",argv[ii]))

558 
fÜû_¡»am_ty³
 = 
TRUE
;

559 
wªt_h262
 = 
FALSE
;

561 ià(!
	`¡rcmp
("-h262",
¬gv
[
ii
]))

563 
fÜû_¡»am_ty³
 = 
TRUE
;

564 
wªt_h262
 = 
TRUE
;

566 ià(!
	`¡rcmp
("-dvd",
¬gv
[
ii
]))

568 
šput_is_dvd
 = 
TRUE
;

570 ià(!
	`¡rcmp
("-nÙdvd",
¬gv
[
ii
]) || !strcmp("-nodvd",argv[ii]))

572 
šput_is_dvd
 = 
FALSE
;

574 ià(!
	`¡rcmp
("-v¡»am",
¬gv
[
ii
]))

576 
	`CHECKARG
("t¥Ïy",
ii
);

577 
”r
 = 
	`št_v®ue_š_¿nge
("ps2ts",
¬gv
[
ii
],argv[ii+1],0,0xF,0,

578 &
video_¡»am
);

579 ià(
”r
)  1;

580 
ii
++;

582 ià(!
	`¡rcmp
("-a¡»am",
¬gv
[
ii
]))

584 
	`CHECKARG
("t¥Ïy",
ii
);

585 
”r
 = 
	`št_v®ue_š_¿nge
("ps2ts",
¬gv
[
ii
],argv[ii+1],0,0x1F,0,

586 &
audio_¡»am
);

587 ià(
”r
)  1;

588 
wªt_ac3_audio
 = 
FALSE
;

589 
ii
++;

591 ià(!
	`¡rcmp
("-ac3¡»am",
¬gv
[
ii
]))

593 
	`CHECKARG
("t¥Ïy",
ii
);

594 
”r
 = 
	`št_v®ue_š_¿nge
("ps2ts",
¬gv
[
ii
],argv[ii+1],0,0x7,0,

595 &
audio_¡»am
);

596 ià(
”r
)  1;

597 
wªt_ac3_audio
 = 
TRUE
;

598 
šput_is_dvd
 = 
TRUE
;

599 
ii
++;

601 ià(!
	`¡rcmp
("-dŞby",
¬gv
[
ii
]))

603 
	`CHECKARG
("t¥Ïy",
ii
);

604 ià(!
	`¡rcmp
("dvb",
¬gv
[
ii
+1]))

605 
wªt_dŞby_as_dvb
 = 
TRUE
;

606 ià(!
	`¡rcmp
("©sc",
¬gv
[
ii
+1]))

607 
wªt_dŞby_as_dvb
 = 
FALSE
;

610 
	`´št_”r
("###splay: -dolby must be followed by dvb or‡tsc\n");

613 
ii
++;

615 ià(!
	`¡rcmp
("-´•—t",
¬gv
[
ii
]))

617 
	`CHECKARG
("t¥Ïy",
ii
);

618 
”r
 = 
	`št_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

619 &
»³©_´og¿m_ev”y
);

620 ià(
”r
)  1;

621 
ii
++;

623 ià(!
	`¡rcmp
("-·d",
¬gv
[
ii
]))

625 
	`CHECKARG
("t¥Ïy",
ii
);

626 
”r
 = 
	`št_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
·d_¡¬t
);

627 ià(
”r
)  1;

628 
ii
++;

630 ià(!
	`¡rcmp
("-ignÜe",
¬gv
[
ii
]))

632 
	`CHECKARG
("t¥Ïy",
ii
);

633 
”r
 = 
	`unsigÃd_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],0,&
pid_to_ignÜe
);

634 ià(
”r
)  1;

635 ià(
pid_to_ignÜe
 == 0)

637 
	`´št_”r
("###splay: -ignore 0 is‚ot‡llowed\n");

640 
ii
++;

642 ià(!
	`¡rcmp
("-vpid",
¬gv
[
ii
]))

644 
	`CHECKARG
("t¥Ïy",
ii
);

645 
”r
 = 
	`unsigÃd_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],0,&
video_pid
);

646 ià(
”r
)  1;

647 
ii
++;

649 ià(!
	`¡rcmp
("-­id",
¬gv
[
ii
]))

651 
	`CHECKARG
("t¥Ïy",
ii
);

652 
”r
 = 
	`unsigÃd_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],0,&
audio_pid
);

653 ià(
”r
)  1;

654 
ii
++;

656 ià(!
	`¡rcmp
("-pmt",
¬gv
[
ii
]))

658 
	`CHECKARG
("t¥Ïy",
ii
);

659 
”r
 = 
	`unsigÃd_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],0,&
pmt_pid
);

660 ià(
”r
)  1;

661 
ii
++;

663 ià(!
	`¡rcmp
("-drİ",
¬gv
[
ii
]))

665 ià(
ii
+2 >ğ
¬gc
)

667 
	`´št_”r
("###splay: -drop„equireswo‡rguments\n");

670 
”r
 = 
	`št_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,0,&
drİ_·ck‘s
);

671 ià(
”r
)  1;

672 
”r
 = 
	`št_v®ue
("t¥Ïy",
¬gv
[
ii
],¬gv[ii+2],
TRUE
,0,&
drİ_numb”
);

673 ià(
”r
)  1;

674 
ii
 += 2;

678 
	`åršt_”r
("###splay: "

679 "UÄecogni£d commªd†šsw™ch '%s' --ry '-h–p'\n",
¬gv
[
ii
]);

685 ià(!
had_šput_Çme
)

687 
šput_Çme
 = 
¬gv
[
ii
];

688 
had_šput_Çme
 = 
TRUE
;

690 ià(!
had_ouut_Çme
)

693 
”r
 = 
	`ho¡_v®ue
("t¥Ïy",
NULL
,
¬gv
[
ii
],&
ouut_Çme
,&
pÜt
);

694 ià(
”r
)  1;

695 
had_ouut_Çme
 = 
TRUE
;

696 
u£_ÃtwÜk
 = 
TRUE
;

697 ià(
how
 =ğ
TS_W_UNDEFINED
)

698 
how
 = 
TS_W_UDP
;

702 
	`åršt_”r
("###¥Ïy: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

706 
ii
++;

709 ià(!
had_šput_Çme
)

711 
	`´št_”r
("###splay: No input file specified\n");

716 ià(!
had_ouut_Çme
)

718 
	`´št_”r
("###splay: No output file or host specified\n");

723 ià(
how
 =ğ
TS_W_STDOUT
)

724 
ouut_Çme
 = "<stdout>";

727 ià(
how
 =ğ
TS_W_STDOUT
)

729 
v”bo£
 = 
FALSE
;

730 
qu›t
 = 
TRUE
;

734 ià(
max
 > 0 && 
how
 =ğ
TS_W_UDP
 && (max / 7è< 
cÚ‹xt
.
cœc_buf_size
)

736 
	`åršt_”r
("###splay: -max %d cannot work with -buffer %d"

737 " - max mu¡ b©†—¡ %d",
max
,

738 
cÚ‹xt
.
cœc_buf_size
,context.circ_buf_size*7);

739 ià(
max
/7 > 0)

740 
	`åršt_”r
(",\À o¸bufã¸siz»duûdØ%d",
max
/7);

741 
	`´št_”r
("\n");

747 ià(
cÚ‹xt
.
pü_mode
 =ğ
TSWRITE_PCR_MODE_NONE
)

748 
·û_mode
 = 
TSPLAY_OUTPUT_PACE_FIXED
;

749 ià(
·û_mode
 =ğ
TSPLAY_OUTPUT_PACE_PCR1
)

750 
cÚ‹xt
.
pü_mode
 = 
TSWRITE_PCR_MODE_PCR1
;

752 ià(
šput_Çme
)

754 
šput
 = 
	`İ’_bš¬y_fe
(
šput_Çme
,
FALSE
);

755 ià(
šput
 == -1)

757 
	`åršt_”r
("###¥Ïy: UÇbËØİ’ iÅuˆf%s\n",
šput_Çme
);

761 
”r
 = 
	`d‘”mše_if_TS_fe
(
šput
,&
is_TS
);

762 ià(
”r
)

764 
	`åršt_”r
("###¥Ïy: CªnÙ…Ïy f%s\n",
ouut_Çme
);

765 (è
	`şo£_fe
(
šput
);

771 
šput_Çme
 = "<stdin>";

772 
šput
 = 
STDIN_FILENO
;

773 
is_TS
 = 
TRUE
;

775 ià(!
qu›t
)

776 
	`åršt_msg
("R—dšg from %s%s\n",
šput_Çme
,(
loİ
?" (and†ooping)":""));

778 
”r
 = 
	`tswr™e_İ’
(
how
,
ouut_Çme
,
muÉiÿ¡_if
,
pÜt
,
qu›t
,

779 &
tswr™”
);

780 ià(
”r
)

782 
	`åršt_”r
("###¥Ïy: CªnÙ o³n/cÚÃùØ%s\n",
ouut_Çme
);

783 (è
	`şo£_fe
(
šput
);

787 ià(!
qu›t
)

789 ià(
is_TS
)

791 
	`´št_msg
("Input‡ppearso be Transport Stream\n");

792 ià(
·û_mode
 !ğ
TSPLAY_OUTPUT_PACE_FIXED
)

793 
	`´št_msg
("Using 'exact' TS…acketiming (by†ooking-aheadohe‚ext PCR)\n");

795 
	`´št_msg
("Approximating/predicting intermediate PCRs\n");

796 ià(
pid_to_ignÜe
)

797 
	`åršt_msg
("IgnÜšg PID %04x (%d)\n",
pid_to_ignÜe
,pid_to_ignore);

801 
	`´št_msg
("Input‡ppearso be Program Stream\n");

802 ià(
šput_is_dvd
)

803 
	`´št_msg
("Treating input‡s from DVD\n");

805 
	`´št_msg
("Treating input‡s NOT from DVD\n");

807 ià(
max
)

808 
	`åršt_msg
("Stİpšg‡á”‡ˆmo¡ %d…ack‘s\n",
max
);

810 ià(
how
 =ğ
TS_W_UDP
)

811 
	`tswr™e_»pÜt_¬gs
(&
cÚ‹xt
);

814 ià(
drİ_·ck‘s
)

816 ià(!
qu›t
)

817 
	`åršt_msg
("DROPPING: Keeping %d TS…acket%s,hen dropping (throwing‡way) %d\n",

818 
drİ_·ck‘s
,(drİ_·ck‘s==1?"":"s"),
drİ_numb”
);

819 
tswr™”
->
drİ_·ck‘s
 = drop_packets;

820 
tswr™”
->
drİ_numb”
 = drop_number;

823 ià(!
qu›t
)

824 
¡¬t
 = 
	`time
(
NULL
);

828 ià(
how
 =ğ
TS_W_UDP
)

830 
”r
 = 
	`tswr™e_¡¬t_bufãršg_äom_cÚ‹xt
(
tswr™”
,&
cÚ‹xt
);

831 ià(
”r
)

833 
	`´št_”r
("###splay: Error setting up buffering\n");

834 (è
	`şo£_fe
(
šput
);

835 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

840 ià(
is_TS
)

842 
”r
 = 
	`¶ay_TS_¡»am
(
šput
,
tswr™”
,
·û_mode
,
pid_to_ignÜe
,

843 
ov”ride_pü_pid
,
max
,
loİ
,
qu›t
,
v”bo£
);

846 
”r
 = 
	`¶ay_PS_¡»am
(
šput
,
tswr™”
,
·d_¡¬t
,

847 
»³©_´og¿m_ev”y
,
fÜû_¡»am_ty³
,

848 
wªt_h262
,
šput_is_dvd
,

849 
video_¡»am
,
audio_¡»am
,
wªt_ac3_audio
,

850 
wªt_dŞby_as_dvb
,
pmt_pid
,
pü_pid
,

851 
video_pid
,
TRUE
,
audio_pid
,
max
,
loİ
,

852 
v”bo£
,
qu›t
);

853 ià(
”r
)

855 
	`´št_”r
("###splay: Error…laying stream\n");

856 (è
	`şo£_fe
(
šput
);

857 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

861 ià(!
qu›t
)

863 
’d
 = 
	`time
(
NULL
);

864 
	`åršt_msg
("S¹ed ouuˆ© %s",
	`ùime
(&
¡¬t
));

865 
	`åršt_msg
("Fšished ouuˆ© %s",
	`ùime
(&
’d
));

866 
	`åršt_msg
("EÏp£dim%.1fs\n",
	`difáime
(
’d
,
¡¬t
));

869 
”r
 = 
	`şo£_fe
(
šput
);

870 ià(
”r
)

872 
	`åršt_”r
("###¥Ïy: E¼Ü closšg iÅuˆf%s\n",
šput_Çme
);

873 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

876 
”r
 = 
	`tswr™e_şo£
(
tswr™”
,
qu›t
);

877 ià(
”r
)

879 
	`åršt_”r
("###¥Ïy: E¼Ü closšg ouuˆtØ%s\n",
ouut_Çme
);

883 
	}
}

	@tsplay_defns.h

31 #iâdeà
_t¥Ïy_deâs


32 
	#_t¥Ïy_deâs


	)

35 
	#TSPLAY_REPORT_EVERY
 10000

	)

37 
	et¥Ïy_ouut_·û_mode_e


39 
	mTSPLAY_OUTPUT_PACE_FIXED
,

40 
	mTSPLAY_OUTPUT_PACE_PCR1
,

41 
	mTSPLAY_OUTPUT_PACE_PCR2_TS
,

42 
	mTSPLAY_OUTPUT_PACE_PCR2_PMT


43 } 
	tt¥Ïy_ouut_·û_mode
;

	@tsplay_fns.h

31 #iâdeà
_t¥Ïy_âs


32 
	#_t¥Ïy_âs


	)

34 
	~"tswr™e_deâs.h
"

35 
	~"t¥Ïy_deâs.h
"

61 
¶ay_TS_¡»am
(
šput
,

62 
TS_wr™”_p
 
tswr™”
,

63 cÚ¡ 
t¥Ïy_ouut_·û_mode
 
·û_mode
,

64 
ušt32_t
 
pid_to_ignÜe
,

65 
ušt32_t
 
ov”ride_pü_pid
,

66 
max
,

67 
loİ
,

68 
qu›t
,

69 
v”bo£
);

113 
¶ay_PS_¡»am
(
šput
,

114 
TS_wr™”_p
 
ouut
,

115 
·d_¡¬t
,

116 
´og¿m_»³©
,

117 
fÜû_¡»am_ty³
,

118 
wªt_h262
,

119 
šput_is_dvd
,

120 
video_¡»am
,

121 
audio_¡»am
,

122 
wªt_ac3_audio
,

123 
wªt_dŞby_as_dvb
,

124 
ušt32_t
 
pmt_pid
,

125 
ušt32_t
 
pü_pid
,

126 
ušt32_t
 
video_pid
,

127 
k“p_audio
,

128 
ušt32_t
 
audio_pid
,

129 
max
,

130 
loİ
,

131 
v”bo£
,

132 
qu›t
);

	@tsplay_innards.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<”ºo.h
>

34 
	~<¡ršg.h
>

35 
	~<fú.h
>

36 
	~<m©h.h
>

38 #ifdeà
_WIN32


39 
	~<¡ddef.h
>

41 
	~<uni¡d.h
>

44 
	~<time.h
>

46 
	~"com·t.h
"

47 
	~"´štšg_âs.h
"

48 
	~"ts_âs.h
"

49 
	~"ps_âs.h
"

50 
	~"³s_âs.h
"

51 
	~"misc_âs.h
"

52 
	~"´štšg_âs.h
"

53 
	~"t¥Ïy_âs.h
"

54 
	~"tswr™e_âs.h
"

55 
	~"pidšt_âs.h
"

82 
	$»ad_TS_·ck‘
(
TS_»ad”_p
 
t¤—d”
,

83 
ušt32_t
 *
couÁ
,

84 
by‹
 *
d©a
[
TS_PACKET_SIZE
],

85 
ušt32_t
 *
pid
,

86 *
gÙ_pü
,

87 
ušt64_t
 *
pü
,

88 
max
,

89 
loİ
,

90 
off£t_t
 
¡¬t_po¢
,

91 
ušt32_t
 
¡¬t_couÁ
,

92 
qu›t
)

94 
”r
;

95 
·ylßd_un™_¡¬t_šdiÿtÜ
;

96 
by‹
 *
ad­t
;

97 
ad­t_Ën
;

98 
by‹
 *
·ylßd
;

99 
·ylßd_Ën
;

101 ià(
max
 > 0 && (*
couÁ
è>ğ(
ušt32_t
)max)

103 ià(
loİ
)

105 ià(!
qu›t
)

106 
	`åršt_msg
("R—d %d…ack‘s,„ewšdšg‡nd cÚtšušg\n",
max
);

107 
”r
 = 
	`£ek_usšg_TS_»ad”
(
t¤—d”
,
¡¬t_po¢
);

108 ià(
”r
)  1;

109 *
couÁ
 = 
¡¬t_couÁ
;

113 ià(!
qu›t
è
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
max
);

114  
EOF
;

119 (
”r
 = 
	`»ad_Ãxt_TS_·ck‘
(
t¤—d”
,
d©a
)) != 0)

121 ià(
”r
 =ğ
EOF
)

123 ià(!
loİ
)

124  
EOF
;

125 ià(!
qu›t
)

126 
	`åršt_msg
("EOF (after %d TS…ackets),„ewinding‡nd continuing\n",

127 *
couÁ
);

131 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘ %d\n",*
couÁ
);

132 ià(!
loİ
)

134 ià(!
qu›t
)

135 
	`´št_msg
("!!! Rewinding‡nd continuing‡nyway\n");

137 
”r
 = 
	`£ek_usšg_TS_»ad”
(
t¤—d”
,
¡¬t_po¢
);

138 ià(
”r
)  1;

139 *
couÁ
 = 
¡¬t_couÁ
;

142 
”r
 = 
	`¥l™_TS_·ck‘
(*
d©a
,
pid
,&
·ylßd_un™_¡¬t_šdiÿtÜ
,

143 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

144 ià(
”r
)

146 
	`åršt_”r
("### E¼Ü s¶™tšg TS…ack‘ %d\n",*
couÁ
);

150 
	`g‘_PCR_äom_ad­tiÚ_f›ld
(
ad­t
,
ad­t_Ën
,
gÙ_pü
,
pü
);

152 (*
couÁ
) ++;

154 
	}
}

170 
	$fšd_PCR_PID
(
TS_»ad”_p
 
t¤—d”
,

171 
TS_wr™”_p
 
tswr™”
,

172 
ušt32_t
 *
pü_pid
,

173 
ušt32_t
 *
num_»ad
,

174 
max
,

175 
qu›t
)

177 
”r
;

178 
couÁ
 = 0;

179 
by‹
 *
d©a
;

180 
ušt32_t
 
pid
;

181 
·ylßd_un™_¡¬t_šdiÿtÜ
;

182 
by‹
 *
ad­t
;

183 
ad­t_Ën
;

184 
by‹
 *
·ylßd
;

185 
·ylßd_Ën
;

186 
gÙ_PAT
 = 
FALSE
;

188 
pidšt_li¡_p
 
´og_li¡
 = 
NULL
;

189 
pmt_p
 
pmt
 = 
NULL
;

190 
ušt32_t
 
pmt_pid
 = 0;

192 
by‹
 *
·t_d©a
 = 
NULL
;

193 
·t_d©a_Ën
 = 0;

194 
·t_d©a_u£d
 = 0;

196 
by‹
 *
pmt_d©a
 = 
NULL
;

197 
pmt_d©a_Ën
 = 0;

198 
pmt_d©a_u£d
 = 0;

199 
pmt_´og¿m_numb”
 = -1;

203 
”r
 = 
	`»ad_Ãxt_TS_·ck‘
(
t¤—d”
,&
d©a
);

204 ià(
”r
 =ğ
EOF
)

206 
	`åršt_”r
("### EOF (after %d TS…ackets), before finding…rogram"

207 " infÜm©iÚ\n",
couÁ
);

208 ià(
pmt_d©a
è
	`ä“
(pmt_data);

211 ià(
”r
)

213 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘ %d\n",
couÁ
+1);

214 ià(
pmt_d©a
è
	`ä“
(pmt_data);

217 
couÁ
++;

219 
”r
 = 
	`¥l™_TS_·ck‘
(
d©a
,&
pid
,&
·ylßd_un™_¡¬t_šdiÿtÜ
,

220 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

221 ià(
”r
)

223 
	`åršt_”r
("### E¼Ü s¶™tšg TS…ack‘ %d\n",
couÁ
);

224 ià(
pmt_d©a
è
	`ä“
(pmt_data);

231 
”r
 = 
	`tswr™e_wr™e
(
tswr™”
,
d©a
,
pid
,
FALSE
,0);

232 ià(
”r
)

234 
	`åršt_”r
("### Error writing TS…acket %do circular buffer\n",

235 
couÁ
);

236 ià(
pmt_d©a
è
	`ä“
(pmt_data);

240 ià(
pid
 =ğ0x0000 && !
gÙ_PAT
)

242 ià(!
qu›t
è
	`åršt_msg
("Pack‘ %d i PAT\n",
couÁ
);

243 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
·t_d©a
)

247 
	`´št_”r
("!!! Discarding…revious (uncompleted) PAT data\n");

248 
	`ä“
(
·t_d©a
);

249 
·t_d©a
 = 
NULL
; 
·t_d©a_Ën
 = 0; 
·t_d©a_u£d
 = 0;

251 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
·t_d©a
)

255 
	`´št_”r
("!!! Discarding PAT continuation,‚o PAT started\n");

259 
”r
 = 
	`bud_psi_d©a
(
FALSE
,
·ylßd
,
·ylßd_Ën
,
pid
,

260 &
·t_d©a
,&
·t_d©a_Ën
,&
·t_d©a_u£d
);

261 ià(
”r
)

263 
	`åršt_”r
("### Error %s PAT\n",

264 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"));

265 ià(
·t_d©a
è
	`ä“
(pat_data);

270 ià(
·t_d©a_Ën
 > 
·t_d©a_u£d
)

273 
”r
 = 
	`exŒaù_´og_li¡_äom_·t
(
FALSE
,
·t_d©a
,
·t_d©a_Ën
,&
´og_li¡
);

274 ià(
”r
 != 0)

276 
	`ä“
(
·t_d©a
);

279 ià(!
qu›t
)

280 
	`»pÜt_pidšt_li¡
(
´og_li¡
,"Prog¿m†i¡","Prog¿m",
FALSE
);

282 ià(
´og_li¡
->
Ëngth
 > 1 && !
qu›t
)

283 
	`´št_msg
("Multiple…rograms in PAT - usinghe first\n\n");

285 
pmt_pid
 = 
´og_li¡
->
pid
[0];

286 
pmt_´og¿m_numb”
 = 
´og_li¡
->
numb”
[0];

288 
gÙ_PAT
 = 
TRUE
;

289 
	`ä“_pidšt_li¡
(&
´og_li¡
);

290 
	`ä“
(
·t_d©a
);

291 
·t_d©a
 = 
NULL
; 
·t_d©a_Ën
 = 0; 
·t_d©a_u£d
 = 0;

293 ià(
gÙ_PAT
 && 
pid
 =ğ
pmt_pid
)

295 ià(!
qu›t
)

296 
	`åršt_msg
("Packet %d %s PMT with PID %04x\n",

297 
couÁ
, 
·ylßd_un™_¡¬t_šdiÿtÜ
?"starts":"continues",

298 
pmt_pid
);

300 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
pmt_d©a
)

304 
	`´št_”r
("!!! Discarding…revious (uncompleted) PMT data\n");

305 
	`ä“
(
pmt_d©a
);

306 
pmt_d©a
 = 
NULL
; 
pmt_d©a_Ën
 = 0; 
pmt_d©a_u£d
 = 0;

308 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
pmt_d©a
)

312 
	`´št_”r
("!!! Discarding PMT continuation,‚o PMT started\n");

316 
”r
 = 
	`bud_psi_d©a
(
FALSE
,
·ylßd
,
·ylßd_Ën
,
pid
,

317 &
pmt_d©a
,&
pmt_d©a_Ën
,&
pmt_d©a_u£d
);

318 ià(
”r
)

320 
	`åršt_”r
("### Error %s PMT\n",

321 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"));

322 ià(
pmt_d©a
è
	`ä“
(pmt_data);

327 ià(
pmt_d©a_Ën
 > 
pmt_d©a_u£d
)

330 
”r
 = 
	`exŒaù_pmt
(
FALSE
,
pmt_d©a
,
pmt_d©a_Ën
,
pmt_pid
,&
pmt
);

331 
	`ä“
(
pmt_d©a
);

332 
pmt_d©a
 = 
NULL
;

333 ià(
”r
) ƒrr;

335 ià(
pmt
->
´og¿m_numb”
 !ğ
pmt_´og¿m_numb”
)

337 ià(!
qu›t
)

338 
	`åršt_msg
("Discarding PMT…rogram %d -†ooking for %d\n",

339 
pmt
->
´og¿m_numb”
, 
pmt_´og¿m_numb”
);

340 
	`ä“_pmt
(&
pmt
);

344 ià(!
qu›t
)

345 
	`»pÜt_pmt
(
TRUE
," ",
pmt
);

346 *
pü_pid
 = 
pmt
->
PCR_pid
;

347 
	`ä“_pmt
(&
pmt
);

348 ià(!
qu›t
)

349 
	`åršt_msg
("Takšgimšg infÜm©iÚ from PID 0x%03x\n",*
pü_pid
);

350 *
num_»ad
 = 
couÁ
;

354 ià(
max
 > 0 && 
couÁ
 >= max)

356 
	`åršt_”r
("### Stopping‡fter %d TS…ackets, before finding…rogram"

357 " infÜm©iÚ\n",
max
);

358 ià(
pmt_d©a
è
	`ä“
(pmt_data);

362 
	}
}

391 
	$¶ay_bufã»d_TS_·ck‘s
(
TS_»ad”_p
 
t¤—d”
,

392 
TS_wr™”_p
 
tswr™”
,

393 
ušt32_t
 
pid_to_ignÜe
,

394 
ušt32_t
 
ov”ride_pü_pid
,

395 
max
,

396 
loİ
,

397 
qu›t
,

398 
v”bo£
)

400 
”r
;

401 
tÙ®
 = 0;

402 
ušt32_t
 
couÁ
 = 0;

403 
ušt32_t
 
pü_pid
;

404 
ušt32_t
 
¡¬t_couÁ
 = 0;

405 
off£t_t
 
¡¬t_po¢
 = 0;

413 
by‹
 *
d©a
 = 
NULL
;

414 
ušt32_t
 
pid
 = 0;

415 
ušt64_t
 
pü
 = 0;

419 ià(
ov”ride_pü_pid
)

421 
pü_pid
 = 
ov”ride_pü_pid
;

422 ià(!
qu›t
)

423 
	`åršt_msg
("FÜcšg u£ oàPCR PID 0x%03x (%d)\n",
pü_pid
,pcr_pid);

427 
”r
 = 
	`fšd_PCR_PID
(
t¤—d”
,
tswr™”
,&
pü_pid
,&
¡¬t_couÁ
,
max
,
qu›t
);

428 ià(
”r
)

430 
	`åršt_”r
("### Unableo find PCR PID foriming information\n"

431 " Looked iÀfœ¡ %d TS…ack‘s\n",
max
);

437 
”r
 = 
	`´ime_»ad_bufã»d_TS_·ck‘
(
t¤—d”
,
pü_pid
);

438 ià(
”r
)  1;

442 ià(
loİ
)

443 
¡¬t_po¢
 = 
¡¬t_couÁ
 * 
TS_PACKET_SIZE
;

445 
couÁ
 = 
¡¬t_couÁ
;

448 
”r
 = 
	`»ad_bufã»d_TS_·ck‘
(
t¤—d”
,&
couÁ
,&
d©a
,&
pid
,&
pü
,

449 
max
,
loİ
,
¡¬t_po¢
,
¡¬t_couÁ
,
qu›t
);

450 ià(
”r
 =ğ
EOF
)

452 ià(
”r
)

454 ià(
t¤—d”
->
fe
 !ğ
STDIN_FILENO
)

456 
	`åršt_”r
("### La¡ TS…ack‘„—d wa © " 
LLU_FORMAT
 "\n",

457 (
ušt64_t
)
couÁ
 * 
TS_PACKET_SIZE
);

461 
tÙ®
 ++;

467 ià(
pid_to_ignÜe
 !ğ0 && 
pid
 ==…id_to_ignore)

471 
”r
 = 
	`tswr™e_wr™e
(
tswr™”
,
d©a
,
pid
,
TRUE
,
pü
);

472 ià(
”r
)

474 
	`åršt_”r
("### Error writing TS…acket %do circular buffer\n",

475 
couÁ
);

479 ià(!
qu›t
 && 
v”bo£
 && 
tÙ®
%
TSPLAY_REPORT_EVERY
 == 0)

480 
	`åršt_msg
("T¿nsã¼ed %d TS…ack‘s\n",
tÙ®
);

483 ià(!
qu›t
)

484 
	`åršt_msg
("T¿nsã¼ed %d TS…ack‘% šÙ®\n",
tÙ®
,(total==1?"":"s"));

486 
	}
}

507 
	$¶ay_TS_·ck‘s
(
TS_»ad”_p
 
t¤—d”
,

508 
TS_wr™”_p
 
tswr™”
,

509 cÚ¡ 
t¥Ïy_ouut_·û_mode
 
·û_mode
,

510 
ušt32_t
 
pid_to_ignÜe
,

511 
max
,

512 
loİ
,

513 
qu›t
,

514 
v”bo£
)

516 
”r
;

517 
tÙ®
 = 0;

518 
ušt32_t
 
couÁ
 = 0;

519 
püs_u£d
 = 0;

520 
püs_ignÜed
 = 0;

521 
ušt32_t
 
pü_pid
 = ~0U;

522 
ušt32_t
 
¡¬t_couÁ
 = 0;

523 
off£t_t
 
¡¬t_po¢
 = 0;

525 ià(
·û_mode
 =ğ
TSPLAY_OUTPUT_PACE_PCR2_PMT
)

529 
”r
 = 
	`fšd_PCR_PID
(
t¤—d”
,
tswr™”
,&
pü_pid
,&
¡¬t_couÁ
,
max
,
qu›t
);

530 ià(
”r
)

532 
	`åršt_”r
("### Unableo find PCR PID foriming information\n"

533 " Looked iÀfœ¡ %d TS…ack‘s\n",
max
);

541 ià(
loİ
)

542 
¡¬t_po¢
 = 
¡¬t_couÁ
 * 
TS_PACKET_SIZE
;

545 
couÁ
 = 
¡¬t_couÁ
;

548 
by‹
 *
d©a
;

549 
ušt32_t
 
pid
;

550 
gÙ_pü
;

551 
ušt64_t
 
pü
 = 0;

553 
”r
 = 
	`»ad_TS_·ck‘
(
t¤—d”
,&
couÁ
,&
d©a
,&
pid
,&
gÙ_pü
,&
pü
,

554 
max
,
loİ
,
¡¬t_po¢
,
¡¬t_couÁ
,
qu›t
);

556 ià(
”r
 =ğ
EOF
)

558 ià(
”r
)

560 ià(
t¤—d”
->
fe
 !ğ
STDIN_FILENO
)

562 
	`åršt_”r
("### La¡ TS…ack‘„—d wa © " 
LLU_FORMAT
 "\n",

563 (
ušt64_t
)
couÁ
 * 
TS_PACKET_SIZE
);

568 ià(
couÁ
 =ğ
¡¬t_couÁ
 + 1)

569 
	`tswr™e_discÚtšu™y
(
tswr™”
);

571 
tÙ®
 ++;

574 ià(
gÙ_pü
)

577 ià(
pü_pid
 == ~0U)

579 
	`åršt_msg
("PCR PID s‘Ø1¡ s“n: %#x (%d)\n", 
pid
,…id);

580 
pü_pid
 = 
pid
;

583 ià(
pid
 =ğ
pü_pid
)

584 
püs_u£d
 ++;

587 ià(
püs_ignÜed
 == 0)

589 
	`åršt_msg
("Oth” PCR PID £’: %#x (%d)...\n", 
pid
,…id);

591 
püs_ignÜed
 ++;

592 
gÙ_pü
 = 
FALSE
;

596 ià(
pid_to_ignÜe
 !ğ0 && 
pid
 ==…id_to_ignore)

603 ià(!
gÙ_pü
)

607 
d©a
[2] = 0xFF;

608 
d©a
[1] |= 0x1F;

613 
”r
 = 
	`tswr™e_wr™e
(
tswr™”
,
d©a
,
pid
,
gÙ_pü
,
pü
);

614 ià(
”r
)

616 
	`åršt_”r
("### Error writing TS…acket %do circular buffer\n",

617 
couÁ
);

621 ià(!
qu›t
 && 
v”bo£
 && 
tÙ®
%
TSPLAY_REPORT_EVERY
 == 0)

622 
	`åršt_msg
("T¿nsã¼ed %d TS…ack‘s\n",
tÙ®
);

625 ià(!
qu›t
)

627 
	`åršt_msg
("T¿nsã¼ed %d TS…ack‘% šÙ®\n",
tÙ®
,(total==1?"":"s"));

628 
	`åršt_msg
("Used PCRs from %d…ackets, ignored PCRs from %d…ackets\n",

629 
püs_u£d
,
püs_ignÜed
);

632 
	}
}

658 
	$¶ay_TS_¡»am
(
šput
,

659 
TS_wr™”_p
 
tswr™”
,

660 cÚ¡ 
t¥Ïy_ouut_·û_mode
 
·û_mode
,

661 
ušt32_t
 
pid_to_ignÜe
,

662 
ušt32_t
 
ov”ride_pü_pid
,

663 
max
,

664 
loİ
,

665 
qu›t
,

666 
v”bo£
)

668 
”r
;

669 
TS_»ad”_p
 
t¤—d”
;

671 
”r
 = 
	`bud_TS_»ad”
(
šput
,&
t¤—d”
);

672 ià(
”r
)  1;

674 
	`åršt_msg
("·û_mode=%d\n", 
·û_mode
);

676 ià(
·û_mode
 =ğ
TSPLAY_OUTPUT_PACE_PCR1
)

677 
”r
 = 
	`¶ay_bufã»d_TS_·ck‘s
(
t¤—d”
,
tswr™”
,
pid_to_ignÜe
,

678 
ov”ride_pü_pid
,
max
,
loİ
,
qu›t
,
v”bo£
);

680 
”r
 = 
	`¶ay_TS_·ck‘s
(
t¤—d”
, 
tswr™”
, 
·û_mode
, 
pid_to_ignÜe
,

681 
max
,
loİ
,
qu›t
,
v”bo£
);

682 ià(
”r
)

684 
	`ä“_TS_»ad”
(&
t¤—d”
);

688 
	`ä“_TS_»ad”
(&
t¤—d”
);

690 
	}
}

734 
	$¶ay_PS_¡»am
(
šput
,

735 
TS_wr™”_p
 
ouut
,

736 
·d_¡¬t
,

737 
´og¿m_»³©
,

738 
fÜû_¡»am_ty³
,

739 
wªt_h262
,

740 
šput_is_dvd
,

741 
video_¡»am
,

742 
audio_¡»am
,

743 
wªt_ac3_audio
,

744 
wªt_dŞby_as_dvb
,

745 
ušt32_t
 
pmt_pid
,

746 
ušt32_t
 
pü_pid
,

747 
ušt32_t
 
video_pid
,

748 
k“p_audio
,

749 
ušt32_t
 
audio_pid
,

750 
max
,

751 
loİ
,

752 
v”bo£
,

753 
qu›t
)

755 
”r
;

756 
is_h264
;

757 
PS_»ad”_p
 
ps
;

759 
”r
 = 
	`bud_PS_»ad”
(
šput
,
qu›t
,&
ps
);

760 ià(
”r
)

762 
	`´št_”r
("### Error building PS„eader for input\n");

766 ià(
fÜû_¡»am_ty³
)

768 
is_h264
 = !
wªt_h262
;

769 ià(!
qu›t
)

770 
	`åršt_msg
("R—dšg iÅuˆa %s\n",(
wªt_h262
?"MPEG-2 (H.262)":

775 
”r
 = 
	`d‘”mše_if_PS_is_h264
(
ps
,&
is_h264
);

776 ià(
”r
)  1;

778 ià(!
qu›t
)

779 
	`åršt_msg
("Video‡ppearso be %s\n",

780 (
is_h264
?"MPEG-4/AVC (H.264)":"MPEG-2 (H.262)"));

783 
”r
 = 
	`ps_to_ts
(
ps
,
ouut
,
·d_¡¬t
,
´og¿m_»³©
,

784 
is_h264
,
šput_is_dvd
,

785 
video_¡»am
,
audio_¡»am
,
wªt_ac3_audio
,

786 
wªt_dŞby_as_dvb
,
pmt_pid
,
pü_pid
,

787 
video_pid
,
k“p_audio
,
audio_pid
,
max
,
v”bo£
,
qu›t
);

789 ià(
”r
)

791 ià(
loİ
)

792 
	`´št_”r
("!!! Ignoringƒrror‡nd†ooping\n");

795 
	`ä“_PS_»ad”
(&
ps
);

800 ià(
loİ
)

804 ià(!
qu›t
è
	`´št_msg
("Rewinding‡nd continuing\n");

805 
”r
 = 
	`»wšd_´og¿m_¡»am
(
ps
);

806 ià(
”r
)

808 
	`´št_”r
("### Error„ewinding\n");

809 
	`ä“_PS_»ad”
(&
ps
);

812 
”r
 = 
	`ps_to_ts
(
ps
,
ouut
,
·d_¡¬t
,
´og¿m_»³©
,

813 
is_h264
,
šput_is_dvd
,

814 
video_¡»am
,
audio_¡»am
,
wªt_ac3_audio
,

815 
wªt_dŞby_as_dvb
,
pmt_pid
,
pü_pid
,

816 
video_pid
,
k“p_audio
,
audio_pid
,
max
,
FALSE
,
TRUE
);

817 ià(
”r
)

819 ià(
loİ
)

820 
	`´št_”r
("!!! Ignoringƒrror‡nd†ooping\n");

823 
	`ä“_PS_»ad”
(&
ps
);

830 
	}
}

	@tsreport.c

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<fú.h
>

34 
	~<lim™s.h
>

36 #ifdeà
_WIN32


37 
	~<¡ddef.h
>

39 
	~<uni¡d.h
>

42 
	~"com·t.h
"

43 
	~"ts_âs.h
"

44 
	~"³s_âs.h
"

45 
	~"misc_âs.h
"

46 
	~"´štšg_âs.h
"

47 
	~"pidšt_âs.h
"

48 
	~"fmtx.h
"

49 
	~"v”siÚ.h
"

51 
	#AV_COUNT
 2

	)

54 
	#INVALID_PID
 0x2000

	)

56 
	gtfmt_diff
 = 
FMTX_TS_DISPLAY_90kHz_RAW
;

57 
	gtfmt_abs
 = 
FMTX_TS_DISPLAY_90kHz_RAW
;

59 
ušt64_t


60 
	$e¡im©e_pü
(
off£t_t
 
po¢
, 
ušt64_t
 
µü_pos
, ušt64_ˆ
µü_v®
, 
pü_¿‹
)

62  (
ušt64_t
)(
µü_v®
 + (27000000.0 * ()(
po¢
 - 
µü_pos
))/
pü_¿‹
);

63 
	}
}

68 
	sdiff_äom_pü


70 
št64_t
 
	mmš
;

71 
ušt64_t
 
	mmš_©
;

72 
off£t_t
 
	mmš_po¢
;

73 
št64_t
 
	mmax
;

74 
ušt64_t
 
	mmax_©
;

75 
off£t_t
 
	mmax_po¢
;

76 
št64_t
 
	msum
;

77 
	mnum
;

80 
	savg_¿‹_–ss


82 
ušt64_t
 
	mtime
;

83 
ušt64_t
 
	mby‹s
;

84 } 
	tavg_¿‹_–_t
;

86 
	savg_¿‹ss


88 
	mmax_–s
;

89 
	mš_–
;

90 
	mout_–
;

91 
avg_¿‹_–_t
 * 
	m–s
;

92 
ušt64_t
 
	mmax_¿‹
;

93 } 
	tavg_¿‹_t
;

95 
	s¡»am_d©a
 {

96 
ušt32_t
 
	mpid
;

97 
	m¡»am_ty³
;

98 
	mhad_a_±s
;

99 
	mhad_a_dts
;

100 
	mfœ¡_cc
;

101 
	mÏ¡_cc
;

102 
	mcc_dup_couÁ
;

103 
	mdiscÚtšu™y_æag_couÁ
;

105 
ušt64_t
 
	mfœ¡_±s
;

106 
ušt64_t
 
	mfœ¡_dts
;

110 
ušt64_t
 
	m±s
;

111 
ušt64_t
 
	mdts
;

112 
ušt64_t
 
	mpü
;

114 
	m”r_±s_É_dts
;

115 
	m”r_dts_É_´ev_dts
;

116 
	m”r_dts_É_pü
;

117 
	m”r_cc_”rÜ
;

118 
	m”r_cc_dup_”rÜ
;

119 
	m”r_cc_cÚ‹Ás
;

120 
	mcc_good
;

122 
diff_äom_pü
 
	mpü_±s_diff
;

123 
diff_äom_pü
 
	mpü_dts_diff
;

126 
	mdts_dts_mš
;

127 
	mdts_dts_max
;

129 
	m±s_Ã_dts
;

131 
	mpü_£’
;

132 
ušt64_t
 
	mfœ¡_pü
;

133 
ušt64_t
 
	mts_by‹s
;

134 
avg_¿‹_t
 
	m¿‹
;

136 
ušt8_t
 
	mÏ¡_pkt
[188];

139 
	$pid_šdex
(
¡»am_d©a
 *
d©a
,

140 
num_¡»ams
,

141 
ušt32_t
 
pid
)

143 
ii
;

144 
ii
=0; ii<
num_¡»ams
; ii++)

145 ià(
d©a
[
ii
].
pid
 ==…id)

146  
ii
;

148 
	}
}

151 
	$avg_¿‹_šc
(
avg_¿‹_t
 * 
¬
, 
n
)

153  
n
 + 1 >ğ
¬
->
max_–s
 ? 0 :‚ + 1;

154 
	}
}

157 
	$avg_¿‹_add
(
avg_¿‹_t
 * 
¬
, 
ušt64_t
 
time
, ušt64_ˆ
by‹s
)

159 
ušt64_t
 
g­
 = 27000000 / 2;

160 
ušt64_t
 
d–_b
;

161 
ušt64_t
 
d–_t
;

162 
ušt64_t
 
¿‹
;

164 ià(
¬
->
–s
 =ğ
NULL
)

166 
¬
->
max_–s
 = 1024;

167 
¬
->
–s
 = 
	`ÿÎoc
×r->
max_–s
, (ar->els[0]));

170 
¬
->
š_–
 !ğ¬->
out_–
 && 
	`pü_unsigÃd_diff
(
time
,‡r->
–s
[¬->out_–].timeè> 
g­
)

172 
¬
->
out_–
 = 
	`avg_¿‹_šc
(ar,‡r->out_el);

175 
¬
->
–s
[¬->
š_–
].
time
 =ime;

176 
¬
->
–s
[¬->
š_–
].
by‹s
 = bytes;

178 
d–_b
 = 
by‹s
 - 
¬
->
–s
[¬->
out_–
].bytes;

179 
d–_t
 = 
	`pü_unsigÃd_diff
(
time
, 
¬
->
–s
[¬->
out_–
].time);

181 ià(
d–_t
 != 0)

183 
¿‹
 = (
d–_b
 * 8LL * 27000000LLè/ 
d–_t
;

184 ià(
¿‹
 > 
¬
->
max_¿‹
)

186 
¬
->
max_¿‹
 = 
¿‹
;

190 
¬
->
š_–
 = 
	`avg_¿‹_šc
(ar,‡r->in_el);

191 
	}
}

200 
	$»pÜt_bufãršg_¡©s
(
TS_»ad”_p
 
t¤—d”
,

201 cÚ¡ 
»q_´og_no
,

202 
max
,

203 
v”bo£
,

204 
qu›t
,

205 *
ouut_Çme
,

206 
ušt32_t
 
cÚtšu™y_út_pid
,

207 
ušt64_t
 
»pÜt_mask
)

209 
pmt_p
 
pmt
 = 
NULL
;

210 
”r
;

211 
FILE
 *
fe
 = 
NULL
;

212 
num_¡»ams
 = 0;

213 
FILE
 *
fe_út
 = 
NULL
;

220 
	#MAX_NUM_STREAMS
 100

	)

222 
¡»am_d©a
 
¡©s
[
MAX_NUM_STREAMS
];

228 
	slš—r_´ediùiÚ_d©a
 {

229 
had_a_pü
;

230 
ušt64_t
 
´ev_pü
;

231 
off£t_t
 
´ev_pü_po¢
;

232 
pü_¿‹
;

233 
know_pü_¿‹
;

234 
št64_t
 
mš_pü_”rÜ
;

235 
št64_t
 
max_pü_”rÜ
;

237 
lš—r_´ediùiÚ_d©a
 
´ediù
 = {0};

239 
ušt32_t
 
pü_pid
;

240 
ušt64_t
 
fœ¡_pü
 = 0;

241 
off£t_t
 
fœ¡_pü_po¢
 = 0;

242 
pmt_©
 = 0;

243 
šdex
;

244 
ii
;

246 
pü_couÁ
 = 0;

247 
ušt64_t
 
max_pü_g­
 = 0;

248 
bad_pü_g­_couÁ
 = 0;

250 
fœ¡
 = 
TRUE
;

251 
off£t_t
 
po¢
 = 0;

252 
off£t_t
 
¡¬t_po¢
 = 0;

253 
ušt32_t
 
couÁ
 = 0;

254 
ušt32_t
 
¡¬t_couÁ
 = 0;

256 
	`mem£t
(
¡©s
,0,(stats));

257 
ii
=0; ii<
MAX_NUM_STREAMS
; ii++)

259 
¡©s
[
ii
].
pü_±s_diff
.
mš
 = 
LONG_MAX
;

260 
¡©s
[
ii
].
pü_dts_diff
.
mš
 = 
LONG_MAX
;

261 
¡©s
[
ii
].
pü_±s_diff
.
max
 = 
LONG_MIN
;

262 
¡©s
[
ii
].
pü_dts_diff
.
max
 = 
LONG_MIN
;

263 
¡©s
[
ii
].
dts_dts_mš
 = 
LONG_MAX
;

264 
¡©s
[
ii
].
dts_dts_max
 = 
LONG_MIN
;

265 
¡©s
[
ii
].
fœ¡_pü
 = ~(
ušt64_t
)0;

266 
¡©s
[
ii
].
Ï¡_cc
 = -1;

267 
¡©s
[
ii
].
fœ¡_cc
 = -1;

269 
´ediù
.
mš_pü_”rÜ
 = 
LONG_MAX
;

270 
´ediù
.
max_pü_”rÜ
 = 
LONG_MIN
;

272 ià(
ouut_Çme
)

274 
fe
 = 
	`fİ’
(
ouut_Çme
,"w");

275 ià(
fe
 =ğ
NULL
)

277 
	`åršt_”r
("###sreport: Unableo open file %s: %s\n",

278 
ouut_Çme
,
	`¡»¼Ü
(
”ºo
));

281 
	`åršt_msg
("Wr™šg CSV d©¨tØf%s\n",
ouut_Çme
);

282 
	`årštf
(
fe
,"#TSoffset,calc|read,PCR/300,stream,audio|video,PTS,DTS,ESCR\n");

286 
”r
 = 
	`fšd_pmt
(
t¤—d”
, 
»q_´og_no
, 
max
,
FALSE
,
qu›t
,&
pmt_©
,&
pmt
);

287 ià(
”r
)  1;

289 
pü_pid
 = 
pmt
->
PCR_pid
;

292 
”r
 = 
	`´ime_»ad_bufã»d_TS_·ck‘
(
t¤—d”
,
pü_pid
);

293 ià(
”r
)  1;

295 
ii
=0; ii<
pmt
->
num_¡»ams
; ii++)

297 
ušt32_t
 
pid
 = 
pmt
->
¡»ams
[
ii
].
–em’ry_PID
;

298 ià(
ii
 >ğ
MAX_NUM_STREAMS
)

300 
	`åršt_msg
("!!! Found morehan %d streams -- just„eporting onhe first %d found\n",

301 
MAX_NUM_STREAMS
,MAX_NUM_STREAMS);

304 ià(
pid
 >= 0x10 &&…id <= 0x1FFE)

306 
¡©s
[
num_¡»ams
].
¡»am_ty³
 = 
pmt
->
¡»ams
[
ii
].stream_type;

307 
¡©s
[
num_¡»ams
].
pid
 =…id;

308 
num_¡»ams
 ++;

312 
	`åršt_msg
("Lookšg‡ˆPCR PID %04x (%d)\n",
pü_pid
,pcr_pid);

313 
ii
=0; ii<
num_¡»ams
; ii++)

314 
	`åršt_msg
(" SŒ—m %d: PID %04x (%d), %s\n",
ii
,
¡©s
[ii].
pid
,stats[ii].pid,

315 
	`h222_¡»am_ty³_¡r
(
¡©s
[
ii
].
¡»am_ty³
));

318 
¡¬t_couÁ
 = 
couÁ
 = 
pmt_©
;

319 
¡¬t_po¢
 = 
po¢
 = 
t¤—d”
->po¢ - 
TS_PACKET_SIZE
;

321 ià(
cÚtšu™y_út_pid
 !ğ
INVALID_PID
)

323 
fe_út
 = 
	`fİ’
("continuity_counter.txt","w");

324 ià(
fe_út
 =ğ
NULL
)

326 
	`´št_”r
("###sreport: Unableo open file continuity_counter.txt\n");

332 
ušt32_t
 
pid
;

333 
·ylßd_un™_¡¬t_šdiÿtÜ
;

334 
by‹
 *
·ck‘
;

335 
by‹
 *
ad­t
, *
·ylßd
;

336 
ad­t_Ën
, 
·ylßd_Ën
;

337 
gÙ_pü
 = 
FALSE
;

338 
ušt64_t
 
acc_pü
 = 0;

340 ià(
max
 > 0 && 
couÁ
 >ğ(
ušt32_t
)max)

342 
	`åršt_msg
("Stİpšg‡á” %d…ack‘ (PMT wa © %d)\n",
max
,
pmt_©
);

348 ià(
fœ¡
)

350 
”r
 = 
	`»ad_fœ¡_TS_·ck‘_äom_bufãr
(
t¤—d”
,
pü_pid
,
¡¬t_couÁ
,

351 &
·ck‘
,&
pid
,&
acc_pü
,&
couÁ
);

352 
po¢
 = 
¡¬t_po¢
 + (
couÁ
-
¡¬t_couÁ
)*
TS_PACKET_SIZE
;

353 
fœ¡
 = 
FALSE
;

357 
”r
 = 
	`»ad_Ãxt_TS_·ck‘_äom_bufãr
(
t¤—d”
,&
·ck‘
,&
pid
,&
acc_pü
);

358 
couÁ
 ++;

359 
po¢
 +ğ
TS_PACKET_SIZE
;

361 ià(
”r
 =ğ
EOF
)

363 ià(
”r
)

365 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘ %d‡ˆ" 
OFFSET_T_FORMAT


366 "\n",
couÁ
,
po¢
);

370 
”r
 = 
	`¥l™_TS_·ck‘
(
·ck‘
,&
pid
,

371 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

372 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

373 ià(
”r
)

375 
	`åršt_”r
("### E¼Ü s¶™tšg TS…ack‘ %d‡ˆ" 
OFFSET_T_FORMAT


376 "\n",
couÁ
,
po¢
);

382 ià(
pid
 =ğ
pü_pid
)

384 
ušt64_t
 
ad­t_pü
;

387 
	`g‘_PCR_äom_ad­tiÚ_f›ld
(
ad­t
,
ad­t_Ën
,&
gÙ_pü
,&
ad­t_pü
);

388 ià(
gÙ_pü
)

390 ++
pü_couÁ
;

392 ià(
´ediù
.
know_pü_¿‹
)

396 
ušt64_t
 
guess_pü
 = 
	`e¡im©e_pü
(
po¢
,
´ediù
.
´ev_pü_po¢
,

397 
´ediù
.
´ev_pü
,´ediù.
pü_¿‹
);

398 
št64_t
 
d–
 = 
	`pü_sigÃd_diff
(
ad­t_pü
, 
guess_pü
);

399 ià(
d–
 < 
´ediù
.
mš_pü_”rÜ
)

400 
´ediù
.
mš_pü_”rÜ
 = 
d–
;

401 ià(
d–
 > 
´ediù
.
max_pü_”rÜ
)

402 
´ediù
.
max_pü_”rÜ
 = 
d–
;

405 ià(
v”bo£
)

406 
	`åršt_msg
(
OFFSET_T_FORMAT_8
 ":„ead PCR %s\n",

407 
po¢
,

408 
	`fmtx_time¡amp
(
ad­t_pü
, 
tfmt_abs
 | 
FMTX_TS_N_27MHz
));

409 ià(
fe
)

410 
	`årštf
(
fe
,
OFFSET_T_FORMAT
 ",»ad," 
LLU_FORMAT
 ",,,,\n",

411 
po¢
,(
ad­t_pü
 / (
ušt64_t
)300è& 
»pÜt_mask
);

413 ià(
´ediù
.
had_a_pü
)

415 ià(
	`pü_sigÃd_diff
(
´ediù
.
´ev_pü
, 
ad­t_pü
) > 0)

417 
	`åršt_”r
("!!! PCR %s‡t TS…acket "

418 
OFFSET_T_FORMAT
 " is‚ot morehan…revious PCR %s\n",

419 
	`fmtx_time¡amp
(
ad­t_pü
, 
tfmt_abs
 | 
FMTX_TS_N_27MHz
),

420 
po¢
,

421 
	`fmtx_time¡amp
(
´ediù
.
´ev_pü
, 
tfmt_abs
 | 
FMTX_TS_N_27MHz
));

425 
ušt64_t
 
d–_pü
 = 
	`pü_unsigÃd_diff
(
ad­t_pü
, 
´ediù
.
´ev_pü
);

426 
d–_by‹s
 = ()(
po¢
 - 
´ediù
.
´ev_pü_po¢
);

427 
´ediù
.
pü_¿‹
 = (()
d–_by‹s
 * 27.0 / ()
d–_pü
) * 1000000.0;

428 
´ediù
.
know_pü_¿‹
 = 
TRUE
;

430 ià(
d–_pü
 > 
max_pü_g­
)

431 
max_pü_g­
 = 
d–_pü
;

433 ià(
d–_pü
 > 27000000 / 10)

435 ià(
bad_pü_g­_couÁ
++ == 0)

436 
	`åršt_”r
("!!! PCR gap of %s @ PCR %s > 0.1sec...\n",

437 
	`fmtx_time¡amp
(
d–_pü
, 
tfmt_diff
 | 
FMTX_TS_N_27MHz
),

438 
	`fmtx_time¡amp
(
ad­t_pü
, 
tfmt_abs
 | 
FMTX_TS_N_27MHz
));

442 
	`åršt_msg
("PCR RATE = %f, DELTA_BYTES = %d, DELTA_PCR " 
LLU_FORMAT


443 ", PCR = " 
LLU_FORMAT
 "\n",

444 
´ediù
.
pü_¿‹
,
d–_by‹s
,
d–_pü
,
ad­t_pü
);

450 ià(!
qu›t
)

451 
	`åršt_msg
("Fœ¡ PCR‡ˆ" 
OFFSET_T_FORMAT
 "\n",
po¢
);

452 
fœ¡_pü
 = 
ad­t_pü
;

453 
fœ¡_pü_po¢
 = 
po¢
;

454 
´ediù
.
had_a_pü
 = 
TRUE
;

456 
´ediù
.
´ev_pü
 = 
ad­t_pü
;

457 
´ediù
.
´ev_pü_po¢
 = 
po¢
;

461 
i
;

462 
i
 = 0; i !ğ
num_¡»ams
; ++i)

464 
¡©s
[
i
].
pü_£’
 = 
TRUE
;

470 
šdex
 = 
	`pid_šdex
(
¡©s
,
num_¡»ams
,
pid
);

472 ià(
šdex
 != -1)

475 cÚ¡ 
cc
 = 
·ck‘
[3] & 15;

476 cÚ¡ 
is_discÚtšu™y
 = (
ad­t
 !ğ
NULL
 && (adapt[0] & 0x80) != 0);

477 
¡»am_d©a
 * cÚ¡ 
ss
 = 
¡©s
 + 
šdex
;

480 ià(
cÚtšu™y_út_pid
 =ğ
pid
)

481 
	`årštf
(
fe_út
, "%d%c", 
cc
, cc == 15 ? '\n' : ' ');

484 
ss
->
discÚtšu™y_æag_couÁ
 +ğ
is_discÚtšu™y
;

485 ià(
ss
->
fœ¡_cc
 < 0)

486 
ss
->
fœ¡_cc
 = 
cc
;

491 ià(
ss
->
Ï¡_cc
 > 0 && !
is_discÚtšu™y
)

494 ià(
ss
->
Ï¡_cc
 =ğ
cc
)

496 ià(
·ylßd
)

498 ià(
ss
->
cc_dup_couÁ
++ != 0)

500 ià(
cÚtšu™y_út_pid
 =ğ
pid
)

501 
	`årštf
(
fe_út
, "[Duplicateƒrror] ");

502 ià(
ss
->
”r_cc_dup_”rÜ
++ == 0)

504 
	`åršt_msg
("### PID(%d): CÚtšu™y CouÁ” >1 du¶iÿ‹ %d‡ˆ" 
OFFSET_T_FORMAT
 "\n",

505 
ss
->
pid
, 
cc
, 
po¢
);

511 ià(!
gÙ_pü
 ? (
	`memcmp
(
ss
->
Ï¡_pkt
, 
·ck‘
, 188) != 0) :

512 (
	`memcmp
(
ss
->
Ï¡_pkt
, 
·ck‘
, 6) != 0 ||

513 
	`memcmp
(
ss
->
Ï¡_pkt
 + 12, 
·ck‘
 + 12, 188 - 12) != 0))

515 ià(
ss
->
”r_cc_cÚ‹Ás
++ == 0)

516 
	`åršt_msg
("### PID(%d): CÚtšu™y CouÁ” du¶iÿ‹ %d:‚Ú id’tiÿÈcÚ‹Á © " 
OFFSET_T_FORMAT
 "\n",

517 
ss
->
pid
, 
cc
, 
po¢
);

522 cÚ¡ 
ušt8_t
 * 
a
 = 
ss
->
Ï¡_pkt
;

523 cÚ¡ 
ušt8_t
 * 
b
 = 
·ck‘
;

524 
i
;

526 
	`åršt_msg
("CC contents:\n");

528 
i
 = 0; i < 188; i +ğ16, 
a
 +ğ16, 
b
 += 16)

530 
j
;

531 cÚ¡ 
n
 = 
	`mš
(16, 188 - 
i
);

532 
j
 = 0; j < 
n
; ++j)

534 
	`åršt_msg
("%c%02x", 
a
[
j
] =ğ
b
[j] ? ' ' : '*',‡[j]);

536 
	`åršt_msg
("\n");

537 
j
 = 0; j < 
n
; ++j)

539 
	`åršt_msg
("%c%02x", 
a
[
j
] =ğ
b
[j] ? ' ' : '*', b[j]);

541 
	`åršt_msg
("\n\n");

550 ++
ss
->
cc_good
;

558 
ss
->
cc_dup_couÁ
 = 0;

559 ià(
·ylßd
)

561 ià(((
ss
->
Ï¡_cc
 + 1è& 15è!ğ
cc
)

563 ià(
cÚtšu™y_út_pid
 =ğ
pid
)

564 
	`årštf
(
fe_út
, "[Discontinuity] ");

565 ià(
ss
->
”r_cc_”rÜ
++ == 0)

567 
	`åršt_msg
("### PID(%d): CÚtšu™y CouÁ” discÚtšu™y %d->%d‡ˆ" 
OFFSET_T_FORMAT
 "\n",

568 
ss
->
pid
, ss->
Ï¡_cc
, 
cc
, 
po¢
);

575 ià(
cÚtšu™y_út_pid
 =ğ
pid
)

576 
	`årštf
(
fe_út
, "[Discontinuity] ");

577 ià(
ss
->
”r_cc_”rÜ
++ == 0)

579 
	`åršt_msg
("### PID(%d): CÚtšu™y CouÁ” discÚtšu™y %d->%d (buˆnØ·ylßdè© " 
OFFSET_T_FORMAT
 "\n",

580 
ss
->
pid
, ss->
Ï¡_cc
, 
cc
, 
po¢
);

585 
ss
->
Ï¡_cc
 = 
cc
;

586 
	`memıy
(
ss
->
Ï¡_pkt
, 
·ck‘
, 188);

589 ià(
šdex
 != -1)

591 ià(
¡©s
[
šdex
].
pü_£’
)

593 
¡©s
[
šdex
].
pü_£’
 = 
FALSE
;

594 
	`avg_¿‹_add
(&
¡©s
[
šdex
].
¿‹
, 
acc_pü
, sts[šdex].
ts_by‹s
);

596 ià(
¡©s
[
šdex
].
fœ¡_pü
 =ğ~(
ušt64_t
)0)

597 
¡©s
[
šdex
].
fœ¡_pü
 = 
acc_pü
;

598 
¡©s
[
šdex
].
pü
 = 
acc_pü
;

599 
¡©s
[
šdex
].
ts_by‹s
 += 188;

602 ià(
šdex
 !ğ-1 && 
·ylßd
 && 
·ylßd_un™_¡¬t_šdiÿtÜ
)

606 
gÙ_±s
, 
gÙ_dts
;

607 cÚ¡ 
ušt64_t
 
Ï¡_dts
 = 
¡©s
[
šdex
].
dts
;

608 
ušt64_t
 
pü_time_now_div300
 = 0;

609 
št64_t
 
difã»nû
;

610 
”r
 = 
	`fšd_PTS_DTS_š_PES
(
·ylßd
,
·ylßd_Ën
,

611 &
gÙ_±s
,&
¡©s
[
šdex
].
±s
,&
gÙ_dts
,&¡©s[šdex].
dts
);

612 ià(
”r
)

614 
	`åršt_”r
("### PID(%d): Error†ooking for PTS/DTS in TS…acket‡t "

615 
OFFSET_T_FORMAT
 "\n", 
¡©s
[
šdex
].
pid
, 
po¢
);

619 ià(
gÙ_dts
 && !
gÙ_±s
)

621 
	`åršt_”r
("### Got DTS but‚ot PTS, in TS…acket‡t "

622 
OFFSET_T_FORMAT
 "\n",
po¢
);

626 ià(!
gÙ_±s
)

629 
pü_time_now_div300
 = 
acc_pü
/300ULL;

633 ià(
	`±s_sigÃd_diff
(
¡©s
[
šdex
].
±s
, sts[šdex].
dts
) < 0)

635 ià(
¡©s
[
šdex
].
”r_±s_É_dts
++ == 0)

636 
	`åršt_msg
("### PID(%d): PTS (%s) < DTS (%s)\n",

637 
¡©s
[
šdex
].
pid
,

638 
	`fmtx_time¡amp
(
¡©s
[
šdex
].
±s
, 
tfmt_abs
),

639 
	`fmtx_time¡amp
(
¡©s
[
šdex
].
dts
, 
tfmt_abs
));

641 ià(
¡©s
[
šdex
].
had_a_dts
)

643 
št64_t
 
dts_dts_diff
 = 
	`±s_sigÃd_diff
(
¡©s
[
šdex
].
dts
, 
Ï¡_dts
);

644 ià(
dts_dts_diff
 < 
¡©s
[
šdex
].
dts_dts_mš
)

645 
¡©s
[
šdex
].
dts_dts_mš
 = ()
dts_dts_diff
;

646 ià(
dts_dts_diff
 > 
¡©s
[
šdex
].
dts_dts_max
)

647 
¡©s
[
šdex
].
dts_dts_max
 = ()
dts_dts_diff
;

649 ià(
dts_dts_diff
 < 0)

651 ià(
¡©s
[
šdex
].
”r_dts_É_´ev_dts
++ == 0)

652 
	`åršt_msg
("### PID(%d): DTS (%s) <…revious DTS (%s)\n",

653 
¡©s
[
šdex
].
pid
,

654 
	`fmtx_time¡amp
(
¡©s
[
šdex
].
dts
, 
tfmt_abs
),

655 
	`fmtx_time¡amp
(
Ï¡_dts
, 
tfmt_abs
));

658 ià(
	`±s_sigÃd_diff
(
¡©s
[
šdex
].
dts
, 
pü_time_now_div300
) < 0)

660 ià(
¡©s
[
šdex
].
”r_dts_É_pü
++ == 0)

661 
	`åršt_msg
("### PID(%d): DTS (%s) < PCR (%s)\n",

662 
¡©s
[
šdex
].
pid
,

663 
	`fmtx_time¡amp
(
¡©s
[
šdex
].
dts
, 
tfmt_abs
),

664 
	`fmtx_time¡amp
(
acc_pü
, 
tfmt_abs
 | 
FMTX_TS_N_27MHz
));

667 ià(!
¡©s
[
šdex
].
had_a_±s
)

670 
	`åršt_msg
(" Fœ¡ sŒ—m %d PTS (aá” fœ¡ PCRè© " 
OFFSET_T_FORMAT
 "\n",

671 
šdex
,
po¢
);

673 
¡©s
[
šdex
].
fœ¡_±s
 = sts[šdex].
±s
;

674 
¡©s
[
šdex
].
had_a_±s
 = 
TRUE
;

676 ià(
gÙ_dts
 && !
¡©s
[
šdex
].
had_a_dts
)

679 
	`åršt_msg
(" Fœ¡ sŒ—m %d DTS (aá” fœ¡ PCRè© " 
OFFSET_T_FORMAT
 "\n",

680 
šdex
,
po¢
);

682 
¡©s
[
šdex
].
fœ¡_dts
 = sts[šdex].
dts
;

683 
¡©s
[
šdex
].
had_a_dts
 = 
TRUE
;

685 ià(
gÙ_±s
 !ğ
gÙ_dts
 || (gÙ_± && 
¡©s
[
šdex
].
±s
 !ğ¡©s[šdex].
dts
))

686 
¡©s
[
šdex
].
±s_Ã_dts
 = 
TRUE
;

688 ià(
fe
)

691 
gÙ_esü
 = 
FALSE
;

692 
ušt64_t
 
esü
;

693 (è
	`fšd_ESCR_š_PES
(
·ylßd
,
·ylßd_Ën
,&
gÙ_esü
,&
esü
);

695 
	`årštf
(
fe
,
OFFSET_T_FORMAT
 ",%s," 
LLU_FORMAT
 ",%d,%s,",

696 
po¢
,

697 (
pü_pid
 =ğ
pid
 && 
gÙ_pü
)?"read":"calc",

698 
pü_time_now_div300
 & 
»pÜt_mask
,

699 
šdex
,

700 
	`IS_AUDIO_STREAM_TYPE
(
¡©s
[
šdex
].
¡»am_ty³
)?"audio":

701 
	`IS_VIDEO_STREAM_TYPE
(
¡©s
[
šdex
].
¡»am_ty³
)?"video":"");

703 
	`årštf
(
fe
,
LLU_FORMAT
 ",",
¡©s
[
šdex
].
±s
 & 
»pÜt_mask
);

704 ià(
gÙ_dts
)

705 
	`årštf
(
fe
,
LLU_FORMAT
,
¡©s
[
šdex
].
dts
 & 
»pÜt_mask
);

707 
	`årštf
(
fe
,
LLU_FORMAT
,
¡©s
[
šdex
].
±s
 & 
»pÜt_mask
);

708 
	`årštf
(
fe
,",");

709 ià(
gÙ_esü
)

711 ià(!
qu›t
)

712 
	`åršt_msg
("Found ESCR " 
LLU_FORMAT
 "‡ˆ" 
OFFSET_T_FORMAT
 "\n",

713 
esü
,
po¢
);

714 
	`årštf
(
fe
,
LLU_FORMAT
,
esü
 & 
»pÜt_mask
);

716 
	`årštf
(
fe
, ",%u", (
·ylßd
[4] << 8) |…ayload[5]);

717 
	`årštf
(
fe
,"\n");

720 ià(
v”bo£
)

722 
	`åršt_msg
(
OFFSET_T_FORMAT_8
 ": % PCR " 
LLU_FORMAT
 " %d %5s",

723 
po¢
,

724 (
pü_pid
 =ğ
pid
 && 
gÙ_pü
)?" ":"calc",

725 
pü_time_now_div300
,

726 
šdex
,

727 
	`IS_AUDIO_STREAM_TYPE
(
¡©s
[
šdex
].
¡»am_ty³
)?"audio":

728 
	`IS_VIDEO_STREAM_TYPE
(
¡©s
[
šdex
].
¡»am_ty³
)?"video":"");

731 
difã»nû
 = 
	`±s_sigÃd_diff
(
¡©s
[
šdex
].
±s
, 
pü_time_now_div300
);

732 ià(
v”bo£
)

734 
	`åršt_msg
(" PTS " 
LLU_FORMAT
,
¡©s
[
šdex
].
±s
);

735 
	`´št_msg
(" PTS-PCR ");

736 
	`åršt_msg
(
LLD_FORMAT
, 
difã»nû
);

738 ià(
difã»nû
 > 
¡©s
[
šdex
].
pü_±s_diff
.
max
)

740 
¡©s
[
šdex
].
pü_±s_diff
.
max
 = 
difã»nû
;

741 
¡©s
[
šdex
].
pü_±s_diff
.
max_©
 = sts[šdex].
±s
;

742 
¡©s
[
šdex
].
pü_±s_diff
.
max_po¢
 = 
po¢
;

744 ià(
difã»nû
 < 
¡©s
[
šdex
].
pü_±s_diff
.
mš
)

746 
¡©s
[
šdex
].
pü_±s_diff
.
mš
 = 
difã»nû
;

747 
¡©s
[
šdex
].
pü_±s_diff
.
mš_©
 = sts[šdex].
±s
;

748 
¡©s
[
šdex
].
pü_±s_diff
.
mš_po¢
 = 
po¢
;

750 
¡©s
[
šdex
].
pü_±s_diff
.
sum
 +ğ
difã»nû
;

751 
¡©s
[
šdex
].
pü_±s_diff
.
num
 ++;

753 ià(
gÙ_dts
)

755 
difã»nû
 = 
	`±s_sigÃd_diff
(
¡©s
[
šdex
].
dts
, 
pü_time_now_div300
);

756 ià(
v”bo£
)

758 
	`åršt_msg
(" DTS " 
LLU_FORMAT
,
¡©s
[
šdex
].
dts
);

759 
	`´št_msg
(" DTS-PCR ");

760 
	`åršt_msg
(
LLD_FORMAT
, 
difã»nû
 & 
»pÜt_mask
);

762 ià(
difã»nû
 > 
¡©s
[
šdex
].
pü_dts_diff
.
max
)

764 
¡©s
[
šdex
].
pü_dts_diff
.
max
 = 
difã»nû
;

765 
¡©s
[
šdex
].
pü_dts_diff
.
max_©
 = sts[šdex].
dts
;

766 
¡©s
[
šdex
].
pü_dts_diff
.
max_po¢
 = 
po¢
;

768 ià(
difã»nû
 < 
¡©s
[
šdex
].
pü_dts_diff
.
mš
)

770 
¡©s
[
šdex
].
pü_dts_diff
.
mš
 = 
difã»nû
;

771 
¡©s
[
šdex
].
pü_dts_diff
.
mš_©
 = sts[šdex].
dts
;

772 
¡©s
[
šdex
].
pü_dts_diff
.
mš_po¢
 = 
po¢
;

774 
¡©s
[
šdex
].
pü_dts_diff
.
sum
 +ğ
difã»nû
;

775 
¡©s
[
šdex
].
pü_dts_diff
.
num
 ++;

778 ià(
v”bo£
)

779 
	`´št_msg
("\n");

783 ià(
cÚtšu™y_út_pid
 !ğ
INVALID_PID
)

785 
	`årštf
(
fe_út
, "\n");

786 
	`fşo£
(
fe_út
);

789 ià(!
qu›t
)

790 
	`åršt_msg
("La¡ PCR‡ˆ" 
OFFSET_T_FORMAT
 "\n",
´ediù
.
´ev_pü_po¢
);

791 
	`åršt_msg
("R—d %d TS…ack‘%s\n",
couÁ
,(count==1?"":"s"));

792 ià(
pmt
è
	`ä“_pmt
(&pmt);

793 ià(
fe
è
	`fşo£
(file);

794 ià(
´ediù
.
had_a_pü
 &&…»diù.
´ev_pü_po¢
 > 
fœ¡_pü_po¢
)

797 
¿‹
 = ()((
´ediù
.
´ev_pü_po¢
 - 
fœ¡_pü_po¢
è* 27000000LL / 
	`pü_unsigÃd_diff
Õ»diù.
´ev_pü
, 
fœ¡_pü
)) * 8;

798 
	`åršt_msg
("Ov”®È¡»am„©e=%d b™s/£c\n", 
¿‹
);

801 
	`åršt_msg
("PCRs found: %u, Bad (>.1s) gaps: %u, Max gap: %s\n",

802 
pü_couÁ
, 
bad_pü_g­_couÁ
,

803 
	`fmtx_time¡amp
(
max_pü_g­
, 
tfmt_diff
 | 
FMTX_TS_N_27MHz
));

804 
	`åršt_msg
("Linear PCR…redictionƒrrors: min=%s, max=%s\n",

805 
	`fmtx_time¡amp
(
´ediù
.
mš_pü_”rÜ
, 
tfmt_diff
 | 
FMTX_TS_N_27MHz
),

806 
	`fmtx_time¡amp
(
´ediù
.
max_pü_”rÜ
, 
tfmt_diff
 | 
FMTX_TS_N_27MHz
));

808 
ii
 = 0; i˜< 
num_¡»ams
; ii++)

810 
¡»am_d©a
 * cÚ¡ 
ss
 = 
¡©s
 + 
ii
;

812 
	`åršt_msg
("\nSŒ—m %d: PID %04x (%d), %s\n",
ii
,
ss
->
pid
,ss->pid,

813 
	`h222_¡»am_ty³_¡r
(
ss
->
¡»am_ty³
));

814 ià(
ss
->
pü_±s_diff
.
num
 > 0)

816 
	`åršt_msg
(" PCR/%s:\À Mšimum difã»nû wa %6 © DTS %8s, TS…ack‘‡ˆ" 
OFFSET_T_FORMAT_8
 "\n",

817 
ss
->
±s_Ã_dts
 ? "PTS" : "PTS,DTS",

818 
	`fmtx_time¡amp
(
ss
->
pü_±s_diff
.
mš
, 
tfmt_diff
),

819 
	`fmtx_time¡amp
(
ss
->
pü_±s_diff
.
mš_©
, 
tfmt_abs
),

820 
ss
->
pü_±s_diff
.
mš_po¢
);

821 
	`åršt_msg
(" Maximum difã»nû wa %6 © DTS %8s, TS…ack‘‡ˆ" 
OFFSET_T_FORMAT_8
 "\n",

822 
	`fmtx_time¡amp
(
ss
->
pü_±s_diff
.
max
, 
tfmt_diff
),

823 
	`fmtx_time¡amp
(
ss
->
pü_±s_diff
.
max_©
, 
tfmt_abs
),

824 
ss
->
pü_±s_diff
.
max_po¢
);

825 
	`åršt_msg
(" i.e.,‡ span of %s\n",

826 
	`fmtx_time¡amp
(
ss
->
pü_±s_diff
.
max
 - ss->pü_±s_diff.
mš
, 
tfmt_diff
));

827 
	`åršt_msg
(" Mean difference (of %u) is %s\n",

828 
ss
->
pü_±s_diff
.
num
,

829 
	`fmtx_time¡amp
((
št64_t
)(
ss
->
pü_±s_diff
.
sum
/()ss->pü_±s_diff.
num
), 
tfmt_diff
));

832 ià(
ss
->
pü_dts_diff
.
num
 > 0 && ss->
±s_Ã_dts
)

834 
	`åršt_msg
(" PCR/DTS:\À Mšimum difã»nû wa %6 © DTS %8s, TS…ack‘‡ˆ" 
OFFSET_T_FORMAT_8
 "\n",

835 
	`fmtx_time¡amp
(
ss
->
pü_dts_diff
.
mš
, 
tfmt_diff
),

836 
	`fmtx_time¡amp
(
ss
->
pü_dts_diff
.
mš_©
, 
tfmt_abs
),

837 
ss
->
pü_dts_diff
.
mš_po¢
);

838 
	`åršt_msg
(" Maximum difã»nû wa %6 © DTS %8s, TS…ack‘‡ˆ" 
OFFSET_T_FORMAT_8
 "\n",

839 
	`fmtx_time¡amp
(
ss
->
pü_dts_diff
.
max
, 
tfmt_diff
),

840 
	`fmtx_time¡amp
(
ss
->
pü_dts_diff
.
max_©
, 
tfmt_abs
),

841 
ss
->
pü_dts_diff
.
max_po¢
);

842 
	`åršt_msg
(" i.e.,‡ span of %s\n",

843 
	`fmtx_time¡amp
(
ss
->
pü_dts_diff
.
max
 - ss->pü_dts_diff.
mš
, 
tfmt_diff
));

844 
	`åršt_msg
(" Mean difference (of %u) is %s\n",

845 
ss
->
pü_dts_diff
.
num
,

846 
	`fmtx_time¡amp
((
št64_t
)(
ss
->
pü_dts_diff
.
sum
/()ss->pü_dts_diff.
num
), 
tfmt_diff
));

848 ià(
ss
->
had_a_dts
)

850 
	`åršt_msg
(" DTS-last DTS: min=%s, max=%s\n",

851 
	`fmtx_time¡amp
(
ss
->
dts_dts_mš
, 
tfmt_diff
),

852 
	`fmtx_time¡amp
(
ss
->
dts_dts_max
, 
tfmt_diff
));

855 
	`åršt_msg
(" First PCR %8s,†ast %8s\n",

856 
	`fmtx_time¡amp
(
fœ¡_pü
, 
tfmt_abs
 | 
FMTX_TS_N_27MHz
),

857 
	`fmtx_time¡amp
(
´ediù
.
´ev_pü
, 
tfmt_abs
 | 
FMTX_TS_N_27MHz
));

858 ià(
ss
->
pü_±s_diff
.
num
 > 0)

859 
	`åršt_msg
(" First PTS %8s,†ast %8s\n",

860 
	`fmtx_time¡amp
(
ss
->
fœ¡_±s
, 
tfmt_abs
),

861 
	`fmtx_time¡amp
(
ss
->
±s
, 
tfmt_abs
));

862 ià(
ss
->
pü_dts_diff
.
num
 > 0)

863 
	`åršt_msg
(" First DTS %8s,†ast %8s\n",

864 
	`fmtx_time¡amp
(
ss
->
fœ¡_dts
, 
tfmt_abs
),

865 
	`fmtx_time¡amp
(
ss
->
dts
, 
tfmt_abs
));

869 
ušt64_t
 
avg
 = 
ss
->
pü
 =ğss->
fœ¡_pü
 ? 0LL :

870 ((
ss
->
ts_by‹s
 - 188LLè* 8LL * 27000000LLè/ 
	`pü_unsigÃd_diff
(ss->
pü
, ss->
fœ¡_pü
);

871 
	`åršt_msg
(" SŒ—m: %Îu by‹s;„©e:‡vg %Îu b™s/s, max %Îu b™s/s\n", 
ss
->
ts_by‹s
, 
avg
, ss->
¿‹
.
max_¿‹
);

873 ià(
ss
->
discÚtšu™y_æag_couÁ
 != 0)

874 
	`åršt_msg
(" DiscÚtšu™y fÏgs: *%d", 
ss
->
discÚtšu™y_æag_couÁ
);

875 
	`åršt_msg
(" CC: fœ¡: %d,†a¡: %d; du¶iÿ‹…ack‘s: %d\n", 
ss
->
fœ¡_cc
, ss->
Ï¡_cc
, ss->
cc_good
);

877 ià(
ss
->
”r_cc_”rÜ
 != 0)

878 
	`åršt_msg
(" ### CCƒ¼Ü * %d\n", 
ss
->
”r_cc_”rÜ
);

879 ià(
ss
->
”r_cc_cÚ‹Ás
 != 0)

880 
	`åršt_msg
(" ### CC cÚ‹Á ”rÜ * %d\n", 
ss
->
”r_cc_cÚ‹Ás
);

881 ià(
ss
->
”r_cc_dup_”rÜ
 != 0)

882 
	`åršt_msg
(" ### CC du¶iÿ‹ƒ¼Ü * %d\n", 
ss
->
”r_cc_dup_”rÜ
);

883 ià(
ss
->
”r_±s_É_dts
 != 0)

884 
	`åršt_msg
(" ### PTS < DTS * %d\n", 
ss
->
”r_±s_É_dts
);

885 ià(
ss
->
”r_dts_É_´ev_dts
 != 0)

886 
	`åršt_msg
(" ### DTS <…»v DTS * %d\n", 
ss
->
”r_dts_É_´ev_dts
);

887 ià(
ss
->
”r_dts_É_pü
 != 0)

888 
	`åršt_msg
(" ### DTS < PCR * %d\n", 
ss
->
”r_dts_É_pü
);

891 
	}
}

898 
	$»pÜt_ts
(
TS_»ad”_p
 
t¤—d”
,

899 
max
,

900 
v”bo£
,

901 
show_d©a
,

902 
»pÜt_timšg
)

904 
timšg
 
times
 = {0};

905 
pidšt_li¡_p
 
´og_li¡
 = 
NULL
;

906 
pmt_p
 
pmt
 = 
NULL
;

907 
”r
;

908 
couÁ
 = 0;

909 
timšg_p
 
time_±r
 = 
NULL
;

911 
by‹
 *
·t_d©a
 = 
NULL
;

912 
·t_d©a_Ën
 = 0;

913 
·t_d©a_u£d
 = 0;

915 
ušt32_t
 
unfšished_pmt_pid
 = 0;

916 
by‹
 *
pmt_d©a
 = 
NULL
;

917 
pmt_d©a_Ën
 = 0;

918 
pmt_d©a_u£d
 = 0;

920 ià(
»pÜt_timšg
)

921 
time_±r
 = &
times
;

925 
ušt32_t
 
pid
;

926 
·ylßd_un™_¡¬t_šdiÿtÜ
;

927 
by‹
 *
ad­t
, *
·ylßd
;

928 
ad­t_Ën
, 
·ylßd_Ën
;

930 ià(
max
 > 0 && 
couÁ
 >= max)

932 
	`åršt_msg
("Stİpšg‡á” %d…ack‘s\n",
max
);

936 
”r
 = 
	`g‘_Ãxt_TS_·ck‘
(
t¤—d”
,&
pid
,

937 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

938 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

939 ià(
”r
 =ğ
EOF
)

941 ià(
”r
)

943 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘ %d‡ˆ" 
OFFSET_T_FORMAT


944 "\n",
couÁ
,
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

945 
	`ä“_pidšt_li¡
(&
´og_li¡
);

946 ià(
pmt_d©a
è
	`ä“
(pmt_data);

950 
couÁ
 ++;

952 ià(
v”bo£
)

953 
	`åršt_msg
(
OFFSET_T_FORMAT_8
 ": TS Packet %2d PID %04x%s",

954 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
,
couÁ
,
pid
,

955 (
·ylßd_un™_¡¬t_šdiÿtÜ
?" [pusi]":""));

958 ià(
v”bo£
)

960 ià(
pid
 == 0x1fff)

961 
	`´št_msg
(" PADDING - ignored\n");

962 ià(
pid
 == 0x0000)

963 
	`´št_msg
(" PAT\n");

964 ià(
pid
 == 0x0001)

965 
	`´št_msg
(" Conditional Access Table - ignored\n");

966 ià(
pid
 >= 0x0002 &&…id <= 0x000F)

967 
	`´št_msg
(" RESERVED - ignored\n");

968 ià(
	`pid_š_pidšt_li¡
(
´og_li¡
,
pid
))

969 
	`´št_msg
(" PMT\n");

970 ià(
	`pid_š_pmt
(
pmt
,
pid
))

972 
pmt_¡»am_p
 
¡»am
 = 
	`pid_¡»am_š_pmt
(
pmt
,
pid
);

973 ià(
¡»am
 =ğ
NULL
)

975 
	`åršt_”r
("### Internalƒrror: stream for PID %0x„eturned NULL"

976 " iÀPMT\n",
pid
);

977 
	`»pÜt_pmt
(
FALSE
," ",
pmt
);

978 
	`ä“_pidšt_li¡
(&
´og_li¡
);

979 
	`ä“_pmt
(&
pmt
);

980 ià(
pmt_d©a
è
	`ä“
(pmt_data);

983 
	`åršt_msg
(" streamype %02x (%s)\n",

984 
¡»am
->
¡»am_ty³
,
	`h222_¡»am_ty³_¡r
(stream->stream_type));

987 
	`´št_msg
(" streamype‚ot identified\n");

991 ià(
pid
 == 0x1fff)

996 ià(
pid
 == 0x0001)

999 ià(
»pÜt_timšg
)

1000 
	`»pÜt_ad­tiÚ_timšg
(
time_±r
,
ad­t
,
ad­t_Ën
,
couÁ
);

1001 ià(
v”bo£
)

1002 
	`»pÜt_ad­tiÚ_f›ld
(
ad­t
,
ad­t_Ën
);

1004 ià(
pid
 == 0)

1006 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
·t_d©a
)

1009 
	`ä“
(
·t_d©a
);

1010 
·t_d©a
 = 
NULL
; 
·t_d©a_Ën
 = 0; 
·t_d©a_u£d
 = 0;

1012 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
·t_d©a
)

1014 
	`åršt_”r
("!!! Discarding…artial (unstarted) PAT in TS"

1015 "…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1016 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

1020 
”r
 = 
	`bud_psi_d©a
(
v”bo£
,
·ylßd
,
·ylßd_Ën
,
pid
,

1021 &
·t_d©a
,&
·t_d©a_Ën
,&
·t_d©a_u£d
);

1022 ià(
”r
)

1024 
	`åršt_”r
("### E¼Ü % PAT iÀTS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1025 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"),

1026 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

1027 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1028 ià(
·t_d©a
è
	`ä“
(pat_data);

1033 ià(
·t_d©a_Ën
 > 
·t_d©a_u£d
)

1037 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1039 
”r
 = 
	`exŒaù_´og_li¡_äom_·t
(
v”bo£
,
·t_d©a
,
·t_d©a_Ën
,&
´og_li¡
);

1040 ià(
”r
)

1042 
	`åršt_”r
("### Errorƒxtracting…rogram†ist from PAT in TS"

1043 "…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1044 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

1045 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1046 ià(
·t_d©a
è
	`ä“
(pat_data);

1050 ià(
·t_d©a
è
	`ä“
(pat_data);

1051 
·t_d©a
 = 
NULL
; 
·t_d©a_Ën
 = 0; 
·t_d©a_u£d
 = 0;

1053 ià(
	`pid_š_pidšt_li¡
(
´og_li¡
,
pid
))

1056 ià(
unfšished_pmt_pid
 !ğ0 && 
pid
 != unfinished_pmt_pid)

1060 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
)

1072 
	`åršt_”r
("!!! Discarding…artial PMT with PID %04x in TS"

1073 "…ack‘‡ˆ" 
OFFSET_T_FORMAT
 ",‡lready building PMT with PID %04x\n",

1074 
unfšished_pmt_pid
,

1075 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
,
pid
);

1080 ià(
·ylßd_un™_¡¬t_šdiÿtÜ
 && 
pmt_d©a
)

1083 
	`ä“
(
pmt_d©a
);

1084 
pmt_d©a
 = 
NULL
; 
pmt_d©a_Ën
 = 0; 
pmt_d©a_u£d
 = 0;

1086 ià(!
·ylßd_un™_¡¬t_šdiÿtÜ
 && !
pmt_d©a
)

1088 
	`åršt_”r
("!!! Discarding…artial (unstarted) PMT in TS"

1089 "…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1090 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

1094 
”r
 = 
	`bud_psi_d©a
(
v”bo£
,
·ylßd
,
·ylßd_Ën
,
pid
,

1095 &
pmt_d©a
,&
pmt_d©a_Ën
,&
pmt_d©a_u£d
);

1096 ià(
”r
)

1098 
	`åršt_”r
("### E¼Ü % PMT iÀTS…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1099 (
·ylßd_un™_¡¬t_šdiÿtÜ
?"starting‚ew":"continuing"),

1100 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

1101 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1102 
	`ä“_pmt
(&
pmt
);

1103 ià(
pmt_d©a
è
	`ä“
(pmt_data);

1108 ià(
pmt_d©a_Ën
 > 
pmt_d©a_u£d
)

1110 
unfšished_pmt_pid
 = 
pid
;

1115 
	`ä“_pmt
(&
pmt
);

1118 
unfšished_pmt_pid
 = 0;

1120 
”r
 = 
	`exŒaù_pmt
(
v”bo£
,
pmt_d©a
,
pmt_d©a_Ën
,
pid
,&
pmt
);

1121 ià(
”r
)

1123 
	`åršt_”r
("### Errorƒxtracting stream†ist from PMT in TS"

1124 "…ack‘‡ˆ" 
OFFSET_T_FORMAT
 "\n",

1125 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

1126 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1127 
	`ä“_pmt
(&
pmt
);

1128 ià(
pmt_d©a
è
	`ä“
(pmt_data);

1129  
”r
;

1132 ià(
pmt_d©a
è
	`ä“
(pmt_data);

1133 
pmt_d©a
 = 
NULL
; 
pmt_d©a_Ën
 = 0; 
pmt_d©a_u£d
 = 0;

1135 
	`´št_msg
("PMT data„ead‡s:\n");

1136 
	`»pÜt_pmt
(
TRUE
," ",
pmt
);

1137 
	`´št_msg
("\n");

1140 ià(
v”bo£
)

1142 
pmt_¡»am_p
 
¡»am
 = 
	`pid_¡»am_š_pmt
(
pmt
,
pid
);

1143 
¡»am_ty³
;

1144 ià(
¡»am
 =ğ
NULL
)

1145 
¡»am_ty³
 = -1;

1147 
¡»am_ty³
 = 
¡»am
->stream_type;

1148 
	`»pÜt_·ylßd
(
show_d©a
,
¡»am_ty³
,
·ylßd
,
·ylßd_Ën
,

1149 
·ylßd_un™_¡¬t_šdiÿtÜ
);

1150 ià(!
show_d©a
 && 
·ylßd_un™_¡¬t_šdiÿtÜ
)

1152 
	`´št_d©a
(
TRUE
," D©a",
·ylßd
,
·ylßd_Ën
,20);

1155 
	`´št_’d_of_d©a
(" ",
·ylßd
,
·ylßd_Ën
,20);

1159 
	`åršt_msg
("R—d %d TS…ack‘%s\n",
couÁ
,(count==1?"":"s"));

1160 
	`ä“_pidšt_li¡
(&
´og_li¡
);

1161 
	`ä“_pmt
(&
pmt
);

1162 ià(
pmt_d©a
è
	`ä“
(pmt_data);

1164 
	}
}

1171 
	$»pÜt_sšgË_pid
(
TS_»ad”_p
 
t¤—d”
,

1172 
max
,

1173 
qu›t
,

1174 
ušt32_t
 
ju¡_pid
)

1176 
”r
;

1177 
couÁ
 = 0;

1178 
pid_couÁ
 = 0;

1182 
ušt32_t
 
pid
;

1183 
·ylßd_un™_¡¬t_šdiÿtÜ
;

1184 
by‹
 *
ad­t
, *
·ylßd
;

1185 
ad­t_Ën
, 
·ylßd_Ën
;

1187 ià(
max
 > 0 && 
pid_couÁ
 >= max)

1189 
	`åršt_msg
("Stİpšg‡á” %d…ack‘ w™h PID %0x\n",
max
,
ju¡_pid
);

1193 
”r
 = 
	`g‘_Ãxt_TS_·ck‘
(
t¤—d”
,&
pid
,

1194 &
·ylßd_un™_¡¬t_šdiÿtÜ
,

1195 &
ad­t
,&
ad­t_Ën
,&
·ylßd
,&
·ylßd_Ën
);

1196 ià(
”r
 =ğ
EOF
)

1198 ià(
”r
)

1200 
	`åršt_”r
("### E¼Ü„—dšg TS…ack‘ %d‡ˆ" 
OFFSET_T_FORMAT


1201 "\n",
couÁ
,
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
);

1205 
couÁ
 ++;

1207 ià(
pid
 !ğ
ju¡_pid
)

1210 
pid_couÁ
 ++;

1212 ià(!
qu›t
)

1214 
	`åršt_msg
(
OFFSET_T_FORMAT_8
 ": TS Packet %2d PID %04x%s\n",

1215 
t¤—d”
->
po¢
 - 
TS_PACKET_SIZE
,
couÁ
,
pid
,

1216 (
·ylßd_un™_¡¬t_šdiÿtÜ
?" [pusi]":""));

1218 ià(
ad­t_Ën
 > 0)

1219 
	`´št_d©a
(
TRUE
," Ad­t",
ad­t
,
ad­t_Ën
,adapt_len);

1220 
	`´št_d©a
(
TRUE
, " Paylßd",
·ylßd
,
·ylßd_Ën
,payload_len);

1223 
	`åršt_msg
("Read %d TS…acket%s, %d with PID %0x\n",

1224 
couÁ
,(couÁ==1?"":"s"),
pid_couÁ
,
ju¡_pid
);

1226 
	}
}

1228 
	$´št_u§ge
()

1230 
	`´št_msg
(

1234 
	`REPORT_VERSION
("tsreport");

1235 
	`´št_msg
(

1299 
	}
}

1301 
	$maš
(
¬gc
, **
¬gv
)

1303 
u£_¡dš
 = 
FALSE
;

1304 *
šput_Çme
 = 
NULL
;

1305 
had_šput_Çme
 = 
FALSE
;

1307 
TS_»ad”_p
 
t¤—d”
 = 
NULL
;

1309 
max
 = 0;

1310 
v”bo£
 = 
FALSE
;

1311 
qu›t
 = 
FALSE
;

1312 
»pÜt_timšg
 = 
FALSE
;

1313 
»pÜt_bufãršg
 = 
FALSE
;

1314 
show_d©a
 = 
FALSE
;

1315 *
ouut_Çme
 = 
NULL
;

1316 
ušt32_t
 
cÚtšu™y_út_pid
 = 
INVALID_PID
;

1317 
»q_´og_no
 = 1;

1319 
ušt64_t
 
»pÜt_mask
 = ~0;

1321 
£Ëù_pid
 = 
FALSE
;

1322 
ušt32_t
 
ju¡_pid
 = 0;

1324 
”r
 = 0;

1325 
ii
 = 1;

1327 ià(
¬gc
 < 2)

1329 
	`´št_u§ge
();

1333 
ii
 < 
¬gc
)

1335 ià(
¬gv
[
ii
][0] == '-')

1337 ià(!
	`¡rcmp
("--h–p",
¬gv
[
ii
]) || !strcmp("-h",argv[ii]) ||

1338 !
	`¡rcmp
("-h–p",
¬gv
[
ii
]))

1340 
	`´št_u§ge
();

1343 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
ii
]) || !strcmp("-v",argv[ii]))

1345 
v”bo£
 = 
TRUE
;

1346 
qu›t
 = 
FALSE
;

1348 ià(!
	`¡rcmp
("-”r",
¬gv
[
ii
]))

1350 
	`CHECKARG
("t¤•Üt",
ii
);

1351 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stderr"))

1352 
	`»dœeù_ouut_¡d”r
();

1353 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"stdout"))

1354 
	`»dœeù_ouut_¡dout
();

1357 
	`åršt_”r
("###sreport: "

1359 " '¡d”r')\n",
¬gv
[
ii
+1]);

1362 
ii
++;

1364 ià(!
	`¡rcmp
("-timšg",
¬gv
[
ii
]) || !strcmp("-t",argv[ii]))

1366 
»pÜt_timšg
 = 
TRUE
;

1367 
qu›t
 = 
FALSE
;

1369 ià(!
	`¡rcmp
("-bufãršg",
¬gv
[
ii
]) || !strcmp("-b",argv[ii]))

1371 
»pÜt_bufãršg
 = 
TRUE
;

1372 
qu›t
 = 
FALSE
;

1374 ià(!
	`¡rcmp
("-o",
¬gv
[
ii
]))

1376 
	`CHECKARG
("t¤•Üt",
ii
);

1377 
ouut_Çme
 = 
¬gv
[
ii
+1];

1378 
ii
 ++;

1380 ià(!
	`¡rcmp
("-út",
¬gv
[
ii
]))

1382 
	`CHECKARG
("t¤•Üt",
ii
);

1383 
”r
 = 
	`unsigÃd_v®ue
("t¤•Üt",
¬gv
[
ii
],¬gv[ii+1],10,&
cÚtšu™y_út_pid
);

1384 ià(
”r
)  1;

1385 
	`åršt_msg
("Reporting on continuity_counter for…id = %04x (%u)\n",

1386 
cÚtšu™y_út_pid
,continuity_cnt_pid);

1387 
»pÜt_bufãršg
 = 
TRUE
;

1388 
qu›t
 = 
FALSE
;

1389 
ii
 ++;

1391 ià(!
	`¡rcmp
("-d©a",
¬gv
[
ii
]))

1393 
show_d©a
 = 
TRUE
;

1394 
qu›t
 = 
FALSE
;

1396 ià(!
	`¡rcmp
("-32",
¬gv
[
ii
]))

1398 
»pÜt_mask
 = 0xFFFFFFFF;

1400 ià(!
	`¡rcmp
("-tfmt",
¬gv
[
ii
]))

1402 
	`CHECKARG
("t¤•Üt",
ii
);

1403 ià((
tfmt_diff
 = 
	`fmtx_¡r_to_time¡amp_æags
(
¬gv
[
ii
 + 1])) < 0)

1405 
	`åršt_msg
("###¤•Üt: Badime¡am°fÜm© '%s'\n",
¬gv
[
ii
+1]);

1408 
ii
++;

1410 ià(!
	`¡rcmp
("-fmt",
¬gv
[
ii
]))

1412 
	`CHECKARG
("t¤•Üt",
ii
);

1413 ià((
tfmt_abs
 = 
	`fmtx_¡r_to_time¡amp_æags
(
¬gv
[
ii
 + 1])) < 0)

1415 
	`åršt_msg
("###¤•Üt: Badime¡am°fÜm© '%s'\n",
¬gv
[
ii
+1]);

1418 
ii
++;

1420 ià(!
	`¡rcmp
("-ju¡pid",
¬gv
[
ii
]))

1422 
	`CHECKARG
("t¤•Üt",
ii
);

1423 
”r
 = 
	`unsigÃd_v®ue
("t¤•Üt",
¬gv
[
ii
],¬gv[ii+1],0,&
ju¡_pid
);

1424 ià(
”r
)  1;

1425 
£Ëù_pid
 = 
TRUE
;

1426 
ii
++;

1428 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
ii
]) || !strcmp("-q",argv[ii]))

1430 
v”bo£
 = 
FALSE
;

1431 
qu›t
 = 
TRUE
;

1433 ià(!
	`¡rcmp
("-max",
¬gv
[
ii
]) || !strcmp("-m",argv[ii]))

1435 
	`CHECKARG
("t¤•Üt",
ii
);

1436 
”r
 = 
	`št_v®ue
("t¤•Üt",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
max
);

1437 ià(
”r
)  1;

1438 
ii
++;

1440 ià(!
	`¡rcmp
("-¡dš",
¬gv
[
ii
]))

1442 
u£_¡dš
 = 
TRUE
;

1443 
had_šput_Çme
 = 
TRUE
;

1445 ià(!
	`¡rcmp
("-´og",
¬gv
[
ii
]))

1447 
	`CHECKARG
("t¤•Üt",
ii
);

1448 
”r
 = 
	`št_v®ue
("t¤•Üt",
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
»q_´og_no
);

1449 ià(
”r
)  1;

1450 
ii
++;

1454 
	`åršt_”r
("###sreport: "

1455 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
ii
]);

1461 ià(
had_šput_Çme
)

1463 
	`åršt_”r
("###¤•Üt: UÃx³ùed '%s'\n",
¬gv
[
ii
]);

1468 
šput_Çme
 = 
¬gv
[
ii
];

1469 
had_šput_Çme
 = 
TRUE
;

1472 
ii
++;

1475 ià(!
had_šput_Çme
)

1477 
	`´št_”r
("###sreport: No input file specified\n");

1481 
”r
 = 
	`İ’_fe_fÜ_TS_»ad
((
u£_¡dš
?
NULL
:
šput_Çme
),&
t¤—d”
);

1482 ià(
”r
)

1484 
	`åršt_”r
("###sreport: Unableo open input file %s for„eading TS\n",

1485 
u£_¡dš
?"<¡dš>":
šput_Çme
);

1488 
	`åršt_msg
("R—dšg from %s\n",(
u£_¡dš
?"<¡dš>":
šput_Çme
));

1490 ià(
max
)

1491 
	`åršt_msg
("Stİpšg‡á” %d TS…ack‘s\n",
max
);

1493 ià(
£Ëù_pid
)

1494 
”r
 = 
	`»pÜt_sšgË_pid
(
t¤—d”
,
max
,
qu›t
,
ju¡_pid
);

1495 ià(
»pÜt_bufãršg
)

1496 
”r
 = 
	`»pÜt_bufãršg_¡©s
(
t¤—d”
,
»q_´og_no
,
max
,
v”bo£
,
qu›t
,

1497 
ouut_Çme
,
cÚtšu™y_út_pid
,
»pÜt_mask
);

1499 
”r
 = 
	`»pÜt_ts
(
t¤—d”
,
max
,
v”bo£
,
show_d©a
,
»pÜt_timšg
);

1500 ià(
”r
)

1502 
	`´št_”r
("###sreport: Error„eporting on input stream\n");

1503 (è
	`şo£_TS_»ad”
(&
t¤—d”
);

1506 
”r
 = 
	`şo£_TS_»ad”
(&
t¤—d”
);

1507 ià(
”r
)  1;

1510 
	}
}

	@tsserve.c

30 
	~<¡dio.h
>

31 
	~<¡dlib.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

34 
	~<fú.h
>

35 
	~<m©h.h
>

37 #ifdeà
_WIN32


38 
	~<¡ddef.h
>

39 
	~<wšsock2.h
>

40 
	~<ws2tı.h
>

41 
	~<´oûss.h
>

43 
	~<uni¡d.h
>

44 
	~<sys/ty³s.h
>

45 
	~<sys/sock‘.h
>

46 
	~<sys/wa™.h
>

47 
	~<Ãtš‘/š.h
>

48 
	~<sigÇl.h
>

51 
	~<time.h
>

53 
	~"com·t.h
"

54 
	~"ts_âs.h
"

55 
	~"ps_âs.h
"

56 
	~"³s_âs.h
"

57 
	~"acûssun™_âs.h
"

58 
	~"Çlun™_âs.h
"

59 
	~"misc_âs.h
"

60 
	~"´štšg_âs.h
"

61 
	~"tswr™e_âs.h
"

62 
	~"es_âs.h
"

63 
	~"h262_âs.h
"

64 
	~"f‹r_âs.h
"

65 
	~"»v”£_âs.h
"

66 
	~"v”siÚ.h
"

69 
	#SHOW_REVERSE_DATA
 1

	)

70 
	#DEBUG_COMMANDS
 1

	)

72 
	#TIME_SKIPPING
 1

	)

73 #ià
TIME_SKIPPING


74 
	~<time.h
>

78 
	#DEFAULT_REVERSE_FREQUENCY
 8

	)

79 
	#DEFAULT_FORWARD_FREQUENCY
 8

	)

80 
	#FRAMES_FOR_ONE_SECOND
 25

	)

82 
	#SMALL_SKIP_DISTANCE
 10*
FRAMES_FOR_ONE_SECOND


83 
	#BIG_SKIP_DISTANCE
 3*60*
FRAMES_FOR_ONE_SECOND


84 

	)

85 
	gexŒa_šfo
 = 0;

88 
	eACTION


90 
	mACTION_SERVER
,

91 
	mACTION_CMD
,

92 
	mACTION_TEST
,

95 
	#MAX_INPUT_FILES
 10

96 

	)

101 
	sts£rve_cÚ‹xt


103 *
	mšput_Çmes
[
MAX_INPUT_FILES
];

104 
	mdeçuÉ_fe_šdex
;

106 
	mvideo_Úly
;

107 
	m·d_¡¬t
;

109 
	mfäequ’cy
;

110 
	mräequ’cy
;

111 
	mw™h_£q_hdrs
;

114 
	m³s_·ddšg
;

115 
	mdrİ_·ck‘s
;

116 
	mdrİ_numb”
;

119 
ušt32_t
 
	mpmt_pid
;

120 
ušt32_t
 
	maudio_pid
;

121 
ušt32_t
 
	mvideo_pid
;

122 
ušt32_t
 
	mpü_pid
;

123 
	mwªt_h262
;

124 
	mdŞby_is_dvb
;

125 
	mfÜû_¡»am_ty³
;

126 
	m»³©_´og¿m_ev”y
;

129 
	mtsdœeù
;

131 
ts£rve_cÚ‹xt
 *
	tts£rve_cÚ‹xt_p
;

142 
	uu_¡»am_cÚ‹xt


144 
h262_cÚ‹xt_p
 
	mh262
;

145 
acûss_un™_cÚ‹xt_p
 
	mh264
;

147 
	s_¡»am_cÚ‹xt


149 
	mis_h262
;

150 
	m´og¿m_numb”
;

151 
u_¡»am_cÚ‹xt
 
	mu
;

153 
_¡»am_cÚ‹xt
 
	t¡»am_cÚ‹xt
;

154 
_¡»am_cÚ‹xt
 *
	t¡»am_cÚ‹xt_p
;

157 
	uu_f‹r_cÚ‹xt


159 
h262_f‹r_cÚ‹xt_p
 
	mh262
;

160 
h264_f‹r_cÚ‹xt_p
 
	mh264
;

162 
	s_f‹r_cÚ‹xt


164 
	mis_h262
;

165 
u_f‹r_cÚ‹xt
 
	mu
;

167 
_f‹r_cÚ‹xt
 
	tf‹r_cÚ‹xt
;

168 
_f‹r_cÚ‹xt
 *
	tf‹r_cÚ‹xt_p
;

171 
	uu_piùu»


173 
	mis_h262
;

174 
h262_piùu»_p
 
	mh262
;

175 
acûss_un™_p
 
	mh264
;

178 
	s_piùu»


180 
	mis_h262
;

181 
u_piùu»
 
	mu
;

182 
	mty³
;

184 
_piùu»
 
	tpiùu»
;

185 
_piùu»
 *
	tpiùu»_p
;

193 
	#EXTRACT_ES_FROM_STREAM
(
¡»am
) \

194 ((
¡»am
).
is_h262
?(¡»am).
u
.
h262
->
es
:(¡»am).u.
h264
->
Çc
->es)

	)

197 
	#EXTRACT_REVERSE_FROM_STREAM
(
¡»am
) \

198 ((
¡»am
).
is_h262
?(¡»am).
u
.
h262
->
»v”£_d©a
:(¡»am).u.
h264
->»v”£_d©a)

	)

204 
	$bud_¡»am
(
ES_p
 
es
,

205 
is_h262
,

206 
´og¿m_numb”
,

207 
¡»am_cÚ‹xt
 *
¡»am
)

209 
”r
;

210 
¡»am
->
is_h262
 = is_h262;

211 
¡»am
->
´og¿m_numb”
 =…rogram_number;

212 ià(
is_h262
)

214 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&(
¡»am
->
u
.
h262
));

215 ià(
”r
)

217 
	`´št_”r
("### Error building H.262 context\n");

223 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&(
¡»am
->
u
.
h264
));

224 ià(
”r
)

226 
	`´št_”r
("### Error building H.264‡ccess unit context\n");

231 
	}
}

233 
	$şo£_¡»am
(
¡»am_cÚ‹xt
 
¡»am
)

235 ià(
¡»am
.
is_h262
)

236 
	`ä“_h262_cÚ‹xt
(&(
¡»am
.
u
.
h262
));

238 
	`ä“_acûss_un™_cÚ‹xt
(&(
¡»am
.
u
.
h264
));

239 
	}
}

241 
	$bud_ªd_©ch_»v”£
(
¡»am_cÚ‹xt
 
¡»am
,

242 
»v”£_d©a_p
 *
»v”£_d©a
)

244 
”r
;

245 
”r
 = 
	`bud_»v”£_d©a
(
»v”£_d©a
,!
¡»am
.
is_h262
);

246 ià(
”r
)

248 
	`´št_”r
("### Unableo build„everse memory\n");

252 ià(
¡»am
.
is_h262
)

253 
	`add_h262_»v”£_cÚ‹xt
(
¡»am
.
u
.
h262
,*
»v”£_d©a
);

255 
	`add_acûss_un™_»v”£_cÚ‹xt
(
¡»am
.
u
.
h264
,*
»v”£_d©a
);

258 
	}
}

260 
	$bud_f‹r_cÚ‹xt
(
¡»am_cÚ‹xt
 
¡»am
,

261 
is_¡r
,

262 
äequ’cy
,

263 
f‹r_cÚ‹xt
 *
fcÚ‹xt
)

265 
”r
;

266 
fcÚ‹xt
->
is_h262
 = 
¡»am
.is_h262;

267 ià(
¡»am
.
is_h262
)

269 ià(
is_¡r
)

270 
”r
 = 
	`bud_h262_f‹r_cÚ‹xt_¡r
(&(
fcÚ‹xt
->
u
.
h262
),

271 
¡»am
.
u
.
h262
,
TRUE
);

273 
”r
 = 
	`bud_h262_f‹r_cÚ‹xt
(&(
fcÚ‹xt
->
u
.
h262
),

274 
¡»am
.
u
.
h262
,
äequ’cy
);

278 ià(
is_¡r
)

279 
”r
 = 
	`bud_h264_f‹r_cÚ‹xt_¡r
(&(
fcÚ‹xt
->
u
.
h264
),

280 
¡»am
.
u
.
h264
,
TRUE
);

282 
”r
 = 
	`bud_h264_f‹r_cÚ‹xt
(&(
fcÚ‹xt
->
u
.
h264
),

283 
¡»am
.
u
.
h264
,
äequ’cy
);

285  
”r
;

286 
	}
}

288 
	$ä“_f‹r_cÚ‹xt
(
f‹r_cÚ‹xt
 
fcÚ‹xt
)

290 ià(
fcÚ‹xt
.
is_h262
)

291 
	`ä“_h262_f‹r_cÚ‹xt
(&(
fcÚ‹xt
.
u
.
h262
));

293 
	`ä“_h264_f‹r_cÚ‹xt
(&(
fcÚ‹xt
.
u
.
h264
));

294 
	}
}

300 
šlše
 
	$»£t_¡»am
(
¡»am_cÚ‹xt
 
¡»am
)

302 ià(
¡»am
.
is_h262
)

304 ià(
¡»am
.
u
.
h262
->
Ï¡_™em
)

305 
	`ä“_h262_™em
(&
¡»am
.
u
.
h262
->
Ï¡_™em
);

309 
	`»£t_acûss_un™_cÚ‹xt
(
¡»am
.
u
.
h264
);

311 
	}
}

317 
šlše
 
	$g‘_Ãxt_piùu»
(
¡»am_cÚ‹xt
 
¡»am
,

318 
v”bo£
,

319 
qu›t
,

320 
piùu»
 *
pic
)

322 
”r
;

323 ià(
¡»am
.
is_h262
)

325 
h262_piùu»_p
 
piùu»
;

326 
”r
 = 
	`g‘_Ãxt_h262_äame
(
¡»am
.
u
.
h262
,
v”bo£
,
qu›t
,&
piùu»
);

327 ià(
”r
) ƒrr;

328 
pic
->
is_h262
 = 
TRUE
;

329 
pic
->
u
.
h262
 = 
piùu»
;

330 ià(
piùu»
->
is_piùu»
)

331 
pic
->
ty³
 = 
piùu»
->
piùu»_codšg_ty³
;

333 
pic
->
ty³
 = 0xff;

337 
acûss_un™_p
 
un™
;

338 
”r
 = 
	`g‘_Ãxt_h264_äame
(
¡»am
.
u
.
h264
,
qu›t
,
v”bo£
,&
un™
);

339 ià(
”r
) ƒrr;

340 
pic
->
is_h262
 = 
FALSE
;

341 
pic
->
u
.
h264
 = 
un™
;

344 
	}
}

346 
šlše
 
	$ä“_piùu»
(
piùu»
 *
pic
)

348 ià(
pic
->
is_h262
)

349 
	`ä“_h262_piùu»
(&
pic
->
u
.
h262
);

351 
	`ä“_acûss_un™
(&
pic
->
u
.
h264
);

352 
pic
->
ty³
 = 0;

353 
	}
}

359 
šlše
 
	$un£t_piùu»
(
is_h262
,

360 
piùu»
 *
pic
)

362 ià(
is_h262
)

363 
pic
->
u
.
h262
 = 
NULL
;

365 
pic
->
u
.
h264
 = 
NULL
;

366 
pic
->
is_h262
 = is_h262;

367 
	}
}

369 
šlše
 
	$is_nuÎ_piùu»
(
piùu»
 
pic
)

371 ià(
pic
.
is_h262
)

372  
pic
.
u
.
h262
 =ğ
NULL
;

374  
pic
.
u
.
h264
 =ğ
NULL
;

375 
	}
}

378 
šlše
 
	$is_nÚ_äame
(
piùu»
 
pic
)

380  (
pic
.
is_h262
 &&…ic.
ty³
 == 0xff);

381 
	}
}

383 
šlše
 
	$is_»ã»nû_piùu»
(
piùu»
 
pic
)

385 ià(
pic
.
is_h262
)

386  (
pic
.
ty³
 == 1 ||…ic.type == 2);

388  (
pic
.
u
.
h264
->
´im¬y_¡¬t
 !ğ
NULL
 &&

389 
pic
.
u
.
h264
->
´im¬y_¡¬t
->
Çl_»f_idc
 != 0);

390 
	}
}

392 
šlše
 
	$is_I_Ü_IDR_piùu»
(
piùu»
 
pic
)

394 ià(
pic
.
is_h262
)

395  (
pic
.
ty³
 == 1);

397  (
pic
.
u
.
h264
->
´im¬y_¡¬t
 !ğ
NULL
 &&

398 
pic
.
u
.
h264
->
´im¬y_¡¬t
->
Çl_»f_idc
 != 0 &&

399 (
pic
.
u
.
h264
->
´im¬y_¡¬t
->
Çl_un™_ty³
 =ğ
NAL_IDR
 ||

400 
	`®l_¦iûs_I
(
pic
.
u
.
h264
)));

401 
	}
}

403 
	$´št_piùu»
(
piùu»
 
pic
)

405 ià(
pic
.
is_h262
)

407 ià(
pic
.
ty³
 == 0xff)

408 
	`´št_msg
("sequence header");

410 
	`åršt_msg
("% piùu»",
	`H262_PICTURE_CODING_STR
(
pic
.
ty³
));

414 ià(
pic
.
u
.
h264
->
´im¬y_¡¬t
 =ğ
NULL
)

415 
	`´št_msg
("<null>");

417 
	`åršt_msg
("idc %d/type %d (%s)",

418 
pic
.
u
.
h264
->
´im¬y_¡¬t
->
Çl_»f_idc
,

419 
pic
.
u
.
h264
->
´im¬y_¡¬t
->
Çl_un™_ty³
,

420 
	`NAL_UNIT_TYPE_STR
(
pic
.
u
.
h264
->
´im¬y_¡¬t
->
Çl_un™_ty³
));

422 
	}
}

424 
šlše
 
	$wr™e_piùu»_as_TS
(
¡»am_cÚ‹xt
 
¡»am
,

425 
TS_wr™”_p
 
ouut
,

426 
piùu»
 
pic
)

428 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

429 ià(
¡»am
.
is_h262
)

430  
	`wr™e_h262_piùu»_as_TS
(
ouut
,
pic
.
u
.
h262
,

431 
es
->
»ad”
->
ouut_video_pid
);

433  
	`wr™e_acûss_un™_as_TS
(
pic
.
u
.
h264
,
¡»am
.u.h264,

434 
ouut
,
es
->
»ad”
->
ouut_video_pid
);

435 
	}
}

437 
šlše
 
	$»£t_f‹r_cÚ‹xt
(
f‹r_cÚ‹xt
 
fcÚ‹xt
,

438 
äequ’cy
)

440 ià(
fcÚ‹xt
.
is_h262
)

442 
	`»£t_h262_f‹r_cÚ‹xt
(
fcÚ‹xt
.
u
.
h262
);

443 
fcÚ‹xt
.
u
.
h262
->
äeq
 = 
äequ’cy
;

447 
	`»£t_h264_f‹r_cÚ‹xt
(
fcÚ‹xt
.
u
.
h264
);

448 
fcÚ‹xt
.
u
.
h264
->
äeq
 = 
äequ’cy
;

450 
	}
}

452 
šlše
 
	$g‘_Ãxt_¡r³d
(
f‹r_cÚ‹xt
 
fcÚ‹xt
,

453 
v”bo£
,

454 
qu›t
,

455 
piùu»
 *
£q_hdr
,

456 
piùu»
 *
this_piùu»
,

457 *
d–_piùu»s_£’
)

459 
”r
;

461 
	`un£t_piùu»
(
fcÚ‹xt
.
is_h262
,
£q_hdr
);

462 
	`un£t_piùu»
(
fcÚ‹xt
.
is_h262
,
this_piùu»
);

464 ià(
fcÚ‹xt
.
is_h262
)

466 
h262_piùu»_p
 
_this_piùu»
 = 
NULL
;

467 
h262_piùu»_p
 
_£q_hdr
 = 
NULL
;

468 
”r
 = 
	`g‘_Ãxt_¡r³d_h262_äame
(
fcÚ‹xt
.
u
.
h262
,
v”bo£
,
qu›t
,&
_£q_hdr
,

469 &
_this_piùu»
,
d–_piùu»s_£’
);

470 
£q_hdr
->
u
.
h262
 = 
_£q_hdr
;

471 
this_piùu»
->
u
.
h262
 = 
_this_piùu»
;

475 
acûss_un™_p
 
this_un™
 = 
NULL
;

476 
”r
 = 
	`g‘_Ãxt_¡r³d_h264_äame
(
fcÚ‹xt
.
u
.
h264
,
v”bo£
,
qu›t
,

477 &
this_un™
,
d–_piùu»s_£’
);

478 
this_piùu»
->
u
.
h264
 = 
this_un™
;

480  
”r
;

481 
	}
}

483 
šlše
 
	$g‘_Ãxt_f‹»d
(
f‹r_cÚ‹xt
 
fcÚ‹xt
,

484 
v”bo£
,

485 
qu›t
,

486 
piùu»
 *
£q_hdr
,

487 
piùu»
 *
this_piùu»
,

488 *
d–_piùu»s_£’
)

490 
”r
;

492 
	`un£t_piùu»
(
fcÚ‹xt
.
is_h262
,
£q_hdr
);

493 
	`un£t_piùu»
(
fcÚ‹xt
.
is_h262
,
this_piùu»
);

495 ià(
fcÚ‹xt
.
is_h262
)

497 
h262_piùu»_p
 
_this_piùu»
 = 
NULL
;

498 
h262_piùu»_p
 
_£q_hdr
 = 
NULL
;

499 
”r
 = 
	`g‘_Ãxt_f‹»d_h262_äame
(
fcÚ‹xt
.
u
.
h262
,
v”bo£
,
qu›t
,&
_£q_hdr
,

500 &
_this_piùu»
,
d–_piùu»s_£’
);

501 
£q_hdr
->
u
.
h262
 = 
_£q_hdr
;

502 
this_piùu»
->
u
.
h262
 = 
_this_piùu»
;

506 
acûss_un™_p
 
this_un™
 = 
NULL
;

507 
”r
 = 
	`g‘_Ãxt_f‹»d_h264_äame
(
fcÚ‹xt
.
u
.
h264
,
v”bo£
,
qu›t
,

508 &
this_un™
,
d–_piùu»s_£’
);

509 
this_piùu»
->
u
.
h264
 = 
this_un™
;

511  
”r
;

512 
	}
}

529 
	$¶ay_nÜm®
(
¡»am_cÚ‹xt
 
¡»am
,

530 
TS_wr™”_p
 
ouut
,

531 
v”bo£
,

532 
qu›t
,

533 
num_nÜm®
,

534 
tsdœeù
,

535 
»v”£_d©a_p
 
»v”£_d©a
)

537 
”r
;

538 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

539 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

541 ià(
exŒa_šfo
è
	`´št_msg
("Playing‡t‚ormal speed\n");

546 ià(!
tsdœeù
)

548 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
ouut
);

549 ià(
”r
) ƒrr;

552 
	`¡¬t_£rv”_ouut
(
»ad”
);

554 ià(
¡»am
.
is_h262
)

556 
”r
 = 
	`cŞËù_»v”£_h262
(
¡»am
.
u
.
h262
,
num_nÜm®
,
v”bo£
,
qu›t
);

557 ià(
”r
) ƒrr;

561 
”r
 = 
	`cŞËù_»v”£_acûss_un™s
(
¡»am
.
u
.
h264
,
num_nÜm®
,
v”bo£
,
qu›t
);

562 ià(
”r
) ƒrr;

565 
	}
}

578 
	$æush_aá”_nÜm®
(
¡»am_cÚ‹xt
 
¡»am
,

579 
TS_wr™”_p
 
ouut
,

580 
v”bo£
,

581 
qu›t
)

583 
”r
;

584 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

585 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

586 
ES_off£t
 
™em_¡¬t
;

588 ià(
exŒa_šfo
è
	`´št_msg
("Flushing PES data‡fter‚ormal…lay\n");

590 ià(
»ad”
->
·ck‘
 =ğ
NULL
)

615 ià(
¡»am
.
is_h262
)

617 ià(
¡»am
.
u
.
h262
->
Ï¡_™em
 =ğ
NULL
)

619 ià(
exŒa_šfo
è
	`´št_msg
("..‚o H.262†ast item\n");

624 
™em_¡¬t
 = 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
¡¬t_po¢
;

628 ià(
¡»am
.
u
.
h264
->
³ndšg_Çl
 =ğ
NULL
)

632 
™em_¡¬t
 = 
es
->
po¢_of_Ãxt_by‹
;

638 
™em_¡¬t
 = 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
¡¬t_po¢
;

642 ià(
exŒa_šfo
è
	`åršt_msg
("..†a¡ i‹m s¹ © " 
OFFSET_T_FORMAT
 "/%d\n",

643 
™em_¡¬t
.
šfe
,™em_¡¬t.
š·ck‘
);

647 ià(
™em_¡¬t
.
šfe
 < 
»ad”
->
·ck‘
->
po¢
)

652 
piùu»
…icture;

653 ià(
exŒa_šfo
è
	`´št_msg
(".. which is inhe…revious…acket - "

656 
”r
 = 
	`g‘_Ãxt_piùu»
(
¡»am
,
v”bo£
,
qu›t
,&
piùu»
);

657 ià(
”r
 =ğ
EOF
)

660 ià(
exŒa_šfo
è
	`´št_msg
("End of file\n");

661  
”r
;

663 ià(
”r
)

665 
	`´št_”r
("### Errorryingo„ead into‚ext…acket whilst"

669 
	`ä“_piùu»
(&
piùu»
);

673 ià(
¡»am
.
is_h262
)

674 
™em_¡¬t
 = 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
¡¬t_po¢
;

677 ià(
¡»am
.
u
.
h264
->
³ndšg_Çl
 =ğ
NULL
)

678 
™em_¡¬t
 = 
es
->
po¢_of_Ãxt_by‹
;

680 
™em_¡¬t
 = 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
¡¬t_po¢
;

682 ià(
exŒa_šfo
è
	`åršt_msg
("..‚ew†a¡ i‹m s¹ © " 
OFFSET_T_FORMAT


683 "/%d\n",
™em_¡¬t
.
šfe
,™em_¡¬t.
š·ck‘
);

686 ià(
™em_¡¬t
.
š·ck‘
 == 0)

690 ià(
exŒa_šfo
è
	`´št_msg
(".. sohere's‚o‚eedo output‡ny ofhis"

696 ià(
exŒa_šfo
è
	`åršt_msg
(".. so‚eedo output %d bytes ofhis"

697 "…ack‘\n",
™em_¡¬t
.
š·ck‘
);

699 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
,

700 
»ad”
->
·ck‘
->
es_d©a
,

701 
™em_¡¬t
.
š·ck‘
,

702 
»ad”
->
ouut_video_pid
,

703 
DEFAULT_VIDEO_STREAM_ID
);

704 ià(
”r
)

706 
	`´št_”r
("### Error flushing start of PES…acket‡fter‚ormal…lay\n");

710 
	}
}

719 
	$ouut_Ãxt_»ã»nû_piùu»
(
¡»am_cÚ‹xt
 
¡»am
,

720 
TS_wr™”_p
 
ouut
,

721 
v”bo£
,

722 
qu›t
,

723 
I_Úly
)

725 
”r
;

726 
piùu»
…icture;

728 ià(
exŒa_šfo
è
	`´št_msg
(".. outputting‚ext„eference…icture\n");

732 
”r
 = 
	`g‘_Ãxt_piùu»
(
¡»am
,
v”bo£
,
qu›t
,&
piùu»
);

733 ià(
”r
 =ğ
EOF
)

736 ià(
exŒa_šfo
è
	`´št_msg
("End of file\n");

737  
”r
;

739 ià(
”r
)

741 
	`´št_”r
("### Errorryingo„esynchronise‡fter fast forward\n");

745 ià(
exŒa_šfo
)

747 
	`´št_msg
("..„ead‚ext…icture: ");

748 
	`´št_piùu»
(
piùu»
);

749 
	`´št_msg
("\n");

752 ià(
	`is_nÚ_äame
(
piùu»
))

758 ià(
exŒa_šfo
è
	`´št_msg
(".. writing it out\n");

759 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
piùu»
);

760 ià(
”r
)

762 
	`´št_”r
("### Error writing out…icture†ist\n");

763 
	`ä“_piùu»
(&
piùu»
);

767 ià(Ğ
I_Úly
 && 
	`is_I_Ü_IDR_piùu»
(
piùu»
)) ||

768 (!
I_Úly
 && 
	`is_»ã»nû_piùu»
(
piùu»
)))

770 ià(
exŒa_šfo
è
	`´št_msg
("..…icture‡cceptable\n");

773 
	`ä“_piùu»
(&
piùu»
);

777 ià(
exŒa_šfo
è
	`´št_msg
(".. writing it out\n");

778 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
piùu»
);

779 ià(
”r
)

781 
	`´št_”r
("### Error writing out…icture†ist\n");

782 
	`ä“_piùu»
(&
piùu»
);

785 
	`ä“_piùu»
(&
piùu»
);

787 
	}
}

800 
	$»sync_aá”_»v”£
(
¡»am_cÚ‹xt
 
¡»am
,

801 
TS_wr™”_p
 
ouut
,

802 
v”bo£
,

803 
qu›t
)

805 
”r
;

806 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

808 ià(
exŒa_šfo
è
	`´št_msg
("\nResynchronising PES…ackets‡fter„everse\n");

818 
	`»£t_¡»am
(
¡»am
);

820 ià(
exŒa_šfo
)

821 
	`åršt_msg
("riple byte = %02x,%02x,%02x,‚ext byteo be from "

822 
OFFSET_T_FORMAT
 "/%d\n",

823 
es
->
´ev2_by‹
,es->
´ev1_by‹
,es->
cur_by‹
,

824 
es
->
po¢_of_Ãxt_by‹
.
šfe
,

825 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
);

845 
”r
 = 
	`ouut_Ãxt_»ã»nû_piùu»
(
¡»am
,
ouut
,
v”bo£
,
qu›t
,
FALSE
);

846 ià(
”r
 =ğ
EOF
)

847  
EOF
;

848 ià(
”r
)

850 
	`´št_”r
("### Error outputting‚ext„eference…icture,"

855 
	}
}

867 
	$»wšd_¡»am
(
¡»am_cÚ‹xt
 
¡»am
)

869 ià(
exŒa_šfo
è
	`´št_msg
("\nRewinding\n");

870 ià(
¡»am
.
is_h262
)

871  
	`»wšd_h262_cÚ‹xt
(
¡»am
.
u
.
h262
);

873  
	`»wšd_acûss_un™_cÚ‹xt
(
¡»am
.
u
.
h264
);

874 
	}
}

887 
	$»sync_aá”_f‹r
(
¡»am_cÚ‹xt
 
¡»am
,

888 
TS_wr™”_p
 
ouut
,

889 
v”bo£
,

890 
qu›t
)

892 
”r
;

894 ià(
exŒa_šfo
è
	`´št_msg
("\nResynchronising‡fter fast fast forward\n");

921 
”r
 = 
	`ouut_Ãxt_»ã»nû_piùu»
(
¡»am
,
ouut
,
v”bo£
,
qu›t
,
FALSE
);

922 ià(
”r
 =ğ
EOF
)

923  
EOF
;

924 ià(
”r
)

926 
	`´št_”r
("### Error outputting‚ext„eference…icture,"

931 
	}
}

945 
	$back_to_nÜm®
(
¡»am_cÚ‹xt
 
¡»am
,

946 
TS_wr™”_p
 
ouut
,

947 
tsdœeù
)

949 
”r
;

950 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

951 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

952 
ES_off£t
 
™em_¡¬t
;

954 ià(
exŒa_šfo
è
	`´št_msg
("\nResynchronising PES…ackets for‚ormal…lay\n");

957 ià(
»ad”
->
·ck‘
 =ğ
NULL
)

964 ià(!
tsdœeù
)

968 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
ouut
);

969 ià(
”r
) ƒrr;

991 ià(
¡»am
.
is_h262
)

993 ià(
¡»am
.
u
.
h262
->
Ï¡_™em
 =ğ
NULL
)

995 ià(
exŒa_šfo
è
	`´št_msg
("..‚o H.262†ast item,…resumably been"

997 
™em_¡¬t
 = 
es
->
po¢_of_Ãxt_by‹
;

1005 
™em_¡¬t
 = 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
¡¬t_po¢
;

1010 ià(
¡»am
.
u
.
h264
->
³ndšg_Çl
 =ğ
NULL
)

1015 
™em_¡¬t
 = 
es
->
po¢_of_Ãxt_by‹
;

1021 
™em_¡¬t
 = 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
¡¬t_po¢
;

1025 ià(
exŒa_šfo
)

1027 
	`åršt_msg
("..…o¢_of_Ãxt_by‹ i " 
OFFSET_T_FORMAT
 "/%d\n",

1028 
es
->
po¢_of_Ãxt_by‹
.
šfe
,es->po¢_of_Ãxt_by‹.
š·ck‘
);

1030 ià(
¡»am
.
is_h262
)

1032 ià(
¡»am
.
u
.
h262
->
Ï¡_™em
)

1034 
	`åršt_msg
("†a¡ i‹m s¹ © " 
OFFSET_T_FORMAT
 "/%d,\n",

1035 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
¡¬t_po¢
.
šfe
,

1036 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
¡¬t_po¢
.
š·ck‘
);

1037 
	`´št_d©a
(
TRUE
,"†ast item",

1038 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
d©a
,

1039 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
d©a_Ën
,20);

1044 ià(
¡»am
.
u
.
h264
->
³ndšg_Çl
)

1046 
	`åršt_msg
("†a¡ i‹m s¹ © " 
OFFSET_T_FORMAT
 "/%d,\n",

1047 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
¡¬t_po¢
.
šfe
,

1048 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
¡¬t_po¢
.
š·ck‘
);

1049 
	`´št_d©a
(
TRUE
,"…ending NAL unit",

1050 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
d©a
,

1051 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
d©a_Ën
,20);

1054 
	`åršt_msg
(".. i.e.,†a¡ i‹m s¹ © " 
OFFSET_T_FORMAT
 "/%d\n",

1055 
™em_¡¬t
.
šfe
,™em_¡¬t.
š·ck‘
);

1056 
	`åršt_msg
(" PES ES data†ength is %d\n"

1058 
»ad”
->
·ck‘
->
es_d©a_Ën
,

1059 
»ad”
->
·ck‘
->
es_d©a_Ën
-
™em_¡¬t
.
š·ck‘
);

1060 
	`åršt_msg
("„—d”->·ck‘->po¢ i " 
OFFSET_T_FORMAT
 "\n",

1061 
»ad”
->
·ck‘
->
po¢
);

1064 ià(
™em_¡¬t
.
šfe
 < 
»ad”
->
·ck‘
->
po¢
)

1069 
št32_t
 
cu½o¢
 = 
es
->
po¢_of_Ãxt_by‹
.
š·ck‘
;

1074 
št32_t
 
Ëngth_wª‹d
;

1076 ià(
¡»am
.
is_h262
)

1078 
Ëngth_wª‹d
 = 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
d©a_Ën
 - 
cu½o¢
;

1079 ià(
exŒa_šfo
è
	`åršt_msg
("..‚ext byte is %d, so†ength wanted is %d"

1080 " - ouu‰šg it\n",
cu½o¢
,
Ëngth_wª‹d
);

1081 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
,

1082 
¡»am
.
u
.
h262
->
Ï¡_™em
->
un™
.
d©a
,

1083 
Ëngth_wª‹d
,

1084 
»ad”
->
ouut_video_pid
,

1085 
DEFAULT_VIDEO_STREAM_ID
);

1091 
Ëngth_wª‹d
 = 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
d©a_Ën
 - 
cu½o¢
;

1092 ià(
exŒa_šfo
è
	`åršt_msg
("..‚ext byte is %d, so†ength wanted is %d"

1093 " - ouu‰šg it\n",
cu½o¢
,
Ëngth_wª‹d
);

1094 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
,

1095 
¡»am
.
u
.
h264
->
³ndšg_Çl
->
un™
.
d©a
,

1096 
Ëngth_wª‹d
,

1097 
»ad”
->
ouut_video_pid
,

1098 
DEFAULT_VIDEO_STREAM_ID
);

1100 ià(
”r
)

1102 
	`´št_”r
("### Error flushing (start of)†ast item‡fter fast forward\n");

1109 ià(
™em_¡¬t
.
š·ck‘
 == 0)

1114 ià(
exŒa_šfo
è
	`´št_msg
(".. i.e.,‡t start of…acket,‚othingo do\n");

1119 
št32_t
 
¡¬t_off£t
 = 
™em_¡¬t
.
š·ck‘
;

1120 
št32_t
 
Ëngth_wª‹d
 = 
»ad”
->
·ck‘
->
es_d©a_Ën
 - 
¡¬t_off£t
;

1121 ià(
exŒa_šfo
)

1123 
	`åršt_msg
(".. sØouuˆ%d by‹ ©ƒnd oàPES…ack‘\n",
Ëngth_wª‹d
);

1124 
	`´št_d©a
(
TRUE
,"..ƒnd by‹s",&
»ad”
->
·ck‘
->
es_d©a
[
¡¬t_off£t
],

1125 
Ëngth_wª‹d
,20);

1128 
”r
 = 
	`wr™e_ES_as_TS_PES_·ck‘
(
ouut
,

1129 &
»ad”
->
·ck‘
->
es_d©a
[
¡¬t_off£t
],

1130 
Ëngth_wª‹d
,

1131 
»ad”
->
ouut_video_pid
,

1132 
DEFAULT_VIDEO_STREAM_ID
);

1133 ià(
”r
)

1135 
	`´št_”r
("### Error flushing„est of PES…acket‡fter fast forward\n");

1142 
»ad”
->
dÚt_wr™e_cu¼’t_·ck‘
 = 
TRUE
;

1145 
	}
}

1156 
	$¶ay_¡r³d
(
¡»am_cÚ‹xt
 
¡»am
,

1157 
f‹r_cÚ‹xt
 
fcÚ‹xt
,

1158 
TS_wr™”_p
 
ouut
,

1159 
v”bo£
,

1160 
qu›t
,

1161 
tsdœeù
,

1162 
num_ç¡
,

1163 
w™h_£q_hdrs
)

1165 
”r
;

1166 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

1167 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

1168 
tÙ®_piùu»s
 = 0;

1174 
	`»£t_f‹r_cÚ‹xt
(
fcÚ‹xt
,0);

1176 ià(!
tsdœeù
)

1180 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
ouut
);

1181 ià(
”r
) ƒrr;

1184 ià(
exŒa_šfo
è
	`´št_msg
("Fast forwarding (strip)\n");

1188 
piùu»
 
this_piùu»
;

1189 
piùu»
 
£q_hdr
;

1190 
d–_piùu»s_£’
;

1192 ià(
	`tswr™e_commªd_chªged
(
ouut
))

1193  
COMMAND_RETURN_CODE
;

1195 
”r
 = 
	`g‘_Ãxt_¡r³d
(
fcÚ‹xt
,
v”bo£
,
qu›t
,

1196 &
£q_hdr
,&
this_piùu»
,&
d–_piùu»s_£’
);

1197 ià(
”r
 =ğ
EOF
 ||ƒ¼ =ğ
COMMAND_RETURN_CODE
)

1199  
”r
;

1201 ià(
”r
)

1203 
	`´št_”r
("### Error getting‚ext stripped…icture\n");

1206 ià(
w™h_£q_hdrs
 && !
	`is_nuÎ_piùu»
(
£q_hdr
))

1208 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
£q_hdr
);

1209 ià(
”r
)

1211 
	`´št_”r
("### Error writing out sequence header\n");

1212 
	`ä“_piùu»
(&
this_piùu»
);

1216 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
this_piùu»
);

1217 ià(
”r
)

1219 
	`´št_”r
("### Error writing out…icture†ist\n");

1220 
	`ä“_piùu»
(&
this_piùu»
);

1223 
	`ä“_piùu»
(&
this_piùu»
);

1225 
tÙ®_piùu»s
 +ğ
d–_piùu»s_£’
;

1226 ià(
num_ç¡
 > 0 && 
tÙ®_piùu»s
 >‚um_fast)

1230 
	}
}

1241 
	$¶ay_f‹»d
(
¡»am_cÚ‹xt
 
¡»am
,

1242 
f‹r_cÚ‹xt
 
fcÚ‹xt
,

1243 
TS_wr™”_p
 
ouut
,

1244 
v”bo£
,

1245 
qu›t
,

1246 
tsdœeù
,

1247 
num_ç¡”
,

1248 
äequ’cy
,

1249 
w™h_£q_hdrs
)

1251 
”r
;

1252 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

1253 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

1255 
piùu»
 
this_piùu»
;

1256 
piùu»
 
Ï¡_piùu»
;

1257 
piùu»
 
£q_hdr
;

1259 
tÙ®_piùu»s
 = 0;

1264 
	`»£t_f‹r_cÚ‹xt
(
fcÚ‹xt
,
äequ’cy
);

1266 ià(!
tsdœeù
)

1270 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
ouut
);

1271 ià(
”r
) ƒrr;

1274 ià(
exŒa_šfo
è
	`´št_msg
("Fast forwarding (filter)\n");

1276 
	`un£t_piùu»
(
¡»am
.
is_h262
,&
this_piùu»
);

1277 
	`un£t_piùu»
(
¡»am
.
is_h262
,&
Ï¡_piùu»
);

1280 
d–_piùu»s_£’
;

1281 ià(
	`tswr™e_commªd_chªged
(
ouut
))

1283 
	`ä“_piùu»
(&
Ï¡_piùu»
);

1284 
”r
 = 
COMMAND_RETURN_CODE
;

1288 
”r
 = 
	`g‘_Ãxt_f‹»d
(
fcÚ‹xt
,
v”bo£
,
qu›t
,

1289 &
£q_hdr
,&
this_piùu»
,&
d–_piùu»s_£’
);

1290 ià(
”r
 =ğ
EOF
 ||ƒ¼ =ğ
COMMAND_RETURN_CODE
)

1292 
	`ä“_piùu»
(&
Ï¡_piùu»
);

1295 ià(
”r
)

1297 
	`´št_”r
("### Error getting‚ext filtered…icture\n");

1298 
	`ä“_piùu»
(&
Ï¡_piùu»
);

1301 ià(
	`is_nuÎ_piùu»
(
this_piùu»
))

1304 
this_piùu»
 = 
Ï¡_piùu»
;

1305 
	`un£t_piùu»
(
¡»am
.
is_h262
,&
Ï¡_piùu»
);

1307 ià(!
	`is_nuÎ_piùu»
(
this_piùu»
))

1309 ià(
w™h_£q_hdrs
 && !
	`is_nuÎ_piùu»
(
£q_hdr
))

1311 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
£q_hdr
);

1312 ià(
”r
)

1314 
	`´št_”r
("### Error writing out sequence header\n");

1315 
	`ä“_piùu»
(&
this_piùu»
);

1316 
	`ä“_piùu»
(&
Ï¡_piùu»
);

1320 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
this_piùu»
);

1321 ià(
”r
)

1323 
	`´št_”r
("### Error writing out…icture\n");

1324 
	`ä“_piùu»
(&
this_piùu»
);

1325 
	`ä“_piùu»
(&
Ï¡_piùu»
);

1329 
	`ä“_piùu»
(&
Ï¡_piùu»
);

1330 
Ï¡_piùu»
 = 
this_piùu»
;

1332 
tÙ®_piùu»s
 +ğ
d–_piùu»s_£’
;

1333 ià(
num_ç¡”
 > 0 && 
tÙ®_piùu»s
 >‚um_faster)

1338 
	`ä“_piùu»
(&
Ï¡_piùu»
);

1340 ià(
”r
 =ğ
EOF
)

1351 
»v”£_d©a_p
 
»v”£_d©a
 = 
	`EXTRACT_REVERSE_FROM_STREAM
(
¡»am
);

1353 
”r
 = 
	`ouut_äom_»v”£_d©a_as_TS
(
es
,
ouut
,
v”bo£
,
qu›t
,2,

1354 
»v”£_d©a
);

1355 ià(
”r
 &&ƒ¼ !ğ
COMMAND_RETURN_CODE
)

1357 
	`´št_”r
("### Error outputting 'last'…icture‡t EOF\n");

1358  
”r
;

1361 
”r
 = 
	`»sync_aá”_»v”£
(
¡»am
,
ouut
,
v”bo£
,
qu›t
);

1362 ià(
”r
) ƒrr;

1364  
EOF
;

1369 
”r
 = 
	`»sync_aá”_f‹r
(
¡»am
,
ouut
,
v”bo£
,
qu›t
);

1370 ià(
”r
) ƒrr;

1373 
	}
}

1384 
	$sk_fÜw¬ds
(
¡»am_cÚ‹xt
 
¡»am
,

1385 
TS_wr™”_p
 
ouut
,

1386 
f‹r_cÚ‹xt
 
fcÚ‹xt
,

1387 
w™h_£q_hdrs
,

1388 
num_to_sk
,

1389 
v”bo£
,

1390 
qu›t
,

1391 
tsdœeù
)

1393 
”r
;

1394 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

1395 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

1396 
piùu»
 
this_piùu»
;

1397 
piùu»
 
£q_hdr
;

1398 
d–_piùu»s_£’
;

1400 #ià
TIME_SKIPPING


1401 
time_t
 
¡¬t_time
,
’d_time
;

1402 
şock_t
 
¡¬t_şock
,
’d_şock
;

1403 
¡¬t_time
 = 
	`time
(
NULL
);

1404 
¡¬t_şock
 = 
	`şock
();

1409 
	`»£t_f‹r_cÚ‹xt
(
fcÚ‹xt
,
num_to_sk
);

1411 ià(!
tsdœeù
)

1415 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
ouut
);

1416 ià(
”r
) ƒrr;

1419 ià(
exŒa_šfo
è
	`åršt_msg
("Skpšg fÜw¬d (%d f¿mes)\n",
num_to_sk
);

1421 
	`un£t_piùu»
(
¡»am
.
is_h262
,&
this_piùu»
);

1424 
	`tswr™e_£t_commªd_©omic
(
ouut
,
TRUE
);

1426 
”r
 = 
	`g‘_Ãxt_f‹»d
(
fcÚ‹xt
,
v”bo£
,
qu›t
,

1427 &
£q_hdr
,&
this_piùu»
,&
d–_piùu»s_£’
);

1428 ià(
”r
 &&ƒ¼ !ğ
EOF
)

1430 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1431 ià(
”r
 =ğ
COMMAND_RETURN_CODE
)

1432  
”r
;

1435 
	`´št_”r
("### Error skipping…ictures\n");

1440 ià(
”r
 =ğ
EOF
)

1445 
»v”£_d©a_p
 
»v”£_d©a
 = 
	`EXTRACT_REVERSE_FROM_STREAM
(
¡»am
);

1447 
”r
 = 
	`ouut_äom_»v”£_d©a_as_TS
(
es
,
ouut
,
v”bo£
,
qu›t
,2,

1448 
»v”£_d©a
);

1449 ià(
”r
)

1451 
	`´št_”r
("### Error outputting 'last'…icture‡t EOF\n");

1452 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1453  
”r
;

1456 
”r
 = 
	`»sync_aá”_»v”£
(
¡»am
,
ouut
,
v”bo£
,
qu›t
);

1457 ià(
”r
)

1459 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1460  
”r
;

1463  
EOF
;

1469 ià(
	`is_nuÎ_piùu»
(
this_piùu»
))

1471 
	`´št_”r
("### Skipping„eturned‡ NULL…icture\n");

1472 
	`ä“_piùu»
(&
this_piùu»
);

1473 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1476 ià(
w™h_£q_hdrs
 && !
	`is_nuÎ_piùu»
(
£q_hdr
))

1478 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
£q_hdr
);

1479 ià(
”r
)

1481 
	`´št_”r
("### Error writing out sequence header\n");

1482 
	`ä“_piùu»
(&
this_piùu»
);

1483 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1487 
”r
 = 
	`wr™e_piùu»_as_TS
(
¡»am
,
ouut
,
this_piùu»
);

1488 ià(
”r
)

1490 
	`´št_”r
("### Error writing out…icture\n");

1491 
	`ä“_piùu»
(&
this_piùu»
);

1492 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1495 
	`ä“_piùu»
(&
this_piùu»
);

1498 
”r
 = 
	`»sync_aá”_f‹r
(
¡»am
,
ouut
,
v”bo£
,
qu›t
);

1499 ià(
”r
)

1501 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1506 #ià
TIME_SKIPPING


1507 
’d_şock
 = 
	`şock
();

1508 
’d_time
 = 
	`time
(
NULL
);

1509 
	`åršt_msg
("S¹ed skpšg‡ˆ%s",
	`ùime
(&
¡¬t_time
));

1510 
	`åršt_msg
("Fšished skpšg‡ˆ%s",
	`ùime
(&
’d_time
));

1511 
	`åršt_msg
("EÏp£dim%.3fs\n",
	`difáime
(
’d_time
,
¡¬t_time
));

1512 
	`åršt_msg
("Processime %.3fs\n",

1513 (()(
’d_şock
-
¡¬t_şock
)/
CLOCKS_PER_SEC
));

1517 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1519 
	}
}

1530 
	$sk_backw¬ds
(
¡»am_cÚ‹xt
 
¡»am
,

1531 
TS_wr™”_p
 
ouut
,

1532 
num_to_sk
,

1533 
v”bo£
,

1534 
qu›t
,

1535 
tsdœeù
,

1536 
»v”£_d©a_p
 
»v”£_d©a
)

1538 
”r
;

1539 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

1540 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

1542 ià(!
tsdœeù
)

1546 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
ouut
);

1547 ià(
”r
) ƒrr;

1550 ià(
exŒa_šfo
è
	`åršt_msg
("Skpšg backw¬d (%d f¿mes)\n",
num_to_sk
);

1553 
	`tswr™e_£t_commªd_©omic
(
ouut
,
TRUE
);

1555 
”r
 = 
	`ouut_š_»v”£_as_TS
(
es
,
ouut
,
num_to_sk
,
v”bo£
,
qu›t
,

1556 -1,
num_to_sk
,
»v”£_d©a
);

1557 ià(
”r
 &&ƒ¼ !ğ
COMMAND_RETURN_CODE
)

1559 
	`´št_”r
("### Error skipping backwards\n");

1560 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1561  
”r
;

1564 
”r
 = 
	`»sync_aá”_»v”£
(
¡»am
,
ouut
,
v”bo£
,
qu›t
);

1565 ià(
”r
)

1567 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1568  
”r
;

1572 
	`tswr™e_£t_commªd_©omic
(
ouut
,
FALSE
);

1574 
	}
}

1585 
	$¶ay_»v”£
(
¡»am_cÚ‹xt
 
¡»am
,

1586 
TS_wr™”_p
 
ouut
,

1587 
v”bo£
,

1588 
qu›t
,

1589 
tsdœeù
,

1590 
äequ’cy
,

1591 
num_»v”£
,

1592 
»v”£_d©a_p
 
»v”£_d©a
)

1594 
”r
;

1595 
ES_p
 
es
 = 
	`EXTRACT_ES_FROM_STREAM
(
¡»am
);

1596 
PES_»ad”_p
 
»ad”
 = 
es
->reader;

1598 ià(
exŒa_šfo
è
	`´št_msg
("Reversing\n");

1600 ià(
tsdœeù
)

1604 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
ouut
);

1605 ià(
”r
) ƒrr;

1608 #ià
SHOW_REVERSE_DATA


1609 ià(
exŒa_šfo
)

1611 
ii
;

1612 
ii
=0; ii<
»v”£_d©a
->
Ëngth
; ii++)

1613 ià(
¡»am
.
is_h262
 && 
»v”£_d©a
->
£q_off£t
[
ii
] == 0)

1614 
	`åršt_msg
("%3d: seqh‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

1615 
ii
,

1616 
»v”£_d©a
->
¡¬t_fe
[
ii
],

1617 
»v”£_d©a
->
¡¬t_pkt
[
ii
],

1618 
»v”£_d©a
->
d©a_Ën
[
ii
]);

1620 
	`åršt_msg
("%3d: %4d‡ˆ" 
OFFSET_T_FORMAT
 "/%d for %d\n",

1621 
ii
,
»v”£_d©a
->
šdex
[ii],

1622 
»v”£_d©a
->
¡¬t_fe
[
ii
],

1623 
»v”£_d©a
->
¡¬t_pkt
[
ii
],

1624 
»v”£_d©a
->
d©a_Ën
[
ii
]);

1628 
”r
 = 
	`ouut_š_»v”£_as_TS
(
es
,
ouut
,
äequ’cy
,
v”bo£
,
qu›t
,

1629 -1,
num_»v”£
,
»v”£_d©a
);

1630 ià(
”r
 &&ƒ¼ !ğ
COMMAND_RETURN_CODE
)

1632 
	`´št_”r
("### Error outputting„eversed data\n");

1633  
”r
;

1637 
”r
 = 
	`»sync_aá”_»v”£
(
¡»am
,
ouut
,
v”bo£
,
qu›t
);

1638 ià(
”r
) ƒrr;

1639  
”r
;

1640 
	}
}

1649 
	$obey_commªd
(
this_commªd
,

1650 
Ï¡_commªd
,

1651 *
šdex
,

1652 
¡¬‹d
[
MAX_INPUT_FILES
],

1653 
PES_»ad”_p
 
»ad”
[
MAX_INPUT_FILES
],

1654 
¡»am_cÚ‹xt
 
¡»am
[
MAX_INPUT_FILES
],

1655 
f‹r_cÚ‹xt
 
fcÚ‹xt
[
MAX_INPUT_FILES
],

1656 
f‹r_cÚ‹xt
 
scÚ‹xt
[
MAX_INPUT_FILES
],

1657 
»v”£_d©a_p
 
»v”£_d©a
[
MAX_INPUT_FILES
],

1658 
TS_wr™”_p
 
tswr™”
,

1659 
video_Úly
,

1660 
v”bo£
,

1661 
qu›t
,

1662 
tsdœeù
,

1663 
w™h_£q_hdrs
,

1664 
fäequ’cy
,

1665 
räequ’cy
)

1667 
”r
 = 0;

1668 
Ãw_¡»am
;

1669 
which
 = *
šdex
;

1675 #ifdeà
DEBUG_COMMANDS


1676 
	`åršt_msg
("__ obeyšg commªd '%c'\n",
this_commªd
);

1678 
this_commªd
)

1680 
COMMAND_NORMAL
:

1681 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1683 
tswr™”
->
wh”e
.
sock‘
,
which
);

1684 ià(
Ï¡_commªd
 !ğ
COMMAND_NORMAL
 && 
¡¬‹d
[
which
])

1686 
”r
 = 
	`back_to_nÜm®
(
¡»am
[
which
],
tswr™”
,
tsdœeù
);

1687 ià(
”r
)  1;

1689 
¡¬‹d
[
which
] = 
TRUE
;

1690 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
video_Úly
);

1691 
”r
 = 
	`¶ay_nÜm®
(
¡»am
[
which
],
tswr™”
,
v”bo£
,
qu›t
,0,

1692 
tsdœeù
, 
»v”£_d©a
[
which
]);

1694 ià(
”r
 =ğ
COMMAND_RETURN_CODE
 && 
tswr™”
->
commªd
 !ğ
COMMAND_NORMAL
)

1695 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
[
which
],
tswr™”
,
v”bo£
,
qu›t
);

1698 
COMMAND_PAUSE
:

1699 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1701 
tswr™”
->
wh”e
.
sock‘
,
which
);

1702 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1703 
”r
 = 
	`wa™_fÜ_commªd
(
tswr™”
);

1706 
COMMAND_FAST
:

1707 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1709 
tswr™”
->
wh”e
.
sock‘
,
which
);

1710 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1711 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1712 
”r
 = 
	`¶ay_¡r³d
(
¡»am
[
which
],
scÚ‹xt
[which],
tswr™”
,

1713 
v”bo£
,
qu›t
,
tsdœeù
,0,
w™h_£q_hdrs
);

1716 
COMMAND_FAST_FAST
:

1717 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1719 
tswr™”
->
wh”e
.
sock‘
,
which
);

1720 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1721 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1722 
”r
 = 
	`¶ay_f‹»d
(
¡»am
[
which
],
fcÚ‹xt
[which],
tswr™”
,

1723 
v”bo£
,
qu›t
,
tsdœeù
,0,
fäequ’cy
,
w™h_£q_hdrs
);

1726 
COMMAND_REVERSE
:

1727 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1729 
tswr™”
->
wh”e
.
sock‘
,
which
);

1730 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1731 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1732 
”r
 = 
	`¶ay_»v”£
(
¡»am
[
which
],
tswr™”
,
v”bo£
,
qu›t
,

1733 
tsdœeù
,

1734 
räequ’cy
,0,
»v”£_d©a
[
which
]);

1735 ià(
”r
 == 0)

1737 ià(!
qu›t
è
	`åršt_msg
("S¹ oàf%d\n",
which
);

1738 
this_commªd
 = 
COMMAND_PAUSE
;

1743 
COMMAND_FAST_REVERSE
:

1744 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1746 
tswr™”
->
wh”e
.
sock‘
,
which
);

1747 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1748 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1749 
”r
 = 
	`¶ay_»v”£
(
¡»am
[
which
],
tswr™”
,
v”bo£
,
qu›t
,

1750 
tsdœeù
,

1751 2*
räequ’cy
,0,
»v”£_d©a
[
which
]);

1752 ià(
”r
 == 0)

1754 ià(!
qu›t
è
	`åršt_msg
("S¹ oàf%d\n",
which
);

1755 
this_commªd
 = 
COMMAND_PAUSE
;

1760 
COMMAND_SKIP_FORWARD
:

1761 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1763 
tswr™”
->
wh”e
.
sock‘
,
which
);

1764 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1765 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1766 
”r
 = 
	`sk_fÜw¬ds
(
¡»am
[
which
],
tswr™”
,

1767 
fcÚ‹xt
[
which
],
w™h_£q_hdrs
,

1768 
SMALL_SKIP_DISTANCE
,
v”bo£
,
qu›t
,
tsdœeù
);

1769 
this_commªd
 = 
COMMAND_NORMAL
;

1772 
COMMAND_SKIP_BACKWARD
:

1773 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1775 
tswr™”
->
wh”e
.
sock‘
,
which
);

1776 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1777 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1778 
”r
 = 
	`sk_backw¬ds
(
¡»am
[
which
],
tswr™”
,
SMALL_SKIP_DISTANCE
,

1779 
v”bo£
,
qu›t
,
tsdœeù
,
»v”£_d©a
[
which
]);

1780 
this_commªd
 = 
COMMAND_NORMAL
;

1783 
COMMAND_SKIP_FORWARD_LOTS
:

1784 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1786 
tswr™”
->
wh”e
.
sock‘
,
which
);

1787 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1788 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1789 
”r
 = 
	`sk_fÜw¬ds
(
¡»am
[
which
],
tswr™”
,

1790 
fcÚ‹xt
[
which
],
w™h_£q_hdrs
,

1791 
BIG_SKIP_DISTANCE
,
v”bo£
,
qu›t
,
tsdœeù
);

1792 
this_commªd
 = 
COMMAND_NORMAL
;

1795 
COMMAND_SKIP_BACKWARD_LOTS
:

1796 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1798 
tswr™”
->
wh”e
.
sock‘
,
which
);

1799 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1800 
	`£t_PES_»ad”_video_Úly
(
»ad”
[
which
],
TRUE
);

1801 
”r
 = 
	`sk_backw¬ds
(
¡»am
[
which
],
tswr™”
,
BIG_SKIP_DISTANCE
,

1802 
v”bo£
,
qu›t
,
tsdœeù
,
»v”£_d©a
[
which
]);

1803 
this_commªd
 = 
COMMAND_NORMAL
;

1806 
COMMAND_SELECT_FILE_0
:

1807 
Ãw_¡»am
 = 0;

1808 
chªge_¡»am
;

1810 
COMMAND_SELECT_FILE_1
:

1811 
Ãw_¡»am
 = 1;

1812 
chªge_¡»am
;

1814 
COMMAND_SELECT_FILE_2
:

1815 
Ãw_¡»am
 = 2;

1816 
chªge_¡»am
;

1818 
COMMAND_SELECT_FILE_3
:

1819 
Ãw_¡»am
 = 3;

1820 
chªge_¡»am
;

1822 
COMMAND_SELECT_FILE_4
:

1823 
Ãw_¡»am
 = 4;

1824 
chªge_¡»am
;

1826 
COMMAND_SELECT_FILE_5
:

1827 
Ãw_¡»am
 = 5;

1828 
chªge_¡»am
;

1830 
COMMAND_SELECT_FILE_6
:

1831 
Ãw_¡»am
 = 6;

1832 
chªge_¡»am
;

1834 
COMMAND_SELECT_FILE_7
:

1835 
Ãw_¡»am
 = 7;

1836 
chªge_¡»am
;

1838 
COMMAND_SELECT_FILE_8
:

1839 
Ãw_¡»am
 = 8;

1840 
chªge_¡»am
;

1842 
COMMAND_SELECT_FILE_9
:

1843 
Ãw_¡»am
 = 9;

1844 
chªge_¡»am
;

1846 
chªge_¡»am
:

1847 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1849 
tswr™”
->
wh”e
.
sock‘
,
Ãw_¡»am
);

1850 ià(
»ad”
[
Ãw_¡»am
] =ğ
NULL
)

1852 
	`åršt_msg
(".. No input file defined for stream %d - ignored\n",

1853 
Ãw_¡»am
);

1859 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
[
which
],
tswr™”
,
v”bo£
,
qu›t
);

1860 ià(
”r
 &&ƒ¼ !ğ
COMMAND_RETURN_CODE
 &&ƒ¼ !ğ
EOF
)

1861  
”r
;

1864 
	`¡İ_£rv”_ouut
(
»ad”
[
which
]);

1866 *
šdex
 = 
which
 = 
Ãw_¡»am
;

1873 
”r
 = 
	`»wšd_¡»am
(
¡»am
[
which
]);

1874 ià(
”r
)  1;

1876 
¡¬‹d
[
which
] = 
FALSE
;

1879 
this_commªd
 = 
COMMAND_NORMAL
;

1882 
COMMAND_QUIT
:

1883 ià(!
qu›t
è
	`åršt_msg
("****************************************\n"

1885 
which
,
tswr™”
->
wh”e
.
sock‘
);

1886  
EOF
;

1889 
	`åršt_”r
("!!! Commªd '%c' ignÜed\n",
this_commªd
);

1890 
this_commªd
 = 
COMMAND_NORMAL
;

1895 
”r
)

1898 
COMMAND_RETURN_CODE
:

1900 
EOF
:

1901 ià(!
qu›t
è
	`åršt_msg
("End oàf%d\n",
which
);

1902 
this_commªd
 = 
COMMAND_PAUSE
;

1905 
	`åršt_”r
("!!! E¼Ü…Ïyšg f%d -…ausšg\n",
which
);

1906 
this_commªd
 = 
COMMAND_PAUSE
;

1910 ià(
tswr™”
->
commªd_chªged
)

1913 
	}
}

1921 
	$¶ay
(
deçuÉ_šdex
,

1922 
PES_»ad”_p
 
»ad”
[
MAX_INPUT_FILES
],

1923 
¡»am_cÚ‹xt
 
¡»am
[
MAX_INPUT_FILES
],

1924 
f‹r_cÚ‹xt
 
fcÚ‹xt
[
MAX_INPUT_FILES
],

1925 
f‹r_cÚ‹xt
 
scÚ‹xt
[
MAX_INPUT_FILES
],

1926 
»v”£_d©a_p
 
»v”£_d©a
[
MAX_INPUT_FILES
],

1927 
TS_wr™”_p
 
tswr™”
,

1928 
video_Úly
,

1929 
v”bo£
,

1930 
qu›t
,

1931 
tsdœeù
,

1932 
w™h_£q_hdrs
,

1933 
fäequ’cy
,

1934 
räequ’cy
)

1936 
”r
;

1937 
ii
;

1938 
¡¬‹d
[
MAX_INPUT_FILES
];

1939 
which
 = 
deçuÉ_šdex
;

1948 
by‹
 
this_commªd
 = 
tswr™”
->
commªd
;

1949 
by‹
 
Ï¡_commªd
 = 
COMMAND_NOT_A_COMMAND
;

1951 
ii
=0; ii<
MAX_INPUT_FILES
; ii++)

1952 
¡¬‹d
[
ii
] = 
FALSE
;

1955 ià(
»ad”
[
which
] =ğ
NULL
)

1957 
	`åršt_”r
("### Default input stream %d has‚o‡ssociated file\n",

1958 
which
);

1962 ià(!
qu›t
)

1963 
	`åršt_msg
("S¹šg w™h iÅuˆ¡»am %d\n",
which
);

1967 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
[
which
],
tswr™”
);

1968 ià(
”r
) ƒrr;

1976 
tswr™”
->
commªd_chªged
 = 
FALSE
;

1978 
this_commªd
 = 
tswr™”
->
commªd
;

1980 #ifdeà
DEBUG_COMMANDS


1981 
	`åršt_msg
("xx Command is '%c',†ast command '%c'\n",

1982 
this_commªd
,
Ï¡_commªd
);

1985 
”r
 = 
	`obey_commªd
(
this_commªd
,
Ï¡_commªd
,&
which
,

1986 
¡¬‹d
,
»ad”
,
¡»am
,
fcÚ‹xt
,
scÚ‹xt
,
»v”£_d©a
,

1987 
tswr™”
,
video_Úly
,
v”bo£
,
qu›t
,
tsdœeù
,
w™h_£q_hdrs
,

1988 
fäequ’cy
,
räequ’cy
);

1989 ià(
”r
 =ğ
EOF
)

1991 ià(
”r
)

1993 
	`´št_”r
("### Errorerminated…lay\n");

1996 
Ï¡_commªd
 = 
this_commªd
;

1998 
	}
}

2006 
	$¶ay_³s_·ck‘s
(
PES_»ad”_p
 
»ad”
[
MAX_INPUT_FILES
],

2007 
TS_wr™”_p
 
tswr™”
,

2008 
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

2009 
v”bo£
,

2010 
qu›t
)

2012 
”r
;

2013 
ii
;

2014 
ES_p
 
es
[
MAX_INPUT_FILES
];

2015 
»v”£_d©a_p
 
»v”£_d©a
[
MAX_INPUT_FILES
];

2016 
¡»am_cÚ‹xt
 
¡»am
[
MAX_INPUT_FILES
];

2017 
f‹r_cÚ‹xt
 
fcÚ‹xt
[
MAX_INPUT_FILES
];

2018 
f‹r_cÚ‹xt
 
scÚ‹xt
[
MAX_INPUT_FILES
];

2020 ià(!
qu›t
)

2021 
	`´št_msg
("\nSetting upƒnvironment\n");

2027 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

2029 ià(
»ad”
[
ii
] !ğ
NULL
)

2031 
	`£t_£rv”_ouut
(
»ad”
[
ii
],
tswr™”
,!
cÚ‹xt
->
tsdœeù
,

2032 
cÚ‹xt
->
»³©_´og¿m_ev”y
);

2033 
	`£t_£rv”_·ddšg
(
»ad”
[
ii
],
cÚ‹xt
->
³s_·ddšg
);

2037 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

2039 
es
[
ii
] = 
NULL
;

2040 
»v”£_d©a
[
ii
] = 
NULL
;

2047 
¡»am
[
ii
].
is_h262
 = 
fcÚ‹xt
[ii].is_h262 = 
scÚ‹xt
[ii].is_h262 = 
FALSE
;

2048 
¡»am
[
ii
].
u
.
h262
 = 
NULL
;

2049 
fcÚ‹xt
[
ii
].
u
.
h262
 = 
scÚ‹xt
[ii].u.h262 = 
NULL
;

2055 
ii
=0; ii<
cÚ‹xt
->
·d_¡¬t
; ii++)

2057 
”r
 = 
	`wr™e_TS_nuÎ_·ck‘
(
tswr™”
);

2058 ià(
”r
)  1;

2062 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

2064 ià(
»ad”
[
ii
] =ğ
NULL
)

2067 ià(!
qu›t
)

2068 
	`åršt_msg
("S‘tšg u°¡»am %d\n",
ii
);

2078 
”r
 = 
	`bud_–em’ry_¡»am_PES
(
»ad”
[
ii
],&
es
[ii]);

2079 ià(
”r
)

2081 
	`åršt_”r
("### E¼ÜryšgØbud ES„—d” fÜ PES„—d” %d\n",
ii
);

2082 
tidy_up
;

2086 
”r
 = 
	`bud_¡»am
(
es
[
ii
],!(
»ad”
[ii]->
is_h264
),ii+1,&
¡»am
[ii]);

2087 ià(
”r
)

2089 
	`åršt_”r
("### UÇbËØbud iÅuˆ¡»am %d\n",
ii
);

2090 
tidy_up
;

2094 
”r
 = 
	`bud_ªd_©ch_»v”£
(
¡»am
[
ii
],&
»v”£_d©a
[ii]);

2095 ià(
”r
)

2097 
	`åršt_”r
("### UÇbËØbud„ev”£ memÜy fÜ sŒ—m %d\n",
ii
);

2098 
tidy_up
;

2103 
	`£t_»v”£_pid
(
»v”£_d©a
[
ii
],
»ad”
[ii]->
ouut_video_pid
,

2104 
DEFAULT_VIDEO_STREAM_ID
);

2106 ià(!
cÚ‹xt
->
w™h_£q_hdrs
)

2107 
»v”£_d©a
[
ii
]->
ouut_£qu’û_h—d”s
 = 
FALSE
;

2110 
”r
 = 
	`bud_f‹r_cÚ‹xt
(
¡»am
[
ii
],
FALSE
,
cÚ‹xt
->
fäequ’cy
,&
fcÚ‹xt
[ii]);

2111 ià(
”r
)

2113 
	`åršt_”r
("### UÇbËØbud f‹¸cÚ‹xˆfÜ sŒ—m %d\n",
ii
);

2114 
tidy_up
;

2118 
”r
 = 
	`bud_f‹r_cÚ‹xt
(
¡»am
[
ii
],
TRUE
,0,&
scÚ‹xt
[ii]);

2119 ià(
”r
)

2121 
	`åršt_”r
("### UÇbËØbud sŒ cÚ‹xˆfÜ sŒ—m %d\n",
ii
);

2122 
tidy_up
;

2127 
”r
 = 
	`¶ay
(
cÚ‹xt
->
deçuÉ_fe_šdex
,
»ad”
,
¡»am
,
fcÚ‹xt
,
scÚ‹xt
,
»v”£_d©a
,

2128 
tswr™”
,
cÚ‹xt
->
video_Úly
,
v”bo£
,
qu›t
,cÚ‹xt->
tsdœeù
,

2129 
cÚ‹xt
->
w™h_£q_hdrs
,cÚ‹xt->
fäequ’cy
,cÚ‹xt->
räequ’cy
);

2131 
tidy_up
:

2132 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

2134 
	`şo£_–em’ry_¡»am
(&
es
[
ii
]);

2135 
	`ä“_»v”£_d©a
(&
»v”£_d©a
[
ii
]);

2136 
	`şo£_¡»am
(
¡»am
[
ii
]);

2137 
	`ä“_f‹r_cÚ‹xt
(
fcÚ‹xt
[
ii
]);

2138 
	`ä“_f‹r_cÚ‹xt
(
scÚ‹xt
[
ii
]);

2141  
”r
;

2142 
	}
}

2150 
	$‹¡_¶ay
(
PES_»ad”_p
 
»ad”
,

2151 
¡»am_cÚ‹xt
 
¡»am
,

2152 
f‹r_cÚ‹xt
 
fcÚ‹xt
,

2153 
f‹r_cÚ‹xt
 
scÚ‹xt
,

2154 
»v”£_d©a_p
 
»v”£_d©a
,

2155 
TS_wr™”_p
 
tswr™”
,

2156 
video_Úly
,

2157 
v”bo£
,

2158 
qu›t
,

2159 
tsdœeù
,

2160 
num_nÜm®
,

2161 
num_ç¡
,

2162 
num_ç¡”
,

2163 
num_»v”£
,

2164 
fäequ’cy
,

2165 
räequ’cy
,

2166 
w™h_£q_hdrs
)

2168 
”r
 = 0;

2169 
¡¬‹d
 = 
FALSE
;

2170 
ii
;

2172 ià(
num_ç¡
 =ğ0 && 
num_ç¡”
 =ğ0 && 
num_»v”£
 == 0)

2175 
	`´št_msg
(">> Just…laying‡t‚ormal speed\n");

2176 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2177 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,0,
»v”£_d©a
);

2178 ià(
”r
 =ğ
EOF
)

2181  
”r
;

2184 
	`´št_msg
(">> Goinghrough sequencewice\n");

2186 
ii
=0; ii<2; ii++)

2189 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2190 
	`åršt_msg
("** NÜm® s³ed fÜ %d\n",
num_nÜm®
);

2191 ià(
¡¬‹d
)

2193 
”r
 = 
	`back_to_nÜm®
(
¡»am
,
tswr™”
,
tsdœeù
);

2194 ià(
”r
)  1;

2196 
¡¬‹d
 = 
TRUE
;

2198 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2199 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,
num_nÜm®
,
»v”£_d©a
);

2200 ià(
”r
 =ğ
EOF
)

2202 ià(
”r
)

2205 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
);

2206 ià(
”r
 =ğ
EOF
)

2208 ià(
”r
)

2211 
	`¡İ_£rv”_ouut
(
»ad”
);

2214 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2215 
	`åršt_msg
("** Fa¡ fÜw¬d fÜ %d\n",
num_ç¡
);

2216 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2217 
”r
 = 
	`¶ay_¡r³d
(
¡»am
,
scÚ‹xt
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,

2218 
num_ç¡
,

2219 
w™h_£q_hdrs
);

2220 ià(
”r
 =ğ
EOF
)

2222 ià(
”r
)

2226 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2227 
	`åršt_msg
("** NÜm® s³ed fÜ %d\n",
num_nÜm®
);

2229 
”r
 = 
	`back_to_nÜm®
(
¡»am
,
tswr™”
,
tsdœeù
);

2230 ià(
”r
)  1;

2232 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2233 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,
num_nÜm®
,
»v”£_d©a
);

2234 ià(
”r
 =ğ
EOF
)

2236 ià(
”r
)

2239 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
);

2240 ià(
”r
 =ğ
EOF
)

2242 ià(
”r
)

2245 
	`¡İ_£rv”_ouut
(
»ad”
);

2248 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2249 
	`åršt_msg
("** Fa¡” fÜw¬d fÜ %d\n",
num_ç¡”
);

2250 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2251 
”r
 = 
	`¶ay_f‹»d
(
¡»am
,
fcÚ‹xt
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,

2252 
num_ç¡”
,

2253 
fäequ’cy
,
w™h_£q_hdrs
);

2254 ià(
”r
 =ğ
EOF
)

2256 ià(
”r
)

2260 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2261 
	`åršt_msg
("** NÜm® s³ed fÜ %d\n",
num_nÜm®
);

2263 
”r
 = 
	`back_to_nÜm®
(
¡»am
,
tswr™”
,
tsdœeù
);

2264 ià(
”r
)  1;

2266 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2267 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,
num_nÜm®
,
»v”£_d©a
);

2268 ià(
”r
 =ğ
EOF
)

2270 ià(
”r
)

2273 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
);

2274 ià(
”r
 =ğ
EOF
)

2276 ià(
”r
)

2279 
	`¡İ_£rv”_ouut
(
»ad”
);

2282 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2283 
	`åršt_msg
("** Rev”£ fÜ %d\n",
num_»v”£
);

2284 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2285 
”r
 = 
	`¶ay_»v”£
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
räequ’cy
,

2286 
tsdœeù
,

2287 
num_»v”£
,
»v”£_d©a
);

2288 ià(
”r
 =ğ
EOF
)

2290 ià(
”r
)

2294 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2295 ià(
”r
 =ğ
EOF
)

2296 
	`´št_msg
("** End of file\n");

2298 
	`´št_msg
(">> End of sequences\n");

2300 
	}
}

2308 
	$‹¡_sk
(
PES_»ad”_p
 
»ad”
,

2309 
¡»am_cÚ‹xt
 
¡»am
,

2310 
f‹r_cÚ‹xt
 
fcÚ‹xt
,

2311 
f‹r_cÚ‹xt
 
scÚ‹xt
,

2312 
»v”£_d©a_p
 
»v”£_d©a
,

2313 
TS_wr™”_p
 
tswr™”
,

2314 
video_Úly
,

2315 
v”bo£
,

2316 
qu›t
,

2317 
tsdœeù
,

2318 
w™h_£q_hdrs
)

2320 
”r
 = 0;

2321 
num_nÜm®
 = 100;

2322 
¡¬‹d
 = 
FALSE
;

2323 
ii
;

2325 
	`´št_msg
(">> Goinghrough sequence once\n");

2327 
ii
=0; ii<1; ii++)

2329 
	`åršt_msg
("\n>> I‹¿tiÚ %d\n\n",
ii
);

2332 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2333 
	`åršt_msg
("** NÜm® s³ed fÜ %d\n",
num_nÜm®
);

2334 ià(
¡¬‹d
)

2336 
”r
 = 
	`back_to_nÜm®
(
¡»am
,
tswr™”
,
tsdœeù
);

2337 ià(
”r
)  1;

2339 
¡¬‹d
 = 
TRUE
;

2341 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2342 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,
num_nÜm®
,
»v”£_d©a
);

2343 ià(
”r
 =ğ
EOF
)

2345 ià(
”r
)

2348 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
);

2349 ià(
”r
 =ğ
EOF
)

2351 ià(
”r
)

2355 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2356 
	`´št_msg
("** Skip forwards\n");

2357 
	`¡İ_£rv”_ouut
(
»ad”
);

2358 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2359 
”r
 = 
	`sk_fÜw¬ds
(
¡»am
,
tswr™”
,
fcÚ‹xt
,
w™h_£q_hdrs
,

2360 
SMALL_SKIP_DISTANCE
,
v”bo£
,
qu›t
,
tsdœeù
);

2361 ià(
”r
 =ğ
EOF
)

2363 ià(
”r
)

2367 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2368 
	`´št_msg
("** Skip forwards\n");

2369 
	`¡İ_£rv”_ouut
(
»ad”
);

2370 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2371 
”r
 = 
	`sk_fÜw¬ds
(
¡»am
,
tswr™”
,
fcÚ‹xt
,
w™h_£q_hdrs
,

2372 
SMALL_SKIP_DISTANCE
,
v”bo£
,
qu›t
,
tsdœeù
);

2373 ià(
”r
 =ğ
EOF
)

2375 ià(
”r
)

2379 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2380 
	`åršt_msg
("** NÜm® s³ed fÜ %d\n",
num_nÜm®
);

2382 
”r
 = 
	`back_to_nÜm®
(
¡»am
,
tswr™”
,
tsdœeù
);

2383 ià(
”r
)  1;

2385 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2386 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,
num_nÜm®
,
»v”£_d©a
);

2387 ià(
”r
 =ğ
EOF
)

2389 ià(
”r
)

2392 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
);

2393 ià(
”r
 =ğ
EOF
)

2395 ià(
”r
)

2399 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2400 
	`´št_msg
("** Skip backwards\n");

2401 
	`¡İ_£rv”_ouut
(
»ad”
);

2402 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2403 
”r
 = 
	`sk_backw¬ds
(
¡»am
,
tswr™”
,1,
v”bo£
,
qu›t
,
tsdœeù
,
»v”£_d©a
);

2404 ià(
”r
 =ğ
EOF
)

2406 ià(
”r
)

2410 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2411 
	`´št_msg
("** Skip backwards\n");

2412 
	`¡İ_£rv”_ouut
(
»ad”
);

2413 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2414 
”r
 = 
	`sk_backw¬ds
(
¡»am
,
tswr™”
,1,
v”bo£
,
qu›t
,
tsdœeù
,
»v”£_d©a
);

2415 ià(
”r
 =ğ
EOF
)

2417 ià(
”r
)

2421 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2422 
	`åršt_msg
("** NÜm® s³ed fÜ %d\n",
num_nÜm®
);

2424 
”r
 = 
	`back_to_nÜm®
(
¡»am
,
tswr™”
,
tsdœeù
);

2425 ià(
”r
)  1;

2427 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2428 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,
num_nÜm®
,
»v”£_d©a
);

2429 ià(
”r
 =ğ
EOF
)

2431 ià(
”r
)

2434 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
);

2435 ià(
”r
 =ğ
EOF
)

2437 ià(
”r
)

2441 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2442 
	`´št_msg
("** Skip forwards\n");

2443 
	`¡İ_£rv”_ouut
(
»ad”
);

2444 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2445 
”r
 = 
	`sk_fÜw¬ds
(
¡»am
,
tswr™”
,
fcÚ‹xt
,
w™h_£q_hdrs
,

2446 
SMALL_SKIP_DISTANCE
,
v”bo£
,
qu›t
,
tsdœeù
);

2447 ià(
”r
 =ğ
EOF
)

2449 ià(
”r
)

2453 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2454 
	`´št_msg
("** Skip backwards\n");

2455 
	`¡İ_£rv”_ouut
(
»ad”
);

2456 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
TRUE
);

2457 
”r
 = 
	`sk_backw¬ds
(
¡»am
,
tswr™”
,1,
v”bo£
,
qu›t
,
tsdœeù
,
»v”£_d©a
);

2458 ià(
”r
 =ğ
EOF
)

2460 ià(
”r
)

2465 
num_nÜm®
 = 100;

2466 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2467 
	`åršt_msg
("** NÜm® s³ed fÜ %d\n",
num_nÜm®
);

2469 
”r
 = 
	`back_to_nÜm®
(
¡»am
,
tswr™”
,
tsdœeù
);

2470 ià(
”r
)  1;

2472 
	`£t_PES_»ad”_video_Úly
(
»ad”
,
video_Úly
);

2473 
”r
 = 
	`¶ay_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
,
tsdœeù
,
num_nÜm®
,
»v”£_d©a
);

2474 ià(
”r
 =ğ
EOF
)

2476 
	`´št_msg
("** End of file\n");

2479 ià(
”r
)

2482 
”r
 = 
	`æush_aá”_nÜm®
(
¡»am
,
tswr™”
,
v”bo£
,
qu›t
);

2483 ià(
”r
 =ğ
EOF
)

2485 
	`´št_msg
("** End of file\n");

2488 ià(
”r
)

2492 ià(
v”bo£
 || 
exŒa_šfo
è
	`´št_msg
("\n\n");

2493 ià(
”r
 =ğ
EOF
)

2494 
	`´št_msg
("** End of file\n");

2496 
	`´št_msg
(">> End of sequences\n");

2498 
	}
}

2506 
	$‹¡_¶ay_³s_·ck‘s
(
PES_»ad”_p
 
»ad”
,

2507 
TS_wr™”_p
 
tswr™”
,

2508 
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

2509 
·d_¡¬t
,

2510 
video_Úly
,

2511 
v”bo£
,

2512 
qu›t
,

2513 
tsdœeù
,

2514 
num_nÜm®
,

2515 
num_ç¡
,

2516 
num_ç¡”
,

2517 
num_»v”£
,

2518 
fäequ’cy
,

2519 
räequ’cy
,

2520 
sk‹¡
,

2521 
w™h_£q_hdrs
)

2523 
”r
;

2524 
ii
;

2525 
ES_p
 
es
;

2526 
»v”£_d©a_p
 
»v”£_d©a
 = 
NULL
;

2527 
¡»am_cÚ‹xt
 
¡»am
;

2528 
f‹r_cÚ‹xt
 
fcÚ‹xt
;

2529 
f‹r_cÚ‹xt
 
scÚ‹xt
;

2535 
ii
=0; ii<
·d_¡¬t
; ii++)

2537 
”r
 = 
	`wr™e_TS_nuÎ_·ck‘
(
tswr™”
);

2538 ià(
”r
)  1;

2543 
¡»am
.
´og¿m_numb”
 = 1;

2544 
”r
 = 
	`wr™e_´og¿m_d©a
(
»ad”
,
tswr™”
);

2545 ià(
”r
) ƒrr;

2550 
	`£t_£rv”_ouut
(
»ad”
,
tswr™”
,!
cÚ‹xt
->
tsdœeù
,

2551 
cÚ‹xt
->
»³©_´og¿m_ev”y
);

2552 
	`£t_£rv”_·ddšg
(
»ad”
,
cÚ‹xt
->
³s_·ddšg
);

2555 
”r
 = 
	`bud_–em’ry_¡»am_PES
(
»ad”
,&
es
);

2556 ià(
”r
)

2558 
	`´št_”r
("### Errorryingo build ES„eader from PES„eader\n");

2563 
”r
 = 
	`bud_»v”£_d©a
(&
»v”£_d©a
,
»ad”
->
is_h264
);

2564 ià(
”r
)

2566 
	`´št_”r
("### Unableo build„everse memory\n");

2567 
	`şo£_–em’ry_¡»am
(&
es
);

2571 
¡»am
.
is_h262
 = 
fcÚ‹xt
.is_h262 = 
scÚ‹xt
.is_h262 = !(
»ad”
->
is_h264
);

2573 ià(
»ad”
->
is_h264
)

2575 
acûss_un™_cÚ‹xt_p
 
acÚ‹xt
;

2576 
h264_f‹r_cÚ‹xt_p
 
fcÚ‹xt4
 = 
NULL
;

2577 
h264_f‹r_cÚ‹xt_p
 
scÚ‹xt4
 = 
NULL
;

2579 
”r
 = 
	`bud_acûss_un™_cÚ‹xt
(
es
,&
acÚ‹xt
);

2580 ià(
”r
)

2582 
	`´št_”r
("### Errorryingo build‡ccess unit„eader from ES„eader\n");

2583 
	`şo£_–em’ry_¡»am
(&
es
);

2584 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

2587 
	`add_acûss_un™_»v”£_cÚ‹xt
(
acÚ‹xt
,
»v”£_d©a
);

2589 
”r
 = 
	`bud_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt4
,
acÚ‹xt
,
fäequ’cy
);

2590 ià(
”r
)

2592 
	`´št_”r
("### Unableo build filter context\n");

2593 
	`şo£_–em’ry_¡»am
(&
es
);

2594 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

2595 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

2599 
”r
 = 
	`bud_h264_f‹r_cÚ‹xt_¡r
(&
scÚ‹xt4
,
acÚ‹xt
,
TRUE
);

2600 ià(
”r
)

2602 
	`´št_”r
("### Unableo build strip context\n");

2603 
	`şo£_–em’ry_¡»am
(&
es
);

2604 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

2605 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

2606 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt4
);

2610 
¡»am
.
u
.
h264
 = 
acÚ‹xt
;

2611 
fcÚ‹xt
.
u
.
h264
 = 
fcÚ‹xt4
;

2612 
scÚ‹xt
.
u
.
h264
 = 
scÚ‹xt4
;

2614 ià(
sk‹¡
)

2615 
”r
 = 
	`‹¡_sk
(
»ad”
,
¡»am
,
fcÚ‹xt
,
scÚ‹xt
,
»v”£_d©a
,
tswr™”
,

2616 
video_Úly
,
v”bo£
,
qu›t
,
tsdœeù
,
FALSE
);

2618 
”r
 = 
	`‹¡_¶ay
(
»ad”
,
¡»am
,
fcÚ‹xt
,
scÚ‹xt
,
»v”£_d©a
,
tswr™”
,

2619 
video_Úly
,
v”bo£
,
qu›t
,
tsdœeù
,

2620 
num_nÜm®
,
num_ç¡
,
num_ç¡”
,
num_»v”£
,

2621 
fäequ’cy
,
räequ’cy
,
FALSE
);

2623 
	`ä“_acûss_un™_cÚ‹xt
(&
acÚ‹xt
);

2624 
	`ä“_h264_f‹r_cÚ‹xt
(&
fcÚ‹xt4
);

2625 
	`ä“_h264_f‹r_cÚ‹xt
(&
scÚ‹xt4
);

2629 
h262_cÚ‹xt_p
 
h262
;

2630 
h262_f‹r_cÚ‹xt_p
 
fcÚ‹xt2
 = 
NULL
;

2631 
h262_f‹r_cÚ‹xt_p
 
scÚ‹xt2
 = 
NULL
;

2633 ià(!
w™h_£q_hdrs
)

2634 
»v”£_d©a
->
ouut_£qu’û_h—d”s
 = 
FALSE
;

2636 
”r
 = 
	`bud_h262_cÚ‹xt
(
es
,&
h262
);

2637 ià(
”r
)

2639 
	`´št_”r
("### Errorryingo build H.262„eader from ES„eader\n");

2640 
	`şo£_–em’ry_¡»am
(&
es
);

2641 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

2644 
	`add_h262_»v”£_cÚ‹xt
(
h262
,
»v”£_d©a
);

2646 
”r
 = 
	`bud_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt2
,
h262
,
fäequ’cy
);

2647 ià(
”r
)

2649 
	`´št_”r
("### Unableo build filter context\n");

2650 
	`şo£_–em’ry_¡»am
(&
es
);

2651 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

2652 
	`ä“_h262_cÚ‹xt
(&
h262
);

2656 
”r
 = 
	`bud_h262_f‹r_cÚ‹xt_¡r
(&
scÚ‹xt2
,
h262
,
TRUE
);

2657 ià(
”r
)

2659 
	`´št_”r
("### Unableo build strip context\n");

2660 
	`şo£_–em’ry_¡»am
(&
es
);

2661 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

2662 
	`ä“_h262_cÚ‹xt
(&
h262
);

2663 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt2
);

2667 
¡»am
.
u
.
h262
 = h262;

2668 
fcÚ‹xt
.
u
.
h262
 = 
fcÚ‹xt2
;

2669 
scÚ‹xt
.
u
.
h262
 = 
scÚ‹xt2
;

2671 ià(
sk‹¡
)

2672 
”r
 = 
	`‹¡_sk
(
»ad”
,
¡»am
,
fcÚ‹xt
,
scÚ‹xt
,
»v”£_d©a
,
tswr™”
,

2673 
video_Úly
,
v”bo£
,
qu›t
,
tsdœeù
,
w™h_£q_hdrs
);

2675 
”r
 = 
	`‹¡_¶ay
(
»ad”
,
¡»am
,
fcÚ‹xt
,
scÚ‹xt
,
»v”£_d©a
,
tswr™”
,

2676 
video_Úly
,
v”bo£
,
qu›t
,
tsdœeù
,

2677 
num_nÜm®
,
num_ç¡
,
num_ç¡”
,
num_»v”£
,

2678 
fäequ’cy
,
räequ’cy
,
w™h_£q_hdrs
);

2680 
	`ä“_h262_cÚ‹xt
(&
h262
);

2681 
	`ä“_h262_f‹r_cÚ‹xt
(&
fcÚ‹xt2
);

2682 
	`ä“_h262_f‹r_cÚ‹xt
(&
scÚ‹xt2
);

2685 
	`şo£_–em’ry_¡»am
(&
es
);

2686 
	`ä“_»v”£_d©a
(&
»v”£_d©a
);

2688  
”r
;

2689 
	}
}

2691 
	$İ’_šput_fe
(
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

2692 
qu›t
,

2693 
v”bo£
,

2694 
PES_»ad”_p
 *
»ad”
)

2696 
”r
 = 
	`İ’_PES_»ad”
(
cÚ‹xt
->
šput_Çmes
[cÚ‹xt->
deçuÉ_fe_šdex
],

2697 !
qu›t
,
v”bo£
,
»ad”
);

2698 ià(
”r
)

2700 
	`åršt_”r
("### Error opening file %s\n",

2701 
cÚ‹xt
->
šput_Çmes
[cÚ‹xt->
deçuÉ_fe_šdex
]);

2705 ià(!
qu›t
)

2706 
	`åršt_msg
("Opened input file %s (as %s)\n",

2707 
cÚ‹xt
->
šput_Çmes
[cÚ‹xt->
deçuÉ_fe_šdex
],

2708 ((*
»ad”
)->
is_TS
?"TS":"PS"));

2711 ià(!(*
»ad”
)->
is_TS
 && 
cÚ‹xt
->
fÜû_¡»am_ty³
 &&

2712 (*
»ad”
)->
is_h264
 =ğ
cÚ‹xt
->
wªt_h262
)

2714 ià(!
qu›t
)

2715 
	`åršt_msg
("File‡ppearedo contain %s, forcing %s\n",

2716 (*
»ad”
)->
is_h264
?"MPEG-4/AVC (H.264)":"MPEG-2 (H.272)",

2717 
cÚ‹xt
->
wªt_h262
?"MPEG-2":"MPEG-4/AVC");

2718 
	`£t_PES_»ad”_h264
(*
»ad”
);

2722 ià(!(*
»ad”
)->
is_TS
)

2724 
	`£t_PES_»ad”_´og¿m_d©a
(*
»ad”
,1,

2725 
cÚ‹xt
->
pmt_pid
, cÚ‹xt->
video_pid
,

2726 
cÚ‹xt
->
audio_pid
,cÚ‹xt->
pü_pid
);

2727 
	`£t_PES_»ad”_dŞby_¡»am_ty³
(*
»ad”
,
cÚ‹xt
->
dŞby_is_dvb
);

2732 (*
»ad”
)->
debug_»ad_·ck‘s
 = 
exŒa_šfo
;

2734 
	}
}

2736 
	$İ’_šput_fes
(
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

2737 
qu›t
,

2738 
v”bo£
,

2739 
PES_»ad”_p
 
»ad”
[
MAX_INPUT_FILES
])

2741 
ii
;

2742 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

2744 
”r
;

2745 ià(
cÚ‹xt
->
šput_Çmes
[
ii
] =ğ
NULL
)

2747 
»ad”
[
ii
] = 
NULL
;

2751 ià(!
qu›t
)

2752 
	`åršt_msg
("\nLookšg‡ˆšpuˆf%d, %s\n",
ii
,
cÚ‹xt
->
šput_Çmes
[ii]);

2754 
”r
 = 
	`İ’_PES_»ad”
(
cÚ‹xt
->
šput_Çmes
[
ii
],!
qu›t
,
v”bo£
,&
»ad”
[ii]);

2755 ià(
”r
)

2757 
	`åršt_”r
("!!! Error opening file %d (%s)\n",

2758 
ii
,
cÚ‹xt
->
šput_Çmes
[ii]);

2760 
»ad”
[
ii
] = 
NULL
;

2764 ià(!
qu›t
)

2765 
	`åršt_msg
("O³Ãd iÅuˆf%2d, %s,‡ %s\n",
ii
,
cÚ‹xt
->
šput_Çmes
[ii],

2766 (
»ad”
[
ii
]->
is_TS
?"TS":"PS"));

2771 ià(!
»ad”
[
ii
]->
is_TS
 && 
cÚ‹xt
->
fÜû_¡»am_ty³
 &&

2772 
»ad”
[
ii
]->
is_h264
 =ğ
cÚ‹xt
->
wªt_h262
)

2774 ià(!
qu›t
)

2775 
	`åršt_msg
("File‡ppearedo contain %s, forcing %s\n",

2776 
»ad”
[
ii
]->
is_h264
?"MPEG-4/AVC (H.264)":"MPEG-2 (H.272)",

2777 
cÚ‹xt
->
wªt_h262
?"MPEG-2":"MPEG-4/AVC");

2778 
	`£t_PES_»ad”_h264
(
»ad”
[
ii
]);

2783 
	`£t_PES_»ad”_´og¿m_d©a
(
»ad”
[
ii
],

2784 
ii
+1,

2785 
DEFAULT_VIDEO_PID
+
ii
+20,

2786 
DEFAULT_VIDEO_PID
+
ii
,

2787 
DEFAULT_VIDEO_PID
+
ii
+10,

2788 
DEFAULT_VIDEO_PID
+
ii
);

2792 
»ad”
[
ii
]->
debug_»ad_·ck‘s
 = 
exŒa_šfo
;

2795 
	}
}

2801 
	s£rv”_¬gs


2803 
ts£rve_cÚ‹xt_p
 
	mcÚ‹xt
;

2804 
TS_wr™”_p
 
	mtswr™”
;

2805 
	mv”bo£
;

2806 
	mqu›t
;

2809 
	$ts£rve_chd_´oûss
(
£rv”_¬gs
 *
¬gs
)

2811 
ii
, 
”r
;

2812 
had_”r
;

2813 
ts£rve_cÚ‹xt_p
 
cÚ‹xt
 = 
¬gs
->context;

2814 
TS_wr™”_p
 
tswr™”
 = 
¬gs
->tswriter;

2815 
v”bo£
 = 
¬gs
->verbose;

2816 
qu›t
 = 
¬gs
->quiet;

2817 
PES_»ad”_p
 
»ad”
[
MAX_INPUT_FILES
];

2819 ià(!
qu›t
è
	`åršt_msg
("Establishing connection with client on socket %d\n",

2820 
tswr™”
->
wh”e
.
sock‘
);

2822 
”r
 = 
	`tswr™e_¡¬t_šput
(
tswr™”
,tswr™”->
wh”e
.
sock‘
);

2823 ià(
”r
)

2825 
	`´št_”r
("### Unableo start command input from client\n");

2826 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

2830 
”r
 = 
	`İ’_šput_fes
(
cÚ‹xt
,
qu›t
,
v”bo£
,
»ad”
);

2831 ià(
”r
)

2833 
	`´št_”r
("### Unableo open input file\n");

2834 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

2839 ià(!
qu›t
è
	`åršt_msg
("Playingo client via socket %d\n",

2840 
tswr™”
->
wh”e
.
sock‘
);

2842 
”r
 = 
	`¶ay_³s_·ck‘s
(
»ad”
,
tswr™”
,
cÚ‹xt
,
v”bo£
,
qu›t
);

2843 ià(
”r
)

2845 
	`´št_”r
("!!! Error…laying PES…acketso client\n");

2846 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

2847 
ii
=0;ii<
MAX_INPUT_FILES
;ii++)

2848 (è
	`şo£_PES_»ad”
(&
»ad”
[
ii
]);

2852 ià(!
qu›t
è
	`´št_msg
("Finishedalkingo client\n");

2853 
”r
 = 
	`tswr™e_şo£
(
tswr™”
,
qu›t
);

2854 ià(
”r
)

2856 
ii
=0;ii<
MAX_INPUT_FILES
;ii++)

2857 (è
	`şo£_PES_»ad”
(&
»ad”
[
ii
]);

2861 
had_”r
 = 
FALSE
;

2862 
ii
=0;ii<
MAX_INPUT_FILES
;ii++)

2864 
”r
 = 
	`şo£_PES_»ad”
(&
»ad”
[
ii
]);

2865 ià(
”r
)

2867 
	`åršt_”r
("### E¼Ü closšg iÅuˆf%d, %s\n",
ii
,

2868 
cÚ‹xt
->
šput_Çmes
[
ii
]);

2869 
had_”r
 = 
TRUE
;

2873 #ifdeà
_WIN32


2877 
	`ä“
(
¬gs
);

2880  (
had_”r
?1:0);

2881 
	}
}

2883 #ifdeà
_WIN32


2890 
	$chd_th»ad_â
(
void_p
 
v¬g
)

2892 
£rv”_¬gs
 *
¬gs
 = (£rv”_¬g *)
v¬g
;

2893 (è
	`ts£rve_chd_´oûss
(
¬gs
);

2894 
	}
}

2899 
	$¡¬t_chd
(
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

2900 
TS_wr™”_p
 
tswr™”
,

2901 
v”bo£
,

2902 
qu›t
)

2904 
HANDLE
 
chd_th»ad
;

2905 
£rv”_¬gs
 *
¬gs
;

2907 
¬gs
 = 
	`m®loc
((
£rv”_¬gs
));

2908 ià(
¬gs
 =ğ
NULL
)

2910 
	`´št_”r
("### Unableo‡llocate memory for child datastructure\n");

2914 
¬gs
->
cÚ‹xt
 = context;

2915 
¬gs
->
tswr™”
 =swriter;

2916 
¬gs
->
v”bo£
 = verbose;

2917 
¬gs
->
qu›t
 = quiet;

2919 
chd_th»ad
 = (
HANDLE
è
	`_begšth»ad
(
chd_th»ad_â
,0,(
void_p
)
¬gs
);

2920 ià(
chd_th»ad
 =ğ(
HANDLE
) -1)

2922 
	`åršt_”r
("E¼Ü c»©šg chd…roûss: %s\n",
	`¡»¼Ü
(
”ºo
));

2926 
	}
}

2934 
	$¡¬t_chd
(
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

2935 
TS_wr™”_p
 
tswr™”
,

2936 
v”bo£
,

2937 
qu›t
)

2939 
pid_t
 
pid
;

2940 
£rv”_¬gs
 
¬gs
 = {
cÚ‹xt
,
tswr™”
,
v”bo£
,
qu›t
};

2942 
pid
 = 
	`fÜk
();

2943 ià(
pid
 == -1)

2945 
	`åršt_”r
("E¼Ü fÜkšg: %s\n",
	`¡»¼Ü
(
”ºo
));

2948 ià(
pid
 == 0)

2951 
	`_ex™
(
	`ts£rve_chd_´oûss
(&
¬gs
));

2953 
tswr™”
->
chd
 = 
pid
;

2955 
	}
}

2957 
£t_chd_ex™_hªdËr
();

2961 
	$Ú_chd_ex™
()

2964 
	`´št_msg
("sighandler: starting\n");

2968 
¡©us
;

2969 
pid
 = 
	`wa™pid
(-1, &
¡©us
, 
WNOHANG
);

2971 ià(
pid
 > 0)

2972 
	`åršt_msg
("sighªdËr: fšished w™h chd %08x\n",
pid
);

2974 
	`åršt_msg
("sighªdËr: fšished w™h %d\n",
pid
);

2976 ià(
pid
 <= 0)

2979 
	}
}

2984 
	$£t_chd_ex™_hªdËr
()

2986 
»t
;

2987 
sigaùiÚ
 
aùiÚ
;

2988 
aùiÚ
.
§_hªdËr
 = 
Ú_chd_ex™
;

2989 
aùiÚ
.
§_æags
 = 
SA_NOCLDSTOP
;

2990 #ifdeà
SA_RESTART


2991 
aùiÚ
.
§_æags
 |ğ
SA_RESTART
;

2993 
	`sigem±y£t
(&
aùiÚ
.
§_mask
);

2996 
	`´št_msg
("sighandler: Setting up signal handlero„eap child…rocesses\n");

2998 
»t
 = 
	`sigaùiÚ
(
SIGCHLD
,&
aùiÚ
,0);

2999 ià(
»t
 < 0è
	`´št_”r
("!!!sserve: Error starting signal handlero„eap child…rocesses\n");

3000 
	}
}

3006 
	$run_£rv”
(
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

3007 
li¡’_pÜt
,

3008 
v”bo£
,

3009 
qu›t
)

3011 
”r
;

3012 
SOCKET
 
£rv”_sock‘
;

3013 
sockaddr_š
 
addr
;

3015 #ifdeà
_WIN32


3016 
”r
 = 
	`wšsock_¡¬tup
();

3017 ià(
”r
)  1;

3019 
	`£t_chd_ex™_hªdËr
();

3023 
£rv”_sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

3024 ià(
£rv”_sock‘
 == -1)

3026 #ifdeà
_WIN32


3027 
”r
 = 
	`WSAG‘La¡E¼Ü
();

3028 
	`´št_”r
("### Unableo create socket: ");

3029 
	`´št_wšsock_”r
(
”r
);

3030 
	`´št_”r
("\n");

3032 
	`åršt_”r
("### UÇbËØü—‹ sock‘: %s\n",
	`¡»¼Ü
(
”ºo
));

3038 
	`mem£t
(&
addr
,0,(ipaddr));

3039 #ià!
	`defšed
(
__lšux__
è&& !defšed(
_WIN32
)

3041 
addr
.
sš_Ën
 = (
sockaddr_š
);

3043 
addr
.
sš_çmy
 = 
AF_INET
;

3044 
addr
.
sš_pÜt
 = 
	`htÚs
(
li¡’_pÜt
);

3045 
addr
.
sš_addr
.
s_addr
 = 
INADDR_ANY
;

3047 
”r
 = 
	`bšd
(
£rv”_sock‘
,(
sockaddr
*)&
addr
,(ipaddr));

3048 ià(
”r
 == -1)

3050 #ifdeà
_WIN32


3051 
”r
 = 
	`WSAG‘La¡E¼Ü
();

3052 
	`åršt_”r
("### UÇbËØbšdØpÜˆ%d: ",
li¡’_pÜt
);

3053 
	`´št_wšsock_”r
(
”r
);

3054 
	`´št_”r
("\n");

3056 
	`åršt_”r
("### Unableo bindo…ort %d: %s\n",

3057 
li¡’_pÜt
,
	`¡»¼Ü
(
”ºo
));

3064 
TS_wr™”_p
 
tswr™”
 = 
NULL
;

3066 ià(!
qu›t
è
	`åršt_msg
("\nListening for‡ connection on…ort %d"

3067 " w™h sock‘ %d\n",
li¡’_pÜt
,
£rv”_sock‘
);

3069 #ifdeà
_WIN32


3073 
”r
 = 
	`wšsock_¡¬tup
();

3074 ià(
”r
)

3076 
	`´št_”r
("### Error calling winsock_startup before†istening\n");

3081 
”r
 = 
	`tswr™e_wa™_fÜ_ş›Á
(
£rv”_sock‘
,
qu›t
,&
tswr™”
);

3082 ià(
”r
)

3084 
	`åršt_”r
("### Error†istening for client on…ort %d\n",

3085 
li¡’_pÜt
);

3089 ià(
cÚ‹xt
->
drİ_·ck‘s
)

3091 
tswr™”
->
drİ_·ck‘s
 = 
cÚ‹xt
->drop_packets;

3092 
tswr™”
->
drİ_numb”
 = 
cÚ‹xt
->drop_number;

3095 
”r
 = 
	`¡¬t_chd
(
cÚ‹xt
,
tswr™”
,
v”bo£
,
qu›t
);

3096 ià(
”r
)

3098 
	`´št_”r
("### Error spawning child server\n");

3102 #iâdeà
_WIN32


3104 
”r
 = 
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

3105 ià(
”r
)

3107 
	`´št_”r
("### Error closing socket in…arent…rocess\n");

3114 
	}
}

3119 
	$‹¡_»ad”
(
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

3120 
ouut_to_fe
,

3121 *
ouut_Çme
,

3122 
pÜt
,

3123 
num_nÜm®
,

3124 
num_ç¡
,

3125 
num_ç¡”
,

3126 
num_»v”£
,

3127 
sk‹¡
,

3128 
v”bo£
,

3129 
qu›t
,

3130 
tsdœeù
)

3132 
”r
;

3133 
TS_wr™”_p
 
tswr™”
 = 
NULL
;

3134 
PES_»ad”_p
 
»ad”
 = 
NULL
;

3136 
”r
 = 
	`tswr™e_İ’
((
ouut_to_fe
?
TS_W_FILE
:
TS_W_TCP
),

3137 
ouut_Çme
,
NULL
,
pÜt
,
qu›t
,&
tswr™”
);

3138 ià(
”r
)

3140 
	`åršt_”r
("### UÇbËØcÚÃùØ%s\n",
ouut_Çme
);

3144 ià(
cÚ‹xt
->
drİ_·ck‘s
)

3146 
tswr™”
->
drİ_·ck‘s
 = 
cÚ‹xt
->drop_packets;

3147 
tswr™”
->
drİ_numb”
 = 
cÚ‹xt
->drop_number;

3150 
”r
 = 
	`İ’_šput_fe
(
cÚ‹xt
,
qu›t
,
v”bo£
,&
»ad”
);

3151 ià(
”r
)

3153 
	`´št_”r
("### Unableo open input file\n");

3154 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

3159 
”r
 = 
	`‹¡_¶ay_³s_·ck‘s
(
»ad”
,
tswr™”
,
cÚ‹xt
,

3160 
cÚ‹xt
->
·d_¡¬t
,cÚ‹xt->
video_Úly
,

3161 
v”bo£
,
qu›t
,
tsdœeù
,

3162 
num_nÜm®
,
num_ç¡
,
num_ç¡”
,
num_»v”£
,

3163 
cÚ‹xt
->
fäequ’cy
,cÚ‹xt->
räequ’cy
,

3164 
sk‹¡
,
cÚ‹xt
->
w™h_£q_hdrs
);

3165 ià(
”r
)

3167 
	`´št_”r
("### Error…laying PES…ackets\n");

3168 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

3169 (è
	`şo£_PES_»ad”
(&
»ad”
);

3173 
”r
 = 
	`tswr™e_şo£
(
tswr™”
,
qu›t
);

3174 ià(
”r
)

3176 
	`åršt_”r
("### E¼Ü closšg ouuˆ%s: %s\n",
ouut_Çme
,

3177 
	`¡»¼Ü
(
”ºo
));

3178 (è
	`şo£_PES_»ad”
(&
»ad”
);

3181 
”r
 = 
	`şo£_PES_»ad”
(&
»ad”
);

3182 ià(
”r
)

3184 
	`åršt_”r
("### Error closing input file %s\n",

3185 
cÚ‹xt
->
šput_Çmes
[cÚ‹xt->
deçuÉ_fe_šdex
]);

3189 
	}
}

3194 
	$commªd_»ad”
(
ts£rve_cÚ‹xt_p
 
cÚ‹xt
,

3195 *
ouut_Çme
,

3196 
pÜt
,

3197 
u£_¡dš
,

3198 
v”bo£
,

3199 
qu›t
)

3201 
”r
;

3202 
ii
, 
had_”r
;

3203 
TS_wr™”_p
 
tswr™”
 = 
NULL
;

3204 
PES_»ad”_p
 
»ad”
[
MAX_INPUT_FILES
];

3206 
”r
 = 
	`tswr™e_İ’
(
TS_W_TCP
,
ouut_Çme
,
NULL
,
pÜt
,
qu›t
,&
tswr™”
);

3207 ià(
”r
)

3209 
	`åršt_”r
("### UÇbËØcÚÃùØ%s\n",
ouut_Çme
);

3213 ià(
cÚ‹xt
->
drİ_·ck‘s
)

3215 
tswr™”
->
drİ_·ck‘s
 = 
cÚ‹xt
->drop_packets;

3216 
tswr™”
->
drİ_numb”
 = 
cÚ‹xt
->drop_number;

3219 #iâdeà
_WIN32


3221 ià(
u£_¡dš
)

3223 ià(!
qu›t
)

3224 
	`´št_msg
("Commands from standard input:\n"

3237 
”r
ğ
	`tswr™e_¡¬t_šput
(
tswr™”
,
STDIN_FILENO
);

3238 ià(
”r
)

3240 
	`´št_”r
("### Unableo start command input from stdin\n");

3241 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

3248 
”r
ğ
	`tswr™e_¡¬t_šput
(
tswr™”
,tswr™”->
wh”e
.
sock‘
);

3249 ià(
”r
)

3251 
	`åršt_”r
("### Unableo start command input from %s\n",

3252 
ouut_Çme
);

3253 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

3258 
”r
 = 
	`İ’_šput_fes
(
cÚ‹xt
,
qu›t
,
v”bo£
,
»ad”
);

3259 ià(
”r
)

3261 
	`´št_”r
("### Unableo open input file\n");

3262 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

3267 
”r
 = 
	`¶ay_³s_·ck‘s
(
»ad”
,
tswr™”
,
cÚ‹xt
,
v”bo£
,
qu›t
);

3268 ià(
”r
)

3270 
	`´št_”r
("### Error…laying PES…ackets\n");

3271 (è
	`tswr™e_şo£
(
tswr™”
,
TRUE
);

3272 
ii
=0;ii<
MAX_INPUT_FILES
;ii++)

3273 (è
	`şo£_PES_»ad”
(&
»ad”
[
ii
]);

3277 
”r
 = 
	`tswr™e_şo£
(
tswr™”
,
qu›t
);

3278 ià(
”r
)

3280 
	`åršt_”r
("### E¼Ü closšg ouuˆ%s: %s\n",
ouut_Çme
,

3281 
	`¡»¼Ü
(
”ºo
));

3282 
ii
=0;ii<
MAX_INPUT_FILES
;ii++)

3283 (è
	`şo£_PES_»ad”
(&
»ad”
[
ii
]);

3286 
had_”r
 = 
FALSE
;

3287 
ii
=0;ii<
MAX_INPUT_FILES
;ii++)

3289 
”r
 = 
	`şo£_PES_»ad”
(&
»ad”
[
ii
]);

3290 ià(
”r
)

3292 
	`åršt_”r
("### E¼Ü closšg iÅuˆf%d, %s\n",
ii
,

3293 
cÚ‹xt
->
šput_Çmes
[
ii
]);

3294 
had_”r
 = 
TRUE
;

3297  (
had_”r
?1:0);

3298 
	}
}

3300 
	$´št_u§ge
()

3302 
	`´št_msg
(

3309 
	`REPORT_VERSION
("tsserve");

3310 
	`´št_msg
(

3359 
	}
}

3361 
	$´št_d‘aed_u§ge
()

3363 
	`´št_msg
(

3541 
	}
}

3543 
	$maš
(
¬gc
, **
¬gv
)

3545 *
ouut_Çme
 = 
NULL
;

3546 
had_šput_Çme
 = 
FALSE
;

3547 
had_ouut_Çme
 = 
FALSE
;

3548 
ouut_pÜt
 = 88;

3549 
qu›t
 = 
FALSE
;

3550 
v”bo£
 = 
FALSE
;

3551 
u£_¡dš
 = 
FALSE
;

3552 
li¡’_pÜt
 = 88;

3554 
ACTION
 
aùiÚ
 = 
ACTION_SERVER
;

3556 
”r
 = 0;

3557 
ii
;

3558 
¬gno
 = 1;

3561 
num_nÜm®
 = 100;

3562 
num_ç¡
 = 100;

3563 
num_ç¡”
 = 100;

3564 
num_»v”£
 = 100;

3565 
ouut_to_fe
 = 
FALSE
;

3566 
sk‹¡
 = 
FALSE
;

3568 
ts£rve_cÚ‹xt
 
cÚ‹xt
;

3570 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

3571 
cÚ‹xt
.
šput_Çmes
[
ii
] = 
NULL
;

3573 
cÚ‹xt
.
video_Úly
 = 
FALSE
;

3574 
cÚ‹xt
.
·d_¡¬t
 = 8;

3575 
cÚ‹xt
.
fäequ’cy
 = 
DEFAULT_FORWARD_FREQUENCY
;

3576 
cÚ‹xt
.
räequ’cy
 = 
DEFAULT_REVERSE_FREQUENCY
;

3577 
cÚ‹xt
.
w™h_£q_hdrs
 = 
TRUE
;

3578 
cÚ‹xt
.
³s_·ddšg
 = 0;

3579 
cÚ‹xt
.
drİ_·ck‘s
 = 0;

3580 
cÚ‹xt
.
drİ_numb”
 = 0;

3583 
cÚ‹xt
.
pmt_pid
 = 0x66;

3584 
cÚ‹xt
.
audio_pid
 = 0x67;

3585 
cÚ‹xt
.
video_pid
 = 0x68;

3586 
cÚ‹xt
.
pü_pid
 = cÚ‹xt.
video_pid
;

3587 
cÚ‹xt
.
»³©_´og¿m_ev”y
 = 100;

3590 
cÚ‹xt
.
tsdœeù
 = 
FALSE
;

3592 
cÚ‹xt
.
fÜû_¡»am_ty³
 = 
FALSE
;

3593 
cÚ‹xt
.
wªt_h262
 = 
TRUE
;

3594 
cÚ‹xt
.
dŞby_is_dvb
 = 
TRUE
;

3596 ià(
¬gc
 < 2)

3598 
	`´št_u§ge
();

3602 
¬gno
 < 
¬gc
)

3604 ià(
¬gv
[
¬gno
][0] == '-')

3606 ià(!
	`¡rcmp
("--h–p",
¬gv
[
¬gno
]) || !strcmp("-h",argv[argno]) ||

3607 !
	`¡rcmp
("-h–p",
¬gv
[
¬gno
]))

3609 
	`´št_u§ge
();

3612 ià(!
	`¡rcmp
("-”r",
¬gv
[
¬gno
]))

3614 
	`CHECKARG
("ts£rve",
¬gno
);

3615 ià(!
	`¡rcmp
(
¬gv
[
¬gno
+1],"stderr"))

3616 
	`»dœeù_ouut_¡d”r
();

3617 ià(!
	`¡rcmp
(
¬gv
[
¬gno
+1],"stdout"))

3618 
	`»dœeù_ouut_¡dout
();

3621 
	`åršt_”r
("###sserve: "

3623 " '¡d”r')\n",
¬gv
[
¬gno
+1]);

3626 
¬gno
++;

3628 ià(!
	`¡rcmp
("-d‘as",
¬gv
[
¬gno
]))

3630 
	`´št_d‘aed_u§ge
();

3633 ià(!
	`¡rcmp
("-no£qhdr",
¬gv
[
¬gno
]) ||

3634 !
	`¡rcmp
("-no£qhdrs",
¬gv
[
¬gno
]))

3636 
cÚ‹xt
.
w™h_£q_hdrs
 = 
FALSE
;

3638 ià(!
	`¡rcmp
("-sk‹¡",
¬gv
[
¬gno
]))

3640 
aùiÚ
 = 
ACTION_TEST
;

3641 
sk‹¡
 = 
TRUE
;

3643 ià(!
	`¡rcmp
("-‹¡",
¬gv
[
¬gno
]))

3645 
aùiÚ
 = 
ACTION_TEST
;

3646 
sk‹¡
 = 
FALSE
;

3648 ià(!
	`¡rcmp
("-tsdœeù",
¬gv
[
¬gno
]))

3650 
cÚ‹xt
.
tsdœeù
 = 
TRUE
;

3652 ià(!
	`¡rcmp
("-n",
¬gv
[
¬gno
]))

3654 
	`CHECKARG
("ts£rve",
¬gno
);

3655 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,10,

3656 &
num_nÜm®
);

3657 ià(
”r
)  1;

3658 
¬gno
++;

3660 ià(!
	`¡rcmp
("-f",
¬gv
[
¬gno
]))

3662 
	`CHECKARG
("ts£rve",
¬gno
);

3663 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,10,&
num_ç¡
);

3664 ià(
”r
)  1;

3665 
¬gno
++;

3667 ià(!
	`¡rcmp
("-ff",
¬gv
[
¬gno
]))

3669 
	`CHECKARG
("ts£rve",
¬gno
);

3670 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,10,

3671 &
num_ç¡”
);

3672 ià(
”r
)  1;

3673 
¬gno
++;

3675 ià(!
	`¡rcmp
("-r",
¬gv
[
¬gno
]))

3677 
	`CHECKARG
("ts£rve",
¬gno
);

3678 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,10,

3679 &
num_»v”£
);

3680 ià(
”r
)  1;

3681 
¬gno
++;

3683 ià(!
	`¡rcmp
("-fäeq",
¬gv
[
¬gno
]))

3685 
	`CHECKARG
("ts£rve",
¬gno
);

3686 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,0,

3687 &
cÚ‹xt
.
fäequ’cy
);

3688 ià(
”r
)  1;

3689 
¬gno
++;

3691 ià(!
	`¡rcmp
("-räeq",
¬gv
[
¬gno
]))

3693 
	`CHECKARG
("ts£rve",
¬gno
);

3694 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,0,

3695 &
cÚ‹xt
.
räequ’cy
);

3696 ià(
”r
)  1;

3697 
¬gno
++;

3699 ià(!
	`¡rcmp
("-³s_·ddšg",
¬gv
[
¬gno
]))

3701 
	`CHECKARG
("ts£rve",
¬gno
);

3702 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,10,

3703 &
cÚ‹xt
.
³s_·ddšg
);

3704 ià(
”r
)  1;

3705 
¬gno
++;

3707 ià(!
	`¡rcmp
("-drİ",
¬gv
[
¬gno
]))

3709 ià(
ii
+2 >ğ
¬gc
)

3711 
	`´št_”r
("###sserve: -drop„equireswo‡rguments\n");

3714 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,0,

3715 &
cÚ‹xt
.
drİ_·ck‘s
);

3716 ià(
”r
)  1;

3717 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+2],
TRUE
,0,

3718 &
cÚ‹xt
.
drİ_numb”
);

3719 ià(
”r
)  1;

3720 
¬gno
 += 2;

3722 ià(!
	`¡rcmp
("-qu›t",
¬gv
[
¬gno
]) || !strcmp("-q",argv[argno]))

3724 
qu›t
 = 
TRUE
;

3725 
v”bo£
 = 
FALSE
;

3727 ià(!
	`¡rcmp
("-v”bo£",
¬gv
[
¬gno
]) || !strcmp("-v",argv[argno]))

3729 
qu›t
 = 
FALSE
;

3730 
v”bo£
 = 
TRUE
;

3732 ià(!
	`¡rcmp
("-x",
¬gv
[
¬gno
]))

3734 
exŒa_šfo
 = 
TRUE
;

3736 ià(!
	`¡rcmp
("-nßudio",
¬gv
[
¬gno
]))

3738 
cÚ‹xt
.
video_Úly
 = 
TRUE
;

3740 ià(!
	`¡rcmp
("-avc",
¬gv
[
¬gno
]) || !strcmp("-h264",argv[argno]))

3742 
cÚ‹xt
.
fÜû_¡»am_ty³
 = 
TRUE
;

3743 
cÚ‹xt
.
wªt_h262
 = 
FALSE
;

3745 ià(!
	`¡rcmp
("-h262",
¬gv
[
¬gno
]))

3747 
cÚ‹xt
.
fÜû_¡»am_ty³
 = 
TRUE
;

3748 
cÚ‹xt
.
wªt_h262
 = 
TRUE
;

3750 ià(!
	`¡rcmp
("-dŞby",
¬gv
[
¬gno
]))

3752 
	`CHECKARG
("ts£rve",
¬gno
);

3753 ià(!
	`¡rcmp
("dvb",
¬gv
[
¬gno
+1]))

3754 
cÚ‹xt
.
dŞby_is_dvb
 = 
TRUE
;

3755 ià(!
	`¡rcmp
("©sc",
¬gv
[
¬gno
+1]))

3756 
cÚ‹xt
.
dŞby_is_dvb
 = 
FALSE
;

3759 
	`´št_”r
("###sserve: -dolby must be followed by dvb or‡tsc\n");

3762 
ii
++;

3764 ià(!
	`¡rcmp
("-´•—t",
¬gv
[
¬gno
]))

3766 
	`CHECKARG
("ts£rve",
¬gno
);

3767 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,10,

3768 &
cÚ‹xt
.
»³©_´og¿m_ev”y
);

3769 ià(
”r
)  1;

3770 
¬gno
++;

3772 ià(!
	`¡rcmp
("-·d",
¬gv
[
¬gno
]))

3774 
	`CHECKARG
("ts£rve",
¬gno
);

3775 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,10,

3776 &
cÚ‹xt
.
·d_¡¬t
);

3777 ià(
”r
)  1;

3778 
¬gno
++;

3780 ià(!
	`¡rcmp
("-pÜt",
¬gv
[
¬gno
]))

3782 
	`CHECKARG
("ts£rve",
¬gno
);

3783 
”r
 = 
	`št_v®ue
("ts£rve",
¬gv
[
¬gno
],¬gv[¬gno+1],
TRUE
,0,

3784 &
li¡’_pÜt
);

3785 ià(
”r
)  1;

3786 
¬gno
++;

3788 ià(!
	`¡rcmp
("-cmd",
¬gv
[
¬gno
]))

3790 
aùiÚ
 = 
ACTION_CMD
;

3792 ià(!
	`¡rcmp
("-cmd¡dš",
¬gv
[
¬gno
]))

3794 
u£_¡dš
 = 
TRUE
;

3795 
aùiÚ
 = 
ACTION_CMD
;

3797 ià(!
	`¡rcmp
("-ho¡",
¬gv
[
¬gno
]))

3799 
	`CHECKARG
("ts£rve",
¬gno
);

3800 
”r
 = 
	`ho¡_v®ue
("ts£rve",
¬gv
[
¬gno
],argv[argno+1],

3801 &
ouut_Çme
,&
ouut_pÜt
);

3802 ià(
”r
)  1;

3803 
had_ouut_Çme
 = 
TRUE
;

3804 
¬gno
++;

3806 ià(!
	`¡rcmp
("-0",
¬gv
[
¬gno
]))

3808 
	`CHECKARG
("ts£rve",
¬gno
);

3809 
had_šput_Çme
 = 
TRUE
;

3810 
cÚ‹xt
.
šput_Çmes
[0] = 
¬gv
[
¬gno
+1];

3811 
¬gno
++;

3813 ià(!
	`¡rcmp
("-1",
¬gv
[
¬gno
]))

3815 
	`CHECKARG
("ts£rve",
¬gno
);

3816 
had_šput_Çme
 = 
TRUE
;

3817 
cÚ‹xt
.
šput_Çmes
[1] = 
¬gv
[
¬gno
+1];

3818 
¬gno
++;

3820 ià(!
	`¡rcmp
("-2",
¬gv
[
¬gno
]))

3822 
	`CHECKARG
("ts£rve",
¬gno
);

3823 
had_šput_Çme
 = 
TRUE
;

3824 
cÚ‹xt
.
šput_Çmes
[2] = 
¬gv
[
¬gno
+1];

3825 
¬gno
++;

3827 ià(!
	`¡rcmp
("-3",
¬gv
[
¬gno
]))

3829 
	`CHECKARG
("ts£rve",
¬gno
);

3830 
had_šput_Çme
 = 
TRUE
;

3831 
cÚ‹xt
.
šput_Çmes
[3] = 
¬gv
[
¬gno
+1];

3832 
¬gno
++;

3834 ià(!
	`¡rcmp
("-4",
¬gv
[
¬gno
]))

3836 
	`CHECKARG
("ts£rve",
¬gno
);

3837 
had_šput_Çme
 = 
TRUE
;

3838 
cÚ‹xt
.
šput_Çmes
[4] = 
¬gv
[
¬gno
+1];

3839 
¬gno
++;

3841 ià(!
	`¡rcmp
("-5",
¬gv
[
¬gno
]))

3843 
	`CHECKARG
("ts£rve",
¬gno
);

3844 
had_šput_Çme
 = 
TRUE
;

3845 
cÚ‹xt
.
šput_Çmes
[5] = 
¬gv
[
¬gno
+1];

3846 
¬gno
++;

3848 ià(!
	`¡rcmp
("-6",
¬gv
[
¬gno
]))

3850 
	`CHECKARG
("ts£rve",
¬gno
);

3851 
had_šput_Çme
 = 
TRUE
;

3852 
cÚ‹xt
.
šput_Çmes
[6] = 
¬gv
[
¬gno
+1];

3853 
¬gno
++;

3855 ià(!
	`¡rcmp
("-7",
¬gv
[
¬gno
]))

3857 
	`CHECKARG
("ts£rve",
¬gno
);

3858 
had_šput_Çme
 = 
TRUE
;

3859 
cÚ‹xt
.
šput_Çmes
[7] = 
¬gv
[
¬gno
+1];

3860 
¬gno
++;

3862 ià(!
	`¡rcmp
("-8",
¬gv
[
¬gno
]))

3864 
	`CHECKARG
("ts£rve",
¬gno
);

3865 
had_šput_Çme
 = 
TRUE
;

3866 
cÚ‹xt
.
šput_Çmes
[8] = 
¬gv
[
¬gno
+1];

3867 
¬gno
++;

3869 ià(!
	`¡rcmp
("-9",
¬gv
[
¬gno
]))

3871 
	`CHECKARG
("ts£rve",
¬gno
);

3872 
had_šput_Çme
 = 
TRUE
;

3873 
cÚ‹xt
.
šput_Çmes
[9] = 
¬gv
[
¬gno
+1];

3874 
¬gno
++;

3876 ià(!
	`¡rcmp
("-ouut",
¬gv
[
¬gno
]) || !strcmp("-o",argv[argno]))

3878 
	`CHECKARG
("ts£rve",
¬gno
);

3879 
ouut_to_fe
 = 
TRUE
;

3880 
had_ouut_Çme
 = 
TRUE
;

3881 
ouut_Çme
 = 
¬gv
[
¬gno
+1];

3882 
¬gno
++;

3886 
	`åršt_”r
("###sserve: "

3887 "UÄecogni£d commªd†šsw™ch '%s'\n",
¬gv
[
¬gno
]);

3893 ià(
had_šput_Çme
)

3895 
	`åršt_”r
("###s£rve: UÃx³ùed '%s'\n",
¬gv
[
¬gno
]);

3900 
cÚ‹xt
.
šput_Çmes
[0] = 
¬gv
[
¬gno
];

3901 
had_šput_Çme
 = 
TRUE
;

3904 
¬gno
++;

3907 ià(!
had_šput_Çme
)

3909 
	`´št_”r
("###sserve: No input file specified\n");

3912 ià(!
had_ouut_Çme
 && 
aùiÚ
 !ğ
ACTION_SERVER
)

3914 
	`´št_”r
("###sserve: No output specified\n");

3917 ià(
ouut_to_fe
 && 
aùiÚ
 !ğ
ACTION_TEST
)

3919 
	`´št_”r
("###sserve: Outputo‡ file (-output) is only‡llowed"

3924 ià(!
qu›t
)

3926 
	`´št_msg
("Input files:\n");

3927 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

3929 ià(
cÚ‹xt
.
šput_Çmes
[
ii
] !ğ
NULL
)

3930 
	`åršt_msg
(" %2d: %s\n",
ii
,
cÚ‹xt
.
šput_Çmes
[ii]);

3934 
ii
 = 0; i˜< 
MAX_INPUT_FILES
; ii++)

3936 ià(
cÚ‹xt
.
šput_Çmes
[
ii
] !ğ
NULL
)

3938 
cÚ‹xt
.
deçuÉ_fe_šdex
 = 
ii
;

3939 ià(!
qu›t
è
	`åršt_msg
("File %d (%s) selected‡s default\n",

3940 
ii
,
cÚ‹xt
.
šput_Çmes
[ii]);

3945 ià(
cÚ‹xt
.
tsdœeù
 && !
qu›t
)

3946 
	`´št_msg
("Serving‡ll TS…ackets,‚ot just video/audio streams\n");

3948 ià(
cÚ‹xt
.
drİ_·ck‘s
 && !
qu›t
)

3949 
	`åršt_msg
("DROPPING: Keeping %d TS…acket%s,hen dropping (throwing‡way) %d\n",

3950 
cÚ‹xt
.
drİ_·ck‘s
,(context.drop_packets==1?"":"s"),

3951 
cÚ‹xt
.
drİ_numb”
);

3953 
aùiÚ
)

3955 
ACTION_SERVER
:

3956 
”r
 = 
	`run_£rv”
(&
cÚ‹xt
,
li¡’_pÜt
,
v”bo£
,
qu›t
);

3957 ià(
”r
)

3959 
	`´št_”r
("###sserve: Error in server\n");

3964 
ACTION_TEST
:

3965 
”r
 = 
	`‹¡_»ad”
(&
cÚ‹xt
,
ouut_to_fe
,
ouut_Çme
,
ouut_pÜt
,

3966 
num_nÜm®
,
num_ç¡
,
num_ç¡”
,
num_»v”£
,
sk‹¡
,

3967 
v”bo£
,
qu›t
,
cÚ‹xt
.
tsdœeù
);

3968 ià(
”r
)

3970 
	`åršt_”r
("###s£rve: E¼Ü…ÏyšgØ%s\n",
ouut_Çme
);

3975 
ACTION_CMD
:

3976 
”r
 = 
	`commªd_»ad”
(&
cÚ‹xt
,
ouut_Çme
,
ouut_pÜt
,

3977 
u£_¡dš
,
v”bo£
,
qu›t
);

3978 ià(
”r
)

3980 
	`åršt_”r
("###s£rve: E¼Ü…ÏyšgØ%s\n",
ouut_Çme
);

3986 
	`´št_”r
("### No‡ction specified\n");

3990 
	}
}

	@tswrite.c

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<”ºo.h
>

36 
	~<¡ršg.h
>

37 
	~<fú.h
>

38 
	~<m©h.h
>

39 
	~<ùy³.h
>

41 
	~<sys/ty³s.h
>

42 
	~<time.h
>

44 #ifdeà
_WIN32


45 
	~<sys/timeb.h
>

46 
	~<wšsock2.h
>

47 
	~<´oûss.h
>

49 
	~<uni¡d.h
>

50 
	~<sys/time.h
>

51 
	~<sys/mmª.h
>

52 
	~<sys/wa™.h
>

53 
	~<sys/sock‘.h
>

56 
	~"com·t.h
"

57 
	~"misc_âs.h
"

58 
	~"´štšg_âs.h
"

59 
	~"tswr™e_âs.h
"

60 
	~"ts_âs.h
"

65 
	#DEBUG_DATA_WAIT
 0

	)

70 
	#DEBUG_COMMANDS
 0

	)

73 
	#DISPLAY_BUFFER
 1

	)

74 #ià
DISPLAY_BUFFER


75 
	gglob®_show_cœcuÏr
 = 
FALSE
;

78 
	gglob®_·»Á_debug
 = 
FALSE
;

79 
	gglob®_show_®l_times
 = 
FALSE
;

80 
	gglob®_chd_debug
 = 
FALSE
;

88 
	gglob®_³¹urb_£ed
;

89 
	gglob®_³¹urb_¿nge
 = 0;

90 
	gglob®_³¹urb_v”bo£
 = 
FALSE
;

95 
	#DEFAULT_PRIME_SIZE
 10

	)

100 
	#ONE_MS_AS_NANOSECONDS
 1000000

	)

105 
	#DEFAULT_PARENT_WAIT
 50

	)

106 
	#DEFAULT_CHILD_WAIT
 10

	)

110 
	#DEFAULT_BYTE_RATE
 250000

	)

118 
	gglob®_·»Á_wa™
 = 
DEFAULT_PARENT_WAIT
;

119 
	gglob®_chd_wa™
 = 
DEFAULT_CHILD_WAIT
;

126 
	#CHILD_GIVE_UP_AFTER
 1000

	)

129 
	#PARENT_GIVE_UP_AFTER
 1000

	)

132 
	#REPORT_EVERY
 10000

	)

144 
	#DEFAULT_TS_PACKETS_IN_ITEM
 7

	)

149 
	#MAX_TS_PACKETS_IN_ITEM
 100

	)

171 
	scœcuÏr_bufãr_™em


173 
ušt32_t
 
	mtime
;

174 
	mdiscÚtšu™y
;

175 
	mËngth
;

177 
cœcuÏr_bufãr_™em
 *
	tcœcuÏr_bufãr_™em_p
;

179 
	#SIZEOF_CIRCULAR_BUFFER_ITEM
 (
cœcuÏr_bufãr_™em
)

	)

183 
	s¹p_hdr_šfo_s


185 
ušt16_t
 
	m£q
;

186 
ušt32_t
 
	ms¤c
;

187 } 
	t¹p_hdr_šfo_t
;

199 
	scœcuÏr_bufãr


201 vŞ©
	m¡¬t
;

202 vŞ©
	m’d
;

203 vŞ©
	m³ndšg
;

204 
	msize
;

206 vŞ©
	meos
;

208 
	mTS_š_™em
;

209 
	m™em_size
;

210 
	mhdr_size
;

211 
tswr™e_pkt_hdr_ty³_t
 
	mhdr_ty³
;

213 
¹p_hdr_šfo_t
 
	m¹p
;

214 } 
	mhdr
;

216 
	mmaxnowa™
;

217 
	mwa™fÜ
;

220 
by‹
 *
	m™em_d©a
;

223 
cœcuÏr_bufãr_™em
 
	m™em
[];

225 
cœcuÏr_bufãr
 *
	tcœcuÏr_bufãr_p
;

228 
	#SIZEOF_CIRCULAR_BUFFER
 (
cœcuÏr_bufãr
)

	)

236 
	#DEFAULT_CIRCULAR_BUFFER_SIZE
 2048

237 

	)

238 
	#PRIME_SPEED_NORMAL
 100

	)

245 
	sTS_·ck‘_šfo


247 
	mšdex
;

248 
ušt32_t
 
	mpid
;

249 
	mgÙ_pü
;

250 
ušt64_t
 
	mpü
;

252 
TS_·ck‘_šfo
 *
	tTS_·ck‘_šfo_p
;

253 
	#SIZEOF_TS_PACKET_INFO
 (
TS_·ck‘_šfo
);

	)

256 
	spü_·û_’v_s


258 
ušt32_t
 
	mg­_by‹s
;

259 
ušt32_t
 
	mÃxt_by‹s
;

260 
št32_t
 
	mÃxt_off£t
;

261 
	mÃxt_šdex
;

262 
	mpü1_£t
;

263 
	mg­_£t
;

264 
	mpkt1
;

265 
ušt64_t
 
	mpü1
;

266 
ušt64_t
 
	mpü_ba£
;

268 
	m´ime_»q
;

269 
	m´ime_¥“d
;

270 
ušt64_t
 
	m´ime_Ï¡_pü
;

272 
ušt32_t
 
	m´ev_g­_by‹s
;

273 
ušt64_t
 
	m´ev_pü_g­
;

274 
ušt64_t
 
	mÃxt_pü_ba£
;

275 } 
	tpü_·û_’v
;

283 
	sbufã»d_TS_ouut


285 
cœcuÏr_bufãr_p
 
	mbufãr
;

286 
	mwhich
;

287 
	m¡¬‹d
;

295 
	mnum_·ck‘s
;

296 
TS_·ck‘_šfo
 
	m·ck‘
[
MAX_TS_PACKETS_IN_ITEM
];

299 
ušt32_t
 
	m¿‹
;

303 
	mpü_sÿË
;

308 
tswr™e_pü_mode
 
	mpü_mode
;

313 
	m´ime_size
;

316 
	m´ime_¥“dup
;

318 
pü_·û_’v
 
	mpü_·û
;

321 #ifdeà
_WIN32


329 
šlše
 
	$g‘timeofday
(
timev®
 *
tv
,

330 *
timezÚe
)

332 
_timeb
 
timebufãr
;

333 
	`_áime
(&
timebufãr
);

334 
tv
->
tv_£c
 = ()
timebufãr
.
time
;

335 
tv
->
tv_u£c
 = 
timebufãr
.
ml™m
 * 1000;

336 
	}
}

356 
	$m­_cœcuÏr_bufãr
(
cœcuÏr_bufãr_p
 *
cœcuÏr
,

357 
cœc_buf_size
,

358 
TS_š_·ck‘
,

359 
maxnowa™
,

360 
wa™fÜ
,

361 cÚ¡ 
tswr™e_pkt_hdr_ty³_t
 
hdr_ty³
)

381 cÚ¡ 
hdr_size
 = (
hdr_ty³
 =ğ
PKT_HDR_TYPE_RTP
) ? 12 : 0;

382 
ba£_size
 = 
SIZEOF_CIRCULAR_BUFFER
 +

383 (
cœc_buf_size
 * 
SIZEOF_CIRCULAR_BUFFER_ITEM
);

384 
d©a_size
 = 
cœc_buf_size
 * (
TS_š_·ck‘
 * 
TS_PACKET_SIZE
 + 
hdr_size
);

385 
tÙ®_size
 = 
ba£_size
 + 
d©a_size
;

386 
cœcuÏr_bufãr_p
 
cb
;

388 *
cœcuÏr
 = 
NULL
;

390 #ifdeà
_WIN32


393 
cb
 = 
	`m®loc
(
tÙ®_size
);

394 ià(
cb
 =ğ
NULL
)

396 
	`åršt_”r
("### Error mapping circular buffer‡s shared memory: %s\n",

397 
	`¡»¼Ü
(
”ºo
));

401 
cb
 = 
	`mm­
(
NULL
,
tÙ®_size
,

402 
PROT_READ
 | 
PROT_WRITE
, 
MAP_SHARED
 | 
MAP_ANON
, -1, 0);

404 ià(
cb
 =ğ
MAP_FAILED
)

406 
	`åršt_”r
("### Error mapping circular buffer‡s shared memory: %s\n",

407 
	`¡»¼Ü
(
”ºo
));

412 
cb
->
¡¬t
 = 1;

413 
cb
->
’d
 = 0;

414 
cb
->
³ndšg
 = 0;

415 
cb
->
eos
 = 
FALSE
;

416 
cb
->
size
 = 
cœc_buf_size
;

417 
cb
->
TS_š_™em
 = 
TS_š_·ck‘
;

418 
cb
->
™em_size
 = 
TS_š_·ck‘
 * 
TS_PACKET_SIZE
 + 
hdr_size
;

419 
cb
->
hdr_size
 = hdr_size;

420 
cb
->
hdr_ty³
 = hdr_type;

421 ià(
hdr_ty³
 =ğ
PKT_HDR_TYPE_RTP
)

423 
timev®
 
now
;

424 
	`g‘timeofday
(&
now
, 
NULL
);

426 
cb
->
hdr
.
¹p
.
£q
 = 0;

427 
cb
->
hdr
.
¹p
.
s¤c
 = (
ušt32_t
)(
now
.
tv_£c
 ^‚ow.
tv_u£c
 << 12);

429 
cb
->
maxnowa™
 = maxnowait;

430 
cb
->
wa™fÜ
 = waitfor;

431 
cb
->
™em_d©a
 = (
by‹
 *ècb + 
ba£_size
 + 
hdr_size
;

432 *
cœcuÏr
 = 
cb
;

434 
	}
}

443 
	$unm­_cœcuÏr_bufãr
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

445 
ba£_size
 = 
SIZEOF_CIRCULAR_BUFFER
 +

446 (
cœcuÏr
->
size
 * 
SIZEOF_CIRCULAR_BUFFER_ITEM
);

447 
d©a_size
 = 
cœcuÏr
->
size
 * cœcuÏr->
™em_size
;

448 
tÙ®_size
 = 
ba£_size
 + 
d©a_size
;

449 #ifdeà
_WIN32


452 
	`ä“
(
cœcuÏr
);

454 
”r
 = 
	`munm­
(
cœcuÏr
,
tÙ®_size
);

455 ià(
”r
)

457 
	`åršt_”r
("### Error unmapping circular buffer from shared memory: %s\n",

458 
	`¡»¼Ü
(
”ºo
));

463 
	}
}

468 
šlše
 
	$cœcuÏr_bufãr_em±y
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

470  (
cœcuÏr
->
¡¬t
 =ğ(cœcuÏr->
’d
 + 1è% cœcuÏr->
size
);

471 
	}
}

476 
šlše
 
	$cœcuÏr_bufãr_fuÎ
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

478  ((
cœcuÏr
->
³ndšg
 + 2è% cœcuÏr->
size
 =ğcœcuÏr->
¡¬t
);

479 
	}
}

482 
šlše
 
	$cœcuÏr_bufãr_jammed
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

484  ((
cœcuÏr
->
³ndšg
 + 1è% cœcuÏr->
size
 =ğcœcuÏr->
’d
);

485 
	}
}

493 
šlše
 
	$wa™_if_bufãr_em±y
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

495 
couÁ
 = 0;

496 #iâdeà
_WIN32


497 
time¥ec
 
time
 = {0,
glob®_chd_wa™
*
ONE_MS_AS_NANOSECONDS
};

498 
”r
;

501 
	`cœcuÏr_bufãr_em±y
(
cœcuÏr
è&& !cœcuÏr->
eos
)

503 #ià
DISPLAY_BUFFER


504 ià(
glob®_show_cœcuÏr
 && !
glob®_·»Á_debug
è
	`´št_msg
("<-- wait\n");

506 ià(
glob®_·»Á_debug
è
	`´št_msg
("<-- wait\n");

507 
couÁ
 ++;

509 #ifdeà
_WIN32


510 
	`SË•
(
glob®_chd_wa™
);

512 
”r
 = 
	`Çno¦“p
(&
time
,
NULL
);

513 ià(
”r
 =ğ-1 && 
”ºo
 =ğ
EINVAL
)

515 
	`åršt_”r
("### Chd: bad v®u(%ldèfÜ wa™ime\n",
time
.
tv_n£c
);

521 ià(
couÁ
 > 
CHILD_GIVE_UP_AFTER
)

523 
	`´št_”r
("### Child: giving up (parent‚ot„esponding)\n");

527 
couÁ
 = 0;

528  
	`cœcuÏr_bufãr_em±y
(
cœcuÏr
);

529 
	}
}

536 
šlše
 
	$wa™_fÜ_bufãr_to_fl
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

538 
couÁ
 = 0;

539 #iâdeà
_WIN32


540 
time¥ec
 
time
 = {0,
glob®_chd_wa™
*
ONE_MS_AS_NANOSECONDS
};

541 
”r
;

544 !
	`cœcuÏr_bufãr_fuÎ
(
cœcuÏr
è&& !cœcuÏr->
eos
)

546 #ià
DISPLAY_BUFFER


547 ià(
glob®_show_cœcuÏr
 && !
glob®_chd_debug
)

548 
	`´št_msg
("<-- wait for buffero fill\n");

550 ià(
glob®_chd_debug
è
	`´št_msg
("<-- wait for buffero fill\n");

551 
couÁ
 ++;

553 #ifdeà
_WIN32


554 
	`SË•
(
glob®_chd_wa™
);

556 
”r
 = 
	`Çno¦“p
(&
time
,
NULL
);

557 ià(
”r
 =ğ-1 && 
”ºo
 =ğ
EINVAL
)

559 
	`åršt_”r
("### Chd: bad v®u(%ldèfÜ wa™ime\n",
time
.
tv_n£c
);

565 ià(
couÁ
 > 
CHILD_GIVE_UP_AFTER
)

567 
	`´št_”r
("### Child: giving up (parent‚ot„esponding)\n");

571 
couÁ
 = 0;

573 
	}
}

580 
šlše
 
	$wa™_if_bufãr_fuÎ
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

582 
couÁ
 = 0;

583 #iâdeà
_WIN32


584 
time¥ec
 
time
 = {0,
glob®_·»Á_wa™
*
ONE_MS_AS_NANOSECONDS
};

585 
”r
;

588 
	`cœcuÏr_bufãr_fuÎ
(
cœcuÏr
))

590 #ià
DISPLAY_BUFFER


591 ià(
glob®_show_cœcuÏr
 && !
glob®_·»Á_debug
è
	`´št_msg
("--> wait\n");

593 ià(
glob®_·»Á_debug
è
	`´št_msg
("--> wait\n");

594 
couÁ
 ++;

596 #ifdeà
_WIN32


597 
	`SË•
(
glob®_·»Á_wa™
);

599 
”r
 = 
	`Çno¦“p
(&
time
,
NULL
);

600 ià(
”r
 =ğ-1 && 
”ºo
 =ğ
EINVAL
)

602 
	`åršt_”r
("### P¬’t: bad v®u(%ldèfÜ wa™ime\n",
time
.
tv_n£c
);

607 ià(
	`cœcuÏr_bufãr_jammed
(
cœcuÏr
))

609 
	`´št_”r
("### Circular buffer jammed: No PCRs found\n");

610 
cœcuÏr
->
eos
 = 
TRUE
;

615 ià(
couÁ
 > 
PARENT_GIVE_UP_AFTER
)

617 
	`´št_”r
("### Parent: giving up (child‚ot„esponding)\n");

621 
couÁ
 = 0;

623 
	}
}

628 
	$´št_cœcuÏr_bufãr
(*
´efix
,

629 
cœcuÏr_bufãr_p
 
cœcuÏr
)

631 
ii
;

632 ià(
´efix
 !ğ
NULL
)

633 
	`åršt_msg
("% ",
´efix
);

634 
ii
 = 0; i˜< 
cœcuÏr
->
size
; ii++)

636 
by‹
* 
off£t
 = 
cœcuÏr
->
™em_d©a
 + (
ii
 * cœcuÏr->
™em_size
);

637 
	`åršt_msg
("%s",(
cœcuÏr
->
¡¬t
 =ğ
ii
 ? "[":" "));

638 ià(*
off£t
 == 0)

639 
	`´št_msg
("..");

641 
	`åršt_msg
("%02x",*
off£t
);

642 
	`åršt_msg
("% ",(
cœcuÏr
->
’d
 =ğ
ii
 ? "]":" "));

644 
	`´št_msg
("\n");

645 
	}
}

654 
	$»£t_pü_time
(
pü_·û_’v
 * cÚ¡ 
µe
, cÚ¡ 
ušt64_t
 
Ãxt_pü_ba£
)

656 
	`mem£t
(
µe
, 0, (*ppe));

657 
µe
->
pü_ba£
 = 
Ãxt_pü_ba£
;

658 
µe
->
´ime_¥“d
 = 
PRIME_SPEED_NORMAL
;

659 
µe
->
´ime_Ï¡_pü
 = 
INT64_MIN
;

660 
	}
}

687 
	$bud_bufã»d_TS_ouut
(
bufã»d_TS_ouut_p
 *
wr™”
,

688 
cœc_buf_size
,

689 
TS_š_·ck‘
,

690 
maxnowa™
,

691 
wa™fÜ
,

692 
¿‹
,

693 
tswr™e_pü_mode
 
pü_mode
,

694 
´ime_size
,

695 
´ime_¥“dup
,

696 
pü_sÿË
,

697 cÚ¡ 
tswr™e_pkt_hdr_ty³_t
 
hdr_ty³
)

699 
”r
, 
ii
;

700 
cœcuÏr_bufãr_p
 
cœcuÏr
;

701 
bufã»d_TS_ouut_p
 
Ãw
 = 
	`ÿÎoc
(1, 
SIZEOF_BUFFERED_TS_OUTPUT
);

702 ià(
Ãw
 =ğ
NULL
)

704 
	`´št_”r
("### Unableo‡llocate buffered output\n");

707 
	`»£t_pü_time
(&
Ãw
->
pü_·û
, 0);

709 
”r
 = 
	`m­_cœcuÏr_bufãr
(&
cœcuÏr
,
cœc_buf_size
,
TS_š_·ck‘
,

710 
maxnowa™
,
wa™fÜ
,
hdr_ty³
);

711 ià(
”r
)

713 
	`´št_”r
("### Error building buffered output\n");

714 
	`ä“
(
Ãw
);

717 
Ãw
->
bufãr
 = 
cœcuÏr
;

718 
Ãw
->
¡¬‹d
 = 
FALSE
;

719 
Ãw
->
which
 = (
cœcuÏr
->
³ndšg
 + 1è% cœcuÏr->
size
;

720 
Ãw
->
num_·ck‘s
 = 0;

722 
Ãw
->
¿‹
 =„ate;

723 
Ãw
->
pü_mode
 =…cr_mode;

724 
Ãw
->
´ime_size
 =…rime_size;

725 
Ãw
->
´ime_¥“dup
 =…rime_speedup;

727 
Ãw
->
pü_sÿË
 =…cr_scale;

729 
Ãw
->
pü_·û
.
´ime_¥“d
 = 
´ime_¥“dup
;

730 
Ãw
->
pü_·û
.
´ime_»q
 = (
´ime_¥“dup
 !ğ
PRIME_SPEED_NORMAL
);

731 
	`åršt_msg
("´im¥“d s‘Ø%d\n", 
´ime_¥“dup
);

735 
ii
 = 0; i˜< 
MAX_TS_PACKETS_IN_ITEM
; ii++)

736 
Ãw
->
·ck‘
[
ii
].
gÙ_pü
 = 
FALSE
;

738 *
wr™”
 = 
Ãw
;

740 
	}
}

750 
	$ä“_bufã»d_TS_ouut
(
bufã»d_TS_ouut_p
 *
wr™”
)

752 ià((*
wr™”
)->
bufãr
 !ğ
NULL
)

754 
”r
 = 
	`unm­_cœcuÏr_bufãr
((*
wr™”
)->
bufãr
);

755 ià(
”r
)

757 
	`´št_”r
("### Error freeing buffered output\n");

761 (*
wr™”
)->
bufãr
 = 
NULL
;

762 (*
wr™”
)->
¡¬‹d
 = 
FALSE
;

764 
	`ä“
(*
wr™”
);

765 *
wr™”
 = 
NULL
;

767 
	}
}

771 
	#PCR_WRAP
 (0x200000000LL * 300LL)

	)

772 
	#PCR_MS
(
n
è((
št64_t
)(n) * 90LL * 300LL)

773 

	)

774 
šlše
 
ušt64_t
 
	$pü_d–_u
(cÚ¡ 
ušt64_t
 
a
, cÚ¡ ušt64_ˆ
b
)

776  
a
 < 
b
 ?‡ + 
PCR_WRAP
 - b :‡ - b;

777 
	}
}

789 
	$£t_bufãr_™em_time_pü1
(
bufã»d_TS_ouut_p
 
wr™”
)

791 
ii
;

792 
cœcuÏr_bufãr_p
 
cœcuÏr
 = 
wr™”
->
bufãr
;

794 
št32_t
 
avaabË_by‹s
 = 0;

795 
avaabË_time
 = 0;

797 
Ï¡_pü_šdex
 = -1;

798 
ušt64_t
 
Ï¡_pü
;

799 
pü_¿‹
 = 0;

800 
ušt32_t
 
Ï¡_time¡amp_Ã¬_PCR
 = 0;

802 
ušt32_t
 
Ï¡_time¡amp
 = 0;

804 
had_fœ¡_pü
 = 
FALSE
;

805 
had_£cÚd_pü
 = 
FALSE
;

809 
š™Ÿl_´ime_time
 = 0;

810 
št32_t
 
š™Ÿl_´ime_by‹s
 = 0;

813 
št64_t
 
tÙ®_avaabË_by‹s
 = 0;

814 
tÙ®_avaabË_time
 = 0.0;

815 
num_avaabËs
 = 0;

817 
found_pü
 = 
FALSE
;

818 
num_by‹s
;

819 
num_miüo£cÚds
;

820 
ušt32_t
 
time¡amp
;

823 ià(
pü_¿‹
 < 1.0)

824 
pü_¿‹
 = 
wr™”
->
¿‹
;

832 ià(
avaabË_by‹s
 <ğ0 || 
avaabË_time
 <= 0)

835 
avaabË_by‹s
 = 
TS_PACKET_SIZE
 * 
cœcuÏr
->
TS_š_™em
 * 
wr™”
->
´ime_size
;

836 
avaabË_time
 = 
avaabË_by‹s
 * 1000000.0 /

837 (
pü_¿‹
 * 
wr™”
->
´ime_¥“dup
/100.0);

838 ià(
glob®_·»Á_debug
)

839 
	`åršt_msg
("PRIMING: bytes‡vailable %6d,ime‡vailable %8.1f"

841 
avaabË_by‹s
,
avaabË_time
,
pü_¿‹
,
wr™”
->
´ime_¥“dup
);

843 ià(!
had_£cÚd_pü
)

845 
š™Ÿl_´ime_time
 = 
avaabË_time
;

846 
š™Ÿl_´ime_by‹s
 = 
avaabË_by‹s
;

855 
ii
=0; ii<
wr™”
->
num_·ck‘s
; ii++)

857 ià(
wr™”
->
·ck‘
[
ii
].
gÙ_pü
)

859 
found_pü
 = 
TRUE
;

865 
num_by‹s
 = 
TS_PACKET_SIZE
*
wr™”
->
num_·ck‘s
;

866 
num_miüo£cÚds
 = (()
num_by‹s
 / 
avaabË_by‹s
è* 
avaabË_time
;

867 
time¡amp
 = (
ušt32_t
è(
Ï¡_time¡amp
 + 
num_miüo£cÚds
);

869 
avaabË_by‹s
 -ğ
num_by‹s
;

870 
avaabË_time
 -ğ
num_miüo£cÚds
;

872 ià(
glob®_·»Á_debug
 && 
glob®_show_®l_times
)

873 
	`åršt_msg
("%06d:‚um bytes %6d,ime %8.1f,imestamp %8d"

875 
wr™”
->
·ck‘
[0].
šdex
,
num_by‹s
,
num_miüo£cÚds
,
time¡amp
,

876 
avaabË_by‹s
,
avaabË_time
);

878 ià(
found_pü
)

880 
ušt64_t
 
d–_pü
 = 
	`pü_d–_u
(
wr™”
->
·ck‘
[
ii
].
pü
, 
Ï¡_pü
);

882 ià(
d–_pü
 > 
	`PCR_MS
(2000))

888 
had_fœ¡_pü
 = 
FALSE
;

889 
had_£cÚd_pü
 = 
FALSE
;

892 
avaabË_by‹s
 = 0;

893 
avaabË_time
 = 0.0;

895 ià(!
had_fœ¡_pü
)

898 
had_fœ¡_pü
 = 
TRUE
;

899 ià(
glob®_·»Á_debug
)

900 
	`åršt_msg
("%06d+%d: PCR %10" 
LLU_FORMAT_STUMP
 "\n",

901 
wr™”
->
·ck‘
[0].
šdex
,
ii
,wr™”->·ck‘[ii].
pü
);

906 
d–_by‹s
 = (
wr™”
->
·ck‘
[
ii
].
šdex
-
Ï¡_pü_šdex
)*
TS_PACKET_SIZE
;

907 
exŒa_by‹s
;

908 
exŒa_time
;

909 
pü_¿‹
 = (
d–_by‹s
 * 27.0 / 
d–_pü
) * 1000000;

910 
exŒa_by‹s
 = 
d–_by‹s
;

911 
exŒa_time
 = 
exŒa_by‹s
 * 1000000.0 / 
pü_¿‹
;

913 
avaabË_by‹s
 +ğ
exŒa_by‹s
;

914 
avaabË_time
 +ğ
exŒa_time
;

916 
tÙ®_avaabË_by‹s
 +ğ
avaabË_by‹s
;

917 
tÙ®_avaabË_time
 +ğ
avaabË_time
;

918 
num_avaabËs
 ++;

920 ià(
glob®_·»Á_debug
)

922 
	`åršt_msg
("%06d+%d: PCR %10" 
LLU_FORMAT_STUMP


925 
wr™”
->
·ck‘
[0].
šdex
,
ii
,wr™”->·ck‘[ii].
pü
,
pü_¿‹
,

926 
exŒa_by‹s
,
exŒa_time
,

927 
avaabË_by‹s
,
avaabË_time
);

928 
	`åršt_msg
(" (approximate‡ctual„ate %9.1f,"

930 1000000.0 * 
d–_by‹s
 /

931 (
time¡amp
 - 
Ï¡_time¡amp_Ã¬_PCR
),

932 ()
tÙ®_avaabË_by‹s
/
num_avaabËs
,

933 
tÙ®_avaabË_time
/
num_avaabËs
);

935 ià(!
had_£cÚd_pü
)

937 
Şd_time
 = 
avaabË_time
;

942 
avaabË_time
 -ğ
š™Ÿl_´ime_time
;

943 
avaabË_time
 +ğ
š™Ÿl_´ime_by‹s
 * 1000000.0 / 
pü_¿‹
;

944 ià(
glob®_·»Á_debug
)

945 
	`åršt_msg
("RE-PRIMING: bytes‡vailable %6d,ime‡vailable %8.1f"

947 
avaabË_by‹s
,
avaabË_time
,
Şd_time
,
pü_¿‹
,

948 
wr™”
->
´ime_¥“dup
);

949 
tÙ®_avaabË_by‹s
 = 0;

950 
tÙ®_avaabË_time
 = 0.0;

951 
num_avaabËs
 = 0;

953 
had_£cÚd_pü
 = 
TRUE
;

956 
Ï¡_time¡amp_Ã¬_PCR
 = 
time¡amp
;

957 
Ï¡_pü
 = 
wr™”
->
·ck‘
[
ii
].
pü
;

958 
Ï¡_pü_šdex
 = 
wr™”
->
·ck‘
[
ii
].
šdex
;

961 
Ï¡_time¡amp
 = 
cœcuÏr
->
™em
[
wr™”
->
which
].
time
 = 
time¡amp
;

962  
wr™”
->
which
;

963 
	}
}

965 
šlše
 

966 
	$£t_32_be
(
ušt8_t
 * cÚ¡ 
p
, cÚ¡ 
ušt32_t
 
x
)

968 
p
[0] = 
x
 >> 24;

969 
p
[1] = (
x
 >> 16) & 0xff;

970 
p
[2] = (
x
 >> 8) & 0xff;

971 
p
[3] = 
x
 & 0xff;

972 
	}
}

974 
šlše
 

975 
	$£t_16_be
(
ušt8_t
 * cÚ¡ 
p
, cÚ¡ 
x
)

977 
p
[0] = (
x
 >> 8) & 0xff;

978 
p
[1] = 
x
 & 0xff;

979 
	}
}

986 
	$£t_cœc_times
(cÚ¡ 
cœcuÏr_bufãr_p
 
cœc
,

987 cÚ¡ 
ušt32_t
 
šdex_¡¬t
, cÚ¡ ušt32_ˆ
Ën_by‹s
,

988 cÚ¡ 
št32_t
 
pü1_by‹_off£t
, cÚ¡ 
ušt64_t
 
pü1
,

989 cÚ¡ 
ušt64_t
 
pü_g­
, cÚ¡ 
ušt32_t
 
g­_by‹s
,

990 cÚ¡ 
št64_t
 
´ime_Ï¡_pü
, cÚ¡ 
´ime_¥“d
,

991 
ušt64_t
 * cÚ¡ 
pNew_pü_ba£
)

993 
št32_t
 
off£t
 = 
pü1_by‹_off£t
;

994 cÚ¡ 
št32_t
 
’d_off£t
 = 
off£t
 + 
Ën_by‹s
;

995 
št32_t
 
i
 = 
šdex_¡¬t
;

996 
idx
;

1000 
cœcuÏr_bufãr_™em
 * cÚ¡ 
™em
 = 
cœc
->™em + 
i
;

1001 
št64_t
 
pü
 = (št64_t)
pü1
 + (št64_t)
off£t
 * (št64_t)
pü_g­
 / (št64_t)
g­_by‹s
;

1002 
št64_t
 
adj_pü
 = (
pü
 >ğ
´ime_Ï¡_pü
) ?…cr :

1003 
´ime_Ï¡_pü
 - (Õrime_Ï¡_pü - 
pü
è* (
št64_t
)100è/ (št64_t)
´ime_¥“d
;

1005 ià(
cœc
->
hdr_ty³
 =ğ
PKT_HDR_TYPE_RTP
)

1007 
ušt32_t
 
time¡amp
 = (ušt32_t)(
pü
 / (
ušt64_t
)300);

1008 
ušt8_t
 * 
¹p_buf
 = 
cœc
->
™em_d©a
 + 
i
 * cœc->
™em_size
 - 12;

1010 
¹p_buf
[0] = 0x80;

1011 
¹p_buf
[1] = 33;

1012 
	`£t_16_be
(
¹p_buf
 + 2, ++
cœc
->
hdr
.
¹p
.
£q
);

1013 
	`£t_32_be
(
¹p_buf
 + 4, 
time¡amp
);

1014 
	`£t_32_be
(
¹p_buf
 + 8, 
cœc
->
hdr
.
¹p
.
s¤c
);

1017 
™em
->
time
 = (
ušt32_t
)(
adj_pü
 / 27);

1018 
off£t
 +ğ
™em
->
Ëngth
;

1019 
idx
 = 
i
;

1021 ià(++
i
 >ğ
cœc
->
size
)

1022 
i
 = 0;

1023 } 
off£t
 <ğ
’d_off£t
);

1026 ià(
pNew_pü_ba£
 !ğ
NULL
)

1028 *
pNew_pü_ba£
 = (
št64_t
)
pü1
 + (št64_t)
off£t
 * (št64_t)
pü_g­
 / (št64_t)
g­_by‹s
;

1032  
idx
;

1033 
	}
}

1036 
	$fš®ize_pü_time
(
bufã»d_TS_ouut_p
 
wr™”
, 
pü_·û_’v
 * cÚ¡ 
µe
)

1038 cÚ¡ 
cœcuÏr_bufãr_p
 
cœc
 = 
wr™”
->
bufãr
;

1039 
idx
 = -1;

1043 ià(!
µe
->
g­_£t
)

1048 
µe
->
pü1_£t
 = 
FALSE
;

1052 ià(
µe
->
Ãxt_by‹s
 != 0)

1054 
idx
 = 
	`£t_cœc_times
(
cœc
, 
µe
->
Ãxt_šdex
,…³->
Ãxt_by‹s
 - 1,…³->
Ãxt_off£t
,…³->
pü1
 +…³->
pü_ba£
,

1055 
µe
->
´ev_pü_g­
,…³->
´ev_g­_by‹s
,…³->
´ime_Ï¡_pü
,…³->
´ime_¥“d
, &µe->
Ãxt_pü_ba£
);

1059 
	`»£t_pü_time
(
µe
,…³->
Ãxt_pü_ba£
);

1062  
idx
;

1063 
	}
}

1066 
	$discÚtšu™y_pkt_pü_time
(
bufã»d_TS_ouut_p
 
wr™”
, 
pü_·û_’v
 * cÚ¡ 
µe
)

1068  
	`fš®ize_pü_time
(
wr™”
, 
µe
);

1069 
	}
}

1072 
	$add_pkt_pü_time
(
bufã»d_TS_ouut_p
 
wr™”
, 
pü_·û_’v
 * cÚ¡ 
µe
)

1074 cÚ¡ 
cœcuÏr_bufãr_p
 
cœc
 = 
wr™”
->
bufãr
;

1075 cÚ¡ 
cœcuÏr_bufãr_™em_p
 
™em
 = 
cœc
->™em + 
wr™”
->
which
;

1076 cÚ¡ 
TS_·ck‘_šfo_p
 
pkt0
 = 
wr™”
->
·ck‘
 + 0;

1077 
idx
 = -1;

1079 
™em
->
discÚtšu™y
 = 
FALSE
;

1081 
»Œy
:

1083 ià(!
µe
->
pkt1
)

1085 
µe
->
pkt1
 = 
TRUE
;

1086 
µe
->
Ãxt_šdex
 = 
wr™”
->
which
;

1090 ià(!
pkt0
->
gÙ_pü
)

1092 
µe
->
g­_by‹s
 +ğ
™em
->
Ëngth
;

1093 
µe
->
Ãxt_by‹s
 +ğ
™em
->
Ëngth
;

1099 cÚ¡ 
ušt64_t
 
pü1
 = 
µe
->pcr1;

1100 cÚ¡ 
ušt64_t
 
pü2
 = 
pkt0
->
pü
;

1104 ià(!
µe
->
pü1_£t
)

1106 
µe
->
Ãxt_off£t
 = 0 -…³->
Ãxt_by‹s
;

1107 
µe
->
Ãxt_by‹s
 +ğ
™em
->
Ëngth
;

1108 
µe
->
pü_ba£
 -ğ
pü2
;

1110 ià(
µe
->
´ime_»q
)

1113 
µe
->
´ime_Ï¡_pü
 = 27000000 * 5;

1114 
µe
->
´ime_»q
 = 
FALSE
;

1116 
µe
->
pü1_£t
 = 
TRUE
;

1120 cÚ¡ 
ušt64_t
 
pü_g­
 = 
	`pü_d–_u
(
pü2
, 
pü1
);

1122 ià(
pü_g­
 > 
	`PCR_MS
(2000))

1125 
	`åršt_msg
("PCR2: DiscÚtšu™y[%d]: g­=%Îd\n", 
wr™”
->
which
, 
pü_g­
);

1127 
idx
 = 
	`fš®ize_pü_time
(
wr™”
, 
µe
);

1128 
»Œy
;

1131 
idx
 = 
	`£t_cœc_times
(
cœc
,

1132 
µe
->
Ãxt_šdex
,…³->
Ãxt_by‹s
,…³->
Ãxt_off£t
,…³->
pü_ba£
 + 
pü1
,

1133 
pü_g­
, 
µe
->
g­_by‹s
,…³->
´ime_Ï¡_pü
,…³->
´ime_¥“d
, &µe->
Ãxt_pü_ba£
);

1135 
µe
->
Ãxt_off£t
 = 
™em
->
Ëngth
;

1136 
µe
->
Ãxt_by‹s
 = 0;

1137 
µe
->
Ãxt_šdex
 = 
wr™”
->
which
 + 1;

1138 ià(
µe
->
Ãxt_šdex
 >ğ
cœc
->
size
)

1139 
µe
->
Ãxt_šdex
 = 0;

1142 
µe
->
´ev_pü_g­
 = 
pü_g­
;

1143 
µe
->
´ev_g­_by‹s
 =…³->
g­_by‹s
;

1144 
µe
->
g­_£t
 = 
TRUE
;

1147 ià(
pü1
 > 
pü2
)

1148 
µe
->
pü_ba£
 +ğ
PCR_WRAP
;

1151 
µe
->
pü1
 = 
pü2
;

1152 
µe
->
g­_by‹s
 = 
™em
->
Ëngth
;

1155  
idx
;

1156 
	}
}

1167 
	$£t_bufãr_™em_time_¶aš
(
bufã»d_TS_ouut_p
 
wr™”
)

1169 
ušt32_t
 
Ï¡_time
 = 0;

1170 
cœcuÏr_bufãr_p
 
cœcuÏr
 = 
wr™”
->
bufãr
;

1171 
num_by‹s
 = 
wr™”
->
num_·ck‘s
 * 
TS_PACKET_SIZE
;

1172 
ušt32_t
 
–­£d_time
 = (ušt32_tè(
num_by‹s
 * 1000000.0 / 
wr™”
->
¿‹
);

1173 
Ï¡_time
 +ğ
–­£d_time
;

1174 
cœcuÏr
->
™em
[
wr™”
->
which
].
time
 = 
Ï¡_time
;

1175  
wr™”
->
which
;

1176 
	}
}

1185 
	$£t_bufãr_™em_time
(cÚ¡ 
bufã»d_TS_ouut_p
 
wr™”
, cÚ¡ 
fš®ize
)

1187 
wr™”
->
pü_mode
)

1189 
TSWRITE_PCR_MODE_PCR2
:

1190  
fš®ize
 ?

1191 
	`fš®ize_pü_time
(
wr™”
, &wr™”->
pü_·û
) :

1192 
	`add_pkt_pü_time
(
wr™”
, &wr™”->
pü_·û
);

1193 
TSWRITE_PCR_MODE_PCR1
:

1194  
	`£t_bufãr_™em_time_pü1
(
wr™”
);

1195 
TSWRITE_PCR_MODE_NONE
:

1199  
	`£t_bufãr_™em_time_¶aš
(
wr™”
);

1201 
	}
}

1214 
	$add_eof_’Œy
(
bufã»d_TS_ouut_p
 
wr™”
)

1216 
cœcuÏr_bufãr_p
 
cœcuÏr
 = 
wr™”
->
bufãr
;

1218 
d©a_pos
;

1219 
”r
 = 
	`wa™_if_bufãr_fuÎ
(
cœcuÏr
);

1220 ià(
”r
)

1222 
	`´št_”r
("### Internalƒrror - waiting because circular buffer full\n");

1227 
d©a_pos
 = (
cœcuÏr
->
³ndšg
 + 1è% cœcuÏr->
size
;

1229 #ià
DISPLAY_BUFFER


1230 ià(
glob®_show_cœcuÏr
)

1231 
	`åršt_msg
("P¬’t: stÜšg bufã¸%2d (EOF)\n",
d©a_pos
);

1237 
	`£t_bufãr_™em_time
(
wr™”
, 
TRUE
);

1241 
cœcuÏr
->
™em_d©a
[
d©a_pos
 * cœcuÏr->
™em_size
] = 1;

1242 
cœcuÏr
->
™em
[
d©a_pos
].
Ëngth
 = 1;

1243 
cœcuÏr
->
’d
 = 
d©a_pos
;

1244 #ià
DISPLAY_BUFFER


1245 ià(
glob®_show_cœcuÏr
è
	`´št_cœcuÏr_bufãr
("eof",
cœcuÏr
);

1247 
cœcuÏr
->
eos
 = 
TRUE
;

1249 
	}
}

1261 
	$š‹º®_æush_bufã»d_TS_ouut
(cÚ¡ 
bufã»d_TS_ouut_p
 
wr™”
)

1263 cÚ¡ 
cœcuÏr_bufãr_p
 
cœcuÏr
 = 
wr™”
->
bufãr
;

1264 
idx
;

1266 ià(!
wr™”
->
¡¬‹d
 || 
cœcuÏr
->
™em
[wr™”->
which
].
Ëngth
 == 0)

1273 
idx
 = 
	`£t_bufãr_™em_time
(
wr™”
, 
FALSE
);

1274 ià(
idx
 >= 0)

1275 
cœcuÏr
->
’d
 = 
idx
;

1278 
cœcuÏr
->
³ndšg
 = 
wr™”
->
which
;

1281 
wr™”
->
which
 = (
cœcuÏr
->
³ndšg
 + 1è% cœcuÏr->
size
;

1282 
wr™”
->
¡¬‹d
 = 
FALSE
;

1283 
wr™”
->
num_·ck‘s
 = 0;

1284 
wr™”
->
·ck‘
[0].
gÙ_pü
 = 
FALSE
;

1285 
	}
}

1288 
	$discÚtšu™y_bufã»d_TS_ouut
(
bufã»d_TS_ouut_p
 
wr™”
)

1290 
cœcuÏr_bufãr_p
 
cœcuÏr
 = 
wr™”
->
bufãr
;

1291 
idx
;

1293 ià(
wr™”
->
pü_mode
 !ğ
TSWRITE_PCR_MODE_PCR2
)

1297 
idx
 = 
	`discÚtšu™y_pkt_pü_time
(
wr™”
, &wr™”->
pü_·û
);

1298 ià(
idx
 >= 0)

1299 
cœcuÏr
->
’d
 = 
idx
;

1303 
	}
}

1316 
	$wr™e_EOF_to_bufã»d_TS_ouut
(
bufã»d_TS_ouut_p
 
wr™”
)

1318 
”r
;

1321 
	`š‹º®_æush_bufã»d_TS_ouut
(
wr™”
);

1323 ià(
glob®_·»Á_debug
)

1324 
	`´št_msg
("--> writing EOF\n");

1326 
”r
 = 
	`add_eof_’Œy
(
wr™”
);

1327 ià(
”r
)

1329 
	`´št_”r
("### Error‡dding EOF indicator\n");

1333 
	}
}

1347 
	$wr™e_to_bufã»d_TS_ouut
(
bufã»d_TS_ouut_p
 
wr™”
,

1348 
by‹
 
·ck‘
[
TS_PACKET_SIZE
],

1349 
couÁ
,

1350 
ušt32_t
 
pid
,

1351 
gÙ_pü
,

1352 
ušt64_t
 
pü
)

1354 
”r
;

1355 cÚ¡ 
cœcuÏr_bufãr_p
 
cœcuÏr
 = 
wr™”
->
bufãr
;

1356 
which
;

1357 
by‹
 *
d©a
;

1358 *
Ëngth
;

1361 ià(
wr™”
->
pü_mode
 =ğ
TSWRITE_PCR_MODE_PCR2
 && 
gÙ_pü
)

1364 
	`š‹º®_æush_bufã»d_TS_ouut
(
wr™”
);

1367 
which
 = 
wr™”
->which;

1368 
d©a
 = 
cœcuÏr
->
™em_d©a
 + 
which
*cœcuÏr->
™em_size
;

1369 
Ëngth
 = &(
cœcuÏr
->
™em
[
which
].length);

1373 ià(!
wr™”
->
¡¬‹d
)

1375 
”r
 = 
	`wa™_if_bufãr_fuÎ
(
cœcuÏr
);

1376 ià(
”r
)

1378 
	`´št_”r
("### Internalƒrror - waiting because circular buffer full\n");

1381 
wr™”
->
¡¬‹d
 = 
TRUE
;

1382 
wr™”
->
num_·ck‘s
 = 0;

1383 *
Ëngth
 = 0;

1390 
	`memıy
(&(
d©a
[*
Ëngth
]),
·ck‘
,
TS_PACKET_SIZE
);

1391 (*
Ëngth
è+ğ
TS_PACKET_SIZE
;

1394 ià(
gÙ_pü
)

1397 
	`åršt_msg
("@@ PCR %10" 
LLU_FORMAT_STUMP
 " * %g",
pü
,
wr™”
->
pü_sÿË
);

1398 
	`åršt_msg
(" => %10" 
LLU_FORMAT_STUMP
 "\n", (
ušt64_t
)(
pü
*
wr™”
->
pü_sÿË
));

1400 
pü
 = (
ušt64_t
)((íü * 
wr™”
->
pü_sÿË
);

1403 
pü
 = 0;

1406 
wr™”
->
·ck‘
[wr™”->
num_·ck‘s
].
šdex
 = 
couÁ
;

1407 
wr™”
->
·ck‘
[wr™”->
num_·ck‘s
].
pid
 =…id;

1408 
wr™”
->
·ck‘
[wr™”->
num_·ck‘s
].
gÙ_pü
 = got_pcr;

1409 
wr™”
->
·ck‘
[wr™”->
num_·ck‘s
].
pü
 =…cr;

1410 
wr™”
->
num_·ck‘s
 ++;

1413 ià((*
Ëngth
è>ğ
cœcuÏr
->
™em_size
 - cœcuÏr->
hdr_size
)

1414 
	`š‹º®_æush_bufã»d_TS_ouut
(
wr™”
);

1416 
	}
}

1432 
	$wa™_miüo£cÚds
(
miüo£cÚds
)

1434 #ifdeà
_WIN32


1437 
	`SË•
(
miüo£cÚds
 / 1000);

1439 
time¥ec
 
time
 = {0};

1440 
time¥ec
 
»maššg
;

1441 
ušt32_t
 
Çno£cÚds
 = 
miüo£cÚds
 * 1000;

1442 
”r
 = 0;

1444 
time
.
tv_£c
 = 0;

1445 
time
.
tv_n£c
 = 
Çno£cÚds
;

1447 
”ºo
 = 0;

1448 
”r
 = 
	`Çno¦“p
(&
time
,&
»maššg
);

1449 
”r
 =ğ-1 && 
”ºo
 =ğ
EINTR
)

1451 
”ºo
 = 0;

1452 
time
 = 
»maššg
;

1453 
”r
 = 
	`Çno¦“p
(&
time
,&
»maššg
);

1457 
	}
}

1468 
	$wr™e_fe_d©a
(
TS_wr™”_p
 
tswr™”
,

1469 
by‹
 
d©a
[],

1470 
d©a_Ën
)

1472 
size_t
 
wr™‹n
 = 0;

1473 
”ºo
 = 0;

1474 
wr™‹n
 = 
	`fwr™e
(
d©a
,1,
d©a_Ën
,
tswr™”
->
wh”e
.
fe
);

1475 ià(
wr™‹n
 !ğ
d©a_Ën
)

1477 
	`åršt_”r
("### E¼Ü wr™šg ouˆTS…ack‘ d©a: %s\n",
	`¡»¼Ü
(
”ºo
));

1481 
	}
}

1492 
	$wr™e_sock‘_d©a
(
SOCKET
 
ouut
,

1493 
by‹
 
d©a
[],

1494 
d©a_Ën
)

1496 #ifdeà
_WIN32


1497 
wr™‹n
 = 0;

1498 
Ëá
 = 
d©a_Ën
;

1500 
ssize_t
 
wr™‹n
 = 0;

1501 
ssize_t
 
Ëá
 = 
d©a_Ën
;

1503 
¡¬t
 = 0;

1509 
”ºo
 = 0;

1510 
Ëá
 > 0)

1512 
wr™‹n
 = 
	`£nd
(
ouut
,&(
d©a
[
¡¬t
]),
Ëá
,0);

1513 #ifdeà
_WIN32


1514 ià(
wr™‹n
 =ğ
SOCKET_ERROR
)

1516 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1517 ià(
”r
 =ğ
WSAENOBUFS
)

1519 
	`´št_”r
("!!! Warning: 'no buffer space‡vailable' writing out"

1524 
	`´št_”r
("### Error writing out TS…acket data:");

1525 
	`´št_wšsock_”r
(
”r
);

1526 
	`´št_”r
("\n");

1531 ià(
wr™‹n
 == -1)

1533 ià(
”ºo
 =ğ
ENOBUFS
)

1535 
	`´št_”r
("!!! Warning: 'no buffer space‡vailable' writing out"

1537 
”ºo
 = 0;

1541 
	`åršt_”r
("### Error writing out TS…acket data: %s\n",

1542 
	`¡»¼Ü
(
”ºo
));

1547 
Ëá
 -ğ
wr™‹n
;

1548 
¡¬t
 +ğ
wr™‹n
;

1551 
	}
}

1564 
	$»ad_commªd
(
SOCKET
 
commªd_sock‘
,

1565 
by‹
 *
commªd
,

1566 *
commªd_chªged
)

1568 
by‹
 
thšg
;

1569 #ifdeà
_WIN32


1570 
Ëngth
 = 
	`»cv
(
commªd_sock‘
,&
thšg
,1,0);

1572 
ssize_t
 
Ëngth
 = 
	`»ad
(
commªd_sock‘
,&
thšg
,1);

1574 ià(
Ëngth
 == 0)

1576 
	`´št_”r
("!!! EOF„eading from command socket\n");

1577 *
commªd
 = 
COMMAND_QUIT
;

1578 *
commªd_chªged
 = 
TRUE
;

1579 #ià
DEBUG_COMMANDS


1580 
	`´št_msg
("[[EOF -> quit]]\n");

1585 #ifdeà
_WIN32


1586 ià(
Ëngth
 =ğ
SOCKET_ERROR
)

1588 
”r
 = 
	`WSAG‘La¡E¼Ü
();

1589 
	`´št_”r
("!!! Error„eading from command socket:");

1590 
	`´št_wšsock_”r
(
”r
);

1591 
	`´št_”r
("\n");

1592 *
commªd
 = 
COMMAND_QUIT
;

1593 *
commªd_chªged
 = 
TRUE
;

1594 #ià
DEBUG_COMMANDS


1595 
	`´št_msg
("[[Error -> quit]]\n");

1601 ià(
Ëngth
 == -1)

1603 
	`åršt_”r
("!!! E¼Ü„—dšg from commªd sock‘: %s\n",
	`¡»¼Ü
(
”ºo
));

1604 *
commªd
 = 
COMMAND_QUIT
;

1605 *
commªd_chªged
 = 
TRUE
;

1606 #ià
DEBUG_COMMANDS


1607 
	`´št_msg
("[[Error -> quit]]\n");

1614 
thšg
)

1617 *
commªd
 = 
COMMAND_QUIT
;

1618 *
commªd_chªged
 = 
TRUE
;

1619 #ià
DEBUG_COMMANDS


1620 
	`´št_msg
("[[quit]]\n");

1625 *
commªd
 = 
COMMAND_NORMAL
;

1626 *
commªd_chªged
 = 
TRUE
;

1627 #ià
DEBUG_COMMANDS


1628 
	`´št_msg
("[[normal]]\n");

1633 *
commªd
 = 
COMMAND_PAUSE
;

1634 *
commªd_chªged
 = 
TRUE
;

1635 #ià
DEBUG_COMMANDS


1636 
	`´št_msg
("[[pause]]\n");

1641 *
commªd
 = 
COMMAND_FAST
;

1642 *
commªd_chªged
 = 
TRUE
;

1643 #ià
DEBUG_COMMANDS


1644 
	`´št_msg
("[[fast-forward]]\n");

1649 *
commªd
 = 
COMMAND_FAST_FAST
;

1650 *
commªd_chªged
 = 
TRUE
;

1651 #ià
DEBUG_COMMANDS


1652 
	`´št_msg
("[[fast-fast-forward]]\n");

1657 *
commªd
 = 
COMMAND_REVERSE
;

1658 *
commªd_chªged
 = 
TRUE
;

1659 #ià
DEBUG_COMMANDS


1660 
	`´št_msg
("[[reverse]]\n");

1665 *
commªd
 = 
COMMAND_FAST_REVERSE
;

1666 *
commªd_chªged
 = 
TRUE
;

1667 #ià
DEBUG_COMMANDS


1668 
	`´št_msg
("[[fast-reverse]]\n");

1673 *
commªd
 = 
COMMAND_SKIP_FORWARD
;

1674 *
commªd_chªged
 = 
TRUE
;

1675 #ià
DEBUG_COMMANDS


1676 
	`´št_msg
("[[skip-forward]]\n");

1681 *
commªd
 = 
COMMAND_SKIP_BACKWARD
;

1682 *
commªd_chªged
 = 
TRUE
;

1683 #ià
DEBUG_COMMANDS


1684 
	`´št_msg
("[[skip-backward]]\n");

1689 *
commªd
 = 
COMMAND_SKIP_FORWARD_LOTS
;

1690 *
commªd_chªged
 = 
TRUE
;

1691 #ià
DEBUG_COMMANDS


1692 
	`´št_msg
("[[big-skip-forward]]\n");

1697 *
commªd
 = 
COMMAND_SKIP_BACKWARD_LOTS
;

1698 *
commªd_chªged
 = 
TRUE
;

1699 #ià
DEBUG_COMMANDS


1700 
	`´št_msg
("[[big-skip-backward]]\n");

1705 *
commªd
 = 
COMMAND_SELECT_FILE_0
;

1706 *
commªd_chªged
 = 
TRUE
;

1707 #ià
DEBUG_COMMANDS


1708 
	`´št_msg
("[[select-file-0]]\n");

1713 *
commªd
 = 
COMMAND_SELECT_FILE_1
;

1714 *
commªd_chªged
 = 
TRUE
;

1715 #ià
DEBUG_COMMANDS


1716 
	`´št_msg
("[[select-file-1]]\n");

1721 *
commªd
 = 
COMMAND_SELECT_FILE_2
;

1722 *
commªd_chªged
 = 
TRUE
;

1723 #ià
DEBUG_COMMANDS


1724 
	`´št_msg
("[[select-file-2]]\n");

1729 *
commªd
 = 
COMMAND_SELECT_FILE_3
;

1730 *
commªd_chªged
 = 
TRUE
;

1731 #ià
DEBUG_COMMANDS


1732 
	`´št_msg
("[[select-file-3]]\n");

1737 *
commªd
 = 
COMMAND_SELECT_FILE_4
;

1738 *
commªd_chªged
 = 
TRUE
;

1739 #ià
DEBUG_COMMANDS


1740 
	`´št_msg
("[[select-file-4]]\n");

1745 *
commªd
 = 
COMMAND_SELECT_FILE_5
;

1746 *
commªd_chªged
 = 
TRUE
;

1747 #ià
DEBUG_COMMANDS


1748 
	`´št_msg
("[[select-file-5]]\n");

1753 *
commªd
 = 
COMMAND_SELECT_FILE_6
;

1754 *
commªd_chªged
 = 
TRUE
;

1755 #ià
DEBUG_COMMANDS


1756 
	`´št_msg
("[[select-file-6]]\n");

1761 *
commªd
 = 
COMMAND_SELECT_FILE_7
;

1762 *
commªd_chªged
 = 
TRUE
;

1763 #ià
DEBUG_COMMANDS


1764 
	`´št_msg
("[[select-file-7]]\n");

1769 *
commªd
 = 
COMMAND_SELECT_FILE_8
;

1770 *
commªd_chªged
 = 
TRUE
;

1771 #ià
DEBUG_COMMANDS


1772 
	`´št_msg
("[[select-file-8]]\n");

1777 *
commªd
 = 
COMMAND_SELECT_FILE_9
;

1778 *
commªd_chªged
 = 
TRUE
;

1779 #ià
DEBUG_COMMANDS


1780 
	`´št_msg
("[[select-file-9]]\n");

1785 #ià
DEBUG_COMMANDS


1786 
	`´št_msg
("[[newline/ignored]]\n");

1791 #ià
DEBUG_COMMANDS


1792 
	`åršt_msg
("[[%øignÜed]]\n",(
	`i¥ršt
(
thšg
)?thing:'?'));

1797 
	}
}

1810 
	$wr™e_tı_d©a
(
TS_wr™”_p
 
tswr™”
,

1811 
by‹
 
d©a
[],

1812 
d©a_Ën
)

1814 
”r
;

1816 ià(
tswr™”
->
commªd_sock‘
 == -1)

1818 ià(
d©a_Ën
 == 0)

1823 
”r
 = 
	`wr™e_sock‘_d©a
(
tswr™”
->
wh”e
.
sock‘
,
d©a
,
d©a_Ën
);

1824 ià(
”r
)  1;

1831 
nÙ_wr™‹n
 = 
TRUE
;

1832 
fd_£t
 
»ad_fds
, 
wr™e_fds
;

1834 #ià
DEBUG_DATA_WAIT


1835 
wa™šg
 = 
FALSE
;

1838 
num_to_check
 = 
	`max
(()
tswr™”
->
commªd_sock‘
,

1839 ()
tswr™”
->
wh”e
.
sock‘
) + 1;

1841 
nÙ_wr™‹n
)

1843 
»suÉ
;

1845 
	`FD_ZERO
(&
»ad_fds
);

1846 
	`FD_ZERO
(&
wr™e_fds
);

1850 ià(!
tswr™”
->
commªd_chªged
)

1851 
	`FD_SET
(
tswr™”
->
commªd_sock‘
,&
»ad_fds
);

1853 ià(
d©a_Ën
 > 0)

1854 
	`FD_SET
(
tswr™”
->
wh”e
.
sock‘
,&
wr™e_fds
);

1856 
»suÉ
 = 
	`£Ëù
(
num_to_check
,&
»ad_fds
,&
wr™e_fds
,
NULL
,NULL);

1857 ià(
»suÉ
 == -1)

1859 
	`åršt_”r
("### E¼Ü iÀ£Ëù: %s\n",
	`¡»¼Ü
(
”ºo
));

1862 ià(
»suÉ
 == 0)

1865 ià(
	`FD_ISSET
(
tswr™”
->
commªd_sock‘
,&
»ad_fds
))

1867 
”r
 = 
	`»ad_commªd
(
tswr™”
->
commªd_sock‘
,

1868 &
tswr™”
->
commªd
,&tswr™”->
commªd_chªged
);

1869 ià(
”r
)  1;

1874 ià(
	`FD_ISSET
(
tswr™”
->
wh”e
.
sock‘
,&
wr™e_fds
))

1876 
”r
 = 
	`wr™e_sock‘_d©a
(
tswr™”
->
wh”e
.
sock‘
,
d©a
,
d©a_Ën
);

1877 ià(
”r
)  1;

1878 
nÙ_wr™‹n
 = 
FALSE
;

1880 ià(
d©a_Ën
 == 0)

1881 
nÙ_wr™‹n
 = 
FALSE
;

1884 #ià
DEBUG_DATA_WAIT


1885 ià(
nÙ_wr™‹n
)

1887 
wa™šg
 = 
TRUE
;

1888 
	`åršt_msg
(".. still waitingo write data (last command '%c', %s)..\n",

1889 (
	`i¥ršt
(
tswr™”
->
commªd
)?tswriter->command:'?'),

1890 (
tswr™”
->
commªd_chªged
?"changed":"unchanged"));

1892 ià(
wa™šg
)

1894 
wa™šg
 = 
FALSE
;

1895 
	`åršt_msg
(".. data written (last command '%c', %s)..\n",

1896 (
	`i¥ršt
(
tswr™”
->
commªd
)?tswriter->command:'?'),

1897 (
tswr™”
->
commªd_chªged
?"changed":"unchanged"));

1903 
	}
}

1912 
	$wa™_fÜ_commªd
(
TS_wr™”_p
 
tswr™”
)

1914 ià(
tswr™”
->
commªd_sock‘
 == -1)

1916 
	`´št_”r
("### Cannot wait for‚ew command when command input"

1922 
”r
;

1923 
fd_£t
 
»ad_fds
;

1924 
num_to_check
 = ()
tswr™”
->
commªd_sock‘
 + 1;

1926 
	`FD_ZERO
(&
»ad_fds
);

1928 !
tswr™”
->
commªd_chªged
)

1930 
»suÉ
;

1931 
	`FD_SET
(
tswr™”
->
commªd_sock‘
,&
»ad_fds
);

1932 
»suÉ
 = 
	`£Ëù
(
num_to_check
,&
»ad_fds
,
NULL
,NULL,NULL);

1933 ià(
»suÉ
 == -1)

1935 
	`åršt_”r
("### E¼Ü iÀ£Ëù: %s\n",
	`¡»¼Ü
(
”ºo
));

1938 ià(
»suÉ
 == 0)

1941 ià(
	`FD_ISSET
(
tswr™”
->
commªd_sock‘
,&
»ad_fds
))

1943 
”r
 = 
	`»ad_commªd
(
tswr™”
->
commªd_sock‘
,

1944 &
tswr™”
->
commªd
,&tswr™”->
commªd_chªged
);

1945 ià(
”r
)  1;

1950 
	}
}

1960 
	$wr™e_cœcuÏr_d©a
(cÚ¡ 
SOCKET
 
ouut
,

1961 cÚ¡ 
cœcuÏr_bufãr_p
 
cœcuÏr
)

1963 
”r
;

1964 
by‹
 *
bufãr
 = 
cœcuÏr
->
™em_d©a
 + cœcuÏr->
¡¬t
*cœcuÏr->
™em_size
 - cœcuÏr->
hdr_size
;

1965 
Ëngth
 = 
cœcuÏr
->
™em
[cœcuÏr->
¡¬t
].Ëngth + cœcuÏr->
hdr_size
;

1966 #ià
DISPLAY_BUFFER


1967 
Şd’d
 = 
cœcuÏr
->
³ndšg
;

1968 
Şd¡¬t
 = 
cœcuÏr
->
¡¬t
;

1969 
Ãw’d
,
Ãw¡¬t
;

1972 
”r
 = 
	`wr™e_sock‘_d©a
(
ouut
,
bufãr
,
Ëngth
);

1974 ià(
”r
)

1985 #ià
DISPLAY_BUFFER


1986 ià(
glob®_show_cœcuÏr
)

1988 
Ãw’d
 = 
cœcuÏr
->
³ndšg
;

1989 
Ãw¡¬t
 = 
cœcuÏr
->
¡¬t
;

1990 ià(
Şd’d
 !ğ
Ãw’d
 || 
Şd¡¬t
 !ğ
Ãw¡¬t
)

1992 
	`åršt_msg
("get [%2d,%2d] became [%2d,%2d]",

1993 
Şd’d
,
Şd¡¬t
,
Ãw’d
,
Ãw¡¬t
);

1994 ià(
Şd¡¬t
 !ğ
Ãw¡¬t
)

1995 
	`´št_msg
(" (!!)");

1996 ià(
Ãw¡¬t
 =ğ(
Ãw’d
 + 1è% 
cœcuÏr
->
size
)

1997 
	`´št_msg
(" ->empty");

1998 ià((
Ãw’d
 + 2è% 
cœcuÏr
->
size
 =ğ
Ãw¡¬t
)

1999 
	`´št_msg
(" ->full");

2000 
	`´št_msg
("\n");

2007 
bufãr
[0] = 0;

2008 
cœcuÏr
->
¡¬t
 = (cœcuÏr->¡¬ˆ+ 1è% cœcuÏr->
size
;

2010 #ià
DISPLAY_BUFFER


2011 ià(
glob®_show_cœcuÏr
)

2012 
	`´št_cœcuÏr_bufãr
("<--",
cœcuÏr
);

2015 
	}
}

2025 
	$»ûived_EOF
(
cœcuÏr_bufãr_p
 
cœcuÏr
)

2027 
by‹
 *
bufãr
 = 
cœcuÏr
->
™em_d©a
 + cœcuÏr->
¡¬t
*cœcuÏr->
™em_size
;

2028 
Ëngth
 = 
cœcuÏr
->
™em
[cœcuÏr->
¡¬t
].length;

2030 ià(
Ëngth
 =ğ1 && 
bufãr
[0] == 1)

2033 
cœcuÏr
->
¡¬t
 = (cœcuÏr->¡¬ˆ+ 1è% cœcuÏr->
size
;

2034 #ià
DISPLAY_BUFFER


2035 ià(
glob®_show_cœcuÏr
)

2037 
	`´št_msg
("Child: found EOF\n");

2038 
	`´št_cœcuÏr_bufãr
("<--",
cœcuÏr
);

2041 ià(
chd_·»Á_debug
)

2042 
	`´št_msg
("<-- found EOF\n");

2044  
TRUE
;

2047  
FALSE
;

2048 
	}
}

2053 
št32_t
 
	$³¹urb_time_by
()

2055 
fœ¡_time
 = 
TRUE
;

2056 
doubË_¿nge
;

2057 
št32_t
 
»suÉ
;

2059 ià(
fœ¡_time
)

2061 ià(
glob®_³¹urb_v”bo£
)

2062 
	`åršt_msg
("...…erturb seed %ld,„ange %u\n",

2063 ()
glob®_³¹urb_£ed
,()
glob®_³¹urb_¿nge
);

2064 
	`¤ªd
(
glob®_³¹urb_£ed
);

2065 
fœ¡_time
 = 
FALSE
;

2072 
doubË_¿nge
 = (
glob®_³¹urb_¿nge
+1) * 2;

2074 
»suÉ
 = ()(()
doubË_¿nge
 * (()
	`¿nd
(è/ (
RAND_MAX
 + 1.0)));

2077 
»suÉ
 -ğ
glob®_³¹urb_¿nge
;

2079 ià(
glob®_³¹urb_v”bo£
)

2080 
	`åršt_msg
("...…”turb %ldms\n",()
»suÉ
);

2082  
»suÉ
 * 1000;

2083 
	}
}

2097 
	$wr™e_äom_cœcuÏr
(
SOCKET
 
ouut
,

2098 
cœcuÏr_bufãr_p
 
cœcuÏr
,

2099 
qu›t
,

2100 *
had_eof
)

2102 
”r
;

2105 
¡¬tšg
 = 
TRUE
;

2108 
»£t
 = 
TRUE
;

2115 
ušt32_t
 
this_·ck‘_time
;

2116 
ušt32_t
 
Ï¡_·ck‘_time
 = 0;

2117 
št32_t
 
·ck‘_time_g­
;

2124 
timev®
 
now
;

2125 
timev®
 
¡¬t
 = {0,0};

2126 
ušt32_t
 
our_time_now
;

2127 
št32_t
 
d–_¡¬t
;

2128 
ušt32_t
 
adju¡ed_now
;

2129 
št32_t
 
wa™fÜ
;

2133 
£Á_w™hout_d–ay
 = 0;

2138 
couÁ
 = 0;

2140 
couÁ
 ++;

2142 ià(
¡¬tšg
)

2146 ià(!
qu›t
)

2147 
	`´št_msg
("Circular buffer filling...\n");

2148 
”r
 = 
	`wa™_fÜ_bufãr_to_fl
(
cœcuÏr
);

2149 ià(
”r
)

2151 
	`´št_”r
("### Error - waiting for circular buffero fill\n");

2154 ià(!
qu›t
)

2155 
	`´št_msg
("Circular buffer filled - startingo send data\n");

2156 
¡¬tšg
 = 
FALSE
;

2162 
”r
 = 
	`wa™_if_bufãr_em±y
(
cœcuÏr
);

2163 ià(
”r
)

2165 
	`´št_”r
("### Error - waiting because circular buffer isƒmpty\n");

2172 ià(
	`»ûived_EOF
(
cœcuÏr
))

2174 *
had_eof
 = 
TRUE
;

2179 
this_·ck‘_time
 = 
cœcuÏr
->
™em
[cœcuÏr->
¡¬t
].
time
;

2180 
·ck‘_time_g­
 = 
this_·ck‘_time
 - 
Ï¡_·ck‘_time
;

2183 
	`g‘timeofday
(&
now
, 
NULL
);

2185 
our_time_now
 = (
now
.
tv_£c
 - 
¡¬t
.tv_sec) * 1000000 +

2186 (
now
.
tv_u£c
 - 
¡¬t
.tv_usec);

2188 ià(
glob®_³¹urb_¿nge
)

2193 
our_time_now
 +ğ
	`³¹urb_time_by
();

2198 ià(
»£t
 || 
cœcuÏr
->
™em
[cœcuÏr->
¡¬t
].
discÚtšu™y
)

2204 
¡¬t
 = 
now
;

2205 
our_time_now
 = 0;

2206 
d–_¡¬t
 = 
this_·ck‘_time
;

2207 
wa™fÜ
 = 0;

2208 ià(
glob®_chd_debug
)

2209 
	`åršt_msg
("<--…acket %6u, gap %6u; STARTING delta %6d ",

2210 
this_·ck‘_time
,
·ck‘_time_g­
,
d–_¡¬t
);

2211 
»£t
 = 
FALSE
;

2216 
adju¡ed_now
 = 
our_time_now
 + 
d–_¡¬t
;

2219 
wa™fÜ
 = 
this_·ck‘_time
 - 
adju¡ed_now
;

2221 ià(
glob®_chd_debug
)

2222 
	`åršt_msg
("<--…acket %6u, gap %6u; ourime %6u = %6u -> wait %6d ",

2223 
this_·ck‘_time
,
·ck‘_time_g­
,
our_time_now
,
adju¡ed_now
,

2224 
wa™fÜ
);

2228 ià(
wa™fÜ
 > 0)

2230 ià(
wa™fÜ
 > 200000)

2232 
	`åršt_msg
("###[%d] (%dè>0.2s, RESET\n", 
cœcuÏr
->
¡¬t
, 
wa™fÜ
);

2233 
»£t
 = 
TRUE
;

2234 
wa™fÜ
 = 200000;

2236 ià(
glob®_chd_debug
è
	`´št_msg
("(waiting");

2238 ià(
wa™fÜ
 > -200000)

2240 ià(
glob®_chd_debug
è
	`´št_msg
("(<0.2s, ignore");

2241 
wa™fÜ
 = 0;

2245 ià(
glob®_³¹urb_¿nge
 == 0)

2247 ià(
glob®_chd_debug
)

2248 
	`´št_msg
("(>0.2s, RESET");

2256 
	`åršt_”r
("!!! [%d] Packet %d (item %d): Outputting %.2fs†ate -"

2258 
cœcuÏr
->
¡¬t
,

2259 (
couÁ
-1)*7+1,couÁ,-()
wa™fÜ
/1000000, 
this_·ck‘_time
);

2260 ià(
cœcuÏr
->
maxnowa™
 >= 0)

2261 
	`åršt_”r
(" Maybe consider„unning with -maxnowait greater"

2262 "hª %d\n",
cœcuÏr
->
maxnowa™
);

2265 
»£t
 = 
TRUE
;

2266 
wa™fÜ
 = 0;

2272 ià(
wa™fÜ
 =ğ0 && 
cœcuÏr
->
maxnowa™
 != -1)

2274 ià(
£Á_w™hout_d–ay
 < 
cœcuÏr
->
maxnowa™
)

2276 
£Á_w™hout_d–ay
 ++;

2277 ià(
glob®_chd_debug
è
	`åršt_msg
(", %d)\n",
£Á_w™hout_d–ay
);

2281 ià(
glob®_chd_debug
è
	`åršt_msg
(", %d -> wait)\n",

2282 
£Á_w™hout_d–ay
+1);

2283 
wa™fÜ
 = 
cœcuÏr
->waitfor;

2287 ià(
glob®_chd_debug
è
	`´št_msg
(")\n");

2290 ià(
wa™fÜ
 > 0)

2292 
	`wa™_miüo£cÚds
(
wa™fÜ
);

2293 
£Á_w™hout_d–ay
 = 0;

2297 
”r
 = 
	`wr™e_cœcuÏr_d©a
(
ouut
,
cœcuÏr
);

2298 ià(
”r
)  1;

2301 
Ï¡_·ck‘_time
 = 
this_·ck‘_time
;

2303 
	}
}

2327 
	$tswr™e_chd_´oûss
(
TS_wr™”_p
 
tswr™”
)

2329 
had_eof
 = 
FALSE
;

2332 
”r
 = 
	`wr™e_äom_cœcuÏr
(
tswr™”
->
wh”e
.
sock‘
,

2333 
tswr™”
->
wr™”
->
bufãr
,

2334 
tswr™”
->
qu›t
,

2335 &
had_eof
);

2336 ià(
”r
)  1;

2337 ià(
had_eof
) ;

2340 
	}
}

2341 #ifdeà
_WIN32


2348 
	$chd_th»ad_â
(
void_p
 
¬g
)

2350 
TS_wr™”_p
 
tswr™”
 = (TS_wr™”_p)
¬g
;

2351 (è
	`tswr™e_chd_´oûss
(
tswr™”
);

2353 #ifdeà
_WIN32


2355 
”r
;

2359 
”r
 = 
	`discÚÃù_sock‘
(
tswr™”
->
wh”e
.
sock‘
);

2360 ià(
”r
 =ğ
EOF
)

2361 
	`åršt_”r
("### E¼Ü closšg ouut: %s\n",
	`¡»¼Ü
(
”ºo
));

2364 
”r
 = 
	`ä“_bufã»d_TS_ouut
(&(
tswr™”
->
wr™”
));

2365 ià(
”r
)

2366 
	`´št_”r
("### Error freeing TS buffer\n");

2368 
	`ä“
(
tswr™”
);

2371 
	}
}

2376 
	$¡¬t_chd
(
TS_wr™”_p
 
tswr™”
)

2378 
tswr™”
->
chd
 = (
HANDLE
è
	`_begšth»ad
(
chd_th»ad_â
,0,(
void_p
)tswriter);

2380 ià(
tswr™”
->
chd
 =ğ(
HANDLE
) -1)

2382 
	`åršt_”r
("E¼Ü c»©šg chd…roûss: %s\n",
	`¡»¼Ü
(
”ºo
));

2386 
	}
}

2394 
	$¡¬t_chd
(
TS_wr™”_p
 
tswr™”
)

2396 
pid_t
 
pid
;

2398 
tswr™”
->
chd
 = 0;

2400 
pid
 = 
	`fÜk
();

2401 ià(
pid
 == -1)

2403 
	`åršt_”r
("E¼Ü fÜkšg: %s\n",
	`¡»¼Ü
(
”ºo
));

2406 ià(
pid
 == 0)

2409 
	`_ex™
(
	`tswr™e_chd_´oûss
(
tswr™”
));

2413 
tswr™”
->
chd
 = 
pid
;

2415 
	}
}

2420 
	$wa™_fÜ_chd_to_ex™
(
TS_wr™”_p
 
tswr™”
,

2421 
qu›t
)

2423 
”r
;

2424 
pid_t
 
»suÉ
;

2425 ià(!
qu›t
è
	`´št_msg
("Waiting for childo finish writing‡ndƒxit\n");

2426 
»suÉ
 = 
	`wa™pid
(
tswr™”
->
chd
,&
”r
,0);

2427 ià(
»suÉ
 == -1)

2429 
	`åršt_”r
("### Error waiting for childoƒxit: %s\n",

2430 
	`¡»¼Ü
(
”ºo
));

2433 ià(
	`WIFEXITED
(
”r
))

2435 ià(!
qu›t
è
	`´št_msg
("Childƒxited‚ormally\n");

2437 
tswr™”
->
chd
 = 0;

2439 
	}
}

2451 
	$tswr™e_bud
(
TS_WRITER_TYPE
 
how
,

2452 
qu›t
,

2453 
TS_wr™”_p
 *
tswr™”
)

2455 
TS_wr™”_p
 
Ãw
 = 
NULL
;

2456 
Ãw
 = 
	`m®loc
(
SIZEOF_TS_WRITER
);

2457 ià(
Ãw
 =ğ
NULL
)

2459 
	`´št_”r
("### Unableo‡llocate space for TS_writer datastructure\n");

2462 
Ãw
->
how
 = how;

2463 
Ãw
->
wr™”
 = 
NULL
;

2464 
Ãw
->
chd
 = 0;

2465 
Ãw
->
couÁ
 = 0;

2466 
Ãw
->
qu›t
 = quiet;

2467 
Ãw
->
£rv”
 = 
FALSE
;

2468 
Ãw
->
commªd_sock‘
 = -1;

2469 
Ãw
->
commªd
 = 
COMMAND_PAUSE
;

2470 
Ãw
->
commªd_chªged
 = 
FALSE
;

2471 
Ãw
->
©omic_commªd
 = 
FALSE
;

2472 
Ãw
->
drİ_·ck‘s
 = 0;

2473 *
tswr™”
 = 
Ãw
;

2475 
	}
}

2512 
	$tswr™e_İ’
(
TS_WRITER_TYPE
 
how
,

2513 *
Çme
,

2514 *
muÉiÿ¡_if
,

2515 
pÜt
,

2516 
qu›t
,

2517 
TS_wr™”_p
 *
tswr™”
)

2519 
TS_wr™”_p
 
Ãw
;

2520 
”r
 = 
	`tswr™e_bud
(
how
,
qu›t
,
tswr™”
);

2521 ià(
”r
)  1;

2523 
Ãw
 = *
tswr™”
;

2524 
how
)

2526 
TS_W_STDOUT
:

2527 ià(!
qu›t
è
	`´št_msg
("Writingo <stdout>\n");

2528 
Ãw
->
wh”e
.
fe
 = 
¡dout
;

2530 
TS_W_FILE
:

2531 ià(!
qu›t
è
	`åršt_msg
("Wr™šgØf%s\n",
Çme
);

2532 
Ãw
->
wh”e
.
fe
 = 
	`fİ’
(
Çme
,"wb");

2533 ià(
Ãw
->
wh”e
.
fe
 =ğ
NULL
)

2535 
	`åršt_”r
("### Unableo open output file %s: %s\n",

2536 
Çme
,
	`¡»¼Ü
(
”ºo
));

2540 
TS_W_TCP
:

2541 ià(!
qu›t
è
	`åršt_msg
("Connectingo %s via TCP/IP on…ort %d\n",

2542 
Çme
,
pÜt
);

2543 
Ãw
->
wh”e
.
sock‘
 = 
	`cÚÃù_sock‘
(
Çme
,
pÜt
,
TRUE
, 
NULL
);

2544 ià(
Ãw
->
wh”e
.
sock‘
 == -1)

2546 
	`åršt_”r
("### UÇbËØcÚÃùØ%s\n",
Çme
);

2549 ià(!
qu›t
è
	`åršt_msg
("Wr™šgØ% vŸ TCP/IP\n",
Çme
);

2551 
TS_W_UDP
:

2552 ià(!
qu›t
)

2558 
	`åršt_msg
("CÚÃùšgØ% vŸ UDP oÀpÜˆ%d",
Çme
,
pÜt
);

2559 ià(
muÉiÿ¡_if
)

2560 
	`åršt_msg
(" (muÉiÿ¡ iÁ”çû %s)",
muÉiÿ¡_if
);

2561 
	`´št_msg
("\n");

2563 
Ãw
->
wh”e
.
sock‘
 = 
	`cÚÃù_sock‘
(
Çme
,
pÜt
,
FALSE
,
muÉiÿ¡_if
);

2564 ià(
Ãw
->
wh”e
.
sock‘
 == -1)

2566 
	`åršt_”r
("### UÇbËØcÚÃùØ%s\n",
Çme
);

2569 ià(!
qu›t
è
	`åršt_msg
("Wr™šgØ% vŸ UDP\n",
Çme
);

2572 
	`åršt_”r
("### UÃx³ùed wr™”y³ %dØtswr™e_İ’()\n",
how
);

2573 
	`ä“
(
Ãw
);

2577 
	}
}

2599 
	$tswr™e_İ’_cÚÃùiÚ
(
u£_tı
,

2600 *
Çme
,

2601 
pÜt
,

2602 
qu›t
,

2603 
TS_wr™”_p
 *
tswr™”
)

2605  
	`tswr™e_İ’
((
u£_tı
?
TS_W_TCP
:
TS_W_UDP
),
Çme
,
NULL
,
pÜt
,
qu›t
,
tswr™”
);

2606 
	}
}

2623 
	$tswr™e_İ’_fe
(*
Çme
,

2624 
qu›t
,

2625 
TS_wr™”_p
 *
tswr™”
)

2627  
	`tswr™e_İ’
((
Çme
==
NULL
?
TS_W_STDOUT
:
TS_W_FILE
),Çme,NULL,0,
qu›t
,

2628 
tswr™”
);

2629 
	}
}

2642 
	$tswr™e_wa™_fÜ_ş›Á
(
£rv”_sock‘
,

2643 
qu›t
,

2644 
TS_wr™”_p
 *
tswr™”
)

2646 
TS_wr™”_p
 
Ãw
;

2647 
”r
 = 
	`tswr™e_bud
(
TS_W_TCP
,
qu›t
,
tswr™”
);

2648 ià(
”r
)  1;

2649 
Ãw
 = *
tswr™”
;

2651 
Ãw
->
£rv”
 = 
TRUE
;

2654 
”r
 = 
	`li¡’
(
£rv”_sock‘
,1);

2655 ià(
”r
 == -1)

2657 #ifdeà
_WIN32


2658 
”r
 = 
	`WSAG‘La¡E¼Ü
();

2659 
	`´št_”r
("### Error†istening for client: ");

2660 
	`´št_wšsock_”r
(
”r
);

2661 
	`´št_”r
("\n");

2663 
	`åršt_”r
("### E¼Ü†i¡’šg fÜ cl›Á: %s\n",
	`¡»¼Ü
(
”ºo
));

2669 
Ãw
->
wh”e
.
sock‘
 = 
	`acû±
(
£rv”_sock‘
,
NULL
,NULL);

2670 ià(
Ãw
->
wh”e
.
sock‘
 == -1)

2672 #ifdeà
_WIN32


2673 
”r
 = 
	`WSAG‘La¡E¼Ü
();

2674 
	`´št_”r
("### Error‡ccepting connection: ");

2675 
	`´št_wšsock_”r
(
”r
);

2676 
	`´št_”r
("\n");

2678 
	`åršt_”r
("### E¼Ü‡cû±šg cÚÃùiÚ: %s\n",
	`¡»¼Ü
(
”ºo
));

2683 
	}
}

2719 
	$tswr™e_¡¬t_bufãršg
(
TS_wr™”_p
 
tswr™”
,

2720 
cœc_buf_size
,

2721 
TS_š_·ck‘
,

2722 
maxnowa™
,

2723 
wa™fÜ
,

2724 
by‹¿‹
,

2725 
tswr™e_pü_mode
 
pü_mode
,

2726 
´ime_size
,

2727 
´ime_¥“dup
,

2728 
pü_sÿË
,

2729 cÚ¡ 
tswr™e_pkt_hdr_ty³_t
 
hdr_ty³
)

2731 
”r
;

2733 ià(
tswr™”
->
how
 !ğ
TS_W_UDP
)

2735 
	`åršt_”r
("### Buffered output‚ot supported for %s output\n",

2736 (
tswr™”
->
how
 =ğ
TS_W_TCP
?"TCP/IP":

2737 
tswr™”
->
how
 =ğ
TS_W_FILE
?"file":

2738 
tswr™”
->
how
 =ğ
TS_W_STDOUT
?"<standard output>":"???"));

2742 
”r
 = 
	`bud_bufã»d_TS_ouut
(&(
tswr™”
->
wr™”
),

2743 
cœc_buf_size
,
TS_š_·ck‘
,

2744 
maxnowa™
,
wa™fÜ
,
by‹¿‹
,
pü_mode
,

2745 
´ime_size
,
´ime_¥“dup
,
pü_sÿË
,

2746 
hdr_ty³
);

2747 ià(
”r
)  1;

2749 
”r
 = 
	`¡¬t_chd
(
tswr™”
);

2750 ià(
”r
)

2752 (è
	`ä“_bufã»d_TS_ouut
(&
tswr™”
->
wr™”
);

2756 
	}
}

2770 
	$tswr™e_¡¬t_bufãršg_äom_cÚ‹xt
(
TS_wr™”_p
 
tswr™”
,

2771 
TS_cÚ‹xt_p
 
cÚ‹xt
)

2773  
	`tswr™e_¡¬t_bufãršg
(
tswr™”
,

2774 
cÚ‹xt
->
cœc_buf_size
,

2775 
cÚ‹xt
->
TS_š_™em
,

2776 
cÚ‹xt
->
maxnowa™
,

2777 
cÚ‹xt
->
wa™fÜ
,

2778 
cÚ‹xt
->
by‹¿‹
,

2779 
cÚ‹xt
->
pü_mode
,

2780 
cÚ‹xt
->
´ime_size
,

2781 
cÚ‹xt
->
´ime_¥“dup
,

2782 
cÚ‹xt
->
pü_sÿË
,

2783 
cÚ‹xt
->
pkt_hdr_ty³
);

2784 
	}
}

2816 
	$tswr™e_¡¬t_šput
(
TS_wr™”_p
 
tswr™”
,

2817 
SOCKET
 
šput
)

2819 
”r
;

2820 #ifdeà
_WIN32


2821 
u_lÚg
 
Úe
 = 1;

2823 
æags
;

2826 ià(
tswr™”
->
how
 !ğ
TS_W_TCP
)

2828 
	`´št_”r
("### Command input is only supported for TCP/IP\n");

2833 #ifdeà
_WIN32


2834 
”r
 = 
	`ioùlsock‘
(
tswr™”
->
wh”e
.
sock‘
,
FIONBIO
,&
Úe
);

2835 ià(
”r
 =ğ
SOCKET_ERROR
)

2837 
”r
 = 
	`WSAG‘La¡E¼Ü
();

2838 
	`´št_”r
("### Unableo set socket‚onblocking: ");

2839 
	`´št_wšsock_”r
(
”r
);

2840 
	`´št_”r
("\n");

2844 
æags
 = 
	`fú
(
tswr™”
->
wh”e
.
sock‘
,
F_GETFL
,0);

2845 ià(
æags
 == -1)

2847 
	`åršt_”r
("### Error getting flags for output socket: %s\n",

2848 
	`¡»¼Ü
(
”ºo
));

2851 
”r
 = 
	`fú
(
tswr™”
->
wh”e
.
sock‘
,
F_SETFL
,
æags
 | 
O_NONBLOCK
);

2852 ià(
”r
 == -1)

2854 
	`åršt_”r
("### Error setting output socket‚on-blocking: %s\n",

2855 
	`¡»¼Ü
(
”ºo
));

2860 
tswr™”
->
commªd_sock‘
 = 
šput
;

2861 
tswr™”
->
commªd
 = 
COMMAND_PAUSE
;

2863 
	}
}

2874 
	$tswr™e_£t_commªd_©omic
(
TS_wr™”_p
 
tswr™”
,

2875 
©omic
)

2877 
tswr™”
->
©omic_commªd
 = 
©omic
;

2878 
	}
}

2888 
	$tswr™e_commªd_chªged
(
TS_wr™”_p
 
tswr™”
)

2890 ià(
tswr™”
->
commªd_sock‘
 == -1)

2891  
FALSE
;

2894 ià(
tswr™”
->
©omic_commªd
)

2895  
FALSE
;

2897  
tswr™”
->
commªd_chªged
;

2899 
	}
}

2909 
	$tswr™e_şo£_chd
(
TS_wr™”_p
 
tswr™”
,

2910 
qu›t
)

2912 
”r
;

2914 ià(
tswr™”
->
wr™”
 =ğ
NULL
)

2917 ià(
tswr™”
->
chd
 == 0)

2920 ià(
tswr™”
->
wr™”
)

2924 
”r
 = 
	`wr™e_EOF_to_bufã»d_TS_ouut
(
tswr™”
->
wr™”
);

2925 ià(
”r
)

2927 
	`´št_”r
("### Error‡dding EOF indicatoro TS buffer\n");

2928 (è
	`ä“_bufã»d_TS_ouut
(&
tswr™”
->
wr™”
);

2933 #iâdeà
_WIN32


2939 
”r
 = 
	`wa™_fÜ_chd_to_ex™
(
tswr™”
,
qu›t
);

2940 ià(
”r
)

2942 (è
	`ä“_bufã»d_TS_ouut
(&
tswr™”
->
wr™”
);

2946 ià(
tswr™”
->
wr™”
)

2949 
”r
 = 
	`ä“_bufã»d_TS_ouut
(&(
tswr™”
->
wr™”
));

2950 ià(
”r
)

2952 
	`´št_”r
("### Error freeing TS buffer\n");

2958 
	}
}

2967 
	$tswr™e_şo£_fe
(
TS_wr™”_p
 
tswr™”
)

2969 
”r
;

2971 
tswr™”
->
how
)

2973 
TS_W_STDOUT
:

2976 
TS_W_FILE
:

2977 
”r
 = 
	`fşo£
(
tswr™”
->
wh”e
.
fe
);

2978 ià(
”r
 =ğ
EOF
)

2980 
	`åršt_”r
("### E¼Ü closšg ouut: %s\n",
	`¡»¼Ü
(
”ºo
));

2984 
TS_W_TCP
:

2985 
TS_W_UDP
:

2986 
”r
 = 
	`discÚÃù_sock‘
(
tswr™”
->
wh”e
.
sock‘
);

2987 ià(
”r
 =ğ
EOF
)

2989 
	`åršt_”r
("### E¼Ü closšg ouut: %s\n",
	`¡»¼Ü
(
”ºo
));

2994 
	`åršt_”r
("### Unexpected writerype %doswrite_close()\n",

2995 
tswr™”
->
how
);

2999 
	}
}

3014 
	$tswr™e_şo£
(
TS_wr™”_p
 
tswr™”
,

3015 
qu›t
)

3017 
”r
;

3019 ià(
tswr™”
 =ğ
NULL
)

3023 
”r
 = 
	`tswr™e_şo£_chd
(
tswr™”
,
qu›t
);

3024 ià(
”r
)

3026 
	`´št_”r
("### Error closing child…rocess\n");

3027 #ifdeà
_WIN32


3028 ià(!
tswr™”
->
wr™”
)

3031 (è
	`tswr™e_şo£_fe
(
tswr™”
);

3032 
	`ä“
(
tswr™”
);

3033 #ifdeà
_WIN32


3039 #ifdeà
_WIN32


3040 ià(
tswr™”
->
wr™”
)

3053 
”r
 = 
	`tswr™e_şo£_fe
(
tswr™”
);

3054 ià(
”r
)

3056 
	`´št_”r
("### Error closing output\n");

3057 
	`ä“
(
tswr™”
);

3061 ià(!
qu›t
)

3062 
	`åršt_msg
("Ouuˆ%d TS…ack‘s\n",
tswr™”
->
couÁ
);

3064 
	`ä“
(
tswr™”
);

3065 #ifdeà
_WIN32


3069 
	}
}

3087 
	$tswr™e_wr™e
(
TS_wr™”_p
 
tswr™”
,

3088 
by‹
 
·ck‘
[
TS_PACKET_SIZE
],

3089 
ušt32_t
 
pid
,

3090 
gÙ_pü
,

3091 
ušt64_t
 
pü
)

3093 
”r
;

3095 ià(
tswr™”
->
drİ_·ck‘s
)

3098 
·ck‘_couÁ
 = 0;

3099 
drİ_couÁ
 = 0;

3100 ià(
drİ_couÁ
 > 0)

3103 
	`´št_msg
("x");

3105 
drİ_couÁ
 --;

3108 ià(
·ck‘_couÁ
 < 
tswr™”
->
drİ_·ck‘s
)

3111 ià(
·ck‘_couÁ
 =ğ0è
	`´št_msg
("\n");

3112 
	`´št_msg
(".");

3114 
·ck‘_couÁ
 ++;

3119 
	`´št_msg
("X");

3121 
·ck‘_couÁ
 = 0;

3122 
drİ_couÁ
 = 
tswr™”
->
drİ_numb”
 - 1;

3127 ià(
tswr™”
->
wr™”
 =ğ
NULL
)

3130 
tswr™”
->
how
)

3132 
TS_W_STDOUT
:

3133 
TS_W_FILE
:

3134 
”r
 = 
	`wr™e_fe_d©a
(
tswr™”
,
·ck‘
,
TS_PACKET_SIZE
);

3135 ià(
”r
)  1;

3137 
TS_W_TCP
:

3138 
”r
 = 
	`wr™e_tı_d©a
(
tswr™”
,
·ck‘
,
TS_PACKET_SIZE
);

3139 ià(
”r
) ƒrr;

3141 
TS_W_UDP
:

3142 
”r
 = 
	`wr™e_sock‘_d©a
(
tswr™”
->
wh”e
.
sock‘
,
·ck‘
,
TS_PACKET_SIZE
);

3143 ià(
”r
)  1;

3146 
	`åršt_”r
("### Unexpected writerype %doswrite_write()\n",

3147 
tswr™”
->
how
);

3150 (
tswr™”
->
couÁ
)++;

3155 
”r
 = 
	`wr™e_to_bufã»d_TS_ouut
(
tswr™”
->
wr™”
,
·ck‘
,

3156 (
tswr™”
->
couÁ
)++,

3157 
pid
,
gÙ_pü
,
pü
);

3158 ià(
”r
)  1;

3161 
	}
}

3168 
	$tswr™e_discÚtšu™y
(cÚ¡ 
TS_wr™”_p
 
tswr™”
)

3170 ià(
tswr™”
->
wr™”
 =ğ
NULL
)

3173 
	`š‹º®_æush_bufã»d_TS_ouut
(
tswr™”
->
wr™”
);

3175 
	`discÚtšu™y_bufã»d_TS_ouut
(
tswr™”
->
wr™”
);

3178 
	}
}

3187 
	$tswr™e_h–p_tunšg
()

3189 
	`åršt_msg
(

3272 
DEFAULT_BYTE_RATE
,

3273 
DEFAULT_BYTE_RATE
*8,

3274 
DEFAULT_CIRCULAR_BUFFER_SIZE
,

3275 
DEFAULT_PRIME_SIZE
);

3276 
	}
}

3282 
	$tswr™e_h–p_‹¡šg
()

3284 
	`´št_msg
(

3299 
	}
}

3305 
	$tswr™e_h–p_debug
()

3307 
	`´št_msg
(

3313 #ià
DISPLAY_BUFFER


3320 
	}
}

3327 
	$tswr™e_»pÜt_¬gs
(
TS_cÚ‹xt_p
 
cÚ‹xt
)

3329 
	`åršt_msg
("CœcuÏ¸bufã¸siz%d (+1)\n",
cÚ‹xt
->
cœc_buf_size
);

3330 
	`åršt_msg
("Transmitting %s%d TS…acket%s (%d bytes)…er‚etwork"

3332 
cÚ‹xt
->
TS_š_™em
==1?"":"(upo) ",

3333 
cÚ‹xt
->
TS_š_™em
,

3334 
cÚ‹xt
->
TS_š_™em
==1?"":"s",

3335 
cÚ‹xt
->
TS_š_™em
*
TS_PACKET_SIZE
);

3337 ià(
cÚ‹xt
->
b™¿‹
 % 1000000 == 0)

3338 
	`åršt_msg
("Reque¡ed d©¨¿‹ i %d Mbp ",
cÚ‹xt
->
b™¿‹
/1000000);

3339 ià(
cÚ‹xt
->
b™¿‹
 % 1000 == 0)

3340 
	`åršt_msg
("Reque¡ed d©¨¿‹ i %d kbp ",
cÚ‹xt
->
b™¿‹
/1000);

3342 
	`åršt_msg
("Reque¡ed d©¨¿‹ i %d bp ",
cÚ‹xt
->
b™¿‹
);

3343 
	`åršt_msg
("(%d by‹s/£cÚd)\n",
cÚ‹xt
->
by‹¿‹
);

3345 ià(
cÚ‹xt
->
maxnowa™
 == -1)

3346 
	`´št_msg
("Maximum‚umber of…acketso send with‚o wait: No†imit\n");

3349 
	`åršt_msg
("Maximum‚umber of…acketso send with‚o wait: %d\n",

3350 
cÚ‹xt
->
maxnowa™
);

3351 
	`åršt_msg
("Number of microsecondso waithereafter: %d\n",

3352 
cÚ‹xt
->
wa™fÜ
);

3355 ià(
cÚ‹xt
->
pü_mode
 !ğ
TSWRITE_PCR_MODE_NONE
)

3357 
	`åršt_msg
("PCR mechanism 'primed' withime for %d circular buffer items\n",

3358 
cÚ‹xt
->
´ime_size
);

3359 ià(
cÚ‹xt
->
´ime_¥“dup
 != 100)

3360 
	`åršt_msg
("PCR mechanism 'prime speedup' is %d%%\n",

3361 
cÚ‹xt
->
´ime_¥“dup
);

3364 
	`´št_msg
("Using„equested data„ate directlyoime…ackets"

3367 ià(
cÚ‹xt
->
pü_sÿË
)

3368 
	`åršt_msg
("MuÉly PCR by %g\n",
cÚ‹xt
->
pü_sÿË
);

3370 ià(
glob®_·»Á_wa™
 !ğ
DEFAULT_PARENT_WAIT
)

3371 
	`åršt_msg
("Parent will wait %dms for buffero unfill\n",

3372 
glob®_·»Á_wa™
);

3373 ià(
glob®_chd_wa™
 !ğ
DEFAULT_CHILD_WAIT
)

3374 
	`åršt_msg
("Child will wait %dms for buffero unempty\n",

3375 
glob®_chd_wa™
);

3377 ià(
glob®_³¹urb_¿nge
)

3379 
	`åršt_msg
("Randomly…erturbing childime by -%u..%ums"

3380 " w™h s“d %u\n",
glob®_³¹urb_¿nge
,global_perturb_range,

3381 
glob®_³¹urb_£ed
);

3383 
	}
}

3409 
	$tswr™e_´oûss_¬gs
(*
´efix
,

3410 
¬gc
,

3411 *
¬gv
[],

3412 
TS_cÚ‹xt_p
 
cÚ‹xt
)

3414 
”r
 = 0;

3415 
ii
 = 1;

3417 
cÚ‹xt
->
cœc_buf_size
 = 
DEFAULT_CIRCULAR_BUFFER_SIZE
;

3418 
cÚ‹xt
->
TS_š_™em
 = 
DEFAULT_TS_PACKETS_IN_ITEM
;

3419 
cÚ‹xt
->
maxnowa™
 = -1;

3420 
cÚ‹xt
->
wa™fÜ
 = 1000;

3421 
cÚ‹xt
->
by‹¿‹
 = 
DEFAULT_BYTE_RATE
;

3422 
cÚ‹xt
->
b™¿‹
 = cÚ‹xt->
by‹¿‹
 * 8;

3423 
cÚ‹xt
->
pü_mode
 = 
TSWRITE_PCR_MODE_PCR2
;

3424 
cÚ‹xt
->
´ime_size
 = 
DEFAULT_PRIME_SIZE
;

3425 
cÚ‹xt
->
´ime_¥“dup
 = 100;

3426 
cÚ‹xt
->
pü_sÿË
 = 1.0;

3427 
cÚ‹xt
->
pkt_hdr_ty³
 = 
PKT_HDR_TYPE_NONE
;

3429 
ii
 < 
¬gc
)

3431 ià(!
	`¡rcmp
("-nİüs",
¬gv
[
ii
]))

3433 
cÚ‹xt
->
pü_mode
 = 
TSWRITE_PCR_MODE_NONE
;

3434 
¬gv
[
ii
] = 
TSWRITE_PROCESSED
;

3436 ià(!
	`¡rcmp
("-b™¿‹",
¬gv
[
ii
]))

3438 
	`CHECKARG
(
´efix
,
ii
);

3439 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3440 &
cÚ‹xt
->
b™¿‹
);

3441 ià(
”r
)  1;

3442 
cÚ‹xt
->
by‹¿‹
 = cÚ‹xt->
b™¿‹
 / 8;

3443 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3444 
ii
++;

3446 ià(!
	`¡rcmp
("-by‹¿‹",
¬gv
[
ii
]))

3448 
	`CHECKARG
(
´efix
,
ii
);

3449 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3450 &
cÚ‹xt
->
by‹¿‹
);

3451 ià(
”r
)  1;

3452 
cÚ‹xt
->
b™¿‹
 = cÚ‹xt->
by‹¿‹
 * 8;

3453 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3454 
ii
++;

3456 ià(!
	`¡rcmp
("-´ime",
¬gv
[
ii
]))

3458 
	`CHECKARG
(
´efix
,
ii
);

3459 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3460 &
cÚ‹xt
->
´ime_size
);

3461 ià(
”r
)  1;

3462 ià(
cÚ‹xt
->
´ime_size
 < 1)

3464 
	`åršt_”r
("### %s: -´im0 dÛ nÙ mak£n£\n",
´efix
);

3467 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3468 
ii
++;

3470 ià(!
	`¡rcmp
("-¥“dup",
¬gv
[
ii
]))

3472 
	`CHECKARG
(
´efix
,
ii
);

3473 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3474 &
cÚ‹xt
->
´ime_¥“dup
);

3475 ià(
”r
)  1;

3476 ià(
cÚ‹xt
->
´ime_¥“dup
 < 1)

3478 
	`åršt_”r
("### %s: -¥“du°0 dÛ nÙ mak£n£\n",
´efix
);

3481 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3482 
ii
++;

3484 ià(!
	`¡rcmp
("-pü_sÿË",
¬gv
[
ii
]))

3486 
³rûÁage
;

3487 
	`CHECKARG
(
´efix
,
ii
);

3488 
”r
 = 
	`doubË_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,&
³rûÁage
);

3489 ià(
”r
)  1;

3490 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3491 
ii
++;

3492 
cÚ‹xt
->
pü_sÿË
 = 
³rûÁage
 / 100.0;

3493 
	`åršt_msg
("PCR‡cûË¿tÜ = %g%% = PCR * %g\n",
³rûÁage
,
cÚ‹xt
->
pü_sÿË
);

3495 ià(!
	`¡rcmp
("-maxnowa™",
¬gv
[
ii
]))

3497 
	`CHECKARG
(
´efix
,
ii
);

3498 ià(!
	`¡rcmp
(
¬gv
[
ii
+1],"off"))

3499 
cÚ‹xt
->
maxnowa™
 = -1;

3502 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3503 &
cÚ‹xt
->
maxnowa™
);

3504 ià(
”r
)  1;

3506 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3507 
ii
++;

3509 ià(!
	`¡rcmp
("-wa™fÜ",
¬gv
[
ii
]))

3511 
	`CHECKARG
(
´efix
,
ii
);

3512 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3513 &
cÚ‹xt
->
wa™fÜ
);

3514 ià(
”r
)  1;

3515 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3516 
ii
++;

3518 ià(!
	`¡rcmp
("-bufãr",
¬gv
[
ii
]))

3520 
	`CHECKARG
(
´efix
,
ii
);

3521 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3522 &
cÚ‹xt
->
cœc_buf_size
);

3523 ià(
”r
)  1;

3524 ià(
cÚ‹xt
->
cœc_buf_size
 < 1)

3526 
	`åršt_”r
("### %s: -bufã¸0 dÛ nÙ mak£n£\n",
´efix
);

3529 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3530 
ii
++;

3532 ià(!
	`¡rcmp
("-tsšpkt",
¬gv
[
ii
]))

3534 
	`CHECKARG
(
´efix
,
ii
);

3535 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,

3536 &
cÚ‹xt
->
TS_š_™em
);

3537 ià(
”r
)  1;

3538 ià(
cÚ‹xt
->
TS_š_™em
 < 1)

3540 
	`åršt_”r
("### %s: -tsšpkˆ0 dÛ nÙ mak£n£\n",
´efix
);

3543 ià(
cÚ‹xt
->
TS_š_™em
 > 
MAX_TS_PACKETS_IN_ITEM
)

3545 
	`åršt_”r
("### %s: -tsinpkt %d isoo many (maximum is %d)\n",

3546 
´efix
,
cÚ‹xt
->
TS_š_™em
,
MAX_TS_PACKETS_IN_ITEM
);

3549 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3550 
ii
++;

3552 ià(!
	`¡rcmp
("-¹p", 
¬gv
[
ii
]))

3554 
cÚ‹xt
->
pkt_hdr_ty³
 = 
PKT_HDR_TYPE_RTP
;

3555 
¬gv
[
ii
] = 
TSWRITE_PROCESSED
;

3557 ià(!
	`¡rcmp
("-hd", 
¬gv
[
ii
]))

3559 
cÚ‹xt
->
maxnowa™
 = 40;

3560 
cÚ‹xt
->
b™¿‹
 = 20000000;

3561 
cÚ‹xt
->
by‹¿‹
 = cÚ‹xt->
b™¿‹
 / 8;

3562 
glob®_·»Á_wa™
 = 4;

3563 
glob®_chd_wa™
 = 1;

3564 
¬gv
[
ii
] = 
TSWRITE_PROCESSED
;

3566 ià(!
	`¡rcmp
("-cdebug",
¬gv
[
ii
]))

3568 
glob®_chd_debug
 = 
TRUE
;

3569 
¬gv
[
ii
] = 
TSWRITE_PROCESSED
;

3571 ià(!
	`¡rcmp
("-pdebug",
¬gv
[
ii
]))

3573 
glob®_·»Á_debug
 = 
TRUE
;

3574 
¬gv
[
ii
] = 
TSWRITE_PROCESSED
;

3576 ià(!
	`¡rcmp
("-pdebug2",
¬gv
[
ii
]))

3578 
glob®_·»Á_debug
 = 
TRUE
;

3579 
glob®_show_®l_times
 = 
TRUE
;

3580 
¬gv
[
ii
] = 
TSWRITE_PROCESSED
;

3582 ià(!
	`¡rcmp
("-pwa™",
¬gv
[
ii
]))

3584 
‹mp
;

3585 
	`CHECKARG
(
´efix
,
ii
);

3586 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
‹mp
);

3587 ià(
”r
)  1;

3588 ià(
‹mp
 == 0)

3590 
	`åršt_”r
("### %s: -pwa™ 0 dÛ nÙ mak£n£\n",
´efix
);

3593 ià(
‹mp
 > 999)

3595 
	`åršt_”r
("### %s: -pwait %d (morehan 999)‚ot‡llowed\n",

3596 
´efix
,
‹mp
);

3599 
glob®_·»Á_wa™
 = 
‹mp
;

3600 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3601 
ii
++;

3603 ià(!
	`¡rcmp
("-cwa™",
¬gv
[
ii
]))

3605 
‹mp
;

3606 
	`CHECKARG
(
´efix
,
ii
);

3607 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
‹mp
);

3608 ià(
”r
)  1;

3609 ià(
‹mp
 == 0)

3611 
	`åršt_”r
("### %s: -cwa™ 0 dÛ nÙ mak£n£\n",
´efix
);

3614 ià(
‹mp
 > 999)

3616 
	`åršt_”r
("### %s: -cwait %d (morehan 999)‚ot‡llowed\n",

3617 
´efix
,
‹mp
);

3620 
glob®_chd_wa™
 = 
‹mp
;

3621 
¬gv
[
ii
] =‡rgv[ii+1] = 
TSWRITE_PROCESSED
;

3622 
ii
++;

3624 ià(!
	`¡rcmp
("-³¹urb",
¬gv
[
ii
]))

3626 
‹mp
;

3627 ià(
ii
+3 >ğ
¬gc
)

3629 
	`åršt_”r
("### %s: -perturb should havehree‡rguments: "

3630 "<£ed> <¿nge> <v”bo£>\n",
´efix
);

3633 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+1],
TRUE
,10,&
‹mp
);

3634 ià(
”r
)  1;

3635 
glob®_³¹urb_£ed
 = 
‹mp
;

3636 
”r
 = 
	`št_v®ue
(
´efix
,
¬gv
[
ii
],¬gv[ii+2],
TRUE
,10,&
‹mp
);

3637 ià(
”r
)  1;

3638 ià(
‹mp
 == 0)

3640 
	`åršt_”r
("### %s:‡„ªgoà0 fÜ -³¹urb dÛ nÙ mak£n£\n",
´efix
);

3643 
glob®_³¹urb_¿nge
 = 
‹mp
;

3644 ià(
	`¡¾’
(
¬gv
[
ii
+3]) != 1)

3646 
	`åršt_”r
("### %s:he <verbose> flag for -perturb must be 0 or 1,"

3647 "‚Ù '%s'\n",
´efix
,
¬gv
[
ii
+3]);

3650 
¬gv
[
ii
+3][0])

3653 
glob®_³¹urb_v”bo£
 = 
FALSE
;

3656 
glob®_³¹urb_v”bo£
 = 
TRUE
;

3659 
	`åršt_”r
("### %s:he <verbose> flag for -perturb must be 0 or 1,"

3660 "nÙ '%c'\n",
´efix
,
¬gv
[
ii
+3][0]);

3663 
¬gv
[
ii
] =‡rgv[ii+1] =‡rgv[ii+2] =‡rgv[ii+3] = 
TSWRITE_PROCESSED
;

3664 
ii
+=3;

3666 #ià
DISPLAY_BUFFER


3667 ià(!
	`¡rcmp
("-visu®",
¬gv
[
ii
]))

3669 
glob®_show_cœcuÏr
 = 
TRUE
;

3670 
¬gv
[
ii
] = 
TSWRITE_PROCESSED
;

3673 
ii
++;

3676 
	}
}

	@tswrite_defns.h

33 #iâdeà
_tswr™e_deâs


34 
	#_tswr™e_deâs


	)

36 
	~"com·t.h
"

37 
	~"ts_deâs.h
"

38 
	~"h222_deâs.h
"

40 #ifdeà
_WIN32


41 
	~<wšsock2.h
>

43 
	tSOCKET
;

44 
	~<‹rmios.h
>

48 
	gbufã»d_TS_ouut
;

49 
bufã»d_TS_ouut
 *
	tbufã»d_TS_ouut_p
;

50 
	#SIZEOF_BUFFERED_TS_OUTPUT
 (
bufã»d_TS_ouut
)

	)

59 
	eTS_wr™”_ty³


61 
	mTS_W_UNDEFINED
,

62 
	mTS_W_STDOUT
,

63 
	mTS_W_FILE
,

64 
	mTS_W_TCP
,

65 
	mTS_W_UDP
,

67 
TS_wr™”_ty³
 
	tTS_WRITER_TYPE
;

71 
	uTS_wr™”_ouut


73 
FILE
 *
	mfe
;

74 
SOCKET
 
	msock‘
;

96 
	sTS_wr™”


98 
TS_wr™”_ty³
 
	mhow
;

99 
TS_wr™”_ouut
 
	mwh”e
;

100 
bufã»d_TS_ouut_p
 
	mwr™”
;

101 
	mcouÁ
;

105 #ifdeà
_WIN32


106 
HANDLE
 
	mchd
;

108 
pid_t
 
	mchd
;

110 
	mqu›t
;

117 
	m£rv”
;

118 
SOCKET
 
	mcommªd_sock‘
;

127 
by‹
 
	mcommªd
;

128 
	mcommªd_chªged
;

134 
	m©omic_commªd
;

138 
	mdrİ_·ck‘s
;

139 
	mdrİ_numb”
;

141 
TS_wr™”
 *
	tTS_wr™”_p
;

142 
	#SIZEOF_TS_WRITER
 (
TS_wr™”
)

	)

146 
	#COMMAND_NOT_A_COMMAND
 '_'

147 

	)

148 
	#COMMAND_QUIT
 'q'

149 
	#COMMAND_NORMAL
 'n'

150 
	#COMMAND_PAUSE
 'p'

151 
	#COMMAND_FAST
 'f'

152 
	#COMMAND_FAST_FAST
 'F'

153 
	#COMMAND_REVERSE
 'r'

154 
	#COMMAND_FAST_REVERSE
 'R'

155 
	#COMMAND_SKIP_FORWARD
 '>'

156 
	#COMMAND_SKIP_BACKWARD
 '<'

157 
	#COMMAND_SKIP_FORWARD_LOTS
 ']'

158 
	#COMMAND_SKIP_BACKWARD_LOTS
 '['

159 

	)

160 
	#COMMAND_SELECT_FILE_0
 '0'

	)

161 
	#COMMAND_SELECT_FILE_1
 '1'

	)

162 
	#COMMAND_SELECT_FILE_2
 '2'

	)

163 
	#COMMAND_SELECT_FILE_3
 '3'

	)

164 
	#COMMAND_SELECT_FILE_4
 '4'

	)

165 
	#COMMAND_SELECT_FILE_5
 '5'

	)

166 
	#COMMAND_SELECT_FILE_6
 '6'

	)

167 
	#COMMAND_SELECT_FILE_7
 '7'

	)

168 
	#COMMAND_SELECT_FILE_8
 '8'

	)

169 
	#COMMAND_SELECT_FILE_9
 '9'

	)

172 
	#COMMAND_RETURN_CODE
 -999

	)

175 
	etswr™e_pü_mode_e
 {

176 
	mTSWRITE_PCR_MODE_NONE
,

177 
	mTSWRITE_PCR_MODE_PCR1
,

178 
	mTSWRITE_PCR_MODE_PCR2


179 } 
	ttswr™e_pü_mode
;

181 
	etswr™e_pkt_hdr_ty³_e


183 
	mPKT_HDR_TYPE_NONE
 = 0,

184 
	mPKT_HDR_TYPE_RTP


185 } 
	ttswr™e_pkt_hdr_ty³_t
;

190 
	sTS_cÚ‹xt


193 
	mcœc_buf_size
;

194 
	mTS_š_™em
;

195 
	mmaxnowa™
;

196 
	mwa™fÜ
;

197 
	mb™¿‹
;

198 
	mby‹¿‹
;

199 
tswr™e_pü_mode
 
	mpü_mode
;

200 
	m´ime_size
;

201 
	m´ime_¥“dup
;

202 
tswr™e_pkt_hdr_ty³_t
 
	mpkt_hdr_ty³
;

203 
	mpü_sÿË
;

205 
TS_cÚ‹xt
 *
	tTS_cÚ‹xt_p
;

208 
	#TSWRITE_PROCESSED
 "<´oûs£d>"

	)

	@tswrite_fns.h

33 #iâdeà
_tswr™e_âs


34 
	#_tswr™e_âs


	)

36 
	~"tswr™e_deâs.h
"

73 
tswr™e_İ’
(
TS_WRITER_TYPE
 
how
,

74 *
Çme
,

75 *
muÉiÿ¡_if
,

76 
pÜt
,

77 
qu›t
,

78 
TS_wr™”_p
 *
tswr™”
);

99 
tswr™e_İ’_cÚÃùiÚ
(
u£_tı
,

100 *
Çme
,

101 
pÜt
,

102 
qu›t
,

103 
TS_wr™”_p
 *
tswr™”
);

119 
tswr™e_İ’_fe
(*
Çme
,

120 
qu›t
,

121 
TS_wr™”_p
 *
tswr™”
);

133 
tswr™e_wa™_fÜ_ş›Á
(
£rv”_sock‘
,

134 
qu›t
,

135 
TS_wr™”_p
 *
tswr™”
);

171 
tswr™e_¡¬t_bufãršg
(
TS_wr™”_p
 
tswr™”
,

172 
cœc_buf_size
,

173 
TS_š_·ck‘
,

174 
maxnowa™
,

175 
wa™fÜ
,

176 
by‹¿‹
,

177 
tswr™e_pü_mode
 
pü_mode
,

178 
´ime_size
,

179 
´ime_¥“dup
,

180 
pü_sÿË
,

181 cÚ¡ 
tswr™e_pkt_hdr_ty³_t
 
hdr_ty³
);

195 
tswr™e_¡¬t_bufãršg_äom_cÚ‹xt
(
TS_wr™”_p
 
tswr™”
,

196 
TS_cÚ‹xt_p
 
cÚ‹xt
);

227 
tswr™e_¡¬t_šput
(
TS_wr™”_p
 
tswr™”
,

228 
SOCKET
 
šput
);

238 
tswr™e_£t_commªd_©omic
(
TS_wr™”_p
 
tswr™”
,

239 
©omic
);

248 
tswr™e_commªd_chªged
(
TS_wr™”_p
 
tswr™”
);

260 
tswr™e_şo£
(
TS_wr™”_p
 
tswr™”
,

261 
qu›t
);

270 
wa™_fÜ_commªd
(
TS_wr™”_p
 
tswr™”
);

288 
tswr™e_wr™e
(
TS_wr™”_p
 
tswr™”
,

289 
by‹
 
·ck‘
[
TS_PACKET_SIZE
],

290 
ušt32_t
 
pid
,

291 
gÙ_pü
,

292 
ušt64_t
 
pü
);

294 
tswr™e_discÚtšu™y
(cÚ¡ 
TS_wr™”_p
 
tswr™”
);

300 
tswr™e_h–p_tunšg
();

305 
tswr™e_h–p_‹¡šg
();

310 
tswr™e_h–p_debug
();

319 
tswr™e_»pÜt_¬gs
(
TS_cÚ‹xt_p
 
cÚ‹xt
);

344 
tswr™e_´oûss_¬gs
(*
´efix
,

345 
¬gc
,

346 *
¬gv
[],

347 
TS_cÚ‹xt_p
 
cÚ‹xt
);

	@version.h

29 #iâdeà
_v”siÚ


30 
	#_v”siÚ


	)

32 
	~"´štšg_âs.h
"

34 cÚ¡ 
	gsoáw¬e_v”siÚ
[] = "1.12";

38 
	#REPORT_VERSION
(
´og¿m_Çme
) \

39 
	`åršt_msg
(" TSools version %s, %s built %s %s\n", \

40 
soáw¬e_v”siÚ
,(
´og¿m_Çme
), \

41 
__DATE__
,
__TIME__
)

	)

	@video_defns.h

29 #iâdeà
_video_deâs


30 
	#_video_deâs


	)

32 
	~"h222_deâs.h
"

36 
	#VIDEO_UNKNOWN
 0

37 
	#VIDEO_H262
 
MPEG2_VIDEO_STREAM_TYPE


	)

38 
	#VIDEO_H264
 
AVC_VIDEO_STREAM_TYPE


	)

39 
	#VIDEO_AVS
 
AVS_VIDEO_STREAM_TYPE


	)

40 
	#VIDEO_MPEG4_PART2
 
MPEG4_PART2_VIDEO_STREAM_TYPE


	)

	@/usr/include/arpa/inet.h

19 #iâdeà
_ARPA_INET_H


20 
	#_ARPA_INET_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<Ãtš‘/š.h
>

26 #iâdeà
__sockËn_t_defšed


27 
__sockËn_t
 
	tsockËn_t
;

28 
	#__sockËn_t_defšed


	)

31 
__BEGIN_DECLS


35 
š_addr_t
 
	$š‘_addr
 (
__cÚ¡
 *
__ı
è
__THROW
;

38 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

42 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

43 
__THROW
;

46 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

50 
š_addr_t
 
	$š‘_ÃtwÜk
 (
__cÚ¡
 *
__ı
è
__THROW
;

54 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

59 
	$š‘_±Ú
 (
__af
, 
__cÚ¡
 *
__»¡riù
 
__ı
,

60 *
__»¡riù
 
__buf
è
__THROW
;

65 
__cÚ¡
 *
	$š‘_Áİ
 (
__af
, 
__cÚ¡
 *
__»¡riù
 
__ı
,

66 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

67 
__THROW
;

71 #ifdeà
__USE_MISC


74 
	$š‘_©Ú
 (
__cÚ¡
 *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

78 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

83 *
	$š‘_Ãt_Áİ
 (
__af
, 
__cÚ¡
 *
__ı
, 
__b™s
,

84 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

89 
	$š‘_Ãt_±Ú
 (
__af
, 
__cÚ¡
 *
__ı
,

90 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

95 
	$š‘_n§p_addr
 (
__cÚ¡
 *
__ı
,

96 *
__buf
, 
__Ën
è
__THROW
;

100 *
	$š‘_n§p_Áß
 (
__Ën
, 
__cÚ¡
 *
__ı
,

101 *
__buf
è
__THROW
;

104 
__END_DECLS


	@/usr/include/assert.h

24 #ifdef 
_ASSERT_H


26 #undeà
_ASSERT_H


27 #undeà
as£¹


28 #undeà
__ASSERT_VOID_CAST


30 #ifdef 
__USE_GNU


31 #undeà
as£¹_³¼Ü


36 
	#_ASSERT_H
 1

	)

37 
	~<ã©u»s.h
>

39 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

40 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

42 
	#__ASSERT_VOID_CAST
 ()

	)

50 #ifdef 
NDEBUG


52 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

60 #ifdef 
__USE_GNU


61 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

66 #iâdeà
_ASSERT_H_DECLS


67 
	#_ASSERT_H_DECLS


	)

68 
__BEGIN_DECLS


71 
	$__as£¹_ç
 (
__cÚ¡
 *
__as£¹iÚ
, __cÚ¡ *
__fe
,

72 
__lše
, 
__cÚ¡
 *
__funùiÚ
)

73 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

76 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, 
__cÚ¡
 *
__fe
,

77 
__lše
,

78 
__cÚ¡
 *
__funùiÚ
)

79 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

84 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

85 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

88 
__END_DECLS


91 
	#as£¹
(
ex´
) \

92 ((
ex´
) \

93 ? 
	`__ASSERT_VOID_CAST
 (0) \

94 : 
	`__as£¹_ç
 (
	`__STRING
(
ex´
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

96 #ifdef 
__USE_GNU


97 
	#as£¹_³¼Ü
(
”ºum
) \

98 (!(
”ºum
) \

99 ? 
	`__ASSERT_VOID_CAST
 (0) \

100 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

108 #ià
defšed
 
__ılu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

109 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

111 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

112 
	#__ASSERT_FUNCTION
 
__func__


	)

114 
	#__ASSERT_FUNCTION
 ((
__cÚ¡
 *è0)

	)

	@/usr/include/ctype.h

24 #iâdef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

30 
	g__BEGIN_DECLS


32 #iâdeà
_ISb™


41 
	~<’dŸn.h
>

42 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


43 
	#_ISb™
(
b™
è(1 << (b™))

	)

45 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

50 
	m_ISuµ”
 = 
_ISb™
 (0),

51 
	m_ISlow”
 = 
_ISb™
 (1),

52 
	m_IS®pha
 = 
_ISb™
 (2),

53 
	m_ISdig™
 = 
_ISb™
 (3),

54 
	m_ISxdig™
 = 
_ISb™
 (4),

55 
	m_IS¥aû
 = 
_ISb™
 (5),

56 
	m_IS´št
 = 
_ISb™
 (6),

57 
	m_ISg¿ph
 = 
_ISb™
 (7),

58 
	m_ISbÏnk
 = 
_ISb™
 (8),

59 
	m_ISúŒl
 = 
_ISb™
 (9),

60 
	m_ISpunù
 = 
_ISb™
 (10),

61 
	m_IS®num
 = 
_ISb™
 (11)

81 
__cÚ¡
 **
	$__ùy³_b_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

83 
__cÚ¡
 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

85 
__cÚ¡
 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

86 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

89 #iâdeà
__ılu¥lus


90 
	#__isùy³
(
c
, 
ty³
) \

91 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

92 #–ià
defšed
 
__USE_EXTERN_INLINES


93 
	#__isùy³_f
(
ty³
) \

94 
__ex‹º_šlše
 \

95 
is
##
	`ty³
 (
__c
è
__THROW
 \

97  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

98 
	}

	)
}

101 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

102 
	#__tßscii
(
c
è((cè& 0x7fè

	)

104 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

106 
__BEGIN_NAMESPACE_STD


112 
__exùy³
 (
i§Êum
);

113 
__exùy³
 (
i§Íha
);

114 
__exùy³
 (
isúŒl
);

115 
__exùy³
 (
isdig™
);

116 
__exùy³
 (
i¦ow”
);

117 
__exùy³
 (
isg¿ph
);

118 
__exùy³
 (
i¥ršt
);

119 
__exùy³
 (
i¥unù
);

120 
__exùy³
 (
is¥aû
);

121 
__exùy³
 (
isuµ”
);

122 
__exùy³
 (
isxdig™
);

126 
	$tŞow”
 (
__c
è
__THROW
;

129 
	$touµ”
 (
__c
è
__THROW
;

131 
__END_NAMESPACE_STD


135 #ifdef 
__USE_ISOC99


136 
__BEGIN_NAMESPACE_C99


138 
	`__exùy³
 (
isbÏnk
);

140 
__END_NAMESPACE_C99


143 #ifdeà
__USE_GNU


145 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

148 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


152 
	$i§scii
 (
__c
è
__THROW
;

156 
	$tßscii
 (
__c
è
__THROW
;

160 
	`__exùy³
 (
_touµ”
);

161 
	`__exùy³
 (
_tŞow”
);

165 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

166 (
__ex‹nsiÚ__
 \

167 ({ 
__»s
; \

168 ià( (
c
) > 1) \

170 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

172 
__c
 = (
c
); \

173 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

176 
__»s
 = 
f
 
¬gs
; \

179 
__»s
 = (
a
)[(è(
c
)]; \

180 
__»s
; 
	}
}))

	)

182 #ià!
defšed
 
__NO_CTYPE


183 #ifdeà
__isùy³_f


184 
	$__isùy³_f
 (
®num
)

185 
	$__isùy³_f
 (
®pha
)

186 
	$__isùy³_f
 (
úŒl
)

187 
	$__isùy³_f
 (
dig™
)

188 
	$__isùy³_f
 (
low”
)

189 
	$__isùy³_f
 (
g¿ph
)

190 
	$__isùy³_f
 (
´št
)

191 
	$__isùy³_f
 (
punù
)

192 
	$__isùy³_f
 (
¥aû
)

193 
	$__isùy³_f
 (
uµ”
)

194 
	$__isùy³_f
 (
xdig™
)

195 #ifdeà
__USE_ISOC99


196 
	$__isùy³_f
 (
bÏnk
)

198 #–ià
defšed
 
__isùy³


199 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

200 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

201 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

202 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

203 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

204 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

205 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

206 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

207 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

208 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

209 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

210 #ifdeà
__USE_ISOC99


211 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

215 #ifdeà
__USE_EXTERN_INLINES


216 
__ex‹º_šlše
 

217 
	`__NTH
 (
	$tŞow”
 (
__c
))

219  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

220 
	}
}

222 
__ex‹º_šlše
 

223 
__NTH
 (
	$touµ”
 (
__c
))

225  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

226 
	}
}

229 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


230 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

231 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

234 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


235 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

236 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

238 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

239 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

245 #ifdeà
__USE_XOPEN2K8


259 
	~<xloÿË.h
>

263 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

264 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

266 
	#__exùy³_l
(
Çme
) \

267 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

273 
__exùy³_l
 (
i§Êum_l
);

274 
__exùy³_l
 (
i§Íha_l
);

275 
__exùy³_l
 (
isúŒl_l
);

276 
__exùy³_l
 (
isdig™_l
);

277 
__exùy³_l
 (
i¦ow”_l
);

278 
__exùy³_l
 (
isg¿ph_l
);

279 
__exùy³_l
 (
i¥ršt_l
);

280 
__exùy³_l
 (
i¥unù_l
);

281 
__exùy³_l
 (
is¥aû_l
);

282 
__exùy³_l
 (
isuµ”_l
);

283 
__exùy³_l
 (
isxdig™_l
);

285 
__exùy³_l
 (
isbÏnk_l
);

289 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

290 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

293 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

296 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


297 
	#__tŞow”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

299 
	#__touµ”_l
(
c
, 
loÿË
) \

300 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

301 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

302 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

306 #iâdeà
__NO_CTYPE


307 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

308 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

309 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

310 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

311 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

312 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

313 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

314 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

315 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

316 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

317 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

319 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

321 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


322 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

323 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

326 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

327 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

328 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

329 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

330 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

331 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

332 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

333 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

334 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

335 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

336 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

338 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

340 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


341 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

342 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

349 
__END_DECLS


	@/usr/include/errno.h

23 #iâdef 
_ERRNO_H


27 #iâdef 
__Ãed_Em©h


28 
	#_ERRNO_H
 1

	)

29 
	~<ã©u»s.h
>

32 
	g__BEGIN_DECLS


36 
	~<b™s/”ºo.h
>

37 #undeà
__Ãed_Em©h


39 #ifdef 
_ERRNO_H


46 #iâdef 
”ºo


47 
”ºo
;

50 #ifdeà
__USE_GNU


55 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

59 
	g__END_DECLS


67 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


68 #iâdeà
__”rÜ_t_defšed


69 
	t”rÜ_t
;

70 
	#__”rÜ_t_defšed
 1

	)

72 #undeà
__Ãed_”rÜ_t


	@/usr/include/fcntl.h

24 #iâdef 
_FCNTL_H


25 
	#_FCNTL_H
 1

	)

27 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 
	~<b™s/fú.h
>

37 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


38 
	~<b™s/ty³s.h
>

39 
	#__Ãed_time¥ec


	)

40 
	~<time.h
>

41 
	~<b™s/¡©.h
>

43 
	#S_IFMT
 
__S_IFMT


	)

44 
	#S_IFDIR
 
__S_IFDIR


	)

45 
	#S_IFCHR
 
__S_IFCHR


	)

46 
	#S_IFBLK
 
__S_IFBLK


	)

47 
	#S_IFREG
 
__S_IFREG


	)

48 #ifdeà
__S_IFIFO


49 
	#S_IFIFO
 
__S_IFIFO


	)

51 #ifdeà
__S_IFLNK


52 
	#S_IFLNK
 
__S_IFLNK


	)

54 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


55 
	#S_IFSOCK
 
__S_IFSOCK


	)

60 
	#S_ISUID
 
__S_ISUID


	)

61 
	#S_ISGID
 
__S_ISGID


	)

63 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


65 
	#S_ISVTX
 
__S_ISVTX


	)

68 
	#S_IRUSR
 
__S_IREAD


	)

69 
	#S_IWUSR
 
__S_IWRITE


	)

70 
	#S_IXUSR
 
__S_IEXEC


	)

72 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

74 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

75 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

76 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

78 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

80 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

81 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

82 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

84 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

87 #ifdef 
__USE_MISC


88 #iâdeà
R_OK


91 
	#R_OK
 4

	)

92 
	#W_OK
 2

	)

93 
	#X_OK
 1

	)

94 
	#F_OK
 0

	)

99 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


100 
	#SEEK_SET
 0

	)

101 
	#SEEK_CUR
 1

	)

102 
	#SEEK_END
 2

	)

110 
fú
 (
__fd
, 
__cmd
, ...);

118 #iâdeà
__USE_FILE_OFFSET64


119 
	$İ’
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

121 #ifdeà
__REDIRECT


122 
	`__REDIRECT
 (
İ’
, (
__cÚ¡
 *
__fe
, 
__oæag
, ...), 
İ’64
)

123 
	`__nÚnuÎ
 ((1));

125 
	#İ’
 
İ’64


	)

128 #ifdeà
__USE_LARGEFILE64


129 
	$İ’64
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

132 #ifdeà
__USE_ATFILE


142 #iâdeà
__USE_FILE_OFFSET64


143 
	$İ’©
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

144 
	`__nÚnuÎ
 ((2));

146 #ifdeà
__REDIRECT


147 
	`__REDIRECT
 (
İ’©
, (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
,

148 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

150 
	#İ’©
 
İ’©64


	)

153 #ifdeà
__USE_LARGEFILE64


154 
	$İ’©64
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

155 
	`__nÚnuÎ
 ((2));

164 #iâdeà
__USE_FILE_OFFSET64


165 
	$ü—t
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

167 #ifdeà
__REDIRECT


168 
	`__REDIRECT
 (
ü—t
, (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
),

169 
ü—t64
è
	`__nÚnuÎ
 ((1));

171 
	#ü—t
 
ü—t64


	)

174 #ifdeà
__USE_LARGEFILE64


175 
	$ü—t64
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

178 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

179 && !
defšed
 
__USE_POSIX
))

188 
	#F_ULOCK
 0

	)

189 
	#F_LOCK
 1

	)

190 
	#F_TLOCK
 2

	)

191 
	#F_TEST
 3

	)

193 #iâdeà
__USE_FILE_OFFSET64


194 
	`lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
);

196 #ifdeà
__REDIRECT


197 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

199 
	#lockf
 
lockf64


	)

202 #ifdeà
__USE_LARGEFILE64


203 
	`lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
);

207 #ifdeà
__USE_XOPEN2K


210 #iâdeà
__USE_FILE_OFFSET64


211 
	$posix_çdvi£
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
,

212 
__advi£
è
__THROW
;

214 #ifdeà
__REDIRECT_NTH


215 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

216 
__off64_t
 
__Ën
, 
__advi£
),

217 
posix_çdvi£64
);

219 
	#posix_çdvi£
 
posix_çdvi£64


	)

222 #ifdeà
__USE_LARGEFILE64


223 
	$posix_çdvi£64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
,

224 
__advi£
è
__THROW
;

232 #iâdeà
__USE_FILE_OFFSET64


233 
	`posix_çÎoÿ‹
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

235 #ifdeà
__REDIRECT


236 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

237 
__off64_t
 
__Ën
),

238 
posix_çÎoÿ‹64
);

240 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

243 #ifdeà
__USE_LARGEFILE64


244 
	`posix_çÎoÿ‹64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
);

250 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše
 \

251 && 
defšed
 
__va_¬g_·ck_Ën


252 
	~<b™s/fú2.h
>

255 
__END_DECLS


	@/usr/include/inttypes.h

23 #iâdeà
_INTTYPES_H


24 
	#_INTTYPES_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	~<¡dšt.h
>

31 #iâdeà
____gwch¬_t_defšed


32 #ifdeà
__ılu¥lus


33 
	#__gwch¬_t
 
wch¬_t


	)

34 #–ià
defšed
 
__WCHAR_TYPE__


35 
__WCHAR_TYPE__
 
	t__gwch¬_t
;

37 
	#__Ãed_wch¬_t


	)

38 
	~<¡ddef.h
>

39 
wch¬_t
 
	t__gwch¬_t
;

41 
	#____gwch¬_t_defšed
 1

	)

47 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_FORMAT_MACROS


49 #ià
__WORDSIZE
 == 64

50 
	#__PRI64_PREFIX
 "l"

	)

51 
	#__PRIPTR_PREFIX
 "l"

	)

53 
	#__PRI64_PREFIX
 "Î"

	)

54 
	#__PRIPTR_PREFIX


	)

60 
	#PRId8
 "d"

	)

61 
	#PRId16
 "d"

	)

62 
	#PRId32
 "d"

	)

63 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

65 
	#PRIdLEAST8
 "d"

	)

66 
	#PRIdLEAST16
 "d"

	)

67 
	#PRIdLEAST32
 "d"

	)

68 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIdFAST8
 "d"

	)

71 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

72 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

73 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

76 
	#PRIi8
 "i"

	)

77 
	#PRIi16
 "i"

	)

78 
	#PRIi32
 "i"

	)

79 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

81 
	#PRIiLEAST8
 "i"

	)

82 
	#PRIiLEAST16
 "i"

	)

83 
	#PRIiLEAST32
 "i"

	)

84 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIiFAST8
 "i"

	)

87 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

88 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

89 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

92 
	#PRIo8
 "o"

	)

93 
	#PRIo16
 "o"

	)

94 
	#PRIo32
 "o"

	)

95 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

97 
	#PRIoLEAST8
 "o"

	)

98 
	#PRIoLEAST16
 "o"

	)

99 
	#PRIoLEAST32
 "o"

	)

100 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIoFAST8
 "o"

	)

103 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

104 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

105 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

108 
	#PRIu8
 "u"

	)

109 
	#PRIu16
 "u"

	)

110 
	#PRIu32
 "u"

	)

111 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

113 
	#PRIuLEAST8
 "u"

	)

114 
	#PRIuLEAST16
 "u"

	)

115 
	#PRIuLEAST32
 "u"

	)

116 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIuFAST8
 "u"

	)

119 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

120 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

121 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

124 
	#PRIx8
 "x"

	)

125 
	#PRIx16
 "x"

	)

126 
	#PRIx32
 "x"

	)

127 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

129 
	#PRIxLEAST8
 "x"

	)

130 
	#PRIxLEAST16
 "x"

	)

131 
	#PRIxLEAST32
 "x"

	)

132 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIxFAST8
 "x"

	)

135 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

136 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

137 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

140 
	#PRIX8
 "X"

	)

141 
	#PRIX16
 "X"

	)

142 
	#PRIX32
 "X"

	)

143 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

145 
	#PRIXLEAST8
 "X"

	)

146 
	#PRIXLEAST16
 "X"

	)

147 
	#PRIXLEAST32
 "X"

	)

148 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

150 
	#PRIXFAST8
 "X"

	)

151 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

152 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

153 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

157 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

158 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

159 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

160 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

161 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

162 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

166 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

167 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

168 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

169 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

170 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

171 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

177 
	#SCNd8
 "hhd"

	)

178 
	#SCNd16
 "hd"

	)

179 
	#SCNd32
 "d"

	)

180 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

182 
	#SCNdLEAST8
 "hhd"

	)

183 
	#SCNdLEAST16
 "hd"

	)

184 
	#SCNdLEAST32
 "d"

	)

185 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNdFAST8
 "hhd"

	)

188 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

189 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

190 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

193 
	#SCNi8
 "hhi"

	)

194 
	#SCNi16
 "hi"

	)

195 
	#SCNi32
 "i"

	)

196 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

198 
	#SCNiLEAST8
 "hhi"

	)

199 
	#SCNiLEAST16
 "hi"

	)

200 
	#SCNiLEAST32
 "i"

	)

201 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNiFAST8
 "hhi"

	)

204 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

205 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

206 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

209 
	#SCNu8
 "hhu"

	)

210 
	#SCNu16
 "hu"

	)

211 
	#SCNu32
 "u"

	)

212 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

214 
	#SCNuLEAST8
 "hhu"

	)

215 
	#SCNuLEAST16
 "hu"

	)

216 
	#SCNuLEAST32
 "u"

	)

217 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNuFAST8
 "hhu"

	)

220 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

221 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

222 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

225 
	#SCNo8
 "hho"

	)

226 
	#SCNo16
 "ho"

	)

227 
	#SCNo32
 "o"

	)

228 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

230 
	#SCNoLEAST8
 "hho"

	)

231 
	#SCNoLEAST16
 "ho"

	)

232 
	#SCNoLEAST32
 "o"

	)

233 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNoFAST8
 "hho"

	)

236 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

237 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

238 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

241 
	#SCNx8
 "hhx"

	)

242 
	#SCNx16
 "hx"

	)

243 
	#SCNx32
 "x"

	)

244 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

246 
	#SCNxLEAST8
 "hhx"

	)

247 
	#SCNxLEAST16
 "hx"

	)

248 
	#SCNxLEAST32
 "x"

	)

249 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

251 
	#SCNxFAST8
 "hhx"

	)

252 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

253 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

254 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

258 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

259 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

260 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

261 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

262 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

265 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

266 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

267 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

268 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

269 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

274 
	g__BEGIN_DECLS


276 #ià
__WORDSIZE
 == 64

281 
	mquÙ
;

282 
	m»m
;

283 } 
	timaxdiv_t
;

290 
	mquÙ
;

291 
	m»m
;

292 } 
	timaxdiv_t
;

298 
štmax_t
 
	$imaxabs
 (
štmax_t
 
__n
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

301 
imaxdiv_t
 
	$imaxdiv
 (
štmax_t
 
__num”
, iÁmax_ˆ
__d’om
)

302 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

305 
štmax_t
 
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

306 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

309 
uštmax_t
 
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

310 ** 
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

313 
štmax_t
 
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

314 
__gwch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

315 
__THROW
;

318 
uštmax_t
 
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

319 
__gwch¬_t
 ** 
__»¡riù
 
__’d±r
, 
__ba£
)

320 
__THROW
;

322 #ifdeà
__USE_EXTERN_INLINES


324 #ià
__WORDSIZE
 == 64

326 
	$__¡¹Ş_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

327 **
__»¡riù
 
__’d±r
,

328 
__ba£
, 
__group
)

329 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

331 
__ex‹º_šlše
 
štmax_t


332 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

333 
ba£
))

335  
	`__¡¹Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

336 
	}
}

338 
	$__¡¹oul_š‹º®
 (
__cÚ¡
 *

339 
__»¡riù
 
__ÅŒ
,

340 ** 
__»¡riù
 
__’d±r
,

341 
__ba£
, 
__group
)

342 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

344 
__ex‹º_šlše
 
uštmax_t


345 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

346 
ba£
))

348  
	`__¡¹oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

349 
	}
}

351 
	$__wc¡Ş_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 * 
__»¡riù
 
__ÅŒ
,

352 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

353 
__ba£
, 
__group
)

354 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

356 
__ex‹º_šlše
 
štmax_t


357 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

358 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

360  
	`__wc¡Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

361 
	}
}

363 
	$__wc¡oul_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

364 
__»¡riù
 
__ÅŒ
,

365 
__gwch¬_t
 **

366 
__»¡riù
 
__’d±r
,

367 
__ba£
, 
__group
)

368 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

370 
__ex‹º_šlše
 
uštmax_t


371 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

372 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

374  
	`__wc¡oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

375 
	}
}

379 
__ex‹nsiÚ__


380 
	$__¡¹Şl_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

381 **
__»¡riù
 
__’d±r
,

382 
__ba£
, 
__group
)

383 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

385 
__ex‹º_šlše
 
štmax_t


386 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

387 
ba£
))

389  
	`__¡¹Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

390 
	}
}

392 
__ex‹nsiÚ__


393 
	$__¡¹ouÎ_š‹º®
 (
__cÚ¡
 *

394 
__»¡riù
 
__ÅŒ
,

396 
__»¡riù
 
__’d±r
,

397 
__ba£
,

398 
__group
)

399 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

401 
__ex‹º_šlše
 
uštmax_t


402 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

403 
ba£
))

405  
	`__¡¹ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

406 
	}
}

408 
__ex‹nsiÚ__


409 
	$__wc¡Şl_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

410 
__»¡riù
 
__ÅŒ
,

411 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

412 
__ba£
, 
__group
)

413 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

415 
__ex‹º_šlše
 
štmax_t


416 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

417 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

419  
	`__wc¡Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

420 
	}
}

423 
__ex‹nsiÚ__


424 
	$__wc¡ouÎ_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

425 
__»¡riù
 
__ÅŒ
,

426 
__gwch¬_t
 **

427 
__»¡riù
 
__’d±r
,

428 
__ba£
,

429 
__group
)

430 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

432 
__ex‹º_šlše
 
uštmax_t


433 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

434 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

436  
	`__wc¡ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

437 
	}
}

442 
	g__END_DECLS


	@/usr/include/limits.h

24 #iâdeà
_LIBC_LIMITS_H_


25 
	#_LIBC_LIMITS_H_
 1

	)

27 
	~<ã©u»s.h
>

33 
	#MB_LEN_MAX
 16

	)

38 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

43 #iâdeà
_LIMITS_H


44 
	#_LIMITS_H
 1

	)

46 
	~<b™s/wÜdsize.h
>

55 
	#CHAR_BIT
 8

	)

58 
	#SCHAR_MIN
 (-128)

	)

59 
	#SCHAR_MAX
 127

	)

62 
	#UCHAR_MAX
 255

	)

65 #ifdeà
__CHAR_UNSIGNED__


66 
	#CHAR_MIN
 0

	)

67 
	#CHAR_MAX
 
UCHAR_MAX


	)

69 
	#CHAR_MIN
 
SCHAR_MIN


	)

70 
	#CHAR_MAX
 
SCHAR_MAX


	)

74 
	#SHRT_MIN
 (-32768)

	)

75 
	#SHRT_MAX
 32767

	)

78 
	#USHRT_MAX
 65535

	)

81 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

82 
	#INT_MAX
 2147483647

	)

85 
	#UINT_MAX
 4294967295U

	)

88 #ià
__WORDSIZE
 == 64

89 
	#LONG_MAX
 9223372036854775807L

	)

91 
	#LONG_MAX
 2147483647L

	)

93 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

96 #ià
__WORDSIZE
 == 64

97 
	#ULONG_MAX
 18446744073709551615UL

	)

99 
	#ULONG_MAX
 4294967295UL

	)

102 #ifdeà
__USE_ISOC99


105 
	#LLONG_MAX
 9223372036854775807LL

	)

106 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

109 
	#ULLONG_MAX
 18446744073709551615ULL

	)

123 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


125 #šşude_Ãxˆ<
lim™s
.
h
>

131 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


132 #iâdeà
LLONG_MIN


133 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

135 #iâdeà
LLONG_MAX


136 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

138 #iâdeà
ULLONG_MAX


139 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

143 #ifdef 
__USE_POSIX


145 
	~<b™s/posix1_lim.h
>

148 #ifdef 
__USE_POSIX2


149 
	~<b™s/posix2_lim.h
>

152 #ifdef 
__USE_XOPEN


153 
	~<b™s/xİ’_lim.h
>

	@/usr/include/math.h

25 #iâdef 
_MATH_H


26 
	#_MATH_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 
	~<b™s/huge_v®.h
>

35 #ifdeà
__USE_ISOC99


36 
	~<b™s/huge_v®f.h
>

37 
	~<b™s/huge_v®l.h
>

40 
	~<b™s/šf.h
>

43 
	~<b™s/Çn.h
>

47 
	~<b™s/m©hdef.h
>

54 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

55 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

56 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

57 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

58 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

59 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

60 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

61 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

62 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

63 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

64 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

65 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

67 
	#_MdoubË_
 

	)

68 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

69 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

70 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

71 
	~<b™s/m©hÿÎs.h
>

72 #undeà
_MdoubË_


73 #undeà
_MdoubË_BEGIN_NAMESPACE


74 #undeà
_MdoubË_END_NAMESPACE


75 #undeà
__MATH_PRECNAME


77 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


83 #iâdeà
_Mæßt_


84 
	#_Mæßt_
 

	)

86 
	#_MdoubË_
 
_Mæßt_


	)

87 #ifdeà
__STDC__


88 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

90 
	#__MATH_PRECNAME
(
Çme
,
r
èÇm
f
 
	)
r

92 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

93 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

94 
	~<b™s/m©hÿÎs.h
>

95 #undeà
_MdoubË_


96 #undeà
_MdoubË_BEGIN_NAMESPACE


97 #undeà
_MdoubË_END_NAMESPACE


98 #undeà
__MATH_PRECNAME


100 #ià(
__STDC__
 - 0 || 
__GNUC__
 - 0) \

101 && (!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

102 || 
defšed
 
__LDBL_COMPAT
)

103 #ifdeà
__LDBL_COMPAT


105 #ifdeà
__USE_ISOC99


106 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

107 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

108 #ifdeà
__REDIRECT_NTH


109 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

110 
__Ædbl_Ãx‰ow¬df
)

111 
	`__©Œibu‹__
 ((
__cÚ¡__
));

112 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

113 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

114 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

115 (
__x
, 
__y
),

116 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

121 #ià
defšed
 
__LDBL_COMPAT
 || defšed 
__NO_LONG_DOUBLE_MATH


123 #undeà
__MATHDECL_1


124 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

125 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

126 
¬gs
, 
®Ÿs
)

	)

127 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

128 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

134 #iâdeà
_MlÚg_doubË_


135 
	#_MlÚg_doubË_
 

	)

137 
	#_MdoubË_
 
_MlÚg_doubË_


	)

138 #ifdeà
__STDC__


139 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

141 
	#__MATH_PRECNAME
(
Çme
,
r
èÇm
l
 
	)
r

143 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

144 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

145 
	#__MATH_DECLARE_LDOUBLE
 1

	)

146 
	~<b™s/m©hÿÎs.h
>

147 #undeà
_MdoubË_


148 #undeà
_MdoubË_BEGIN_NAMESPACE


149 #undeà
_MdoubË_END_NAMESPACE


150 #undeà
__MATH_PRECNAME


155 #undeà
__MATHDECL_1


156 #undeà
__MATHDECL


157 #undeà
__MATHCALL


160 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


162 
signgam
;

167 #ifdeà
__USE_ISOC99


205 
FP_NAN
,

206 
	#FP_NAN
 
FP_NAN


	)

207 
FP_INFINITE
,

208 
	#FP_INFINITE
 
FP_INFINITE


	)

209 
FP_ZERO
,

210 
	#FP_ZERO
 
FP_ZERO


	)

211 
FP_SUBNORMAL
,

212 
	#FP_SUBNORMAL
 
FP_SUBNORMAL


	)

213 
FP_NORMAL


214 
	#FP_NORMAL
 
FP_NORMAL


	)

218 #ifdeà
__NO_LONG_DOUBLE_MATH


219 
	#åşassify
(
x
) \

220 ( (
x
è=ğ (è? 
	`__åşassifyf
 (xè: 
	`__åşassify
 (x))

	)

222 
	#åşassify
(
x
) \

223 ( (
x
) ==  () \

224 ? 
	`__åşassifyf
 (
x
) \

225 :  (
x
) ==  () \

226 ? 
	`__åşassify
 (
x
è: 
	`__åşassifyl
 (x))

	)

230 #ifdeà
__NO_LONG_DOUBLE_MATH


231 
	#signb™
(
x
) \

232 ( (
x
è=ğ (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

234 
	#signb™
(
x
) \

235 ( (
x
) ==  () \

236 ? 
	`__signb™f
 (
x
) \

237 :  (
x
) ==  () \

238 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

242 #ifdeà
__NO_LONG_DOUBLE_MATH


243 
	#isfš™e
(
x
) \

244 ( (
x
è=ğ (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

246 
	#isfš™e
(
x
) \

247 ( (
x
) ==  () \

248 ? 
	`__fš™ef
 (
x
) \

249 :  (
x
) ==  () \

250 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

254 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

258 #ifdeà
__NO_LONG_DOUBLE_MATH


259 
	#i¢ª
(
x
) \

260 ( (
x
è=ğ (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

262 
	#i¢ª
(
x
) \

263 ( (
x
) ==  () \

264 ? 
	`__i¢ªf
 (
x
) \

265 :  (
x
) ==  () \

266 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

270 #ifdeà
__NO_LONG_DOUBLE_MATH


271 
	#isšf
(
x
) \

272 ( (
x
è=ğ (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

274 
	#isšf
(
x
) \

275 ( (
x
) ==  () \

276 ? 
	`__isšff
 (
x
) \

277 :  (
x
) ==  () \

278 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

282 
	#MATH_ERRNO
 1

	)

283 
	#MATH_ERREXCEPT
 2

	)

288 #iâdeà
__FAST_MATH__


289 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

294 #ifdef 
__USE_MISC


298 
_IEEE_
 = -1,

299 
_SVID_
,

300 
_XOPEN_
,

301 
_POSIX_
,

302 
_ISOC_


303 } 
	t_LIB_VERSION_TYPE
;

308 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

312 #ifdeà
__USE_SVID


318 #ifdeà
__ılu¥lus


319 
__exû±iÚ


321 
exû±iÚ


324 
ty³
;

325 *
Çme
;

326 
¬g1
;

327 
¬g2
;

328 
»tv®
;

329 
	}
};

331 #ifdeà
__ılu¥lus


332 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

334 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

337 
	#X_TLOSS
 1.41484755040568800000e+16

	)

340 
	#DOMAIN
 1

	)

341 
	#SING
 2

	)

342 
	#OVERFLOW
 3

	)

343 
	#UNDERFLOW
 4

	)

344 
	#TLOSS
 5

	)

345 
	#PLOSS
 6

	)

348 
	#HUGE
 3.40282347e+38F

	)

352 #ifdeà
__USE_XOPEN


354 
	#MAXFLOAT
 3.40282347e+38F

	)

361 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


362 
	#M_E
 2.7182818284590452354

	)

363 
	#M_LOG2E
 1.4426950408889634074

	)

364 
	#M_LOG10E
 0.43429448190325182765

	)

365 
	#M_LN2
 0.69314718055994530942

	)

366 
	#M_LN10
 2.30258509299404568402

	)

367 
	#M_PI
 3.14159265358979323846

	)

368 
	#M_PI_2
 1.57079632679489661923

	)

369 
	#M_PI_4
 0.78539816339744830962

	)

370 
	#M_1_PI
 0.31830988618379067154

	)

371 
	#M_2_PI
 0.63661977236758134308

	)

372 
	#M_2_SQRTPI
 1.12837916709551257390

	)

373 
	#M_SQRT2
 1.41421356237309504880

	)

374 
	#M_SQRT1_2
 0.70710678118654752440

	)

380 #ifdeà
__USE_GNU


381 
	#M_El
 2.7182818284590452353602874713526625L

	)

382 
	#M_LOG2El
 1.4426950408889634073599246810018921L

	)

383 
	#M_LOG10El
 0.4342944819032518276511289189166051L

	)

384 
	#M_LN2l
 0.6931471805599453094172321214581766L

	)

385 
	#M_LN10l
 2.3025850929940456840179914546843642L

	)

386 
	#M_PIl
 3.1415926535897932384626433832795029L

	)

387 
	#M_PI_2l
 1.5707963267948966192313216916397514L

	)

388 
	#M_PI_4l
 0.7853981633974483096156608458198757L

	)

389 
	#M_1_PIl
 0.3183098861837906715377675267450287L

	)

390 
	#M_2_PIl
 0.6366197723675813430755350534900574L

	)

391 
	#M_2_SQRTPIl
 1.1283791670955125738961589031215452L

	)

392 
	#M_SQRT2l
 1.4142135623730950488016887242096981L

	)

393 
	#M_SQRT1_2l
 0.7071067811865475244008443621048490L

	)

400 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


401 
	#__NO_MATH_INLINES
 1

	)

404 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

411 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

412 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

413 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

414 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

415 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

416 
	#isunÜd”ed
(
u
, 
v
è
	`__butš_isunÜd”ed
(u, v)

	)

420 #ifdeà
__USE_EXTERN_INLINES


421 
	~<b™s/m©hšlše.h
>

426 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

427 
	~<b™s/m©h-fš™e.h
>

430 #ifdeà
__USE_ISOC99


434 #iâdeà
isg»©”


435 
	#isg»©”
(
x
, 
y
) \

436 (
__ex‹nsiÚ__
 \

437 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

438 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

442 #iâdeà
isg»©”equ®


443 
	#isg»©”equ®
(
x
, 
y
) \

444 (
__ex‹nsiÚ__
 \

445 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

446 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

450 #iâdeà
i¦ess


451 
	#i¦ess
(
x
, 
y
) \

452 (
__ex‹nsiÚ__
 \

453 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

454 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

458 #iâdeà
i¦es£qu®


459 
	#i¦es£qu®
(
x
, 
y
) \

460 (
__ex‹nsiÚ__
 \

461 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

462 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

466 #iâdeà
i¦essg»©”


467 
	#i¦essg»©”
(
x
, 
y
) \

468 (
__ex‹nsiÚ__
 \

469 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

470 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

474 #iâdeà
isunÜd”ed


475 
	#isunÜd”ed
(
u
, 
v
) \

476 (
__ex‹nsiÚ__
 \

477 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

478 
	`åşassify
 (
__u
è=ğ
FP_NAN
 || fpşassify (
__v
è=ğFP_NAN; }))

	)

483 
	g__END_DECLS


	@/usr/include/netdb.h

23 #iâdef 
_NETDB_H


24 
	#_NETDB_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<¡dšt.h
>

30 #ifdeà
__USE_MISC


33 
	~<½c/Ãtdb.h
>

36 #ifdeà
__USE_GNU


37 
	#__Ãed_sigev’t_t


	)

38 
	~<b™s/sigšfo.h
>

39 
	#__Ãed_time¥ec


	)

40 
	~<time.h
>

43 
	~<b™s/Ãtdb.h
>

46 
	#_PATH_HEQUIV
 "/‘c/ho¡s.equiv"

	)

47 
	#_PATH_HOSTS
 "/‘c/ho¡s"

	)

48 
	#_PATH_NETWORKS
 "/‘c/ÃtwÜks"

	)

49 
	#_PATH_NSSWITCH_CONF
 "/‘c/nssw™ch.cÚf"

	)

50 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

51 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

54 
	g__BEGIN_DECLS


56 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


59 
	#h_”ºo
 (*
	`__h_”ºo_loÿtiÚ
 ())

	)

62 *
	$__h_”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

66 
	#HOST_NOT_FOUND
 1

	)

67 
	#TRY_AGAIN
 2

	)

69 
	#NO_RECOVERY
 3

	)

71 
	#NO_DATA
 4

	)

74 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


75 
	#NETDB_INTERNAL
 -1

	)

76 
	#NETDB_SUCCESS
 0

	)

77 
	#NO_ADDRESS
 
NO_DATA


	)

80 #ifdeà
__USE_XOPEN2K


82 
	#IPPORT_RESERVED
 1024

	)

85 #ifdeà
__USE_GNU


87 
	#SCOPE_DELIMITER
 '%'

	)

90 #ifdeà
__USE_MISC


93 
	$h”rÜ
 (
__cÚ¡
 *
__¡r
è
__THROW
;

96 
__cÚ¡
 *
	$h¡»¼Ü
 (
__”r_num
è
__THROW
;

101 
	sho¡’t


103 *
h_Çme
;

104 **
h_®Ÿ£s
;

105 
h_add¹y³
;

106 
h_Ëngth
;

107 **
h_addr_li¡
;

108 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


109 
	#h_addr
 
h_addr_li¡
[0]

	)

118 
	`£tho¡’t
 (
__¡ay_İ’
);

124 
	`’dho¡’t
 ();

131 
ho¡’t
 *
	`g‘ho¡’t
 ();

138 
ho¡’t
 *
	`g‘ho¡byaddr
 (
__cÚ¡
 *
__addr
, 
__sockËn_t
 
__Ën
,

139 
__ty³
);

145 
ho¡’t
 *
	`g‘ho¡byÇme
 (
__cÚ¡
 *
__Çme
);

147 #ifdeà
__USE_MISC


156 
ho¡’t
 *
	`g‘ho¡byÇme2
 (
__cÚ¡
 *
__Çme
, 
__af
);

168 
	`g‘ho¡’t_r
 (
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

169 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

170 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

171 *
__»¡riù
 
__h_”ºİ
);

173 
	`g‘ho¡byaddr_r
 (
__cÚ¡
 *
__»¡riù
 
__addr
, 
__sockËn_t
 
__Ën
,

174 
__ty³
,

175 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

176 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

177 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

178 *
__»¡riù
 
__h_”ºİ
);

180 
	`g‘ho¡byÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

181 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

182 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

183 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

184 *
__»¡riù
 
__h_”ºİ
);

186 
	`g‘ho¡byÇme2_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
, 
__af
,

187 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

188 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

189 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

190 *
__»¡riù
 
__h_”ºİ
);

199 
	`£Š‘’t
 (
__¡ay_İ’
);

205 
	`’dÃ‹Á
 ();

212 
Ã‹Á
 *
	`g‘Ã‹Á
 ();

219 
Ã‹Á
 *
	`g‘Ãtbyaddr
 (
ušt32_t
 
__Ãt
, 
__ty³
);

225 
Ã‹Á
 *
	`g‘ÃtbyÇme
 (
__cÚ¡
 *
__Çme
);

227 #ifdef 
__USE_MISC


238 
	`g‘Ã‹Á_r
 (
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

239 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

240 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

241 *
__»¡riù
 
__h_”ºİ
);

243 
	`g‘Ãtbyaddr_r
 (
ušt32_t
 
__Ãt
, 
__ty³
,

244 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

245 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

246 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

247 *
__»¡riù
 
__h_”ºİ
);

249 
	`g‘ÃtbyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

250 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

251 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

252 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

253 *
__»¡riù
 
__h_”ºİ
);

258 
	s£rv’t


260 *
s_Çme
;

261 **
s_®Ÿ£s
;

262 
s_pÜt
;

263 *
s_´Ùo
;

271 
	`£t£rv’t
 (
__¡ay_İ’
);

277 
	`’d£rv’t
 ();

284 
£rv’t
 *
	`g‘£rv’t
 ();

291 
£rv’t
 *
	`g‘£rvbyÇme
 (
__cÚ¡
 *
__Çme
,

292 
__cÚ¡
 *
__´Ùo
);

299 
£rv’t
 *
	`g‘£rvbypÜt
 (
__pÜt
, 
__cÚ¡
 *
__´Ùo
);

302 #ifdef 
__USE_MISC


310 
	`g‘£rv’t_r
 (
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

311 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

312 
£rv’t
 **
__»¡riù
 
__»suÉ
);

314 
	`g‘£rvbyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

315 
__cÚ¡
 *
__»¡riù
 
__´Ùo
,

316 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

317 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

318 
£rv’t
 **
__»¡riù
 
__»suÉ
);

320 
	`g‘£rvbypÜt_r
 (
__pÜt
, 
__cÚ¡
 *
__»¡riù
 
__´Ùo
,

321 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

322 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

323 
£rv’t
 **
__»¡riù
 
__»suÉ
);

328 
	s´ÙÛÁ


330 *
p_Çme
;

331 **
p_®Ÿ£s
;

332 
p_´Ùo
;

340 
	`£rÙÛÁ
 (
__¡ay_İ’
);

346 
	`’d´ÙÛÁ
 ();

353 
´ÙÛÁ
 *
	`g‘´ÙÛÁ
 ();

359 
´ÙÛÁ
 *
	`g‘´ÙobyÇme
 (
__cÚ¡
 *
__Çme
);

365 
´ÙÛÁ
 *
	`g‘´Ùobynumb”
 (
__´Ùo
);

368 #ifdef 
__USE_MISC


376 
	`g‘´ÙÛÁ_r
 (
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

377 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

378 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

380 
	`g‘´ÙobyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

381 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

382 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

383 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

385 
	`g‘´Ùobynumb”_r
 (
__´Ùo
,

386 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

387 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

388 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

397 
	`£Š‘g»Á
 (
__cÚ¡
 *
__Ãtgroup
);

405 
	`’dÃtg»Á
 ();

414 
	`g‘Ãtg»Á
 (**
__»¡riù
 
__ho¡p
,

415 **
__»¡riù
 
__u£½
,

416 **
__»¡riù
 
__domašp
);

425 
	`šÃtgr
 (
__cÚ¡
 *
__Ãtgroup
, __cÚ¡ *
__ho¡
,

426 
__cÚ¡
 *
__u£r
, __cÚ¡ *
__domaš
);

434 
	`g‘Ãtg»Á_r
 (**
__»¡riù
 
__ho¡p
,

435 **
__»¡riù
 
__u£½
,

436 **
__»¡riù
 
__domašp
,

437 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
);

441 #ifdeà
__USE_BSD


453 
	`rcmd
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

454 
__cÚ¡
 *
__»¡riù
 
__locu£r
,

455 
__cÚ¡
 *
__»¡riù
 
__»mu£r
,

456 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

465 
	`rcmd_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

466 
__cÚ¡
 *
__»¡riù
 
__locu£r
,

467 
__cÚ¡
 *
__»¡riù
 
__»mu£r
,

468 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

469 
§_çmy_t
 
__af
);

481 
	`»xec
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

482 
__cÚ¡
 *
__»¡riù
 
__Çme
,

483 
__cÚ¡
 *
__»¡riù
 
__·ss
,

484 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

493 
	`»xec_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

494 
__cÚ¡
 *
__»¡riù
 
__Çme
,

495 
__cÚ¡
 *
__»¡riù
 
__·ss
,

496 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

497 
§_çmy_t
 
__af
);

507 
	`ru£rok
 (
__cÚ¡
 *
__rho¡
, 
__su£r
,

508 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
);

517 
	`ru£rok_af
 (
__cÚ¡
 *
__rho¡
, 
__su£r
,

518 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
,

519 
§_çmy_t
 
__af
);

530 
	`œu£rok
 (
ušt32_t
 
__¿ddr
, 
__su£r
,

531 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
);

541 
	`œu£rok_af
 (
__cÚ¡
 *
__¿ddr
, 
__su£r
,

542 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
,

543 
§_çmy_t
 
__af
);

553 
	`¼esvpÜt
 (*
__®pÜt
);

562 
	`¼esvpÜt_af
 (*
__®pÜt
, 
§_çmy_t
 
__af
);

567 #ifdef 
__USE_POSIX


569 
	saddršfo


571 
ai_æags
;

572 
ai_çmy
;

573 
ai_sockty³
;

574 
ai_´ÙocŞ
;

575 
sockËn_t
 
ai_add¾’
;

576 
sockaddr
 *
ai_addr
;

577 *
ai_ÿnÚÇme
;

578 
addršfo
 *
ai_Ãxt
;

581 #ifdeà
__USE_GNU


583 
	sgaicb


585 cÚ¡ *
¬_Çme
;

586 cÚ¡ *
¬_£rviû
;

587 cÚ¡ 
addršfo
 *
¬_»que¡
;

588 
addršfo
 *
¬_»suÉ
;

590 
__»tuº
;

591 
__unu£d
[5];

595 
	#GAI_WAIT
 0

	)

596 
	#GAI_NOWAIT
 1

	)

600 
	#AI_PASSIVE
 0x0001

	)

601 
	#AI_CANONNAME
 0x0002

	)

602 
	#AI_NUMERICHOST
 0x0004

	)

603 
	#AI_V4MAPPED
 0x0008

	)

604 
	#AI_ALL
 0x0010

	)

605 
	#AI_ADDRCONFIG
 0x0020

	)

607 #ifdeà
__USE_GNU


608 
	#AI_IDN
 0x0040

	)

611 
	#AI_CANONIDN
 0x0080

	)

612 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

614 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

617 
	#AI_NUMERICSERV
 0x0400

	)

620 
	#EAI_BADFLAGS
 -1

	)

621 
	#EAI_NONAME
 -2

	)

622 
	#EAI_AGAIN
 -3

	)

623 
	#EAI_FAIL
 -4

	)

624 
	#EAI_FAMILY
 -6

	)

625 
	#EAI_SOCKTYPE
 -7

	)

626 
	#EAI_SERVICE
 -8

	)

627 
	#EAI_MEMORY
 -10

	)

628 
	#EAI_SYSTEM
 -11

	)

629 
	#EAI_OVERFLOW
 -12

	)

630 #ifdeà
__USE_GNU


631 
	#EAI_NODATA
 -5

	)

632 
	#EAI_ADDRFAMILY
 -9

	)

633 
	#EAI_INPROGRESS
 -100

	)

634 
	#EAI_CANCELED
 -101

	)

635 
	#EAI_NOTCANCELED
 -102

	)

636 
	#EAI_ALLDONE
 -103

	)

637 
	#EAI_INTR
 -104

	)

638 
	#EAI_IDN_ENCODE
 -105

	)

641 #ifdeà
__USE_MISC


642 
	#NI_MAXHOST
 1025

	)

643 
	#NI_MAXSERV
 32

	)

646 
	#NI_NUMERICHOST
 1

	)

647 
	#NI_NUMERICSERV
 2

	)

648 
	#NI_NOFQDN
 4

	)

649 
	#NI_NAMEREQD
 8

	)

650 
	#NI_DGRAM
 16

	)

651 #ifdeà
__USE_GNU


652 
	#NI_IDN
 32

	)

653 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

655 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

664 
	`g‘addršfo
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

665 
__cÚ¡
 *
__»¡riù
 
__£rviû
,

666 
__cÚ¡
 
addršfo
 *
__»¡riù
 
__»q
,

667 
addršfo
 **
__»¡riù
 
__·i
);

670 
	$ä“addršfo
 (
addršfo
 *
__ai
è
__THROW
;

673 
__cÚ¡
 *
	$gai_¡»¼Ü
 (
__ecode
è
__THROW
;

679 
	`g‘Çmešfo
 (
__cÚ¡
 
sockaddr
 *
__»¡riù
 
__§
,

680 
sockËn_t
 
__§Ën
, *
__»¡riù
 
__ho¡
,

681 
sockËn_t
 
__ho¡Ën
, *
__»¡riù
 
__£rv
,

682 
sockËn_t
 
__£rvËn
, 
__æags
);

685 #ifdeà
__USE_GNU


694 
	`g‘addršfo_a
 (
__mode
, 
gaicb
 *
__li¡
[
__»¡riù_¬r
],

695 
__’t
, 
sigev’t
 *
__»¡riù
 
__sig
);

705 
	`gai_su¥’d
 (
__cÚ¡
 
gaicb
 *__cÚ¡ 
__li¡
[], 
__’t
,

706 
__cÚ¡
 
time¥ec
 *
__timeout
);

709 
	$gai_”rÜ
 (
gaicb
 *
__»q
è
__THROW
;

712 
	$gai_ÿnûl
 (
gaicb
 *
__gaicbp
è
__THROW
;

715 
__END_DECLS


	@/usr/include/netinet/in.h

20 #iâdef 
_NETINET_IN_H


21 
	#_NETINET_IN_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<¡dšt.h
>

25 
	~<sys/sock‘.h
>

26 
	~<b™s/ty³s.h
>

29 
__BEGIN_DECLS


34 
	mIPPROTO_IP
 = 0,

35 
	#IPPROTO_IP
 
IPPROTO_IP


	)

36 
	mIPPROTO_HOPOPTS
 = 0,

37 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

38 
	mIPPROTO_ICMP
 = 1,

39 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

40 
	mIPPROTO_IGMP
 = 2,

41 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

42 
	mIPPROTO_IPIP
 = 4,

43 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

44 
	mIPPROTO_TCP
 = 6,

45 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

46 
	mIPPROTO_EGP
 = 8,

47 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

48 
	mIPPROTO_PUP
 = 12,

49 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

50 
	mIPPROTO_UDP
 = 17,

51 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

52 
	mIPPROTO_IDP
 = 22,

53 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

54 
	mIPPROTO_TP
 = 29,

55 
	#IPPROTO_TP
 
IPPROTO_TP


	)

56 
	mIPPROTO_DCCP
 = 33,

57 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

58 
	mIPPROTO_IPV6
 = 41,

59 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

60 
	mIPPROTO_ROUTING
 = 43,

61 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

62 
	mIPPROTO_FRAGMENT
 = 44,

63 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

64 
	mIPPROTO_RSVP
 = 46,

65 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

66 
	mIPPROTO_GRE
 = 47,

67 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

68 
	mIPPROTO_ESP
 = 50,

69 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

70 
	mIPPROTO_AH
 = 51,

71 
	#IPPROTO_AH
 
IPPROTO_AH


	)

72 
	mIPPROTO_ICMPV6
 = 58,

73 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

74 
	mIPPROTO_NONE
 = 59,

75 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

76 
	mIPPROTO_DSTOPTS
 = 60,

77 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

78 
	mIPPROTO_MTP
 = 92,

79 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

80 
	mIPPROTO_ENCAP
 = 98,

81 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

82 
	mIPPROTO_PIM
 = 103,

83 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

84 
	mIPPROTO_COMP
 = 108,

85 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

86 
	mIPPROTO_SCTP
 = 132,

87 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

88 
	mIPPROTO_UDPLITE
 = 136,

89 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


97 
ušt16_t
 
	tš_pÜt_t
;

102 
	mIPPORT_ECHO
 = 7,

103 
	mIPPORT_DISCARD
 = 9,

104 
	mIPPORT_SYSTAT
 = 11,

105 
	mIPPORT_DAYTIME
 = 13,

106 
	mIPPORT_NETSTAT
 = 15,

107 
	mIPPORT_FTP
 = 21,

108 
	mIPPORT_TELNET
 = 23,

109 
	mIPPORT_SMTP
 = 25,

110 
	mIPPORT_TIMESERVER
 = 37,

111 
	mIPPORT_NAMESERVER
 = 42,

112 
	mIPPORT_WHOIS
 = 43,

113 
	mIPPORT_MTP
 = 57,

115 
	mIPPORT_TFTP
 = 69,

116 
	mIPPORT_RJE
 = 77,

117 
	mIPPORT_FINGER
 = 79,

118 
	mIPPORT_TTYLINK
 = 87,

119 
	mIPPORT_SUPDUP
 = 95,

122 
	mIPPORT_EXECSERVER
 = 512,

123 
	mIPPORT_LOGINSERVER
 = 513,

124 
	mIPPORT_CMDSERVER
 = 514,

125 
	mIPPORT_EFSSERVER
 = 520,

128 
	mIPPORT_BIFFUDP
 = 512,

129 
	mIPPORT_WHOSERVER
 = 513,

130 
	mIPPORT_ROUTESERVER
 = 520,

133 
	mIPPORT_RESERVED
 = 1024,

136 
	mIPPORT_USERRESERVED
 = 5000

141 
ušt32_t
 
	tš_addr_t
;

142 
	sš_addr


144 
š_addr_t
 
	ms_addr
;

153 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

154 
	#IN_CLASSA_NET
 0xff000000

	)

155 
	#IN_CLASSA_NSHIFT
 24

	)

156 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

157 
	#IN_CLASSA_MAX
 128

	)

159 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

160 
	#IN_CLASSB_NET
 0xffff0000

	)

161 
	#IN_CLASSB_NSHIFT
 16

	)

162 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

163 
	#IN_CLASSB_MAX
 65536

	)

165 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

166 
	#IN_CLASSC_NET
 0xffffff00

	)

167 
	#IN_CLASSC_NSHIFT
 8

	)

168 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

170 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

171 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

173 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

174 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

177 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

179 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

181 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

184 
	#IN_LOOPBACKNET
 127

	)

186 #iâdeà
INADDR_LOOPBACK


187 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

191 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

192 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

193 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

194 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

198 
	sš6_addr


202 
ušt8_t
 
	m__u6_addr8
[16];

203 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


204 
ušt16_t
 
	m__u6_addr16
[8];

205 
ušt32_t
 
	m__u6_addr32
[4];

207 } 
	m__š6_u
;

208 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

209 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


210 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

211 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

215 cÚ¡ 
š6_addr
 
š6addr_ªy
;

216 cÚ¡ 
š6_addr
 
š6addr_loİback
;

217 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

218 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

220 
	#INET_ADDRSTRLEN
 16

	)

221 
	#INET6_ADDRSTRLEN
 46

	)

225 
	ssockaddr_š


227 
__SOCKADDR_COMMON
 (
sš_
);

228 
š_pÜt_t
 
	msš_pÜt
;

229 
š_addr
 
	msš_addr
;

232 
	msš_z”o
[ (
sockaddr
) -

233 
__SOCKADDR_COMMON_SIZE
 -

234  (
š_pÜt_t
) -

235  (
š_addr
)];

239 
	ssockaddr_š6


241 
__SOCKADDR_COMMON
 (
sš6_
);

242 
š_pÜt_t
 
	msš6_pÜt
;

243 
ušt32_t
 
	msš6_æowšfo
;

244 
š6_addr
 
	msš6_addr
;

245 
ušt32_t
 
	msš6_scİe_id
;

249 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


251 
	s_m»q


254 
š_addr
 
	mimr_muÉŸddr
;

257 
š_addr
 
	mimr_š‹rçû
;

260 
	s_m»q_sourû


263 
š_addr
 
	mimr_muÉŸddr
;

266 
š_addr
 
	mimr_š‹rçû
;

269 
š_addr
 
	mimr_sourûaddr
;

275 
	sv6_m»q


278 
š6_addr
 
	mv6mr_muÉŸddr
;

281 
	mv6mr_š‹rçû
;

285 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


287 
	sgroup_»q


290 
ušt32_t
 
	mgr_š‹rçû
;

293 
sockaddr_¡Üage
 
	mgr_group
;

296 
	sgroup_sourû_»q


299 
ušt32_t
 
	mg¤_š‹rçû
;

302 
sockaddr_¡Üage
 
	mg¤_group
;

305 
sockaddr_¡Üage
 
	mg¤_sourû
;

310 
	s_msf‹r


313 
š_addr
 
	mimsf_muÉŸddr
;

316 
š_addr
 
	mimsf_š‹rçû
;

319 
ušt32_t
 
	mimsf_fmode
;

322 
ušt32_t
 
	mimsf_num¤c
;

324 
š_addr
 
	mimsf_¦i¡
[1];

327 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

328 -  (
š_addr
) \

329 + (
num¤c
è*  (
š_addr
))

	)

331 
	sgroup_f‹r


334 
ušt32_t
 
	mgf_š‹rçû
;

337 
sockaddr_¡Üage
 
	mgf_group
;

340 
ušt32_t
 
	mgf_fmode
;

343 
ušt32_t
 
	mgf_num¤c
;

345 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

348 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

349 -  (
sockaddr_¡Üage
) \

350 + ((
num¤c
) \

351 *  (
sockaddr_¡Üage
)))

	)

356 
	~<b™s/š.h
>

365 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

366 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

367 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

368 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

369 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

370 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

371 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

373 
	~<’dŸn.h
>

376 
	~<b™s/by‹sw­.h
>

378 #ifdeà
__OPTIMIZE__


382 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


385 
	#Áohl
(
x
è(x)

	)

386 
	#Áohs
(
x
è(x)

	)

387 
	#htÚl
(
x
è(x)

	)

388 
	#htÚs
(
x
è(x)

	)

390 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


391 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

392 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

393 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

394 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

399 #ifdeà
__GNUC__


400 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

401 (
__ex‹nsiÚ__
 \

402 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

403 
__a
->
s6_addr32
[0] == 0 \

404 && 
__a
->
s6_addr32
[1] == 0 \

405 && 
__a
->
s6_addr32
[2] == 0 \

406 && 
__a
->
s6_addr32
[3] =ğ0; 
	}
}))

	)

408 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

409 (
__ex‹nsiÚ__
 \

410 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

411 
__a
->
s6_addr32
[0] == 0 \

412 && 
__a
->
s6_addr32
[1] == 0 \

413 && 
__a
->
s6_addr32
[2] == 0 \

414 && 
__a
->
s6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

416 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

417 (
__ex‹nsiÚ__
 \

418 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

419 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

421 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

422 (
__ex‹nsiÚ__
 \

423 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

424 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

426 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

427 (
__ex‹nsiÚ__
 \

428 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

429 
__a
->
s6_addr32
[0] == 0 \

430 && 
__a
->
s6_addr32
[1] == 0 \

431 && 
__a
->
s6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

433 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

434 (
__ex‹nsiÚ__
 \

435 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

436 
__a
->
s6_addr32
[0] == 0 \

437 && 
__a
->
s6_addr32
[1] == 0 \

438 && 
__a
->
s6_addr32
[2] == 0 \

439 && 
	`Áohl
 (
__a
->
s6_addr32
[3]è> 1; }))

	)

441 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

442 (
__ex‹nsiÚ__
 \

443 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

444 
__cÚ¡
 
š6_addr
 *
__b
 = (__cÚ¡ š6_add¸*è(
b
); \

445 
__a
->
s6_addr32
[0] =ğ
__b
->s6_addr32[0] \

446 && 
__a
->
s6_addr32
[1] =ğ
__b
->s6_addr32[1] \

447 && 
__a
->
s6_addr32
[2] =ğ
__b
->s6_addr32[2] \

448 && 
__a
->
s6_addr32
[3] =ğ
__b
->s6_addr32[3]; }))

	)

450 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

451 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0 \

452 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0 \

453 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0 \

454 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

456 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

457 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0 \

458 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0 \

459 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0 \

460 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

462 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

463 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

464 =ğ
	`htÚl
 (0xã800000))

	)

466 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

467 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

468 =ğ
	`htÚl
 (0xãc00000))

	)

470 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

471 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0) \

472 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0) \

473 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

475 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

476 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0) \

477 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0) \

478 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0) \

479 && (
	`Áohl
 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[3]è> 1))

	)

481 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

482 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[0]) \

483 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[1]) \

484 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[2]) \

485 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

488 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((
__cÚ¡
 
ušt8_t
 *è×))[0] =ğ0xff)

	)

490 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


492 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

495 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

496 
__THROW
;

500 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

501 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

502 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

504 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

505 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

506 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

508 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

509 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

510 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

512 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

513 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

514 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

516 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

517 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

518 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

521 #ifdeà
__USE_GNU


523 
	sš6_pktšfo


525 
š6_addr
 
i6_addr
;

526 
i6_ifšdex
;

530 
	s6_mtušfo


532 
sockaddr_š6
 
6m_addr
;

533 
ušt32_t
 
6m_mtu
;

538 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

539 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

540 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

541 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

542 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

543 
__cÚ¡
 
ušt8_t
 *
__ty³p
, 
__muÉx
,

544 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

545 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

546 
__muÉx
, 
__¶usy
)

547 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

548 
	$š‘6_İtiÚ_Ãxt
 (
__cÚ¡
 
cmsghdr
 *
__cmsg
,

549 
ušt8_t
 **
__Œp
)

550 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

551 
	$š‘6_İtiÚ_fšd
 (
__cÚ¡
 
cmsghdr
 *
__cmsg
,

552 
ušt8_t
 **
__Œp
, 
__ty³
)

553 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

557 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

558 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

559 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

560 **
__d©abuå
è
__THROW
;

561 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

562 
__THROW
;

563 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

564 
sockËn_t
 
__v®Ën
è
__THROW
;

565 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

566 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

567 **
__d©abuå
è
__THROW
;

568 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

569 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

570 **
__d©abuå
è
__THROW
;

571 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

572 
sockËn_t
 
__v®Ën
è
__THROW
;

576 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

577 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

578 
__£gm’ts
è
__THROW
;

579 
	$š‘6_¹h_add
 (*
__bp
, 
__cÚ¡
 
š6_addr
 *
__addr
è
__THROW
;

580 
	$š‘6_¹h_»v”£
 (
__cÚ¡
 *
__š
, *
__out
è
__THROW
;

581 
	$š‘6_¹h_£gm’ts
 (
__cÚ¡
 *
__bp
è
__THROW
;

582 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (
__cÚ¡
 *
__bp
, 
__šdex
)

583 
__THROW
;

589 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

590 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

591 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

592 
__THROW
;

595 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

596 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

597 
ušt32_t
 
__num¤c
,

598 
__cÚ¡
 
š_addr
 *
__¦i¡
)

599 
__THROW
;

603 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

604 
__cÚ¡
 
sockaddr
 *
__group
,

605 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

606 
ušt32_t
 *
__num¤c
,

607 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

610 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

611 
__cÚ¡
 
sockaddr
 *
__group
,

612 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

613 
ušt32_t
 
__num¤c
,

614 
__cÚ¡
 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

617 
__END_DECLS


	@/usr/include/signal.h

23 #iâdef 
_SIGNAL_H


25 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


26 
	#_SIGNAL_H


	)

29 
	~<ã©u»s.h
>

31 
	g__BEGIN_DECLS


33 
	~<b™s/sig£t.h
>

37 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


38 #iâdeà
__sig_©omic_t_defšed


39 
	#__sig_©omic_t_defšed


	)

40 
__BEGIN_NAMESPACE_STD


41 
__sig_©omic_t
 
	tsig_©omic_t
;

42 
	g__END_NAMESPACE_STD


44 #undeà
__Ãed_sig_©omic_t


47 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

48 #iâdeà
__sig£t_t_defšed


49 
	#__sig£t_t_defšed


	)

50 
__sig£t_t
 
	tsig£t_t
;

52 #undeà
__Ãed_sig£t_t


55 #ifdeà
_SIGNAL_H


57 
	~<b™s/ty³s.h
>

58 
	~<b™s/signum.h
>

60 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


61 #iâdeà
__pid_t_defšed


62 
__pid_t
 
	tpid_t
;

63 
	#__pid_t_defšed


	)

65 #ifdeà
__USE_XOPEN


67 #iâdeà
__uid_t_defšed


68 
__uid_t
 
	tuid_t
;

69 
	#__uid_t_defšed


	)

73 #ifdeà
__USE_POSIX199309


75 
	#__Ãed_time¥ec


	)

76 
	~<time.h
>

79 
	~<b™s/sigšfo.h
>

84 (*
	t__sighªdËr_t
) ();

89 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

90 
__THROW
;

91 #ifdeà
__USE_GNU


92 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

93 
__THROW
;

99 
__BEGIN_NAMESPACE_STD


100 #ifdeà
__USE_BSD


101 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

102 
__THROW
;

105 #ifdeà
__REDIRECT_NTH


106 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

107 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

108 
__sysv_sigÇl
);

110 
	#sigÇl
 
__sysv_sigÇl


	)

113 
__END_NAMESPACE_STD


115 #ifdeà
__USE_XOPEN


118 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

119 
__THROW
;

125 #ifdeà
__USE_POSIX


126 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

129 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


133 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

136 
__BEGIN_NAMESPACE_STD


138 
	$¿i£
 (
__sig
è
__THROW
;

139 
__END_NAMESPACE_STD


141 #ifdeà
__USE_SVID


143 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

144 
__THROW
;

145 
	$gsigÇl
 (
__sig
è
__THROW
;

148 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K


150 
	`psigÇl
 (
__sig
, 
__cÚ¡
 *
__s
);

153 #ifdeà
__USE_XOPEN2K


155 
	`psigšfo
 (
__cÚ¡
 
sigšfo_t
 *
__pšfo
, __cÚ¡ *
__s
);

168 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

170 #ifdeà
__FAVOR_BSD


173 
	$sig·u£
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

175 #ifdeà
__USE_XOPEN


176 #ifdeà
__GNUC__


177 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

180 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

186 #ifdeà
__USE_BSD


193 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

196 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

199 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

202 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

206 #ifdeà
__USE_MISC


207 
	#NSIG
 
_NSIG


	)

210 #ifdeà
__USE_GNU


211 
__sighªdËr_t
 
	tsighªdËr_t
;

215 #ifdeà
__USE_BSD


216 
__sighªdËr_t
 
	tsig_t
;

219 #ifdeà
__USE_POSIX


222 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

225 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

228 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

231 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

234 
	$sigismemb”
 (
__cÚ¡
 
sig£t_t
 *
__£t
, 
__signo
)

235 
__THROW
 
	`__nÚnuÎ
 ((1));

237 #ifdeà
__USE_GNU


239 
	$sigi£m±y£t
 (
__cÚ¡
 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

242 
	$sigªd£t
 (
sig£t_t
 *
__£t
, 
__cÚ¡
 sig£t_ˆ*
__Ëá
,

243 
__cÚ¡
 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

246 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, 
__cÚ¡
 sig£t_ˆ*
__Ëá
,

247 
__cÚ¡
 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

252 
	~<b™s/sigaùiÚ.h
>

255 
	$sig´ocmask
 (
__how
, 
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

256 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

263 
	$sigsu¥’d
 (
__cÚ¡
 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

266 
	$sigaùiÚ
 (
__sig
, 
__cÚ¡
 
sigaùiÚ
 *
__»¡riù
 
__aù
,

267 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

270 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

277 
	$sigwa™
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

278 
	`__nÚnuÎ
 ((1, 2));

280 #ifdeà
__USE_POSIX199309


285 
	$sigwa™šfo
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

286 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

293 
	$sigtimedwa™
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

294 
sigšfo_t
 *
__»¡riù
 
__šfo
,

295 
__cÚ¡
 
time¥ec
 *
__»¡riù
 
__timeout
)

296 
	`__nÚnuÎ
 ((1));

300 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, 
__cÚ¡
 
sigv®
 
__v®
)

301 
__THROW
;

306 #ifdeà
__USE_BSD


310 
__cÚ¡
 *__cÚ¡ 
_sys_sigli¡
[
_NSIG
];

311 
__cÚ¡
 *__cÚ¡ 
sys_sigli¡
[
_NSIG
];

314 
	ssigvec


316 
__sighªdËr_t
 
sv_hªdËr
;

317 
sv_mask
;

319 
sv_æags
;

320 
	#sv_Ú¡ack
 
sv_æags


	)

324 
	#SV_ONSTACK
 (1 << 0)

	)

325 
	#SV_INTERRUPT
 (1 << 1)

	)

326 
	#SV_RESETHAND
 (1 << 2)

	)

334 
	$sigvec
 (
__sig
, 
__cÚ¡
 
sigvec
 *
__vec
,

335 
sigvec
 *
__ovec
è
__THROW
;

339 
	~<b™s/sigcÚ‹xt.h
>

342 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

347 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


348 
	#__Ãed_size_t


	)

349 
	~<¡ddef.h
>

354 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

356 
	~<b™s/sig¡ack.h
>

357 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


359 
	~<sys/ucÚ‹xt.h
>

365 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

366 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

370 
	$sig®t¡ack
 (
__cÚ¡
 
sig®t¡ack
 *
__»¡riù
 
__ss
,

371 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

375 #ifdeà
__USE_XOPEN_EXTENDED


379 
	$sighŞd
 (
__sig
è
__THROW
;

382 
	$sig»l£
 (
__sig
è
__THROW
;

385 
	$sigignÜe
 (
__sig
è
__THROW
;

388 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

391 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


394 
	~<b™s/±h»adty³s.h
>

395 
	~<b™s/sigth»ad.h
>

402 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

404 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

408 
__END_DECLS


	@/usr/include/stdint.h

23 #iâdeà
_STDINT_H


24 
	#_STDINT_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wch¬.h
>

28 
	~<b™s/wÜdsize.h
>

35 #iâdeà
__št8_t_defšed


36 
	#__št8_t_defšed


	)

37 sigÃd 
	tšt8_t
;

38 
	tšt16_t
;

39 
	tšt32_t
;

40 #ià
__WORDSIZE
 == 64

41 
	tšt64_t
;

43 
__ex‹nsiÚ__


44 
	tšt64_t
;

49 
	tušt8_t
;

50 
	tušt16_t
;

51 #iâdeà
__ušt32_t_defšed


52 
	tušt32_t
;

53 
	#__ušt32_t_defšed


	)

55 #ià
__WORDSIZE
 == 64

56 
	tušt64_t
;

58 
__ex‹nsiÚ__


59 
	tušt64_t
;

66 sigÃd 
	tšt_Ëa¡8_t
;

67 
	tšt_Ëa¡16_t
;

68 
	tšt_Ëa¡32_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_Ëa¡64_t
;

72 
__ex‹nsiÚ__


73 
	tšt_Ëa¡64_t
;

77 
	tušt_Ëa¡8_t
;

78 
	tušt_Ëa¡16_t
;

79 
	tušt_Ëa¡32_t
;

80 #ià
__WORDSIZE
 == 64

81 
	tušt_Ëa¡64_t
;

83 
__ex‹nsiÚ__


84 
	tušt_Ëa¡64_t
;

91 sigÃd 
	tšt_ç¡8_t
;

92 #ià
__WORDSIZE
 == 64

93 
	tšt_ç¡16_t
;

94 
	tšt_ç¡32_t
;

95 
	tšt_ç¡64_t
;

97 
	tšt_ç¡16_t
;

98 
	tšt_ç¡32_t
;

99 
__ex‹nsiÚ__


100 
	tšt_ç¡64_t
;

104 
	tušt_ç¡8_t
;

105 #ià
__WORDSIZE
 == 64

106 
	tušt_ç¡16_t
;

107 
	tušt_ç¡32_t
;

108 
	tušt_ç¡64_t
;

110 
	tušt_ç¡16_t
;

111 
	tušt_ç¡32_t
;

112 
__ex‹nsiÚ__


113 
	tušt_ç¡64_t
;

118 #ià
__WORDSIZE
 == 64

119 #iâdeà
__šŒ_t_defšed


120 
	tšŒ_t
;

121 
	#__šŒ_t_defšed


	)

123 
	tušŒ_t
;

125 #iâdeà
__šŒ_t_defšed


126 
	tšŒ_t
;

127 
	#__šŒ_t_defšed


	)

129 
	tušŒ_t
;

134 #ià
__WORDSIZE
 == 64

135 
	tštmax_t
;

136 
	tuštmax_t
;

138 
__ex‹nsiÚ__


139 
	tštmax_t
;

140 
__ex‹nsiÚ__


141 
	tuštmax_t
;

147 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_LIMIT_MACROS


149 #ià
__WORDSIZE
 == 64

150 
	#__INT64_C
(
c
èø## 
L


	)

151 
	#__UINT64_C
(
c
èø## 
UL


	)

153 
	#__INT64_C
(
c
èø## 
LL


	)

154 
	#__UINT64_C
(
c
èø## 
ULL


	)

160 
	#INT8_MIN
 (-128)

	)

161 
	#INT16_MIN
 (-32767-1)

	)

162 
	#INT32_MIN
 (-2147483647-1)

	)

163 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

165 
	#INT8_MAX
 (127)

	)

166 
	#INT16_MAX
 (32767)

	)

167 
	#INT32_MAX
 (2147483647)

	)

168 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

171 
	#UINT8_MAX
 (255)

	)

172 
	#UINT16_MAX
 (65535)

	)

173 
	#UINT32_MAX
 (4294967295U)

	)

174 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

178 
	#INT_LEAST8_MIN
 (-128)

	)

179 
	#INT_LEAST16_MIN
 (-32767-1)

	)

180 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

181 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

183 
	#INT_LEAST8_MAX
 (127)

	)

184 
	#INT_LEAST16_MAX
 (32767)

	)

185 
	#INT_LEAST32_MAX
 (2147483647)

	)

186 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

189 
	#UINT_LEAST8_MAX
 (255)

	)

190 
	#UINT_LEAST16_MAX
 (65535)

	)

191 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

192 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

196 
	#INT_FAST8_MIN
 (-128)

	)

197 #ià
__WORDSIZE
 == 64

198 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

199 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

201 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

202 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

204 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

206 
	#INT_FAST8_MAX
 (127)

	)

207 #ià
__WORDSIZE
 == 64

208 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

209 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

211 
	#INT_FAST16_MAX
 (2147483647)

	)

212 
	#INT_FAST32_MAX
 (2147483647)

	)

214 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

217 
	#UINT_FAST8_MAX
 (255)

	)

218 #ià
__WORDSIZE
 == 64

219 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

220 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

222 
	#UINT_FAST16_MAX
 (4294967295U)

	)

223 
	#UINT_FAST32_MAX
 (4294967295U)

	)

225 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

229 #ià
__WORDSIZE
 == 64

230 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

231 
	#INTPTR_MAX
 (9223372036854775807L)

	)

232 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

234 
	#INTPTR_MIN
 (-2147483647-1)

	)

235 
	#INTPTR_MAX
 (2147483647)

	)

236 
	#UINTPTR_MAX
 (4294967295U)

	)

241 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

243 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

246 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

252 #ià
__WORDSIZE
 == 64

253 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

254 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

256 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

257 
	#PTRDIFF_MAX
 (2147483647)

	)

261 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

262 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

265 #ià
__WORDSIZE
 == 64

266 
	#SIZE_MAX
 (18446744073709551615UL)

	)

268 
	#SIZE_MAX
 (4294967295U)

	)

272 #iâdeà
WCHAR_MIN


274 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

275 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

279 
	#WINT_MIN
 (0u)

	)

280 
	#WINT_MAX
 (4294967295u)

	)

287 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_CONSTANT_MACROS


290 
	#INT8_C
(
c
è
	)
c

291 
	#INT16_C
(
c
è
	)
c

292 
	#INT32_C
(
c
è
	)
c

293 #ià
__WORDSIZE
 == 64

294 
	#INT64_C
(
c
èø## 
L


	)

296 
	#INT64_C
(
c
èø## 
LL


	)

300 
	#UINT8_C
(
c
è
	)
c

301 
	#UINT16_C
(
c
è
	)
c

302 
	#UINT32_C
(
c
èø## 
U


	)

303 #ià
__WORDSIZE
 == 64

304 
	#UINT64_C
(
c
èø## 
UL


	)

306 
	#UINT64_C
(
c
èø## 
ULL


	)

310 #ià
__WORDSIZE
 == 64

311 
	#INTMAX_C
(
c
èø## 
L


	)

312 
	#UINTMAX_C
(
c
èø## 
UL


	)

314 
	#INTMAX_C
(
c
èø## 
LL


	)

315 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/stdio.h

24 #iâdeà
_STDIO_H


26 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

36 
	~<b™s/ty³s.h
>

37 
	#__Ãed_FILE


	)

38 
	#__Ãed___FILE


	)

42 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

52 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

53 || 
defšed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_defšed
 1

	)

59 #undeà
__Ãed_FILE


62 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_defšed
 1

	)

69 #undeà
__Ãed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


78 #ifdeà
__GNUC__


79 #iâdeà
_VA_LIST_DEFINED


80 
_G_va_li¡
 
	tva_li¡
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<¡d¬g.h
>

88 #ifdeà
__USE_XOPEN2K8


89 #iâdeà
__off_t_defšed


90 #iâdeà
__USE_FILE_OFFSET64


91 
__off_t
 
	toff_t
;

93 
__off64_t
 
	toff_t
;

95 
	#__off_t_defšed


	)

97 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


98 
__off64_t
 
	toff64_t
;

99 
	#__off64_t_defšed


	)

102 #iâdeà
__ssize_t_defšed


103 
__ssize_t
 
	tssize_t
;

104 
	#__ssize_t_defšed


	)

109 
__BEGIN_NAMESPACE_STD


110 #iâdeà
__USE_FILE_OFFSET64


111 
_G_åos_t
 
	tåos_t
;

113 
_G_åos64_t
 
	tåos_t
;

115 
__END_NAMESPACE_STD


116 #ifdeà
__USE_LARGEFILE64


117 
_G_åos64_t
 
	tåos64_t
;

121 
	#_IOFBF
 0

	)

122 
	#_IOLBF
 1

	)

123 
	#_IONBF
 2

	)

127 #iâdeà
BUFSIZ


128 
	#BUFSIZ
 
_IO_BUFSIZ


	)

134 #iâdeà
EOF


135 
	#EOF
 (-1)

	)

141 
	#SEEK_SET
 0

	)

142 
	#SEEK_CUR
 1

	)

143 
	#SEEK_END
 2

	)

144 #ifdeà
__USE_GNU


145 
	#SEEK_DATA
 3

	)

146 
	#SEEK_HOLE
 4

	)

150 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


152 
	#P_tmpdœ
 "/tmp"

	)

165 
	~<b™s/¡dio_lim.h
>

169 
_IO_FILE
 *
¡dš
;

170 
_IO_FILE
 *
¡dout
;

171 
_IO_FILE
 *
¡d”r
;

173 
	#¡dš
 
¡dš


	)

174 
	#¡dout
 
¡dout


	)

175 
	#¡d”r
 
¡d”r


	)

177 
__BEGIN_NAMESPACE_STD


179 
	$»move
 (
__cÚ¡
 *
__f’ame
è
__THROW
;

181 
	$»Çme
 (
__cÚ¡
 *
__Şd
, __cÚ¡ *
__Ãw
è
__THROW
;

182 
__END_NAMESPACE_STD


184 #ifdeà
__USE_ATFILE


186 
	$»Çm—t
 (
__Şdfd
, 
__cÚ¡
 *
__Şd
, 
__Ãwfd
,

187 
__cÚ¡
 *
__Ãw
è
__THROW
;

190 
__BEGIN_NAMESPACE_STD


195 #iâdeà
__USE_FILE_OFFSET64


196 
FILE
 *
	$tmpfe
 (è
__wur
;

198 #ifdeà
__REDIRECT


199 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

201 
	#tmpfe
 
tmpfe64


	)

205 #ifdeà
__USE_LARGEFILE64


206 
FILE
 *
	$tmpfe64
 (è
__wur
;

210 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

211 
__END_NAMESPACE_STD


213 #ifdeà
__USE_MISC


216 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

220 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


228 *
	$‹m²am
 (
__cÚ¡
 *
__dœ
, __cÚ¡ *
__pfx
)

229 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

233 
__BEGIN_NAMESPACE_STD


238 
	`fşo£
 (
FILE
 *
__¡»am
);

243 
	`fæush
 (
FILE
 *
__¡»am
);

244 
__END_NAMESPACE_STD


246 #ifdeà
__USE_MISC


253 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

256 #ifdeà
__USE_GNU


263 
	`fşo£®l
 ();

267 
__BEGIN_NAMESPACE_STD


268 #iâdeà
__USE_FILE_OFFSET64


273 
FILE
 *
	$fİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

274 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

279 
FILE
 *
	$äeİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

280 
__cÚ¡
 *
__»¡riù
 
__modes
,

281 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

283 #ifdeà
__REDIRECT


284 
FILE
 *
	`__REDIRECT
 (
fİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

285 
__cÚ¡
 *
__»¡riù
 
__modes
), 
fİ’64
)

286 
__wur
;

287 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

288 
__cÚ¡
 *
__»¡riù
 
__modes
,

289 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

290 
__wur
;

292 
	#fİ’
 
fİ’64


	)

293 
	#äeİ’
 
äeİ’64


	)

296 
__END_NAMESPACE_STD


297 #ifdeà
__USE_LARGEFILE64


298 
FILE
 *
	$fİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

299 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

300 
FILE
 *
	$äeİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

301 
__cÚ¡
 *
__»¡riù
 
__modes
,

302 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

305 #ifdef 
__USE_POSIX


307 
FILE
 *
	$fdİ’
 (
__fd
, 
__cÚ¡
 *
__modes
è
__THROW
 
__wur
;

310 #ifdef 
__USE_GNU


313 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

314 
__cÚ¡
 *
__»¡riù
 
__modes
,

315 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

318 #ifdeà
__USE_XOPEN2K8


320 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, 
__cÚ¡
 *
__modes
)

321 
__THROW
 
__wur
;

326 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

330 
__BEGIN_NAMESPACE_STD


333 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

337 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

338 
__modes
, 
size_t
 
__n
è
__THROW
;

339 
__END_NAMESPACE_STD


341 #ifdef 
__USE_BSD


344 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

345 
size_t
 
__size
è
__THROW
;

348 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

352 
__BEGIN_NAMESPACE_STD


357 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

358 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

363 
	`´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

365 
	$¥rštf
 (*
__»¡riù
 
__s
,

366 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

372 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

373 
_G_va_li¡
 
__¬g
);

378 
	`v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

380 
	$v¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

381 
_G_va_li¡
 
__¬g
è
__THROWNL
;

382 
__END_NAMESPACE_STD


384 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


385 
__BEGIN_NAMESPACE_C99


387 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

388 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

389 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

391 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

392 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

393 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

394 
__END_NAMESPACE_C99


397 #ifdeà
__USE_GNU


400 
	$va¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__f
,

401 
_G_va_li¡
 
__¬g
)

402 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

403 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

404 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

405 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

406 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

407 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

408 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

411 #ifdeà
__USE_XOPEN2K8


418 
	$vd´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
,

419 
_G_va_li¡
 
__¬g
)

420 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

421 
	$d´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

422 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

426 
__BEGIN_NAMESPACE_STD


431 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

432 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

437 
	$sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

439 
	$ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

440 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

442 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

443 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

444 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

445 #ifdeà
__REDIRECT


449 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

450 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

451 
__isoc99_fsÿnf
è
__wur
;

452 
	`__REDIRECT
 (
sÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

453 
__isoc99_sÿnf
è
__wur
;

454 
	`__REDIRECT_NTH
 (
ssÿnf
, (
__cÚ¡
 *
__»¡riù
 
__s
,

455 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

456 
__isoc99_ssÿnf
);

458 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

459 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

460 
	$__isoc99_sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

461 
	$__isoc99_ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

462 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

463 
	#fsÿnf
 
__isoc99_fsÿnf


	)

464 
	#sÿnf
 
__isoc99_sÿnf


	)

465 
	#ssÿnf
 
__isoc99_ssÿnf


	)

469 
__END_NAMESPACE_STD


471 #ifdef 
__USE_ISOC99


472 
__BEGIN_NAMESPACE_C99


477 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

478 
_G_va_li¡
 
__¬g
)

479 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

485 
	$vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

486 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

489 
	$vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

490 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

491 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

493 #ià!
defšed
 
__USE_GNU
 \

494 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

495 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

496 #ifdeà
__REDIRECT


500 
	`__REDIRECT
 (
vfsÿnf
,

501 (
FILE
 *
__»¡riù
 
__s
,

502 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

503 
__isoc99_vfsÿnf
)

504 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

505 
	`__REDIRECT
 (
vsÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

506 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

507 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

508 
	`__REDIRECT_NTH
 (
vssÿnf
,

509 (
__cÚ¡
 *
__»¡riù
 
__s
,

510 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

511 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

512 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

514 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

515 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

516 
_G_va_li¡
 
__¬g
è
__wur
;

517 
	$__isoc99_vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

518 
_G_va_li¡
 
__¬g
è
__wur
;

519 
	$__isoc99_vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

520 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

521 
_G_va_li¡
 
__¬g
è
__THROW
;

522 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

523 
	#vsÿnf
 
__isoc99_vsÿnf


	)

524 
	#vssÿnf
 
__isoc99_vssÿnf


	)

528 
__END_NAMESPACE_C99


532 
__BEGIN_NAMESPACE_STD


537 
	`fg‘c
 (
FILE
 *
__¡»am
);

538 
	`g‘c
 (
FILE
 *
__¡»am
);

544 
	`g‘ch¬
 ();

545 
__END_NAMESPACE_STD


549 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

551 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


556 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

557 
	`g‘ch¬_uÆocked
 ();

560 #ifdeà
__USE_MISC


567 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

571 
__BEGIN_NAMESPACE_STD


579 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

580 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

586 
	`putch¬
 (
__c
);

587 
__END_NAMESPACE_STD


591 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

593 #ifdeà
__USE_MISC


600 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

603 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


608 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

609 
	`putch¬_uÆocked
 (
__c
);

613 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

614 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

616 
	`g‘w
 (
FILE
 *
__¡»am
);

619 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

623 
__BEGIN_NAMESPACE_STD


628 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

629 
__wur
;

636 *
	$g‘s
 (*
__s
è
__wur
;

637 
__END_NAMESPACE_STD


639 #ifdeà
__USE_GNU


646 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

647 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

651 #ifdef 
__USE_XOPEN2K8


662 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

663 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

664 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

665 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

666 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

667 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

675 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

676 
size_t
 *
__»¡riù
 
__n
,

677 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

681 
__BEGIN_NAMESPACE_STD


686 
	`åuts
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

692 
	`puts
 (
__cÚ¡
 *
__s
);

699 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

706 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

707 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

712 
size_t
 
	`fwr™e
 (
__cÚ¡
 *
__»¡riù
 
__±r
, size_ˆ
__size
,

713 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

714 
__END_NAMESPACE_STD


716 #ifdeà
__USE_GNU


723 
	`åuts_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__s
,

724 
FILE
 *
__»¡riù
 
__¡»am
);

727 #ifdeà
__USE_MISC


734 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

735 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

736 
size_t
 
	`fwr™e_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__±r
, size_ˆ
__size
,

737 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

741 
__BEGIN_NAMESPACE_STD


746 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

751 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

756 
	`»wšd
 (
FILE
 *
__¡»am
);

757 
__END_NAMESPACE_STD


764 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


765 #iâdeà
__USE_FILE_OFFSET64


770 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

775 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

777 #ifdeà
__REDIRECT


778 
	`__REDIRECT
 (
f£eko
,

779 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

780 
f£eko64
);

781 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

783 
	#f£eko
 
f£eko64


	)

784 
	#á–lo
 
á–lo64


	)

789 
__BEGIN_NAMESPACE_STD


790 #iâdeà
__USE_FILE_OFFSET64


795 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

800 
	`f£os
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
);

802 #ifdeà
__REDIRECT


803 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

804 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

805 
	`__REDIRECT
 (
f£os
,

806 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
), 
f£os64
);

808 
	#fg‘pos
 
fg‘pos64


	)

809 
	#f£os
 
f£os64


	)

812 
__END_NAMESPACE_STD


814 #ifdeà
__USE_LARGEFILE64


815 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

816 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

817 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

818 
	`f£os64
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos64_t
 *
__pos
);

821 
__BEGIN_NAMESPACE_STD


823 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

825 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

827 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

828 
__END_NAMESPACE_STD


830 #ifdeà
__USE_MISC


832 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

833 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

834 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

838 
__BEGIN_NAMESPACE_STD


843 
	`³¼Ü
 (
__cÚ¡
 *
__s
);

844 
__END_NAMESPACE_STD


850 
	~<b™s/sys_”¾i¡.h
>

853 #ifdef 
__USE_POSIX


855 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

858 #ifdeà
__USE_MISC


860 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

864 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

865 
defšed
 
__USE_MISC
)

870 
FILE
 *
	$pİ’
 (
__cÚ¡
 *
__commªd
, __cÚ¡ *
__modes
è
__wur
;

876 
	`pşo£
 (
FILE
 *
__¡»am
);

880 #ifdef 
__USE_POSIX


882 *
	$ù”mid
 (*
__s
è
__THROW
;

886 #ifdeà
__USE_XOPEN


888 *
	`cu£rid
 (*
__s
);

892 #ifdef 
__USE_GNU


893 
ob¡ack
;

896 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

897 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

898 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

899 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

900 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

901 
_G_va_li¡
 
__¬gs
)

902 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

906 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


910 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

914 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

917 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

920 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


924 
	#__Ãed_g‘İt


	)

925 
	~<g‘İt.h
>

930 #ifdeà
__USE_EXTERN_INLINES


931 
	~<b™s/¡dio.h
>

933 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


934 
	~<b™s/¡dio2.h
>

936 #ifdeà
__LDBL_COMPAT


937 
	~<b™s/¡dio-ldbl.h
>

940 
__END_DECLS


	@/usr/include/stdlib.h

23 #iâdef 
_STDLIB_H


25 
	~<ã©u»s.h
>

28 
	#__Ãed_size_t


	)

29 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


30 
	#__Ãed_wch¬_t


	)

31 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	g__BEGIN_DECLS


37 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


38 
	#_STDLIB_H
 1

	)

40 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


42 
	~<b™s/wa™æags.h
>

43 
	~<b™s/wa™¡©us.h
>

45 #ifdeà
__USE_BSD


50 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


51 
	#__WAIT_INT
(
¡©us
) \

52 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

53 { .
__š
 = (
¡©us
è}).
__i
))

	)

55 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

63 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
wa™
 *
	m__u±r
;

71 *
	m__Œ
;

72 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

90 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

91 #ifdeà
__WIFCONTINUED


92 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquÙ
;

101 
	m»m
;

102 } 
	tdiv_t
;

105 #iâdeà
__ldiv_t_defšed


108 
	mquÙ
;

109 
	m»m
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_defšed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


116 
__BEGIN_NAMESPACE_C99


118 
__ex‹nsiÚ__
 struct

120 
	mquÙ
;

121 
	m»m
;

122 } 
	tÎdiv_t
;

123 
	#__Îdiv_t_defšed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

140 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__cÚ¡
 *
__ÅŒ
)

146 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

148 
	$©oi
 (
__cÚ¡
 *
__ÅŒ
)

149 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

151 
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

153 
__END_NAMESPACE_STD


155 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__ex‹nsiÚ__
 
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
)

159 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$¡¹od
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

166 **
__»¡riù
 
__’d±r
)

167 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$¡¹of
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

174 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

176 
	$¡¹Şd
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

177 **
__»¡riù
 
__’d±r
)

178 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$¡¹Ş
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

185 **
__»¡riù
 
__’d±r
, 
__ba£
)

186 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

188 
	$¡¹oul
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

189 **
__»¡riù
 
__’d±r
, 
__ba£
)

190 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

191 
__END_NAMESPACE_STD


193 #ià
defšed
 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_BSD


195 
__ex‹nsiÚ__


196 
	$¡¹oq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

197 **
__»¡riù
 
__’d±r
, 
__ba£
)

198 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

200 
__ex‹nsiÚ__


201 
	$¡¹ouq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

202 **
__»¡riù
 
__’d±r
, 
__ba£
)

203 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

206 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__ex‹nsiÚ__


210 
	$¡¹Şl
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

211 **
__»¡riù
 
__’d±r
, 
__ba£
)

212 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

214 
__ex‹nsiÚ__


215 
	$¡¹ouÎ
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

216 **
__»¡riù
 
__’d±r
, 
__ba£
)

217 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

218 
__END_NAMESPACE_C99


222 #ifdeà
__USE_GNU


236 
	~<xloÿË.h
>

240 
	$¡¹Ş_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

241 **
__»¡riù
 
__’d±r
, 
__ba£
,

242 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

244 
	$¡¹oul_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

245 **
__»¡riù
 
__’d±r
,

246 
__ba£
, 
__loÿË_t
 
__loc
)

247 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

249 
__ex‹nsiÚ__


250 
	$¡¹Şl_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

251 **
__»¡riù
 
__’d±r
, 
__ba£
,

252 
__loÿË_t
 
__loc
)

253 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

255 
__ex‹nsiÚ__


256 
	$¡¹ouÎ_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

257 **
__»¡riù
 
__’d±r
,

258 
__ba£
, 
__loÿË_t
 
__loc
)

259 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

261 
	$¡¹od_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

262 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

263 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

265 
	$¡¹of_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

266 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

267 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

269 
	$¡¹Şd_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

270 **
__»¡riù
 
__’d±r
,

271 
__loÿË_t
 
__loc
)

272 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

276 #ifdeà
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__ex‹º_šlše
 

279 
	`__NTH
 (
	$©of
 (
__cÚ¡
 *
__ÅŒ
))

281  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

282 
	}
}

283 
__ex‹º_šlše
 

284 
__NTH
 (
	$©oi
 (
__cÚ¡
 *
__ÅŒ
))

286  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

287 
	}
}

288 
__ex‹º_šlše
 

289 
__NTH
 (
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
))

291  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

298 
__NTH
 (
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
))

300  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

314 
	$a64l
 (
__cÚ¡
 *
__s
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


320 
	~<sys/ty³s.h
>

327 
	$¿ndom
 (è
__THROW
;

330 
	$¤ªdom
 (
__£ed
è
__THROW
;

336 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

337 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

341 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

344 #ifdeà
__USE_MISC


349 
	s¿ndom_d©a


351 
št32_t
 *
åŒ
;

352 
št32_t
 *
½Œ
;

353 
št32_t
 *
¡©e
;

354 
¿nd_ty³
;

355 
¿nd_deg
;

356 
¿nd_£p
;

357 
št32_t
 *
’d_±r
;

360 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

361 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

363 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

364 
__THROW
 
	`__nÚnuÎ
 ((2));

366 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

367 
size_t
 
__¡©–’
,

368 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

369 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

371 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

372 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

373 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$¿nd
 (è
__THROW
;

382 
	$¤ªd
 (
__£ed
è
__THROW
;

383 
__END_NAMESPACE_STD


385 #ifdeà
__USE_POSIX


387 
	$¿nd_r
 (*
__£ed
è
__THROW
;

391 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


395 
	$d¿nd48
 (è
__THROW
;

396 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

399 
	$Ìªd48
 (è
__THROW
;

400 
	$Äªd48
 (
__xsubi
[3])

401 
__THROW
 
	`__nÚnuÎ
 ((1));

404 
	$m¿nd48
 (è
__THROW
;

405 
	$j¿nd48
 (
__xsubi
[3])

406 
__THROW
 
	`__nÚnuÎ
 ((1));

409 
	$¤ªd48
 (
__£edv®
è
__THROW
;

410 *
	$£ed48
 (
__£ed16v
[3])

411 
__THROW
 
	`__nÚnuÎ
 ((1));

412 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

414 #ifdeà
__USE_MISC


418 
	sd¿nd48_d©a


420 
__x
[3];

421 
__Şd_x
[3];

422 
__c
;

423 
__š™
;

424 
__a
;

428 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

429 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$”ªd48_r
 (
__xsubi
[3],

431 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

432 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

435 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

436 *
__»¡riù
 
__»suÉ
)

437 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

438 
	$Äªd48_r
 (
__xsubi
[3],

439 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

445 *
__»¡riù
 
__»suÉ
)

446 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

447 
	$j¿nd48_r
 (
__xsubi
[3],

448 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

449 *
__»¡riù
 
__»suÉ
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

454 
__THROW
 
	`__nÚnuÎ
 ((2));

456 
	$£ed48_r
 (
__£ed16v
[3],

457 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$lcÚg48_r
 (
__·¿m
[7],

460 
d¿nd48_d©a
 *
__bufãr
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

467 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


468 
	#__m®loc_ªd_ÿÎoc_defšed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

473 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

474 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


479 
__BEGIN_NAMESPACE_STD


485 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

486 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

488 
	$ä“
 (*
__±r
è
__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$cä“
 (*
__±r
è
__THROW
;

496 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


497 
	~<®loÿ.h
>

500 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

501 || 
defšed
 
__USE_BSD


503 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

506 #ifdeà
__USE_XOPEN2K


508 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

509 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

512 
__BEGIN_NAMESPACE_STD


514 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

518 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

520 #ifdeà
__USE_GNU


524 #ifdeà
__ılu¥lus


525 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

526 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

528 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

531 
__END_NAMESPACE_STD


533 #ifdef 
__USE_MISC


536 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

537 
__THROW
 
	`__nÚnuÎ
 ((1));

540 
__BEGIN_NAMESPACE_STD


544 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

546 #ifdeà
__USE_GNU


552 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

554 
__END_NAMESPACE_STD


556 #ifdeà
__USE_ISOC99


557 
__BEGIN_NAMESPACE_C99


560 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

561 
__END_NAMESPACE_C99


565 
__BEGIN_NAMESPACE_STD


567 *
	$g‘’v
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

568 
__END_NAMESPACE_STD


572 *
	$__£cu»_g‘’v
 (
__cÚ¡
 *
__Çme
)

573 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

575 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


579 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

582 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


585 
	$£‹nv
 (
__cÚ¡
 *
__Çme
, __cÚ¡ *
__v®ue
, 
__»¶aû
)

586 
__THROW
 
	`__nÚnuÎ
 ((2));

589 
	$un£‹nv
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

592 #ifdef 
__USE_MISC


596 
	$ş—»nv
 (è
__THROW
;

600 #ià
defšed
 
__USE_MISC
 \

601 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (
__cÚ¡
 *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fe_Çme
 (
__cÚ¡
 *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
è(
	t__cÚ¡
 *, __const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
è(
	t__cÚ¡
 *, __const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

761 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

762 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

763 #ifdeà
__USE_GNU


764 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

765 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

766 
	`__nÚnuÎ
 ((1, 4));

771 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

772 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

773 
__END_NAMESPACE_STD


775 #ifdeà
__USE_ISOC99


776 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

777 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

781 
__BEGIN_NAMESPACE_STD


785 
div_t
 
	$div
 (
__num”
, 
__d’om
)

786 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

787 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

788 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

789 
__END_NAMESPACE_STD


791 #ifdeà
__USE_ISOC99


792 
__BEGIN_NAMESPACE_C99


793 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

794 
__d’om
)

795 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

796 
__END_NAMESPACE_C99


800 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

801 || 
defšed
 
__USE_SVID


808 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

809 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

814 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

815 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

820 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

821 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

824 #ifdeà
__USE_MISC


826 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

827 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

828 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

829 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

830 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

831 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

832 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

833 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

838 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

839 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

840 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

841 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

842 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

843 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

846 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

847 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

848 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

857 
__BEGIN_NAMESPACE_STD


860 
	$mbËn
 (
__cÚ¡
 *
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

863 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

864 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

867 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
 
__wur
;

871 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

872 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

874 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

875 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

876 
__THROW
;

877 
__END_NAMESPACE_STD


880 #ifdeà
__USE_SVID


885 
	$½m©ch
 (
__cÚ¡
 *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

889 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


896 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

897 *
__cÚ¡
 *
__»¡riù
 
__tok’s
,

898 **
__»¡riù
 
__v®u•
)

899 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

903 #ifdeà
__USE_XOPEN


905 
	$£tkey
 (
__cÚ¡
 *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

911 #ifdeà
__USE_XOPEN2KXSI


913 
	$posix_İ’±
 (
__oæag
è
__wur
;

916 #ifdeà
__USE_XOPEN


921 
	$g¿Á±
 (
__fd
è
__THROW
;

925 
	$uÆock±
 (
__fd
è
__THROW
;

930 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

933 #ifdeà
__USE_GNU


937 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

938 
__THROW
 
	`__nÚnuÎ
 ((2));

941 
	`g‘±
 ();

944 #ifdeà
__USE_BSD


948 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

949 
__THROW
 
	`__nÚnuÎ
 ((1));

954 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


955 
	~<b™s/¡dlib.h
>

957 #ifdeà
__LDBL_COMPAT


958 
	~<b™s/¡dlib-ldbl.h
>

962 #undeà
__Ãed_m®loc_ªd_ÿÎoc


964 
__END_DECLS


	@/usr/include/string.h

24 #iâdef 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$memıy
 (*
__»¡riù
 
__de¡
,

45 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

46 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

49 *
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
)

50 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


57 *
	$memcıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

68 
	$memcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

72 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 
__cÚ¡
 *
	`memchr
 (__cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

80 #ifdeà
__OPTIMIZE__


81 
__ex‹º_®ways_šlše
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


84  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

87 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

88 
	`memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


90  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

98 
__END_NAMESPACE_STD


100 #ifdeà
__USE_GNU


103 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 "C++" 
__cÚ¡
 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

109 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

110 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 "C++" 
__cÚ¡
 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

120 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

129 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

131 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

132 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

133 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

137 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

139 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

140 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
	$¡ºcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
	$¡rcŞl
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

153 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

154 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

155 
__THROW
 
	`__nÚnuÎ
 ((2));

156 
__END_NAMESPACE_STD


158 #ifdeà
__USE_XOPEN2K8


162 
	~<xloÿË.h
>

165 
	$¡rcŞl_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

166 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

168 
size_t
 
	$¡rxäm_l
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

169 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

172 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

173 || 
defšed
 
__USE_XOPEN2K8


175 *
	$¡rdup
 (
__cÚ¡
 *
__s
)

176 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

182 #ià
defšed
 
__USE_XOPEN2K8


183 *
	$¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

184 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

187 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


189 
	#¡rdu·
(
s
) \

190 (
__ex‹nsiÚ__
 \

192 
__cÚ¡
 *
__Şd
 = (
s
); \

193 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

194 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

195 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

196 
	}
}))

	)

199 
	#¡ºdu·
(
s
, 
n
) \

200 (
__ex‹nsiÚ__
 \

202 
__cÚ¡
 *
__Şd
 = (
s
); \

203 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

204 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

205 
__Ãw
[
__Ën
] = '\0'; \

206 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
¡rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

217 
__cÚ¡
 *
¡rchr
 (__cÚ¡ *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

220 #ifdeà
__OPTIMIZE__


221 
__ex‹º_®ways_šlše
 *

222 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


224  
__butš_¡rchr
 (
__s
, 
__c
);

227 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

228 
¡rchr
 (
__cÚ¡
 *
__s
, 
__c
è
	g__THROW


230  
__butš_¡rchr
 (
__s
, 
__c
);

235 *
	$¡rchr
 (
__cÚ¡
 *
__s
, 
__c
)

236 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

239 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`¡¼chr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

244 
__cÚ¡
 *
	`¡¼chr
 (__cÚ¡ *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__OPTIMIZE__


248 
__ex‹º_®ways_šlše
 *

249 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


251  
	`__butš_¡¼chr
 (
__s
, 
__c
);

254 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

255 
	`¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


257  
	`__butš_¡¼chr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
)

263 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_GNU


270 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

273 "C++" 
__cÚ¡
 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

276 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$¡rc¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__»jeù
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

288 
size_t
 
	$¡r¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

289 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

291 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
)

295 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

296 
__cÚ¡
 *
	`¡½brk
 (__cÚ¡ *
__s
, __cÚ¡ *
__acû±
)

297 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

299 #ifdeà
__OPTIMIZE__


300 
__ex‹º_®ways_šlše
 *

301 
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
è
__THROW


303  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

306 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

307 
	`¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
è
__THROW


309  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

312 
	}
}

314 *
	$¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

318 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

322 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

323 
__cÚ¡
 *
	`¡r¡r
 (__cÚ¡ *
__hay¡ack
,

324 
__cÚ¡
 *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

335 
	`¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 
__cÚ¡
 *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" 
__cÚ¡
 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
,

370 
__cÚ¡
 *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (
__cÚ¡
 *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 
__cÚ¡
 *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (
__cÚ¡
 *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2));

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 
__cÚ¡
 *
	`šdex
 (__cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

482 
	`šdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (
__cÚ¡
 *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 
__cÚ¡
 *
	`ršdex
 (__cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

510 
	`ršdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (
__cÚ¡
 *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 #ifdeà
__GNUC__


530 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

531 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

536 
	$¡rÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

537 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

540 
	$¡ºÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$¡rÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

548 
__loÿË_t
 
__loc
)

549 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

551 
	$¡ºÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

552 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

553 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

560 
__cÚ¡
 *
__»¡riù
 
__d–im
)

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

569 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

577 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

578 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

580 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

581 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$¡rv”scmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

587 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

590 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

595 #iâdeà
ba£Çme


600 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$ba£Çme
 (*
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

603 "C++" 
__cÚ¡
 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
)

604 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

606 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

612 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

613 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

614 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


634 
	~<b™s/¡ršg.h
>

637 
	~<b™s/¡ršg2.h
>

640 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


642 
	~<b™s/¡ršg3.h
>

646 
__END_DECLS


	@/usr/include/termios.h

23 #iâdef 
_TERMIOS_H


24 
	#_TERMIOS_H
 1

	)

26 
	~<ã©u»s.h
>

27 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


29 
	~<b™s/ty³s.h
>

30 #iâdeà
__pid_t_defšed


31 
__pid_t
 
	tpid_t
;

32 
	#__pid_t_defšed


	)

36 
	g__BEGIN_DECLS


40 
	~<b™s/‹rmios.h
>

42 #ifdeà
__USE_BSD


45 
	#CCEQ
(
v®
, 
c
è((cè=ğ(v®è&& (v®è!ğ
_POSIX_VDISABLE
)

	)

49 
¥“d_t
 
	$cfg‘o¥“d
 (
__cÚ¡
 
‹rmios
 *
__‹rmios_p
è
__THROW
;

52 
¥“d_t
 
	$cfg‘i¥“d
 (
__cÚ¡
 
‹rmios
 *
__‹rmios_p
è
__THROW
;

55 
	$cf£to¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

58 
	$cf£ti¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

60 #ifdef 
__USE_BSD


62 
	$cf£t¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

67 
	$tcg‘©Œ
 (
__fd
, 
‹rmios
 *
__‹rmios_p
è
__THROW
;

71 
	$tc£‰r
 (
__fd
, 
__İtiÚ®_aùiÚs
,

72 
__cÚ¡
 
‹rmios
 *
__‹rmios_p
è
__THROW
;

75 #ifdef 
__USE_BSD


77 
	$cfmak”aw
 (
‹rmios
 *
__‹rmios_p
è
__THROW
;

81 
	$tc£ndb»ak
 (
__fd
, 
__du¿tiÚ
è
__THROW
;

87 
	`tcd¿š
 (
__fd
);

91 
	$tcæush
 (
__fd
, 
__queue_£ËùÜ
è
__THROW
;

95 
	$tcæow
 (
__fd
, 
__aùiÚ
è
__THROW
;

98 #ifdeà
__USE_UNIX98


100 
__pid_t
 
	$tcg‘sid
 (
__fd
è
__THROW
;

104 #ifdeà
__USE_BSD


105 
	~<sys/‰ydeçuÉs.h
>

108 
__END_DECLS


	@/usr/include/time.h

23 #iâdef 
_TIME_H


25 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

26 ! 
defšed
 
	g__Ãed_time¥ec
)

27 
	#_TIME_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__Ãed_size_t


	)

37 
	#__Ãed_NULL


	)

38 
	~<¡ddef.h
>

42 
	~<b™s/time.h
>

45 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


46 #iâdeà
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

54 
	#__şock_t_defšed
 1

	)

56 
	~<b™s/ty³s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__şock_t
 
	tşock_t
;

61 
	g__END_NAMESPACE_STD


62 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
şock_t
)

67 #undeà
__Ãed_şock_t


69 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

70 
	#__time_t_defšed
 1

	)

72 
	~<b™s/ty³s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #undeà
__Ãed_time_t


85 #ià!
defšed
 
__şockid_t_defšed
 && \

86 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

87 
	#__şockid_t_defšed
 1

	)

89 
	~<b™s/ty³s.h
>

92 
__şockid_t
 
	tşockid_t
;

95 #undeà
__şockid_time_t


97 #ià!
defšed
 
__tim”_t_defšed
 && \

98 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

99 
	#__tim”_t_defšed
 1

	)

101 
	~<b™s/ty³s.h
>

104 
__tim”_t
 
	ttim”_t
;

107 #undeà
__Ãed_tim”_t


110 #ià!
defšed
 
__time¥ec_defšed
 && \

111 ((
defšed
 
_TIME_H
 && \

112 (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
)) || \

113 
defšed
 
__Ãed_time¥ec
)

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__cÚ¡
 *
tm_zÚe
;

149 
__tm_gmtoff
;

150 
__cÚ¡
 *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 
__BEGIN_NAMESPACE_STD


183 
şock_t
 
	$şock
 (è
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

189 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

190 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

193 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

199 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

200 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

201 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifdeà
__USE_XOPEN


207 *
	$¡½time
 (
__cÚ¡
 *
__»¡riù
 
__s
,

208 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
)

209 
__THROW
;

212 #ifdeà
__USE_XOPEN2K8


215 
	~<xloÿË.h
>

217 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

218 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

219 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

220 
__loÿË_t
 
__loc
è
__THROW
;

223 #ifdeà
__USE_GNU


224 *
	$¡½time_l
 (
__cÚ¡
 *
__»¡riù
 
__s
,

225 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

237 
tm
 *
	$loÿÉime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

238 
__END_NAMESPACE_STD


240 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

244 
tm
 *
__»¡riù
 
__
è
__THROW
;

248 
tm
 *
	$loÿÉime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

249 
tm
 *
__»¡riù
 
__
è
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$asùime
 (
__cÚ¡
 
tm
 *
__
è
__THROW
;

258 *
	$ùime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

259 
__END_NAMESPACE_STD


261 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


266 *
	$asùime_r
 (
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

267 *
__»¡riù
 
__buf
è
__THROW
;

270 *
	$ùime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

271 *
__»¡riù
 
__buf
è
__THROW
;

276 *
__tzÇme
[2];

277 
__daylight
;

278 
__timezÚe
;

281 #ifdef 
__USE_POSIX


283 *
tzÇme
[2];

287 
	$tz£t
 (è
__THROW
;

290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


291 
daylight
;

292 
timezÚe
;

295 #ifdeà
__USE_SVID


298 
	$¡ime
 (
__cÚ¡
 
time_t
 *
__wh’
è
__THROW
;

304 
	#__i¦—p
(
y—r
) \

305 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

308 #ifdeà
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

316 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

319 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

323 #ifdeà
__USE_POSIX199309


328 
	`Çno¦“p
 (
__cÚ¡
 
time¥ec
 *
__»que¡ed_time
,

329 
time¥ec
 *
__»maššg
);

333 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

336 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

339 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, 
__cÚ¡
 
time¥ec
 *
__
)

340 
__THROW
;

342 #ifdeà
__USE_XOPEN2K


347 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

348 
__cÚ¡
 
time¥ec
 *
__»q
,

349 
time¥ec
 *
__»m
);

352 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

357 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

358 
sigev’t
 *
__»¡riù
 
__evp
,

359 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

362 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

365 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

366 
__cÚ¡
 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

367 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

370 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

371 
__THROW
;

374 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

378 #ifdeà
__USE_XOPEN_EXTENDED


390 
g‘d©e_”r
;

399 
tm
 *
	`g‘d©e
 (
__cÚ¡
 *
__¡ršg
);

402 #ifdeà
__USE_GNU


413 
	`g‘d©e_r
 (
__cÚ¡
 *
__»¡riù
 
__¡ršg
,

414 
tm
 *
__»¡riù
 
__»sbuå
);

417 
__END_DECLS


	@/usr/include/unistd.h

23 #iâdef 
_UNISTD_H


24 
	#_UNISTD_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


33 #ifdeà
__USE_XOPEN2K8


35 
	#_POSIX_VERSION
 200809L

	)

36 #–ià
defšed
 
__USE_XOPEN2K


38 
	#_POSIX_VERSION
 200112L

	)

39 #–ià
defšed
 
__USE_POSIX199506


41 
	#_POSIX_VERSION
 199506L

	)

42 #–ià
defšed
 
__USE_POSIX199309


44 
	#_POSIX_VERSION
 199309L

	)

47 
	#_POSIX_VERSION
 199009L

	)

53 #ifdeà
__USE_XOPEN2K8


54 
	#__POSIX2_THIS_VERSION
 200809L

	)

56 #–ià
defšed
 
__USE_XOPEN2K


58 
	#__POSIX2_THIS_VERSION
 200112L

	)

59 #–ià
defšed
 
__USE_POSIX199506


61 
	#__POSIX2_THIS_VERSION
 199506L

	)

64 
	#__POSIX2_THIS_VERSION
 199209L

	)

68 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

72 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

76 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

80 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

84 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

87 #ifdeà
__USE_XOPEN2K8


88 
	#_XOPEN_VERSION
 700

	)

89 #–ià
defšed
 
__USE_XOPEN2K


90 
	#_XOPEN_VERSION
 600

	)

91 #–ià
defšed
 
__USE_UNIX98


92 
	#_XOPEN_VERSION
 500

	)

94 
	#_XOPEN_VERSION
 4

	)

98 
	#_XOPEN_XCU_VERSION
 4

	)

101 
	#_XOPEN_XPG2
 1

	)

102 
	#_XOPEN_XPG3
 1

	)

103 
	#_XOPEN_XPG4
 1

	)

106 
	#_XOPEN_UNIX
 1

	)

109 
	#_XOPEN_CRYPT
 1

	)

113 
	#_XOPEN_ENH_I18N
 1

	)

116 
	#_XOPEN_LEGACY
 1

	)

203 
	~<b™s/posix_İt.h
>

206 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


207 
	~<b™s/’vœÚm’ts.h
>

211 
	#STDIN_FILENO
 0

	)

212 
	#STDOUT_FILENO
 1

	)

213 
	#STDERR_FILENO
 2

	)

218 
	~<b™s/ty³s.h
>

220 #iâdef 
__ssize_t_defšed


221 
__ssize_t
 
	tssize_t
;

222 
	#__ssize_t_defšed


	)

225 
	#__Ãed_size_t


	)

226 
	#__Ãed_NULL


	)

227 
	~<¡ddef.h
>

229 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


232 #iâdeà
__gid_t_defšed


233 
__gid_t
 
	tgid_t
;

234 
	#__gid_t_defšed


	)

237 #iâdeà
__uid_t_defšed


238 
__uid_t
 
	tuid_t
;

239 
	#__uid_t_defšed


	)

242 #iâdeà
__off_t_defšed


243 #iâdeà
__USE_FILE_OFFSET64


244 
__off_t
 
	toff_t
;

246 
__off64_t
 
	toff_t
;

248 
	#__off_t_defšed


	)

250 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


251 
__off64_t
 
	toff64_t
;

252 
	#__off64_t_defšed


	)

255 #iâdeà
__u£cÚds_t_defšed


256 
__u£cÚds_t
 
	tu£cÚds_t
;

257 
	#__u£cÚds_t_defšed


	)

260 #iâdeà
__pid_t_defšed


261 
__pid_t
 
	tpid_t
;

262 
	#__pid_t_defšed


	)

266 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


267 #iâdeà
__šŒ_t_defšed


268 
__šŒ_t
 
	tšŒ_t
;

269 
	#__šŒ_t_defšed


	)

273 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


274 #iâdeà
__sockËn_t_defšed


275 
__sockËn_t
 
	tsockËn_t
;

276 
	#__sockËn_t_defšed


	)

282 
	#R_OK
 4

	)

283 
	#W_OK
 2

	)

284 
	#X_OK
 1

	)

285 
	#F_OK
 0

	)

288 
	$acûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

290 #ifdeà
__USE_GNU


293 
	$euidacûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

294 
__THROW
 
	`__nÚnuÎ
 ((1));

297 
	$—cûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

298 
__THROW
 
	`__nÚnuÎ
 ((1));

301 #ifdeà
__USE_ATFILE


305 
	$çcûs§t
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__ty³
, 
__æag
)

306 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

311 #iâdef 
_STDIO_H


312 
	#SEEK_SET
 0

	)

313 
	#SEEK_CUR
 1

	)

314 
	#SEEK_END
 2

	)

315 #ifdeà
__USE_GNU


316 
	#SEEK_DATA
 3

	)

317 
	#SEEK_HOLE
 4

	)

321 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


323 
	#L_SET
 
SEEK_SET


	)

324 
	#L_INCR
 
SEEK_CUR


	)

325 
	#L_XTND
 
SEEK_END


	)

334 #iâdeà
__USE_FILE_OFFSET64


335 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

337 #ifdeà
__REDIRECT_NTH


338 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

339 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

340 
l£ek64
);

342 
	#l£ek
 
l£ek64


	)

345 #ifdeà
__USE_LARGEFILE64


346 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

347 
__THROW
;

354 
	`şo£
 (
__fd
);

361 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

367 
ssize_t
 
	$wr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
è
__wur
;

369 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


370 #iâdeà
__USE_FILE_OFFSET64


377 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

378 
__off_t
 
__off£t
è
__wur
;

385 
ssize_t
 
	$pwr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

386 
__off_t
 
__off£t
è
__wur
;

388 #ifdeà
__REDIRECT


389 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

390 
__off64_t
 
__off£t
),

391 
´—d64
è
__wur
;

392 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, 
__cÚ¡
 *
__buf
,

393 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

394 
pwr™e64
è
__wur
;

396 
	#´—d
 
´—d64


	)

397 
	#pwr™e
 
pwr™e64


	)

401 #ifdeà
__USE_LARGEFILE64


405 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

406 
__off64_t
 
__off£t
è
__wur
;

409 
ssize_t
 
	$pwr™e64
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

410 
__off64_t
 
__off£t
è
__wur
;

418 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

420 #ifdeà
__USE_GNU


423 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

433 
	$®¬m
 (
__£cÚds
è
__THROW
;

445 
	`¦“p
 (
__£cÚds
);

447 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

448 || 
defšed
 
__USE_BSD


453 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

454 
__THROW
;

461 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

470 
	`·u£
 ();

474 
	$chown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

475 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

477 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


479 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

484 
	$lchown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

485 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

489 #ifdeà
__USE_ATFILE


492 
	$fchowÇt
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
,

493 
__gid_t
 
__group
, 
__æag
)

494 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

498 
	$chdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

500 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


502 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

512 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

514 #ifdef 
__USE_GNU


518 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

521 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

522 || 
defšed
 
__USE_BSD


526 *
	$g‘wd
 (*
__buf
)

527 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

532 
	$dup
 (
__fd
è
__THROW
 
__wur
;

535 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

537 #ifdeà
__USE_GNU


540 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

544 **
__’vœÚ
;

545 #ifdeà
__USE_GNU


546 **
’vœÚ
;

552 
	$execve
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[],

553 *
__cÚ¡
 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

555 #ifdeà
__USE_XOPEN2K8


558 
	$ãxecve
 (
__fd
, *
__cÚ¡
 
__¬gv
[], *__cÚ¡ 
__’vp
[])

559 
__THROW
 
	`__nÚnuÎ
 ((2));

564 
	$execv
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[])

565 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 
	$exeşe
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

574 
	$exeş
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

575 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 
	$execvp
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[])

580 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

585 
	$exeşp
 (
__cÚ¡
 *
__fe
, __cÚ¡ *
__¬g
, ...)

586 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

588 #ifdeà
__USE_GNU


591 
	$execv³
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[],

592 *
__cÚ¡
 
__’vp
[])

593 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

597 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


599 
	$niû
 (
__šc
è
__THROW
 
__wur
;

604 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

610 
	~<b™s/cÚâame.h
>

613 
	$·thcÚf
 (
__cÚ¡
 *
__·th
, 
__Çme
)

614 
__THROW
 
	`__nÚnuÎ
 ((1));

617 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

620 
	$syscÚf
 (
__Çme
è
__THROW
;

622 #ifdef 
__USE_POSIX2


624 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

629 
__pid_t
 
	$g‘pid
 (è
__THROW
;

632 
__pid_t
 
	$g‘µid
 (è
__THROW
;

636 #iâdeà
__FAVOR_BSD


637 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

639 #ifdeà
__REDIRECT_NTH


640 
__pid_t
 
	`__REDIRECT_NTH
 (
g‘pg½
, (__pid_ˆ
__pid
), 
__g‘pgid
);

642 
	#g‘pg½
 
__g‘pgid


	)

647 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

648 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


649 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

656 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

658 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


669 #iâdeà
__FAVOR_BSD


673 
	$£g½
 (è
__THROW
;

678 #ifdeà
__REDIRECT_NTH


679 
	`__REDIRECT_NTH
 (
£g½
, (
__pid_t
 
__pid
, __pid_ˆ
__pg½
), 
£gid
);

681 
	#£g½
 
£gid


	)

690 
__pid_t
 
	$£tsid
 (è
__THROW
;

692 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


694 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

698 
__uid_t
 
	$g‘uid
 (è
__THROW
;

701 
__uid_t
 
	$g‘euid
 (è
__THROW
;

704 
__gid_t
 
	$g‘gid
 (è
__THROW
;

707 
__gid_t
 
	$g‘egid
 (è
__THROW
;

712 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

714 #ifdef 
__USE_GNU


716 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

723 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
;

725 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


728 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
;

731 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


733 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
;

740 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
;

742 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


745 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
;

748 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


750 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
;

753 #ifdeà
__USE_GNU


756 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

757 
__THROW
;

761 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

762 
__THROW
;

766 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

767 
__THROW
;

771 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

772 
__THROW
;

779 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

781 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

782 || 
defšed
 
__USE_BSD


787 
__pid_t
 
	$vfÜk
 (è
__THROW
;

793 *
	$‰yÇme
 (
__fd
è
__THROW
;

797 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

798 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

802 
	$i§‰y
 (
__fd
è
__THROW
;

804 #ià
defšed
 
__USE_BSD
 \

805 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

808 
	$‰y¦Ù
 (è
__THROW
;

813 
	$lšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

814 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

816 #ifdeà
__USE_ATFILE


819 
	$lšk©
 (
__äomfd
, 
__cÚ¡
 *
__äom
, 
__tofd
,

820 
__cÚ¡
 *
__to
, 
__æags
)

821 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

824 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


826 
	$symlšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

827 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

832 
ssize_t
 
	$»adlšk
 (
__cÚ¡
 *
__»¡riù
 
__·th
,

833 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

834 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

837 #ifdeà
__USE_ATFILE


839 
	$symlšk©
 (
__cÚ¡
 *
__äom
, 
__tofd
,

840 
__cÚ¡
 *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

843 
ssize_t
 
	$»adlšk©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

844 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

845 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

849 
	$uÆšk
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

851 #ifdeà
__USE_ATFILE


853 
	$uÆšk©
 (
__fd
, 
__cÚ¡
 *
__Çme
, 
__æag
)

854 
__THROW
 
	`__nÚnuÎ
 ((2));

858 
	$rmdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

862 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

865 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

872 *
	`g‘logš
 ();

873 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


880 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

883 #ifdef 
__USE_BSD


885 
	$£ogš
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

889 #ifdef 
__USE_POSIX2


893 
	#__Ãed_g‘İt


	)

894 
	~<g‘İt.h
>

898 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


902 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

906 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

909 
	$£tho¡Çme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

910 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

914 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

920 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

921 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

922 
	$£tdomašÇme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

923 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

929 
	$vhªgup
 (è
__THROW
;

932 
	$»voke
 (
__cÚ¡
 *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

940 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

941 
size_t
 
__off£t
, 
__sÿË
)

942 
__THROW
 
	`__nÚnuÎ
 ((1));

948 
	$acù
 (
__cÚ¡
 *
__Çme
è
__THROW
;

952 *
	$g‘u£rsh–l
 (è
__THROW
;

953 
	$’du£rsh–l
 (è
__THROW
;

954 
	$£tu£rsh–l
 (è
__THROW
;

960 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

964 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

967 
	$chroÙ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

971 *
	$g‘·ss
 (
__cÚ¡
 *
__´om±
è
	`__nÚnuÎ
 ((1));

975 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


980 
	`fsync
 (
__fd
);

984 #ifdeà
__USE_GNU


987 
	$syncfs
 (
__fd
è
__THROW
;

991 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


994 
	`g‘ho¡id
 ();

997 
	$sync
 (è
__THROW
;

1000 #ià
defšed
 
__USE_BSD
 || !defšed 
__USE_XOPEN2K


1003 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

1008 
	$g‘dbËsize
 (è
__THROW
;

1014 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


1017 #iâdeà
__USE_FILE_OFFSET64


1018 
	$Œunÿ‹
 (
__cÚ¡
 *
__fe
, 
__off_t
 
__Ëngth
)

1019 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1021 #ifdeà
__REDIRECT_NTH


1022 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

1023 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
),

1024 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1026 
	#Œunÿ‹
 
Œunÿ‹64


	)

1029 #ifdeà
__USE_LARGEFILE64


1030 
	$Œunÿ‹64
 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
)

1031 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1036 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1039 #iâdeà
__USE_FILE_OFFSET64


1040 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1042 #ifdeà
__REDIRECT_NTH


1043 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1044 
árunÿ‹64
è
__wur
;

1046 
	#árunÿ‹
 
árunÿ‹64


	)

1049 #ifdeà
__USE_LARGEFILE64


1050 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1056 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1057 || 
defšed
 
__USE_MISC


1061 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1067 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1071 #ifdeà
__USE_MISC


1082 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1087 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1099 
	#F_ULOCK
 0

	)

1100 
	#F_LOCK
 1

	)

1101 
	#F_TLOCK
 2

	)

1102 
	#F_TEST
 3

	)

1104 #iâdeà
__USE_FILE_OFFSET64


1105 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1107 #ifdeà
__REDIRECT


1108 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1109 
lockf64
è
__wur
;

1111 
	#lockf
 
lockf64


	)

1114 #ifdeà
__USE_LARGEFILE64


1115 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1120 #ifdeà
__USE_GNU


1125 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1126 (
__ex‹nsiÚ__
 \

1127 ({ 
__»suÉ
; \

1128 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1129 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1130 
__»suÉ
; 
	}
}))

	)

1133 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1136 
fd©async
 (
__fdes
);

1142 #ifdef 
__USE_XOPEN


1144 *
	$üy±
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__§É
)

1145 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1149 
	$’üy±
 (*
__libc_block
, 
__edæag
è
__THROW
 
	`__nÚnuÎ
 ((1));

1156 
	$swab
 (
__cÚ¡
 *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1157 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1163 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


1165 *
	$ù”mid
 (*
__s
è
__THROW
;

1170 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


1171 
	~<b™s/uni¡d.h
>

1174 
__END_DECLS


	@/usr/include/alloca.h

19 #iâdef 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	#__Ãed_size_t


	)

25 
	~<¡ddef.h
>

27 
	g__BEGIN_DECLS


30 #undeà
®loÿ


33 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

35 #ifdef 
__GNUC__


36 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

39 
__END_DECLS


	@/usr/include/endian.h

19 #iâdef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<ã©u»s.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<b™s/’dŸn.h
>

41 #iâdeà
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

54 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

59 #ifdeà
__USE_BSD


61 
	~<b™s/by‹sw­.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è(x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è(x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è(x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è(x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

20 #iâdef 
_FEATURES_H


21 
	#_FEATURES_H
 1

	)

98 #undeà
__USE_ISOC99


99 #undeà
__USE_ISOC95


100 #undeà
__USE_POSIX


101 #undeà
__USE_POSIX2


102 #undeà
__USE_POSIX199309


103 #undeà
__USE_POSIX199506


104 #undeà
__USE_XOPEN


105 #undeà
__USE_XOPEN_EXTENDED


106 #undeà
__USE_UNIX98


107 #undeà
__USE_XOPEN2K


108 #undeà
__USE_XOPEN2KXSI


109 #undeà
__USE_XOPEN2K8


110 #undeà
__USE_XOPEN2K8XSI


111 #undeà
__USE_LARGEFILE


112 #undeà
__USE_LARGEFILE64


113 #undeà
__USE_FILE_OFFSET64


114 #undeà
__USE_BSD


115 #undeà
__USE_SVID


116 #undeà
__USE_MISC


117 #undeà
__USE_ATFILE


118 #undeà
__USE_GNU


119 #undeà
__USE_REENTRANT


120 #undeà
__USE_FORTIFY_LEVEL


121 #undeà
__FAVOR_BSD


122 #undeà
__KERNEL_STRICT_NAMES


126 #iâdeà
_LOOSE_KERNEL_NAMES


127 
	#__KERNEL_STRICT_NAMES


	)

131 
	#__USE_ANSI
 1

	)

140 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


141 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

142 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

144 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

149 #ià
defšed
 
_BSD_SOURCE
 && \

150 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

151 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

152 
	#__FAVOR_BSD
 1

	)

156 #ifdeà
_GNU_SOURCE


157 #undeà
_ISOC95_SOURCE


158 
	#_ISOC95_SOURCE
 1

	)

159 #undeà
_ISOC99_SOURCE


160 
	#_ISOC99_SOURCE
 1

	)

161 #undeà
_POSIX_SOURCE


162 
	#_POSIX_SOURCE
 1

	)

163 #undeà
_POSIX_C_SOURCE


164 
	#_POSIX_C_SOURCE
 200809L

	)

165 #undeà
_XOPEN_SOURCE


166 
	#_XOPEN_SOURCE
 700

	)

167 #undeà
_XOPEN_SOURCE_EXTENDED


168 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

169 #undeà
_LARGEFILE64_SOURCE


170 
	#_LARGEFILE64_SOURCE
 1

	)

171 #undeà
_BSD_SOURCE


172 
	#_BSD_SOURCE
 1

	)

173 #undeà
_SVID_SOURCE


174 
	#_SVID_SOURCE
 1

	)

175 #undeà
_ATFILE_SOURCE


176 
	#_ATFILE_SOURCE
 1

	)

181 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

182 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

183 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

184 
	#_BSD_SOURCE
 1

	)

185 
	#_SVID_SOURCE
 1

	)

192 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

193 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

194 
	#__USE_ISOC99
 1

	)

198 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

199 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

200 
	#__USE_ISOC95
 1

	)

205 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

206 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

207 
	#_POSIX_SOURCE
 1

	)

208 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

209 
	#_POSIX_C_SOURCE
 2

	)

210 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

211 
	#_POSIX_C_SOURCE
 199506L

	)

212 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

213 
	#_POSIX_C_SOURCE
 200112L

	)

215 
	#_POSIX_C_SOURCE
 200809L

	)

217 
	#__USE_POSIX_IMPLICITLY
 1

	)

220 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


221 
	#__USE_POSIX
 1

	)

224 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


225 
	#__USE_POSIX2
 1

	)

228 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

229 
	#__USE_POSIX199309
 1

	)

232 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

233 
	#__USE_POSIX199506
 1

	)

236 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

237 
	#__USE_XOPEN2K
 1

	)

238 #undeà
__USE_ISOC95


239 
	#__USE_ISOC95
 1

	)

240 #undeà
__USE_ISOC99


241 
	#__USE_ISOC99
 1

	)

244 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

245 
	#__USE_XOPEN2K8
 1

	)

246 #undeà
_ATFILE_SOURCE


247 
	#_ATFILE_SOURCE
 1

	)

250 #ifdef 
_XOPEN_SOURCE


251 
	#__USE_XOPEN
 1

	)

252 #ià(
_XOPEN_SOURCE
 - 0) >= 500

253 
	#__USE_XOPEN_EXTENDED
 1

	)

254 
	#__USE_UNIX98
 1

	)

255 #undeà
_LARGEFILE_SOURCE


256 
	#_LARGEFILE_SOURCE
 1

	)

257 #ià(
_XOPEN_SOURCE
 - 0) >= 600

258 #ià(
_XOPEN_SOURCE
 - 0) >= 700

259 
	#__USE_XOPEN2K8
 1

	)

260 
	#__USE_XOPEN2K8XSI
 1

	)

262 
	#__USE_XOPEN2K
 1

	)

263 
	#__USE_XOPEN2KXSI
 1

	)

264 #undeà
__USE_ISOC95


265 
	#__USE_ISOC95
 1

	)

266 #undeà
__USE_ISOC99


267 
	#__USE_ISOC99
 1

	)

270 #ifdeà
_XOPEN_SOURCE_EXTENDED


271 
	#__USE_XOPEN_EXTENDED
 1

	)

276 #ifdeà
_LARGEFILE_SOURCE


277 
	#__USE_LARGEFILE
 1

	)

280 #ifdeà
_LARGEFILE64_SOURCE


281 
	#__USE_LARGEFILE64
 1

	)

284 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

285 
	#__USE_FILE_OFFSET64
 1

	)

288 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


289 
	#__USE_MISC
 1

	)

292 #ifdef 
_BSD_SOURCE


293 
	#__USE_BSD
 1

	)

296 #ifdef 
_SVID_SOURCE


297 
	#__USE_SVID
 1

	)

300 #ifdef 
_ATFILE_SOURCE


301 
	#__USE_ATFILE
 1

	)

304 #ifdef 
_GNU_SOURCE


305 
	#__USE_GNU
 1

	)

308 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


309 
	#__USE_REENTRANT
 1

	)

312 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

313 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

314 #ià
_FORTIFY_SOURCE
 > 1

315 
	#__USE_FORTIFY_LEVEL
 2

	)

317 
	#__USE_FORTIFY_LEVEL
 1

	)

320 
	#__USE_FORTIFY_LEVEL
 0

	)

324 
	~<b™s/´edefs.h
>

327 
	#__STDC_ISO_10646__
 200009L

	)

335 #undeà
__GNU_LIBRARY__


336 
	#__GNU_LIBRARY__
 6

	)

340 
	#__GLIBC__
 2

	)

341 
	#__GLIBC_MINOR__
 15

	)

343 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

344 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

347 #ià
defšed
 
__GNUC__
 \

348 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

349 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

350 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

351 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

355 #iâdeà
__ASSEMBLER__


356 #iâdeà
_SYS_CDEFS_H


357 
	~<sys/cdefs.h
>

362 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


363 
	#__USE_LARGEFILE
 1

	)

364 
	#__USE_LARGEFILE64
 1

	)

370 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

371 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

372 && 
defšed
 
	g__ex‹º_šlše


373 
	#__USE_EXTERN_INLINES
 1

	)

378 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

379 && (
defšed
 
	g_LIBC
 || !defšed 
	g__OPTIMIZE_SIZE__
è&& !defšed 
	g__NO_INLINE__
 \

380 && 
defšed
 
	g__ex‹º_šlše


381 
	#__USE_EXTERN_INLINES_IN_LIBC
 1

	)

389 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

21 #iâdeà
_GETOPT_H


23 #iâdeà
__Ãed_g‘İt


24 
	#_GETOPT_H
 1

	)

34 #ià!
defšed
 
__GNU_LIBRARY__


35 
	~<ùy³.h
>

38 #iâdeà
__THROW


39 #iâdeà
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

42 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__ılu¥lus


59 *
İrg
;

73 
İtšd
;

78 
İ‹¼
;

82 
İtİt
;

84 #iâdeà
__Ãed_g‘İt


106 
	sİtiÚ


108 cÚ¡ *
	gÇme
;

111 
	ghas_¬g
;

112 *
	gæag
;

113 
	gv®
;

118 
	#no_¬gum’t
 0

	)

119 
	#»quœed_¬gum’t
 1

	)

120 
	#İtiÚ®_¬gum’t
 2

	)

148 #ifdeà
__GNU_LIBRARY__


152 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

153 
__THROW
;

155 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

156 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


160 #ifdeà
__REDIRECT


161 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

162 cÚ¡ *
__shÜtİts
),

163 
__posix_g‘İt
);

165 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

166 cÚ¡ *
__shÜtİts
è
__THROW
;

167 
	#g‘İt
 
__posix_g‘İt


	)

171 
g‘İt
 ();

174 #iâdeà
__Ãed_g‘İt


175 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

176 cÚ¡ *
__shÜtİts
,

177 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

178 
__THROW
;

179 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

180 cÚ¡ *
__shÜtİts
,

181 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

182 
__THROW
;

186 #ifdef 
__ılu¥lus


191 #undeà
__Ãed_g‘İt


	@/usr/include/libio.h

29 #iâdeà
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_cÚfig.h
>

34 
	#_IO_pos_t
 
_G_åos_t


	)

35 
	#_IO_åos_t
 
_G_åos_t


	)

36 
	#_IO_åos64_t
 
_G_åos64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li¡
 
_G_va_li¡


	)

48 
	#_IO_wšt_t
 
_G_wšt_t


	)

50 #ifdeà
_G_NEED_STDARG_H


52 
	#__Ãed___va_li¡


	)

53 
	~<¡d¬g.h
>

54 #ifdeà
__GNUC_VA_LIST


55 #undeà
_IO_va_li¡


56 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

60 #iâdeà
__P


61 #ià
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifdeà
__STDC__


65 
	#__P
(
p
è
	)
p

66 
	#__PMT
(
p
è
	)
p

68 
	#__P
(
p
è()

	)

69 
	#__PMT
(
p
è()

	)

75 #iâdeà
_PARAMS


76 
	#_PARAMS
(
´Ùos
è
	`__P
ÕrÙos)

	)

79 #iâdeà
__STDC__


81 cÚ¡

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #iâdeà
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #iâdeà
EOF


90 
	#EOF
 (-1)

	)

92 #iâdeà
NULL


93 #ià
defšed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nuÎ
)

	)

97 #ià!
defšed
(
__ılu¥lus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifdeà
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifdeà
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

148 
	#_IO_FLAGS2_NOCLOSE
 32

	)

149 
	#_IO_FLAGS2_CLOEXEC
 64

	)

153 
	#_IO_SKIPWS
 01

	)

154 
	#_IO_LEFT
 02

	)

155 
	#_IO_RIGHT
 04

	)

156 
	#_IO_INTERNAL
 010

	)

157 
	#_IO_DEC
 020

	)

158 
	#_IO_OCT
 040

	)

159 
	#_IO_HEX
 0100

	)

160 
	#_IO_SHOWBASE
 0200

	)

161 
	#_IO_SHOWPOINT
 0400

	)

162 
	#_IO_UPPERCASE
 01000

	)

163 
	#_IO_SHOWPOS
 02000

	)

164 
	#_IO_SCIENTIFIC
 04000

	)

165 
	#_IO_FIXED
 010000

	)

166 
	#_IO_UNITBUF
 020000

	)

167 
	#_IO_STDIO
 040000

	)

168 
	#_IO_DONT_CLOSE
 0100000

	)

169 
	#_IO_BOOLALPHA
 0200000

	)

172 
_IO_jump_t
; 
	g_IO_FILE
;

175 #ifdeà
_IO_MTSAFE_IO


176 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

177 
	~<b™s/¡dio-lock.h
>

182 
	t_IO_lock_t
;

188 
	s_IO_m¬k”
 {

189 
_IO_m¬k”
 *
	m_Ãxt
;

190 
_IO_FILE
 *
	m_sbuf
;

194 
	m_pos
;

196 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

197 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

198 
	mpublic
:

199 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

200 ~
¡»amm¬k”
();

201 
§všg
(è{  
	m_¥os
 == -2; }

202 
d–
(
¡»amm¬k”
&);

203 
d–
();

208 
	e__codecvt_»suÉ


210 
	m__codecvt_ok
,

211 
	m__codecvt_·¹Ÿl
,

212 
	m__codecvt_”rÜ
,

213 
	m__codecvt_nocÚv


216 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


219 
	s_IO_codecvt


221 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

222 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

223 
	m__mb¡©e_t
 *,

224 cÚ¡ 
	mwch¬_t
 *,

225 cÚ¡ 
	mwch¬_t
 *,

226 cÚ¡ 
	mwch¬_t
 **, *,

228 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

229 
	m__mb¡©e_t
 *, *,

231 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

232 
	m__mb¡©e_t
 *,

234 cÚ¡ **, 
	mwch¬_t
 *,

235 
	mwch¬_t
 *, wchar_t **);

236 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

237 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

238 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

239 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

240 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

242 
_IO_icÚv_t
 
	m__cd_š
;

243 
_IO_icÚv_t
 
	m__cd_out
;

247 
	s_IO_wide_d©a


249 
wch¬_t
 *
	m_IO_»ad_±r
;

250 
wch¬_t
 *
	m_IO_»ad_’d
;

251 
wch¬_t
 *
	m_IO_»ad_ba£
;

252 
wch¬_t
 *
	m_IO_wr™e_ba£
;

253 
wch¬_t
 *
	m_IO_wr™e_±r
;

254 
wch¬_t
 *
	m_IO_wr™e_’d
;

255 
wch¬_t
 *
	m_IO_buf_ba£
;

256 
wch¬_t
 *
	m_IO_buf_’d
;

258 
wch¬_t
 *
	m_IO_§ve_ba£
;

259 
wch¬_t
 *
	m_IO_backup_ba£
;

261 
wch¬_t
 *
	m_IO_§ve_’d
;

263 
__mb¡©e_t
 
	m_IO_¡©e
;

264 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

265 
_IO_codecvt
 
	m_codecvt
;

267 
wch¬_t
 
	m_shÜtbuf
[1];

269 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

273 
	s_IO_FILE
 {

274 
	m_æags
;

275 
	#_IO_fe_æags
 
_æags


	)

279 * 
	m_IO_»ad_±r
;

280 * 
	m_IO_»ad_’d
;

281 * 
	m_IO_»ad_ba£
;

282 * 
	m_IO_wr™e_ba£
;

283 * 
	m_IO_wr™e_±r
;

284 * 
	m_IO_wr™e_’d
;

285 * 
	m_IO_buf_ba£
;

286 * 
	m_IO_buf_’d
;

288 *
	m_IO_§ve_ba£
;

289 *
	m_IO_backup_ba£
;

290 *
	m_IO_§ve_’d
;

292 
_IO_m¬k”
 *
	m_m¬k”s
;

294 
_IO_FILE
 *
	m_chaš
;

296 
	m_f’o
;

298 
	m_blksize
;

300 
	m_æags2
;

302 
_IO_off_t
 
	m_Şd_off£t
;

304 
	#__HAVE_COLUMN


	)

306 
	m_cur_cŞumn
;

307 sigÃd 
	m_vbË_off£t
;

308 
	m_shÜtbuf
[1];

312 
_IO_lock_t
 *
	m_lock
;

313 #ifdeà
_IO_USE_OLD_IO_FILE


316 
	s_IO_FILE_com¶‘e


318 
_IO_FILE
 
	m_fe
;

320 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

321 
_IO_off64_t
 
	m_off£t
;

322 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


324 
_IO_codecvt
 *
	m_codecvt
;

325 
_IO_wide_d©a
 *
	m_wide_d©a
;

326 
_IO_FILE
 *
	m_ä“»s_li¡
;

327 *
	m_ä“»s_buf
;

328 
size_t
 
	m_ä“»s_size
;

330 *
	m__·d1
;

331 *
	m__·d2
;

332 *
	m__·d3
;

333 *
	m__·d4
;

334 
size_t
 
	m__·d5
;

336 
	m_mode
;

338 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

342 #iâdeà
__ılu¥lus


343 
_IO_FILE
 
	t_IO_FILE
;

346 
	g_IO_FILE_¶us
;

348 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

349 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

350 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

351 #iâdeà
_LIBC


352 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

353 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

354 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

356 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

357 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

358 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

366 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

374 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, 
	t__cÚ¡
 *
	t__buf
,

375 
	tsize_t
 
	t__n
);

383 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

386 
	t__io_şo£_â
 (*
	t__cook›
);

389 #ifdeà
_GNU_SOURCE


391 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

392 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

393 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

394 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

399 
__io_»ad_â
 *
	m»ad
;

400 
__io_wr™e_â
 *
	mwr™e
;

401 
__io_£ek_â
 *
	m£ek
;

402 
__io_şo£_â
 *
	mşo£
;

403 } 
	t_IO_cook›_io_funùiÚs_t
;

404 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

406 
	g_IO_cook›_fe
;

409 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

410 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

414 #ifdeà
__ılu¥lus


418 
__und”æow
 (
_IO_FILE
 *);

419 
__uæow
 (
_IO_FILE
 *);

420 
__ov”æow
 (
_IO_FILE
 *, );

421 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


422 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

423 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

424 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

427 #ià 
__GNUC__
 >= 3

428 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

430 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

433 
	#_IO_g‘c_uÆocked
(
_å
) \

434 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

435 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

436 
	#_IO_³ekc_uÆocked
(
_å
) \

437 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

438 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

439 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

440 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

441 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

442 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

443 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

445 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


446 
	#_IO_g‘wc_uÆocked
(
_å
) \

447 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

448 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

449 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

450 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

451 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

452 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

453 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

454 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

455 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

456 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

459 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

460 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

462 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

463 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

464 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

465 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

467 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

470 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

471 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

473 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

474 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

475 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

477 #ifdeà
_IO_MTSAFE_IO


478 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

479 
	#_IO_æockfe
(
_å
) \

480 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

481 
	#_IO_fuÆockfe
(
_å
) \

482 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

484 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

485 
	#_IO_æockfe
(
_å
è

	)

486 
	#_IO_fuÆockfe
(
_å
è

	)

487 
	#_IO_árylockfe
(
_å
è

	)

488 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

489 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

492 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

493 
_IO_va_li¡
, *
__»¡riù
);

494 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

495 
_IO_va_li¡
);

496 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

497 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

499 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

500 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

502 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

504 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


505 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

506 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

507 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

508 #ià
__GNUC__
 >= 2

511 #ià
defšed
 
_LIBC
 && defšed 
SHARED


512 
	~<shlib-com·t.h
>

513 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

514 
	#_IO_fwide_maybe_šcom·tibË
 \

515 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

516 cÚ¡ 
_IO_¡dš_u£d
;

517 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

520 #iâdeà
_IO_fwide_maybe_šcom·tibË


521 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

525 
	#_IO_fwide
(
__å
, 
__mode
) \

526 ({ 
__»suÉ
 = (
__mode
); \

527 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

529 ià((
__å
)->
_mode
 == 0) \

531 (
__å
)->
_mode
 = -1; \

532 
__»suÉ
 = (
__å
)->
_mode
; \

534 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

535 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

537 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

538 
__»suÉ
; })

	)

541 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

542 
_IO_va_li¡
, *
__»¡riù
);

543 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

544 
_IO_va_li¡
);

545 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

546 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

549 #ifdeà
__LDBL_COMPAT


550 
	~<b™s/libio-ldbl.h
>

553 #ifdeà
__ılu¥lus


	@/usr/include/rpc/netdb.h

36 #iâdeà
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<ã©u»s.h
>

41 
	#__Ãed_size_t


	)

42 
	~<¡ddef.h
>

44 
__BEGIN_DECLS


46 
	s½ûÁ


48 *
	mr_Çme
;

49 **
	mr_®Ÿ£s
;

50 
	mr_numb”
;

53 
	$£ŒpûÁ
 (
__¡ayİ’
è
__THROW
;

54 
	$’d½ûÁ
 (è
__THROW
;

55 
½ûÁ
 *
	$g‘½cbyÇme
 (
__cÚ¡
 *
__Çme
è
__THROW
;

56 
½ûÁ
 *
	$g‘½cbynumb”
 (
__numb”
è
__THROW
;

57 
½ûÁ
 *
	$g‘½ûÁ
 (è
__THROW
;

59 #ifdeà
__USE_MISC


60 
	$g‘½cbyÇme_r
 (
__cÚ¡
 *
__Çme
, 
½ûÁ
 *
__»suÉ_buf
,

61 *
__bufãr
, 
size_t
 
__buæ’
,

62 
½ûÁ
 **
__»suÉ
è
__THROW
;

64 
	$g‘½cbynumb”_r
 (
__numb”
, 
½ûÁ
 *
__»suÉ_buf
,

65 *
__bufãr
, 
size_t
 
__buæ’
,

66 
½ûÁ
 **
__»suÉ
è
__THROW
;

68 
	$g‘½ûÁ_r
 (
½ûÁ
 *
__»suÉ_buf
, *
__bufãr
,

69 
size_t
 
__buæ’
, 
½ûÁ
 **
__»suÉ
è
__THROW
;

72 
__END_DECLS


	@/usr/include/xlocale.h

21 #iâdeà
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loÿË_¡ruù


31 
__loÿË_d©a
 *
	m__loÿËs
[13];

34 cÚ¡ *
	m__ùy³_b
;

35 cÚ¡ *
	m__ùy³_tŞow”
;

36 cÚ¡ *
	m__ùy³_touµ”
;

39 cÚ¡ *
	m__Çmes
[13];

40 } *
	t__loÿË_t
;

43 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mb¡©e_t
 
	m__¡©e
;

26 } 
	t_G_åos_t
;

29 
__off64_t
 
	m__pos
;

30 
__mb¡©e_t
 
	m__¡©e
;

31 } 
	t_G_åos64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch¬_t
 
wch¬_t


	)

38 
	#_G_wšt_t
 
wšt_t


	)

39 
	#_G_¡©64
 
¡©64


	)

40 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gcÚv.h
>

44 
__gcÚv_šfo
 
	m__cd
;

47 
__gcÚv_šfo
 
	m__cd
;

48 
__gcÚv_¡•_d©a
 
	m__d©a
;

49 } 
	m__combšed
;

50 } 
	t_G_icÚv_t
;

53 
	t_G_št16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_št32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_ušt16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_ušt32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__İ’64


	)

78 
	#_G_LSEEK64
 
__l£ek64


	)

79 
	#_G_MMAP64
 
__mm­64


	)

80 
	#_G_FSTAT64
(
fd
,
buf
è
	`__fx¡©64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #ià
defšed
 
__ılu¥lus
 || defšed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST
è
	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
è()

	)

	@/usr/include/gconv.h

23 #iâdeà
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	#__Ãed_mb¡©e_t


	)

28 
	#__Ãed_wšt_t


	)

29 
	~<wch¬.h
>

30 
	#__Ãed_size_t


	)

31 
	#__Ãed_wch¬_t


	)

32 
	~<¡ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

60 
	m__GCONV_SWAP
 = 0x0004

65 
	g__gcÚv_¡•
;

66 
	g__gcÚv_¡•_d©a
;

67 
	g__gcÚv_lßded_objeù
;

68 
	g__gcÚv_Œªs_d©a
;

72 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 
	t__cÚ¡
 **, __const *,

74 **, 
	tsize_t
 *, , );

77 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

80 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

81 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

85 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

86 
	t__gcÚv_¡•_d©a
 *, *,

87 
	t__cÚ¡
 *,

88 
	t__cÚ¡
 **,

89 
	t__cÚ¡
 *, **,

90 
	tsize_t
 *);

93 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
è(*, 
	t__cÚ¡
 *,

94 
	t__cÚ¡
 *,

98 (*
	t__gcÚv_Œªs_qu”y_fù
è(
	t__cÚ¡
 *, __const ***,

99 
	tsize_t
 *);

102 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

103 (*
	t__gcÚv_Œªs_’d_fù
) (*);

105 
	s__gcÚv_Œªs_d©a


108 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

109 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

110 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

111 *
__d©a
;

112 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

117 
	s__gcÚv_¡•


119 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

120 
__cÚ¡
 *
__modÇme
;

122 
__couÁ”
;

124 *
__äom_Çme
;

125 *
__to_Çme
;

127 
__gcÚv_fù
 
__fù
;

128 
__gcÚv_btowc_fù
 
__btowc_fù
;

129 
__gcÚv_š™_fù
 
__š™_fù
;

130 
__gcÚv_’d_fù
 
__’d_fù
;

134 
__mš_Ãeded_äom
;

135 
__max_Ãeded_äom
;

136 
__mš_Ãeded_to
;

137 
__max_Ãeded_to
;

140 
__¡©eful
;

142 *
__d©a
;

147 
	s__gcÚv_¡•_d©a


149 *
__outbuf
;

150 *
__outbuãnd
;

154 
__æags
;

158 
__švoÿtiÚ_couÁ”
;

162 
__š‹º®_u£
;

164 
__mb¡©e_t
 *
__¡©•
;

165 
__mb¡©e_t
 
__¡©e
;

169 
__gcÚv_Œªs_d©a
 *
__Œªs
;

174 
	s__gcÚv_šfo


176 
size_t
 
__n¡•s
;

177 
__gcÚv_¡•
 *
__¡•s
;

178 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

179 } *
	t__gcÚv_t
;

	@/usr/include/wchar.h

24 #iâdeà
_WCHAR_H


26 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<ã©u»s.h
>

31 #ifdeà
_WCHAR_H


33 
	#__Ãed___FILE


	)

34 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


35 
	#__Ãed_FILE


	)

37 
	~<¡dio.h
>

39 
	#__Ãed___va_li¡


	)

40 
	~<¡d¬g.h
>

42 
	~<b™s/wch¬.h
>

45 
	#__Ãed_size_t


	)

46 
	#__Ãed_wch¬_t


	)

47 
	#__Ãed_NULL


	)

49 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


50 #undeà
__Ãed_wšt_t


51 
	#__Ãed_wšt_t


	)

52 
	~<¡ddef.h
>

56 #iâdeà
_WINT_T


61 
	#_WINT_T


	)

62 
	twšt_t
;

66 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
defšed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twšt_t
;

70 
	g__END_NAMESPACE_STD


75 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

76 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

80 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
__mb¡©e_t_defšed


81 
	#__mb¡©e_t_defšed
 1

	)

85 
	m__couÁ
;

88 #ifdeà
__WINT_TYPE__


89 
__WINT_TYPE__
 
	m__wch
;

91 
wšt_t
 
	m__wch
;

93 
	m__wchb
[4];

94 } 
	m__v®ue
;

95 } 
	t__mb¡©e_t
;

97 #undeà
__Ãed_mb¡©e_t


102 #ifdeà
_WCHAR_H


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 #ifdeà
__USE_GNU


109 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

112 #iâdeà
WCHAR_MIN


114 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

115 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

118 #iâdeà
WEOF


119 
	#WEOF
 (0xffffffffu)

	)

124 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


125 
	~<wùy³.h
>

129 
__BEGIN_DECLS


131 
__BEGIN_NAMESPACE_STD


134 
tm
;

135 
__END_NAMESPACE_STD


139 
	$__USING_NAMESPACE_STD
(
tm
)

142 
__BEGIN_NAMESPACE_STD


144 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

145 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

147 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

149 
__THROW
;

152 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

153 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

155 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

157 
__THROW
;

160 
	$wcscmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
)

161 
__THROW
 
__©Œibu‹_pu»__
;

163 
	$wc¢cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

164 
__THROW
 
__©Œibu‹_pu»__
;

165 
__END_NAMESPACE_STD


167 #ifdeà
__USE_XOPEN2K8


169 
	$wcsÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

172 
	$wc¢ÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

173 
size_t
 
__n
è
__THROW
;

177 
	~<xloÿË.h
>

179 
	$wcsÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

180 
__loÿË_t
 
__loc
è
__THROW
;

182 
	$wc¢ÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

183 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

186 
__BEGIN_NAMESPACE_STD


189 
	$wcscŞl
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

193 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

194 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

195 
__END_NAMESPACE_STD


197 #ifdeà
__USE_XOPEN2K8


203 
	$wcscŞl_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

204 
__loÿË_t
 
__loc
è
__THROW
;

209 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

210 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

213 
wch¬_t
 *
	$wcsdup
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

216 
__BEGIN_NAMESPACE_STD


218 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


219 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

220 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

221 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

222 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
__©Œibu‹_pu»__
;

228 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


229 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

230 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

231 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

232 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
__©Œibu‹_pu»__
;

237 
__END_NAMESPACE_STD


239 #ifdeà
__USE_GNU


242 
wch¬_t
 *
	$wcschºul
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

243 
__THROW
 
__©Œibu‹_pu»__
;

246 
__BEGIN_NAMESPACE_STD


249 
size_t
 
	$wcsc¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__»jeù
)

250 
__THROW
 
__©Œibu‹_pu»__
;

253 
size_t
 
	$wcs¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

254 
__THROW
 
__©Œibu‹_pu»__
;

256 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


257 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, 
__cÚ¡
 wch¬_ˆ*
__acû±
)

258 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

259 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
,

260 
__cÚ¡
 
wch¬_t
 *
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

263 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

264 
__THROW
 
__©Œibu‹_pu»__
;

267 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


268 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

269 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

270 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

271 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

274 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

275 
__THROW
 
__©Œibu‹_pu»__
;

279 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

280 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__d–im
,

281 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

284 
size_t
 
	$wc¦’
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

285 
__END_NAMESPACE_STD


287 #ifdeà
__USE_XOPEN


289 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


290 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

291 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

292 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

293 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

296 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

297 
__THROW
 
__©Œibu‹_pu»__
;

301 #ifdeà
__USE_XOPEN2K8


303 
size_t
 
	$wc¢Ën
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

304 
__THROW
 
__©Œibu‹_pu»__
;

308 
__BEGIN_NAMESPACE_STD


310 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


311 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

312 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

313 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

314 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

317 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

318 
__THROW
 
__©Œibu‹_pu»__
;

322 
	$wmemcmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

323 
__THROW
 
__©Œibu‹_pu»__
;

326 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

327 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

331 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
, 
size_t
 
__n
)

332 
__THROW
;

335 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

336 
__END_NAMESPACE_STD


338 #ifdeà
__USE_GNU


341 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

342 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

343 
__THROW
;

347 
__BEGIN_NAMESPACE_STD


350 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

354 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

358 
	$mbsš™
 (
__cÚ¡
 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

362 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

363 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

364 
mb¡©e_t
 *
__p
è
__THROW
;

367 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

368 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

371 
size_t
 
	$__mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

372 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

373 
size_t
 
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

374 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

375 
__END_NAMESPACE_STD


377 #ifdeà
__USE_EXTERN_INLINES


383 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

384 
__ex‹º_šlše
 
wšt_t


385 
	`__NTH
 (
	$btowc
 (
__c
))

386 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

387 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

389 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

390 
__ex‹º_šlše
 

391 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

392 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

393 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

395 
__ex‹º_šlše
 
size_t


396 
__NTH
 (
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

397 
mb¡©e_t
 *
__»¡riù
 
__ps
))

398 {  (
__ps
 !ğ
NULL


399 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

402 
__BEGIN_NAMESPACE_STD


405 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

406 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

407 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

411 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

412 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

413 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

414 
__END_NAMESPACE_STD


417 #ifdef 
__USE_XOPEN2K8


420 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

421 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

422 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

426 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

427 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

428 
size_t
 
__nwc
, size_ˆ
__Ën
,

429 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

434 #ifdeà
__USE_XOPEN


436 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

440 
	$wcswidth
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

444 
__BEGIN_NAMESPACE_STD


447 
	$wc¡od
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

448 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

449 
__END_NAMESPACE_STD


451 #ifdeà
__USE_ISOC99


452 
__BEGIN_NAMESPACE_C99


454 
	$wc¡of
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

455 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

456 
	$wc¡Şd
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

457 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

458 
__END_NAMESPACE_C99


462 
__BEGIN_NAMESPACE_STD


465 
	$wc¡Ş
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

466 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

470 
	$wc¡oul
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

471 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

472 
__THROW
;

473 
__END_NAMESPACE_STD


475 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GNUC__
 && defšed 
__USE_GNU
)

476 
__BEGIN_NAMESPACE_C99


479 
__ex‹nsiÚ__


480 
	$wc¡Şl
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

481 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

482 
__THROW
;

486 
__ex‹nsiÚ__


487 
	$wc¡ouÎ
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

488 
wch¬_t
 **
__»¡riù
 
__’d±r
,

489 
__ba£
è
__THROW
;

490 
__END_NAMESPACE_C99


493 #ià
defšed
 
__GNUC__
 && defšed 
__USE_GNU


496 
__ex‹nsiÚ__


497 
	$wc¡oq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

498 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

499 
__THROW
;

503 
__ex‹nsiÚ__


504 
	$wc¡ouq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

505 
wch¬_t
 **
__»¡riù
 
__’d±r
,

506 
__ba£
è
__THROW
;

509 #ifdeà
__USE_GNU


523 
	~<xloÿË.h
>

527 
	$wc¡Ş_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

528 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

529 
__loÿË_t
 
__loc
è
__THROW
;

531 
	$wc¡oul_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

532 
wch¬_t
 **
__»¡riù
 
__’d±r
,

533 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

535 
__ex‹nsiÚ__


536 
	$wc¡Şl_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

537 
wch¬_t
 **
__»¡riù
 
__’d±r
,

538 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

540 
__ex‹nsiÚ__


541 
	$wc¡ouÎ_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

542 
wch¬_t
 **
__»¡riù
 
__’d±r
,

543 
__ba£
, 
__loÿË_t
 
__loc
)

544 
__THROW
;

546 
	$wc¡od_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

547 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

548 
__THROW
;

550 
	$wc¡of_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

551 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

552 
__THROW
;

554 
	$wc¡Şd_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

555 
wch¬_t
 **
__»¡riù
 
__’d±r
,

556 
__loÿË_t
 
__loc
è
__THROW
;

560 #ifdeà
__USE_XOPEN2K8


563 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

564 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

568 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

569 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

570 
__THROW
;

577 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

580 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


581 
__BEGIN_NAMESPACE_STD


584 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

591 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

592 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

598 
	`w´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

601 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

602 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

603 
__THROW
 ;

609 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

610 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

611 
__gnuc_va_li¡
 
__¬g
)

617 
	`vw´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

618 
__gnuc_va_li¡
 
__¬g
)

622 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

623 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

624 
__gnuc_va_li¡
 
__¬g
)

625 
__THROW
 ;

632 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

633 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

639 
	`wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

642 
	$swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

643 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

644 
__THROW
 ;

646 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

647 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

648 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

649 #ifdeà
__REDIRECT


653 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

654 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

655 
__isoc99_fwsÿnf
)

657 
	`__REDIRECT
 (
wsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

658 
__isoc99_wsÿnf
)

660 
	`__REDIRECT_NTH
 (
swsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

661 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

662 ...), 
__isoc99_swsÿnf
)

665 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

666 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

667 
	`__isoc99_wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

668 
	$__isoc99_swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

669 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

670 
__THROW
;

671 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

672 
	#wsÿnf
 
__isoc99_wsÿnf


	)

673 
	#swsÿnf
 
__isoc99_swsÿnf


	)

677 
__END_NAMESPACE_STD


680 #ifdeà
__USE_ISOC99


681 
__BEGIN_NAMESPACE_C99


686 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

687 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

688 
__gnuc_va_li¡
 
__¬g
)

694 
	`vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

695 
__gnuc_va_li¡
 
__¬g
)

698 
	$vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

699 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

700 
__gnuc_va_li¡
 
__¬g
)

701 
__THROW
 ;

703 #ià!
defšed
 
__USE_GNU
 \

704 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

705 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

706 #ifdeà
__REDIRECT


707 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

708 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

709 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

711 
	`__REDIRECT
 (
vwsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

712 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

714 
	`__REDIRECT_NTH
 (
vswsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

715 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

716 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

719 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

720 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

721 
__gnuc_va_li¡
 
__¬g
);

722 
	`__isoc99_vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

723 
__gnuc_va_li¡
 
__¬g
);

724 
	$__isoc99_vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

725 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

726 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

727 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

728 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

729 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

733 
__END_NAMESPACE_C99


737 
__BEGIN_NAMESPACE_STD


742 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

743 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

749 
wšt_t
 
	`g‘wch¬
 ();

756 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

757 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

763 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

771 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

772 
__FILE
 *
__»¡riù
 
__¡»am
);

778 
	`åutws
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

779 
__FILE
 *
__»¡riù
 
__¡»am
);

786 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

787 
__END_NAMESPACE_STD


790 #ifdeà
__USE_GNU


798 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

799 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

807 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

815 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

824 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

825 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

834 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

835 
__FILE
 *
__»¡riù
 
__¡»am
);

843 
	`åutws_uÆocked
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

844 
__FILE
 *
__»¡riù
 
__¡»am
);

848 
__BEGIN_NAMESPACE_C99


852 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

853 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

854 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

855 
__END_NAMESPACE_C99


857 #ifdeà
__USE_GNU


858 
	~<xloÿË.h
>

862 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

863 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

864 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

865 
__loÿË_t
 
__loc
è
__THROW
;

874 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


875 
	#__Ãed_iswxxx


	)

876 
	~<wùy³.h
>

880 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


881 
	~<b™s/wch¬2.h
>

884 #ifdeà
__LDBL_COMPAT


885 
	~<b™s/wch¬-ldbl.h
>

888 
__END_DECLS


896 #undeà
__Ãed_mb¡©e_t


897 #undeà
__Ãed_wšt_t


	@/usr/include/wctype.h

24 #iâdeà
_WCTYPE_H


26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 #iâdeà
__Ãed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__Ãed_wšt_t


	)

34 
	~<wch¬.h
>

38 #iâdeà
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #undeà
__Ãed_iswxxx


47 #iâdeà
__iswxxx_defšed


48 
	#__iswxxx_defšed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	twùy³_t
;

54 
	g__END_NAMESPACE_C99


56 #iâdeà
_ISwb™


61 
	~<’dŸn.h
>

62 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


63 
	#_ISwb™
(
b™
è(1 << (b™))

	)

65 
	#_ISwb™
(
b™
) \

66 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (è((1UL << (
b™
)è>> 24))))

	)

74 
	m__ISwuµ”
 = 0,

75 
	m__ISwlow”
 = 1,

76 
	m__ISw®pha
 = 2,

77 
	m__ISwdig™
 = 3,

78 
	m__ISwxdig™
 = 4,

79 
	m__ISw¥aû
 = 5,

80 
	m__ISw´št
 = 6,

81 
	m__ISwg¿ph
 = 7,

82 
	m__ISwbÏnk
 = 8,

83 
	m__ISwúŒl
 = 9,

84 
	m__ISwpunù
 = 10,

85 
	m__ISw®num
 = 11,

87 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

88 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

89 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

90 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

91 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

92 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

93 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

94 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

95 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

96 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

97 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

98 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

118 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

121 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

125 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

129 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

134 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

137 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

142 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

147 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

152 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

157 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

162 #ifdeà
__USE_ISOC99


163 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

172 
wùy³_t
 
	$wùy³
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

176 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__cÚ¡
 
	t__št32_t
 *
	twù¿ns_t
;

188 
__END_NAMESPACE_C99


189 #ifdeà
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

198 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifdeà
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
wù¿ns_t
 
	$wù¿ns
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

222 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

223 
__END_NAMESPACE_C99


225 #ifdeà
__USE_XOPEN2K8


227 
	~<xloÿË.h
>

231 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

237 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

240 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

244 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

248 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

253 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

256 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

261 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

266 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

271 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

276 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

281 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

285 
wùy³_t
 
	$wùy³_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

286 
__THROW
;

290 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

291 
__THROW
;

299 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

302 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

306 
wù¿ns_t
 
	$wù¿ns_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

307 
__THROW
;

310 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

311 
__loÿË_t
 
__loÿË
è
__THROW
;

315 
__END_DECLS


	@
1
.
1
/usr/include
127
1742
ac3.c
ac3_fns.h
accessunit.c
accessunit_defns.h
accessunit_fns.h
adts.c
adts_defns.h
adts_fns.h
audio.c
audio_defns.h
audio_fns.h
avs.c
avs_defns.h
avs_fns.h
bitdata.c
bitdata_defns.h
bitdata_fns.h
compat.h
es.c
es2ts.c
es_defns.h
es_fns.h
esdots.c
esfilter.c
esmerge.c
esreport.c
esreverse.c
ethernet.c
ethernet.h
filter.c
filter_defns.h
filter_fns.h
fmtx.c
fmtx.h
h222.c
h222_defns.h
h222_fns.h
h262.c
h262_defns.h
h262_fns.h
ipv4.c
ipv4.h
l2audio.c
l2audio_fns.h
m2ts2ts.c
misc.c
misc_defns.h
misc_fns.h
nalunit.c
nalunit_defns.h
nalunit_fns.h
pcap.c
pcap.h
pcapreport.c
pes.c
pes_defns.h
pes_fns.h
pidint.c
pidint_defns.h
pidint_fns.h
printing.c
printing_defns.h
printing_fns.h
ps.c
ps2ts.c
ps_defns.h
ps_fns.h
psdots.c
psreport.c
reverse.c
reverse_defns.h
reverse_fns.h
rtp2264.c
stream_type.c
test_es_unit_list.c
test_nal_unit_list.c
test_pes.c
test_printing.c
ts.c
ts2es.c
ts2ps.c
ts_defns.h
ts_fns.h
ts_packet_insert.c
tsdvbsub.c
tsfilter.c
tsinfo.c
tsplay.c
tsplay_defns.h
tsplay_fns.h
tsplay_innards.c
tsreport.c
tsserve.c
tswrite.c
tswrite_defns.h
tswrite_fns.h
version.h
video_defns.h
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/inttypes.h
/usr/include/limits.h
/usr/include/math.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/termios.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/rpc/netdb.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
